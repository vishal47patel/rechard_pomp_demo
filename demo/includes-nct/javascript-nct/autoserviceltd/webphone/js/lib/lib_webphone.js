webphone_api.platformClass=function(){"use strict";function e(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function t(e,t,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=o(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function n(e,t){var n=-1,o=e?e.length:0;if("number"==typeof o&&o>-1&&o<=b)for(;++n<o;)t(e[n],n,e);else i(e,t)}function o(t){return t=p(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:e(t)}function i(e,t){for(var n in e)w.call(e,n)&&t(e[n],n,e)}function a(t){return null==t?e(t):v.call(t).slice(8,-1)}function r(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}function s(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function l(e,t){var o=null;return n(e,function(n,i){o=t(o,n,i,e)}),o}function p(e){return String(e).replace(/^ +| +$/g,"")}function c(e){function n(t){return l(t,function(t,n){var i=n.pattern||s(n);return!t&&(t=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=o(t[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function u(){return this.description||""}var g=h,m=e&&"object"==typeof e&&"String"!=a(e);m&&(g=e,e=null);var d=g.navigator||{},b=d.userAgent||"";e||(e=b);var f,w=m?!!d.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(v.toString()),P=m?"Object":"ScriptBridgingProxyObject",E=m?"Object":"Environment",T=m&&g.java?"JavaPackage":a(g.java),N=m?"Object":"RuntimeObject",S=/\bJava/.test(T)&&g.java,I=S&&a(g.environment)==E,C=S?"a":"α",R=S?"b":"β",G=g.document||{},y=g.operamini||g.opera;try{f=_.test(f=m&&y?y["[[Class]]"]:a(y))?f:y=null}catch(j){}var L,O,D=e,x=[],A=null,k=e==b,U=k&&y&&"function"==typeof y.version&&y.version(),V=function(t){return l(t,function(t,n){return t||RegExp("\\b"+(n.pattern||s(n))+"\\b","i").exec(e)&&(n.label||n)})}([{label:"EdgeHTML",pattern:"(?:Edge|EdgA|EdgiOS)"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),W=function(t){return l(t,function(t,n){return t||RegExp("\\b"+(n.pattern||s(n))+"\\b","i").exec(e)&&(n.label||n)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),F=n([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),M=function(t){return l(t,function(t,n,o){return t||(n[F]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(F)]||RegExp("\\b"+s(o)+"(?:\\b|\\w*\\d)","i").exec(e))&&o})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),H=function(n){return l(n,function(n,o){var i=o.pattern||s(o);return!n&&(n=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(n=t(n,i,o.label||o)),n})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(V&&(V=[V]),M&&!F&&(F=n([M])),(L=/\bGoogle TV\b/.exec(F))&&(F=L[0]),/\bSimulator\b/i.test(e)&&(F=(F?F+" ":"")+"Simulator"),"Opera Mini"==W&&/\bOPiOS\b/.test(e)&&x.push("running in Turbo/Uncompressed mode"),"IE"==W&&/\blike iPhone OS\b/.test(e)?(L=c(e.replace(/like iPhone OS/,"")),M=L.manufacturer,F=L.product):/^iP/.test(F)?(W||(W="Safari"),H="iOS"+((L=/ OS ([\d_]+)/i.exec(e))?" "+L[1].replace(/_/g,"."):"")):"Konqueror"!=W||/buntu/i.test(H)?M&&"Google"!=M&&(/Chrome/.test(W)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(F))||/\bAndroid\b/.test(H)&&/^Chrome/.test(W)&&/\bVersion\//i.test(e)?(W="Android Browser",H=/\bAndroid\b/.test(H)?H:"Android"):"Silk"==W?(/\bMobi/i.test(e)||(H="Android",x.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&x.unshift("accelerated")):"PaleMoon"==W&&(L=/\bFirefox\/([\d.]+)\b/.exec(e))?x.push("identifying as Firefox "+L[1]):"Firefox"==W&&(L=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(H||(H="Firefox OS"),F||(F=L[1])):!W||(L=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(W))?(W&&!F&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(L+"/")+8))&&(W=null),(L=F||M||H)&&(F||M||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(H))&&(W=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(H)?H:L)+" Browser")):"Electron"==W&&(L=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&x.push("Chromium "+L):H="Kubuntu",U||(U=function(t){return l(t,function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",s(W),"(?:Firefox|Minefield|NetFront)"])),(L="iCab"==V&&parseFloat(U)>3&&"WebKit"||/\bOpera\b/.test(W)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(V)&&"WebKit"||!V&&/\bMSIE\b/i.test(e)&&("Mac OS"==H?"Tasman":"Trident")||"WebKit"==V&&/\bPlayStation\b(?! Vita\b)/i.test(W)&&"NetFront")&&(V=[L]),"IE"==W&&(L=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(W+=" Mobile",H="Windows Phone "+(/\+$/.test(L)?L:L+".x"),x.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(W="IE Mobile",H="Windows Phone 8.x",x.unshift("desktop mode"),U||(U=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=W&&"Trident"==V&&(L=/\brv:([\d.]+)/.exec(e))&&(W&&x.push("identifying as "+W+(U?" "+U:"")),W="IE",U=L[1]),k){if(r(g,"global"))if(S&&(L=S.lang.System,D=L.getProperty("os.arch"),H=H||L.getProperty("os.name")+" "+L.getProperty("os.version")),I){try{U=g.require("ringo/engine").version.join("."),W="RingoJS"}catch($){(L=g.system)&&L.global.system==g.system&&(W="Narwhal",H||(H=L[0].os||null))}W||(W="Rhino")}else"object"==typeof g.process&&!g.process.browser&&(L=g.process)&&("object"==typeof L.versions&&("string"==typeof L.versions.electron?(x.push("Node "+L.versions.node),W="Electron",U=L.versions.electron):"string"==typeof L.versions.nw&&(x.push("Chromium "+U,"Node "+L.versions.node),W="NW.js",U=L.versions.nw)),W||(W="Node.js",D=L.arch,H=L.platform,U=/[\d.]+/.exec(L.version),U=U?U[0]:null));else a(L=g.runtime)==P?(W="Adobe AIR",H=L.flash.system.Capabilities.os):a(L=g.phantom)==N?(W="PhantomJS",U=(L=L.version||null)&&L.major+"."+L.minor+"."+L.patch):"number"==typeof G.documentMode&&(L=/\bTrident\/(\d+)/i.exec(e))?(U=[U,G.documentMode],(L=+L[1]+4)!=U[1]&&(x.push("IE "+U[1]+" mode"),V&&(V[1]=""),U[1]=L),U="IE"==W?String(U[1].toFixed(1)):U[0]):"number"==typeof G.documentMode&&/^(?:Chrome|Firefox)\b/.test(W)&&(x.push("masking as "+W+" "+U),W="IE",U="11.0",V=["Trident"],H="Windows");H=H&&o(H)}if(U&&(L=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(k&&d.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(A=/b/i.test(L)?"beta":"alpha",U=U.replace(RegExp(L+"\\+?$"),"")+("beta"==A?R:C)+(/\d+\+?/.exec(L)||"")),"Fennec"==W||"Firefox"==W&&/\b(?:Android|Firefox OS)\b/.test(H))W="Firefox Mobile";else if("Maxthon"==W&&U)U=U.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(F))"Xbox 360"==F&&(H=null),"Xbox 360"==F&&/\bIEMobile\b/.test(e)&&x.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(W)&&(!W||F||/Browser|Mobi/.test(W))||"Windows CE"!=H&&!/Mobi/i.test(e))if("IE"==W&&k)try{null===g.external&&x.unshift("platform preview")}catch($){x.unshift("embedded")}else(/\bBlackBerry\b/.test(F)||/\bBB10\b/.test(e))&&(L=(RegExp(F.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||U)?(L=[L,/BB10/.test(e)],H=(L[1]?(F=null,M="BlackBerry"):"Device Software")+" "+L[0],U=null):this!=i&&"Wii"!=F&&(k&&y||/Opera/.test(W)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==W&&/\bOS X (?:\d+\.){2,}/.test(H)||"IE"==W&&(H&&!/^Win/.test(H)&&U>5.5||/\bWindows XP\b/.test(H)&&U>8||8==U&&!/\bTrident\b/.test(e)))&&!_.test(L=c.call(i,e.replace(_,"")+";"))&&L.name&&(L="ing as "+L.name+((L=L.version)?" "+L:""),_.test(W)?(/\bIE\b/.test(L)&&"Mac OS"==H&&(H=null),L="identify"+L):(L="mask"+L,W=f?o(f.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(L)&&(H=null),k||(U=null)),V=["Presto"],x.push(L));else W+=" Mobile";(L=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(L=[parseFloat(L.replace(/\.(\d)$/,".0$1")),L],"Safari"==W&&"+"==L[1].slice(-1)?(W="WebKit Nightly",A="alpha",U=L[1].slice(0,-1)):U!=L[1]&&U!=(L[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(U=null),L[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==L[0]&&537.36==L[2]&&parseFloat(L[1])>=28&&"WebKit"==V&&(V=["Blink"]),k&&(w||L[1])?(V&&(V[1]="like Chrome"),L=L[1]||(L=L[0],L<530?1:L<532?2:L<532.05?3:L<533?4:L<534.03?5:L<534.07?6:L<534.1?7:L<534.13?8:L<534.16?9:L<534.24?10:L<534.3?11:L<535.01?12:L<535.02?"13+":L<535.07?15:L<535.11?16:L<535.19?17:L<536.05?18:L<536.1?19:L<537.01?20:L<537.11?"21+":L<537.13?23:L<537.18?24:L<537.24?25:L<537.36?26:"Blink"!=V?"27":"28")):(V&&(V[1]="like Safari"),L=L[0],L=L<400?1:L<500?2:L<526?3:L<533?4:L<534?"4+":L<535?5:L<537?6:L<538?7:L<601?8:"8"),V&&(V[1]+=" "+(L+="number"==typeof L?".x":/[.+]/.test(L)?"":"+")),"Safari"==W&&(!U||parseInt(U)>45)&&(U=L)),"Opera"==W&&(L=/\bzbov|zvav$/.exec(H))?(W+=" ",x.unshift("desktop mode"),"zvav"==L?(W+="Mini",U=null):W+="Mobile",H=H.replace(RegExp(" *"+L+"$"),"")):"Safari"==W&&/\bChrome\b/.exec(V&&V[1])&&(x.unshift("desktop mode"),W="Chrome Mobile",U=null,/\bOS X\b/.test(H)?(M="Apple",H="iOS 4.3+"):H=null),U&&0==U.indexOf(L=/[\d.]+$/.exec(H))&&e.indexOf("/"+L+"-")>-1&&(H=p(H.replace(L,""))),V&&!/\b(?:Avant|Nook)\b/.test(W)&&(/Browser|Lunascape|Maxthon/.test(W)||"Safari"!=W&&/^iOS/.test(H)&&/\bSafari\b/.test(V[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(W)&&V[1])&&(L=V[V.length-1])&&x.push(L),x.length&&(x=["("+x.join("; ")+")"]),M&&F&&F.indexOf(M)<0&&x.push("on "+M),F&&x.push((/^on /.test(x[x.length-1])?"":"on ")+F),H&&(L=/ ([\d.+]+)$/.exec(H),O=L&&"/"==H.charAt(H.length-L[0].length-1),H={architecture:32,family:L&&!O?H.replace(L[0],""):H,version:L?L[1]:null,toString:function(){var e=this.version;return this.family+(e&&!O?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(L=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(D))&&!/\bi686\b/i.test(D)?(H&&(H.architecture=64,H.family=H.family.replace(RegExp(" *"+L),"")),W&&(/\bWOW64\b/i.test(e)||k&&/\w(?:86|32)$/.test(d.cpuClass||d.platform)&&!/\bWin64; x64\b/i.test(e))&&x.unshift("32-bit")):H&&/^OS X/.test(H.family)&&"Chrome"==W&&parseFloat(U)>=39&&(H.architecture=64),e||(e=null);var B={};return B.description=e,B.layout=V&&V[0],B.manufacturer=M,B.name=W,B.prerelease=A,B.product=F,B.ua=e,B.version=W&&U,B.os=H||{architecture:null,family:null,version:null,toString:function(){return"null"}},B.parse=c,B.toString=u,B.version&&x.unshift(U),B.name&&x.unshift(W),H&&W&&(H!=String(H).split(" ")[0]||H!=W.split(" ")[0]&&!F)&&x.push(F?"("+H+")":"on "+H),x.length&&(B.description=x.join(" ")),B}var u={"function":!0,object:!0},h=u[typeof window]&&window||this,g=u[typeof exports]&&exports,m=u[typeof module]&&module&&!module.nodeType&&module,d=g&&m&&"object"==typeof global&&global;!d||d.global!==d&&d.window!==d&&d.self!==d||(h=d);var b=Math.pow(2,53)-1,_=/\bOpera/,f=Object.prototype,w=f.hasOwnProperty,v=f.toString;webphone_api.platform=c()}(),function(e,t){"use strict";e.webphone_api.picoModal=function(){"use strict";function e(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType}function t(e){return"string"==typeof e}function n(){var e=[];return{watch:e.push.bind(e),trigger:function(t){for(var n=!0,o={preventDefault:function(){n=!1}},i=0;i<e.length;i++)e[i](t,o);return n}}}function o(e){this.elem=e}function i(e,t){return o.div().clazz("pico-overlay").clazz(e("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(e("overlayStyles",{opacity:.5,background:"#000"})).onClick(function(){e("overlayClose",!0)&&t()})}function a(e,t){var n=e("width","auto");return"number"==typeof n&&(n+="px"),o.div().clazz("pico-content").clazz(e("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"50px",width:n,"-ms-transform":"translateX(-50%)","-moz-transform":"translateX(-50%)","-webkit-transform":"translateX(-50%)","-o-transform":"translateX(-50%)",transform:"translateX(-50%)"}).stylize(e("modalStyles",{backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(e("content")).attr("role","dialog").onClick(function(e){new o(e.target).anyAncestor(function(e){return/\bpico-close\b/.test(e.elem.className)})&&t()})}function r(e,t){if(t("closeButton",!0))return e.child().html(t("closeHtml","&#xD7;")).clazz("pico-close").clazz(t("closeClass")).stylize(t("closeStyles",{borderRadius:"2px",cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"}))}function s(e){return function(){return e().elem}}return o.div=function(e){var t=document.createElement("div");return(e||document.body).appendChild(t),new o(t)},o.prototype={child:function(){return o.div(this.elem)},stylize:function(e){e=e||{},"undefined"!=typeof e.opacity&&(e.filter="alpha(opacity="+100*e.opacity+")");for(var t in e)e.hasOwnProperty(t)&&(this.elem.style[t]=e[t]);return this},clazz:function(e){return this.elem.className+=" "+e,this},html:function(t){return e(t)?this.elem.appendChild(t):this.elem.innerHTML=t,this},onClick:function(e){return this.elem.addEventListener("click",e),this},destroy:function(){document.body.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(e,t){return this.elem.setAttribute(e,t),this},anyAncestor:function(e){for(var t=this.elem;t;){if(e(new o(t)))return!0;t=t.parentNode}return!1}},function(o){function l(e,t){var n=o[e];return"function"==typeof n&&(n=n(t)),n===undefined?t:n}function p(){v().hide(),w().hide(),f.trigger(E)}function c(){_.trigger(E)&&p()}function u(e){return function(){return e.apply(this,arguments),E}}function h(e){if(!g){var t=a(l,c);g={modal:t,overlay:i(l,c),close:r(t,l)},m.trigger(E)}return g[e]}(t(o)||e(o))&&(o={content:o});var g,m=n(),d=n(),b=n(),_=n(),f=n(),w=h.bind(window,"modal"),v=h.bind(window,"overlay"),P=h.bind(window,"close"),E={modalElem:s(w),closeElem:s(P),overlayElem:s(v),buildDom:u(h),show:function(){return d.trigger(E)&&(v().show(),P(),w().show(),b.trigger(E)),this},close:u(c),forceClose:u(p),destroy:function(){w=w().destroy(),v=v().destroy(),P=undefined},options:function(e){o=e},afterCreate:u(m.watch),beforeShow:u(d.watch),afterShow:u(b.watch),beforeClose:u(_.watch),afterClose:u(f.watch)};return E}}()}(this),webphone_api.swfobject=function(){function e(){if(!F){try{var e=D.getElementsByTagName("body")[0].appendChild(b("span"));e.parentNode.removeChild(e)}catch(o){return}F=!0;for(var t=k.length,n=0;n<t;n++)k[n]()}}function t(e){F?e():k[k.length]=e}function n(e){if(typeof O.addEventListener!=R)O.addEventListener("load",e,!1);else if(typeof D.addEventListener!=R)D.addEventListener("load",e,!1);else if(typeof O.attachEvent!=R)_(O,"onload",e);else if("function"==typeof O.onload){var t=O.onload;O.onload=function(){t(),e()}}else O.onload=e}function o(){A?i():a()}function i(){if(!0!==webphone_api.flashdeepdetect)return void a();var e=D.getElementsByTagName("body")[0],t=b(G);t.setAttribute("type",y);var n=e.appendChild(t);if(n){var o=0;!function(){if(typeof n.GetVariable!=R){var i=n.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),B.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(o<10)return o++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,a()}()}else a()}function a(){var e=U.length;if(e>0)for(var t=0;t<e;t++){var n=U[t].id,o=U[t].callbackFn,i={success:!1,id:n};if(B.pv[0]>0){var a=d(n);if(a)if(!f(U[t].swfVersion)||B.wk&&B.wk<312)if(U[t].expressInstall&&s()){var c={};c.data=U[t].expressInstall,c.width=a.getAttribute("width")||"0",c.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(c.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(c.align=a.getAttribute("align"));for(var u={},h=a.getElementsByTagName("param"),g=h.length,m=0;m<g;m++)"movie"!=h[m].getAttribute("name").toLowerCase()&&(u[h[m].getAttribute("name")]=h[m].getAttribute("value"));l(c,u,n,o)}else p(a),o&&o(i);else v(n,!0),o&&(i.success=!0,i.ref=r(n),o(i))}else if(v(n,!0),o){var b=r(n);b&&typeof b.SetVariable!=R&&(i.success=!0,i.ref=b),o(i)}}}function r(e){var t=null,n=d(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=R)t=n;else{var o=n.getElementsByTagName(G)[0];o&&(t=o)}return t}function s(){return!M&&f("6.0.65")&&(B.win||B.mac)&&!(B.wk&&B.wk<312)}function l(e,t,n,o){M=!0,N=o||null,S={success:!1,id:n};var i=d(n);if(i){"OBJECT"==i.nodeName?(E=c(i),T=null):(E=i,T=n),e.id=L,(typeof e.width==R||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==R||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),D.title=D.title.slice(0,47)+" - Flash Player Installation";var a=B.ie&&B.win?"ActiveX":"PlugIn",r="MMredirectURL="+encodeURI(O.location).toString().replace(/&/g,"%26")+"&MMplayerType="+a+"&MMdoctitle="+D.title;if(typeof t.flashvars!=R?t.flashvars+="&"+r:t.flashvars=r,B.ie&&B.win&&4!=i.readyState){var s=b("div");n+="SWFObjectNew",s.setAttribute("id",n),i.parentNode.insertBefore(s,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}u(e,t,n)}}function p(e){if(B.ie&&B.win&&4!=e.readyState){var t=b("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(c(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(c(e),e)}function c(e){var t=b("div");if(B.win&&B.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(G)[0];if(n){var o=n.childNodes;if(o)for(var i=o.length,a=0;a<i;a++)1==o[a].nodeType&&"PARAM"==o[a].nodeName||8==o[a].nodeType||t.appendChild(o[a].cloneNode(!0))}}return t}function u(e,t,n){var o,i=d(n);if(B.wk&&B.wk<312)return o;if(i)if(typeof e.id==R&&(e.id=n),B.ie&&B.win){var a="";for(var r in e)e[r]!=Object.prototype[r]&&("data"==r.toLowerCase()?t.movie=e[r]:"styleclass"==r.toLowerCase()?a+=' class="'+e[r]+'"':"classid"!=r.toLowerCase()&&(a+=" "+r+'="'+e[r]+'"'));var s="";for(var l in t)t[l]!=Object.prototype[l]&&(s+='<param name="'+l+'" value="'+t[l]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+s+"</object>",V[V.length]=e.id,o=d(e.id)}else{var p=b(G);p.setAttribute("type",y);for(var c in e)e[c]!=Object.prototype[c]&&("styleclass"==c.toLowerCase()?p.setAttribute("class",e[c]):"classid"!=c.toLowerCase()&&p.setAttribute(c,e[c]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&h(p,u,t[u]);i.parentNode.replaceChild(p,i),o=p}return o}function h(e,t,n){var o=b("param");o.setAttribute("name",t),o.setAttribute("value",n),e.appendChild(o)}function g(e){var t=d(e);t&&"OBJECT"==t.nodeName&&(B.ie&&B.win?(t.style.display="none",function(){4==t.readyState?m(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function m(e){var t=d(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function d(e){var t=null;try{t=D.getElementById(e)}catch(n){}return t}function b(e){return D.createElement(e)}function _(e,t,n){e.attachEvent(t,n),W[W.length]=[e,t,n]}function f(e){var t=B.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]}function w(e,t,n,o){if(!B.ie||!B.mac){var i=D.getElementsByTagName("head")[0];if(i){var a=n&&"string"==typeof n?n:"screen";if(o&&(I=null,C=null),!I||C!=a){var r=b("style");r.setAttribute("type","text/css"),r.setAttribute("media",a),I=i.appendChild(r),B.ie&&B.win&&typeof D.styleSheets!=R&&D.styleSheets.length>0&&(I=D.styleSheets[D.styleSheets.length-1]),C=a}B.ie&&B.win?I&&typeof I.addRule==G&&I.addRule(e,t):I&&typeof D.createTextNode!=R&&I.appendChild(D.createTextNode(e+" {"+t+"}"))}}}function v(e,t){if(H){var n=t?"visible":"hidden";F&&d(e)?d(e).style.visibility=n:w("#"+e,"visibility:"+n)}}function P(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=R?encodeURIComponent(e):e}var E,T,N,S,I,C,R="undefined",G="object",y="application/x-shockwave-flash",L="SWFObjectExprInst",O=window,D=document,x=navigator,A=!1,k=[o],U=[],V=[],W=[],F=!1,M=!1,H=!0,B=function(){var e=typeof D.getElementById!=R&&typeof D.getElementsByTagName!=R&&typeof D.createElement!=R,t=x.userAgent.toLowerCase(),n=x.platform.toLowerCase(),o=/win/.test(n?n:t),i=/mac/.test(n?n:t),a=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),r=!1,s=[0,0,0],l=null;if(typeof x.plugins!=R&&typeof x.plugins["Shockwave Flash"]==G)!(l=x.plugins["Shockwave Flash"].description)||typeof x.mimeTypes!=R&&x.mimeTypes[y]&&!x.mimeTypes[y].enabledPlugin||(A=!0,r=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),s[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),s[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),s[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof O.ActiveXObject!=R)try{var p=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");p&&(l=p.GetVariable("$version"))&&(r=!0,l=l.split(" ")[1].split(","),s=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)])}catch(c){}return{w3:e,pv:s,wk:a,ie:r,win:o,mac:i}}();(function(){B.w3&&((typeof D.readyState!=R&&"complete"==D.readyState||typeof D.readyState==R&&(D.getElementsByTagName("body")[0]||D.body))&&e(),F||(typeof D.addEventListener!=R&&D.addEventListener("DOMContentLoaded",e,!1),B.ie&&B.win&&(D.attachEvent("onreadystatechange",function(){"complete"==D.readyState&&(D.detachEvent("onreadystatechange",arguments.callee),e())}),O==top&&function(){if(!F){try{D.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),B.wk&&function(){if(!F)/loaded|complete/.test(D.readyState)?e():setTimeout(arguments.callee,0)}(),n(e)))})(),function(){B.ie&&B.win&&window.attachEvent("onunload",function(){for(var e=W.length,t=0;t<e;t++)W[t][0].detachEvent(W[t][1],W[t][2]);for(var n=V.length,o=0;o<n;o++)g(V[o]);for(var i in B)B[i]=null;B=null;for(var a in webphone_api.swfobject)webphone_api.swfobject[a]=null;webphone_api.swfobject=null})}();return{registerObject:function(e,t,n,o){if(B.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=o,U[U.length]=i,v(e,!1)}else o&&o({success:!1,id:e})},getObjectById:function(e){if(B.w3)return r(e)},embedSWF:function(e,n,o,i,a,r,p,c,h,g){var m={success:!1,id:n};B.w3&&!(B.wk&&B.wk<312)&&e&&n&&o&&i&&a?(v(n,!1),t(function(){o+="",i+="";var t={};if(h&&typeof h===G)for(var d in h)t[d]=h[d];t.data=e,t.width=o,t.height=i;var b={};if(c&&typeof c===G)for(var _ in c)b[_]=c[_];if(p&&typeof p===G)for(var w in p)typeof b.flashvars!=R?b.flashvars+="&"+w+"="+p[w]:b.flashvars=w+"="+p[w];if(f(a)){var P=u(t,b,n);t.id==n&&v(n,!0),m.success=!0,m.ref=P}else{if(r&&s())return t.data=r,void l(t,b,n,g);v(n,!0)}g&&g(m)})):g&&g(m)},switchOffAutoHideShow:function(){H=!1},ua:B,getFlashPlayerVersion:function(){return{major:B.pv[0],minor:B.pv[1],release:B.pv[2]}},hasFlashPlayerVersion:f,createSWF:function(e,t,n){return B.w3?u(e,t,n):undefined},showExpressInstall:function(e,t,n,o){B.w3&&s()&&l(e,t,n,o)},removeSWF:function(e){B.w3&&g(e)},createCSS:function(e,t,n,o){B.w3&&w(e,t,n,o)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=D.location.search||D.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return P(t);for(var n=t.split("&"),o=0;o<n.length;o++)if(n[o].substring(0,n[o].indexOf("="))==e)return P(n[o].substring(n[o].indexOf("=")+1))}return""},expressInstallCallback:function(){if(M){var e=d(L);e&&E&&(e.parentNode.replaceChild(E,e),T&&(v(T,!0),B.ie&&B.win&&(E.style.display="block")),N&&N(S)),M=!1}}}}(),webphone_api.mwphonecfg=function(){function e(e){return void 0===e||null===e?"":(e=e.toLowerCase(),"undefined"==typeof n[e]||null===n[e]?"":n[e])}function t(){return n}var n={passphrase:"xrTjBAeb87AJezpj",autotransportdetect:"false",cfgusetunneling:"0",useencryption:"false",upperserverfromuser:"0",featureset:"10",needactivation:"false",brandid:"-1",brandtext:"autoserviceltd",brandname:"autoserviceltd",video:"1",has_video:"true",enablepresence2:"1",enablepresence:"1",hasfiletransfer:"true",screensharing:"1",hasconference:"true",useg729:"2",useopuswb:"2",customizedversion:"true",autoprovisioning:"0",colortheme:"-1",actionbarhideicon:"true",usemizuwebrtcgateway:"-1",companyname:"AUTOSERVICE.LTD Ltd",deploydate:"9/15/2021 13:57:04",homepage:"AUTOSERVICE.LTD",usevoip:"4",companynameex:"autoserviceltd",confighash:"d1f2274a991694ff9d61cce66e88d47e",apibehaviour:"1",firstdeploydate:"9/15/2021 13:57:04",lastdeploydate:"9/15/2021 13:57:04",BUILDNUMBER:"2602",pc_alternatebrowserurl:"https://www.mozilla.org/firefox/new/",android_aletrnatebrowserurl:"https://play.google.com/store/apps/details?id=com.android.chrome",android_nativedialerurl:"https://play.google.com/store/apps/details?id=com.mizuvoip.mizudroid.app",ios_nativedialerurl:"https://itunes.apple.com/us/app/mizuphone/id483685573",mclientid:"17152"};return{get:e,getAll:t}}(),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.webphone_api.localforage=e()}}(function(){return function e(t,n,o){function i(r,s){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);var p=new Error("Cannot find module '"+r+"'");throw p.code="MODULE_NOT_FOUND",p}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return i(n||e)},c,c.exports,e,t,n,o)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(e,t,n){(function(e){"use strict";function n(){c=!0;for(var e,t,n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}c=!1}function o(e){1!==u.push(e)||c||i()}var i,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var r=0,s=new a(n),l=e.document.createTextNode("");s.observe(l,{characterData:!0}),i=function(){l.data=r=++r%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var p=new e.MessageChannel;p.port1.onmessage=n,i=function(){p.port2.postMessage(0)}}var c,u=[];t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";function o(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,e!==o&&l(this,e)}function a(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function r(e,t,n){m(function(){var o;try{o=t(n)}catch(i){return d.reject(e,i)}o===e?d.reject(e,new TypeError("Cannot resolve promise with itself")):d.resolve(e,o)})}function s(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function l(e,t){function n(t){a||(a=!0,d.reject(e,t))}function o(t){a||(a=!0,d.resolve(e,t))}function i(){t(o,n)}var a=!1,r=p(i);"error"===r.status&&n(r.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(o){n.status="error",n.value=o}return n}function c(e){return e instanceof this?e:d.resolve(new this(o),e)}function u(e){var t=new this(o);return d.reject(t,e)}function h(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a=new Array(n),r=0,s=-1,l=new this(o);++s<n;)!function(e,o){function s(e){a[o]=e,++r!==n||i||(i=!0,d.resolve(l,a))}t.resolve(e).then(s,function(e){i||(i=!0,d.reject(l,e))})}(e[s],s);return l}function g(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a=-1,r=new this(o);++a<n;)!function(e){t.resolve(e).then(function(e){i||(i=!0,d.resolve(r,e))},function(e){i||(i=!0,d.reject(r,e))})}(e[a]);return r}var m=e(1),d={},b=["REJECTED"],_=["FULFILLED"],f=["PENDING"];t.exports=i,i.prototype["catch"]=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===_||"function"!=typeof t&&this.state===b)return this;var n=new this.constructor(o);if(this.state!==f){r(n,this.state===_?e:t,this.outcome)}else this.queue.push(new a(n,e,t));return n},a.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},a.prototype.otherCallFulfilled=function(e){r(this.promise,this.onFulfilled,e)},a.prototype.callRejected=function(e){d.reject(this.promise,e)},a.prototype.otherCallRejected=function(e){r(this.promise,this.onRejected,e)},d.resolve=function(e,t){var n=p(s,t)
;if("error"===n.status)return d.reject(e,n.value);var o=n.value;if(o)l(e,o);else{e.state=_,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},d.reject=function(e,t){e.state=b,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callRejected(t);return e},i.resolve=c,i.reject=u,i.all=h,i.race=g},{1:1}],3:[function(e,t,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,o=new n,i=0;i<e.length;i+=1)o.append(e[i]);return o.getBlob(t.type)}}function a(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function r(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e["catch"](n)}function s(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function p(e){for(var t=e.length,n=new ArrayBuffer(t),o=new Uint8Array(n),i=0;i<t;i++)o[i]=e.charCodeAt(i);return n}function c(e){return new _e(function(t){var n=e.transaction(fe,Te),o=i([""]);n.objectStore(fe).put(o,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})["catch"](function(){return!1})}function u(e){return"boolean"==typeof we?_e.resolve(we):c(e).then(function(e){return we=e})}function h(e){var t=ve[e.name],n={};n.promise=new _e(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function g(e){var t=ve[e.name],n=t.deferredOperations.pop();if(n)return n.resolve(),n.promise}function m(e,t){var n=ve[e.name],o=n.deferredOperations.pop();if(o)return o.reject(t),o.promise}function d(e,t){return new _e(function(n,o){if(ve[e.name]=ve[e.name]||S(),e.db){if(!t)return n(e.db);h(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=be.open.apply(be,i);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(fe)}catch(o){if("ConstraintError"!==o.name)throw o;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),o(a.error)},a.onsuccess=function(){n(a.result),g(e)}})}function b(e){return d(e,!1)}function _(e){return d(e,!0)}function f(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,i=e.version>e.db.version;if(o&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function w(e){return new _e(function(t,n){var o=new FileReader;o.onerror=n,o.onloadend=function(n){var o=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:o,type:e.type})},o.readAsBinaryString(e)})}function v(e){return i([p(atob(e.data))],{type:e.type})}function P(e){return e&&e.__local_forage_encoded_blob}function E(e){var t=this,n=t._initReady().then(function(){var e=ve[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return r(n,e,e),n}function T(e){h(e);for(var t=ve[e.name],n=t.forages,o=0;o<n.length;o++){var i=n[o];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,b(e).then(function(t){return e.db=t,f(e)?_(e):t}).then(function(o){e.db=t.db=o;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=o})["catch"](function(t){throw m(e,t),t})}function N(e,t,n,o){o===undefined&&(o=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(a){if(o>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return _e.resolve().then(function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),_(e)}).then(function(){return T(e).then(function(){N(e,t,n,o-1)})})["catch"](n);n(a)}}function S(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function I(e){function t(){return _e.resolve()}var n=this,o={db:null};if(e)for(var i in e)o[i]=e[i];var a=ve[o.name];a||(a=S(),ve[o.name]=a),a.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=E);for(var r=[],s=0;s<a.forages.length;s++){var l=a.forages[s];l!==n&&r.push(l._initReady()["catch"](t))}var p=a.forages.slice(0);return _e.all(r).then(function(){return o.db=a.db,b(o)}).then(function(e){return o.db=e,f(o,n._defaultConfig.version)?_(o):e}).then(function(e){o.db=a.db=e,n._dbInfo=o;for(var t=0;t<p.length;t++){var i=p[t];i!==n&&(i._dbInfo.db=o.db,i._dbInfo.version=o.version)}})}function C(e,t){var n=this;e=s(e);var o=new _e(function(t,o){n.ready().then(function(){N(n._dbInfo,Ee,function(i,a){if(i)return o(i);try{var r=a.objectStore(n._dbInfo.storeName),s=r.get(e);s.onsuccess=function(){var e=s.result;e===undefined&&(e=null),P(e)&&(e=v(e)),t(e)},s.onerror=function(){o(s.error)}}catch(l){o(l)}})})["catch"](o)});return a(o,t),o}function R(e,t){var n=this,o=new _e(function(t,o){n.ready().then(function(){N(n._dbInfo,Ee,function(i,a){if(i)return o(i);try{var r=a.objectStore(n._dbInfo.storeName),s=r.openCursor(),l=1;s.onsuccess=function(){var n=s.result;if(n){var o=n.value;P(o)&&(o=v(o));var i=e(o,n.key,l++);void 0!==i?t(i):n["continue"]()}else t()},s.onerror=function(){o(s.error)}}catch(p){o(p)}})})["catch"](o)});return a(o,t),o}function G(e,t,n){var o=this;e=s(e);var i=new _e(function(n,i){var a;o.ready().then(function(){return a=o._dbInfo,"[object Blob]"===Pe.call(t)?u(a.db).then(function(e){return e?t:w(t)}):t}).then(function(t){N(o._dbInfo,Te,function(a,r){if(a)return i(a);try{var s=r.objectStore(o._dbInfo.storeName);null===t&&(t=undefined);var l=s.put(t,e);r.oncomplete=function(){t===undefined&&(t=null),n(t)},r.onabort=r.onerror=function(){var e=l.error?l.error:l.transaction.error;i(e)}}catch(p){i(p)}})})["catch"](i)});return a(i,n),i}function y(e,t){var n=this;e=s(e);var o=new _e(function(t,o){n.ready().then(function(){N(n._dbInfo,Te,function(i,a){if(i)return o(i);try{var r=a.objectStore(n._dbInfo.storeName),s=r["delete"](e);a.oncomplete=function(){t()},a.onerror=function(){o(s.error)},a.onabort=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(l){o(l)}})})["catch"](o)});return a(o,t),o}function L(e){var t=this,n=new _e(function(e,n){t.ready().then(function(){N(t._dbInfo,Te,function(o,i){if(o)return n(o);try{var a=i.objectStore(t._dbInfo.storeName),r=a.clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;n(e)}}catch(s){n(s)}})})["catch"](n)});return a(n,e),n}function O(e){var t=this,n=new _e(function(e,n){t.ready().then(function(){N(t._dbInfo,Ee,function(o,i){if(o)return n(o);try{var a=i.objectStore(t._dbInfo.storeName),r=a.count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(s){n(s)}})})["catch"](n)});return a(n,e),n}function D(e,t){var n=this,o=new _e(function(t,o){if(e<0)return void t(null);n.ready().then(function(){N(n._dbInfo,Ee,function(i,a){if(i)return o(i);try{var r=a.objectStore(n._dbInfo.storeName),s=!1,l=r.openCursor();l.onsuccess=function(){var n=l.result;if(!n)return void t(null);0===e?t(n.key):s?t(n.key):(s=!0,n.advance(e))},l.onerror=function(){o(l.error)}}catch(p){o(p)}})})["catch"](o)});return a(o,t),o}function x(e){var t=this,n=new _e(function(e,n){t.ready().then(function(){N(t._dbInfo,Ee,function(o,i){if(o)return n(o);try{var a=i.objectStore(t._dbInfo.storeName),r=a.openCursor(),s=[];r.onsuccess=function(){var t=r.result;if(!t)return void e(s);s.push(t.key),t["continue"]()},r.onerror=function(){n(r.error)}}catch(l){n(l)}})})["catch"](n)});return a(n,e),n}function A(e,t){t=l.apply(this,arguments);var n=this.config();e="function"!=typeof e&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var o,i=this;if(e.name){var r=e.name===n.name&&i._dbInfo.db,s=r?_e.resolve(i._dbInfo.db):b(e).then(function(t){var n=ve[e.name],o=n.forages;n.db=t;for(var i=0;i<o.length;i++)o[i]._dbInfo.db=t;return t});o=e.storeName?s.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;h(e);var o=ve[e.name],i=o.forages;t.close();for(var a=0;a<i.length;a++){var r=i[a];r._dbInfo.db=null,r._dbInfo.version=n}return new _e(function(t,o){var i=be.open(e.name,n);i.onerror=function(e){i.result.close(),o(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}).then(function(e){o.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,g(n._dbInfo)}})["catch"](function(t){throw(m(e,t)||_e.resolve())["catch"](function(){}),t})}}):s.then(function(t){h(e);var n=ve[e.name],o=n.forages;t.close();for(var i=0;i<o.length;i++){o[i]._dbInfo.db=null}return new _e(function(t,n){var o=be.deleteDatabase(e.name);o.onerror=o.onblocked=function(e){var t=o.result;t&&t.close(),n(e)},o.onsuccess=function(){var e=o.result;e&&e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<o.length;t++)g(o[t]._dbInfo)})["catch"](function(t){throw(m(e,t)||_e.resolve())["catch"](function(){}),t})})}else o=_e.reject("Invalid arguments");return a(o,t),o}function k(e){var t,n,o,i,a,r=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);var p=new ArrayBuffer(r),c=new Uint8Array(p);for(t=0;t<s;t+=4)n=Se.indexOf(e[t]),o=Se.indexOf(e[t+1]),i=Se.indexOf(e[t+2]),a=Se.indexOf(e[t+3]),c[l++]=n<<2|o>>4,c[l++]=(15&o)<<4|i>>2,c[l++]=(3&i)<<6|63&a;return p}function U(e){var t,n=new Uint8Array(e),o="";for(t=0;t<n.length;t+=3)o+=Se[n[t]>>2],o+=Se[(3&n[t])<<4|n[t+1]>>4],o+=Se[(15&n[t+1])<<2|n[t+2]>>6],o+=Se[63&n[t+2]];return n.length%3==2?o=o.substring(0,o.length-1)+"=":n.length%3==1&&(o=o.substring(0,o.length-2)+"=="),o}function V(e,t){var n="";if(e&&(n=He.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===He.call(e.buffer))){var o,i=Re;e instanceof ArrayBuffer?(o=e,i+=ye):(o=e.buffer,"[object Int8Array]"===n?i+=Oe:"[object Uint8Array]"===n?i+=De:"[object Uint8ClampedArray]"===n?i+=xe:"[object Int16Array]"===n?i+=Ae:"[object Uint16Array]"===n?i+=Ue:"[object Int32Array]"===n?i+=ke:"[object Uint32Array]"===n?i+=Ve:"[object Float32Array]"===n?i+=We:"[object Float64Array]"===n?i+=Fe:t(new Error("Failed to get type for BinaryArray"))),t(i+U(o))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n=Ie+e.type+"~"+U(this.result);t(Re+Le+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}}function W(e){if(e.substring(0,Ge)!==Re)return JSON.parse(e);var t,n=e.substring(Me),o=e.substring(Ge,Me);if(o===Le&&Ce.test(n)){var a=n.match(Ce);t=a[1],n=n.substring(a[0].length)}var r=k(n);switch(o){case ye:return r;case Le:return i([r],{type:t});case Oe:return new Int8Array(r);case De:return new Uint8Array(r);case xe:return new Uint8ClampedArray(r);case Ae:return new Int16Array(r);case Ue:return new Uint16Array(r);case ke:return new Int32Array(r);case Ve:return new Uint32Array(r);case We:return new Float32Array(r);case Fe:return new Float64Array(r);default:throw new Error("Unkown type: "+o)}}function F(e,t,n,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,o)}function M(e){var t=this,n={db:null};if(e)for(var o in e)n[o]="string"!=typeof e[o]?e[o].toString():e[o];var i=new _e(function(e,o){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(i){return o(i)}n.db.transaction(function(i){F(i,n,function(){t._dbInfo=n,e()},function(e,t){o(t)})},o)});return n.serializer=Be,i}function H(e,t,n,o,i,a){e.executeSql(n,o,i,function(e,r){r.code===r.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,s){s.rows.length?a(e,r):F(e,t,function(){e.executeSql(n,o,i,a)},a)},a):a(e,r)},a)}function B(e,t){var n=this;e=s(e);var o=new _e(function(t,o){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){H(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,n){var o=n.rows.length?n.rows.item(0).value:null;o&&(o=i.serializer.deserialize(o)),t(o)},function(e,t){o(t)})})})["catch"](o)});return a(o,t),o}function j(e,t){var n=this,o=new _e(function(t,o){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){H(n,i,"SELECT * FROM "+i.storeName,[],function(n,o){for(var a=o.rows,r=a.length,s=0;s<r;s++){var l=a.item(s),p=l.value;if(p&&(p=i.serializer.deserialize(p)),void 0!==(p=e(p,l.key,s+1)))return void t(p)}t()},function(e,t){o(t)})})})["catch"](o)});return a(o,t),o}function $(e,t,n,o){var i=this;e=s(e);var r=new _e(function(a,r){i.ready().then(function(){t===undefined&&(t=null);var s=t,l=i._dbInfo;l.serializer.serialize(t,function(t,p){p?r(p):l.db.transaction(function(n){H(n,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){a(s)},function(e,t){r(t)})},function(t){if(t.code===t.QUOTA_ERR){if(o>0)return void a($.apply(i,[e,s,n,o-1]));r(t)}})})})["catch"](r)});return a(r,n),r}function q(e,t,n){return $.apply(this,[e,t,n,1])}function z(e,t){var n=this;e=s(e);var o=new _e(function(t,o){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){H(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){o(t)})})})["catch"](o)});return a(o,t),o}function K(e){var t=this,n=new _e(function(e,n){t.ready().then(function(){var o=t._dbInfo;o.db.transaction(function(t){H(t,o,"DELETE FROM "+o.storeName,[],function(){e()},function(e,t){n(t)})})})["catch"](n)});return a(n,e),n}function X(e){var t=this,n=new _e(function(e,n){t.ready().then(function(){var o=t._dbInfo;o.db.transaction(function(t){H(t,o,"SELECT COUNT(key) as c FROM "+o.storeName,[],function(t,n){var o=n.rows.item(0).c;e(o)},function(e,t){n(t)})})})["catch"](n)});return a(n,e),n}function J(e,t){var n=this,o=new _e(function(t,o){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){H(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var o=n.rows.length?n.rows.item(0).key:null;t(o)},function(e,t){o(t)})})})["catch"](o)});return a(o,t),o}function Y(e){var t=this,n=new _e(function(e,n){t.ready().then(function(){var o=t._dbInfo;o.db.transaction(function(t){H(t,o,"SELECT key FROM "+o.storeName,[],function(t,n){for(var o=[],i=0;i<n.rows.length;i++)o.push(n.rows.item(i).key);e(o)},function(e,t){n(t)})})})["catch"](n)});return a(n,e),n}function Q(e){return new _e(function(t,n){e.transaction(function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(n,o){for(var i=[],a=0;a<o.rows.length;a++)i.push(o.rows.item(a).name);t({db:e,storeNames:i})},function(e,t){n(t)})},function(e){n(e)})})}function Z(e,t){t=l.apply(this,arguments);var n=this.config();e="function"!=typeof e&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var o,i=this;return o=e.name?new _e(function(t){var o;o=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),t(e.storeName?{db:o,storeNames:[e.storeName]}:Q(o))}).then(function(e){return new _e(function(t,n){e.db.transaction(function(o){for(var i=[],a=0,r=e.storeNames.length;a<r;a++)i.push(function(e){return new _e(function(t,n){o.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){n(t)})})}(e.storeNames[a]));_e.all(i).then(function(){t()})["catch"](function(e){n(e)})},function(e){n(e)})})}):_e.reject("Invalid arguments"),a(o,t),o}function ee(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function te(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}function ne(){return!te()||localStorage.length>0}function oe(e){var t=this,n={};if(e)for(var o in e)n[o]=e[o];return n.keyPrefix=ee(e,t._defaultConfig),ne()?(t._dbInfo=n,n.serializer=Be,_e.resolve()):_e.reject()}function ie(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var o=localStorage.key(n);0===o.indexOf(e)&&localStorage.removeItem(o)}});return a(n,e),n}function ae(e,t){var n=this;e=s(e);var o=n.ready().then(function(){var t=n._dbInfo,o=localStorage.getItem(t.keyPrefix+e);return o&&(o=t.serializer.deserialize(o)),o});return a(o,t),o}function re(e,t){var n=this,o=n.ready().then(function(){for(var t=n._dbInfo,o=t.keyPrefix,i=o.length,a=localStorage.length,r=1,s=0;s<a;s++){var l=localStorage.key(s);if(0===l.indexOf(o)){var p=localStorage.getItem(l);if(p&&(p=t.serializer.deserialize(p)),void 0!==(p=e(p,l.substring(i),r++)))return p}}});return a(o,t),o}function se(e,t){var n=this,o=n.ready().then(function(){var t,o=n._dbInfo;try{t=localStorage.key(e)}catch(i){t=null}return t&&(t=t.substring(o.keyPrefix.length)),t});return a(o,t),o}function le(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=localStorage.length,o=[],i=0;i<n;i++){var a=localStorage.key(i);0===a.indexOf(e.keyPrefix)&&o.push(a.substring(e.keyPrefix.length))}return o});return a(n,e),n}function pe(e){var t=this,n=t.keys().then(function(e){return e.length});return a(n,e),n}function ce(e,t){var n=this;e=s(e);var o=n.ready().then(function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return a(o,t),o}function ue(e,t,n){var o=this;e=s(e);var i=o.ready().then(function(){t===undefined&&(t=null);var n=t;return new _e(function(i,a){var r=o._dbInfo;r.serializer.serialize(t,function(t,o){if(o)a(o);else try{localStorage.setItem(r.keyPrefix+e,t),i(n)}catch(s){"QuotaExceededError"!==s.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==s.name||a(s),a(s)}})})});return a(i,n),i}function he(e,t){if(t=l.apply(this,arguments),e="function"!=typeof e&&e||{},!e.name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var o,i=this;return o=e.name?new _e(function(t){t(e.storeName?ee(e,i._defaultConfig):e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):_e.reject("Invalid arguments"),a(o,t),o}function ge(e,t){e[t]=function(){var n=arguments;return arguments.length&&"function"==typeof arguments[arguments.length-1]&&(webphone_api.global.localforage_last_cb=arguments[arguments.length-1]),e.ready().then(function(){return e[t].apply(e,n)})}}function me(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ke(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},be=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var _e=Promise,fe="local-forage-detect-blob-support",we=void 0,ve={},Pe=Object.prototype.toString,Ee="readonly",Te="readwrite",Ne={_driver:"asyncStorage",_initStorage:I,_support:function(){try{if(!be)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(n){return!1}}(),iterate:R,getItem:C,setItem:G,removeItem:y,clear:L,length:O,key:D,keys:x,dropInstance:A},Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ie="~~local_forage_type~",Ce=/^~~local_forage_type~([^~]+)~/,Re="__lfsc__:",Ge=Re.length,ye="arbf",Le="blob",Oe="si08",De="ui08",xe="uic8",Ae="si16",ke="si32",Ue="ur16",Ve="ui32",We="fl32",Fe="fl64",Me=Ge+ye.length,He=Object.prototype.toString,Be={serialize:V,deserialize:W,stringToBuffer:k,bufferToString:U},je={_driver:"webSQLStorage",_initStorage:M,_support:function(){return"function"==typeof openDatabase}(),iterate:j,getItem:B,setItem:q,removeItem:z,clear:K,length:X,key:J,keys:Y,dropInstance:Z},$e={_driver:"localStorageWrapper",_initStorage:oe,_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:re,getItem:ae,setItem:ue,removeItem:ce,clear:ie,length:pe,key:se,keys:le,dropInstance:he},qe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},ze=function(e,t){for(var n=e.length,o=0;o<n;){if(qe(e[o],t))return!0;o++}return!1},Ke=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Xe={},Je={},Ye={INDEXEDDB:Ne,WEBSQL:je,LOCALSTORAGE:$e},Qe=[Ye.INDEXEDDB._driver,Ye.WEBSQL._driver,Ye.LOCALSTORAGE._driver],Ze=["dropInstance"],et=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ze),tt={description:"",driver:Qe.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},nt=function(){function e(t){o(this,e);for(var n in Ye)if(Ye.hasOwnProperty(n)){var i=Ye[n],a=i._driver;this[n]=a,Xe[a]||this.defineDriver(i)}this._defaultConfig=me({},tt),this._config=me({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)["catch"](function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":de(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var o=new _e(function(t,n){try{var o=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var r=et.concat("_initStorage"),s=0,l=r.length;s<l;s++){var p=r[s];if((!ze(Ze,p)||e[p])&&"function"!=typeof e[p])return void n(i)}!function(){for(var t=0,n=Ze.length;t<n;t++){var o=Ze[t];e[o]||(e[o]=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=_e.reject(t);return a(n,arguments[arguments.length-1]),n}}(o))}}();var c=function(n){Xe[o]&&console.info("Redefining LocalForage driver: "+o),Xe[o]=e,Je[o]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(c,n):c(!!e._support):c(!0)}catch(u){n(u)}});return r(o,t,n),o},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var o=Xe[e]?_e.resolve(Xe[e]):_e.reject(new Error("Driver not found."));return r(o,t,n),o},e.prototype.getSerializer=function(e){var t=_e.resolve(Be);return r(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return r(n,e,e),n},e.prototype.setDriver=function(e,t,n){function o(){s._config.driver=s.driver()}function i(e){return s._extend(e),o(),s._ready=s._initStorage(s._config),s._ready}function a(e){return function(){function t(){for(;n<e.length;){var a=e[n];return n++,s._dbInfo=null,s._ready=null,s.getDriver(a).then(i)["catch"](t)}o();var r=new Error("No available storage method found.");return null!==webphone_api.global.localforage_last_cb&&"function"==typeof webphone_api.global.localforage_last_cb&&webphone_api.global.localforage_last_cb("ERROR, driverPromiseLoop:No available storage method found.",""),s._driverSet=_e.reject(r),s._driverSet}var n=0;return t()}}var s=this;Ke(e)||(e=[e]);var l=this._getSupportedDrivers(e),p=null!==this._driverSet?this._driverSet["catch"](function(){return _e.resolve()}):_e.resolve();return this._driverSet=p.then(function(){var e=l[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then(function(e){s._driver=e._driver,o(),s._wrapLibraryMethodsWithReady(),s._initDriver=a(l)})})["catch"](function(){o();var e=new Error("No available storage method found.");return s._driverSet=_e.reject(e),s._driverSet}),r(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Je[e]},e.prototype._extend=function(e){me(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,o=e.length;n<o;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=et.length;e<t;e++)ge(this,et[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),ot=new nt;t.exports=ot},{3:3}]},{},[4])(4)}),function(e,t){function n(e){var t=e.length,n=le.type(e);return!le.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)))}function o(e){var t=_e[e]={};return le.each(e.match(ce)||[],function(e,n){t[n]=!0}),t}function i(e,n,o,i){if(le.acceptData(e)){var a,r,s=le.expando,l="string"==typeof n,p=e.nodeType,c=p?le.cache:e,u=p?e[s]:e[s]&&s;if(u&&c[u]&&(i||c[u].data)||!l||o!==t)return u||(p?e[s]=u=Z.pop()||le.guid++:u=s),c[u]||(c[u]={},p||(c[u].toJSON=le.noop)),("object"==typeof n||"function"==typeof n)&&(i?c[u]=le.extend(c[u],n):c[u].data=le.extend(c[u].data,n)),a=c[u],i||(a.data||(a.data={}),a=a.data),o!==t&&(a[le.camelCase(n)]=o),l?null==(r=a[n])&&(r=a[le.camelCase(n)]):r=a,r}}function a(e,t,n){if(le.acceptData(e)){var o,i,a,r=e.nodeType,l=r?le.cache:e,p=r?e[le.expando]:le.expando;if(l[p]){if(t&&(a=n?l[p]:l[p].data)){le.isArray(t)?t=t.concat(le.map(t,le.camelCase)):t in a?t=[t]:(t=le.camelCase(t),t=t in a?[t]:t.split(" "));for(o=0,i=t.length;i>o;o++)delete a[t[o]];if(!(n?s:le.isEmptyObject)(a))return}(n||(delete l[p].data,s(l[p])))&&(r?le.cleanData([e],!0):le.support.deleteExpando||l!=l.window?delete l[p]:l[p]=null)}}}function r(e,n,o){if(o===t&&1===e.nodeType){var i="data-"+n.replace(we,"-$1").toLowerCase();if("string"==typeof(o=e.getAttribute(i))){try{o="true"===o||"false"!==o&&("null"===o?null:+o+""===o?+o:fe.test(o)?le.parseJSON(o):o)}catch(K){}le.data(e,n,o)}else o=t}return o}function s(e){var t;for(t in e)if(("data"!==t||!le.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function l(){return!0}function p(){return!1}function c(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}function u(e,t,n){if(t=t||0,le.isFunction(t))return le.grep(e,function(e,o){return!!t.call(e,o,e)===n});if(t.nodeType)return le.grep(e,function(e){return e===t===n});if("string"==typeof t){var o=le.grep(e,function(e){return 1===e.nodeType});if(ke.test(t))return le.filter(t,o,!n);t=le.filter(t,o)}return le.grep(e,function(e){return le.inArray(e,t)>=0===n})}function h(e){var t=We.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function g(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function m(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function d(e){var t=Je.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function b(e,t){for(var n,o=0;null!=(n=e[o]);o++)le._data(n,"globalEval",!t||le._data(t[o],"globalEval"))}function _(e,t){if(1===t.nodeType&&le.hasData(e)){var n,o,i,a=le._data(e),r=le._data(t,a),s=a.events;if(s){delete r.handle,r.events={};for(n in s)for(o=0,i=s[n].length;i>o;o++)le.event.add(t,n,s[n][o])}r.data&&(r.data=le.extend({},r.data))}}function f(e,t){var n,o,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!le.support.noCloneEvent&&t[le.expando]){i=le._data(t);for(o in i.events)le.removeEvent(t,o,i.handle);t.removeAttribute(le.expando)}"script"===n&&t.text!==e.text?(m(t).text=e.text,d(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),le.support.html5Clone&&e.innerHTML&&!le.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&ze.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function w(e,n){var o,i,a=0,r=typeof e.getElementsByTagName!==z?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==z?e.querySelectorAll(n||"*"):t;if(!r)for(r=[],o=e.childNodes||e;null!=(i=o[a]);a++)!n||le.nodeName(i,n)?r.push(i):le.merge(r,w(i,n));return n===t||n&&le.nodeName(e,n)?le.merge([e],r):r}function v(e){ze.test(e.type)&&(e.defaultChecked=e.checked)}function P(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),o=t,i=dt.length;i--;)if((t=dt[i]+n)in e)return t;return o}function E(e,t){return e=t||e,"none"===le.css(e,"display")||!le.contains(e.ownerDocument,e)}function T(e,t){for(var n,o,i,a=[],r=0,s=e.length;s>r;r++)o=e[r],o.style&&(a[r]=le._data(o,"olddisplay"),n=o.style.display,t?(a[r]||"none"!==n||(o.style.display=""),""===o.style.display&&E(o)&&(a[r]=le._data(o,"olddisplay",C(o.nodeName)))):a[r]||(i=E(o),(n&&"none"!==n||!i)&&le._data(o,"olddisplay",i?n:le.css(o,"display"))));for(r=0;s>r;r++)o=e[r],o.style&&(t&&"none"!==o.style.display&&""!==o.style.display||(o.style.display=t?a[r]||"":"none"));return e}function N(e,t,n){var o=lt.exec(t);return o?Math.max(0,o[1]-(n||0))+(o[2]||"px"):t}function S(e,t,n,o,i){for(var a=n===(o?"border":"content")?4:"width"===t?1:0,r=0;4>a;a+=2)"margin"===n&&(r+=le.css(e,n+mt[a],!0,i)),o?("content"===n&&(r-=le.css(e,"padding"+mt[a],!0,i)),"margin"!==n&&(r-=le.css(e,"border"+mt[a]+"Width",!0,i))):(r+=le.css(e,"padding"+mt[a],!0,i),"padding"!==n&&(r+=le.css(e,"border"+mt[a]+"Width",!0,i)));return r}function I(e,t,n){var o=!0,i="width"===t?e.offsetWidth:e.offsetHeight,a=tt(e),r=le.support.boxSizing&&"border-box"===le.css(e,"boxSizing",!1,a);if(0>=i||null==i){if(i=nt(e,t,a),(0>i||null==i)&&(i=e.style[t]),pt.test(i))return i;o=r&&(le.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+S(e,t,n||(r?"border":"content"),o,a)+"px"}function C(e){var t=K,n=ut[e];return n||(n=R(e,t),"none"!==n&&n||(et=(et||le("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(et[0].contentWindow||et[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=R(e,t),et.detach()),ut[e]=n),n}function R(e,t){var n=le(t.createElement(e)).appendTo(t.body),o=le.css(n[0],"display");return n.remove(),o}function G(e,t,n,o){var i;if(le.isArray(t))le.each(t,function(t,i){n||bt.test(e)?o(e,i):G(e+"["+("object"==typeof i?t:"")+"]",i,n,o)});else if(n||"object"!==le.type(t))o(e,t);else for(i in t)G(e+"["+i+"]",t[i],n,o)}function y(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var o,i=0,a=t.toLowerCase().match(ce)||[];if(le.isFunction(n))for(;o=a[i++];)"+"===o[0]?(o=o.slice(1)||"*",(e[o]=e[o]||[]).unshift(n)):(e[o]=e[o]||[]).push(n)}}function L(e,n,o,i){function a(l){var p;return r[l]=!0,le.each(e[l]||[],function(e,l){var c=l(n,o,i);return"string"!=typeof c||s||r[c]?s?!(p=c):t:(n.dataTypes.unshift(c),a(c),!1)}),p}var r={},s=e===yt;return a(n.dataTypes[0])||!r["*"]&&a("*")}
function O(e,n){var o,i,a=le.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((a[i]?e:o||(o={}))[i]=n[i]);return o&&le.extend(!0,e,o),e}function D(e,n,o){var i,a,r,s,l=e.contents,p=e.dataTypes,c=e.responseFields;for(s in c)s in o&&(n[c[s]]=o[s]);for(;"*"===p[0];)p.shift(),a===t&&(a=e.mimeType||n.getResponseHeader("Content-Type"));if(a)for(s in l)if(l[s]&&l[s].test(a)){p.unshift(s);break}if(p[0]in o)r=p[0];else{for(s in o){if(!p[0]||e.converters[s+" "+p[0]]){r=s;break}i||(i=s)}r=r||i}return r?(r!==p[0]&&p.unshift(r),o[r]):t}function x(e,t){var n,o,i,a,r={},s=0,l=e.dataTypes.slice(),p=l[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l[1])for(i in e.converters)r[i.toLowerCase()]=e.converters[i];for(;o=l[++s];)if("*"!==o){if("*"!==p&&p!==o){if(!(i=r[p+" "+o]||r["* "+o]))for(n in r)if(a=n.split(" "),a[1]===o&&(i=r[p+" "+a[0]]||r["* "+a[0]])){!0===i?i=r[n]:!0!==r[n]&&(o=a[0],l.splice(s--,0,o));break}if(!0!==i)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(Z){return{state:"parsererror",error:i?Z:"No conversion from "+p+" to "+o}}}p=o}return{state:"success",data:t}}function A(){try{return new e.XMLHttpRequest}catch(t){}}function k(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function U(){return setTimeout(function(){Vt=t}),Vt=le.now()}function V(e,t){le.each(t,function(t,n){for(var o=(jt[t]||[]).concat(jt["*"]),i=0,a=o.length;a>i;i++)if(o[i].call(e,t,n))return})}function W(e,t,n){var o,i,a=0,r=Bt.length,s=le.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;for(var t=Vt||U(),n=Math.max(0,p.startTime+p.duration-t),o=n/p.duration||0,a=1-o,r=0,l=p.tweens.length;l>r;r++)p.tweens[r].run(a);return s.notifyWith(e,[p,a,n]),1>a&&l?n:(s.resolveWith(e,[p]),!1)},p=s.promise({elem:e,props:le.extend({},t),opts:le.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Vt||U(),duration:n.duration,tweens:[],createTween:function(t,n){var o=le.Tween(e,p.opts,t,n,p.opts.specialEasing[t]||p.opts.easing);return p.tweens.push(o),o},stop:function(t){var n=0,o=t?p.tweens.length:0;if(i)return this;for(i=!0;o>n;n++)p.tweens[n].run(1);return t?s.resolveWith(e,[p,t]):s.rejectWith(e,[p,t]),this}}),c=p.props;for(F(c,p.opts.specialEasing);r>a;a++)if(o=Bt[a].call(p,e,c,p.opts))return o;return V(p,c),le.isFunction(p.opts.start)&&p.opts.start.call(e,p),le.fx.timer(le.extend(l,{elem:e,anim:p,queue:p.opts.queue})),p.progress(p.opts.progress).done(p.opts.done,p.opts.complete).fail(p.opts.fail).always(p.opts.always)}function F(e,t){var n,o,i,a,r;for(i in e)if(o=le.camelCase(i),a=t[o],n=e[i],le.isArray(n)&&(a=n[1],n=e[i]=n[0]),i!==o&&(e[o]=n,delete e[i]),(r=le.cssHooks[o])&&"expand"in r){n=r.expand(n),delete e[o];for(i in n)i in e||(e[i]=n[i],t[i]=a)}else t[o]=a}function M(e,t,n){var o,i,a,r,s,l,p,c,u,h=this,g=e.style,m={},d=[],b=e.nodeType&&E(e);n.queue||(c=le._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,u=c.empty.fire,c.empty.fire=function(){c.unqueued||u()}),c.unqueued++,h.always(function(){h.always(function(){c.unqueued--,le.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[g.overflow,g.overflowX,g.overflowY],"inline"===le.css(e,"display")&&"none"===le.css(e,"float")&&(le.support.inlineBlockNeedsLayout&&"inline"!==C(e.nodeName)?g.zoom=1:g.display="inline-block")),n.overflow&&(g.overflow="hidden",le.support.shrinkWrapBlocks||h.always(function(){g.overflow=n.overflow[0],g.overflowX=n.overflow[1],g.overflowY=n.overflow[2]}));for(i in t)if(r=t[i],Ft.exec(r)){if(delete t[i],l=l||"toggle"===r,r===(b?"hide":"show"))continue;d.push(i)}if(a=d.length){s=le._data(e,"fxshow")||le._data(e,"fxshow",{}),"hidden"in s&&(b=s.hidden),l&&(s.hidden=!b),b?le(e).show():h.done(function(){le(e).hide()}),h.done(function(){var t;le._removeData(e,"fxshow");for(t in m)le.style(e,t,m[t])});for(i=0;a>i;i++)o=d[i],p=h.createTween(o,b?s[o]:0),m[o]=s[o]||le.style(e,o),o in s||(s[o]=p.start,b&&(p.end=p.start,p.start="width"===o||"height"===o?1:0))}}function H(e,t,n,o,i){return new H.prototype.init(e,t,n,o,i)}function B(e,t){var n,o={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=mt[i],o["margin"+n]=o["padding"+n]=e;return t&&(o.opacity=o.width=e),o}function j(e){return le.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}var $,q,z=typeof t,K=e.document,X=e.location,J=e.jQuery,Y=e.$,Q={},Z=[],ee="1.9.1",te=Z.concat,ne=Z.push,oe=Z.slice,ie=Z.indexOf,ae=Q.toString,re=Q.hasOwnProperty,se=ee.trim,le=function(e,t){return new le.fn.init(e,t,q)},pe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ce=/\S+/g,ue=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,he=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ge=/^[\],:{}\s]*$/,me=function(e,t){return t.toUpperCase()},de=function(e){(K.addEventListener||"load"===e.type||"complete"===K.readyState)&&(be(),le.ready())},be=function(){K.addEventListener?(K.removeEventListener("DOMContentLoaded",de,!1),e.removeEventListener("load",de,!1)):(K.detachEvent("onreadystatechange",de),e.detachEvent("onload",de))};le.fn=le.prototype={jquery:ee,constructor:le,init:function(e,n,o){var i,a;if(!e)return this;if("string"==typeof e){if(!(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:ue.exec(e))||!i[1]&&n)return!n||n.jquery?(n||o).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof le?n[0]:n,le.merge(this,le.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:K,!0)),he.test(i[1])&&le.isPlainObject(n))for(i in n)le.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if((a=K.getElementById(i[2]))&&a.parentNode){if(a.id!==i[2])return o.find(e);this.length=1,this[0]=a}return this.context=K,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):le.isFunction(e)?o.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),le.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return oe.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=le.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return le.each(this,e,t)},ready:function(e){return le.ready.promise().done(e),this},slice:function(){return this.pushStack(oe.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(le.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ne,sort:[].sort,splice:[].splice},le.fn.init.prototype=le.fn,le.extend=le.fn.extend=function(){var e,n,o,i,a,r,s=arguments[0]||{},l=1,p=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"==typeof s||le.isFunction(s)||(s={}),p===l&&(s=this,--l);p>l;l++)if(null!=(a=arguments[l]))for(i in a)e=s[i],o=a[i],s!==o&&(c&&o&&(le.isPlainObject(o)||(n=le.isArray(o)))?(n?(n=!1,r=e&&le.isArray(e)?e:[]):r=e&&le.isPlainObject(e)?e:{},s[i]=le.extend(c,r,o)):o!==t&&(s[i]=o));return s},le.extend({noConflict:function(t){return e.$===le&&(e.$=Y),t&&e.jQuery===le&&(e.jQuery=J),le},isReady:!1,readyWait:1,holdReady:function(e){e?le.readyWait++:le.ready(!0)},ready:function(e){if(!0===e?!--le.readyWait:!le.isReady){if(!K.body)return setTimeout(le.ready);le.isReady=!0,!0!==e&&--le.readyWait>0||($.resolveWith(K,[le]),le.fn.trigger&&le(K).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===le.type(e)},isArray:Array.isArray||function(e){return"array"===le.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Q[ae.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==le.type(e)||e.nodeType||le.isWindow(e))return!1;try{if(e.constructor&&!re.call(e,"constructor")&&!re.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch($){return!1}var n;for(n in e);return n===t||re.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||K;var o=he.exec(e),i=!n&&[];return o?[t.createElement(o[1])]:(o=le.buildFragment([e],t,i),i&&le(i).remove(),le.merge([],o.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=le.trim(n))&&ge.test(n.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?Function("return "+n)():(le.error("Invalid JSON: "+n),t)},parseXML:function(n){var o,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,o=i.parseFromString(n,"text/xml")):(o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(n))}catch(K){o=t}return o&&o.documentElement&&!o.getElementsByTagName("parsererror").length||le.error("Invalid XML: "+n),o},noop:function(){},globalEval:function(t){t&&le.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,me)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,o){var i=0,a=e.length,r=n(e);if(o){if(r)for(;a>i&&!1!==t.apply(e[i],o);i++);else for(i in e)if(!1===t.apply(e[i],o))break}else if(r)for(;a>i&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},trim:se&&!se.call("\ufeff ")?function(e){return null==e?"":se.call(e)}:function(e){return null==e?"":(e+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},makeArray:function(e,t){var o=t||[];return null!=e&&(n(Object(e))?le.merge(o,"string"==typeof e?[e]:e):ne.call(o,e)),o},inArray:function(e,t,n){var o;if(t){if(ie)return ie.call(t,e,n);for(o=t.length,n=n?0>n?Math.max(0,o+n):n:0;o>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var o=n.length,i=e.length,a=0;if("number"==typeof o)for(;o>a;a++)e[i++]=n[a];else for(;n[a]!==t;)e[i++]=n[a++];return e.length=i,e},grep:function(e,t,n){var o,i=[],a=0,r=e.length;for(n=!!n;r>a;a++)o=!!t(e[a],a),n!==o&&i.push(e[a]);return i},map:function(e,t,o){var i,a=0,r=e.length,s=n(e),l=[];if(s)for(;r>a;a++)null!=(i=t(e[a],a,o))&&(l[l.length]=i);else for(a in e)null!=(i=t(e[a],a,o))&&(l[l.length]=i);return te.apply([],l)},guid:1,proxy:function(e,n){var o,i,a;return"string"==typeof n&&(a=e[n],n=e,e=a),le.isFunction(e)?(o=oe.call(arguments,2),i=function(){return e.apply(n||this,o.concat(oe.call(arguments)))},i.guid=e.guid=e.guid||le.guid++,i):t},access:function(e,n,o,i,a,r,s){var l=0,p=e.length,c=null==o;if("object"===le.type(o)){a=!0;for(l in o)le.access(e,n,l,o[l],!0,r,s)}else if(i!==t&&(a=!0,le.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(le(e),n)})),n))for(;p>l;l++)n(e[l],o,s?i:i.call(e[l],l,n(e[l],o)));return a?e:c?n.call(e):p?n(e[0],o):r},now:function(){return(new Date).getTime()}}),le.ready.promise=function(t){if(!$)if($=le.Deferred(),"complete"===K.readyState)setTimeout(le.ready);else if(K.addEventListener)K.addEventListener("DOMContentLoaded",de,!1),e.addEventListener("load",de,!1);else{K.attachEvent("onreadystatechange",de),e.attachEvent("onload",de);var n=!1;try{n=null==e.frameElement&&K.documentElement}catch(z){}n&&n.doScroll&&function o(){if(!le.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}be(),le.ready()}}()}return $.promise(t)},le.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Q["[object "+t+"]"]=t.toLowerCase()}),q=le(K);var _e={};le.Callbacks=function(e){e="string"==typeof e?_e[e]||o(e):le.extend({},e);var n,i,a,r,s,l,p=[],c=!e.once&&[],u=function(t){for(i=e.memory&&t,a=!0,s=l||0,l=0,r=p.length,n=!0;p&&r>s;s++)if(!1===p[s].apply(t[0],t[1])&&e.stopOnFalse){i=!1;break}n=!1,p&&(c?c.length&&u(c.shift()):i?p=[]:h.disable())},h={add:function(){if(p){var t=p.length;(function o(t){le.each(t,function(t,n){var i=le.type(n);"function"===i?e.unique&&h.has(n)||p.push(n):n&&n.length&&"string"!==i&&o(n)})})(arguments),n?r=p.length:i&&(l=t,u(i))}return this},remove:function(){return p&&le.each(arguments,function(e,t){for(var o;(o=le.inArray(t,p,o))>-1;)p.splice(o,1),n&&(r>=o&&r--,s>=o&&s--)}),this},has:function(e){return e?le.inArray(e,p)>-1:!(!p||!p.length)},empty:function(){return p=[],this},disable:function(){return p=c=i=t,this},disabled:function(){return!p},lock:function(){return c=t,i||h.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!p||a&&!c||(n?c.push(t):u(t)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!a}};return h},le.extend({Deferred:function(e){var t=[["resolve","done",le.Callbacks("once memory"),"resolved"],["reject","fail",le.Callbacks("once memory"),"rejected"],["notify","progress",le.Callbacks("memory")]],n="pending",o={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return le.Deferred(function(n){le.each(t,function(t,a){var r=a[0],s=le.isFunction(e[t])&&e[t];i[a[1]](function(){var e=s&&s.apply(this,arguments);e&&le.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[r+"With"](this===o?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?le.extend(e,o):o}},i={};return o.pipe=o.then,le.each(t,function(e,a){var r=a[2],s=a[3];o[a[1]]=r.add,s&&r.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[a[0]]=function(){return i[a[0]+"With"](this===i?o:this,arguments),this},i[a[0]+"With"]=r.fireWith}),o.promise(i),e&&e.call(i,i),i},when:function(e){var t,n,o,i=0,a=oe.call(arguments),r=a.length,s=1!==r||e&&le.isFunction(e.promise)?r:0,l=1===s?e:le.Deferred(),p=function(e,n,o){return function(i){n[e]=this,o[e]=arguments.length>1?oe.call(arguments):i,o===t?l.notifyWith(n,o):--s||l.resolveWith(n,o)}};if(r>1)for(t=Array(r),n=Array(r),o=Array(r);r>i;i++)a[i]&&le.isFunction(a[i].promise)?a[i].promise().done(p(i,o,a)).fail(l.reject).progress(p(i,n,t)):--s;return s||l.resolveWith(o,a),l.promise()}}),le.support=function(){var t,n,o,i,a,r,s,l,p,c,u=K.createElement("div");if(u.setAttribute("className","t"),u.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=u.getElementsByTagName("*"),o=u.getElementsByTagName("a")[0],!n||!o||!n.length)return{};a=K.createElement("select"),s=a.appendChild(K.createElement("option")),i=u.getElementsByTagName("input")[0],o.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==u.className,leadingWhitespace:3===u.firstChild.nodeType,tbody:!u.getElementsByTagName("tbody").length,htmlSerialize:!!u.getElementsByTagName("link").length,style:/top/.test(o.getAttribute("style")),hrefNormalized:"/a"===o.getAttribute("href"),opacity:/^0.5/.test(o.style.opacity),cssFloat:!!o.style.cssFloat,checkOn:!!i.value,optSelected:s.selected,enctype:!!K.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==K.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===K.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},i.checked=!0,t.noCloneChecked=i.cloneNode(!0).checked,a.disabled=!0,t.optDisabled=!s.disabled;try{delete u.test}catch(oe){t.deleteExpando=!1}i=K.createElement("input"),i.setAttribute("value",""),t.input=""===i.getAttribute("value"),i.value="t",i.setAttribute("type","radio"),t.radioValue="t"===i.value,i.setAttribute("checked","t"),i.setAttribute("name","t"),r=K.createDocumentFragment(),r.appendChild(i),t.appendChecked=i.checked,t.checkClone=r.cloneNode(!0).cloneNode(!0).lastChild.checked,u.attachEvent&&(u.attachEvent("onclick",function(){t.noCloneEvent=!1}),u.cloneNode(!0).click());for(c in{submit:!0,change:!0,focusin:!0})u.setAttribute(l="on"+c,"t"),t[c+"Bubbles"]=l in e||!1===u.attributes[l].expando;return u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===u.style.backgroundClip,le(function(){var n,o,i,a="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",r=K.getElementsByTagName("body")[0];r&&(n=K.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",r.appendChild(n).appendChild(u),u.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=u.getElementsByTagName("td"),i[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===i[0].offsetHeight,i[0].style.display="",i[1].style.display="none",t.reliableHiddenOffsets=p&&0===i[0].offsetHeight,u.innerHTML="",u.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===u.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==r.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(u,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(u,null)||{width:"4px"}).width,o=u.appendChild(K.createElement("div")),o.style.cssText=u.style.cssText=a,o.style.marginRight=o.style.width="0",u.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof u.style.zoom!==z&&(u.innerHTML="",u.style.cssText=a+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===u.offsetWidth,u.style.display="block",u.innerHTML="<div></div>",u.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==u.offsetWidth,t.inlineBlockNeedsLayout&&(r.style.zoom=1)),r.removeChild(n),n=u=i=o=null)}),n=a=r=s=o=i=null,t}();var fe=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,we=/([A-Z])/g;le.extend({cache:{},expando:"jQuery"+(ee+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return!!(e=e.nodeType?le.cache[e[le.expando]]:e[le.expando])&&!s(e)},data:function(e,t,n){return i(e,t,n)},removeData:function(e,t){return a(e,t)},_data:function(e,t,n){return i(e,t,n,!0)},_removeData:function(e,t){return a(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&le.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}}),le.fn.extend({data:function(e,n){var o,i,a=this[0],s=0,l=null;if(e===t){if(this.length&&(l=le.data(a),1===a.nodeType&&!le._data(a,"parsedAttrs"))){for(o=a.attributes;o.length>s;s++)i=o[s].name,i.indexOf("data-")||(i=le.camelCase(i.slice(5)),r(a,i,l[i]));le._data(a,"parsedAttrs",!0)}return l}return"object"==typeof e?this.each(function(){le.data(this,e)}):le.access(this,function(n){return n===t?a?r(a,e,le.data(a,e)):null:(this.each(function(){le.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){le.removeData(this,e)})}}),le.extend({queue:function(e,n,o){var i;return e?(n=(n||"fx")+"queue",i=le._data(e,n),o&&(!i||le.isArray(o)?i=le._data(e,n,le.makeArray(o)):i.push(o)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=le.queue(e,t),o=n.length,i=n.shift(),a=le._queueHooks(e,t),r=function(){le.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),o--),a.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete a.stop,i.call(e,r,a)),!o&&a&&a.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return le._data(e,n)||le._data(e,n,{empty:le.Callbacks("once memory").add(function(){le._removeData(e,t+"queue"),le._removeData(e,n)})})}}),le.fn.extend({queue:function(e,n){var o=2;return"string"!=typeof e&&(n=e,e="fx",o--),o>arguments.length?le.queue(this[0],e):n===t?this:this.each(function(){var t=le.queue(this,e,n);le._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&le.dequeue(this,e)})},dequeue:function(e){return this.each(function(){le.dequeue(this,e)})},delay:function(e,t){return e=le.fx?le.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var o=setTimeout(t,e);n.stop=function(){clearTimeout(o)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var o,i=1,a=le.Deferred(),r=this,s=this.length,l=function(){--i||a.resolveWith(r,[r])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";s--;)(o=le._data(r[s],e+"queueHooks"))&&o.empty&&(i++,o.empty.add(l));return l(),a.promise(n)}});var ve,Pe,Ee=/[\t\r\n]/g,Te=/^(?:input|select|textarea|button|object)$/i,Ne=/^(?:a|area)$/i,Se=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Ie=/^(?:checked|selected)$/i,Ce=le.support.getSetAttribute,Re=le.support.input;le.fn.extend({attr:function(e,t){return le.access(this,le.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){le.removeAttr(this,e)})},prop:function(e,t){return le.access(this,le.prop,e,t,arguments.length>1)},removeProp:function(e){return e=le.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch($){}})},addClass:function(e){var t,n,o,i,a,r=0,s=this.length,l="string"==typeof e&&e;if(le.isFunction(e))return this.each(function(t){le(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ce)||[];s>r;r++)if(n=this[r],o=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Ee," "):" ")){for(a=0;i=t[a++];)0>o.indexOf(" "+i+" ")&&(o+=i+" ");n.className=le.trim(o)}return this},removeClass:function(e){var t,n,o,i,a,r=0,s=this.length,l=0===arguments.length||"string"==typeof e&&e;if(le.isFunction(e))return this.each(function(t){le(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ce)||[];s>r;r++)if(n=this[r],o=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Ee," "):"")){for(a=0;i=t[a++];)for(;o.indexOf(" "+i+" ")>=0;)o=o.replace(" "+i+" "," ");n.className=e?le.trim(o):""}return this},toggleClass:function(e,t){var n=typeof e,o="boolean"==typeof t;return le.isFunction(e)?this.each(function(n){le(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var i,a=0,r=le(this),s=t,l=e.match(ce)||[];i=l[a++];)s=o?s:!r.hasClass(i),r[s?"addClass":"removeClass"](i);else(n===z||"boolean"===n)&&(this.className&&le._data(this,"__className__",this.className),this.className=this.className||!1===e?"":le._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,o=this.length;o>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Ee," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,o,i,a=this[0];return arguments.length?(i=le.isFunction(e),this.each(function(n){var a,r=le(this);1===this.nodeType&&(a=i?e.call(this,n,r.val()):e,null==a?a="":"number"==typeof a?a+="":le.isArray(a)&&(a=le.map(a,function(e){return null==e?"":e+""})),(o=le.valHooks[this.type]||le.valHooks[this.nodeName.toLowerCase()])&&"set"in o&&o.set(this,a,"value")!==t||(this.value=a))})):a?(o=le.valHooks[a.type]||le.valHooks[a.nodeName.toLowerCase()],o&&"get"in o&&(n=o.get(a,"value"))!==t?n:(n=a.value,"string"==typeof n?n.replace(/\r/g,""):null==n?"":n)):void 0}}),le.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,o=e.options,i=e.selectedIndex,a="select-one"===e.type||0>i,r=a?null:[],s=a?i+1:o.length,l=0>i?s:a?i:0;s>l;l++)if(n=o[l],!(!n.selected&&l!==i||(le.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&le.nodeName(n.parentNode,"optgroup"))){if(t=le(n).val(),a)return t;r.push(t)}return r},set:function(e,t){var n=le.makeArray(t);return le(e).find("option").each(function(){this.selected=le.inArray(le(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,o){var i,a,r,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===z?le.prop(e,n,o):(a=1!==s||!le.isXMLDoc(e),a&&(n=n.toLowerCase(),i=le.attrHooks[n]||(Se.test(n)?Pe:ve)),o===t?i&&a&&"get"in i&&null!==(r=i.get(e,n))?r:(typeof e.getAttribute!==z&&(r=e.getAttribute(n)),null==r?t:r):null!==o?i&&a&&"set"in i&&(r=i.set(e,o,n))!==t?r:(e.setAttribute(n,o+""),o):(le.removeAttr(e,n),t))},removeAttr:function(e,t){var n,o,i=0,a=t&&t.match(ce);if(a&&1===e.nodeType)for(;n=a[i++];)o=le.propFix[n]||n,Se.test(n)?!Ce&&Ie.test(n)?e[le.camelCase("default-"+n)]=e[o]=!1:e[o]=!1:le.attr(e,n,""),e.removeAttribute(Ce?n:o)},attrHooks:{type:{set:function(e,t){if(!le.support.radioValue&&"radio"===t&&le.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,o){var i,a,r,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return r=1!==s||!le.isXMLDoc(e),r&&(n=le.propFix[n]||n,a=le.propHooks[n]),o!==t?a&&"set"in a&&(i=a.set(e,o,n))!==t?i:e[n]=o:a&&"get"in a&&null!==(i=a.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):Te.test(e.nodeName)||Ne.test(e.nodeName)&&e.href?0:t}}}}),Pe={get:function(e,n){var o=le.prop(e,n),i="boolean"==typeof o&&e.getAttribute(n),a="boolean"==typeof o?Re&&Ce?null!=i:Ie.test(n)?e[le.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return a&&!1!==a.value?n.toLowerCase():t},set:function(e,t,n){return!1===t?le.removeAttr(e,n):Re&&Ce||!Ie.test(n)?e.setAttribute(!Ce&&le.propFix[n]||n,n):e[le.camelCase("default-"+n)]=e[n]=!0,n}},Re&&Ce||(le.attrHooks.value={get:function(e,n){var o=e.getAttributeNode(n);return le.nodeName(e,"input")?e.defaultValue:o&&o.specified?o.value:t},set:function(e,n,o){return le.nodeName(e,"input")?(e.defaultValue=n,t):ve&&ve.set(e,n,o)}}),Ce||(ve=le.valHooks.button={get:function(e,n){var o=e.getAttributeNode(n);return o&&("id"===n||"name"===n||"coords"===n?""!==o.value:o.specified)?o.value:t},set:function(e,n,o){var i=e.getAttributeNode(o);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(o)),i.value=n+="","value"===o||n===e.getAttribute(o)?n:t}},le.attrHooks.contenteditable={get:ve.get,set:function(e,t,n){ve.set(e,""!==t&&t,n)}},le.each(["width","height"],function(e,n){le.attrHooks[n]=le.extend(le.attrHooks[n],{set:function(e,o){return""===o?(e.setAttribute(n,"auto"),o):t}})})),le.support.hrefNormalized||(le.each(["href","src","width","height"],function(e,n){le.attrHooks[n]=le.extend(le.attrHooks[n],{get:function(e){var o=e.getAttribute(n,2);return null==o?t:o}})}),le.each(["href","src"],function(e,t){le.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),le.support.style||(le.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),le.support.optSelected||(le.propHooks.selected=le.extend(le.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),le.support.enctype||(le.propFix.enctype="encoding"),le.support.checkOn||le.each(["radio","checkbox"],function(){le.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),le.each(["radio","checkbox"],function(){le.valHooks[this]=le.extend(le.valHooks[this],{set:function(e,n){return le.isArray(n)?e.checked=le.inArray(le(e).val(),n)>=0:t}})});var Ge=/^(?:input|select|textarea)$/i,ye=/^key/,Le=/^(?:mouse|contextmenu)|click/,Oe=/^(?:focusinfocus|focusoutblur)$/,De=/^([^.]*)(?:\.(.+)|)$/;le.event={global:{},add:function(e,n,o,i,a){var r,s,l,p,c,u,h,g,m,d,b,_=le._data(e);if(_){for(o.handler&&(p=o,o=p.handler,a=p.selector),o.guid||(o.guid=le.guid++),(s=_.events)||(s=_.events={}),(u=_.handle)||(u=_.handle=function(e){return typeof le===z||e&&le.event.triggered===e.type?t:le.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=(n||"").match(ce)||[""],l=n.length;l--;)r=De.exec(n[l])||[],m=b=r[1],d=(r[2]||"").split(".").sort(),c=le.event.special[m]||{},m=(a?c.delegateType:c.bindType)||m,c=le.event.special[m]||{},h=le.extend({type:m,origType:b,data:i,handler:o,guid:o.guid,selector:a,needsContext:a&&le.expr.match.needsContext.test(a),namespace:d.join(".")},p),(g=s[m])||(g=s[m]=[],g.delegateCount=0,c.setup&&!1!==c.setup.call(e,i,d,u)||(e.addEventListener?e.addEventListener(m,u,!1):e.attachEvent&&e.attachEvent("on"+m,u))),c.add&&(c.add.call(e,h),h.handler.guid||(h.handler.guid=o.guid)),a?g.splice(g.delegateCount++,0,h):g.push(h),le.event.global[m]=!0;e=null}},remove:function(e,t,n,o,i){var a,r,s,l,p,c,u,h,g,m,d,b=le.hasData(e)&&le._data(e);if(b&&(c=b.events)){for(t=(t||"").match(ce)||[""],p=t.length;p--;)if(s=De.exec(t[p])||[],g=d=s[1],m=(s[2]||"").split(".").sort(),g){for(u=le.event.special[g]||{},g=(o?u.delegateType:u.bindType)||g,h=c[g]||[],s=s[2]&&RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=a=h.length;a--;)r=h[a],!i&&d!==r.origType||n&&n.guid!==r.guid||s&&!s.test(r.namespace)||o&&o!==r.selector&&("**"!==o||!r.selector)||(h.splice(a,1),r.selector&&h.delegateCount--,u.remove&&u.remove.call(e,r));l&&!h.length&&(u.teardown&&!1!==u.teardown.call(e,m,b.handle)||le.removeEvent(e,g,b.handle),delete c[g])}else for(g in c)le.event.remove(e,g+t[p],n,o,!0);le.isEmptyObject(c)&&(delete b.handle,le._removeData(e,"events"))}},trigger:function(n,o,i,a){var r,s,l,p,c,u,h,g=[i||K],m=re.call(n,"type")?n.type:n,d=re.call(n,"namespace")?n.namespace.split("."):[];if(l=u=i=i||K,3!==i.nodeType&&8!==i.nodeType&&!Oe.test(m+le.event.triggered)&&(m.indexOf(".")>=0&&(d=m.split("."),m=d.shift(),d.sort()),s=0>m.indexOf(":")&&"on"+m,n=n[le.expando]?n:new le.Event(m,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=d.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),o=null==o?[n]:le.makeArray(o,[n]),c=le.event.special[m]||{},a||!c.trigger||!1!==c.trigger.apply(i,o))){if(!a&&!c.noBubble&&!le.isWindow(i)){for(p=c.delegateType||m,Oe.test(p+m)||(l=l.parentNode);l;l=l.parentNode)g.push(l),u=l;u===(i.ownerDocument||K)&&g.push(u.defaultView||u.parentWindow||e)}for(h=0;(l=g[h++])&&!n.isPropagationStopped();)n.type=h>1?p:c.bindType||m,r=(le._data(l,"events")||{})[n.type]&&le._data(l,"handle"),r&&r.apply(l,o),(r=s&&l[s])&&le.acceptData(l)&&r.apply&&!1===r.apply(l,o)&&n.preventDefault();if(n.type=m,!(a||n.isDefaultPrevented()||c._default&&!1!==c._default.apply(i.ownerDocument,o)||"click"===m&&le.nodeName(i,"a")||!le.acceptData(i)||!s||!i[m]||le.isWindow(i))){u=i[s],u&&(i[s]=null),le.event.triggered=m;try{i[m]()}catch(se){}le.event.triggered=t,u&&(i[s]=u)}return n.result}},dispatch:function(e){e=le.event.fix(e);var n,o,i,a,r,s=[],l=oe.call(arguments),p=(le._data(this,"events")||{})[e.type]||[],c=le.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,e)){for(s=le.event.handlers.call(this,e,p),n=0;(a=s[n++])&&!e.isPropagationStopped();)for(e.currentTarget=a.elem,r=0;(i=a.handlers[r++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,(o=((le.event.special[i.origType]||{}).handle||i.handler).apply(a.elem,l))!==t&&!1===(e.result=o)&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var o,i,a,r,s=[],l=n.delegateCount,p=e.target;if(l&&p.nodeType&&(!e.button||"click"!==e.type))for(;p!=this;p=p.parentNode||this)if(1===p.nodeType&&(!0!==p.disabled||"click"!==e.type)){for(a=[],r=0;l>r;r++)i=n[r],o=i.selector+" ",a[o]===t&&(a[o]=i.needsContext?le(o,this).index(p)>=0:le.find(o,this,null,[p]).length),a[o]&&a.push(i);a.length&&s.push({elem:p,handlers:a})}return n.length>l&&s.push({elem:this,handlers:n.slice(l)}),s},fix:function(e){if(e[le.expando])return e;var t,n,o,i=e.type,a=e,r=this.fixHooks[i]
;for(r||(this.fixHooks[i]=r=Le.test(i)?this.mouseHooks:ye.test(i)?this.keyHooks:{}),o=r.props?this.props.concat(r.props):this.props,e=new le.Event(a),t=o.length;t--;)n=o[t],e[n]=a[n];return e.target||(e.target=a.srcElement||K),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,r.filter?r.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var o,i,a,r=n.button,s=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||K,a=i.documentElement,o=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||o&&o.scrollLeft||0)-(a&&a.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||o&&o.scrollTop||0)-(a&&a.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?n.toElement:s),e.which||r===t||(e.which=1&r?1:2&r?3:4&r?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return le.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==K.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===K.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,o){var i=le.extend(new le.Event,n,{type:e,isSimulated:!0,originalEvent:{}});o?le.event.trigger(i,null,t):le.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},le.removeEvent=K.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var o="on"+t;e.detachEvent&&(typeof e[o]===z&&(e[o]=null),e.detachEvent(o,n))},le.Event=function(e,n){return this instanceof le.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.defaultPrevented?l:p):this.type=e,n&&le.extend(this,n),this.timeStamp=e&&e.timeStamp||le.now(),this[le.expando]=!0,t):new le.Event(e,n)},le.Event.prototype={isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=l,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=l,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=l,this.stopPropagation()}},le.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){le.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,o=this,i=e.relatedTarget,a=e.handleObj;return(!i||i!==o&&!le.contains(o,i))&&(e.type=a.origType,n=a.handler.apply(this,arguments),e.type=t),n}}}),le.support.submitBubbles||(le.event.special.submit={setup:function(){return!le.nodeName(this,"form")&&(le.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,o=le.nodeName(n,"input")||le.nodeName(n,"button")?n.form:t;o&&!le._data(o,"submitBubbles")&&(le.event.add(o,"submit._submit",function(e){e._submit_bubble=!0}),le._data(o,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&le.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return!le.nodeName(this,"form")&&(le.event.remove(this,"._submit"),t)}}),le.support.changeBubbles||(le.event.special.change={setup:function(){return Ge.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(le.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),le.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),le.event.simulate("change",this,e,!0)})),!1):(le.event.add(this,"beforeactivate._change",function(e){var t=e.target;Ge.test(t.nodeName)&&!le._data(t,"changeBubbles")&&(le.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||le.event.simulate("change",this.parentNode,e,!0)}),le._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return le.event.remove(this,"._change"),!Ge.test(this.nodeName)}}),le.support.focusinBubbles||le.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,o=function(e){le.event.simulate(t,e.target,le.event.fix(e),!0)};le.event.special[t]={setup:function(){0==n++&&K.addEventListener(e,o,!0)},teardown:function(){0==--n&&K.removeEventListener(e,o,!0)}}}),le.fn.extend({on:function(e,n,o,i,a){var r,s;if("object"==typeof e){"string"!=typeof n&&(o=o||n,n=t);for(r in e)this.on(r,n,o,e[r],a);return this}if(null==o&&null==i?(i=n,o=n=t):null==i&&("string"==typeof n?(i=o,o=t):(i=o,o=n,n=t)),!1===i)i=p;else if(!i)return this;return 1===a&&(s=i,i=function(e){return le().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=le.guid++)),this.each(function(){le.event.add(this,e,i,o,n)})},one:function(e,t,n,o){return this.on(e,t,n,o,1)},off:function(e,n,o){var i,a;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,le(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(a in e)this.off(a,n,e[a]);return this}return(!1===n||"function"==typeof n)&&(o=n,n=t),!1===o&&(o=p),this.each(function(){le.event.remove(this,e,o,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,o){return this.on(t,e,n,o)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){le.event.trigger(e,t,this)})},triggerHandler:function(e,n){var o=this[0];return o?le.event.trigger(e,n,o,!0):t}}),function(e,t){function n(e){return ue.test(e+"")}function o(){var e,t=[];return e=function(n,o){return t.push(n+=" ")>E.cacheLength&&delete e[t.shift()],e[n]=o}}function i(e){return e[U]=!0,e}function a(e){var t=G.createElement("div");try{return e(t)}catch(v){return!1}finally{t=null}}function r(e,t,n,o){var i,a,r,s,l,u,h,g,m,d;if((t?t.ownerDocument||t:V)!==G&&R(t),t=t||G,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!L&&!o){if(i=he.exec(e))if(r=i[1]){if(9===s){if(!(a=t.getElementById(r))||!a.parentNode)return n;if(a.id===r)return n.push(a),n}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(r))&&A(t,a)&&a.id===r)return n.push(a),n}else{if(i[2])return X.apply(n,J.call(t.getElementsByTagName(e),0)),n;if((r=i[3])&&W.getByClassName&&t.getElementsByClassName)return X.apply(n,J.call(t.getElementsByClassName(r),0)),n}if(W.qsa&&!O.test(e)){if(h=!0,g=U,m=t,d=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(u=p(e),(h=t.getAttribute("id"))?g=h.replace(de,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",l=u.length;l--;)u[l]=g+c(u[l]);m=ce.test(e)&&t.parentNode||t,d=u.join(",")}if(d)try{return X.apply(n,J.call(m.querySelectorAll(d),0)),n}catch(le){}finally{h||t.removeAttribute("id")}}}return f(e.replace(oe,"$1"),t,n,o)}function s(e,t){var n=t&&e,o=n&&(~t.sourceIndex||q)-(~e.sourceIndex||q);if(o)return o;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function l(e){return i(function(t){return t=+t,i(function(n,o){for(var i,a=e([],n.length,t),r=a.length;r--;)n[i=a[r]]&&(n[i]=!(o[i]=n[i]))})})}function p(e,t){var n,o,i,a,s,l,p,c=B[e+" "];if(c)return t?0:c.slice(0);for(s=e,l=[],p=E.preFilter;s;){(!n||(o=ie.exec(s)))&&(o&&(s=s.slice(o[0].length)||s),l.push(i=[])),n=!1,(o=ae.exec(s))&&(n=o.shift(),i.push({value:n,type:o[0].replace(oe," ")}),s=s.slice(n.length));for(a in E.filter)!(o=pe[a].exec(s))||p[a]&&!(o=p[a](o))||(n=o.shift(),i.push({value:n,type:a,matches:o}),s=s.slice(n.length));if(!n)break}return t?s.length:s?r.error(e):B(e,l).slice(0)}function c(e){for(var t=0,n=e.length,o="";n>t;t++)o+=e[t].value;return o}function u(e,t,n){var o=t.dir,i=n&&"parentNode"===o,a=M++;return t.first?function(t,n,a){for(;t=t[o];)if(1===t.nodeType||i)return e(t,n,a)}:function(t,n,r){var s,l,p,c=F+" "+a;if(r){for(;t=t[o];)if((1===t.nodeType||i)&&e(t,n,r))return!0}else for(;t=t[o];)if(1===t.nodeType||i)if(p=t[U]||(t[U]={}),(l=p[o])&&l[0]===c){if(!0===(s=l[1])||s===P)return!0===s}else if(l=p[o]=[c],l[1]=e(t,n,r)||P,!0===l[1])return!0}}function h(e){return e.length>1?function(t,n,o){for(var i=e.length;i--;)if(!e[i](t,n,o))return!1;return!0}:e[0]}function g(e,t,n,o,i){for(var a,r=[],s=0,l=e.length,p=null!=t;l>s;s++)(a=e[s])&&(!n||n(a,o,i))&&(r.push(a),p&&t.push(s));return r}function m(e,t,n,o,a,r){return o&&!o[U]&&(o=m(o)),a&&!a[U]&&(a=m(a,r)),i(function(i,r,s,l){var p,c,u,h=[],m=[],d=r.length,b=i||_(t||"*",s.nodeType?[s]:s,[]),f=!e||!i&&t?b:g(b,h,e,s,l),w=n?a||(i?e:d||o)?[]:r:f;if(n&&n(f,w,s,l),o)for(p=g(w,m),o(p,[],s,l),c=p.length;c--;)(u=p[c])&&(w[m[c]]=!(f[m[c]]=u));if(i){if(a||e){if(a){for(p=[],c=w.length;c--;)(u=w[c])&&p.push(f[c]=u);a(null,w=[],p,l)}for(c=w.length;c--;)(u=w[c])&&(p=a?Y.call(i,u):h[c])>-1&&(i[p]=!(r[p]=u))}}else w=g(w===r?w.splice(d,w.length):w),a?a(null,r,w,l):X.apply(r,w)})}function d(e){for(var t,n,o,i=e.length,a=E.relative[e[0].type],r=a||E.relative[" "],s=a?1:0,l=u(function(e){return e===t},r,!0),p=u(function(e){return Y.call(t,e)>-1},r,!0),g=[function(e,n,o){return!a&&(o||n!==C)||((t=n).nodeType?l(e,n,o):p(e,n,o))}];i>s;s++)if(n=E.relative[e[s].type])g=[u(h(g),n)];else{if(n=E.filter[e[s].type].apply(null,e[s].matches),n[U]){for(o=++s;i>o&&!E.relative[e[o].type];o++);return m(s>1&&h(g),s>1&&c(e.slice(0,s-1)).replace(oe,"$1"),n,o>s&&d(e.slice(s,o)),i>o&&d(e=e.slice(o)),i>o&&c(e))}g.push(n)}return h(g)}function b(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(i,s,l,p,c){var u,h,m,d=[],b=0,_="0",f=i&&[],w=null!=c,v=C,T=i||a&&E.find.TAG("*",c&&s.parentNode||s),N=F+=null==v?1:Math.random()||.1;for(w&&(C=s!==G&&s,P=n);null!=(u=T[_]);_++){if(a&&u){for(h=0;m=e[h++];)if(m(u,s,l)){p.push(u);break}w&&(F=N,P=++n)}o&&((u=!m&&u)&&b--,i&&f.push(u))}if(b+=_,o&&_!==b){for(h=0;m=t[h++];)m(f,d,s,l);if(i){if(b>0)for(;_--;)f[_]||d[_]||(d[_]=K.call(p));d=g(d)}X.apply(p,d),w&&!i&&d.length>0&&b+t.length>1&&r.uniqueSort(p)}return w&&(F=N,C=v),f};return o?i(s):s}function _(e,t,n){for(var o=0,i=t.length;i>o;o++)r(e,t[o],n);return n}function f(e,t,n,o){var i,a,r,s,l,u=p(e);if(!o&&1===u.length){if(a=u[0]=u[0].slice(0),a.length>2&&"ID"===(r=a[0]).type&&9===t.nodeType&&!L&&E.relative[a[1].type]){if(!(t=E.find.ID(r.matches[0].replace(be,_e),t)[0]))return n;e=e.slice(a.shift().value.length)}for(i=pe.needsContext.test(e)?0:a.length;i--&&(r=a[i],!E.relative[s=r.type]);)if((l=E.find[s])&&(o=l(r.matches[0].replace(be,_e),ce.test(a[0].type)&&t.parentNode||t))){if(a.splice(i,1),!(e=o.length&&c(a)))return X.apply(n,J.call(o,0)),n;break}}return S(e,u)(o,t,L,n,ce.test(e)),n}function w(){}var v,P,E,T,N,S,I,C,R,G,y,L,O,D,x,A,k,U="sizzle"+-new Date,V=e.document,W={},F=0,M=0,H=o(),B=o(),j=o(),$=typeof t,q=1<<31,z=[],K=z.pop,X=z.push,J=z.slice,Y=z.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},Q="[\\x20\\t\\r\\n\\f]",Z="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ee=Z.replace("w","w#"),te="\\["+Q+"*("+Z+")"+Q+"*(?:([*^$|!~]?=)"+Q+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ee+")|)|)"+Q+"*\\]",ne=":("+Z+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+te.replace(3,8)+")*)|.*)\\)|)",oe=RegExp("^"+Q+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Q+"+$","g"),ie=RegExp("^"+Q+"*,"+Q+"*"),ae=RegExp("^"+Q+"*([\\x20\\t\\r\\n\\f>+~])"+Q+"*"),re=RegExp(ne),se=RegExp("^"+ee+"$"),pe={ID:RegExp("^#("+Z+")"),CLASS:RegExp("^\\.("+Z+")"),NAME:RegExp("^\\[name=['\"]?("+Z+")['\"]?\\]"),TAG:RegExp("^("+Z.replace("w","w*")+")"),ATTR:RegExp("^"+te),PSEUDO:RegExp("^"+ne),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Q+"*(even|odd|(([+-]|)(\\d*)n|)"+Q+"*(?:([+-]|)"+Q+"*(\\d+)|))"+Q+"*\\)|)","i"),needsContext:RegExp("^"+Q+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Q+"*((?:-\\d)?\\d*)"+Q+"*\\)|)(?=[^-]|$)","i")},ce=/[\x20\t\r\n\f]*[+~]/,ue=/^[^{]+\{\s*\[native code/,he=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ge=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,de=/'|\\/g,be=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,_e=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{J.call(V.documentElement.childNodes,0)[0].nodeType}catch(Oe){J=function(e){for(var t,n=[];t=this[e++];)n.push(t);return n}}N=r.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},R=r.setDocument=function(e){var o=e?e.ownerDocument||e:V;return o!==G&&9===o.nodeType&&o.documentElement?(G=o,y=o.documentElement,L=N(o),W.tagNameNoComments=a(function(e){return e.appendChild(o.createComment("")),!e.getElementsByTagName("*").length}),W.attributes=a(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),W.getByClassName=a(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||!e.getElementsByClassName("e").length)&&(e.lastChild.className="e",2===e.getElementsByClassName("e").length)}),W.getByName=a(function(e){e.id=U+0,e.innerHTML="<a name='"+U+"'></a><div name='"+U+"'></div>",y.insertBefore(e,y.firstChild);var t=o.getElementsByName&&o.getElementsByName(U).length===2+o.getElementsByName(U+0).length;return W.getIdNotName=!o.getElementById(U),y.removeChild(e),t}),E.attrHandle=a(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==$&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},W.getIdNotName?(E.find.ID=function(e,t){if(typeof t.getElementById!==$&&!L){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},E.filter.ID=function(e){var t=e.replace(be,_e);return function(e){return e.getAttribute("id")===t}}):(E.find.ID=function(e,n){if(typeof n.getElementById!==$&&!L){var o=n.getElementById(e);return o?o.id===e||typeof o.getAttributeNode!==$&&o.getAttributeNode("id").value===e?[o]:t:[]}},E.filter.ID=function(e){var t=e.replace(be,_e);return function(e){var n=typeof e.getAttributeNode!==$&&e.getAttributeNode("id");return n&&n.value===t}}),E.find.TAG=W.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==$?n.getElementsByTagName(e):t}:function(e,t){var n,o=[],i=0,a=t.getElementsByTagName(e);if("*"===e){for(;n=a[i++];)1===n.nodeType&&o.push(n);return o}return a},E.find.NAME=W.getByName&&function(e,n){return typeof n.getElementsByName!==$?n.getElementsByName(name):t},E.find.CLASS=W.getByClassName&&function(e,n){return typeof n.getElementsByClassName===$||L?t:n.getElementsByClassName(e)},D=[],O=[":focus"],(W.qsa=n(o.querySelectorAll))&&(a(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||O.push("\\["+Q+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||O.push(":checked")}),a(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&O.push("[*^$]="+Q+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||O.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),O.push(",.*:")})),(W.matchesSelector=n(x=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector))&&a(function(e){W.disconnectedMatch=x.call(e,"div"),x.call(e,"[s!='']:x"),D.push("!=",ne)}),O=RegExp(O.join("|")),D=RegExp(D.join("|")),A=n(y.contains)||y.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,o=t&&t.parentNode;return e===o||!(!o||1!==o.nodeType||!(n.contains?n.contains(o):e.compareDocumentPosition&&16&e.compareDocumentPosition(o)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},k=y.compareDocumentPosition?function(e,t){var n;return e===t?(I=!0,0):(n=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&n||e.parentNode&&11===e.parentNode.nodeType?e===o||A(V,e)?-1:t===o||A(V,t)?1:0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var n,i=0,a=e.parentNode,r=t.parentNode,l=[e],p=[t];if(e===t)return I=!0,0;if(!a||!r)return e===o?-1:t===o?1:a?-1:r?1:0;if(a===r)return s(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)p.unshift(n);for(;l[i]===p[i];)i++;return i?s(l[i],p[i]):l[i]===V?-1:p[i]===V?1:0},I=!1,[0,0].sort(k),W.detectDuplicates=I,G):G},r.matches=function(e,t){return r(e,null,null,t)},r.matchesSelector=function(e,t){if((e.ownerDocument||e)!==G&&R(e),t=t.replace(/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,"='$1']"),!(!W.matchesSelector||L||D&&D.test(t)||O.test(t)))try{var n=x.call(e,t);if(n||W.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(P){}return r(t,G,null,[e]).length>0},r.contains=function(e,t){return(e.ownerDocument||e)!==G&&R(e),A(e,t)},r.attr=function(e,t){var n;return(e.ownerDocument||e)!==G&&R(e),L||(t=t.toLowerCase()),(n=E.attrHandle[t])?n(e):L||W.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&!0===e[t]?t:n&&n.specified?n.value:null},r.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},r.uniqueSort=function(e){var t,n=[],o=1,i=0;if(I=!W.detectDuplicates,e.sort(k),I){for(;t=e[o];o++)t===e[o-1]&&(i=n.push(o));for(;i--;)e.splice(n[i],1)}return e},T=r.getText=function(e){var t,n="",o=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=T(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[o];o++)n+=T(t);return n},E=r.selectors={cacheLength:50,createPseudo:i,match:pe,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,_e),e[3]=(e[4]||e[5]||"").replace(be,_e),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||r.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&r.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return pe.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&re.test(n)&&(t=p(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(be,_e).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=H[e+" "];return t||(t=RegExp("(^|"+Q+")"+e+"("+Q+"|$)"))&&H(e,function(e){return t.test(e.className||typeof e.getAttribute!==$&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(o){var i=r.attr(o,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,o,i){var a="nth"!==e.slice(0,3),r="last"!==e.slice(-4),s="of-type"===t;return 1===o&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var p,c,u,h,g,m,d=a!==r?"nextSibling":"previousSibling",b=t.parentNode,_=s&&t.nodeName.toLowerCase(),f=!l&&!s;if(b){if(a){for(;d;){for(u=t;u=u[d];)if(s?u.nodeName.toLowerCase()===_:1===u.nodeType)return!1;m=d="only"===e&&!m&&"nextSibling"}return!0}if(m=[r?b.firstChild:b.lastChild],r&&f){for(c=b[U]||(b[U]={}),p=c[e]||[],g=p[0]===F&&p[1],h=p[0]===F&&p[2],u=g&&b.childNodes[g];u=++g&&u&&u[d]||(h=g=0)||m.pop();)if(1===u.nodeType&&++h&&u===t){c[e]=[F,g,h];break}}else if(f&&(p=(t[U]||(t[U]={}))[e])&&p[0]===F)h=p[1];else for(;(u=++g&&u&&u[d]||(h=g=0)||m.pop())&&((s?u.nodeName.toLowerCase()!==_:1!==u.nodeType)||!++h||(f&&((u[U]||(u[U]={}))[e]=[F,h]),u!==t)););return(h-=i)===o||0==h%o&&h/o>=0}}},PSEUDO:function(e,t){var n,o=E.pseudos[e]||E.setFilters[e.toLowerCase()]||r.error("unsupported pseudo: "+e);return o[U]?o(t):o.length>1?(n=[e,e,"",t],E.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,n){for(var i,a=o(e,t),r=a.length;r--;)i=Y.call(e,a[r]),e[i]=!(n[i]=a[r])}):function(e){return o(e,0,n)}):o}},pseudos:{not:i(function(e){var t=[],n=[],o=S(e.replace(oe,"$1"));return o[U]?i(function(e,t,n,i){for(var a,r=o(e,null,i,[]),s=e.length;s--;)(a=r[s])&&(e[s]=!(t[s]=a))}):function(e,i,a){return t[0]=e,o(t,null,a,n),!n.pop()}}),has:i(function(e){return function(t){return r(e,t).length>0}}),contains:i(function(e){return function(t){return(t.textContent||t.innerText||T(t)).indexOf(e)>-1}}),lang:i(function(e){return se.test(e||"")||r.error("unsupported lang: "+e),e=e.replace(be,_e).toLowerCase(),function(t){var n;do{if(n=L?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===y},focus:function(e){return e===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!E.pseudos.empty(e)},header:function(e){return me.test(e.nodeName)},input:function(e){return ge.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:l(function(){return[0]}),last:l(function(e,t){return[t-1]}),eq:l(function(e,t,n){return[0>n?n+t:n]}),even:l(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:l(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:l(function(e,t,n){for(var o=0>n?n+t:n;--o>=0;)e.push(o);return e}),gt:l(function(e,t,n){for(var o=0>n?n+t:n;t>++o;)e.push(o);return e})}};for(v in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})E.pseudos[v]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(v);for(v in{submit:!0,reset:!0})E.pseudos[v]=function(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}(v);S=r.compile=function(e,t){var n,o=[],i=[],a=j[e+" "];if(!a){for(t||(t=p(e)),n=t.length;n--;)a=d(t[n]),a[U]?o.push(a):i.push(a);a=j(e,b(i,o))}return a},E.pseudos.nth=E.pseudos.eq,E.filters=w.prototype=E.pseudos,E.setFilters=new w,R(),r.attr=le.attr,le.find=r,le.expr=r.selectors,le.expr[":"]=le.expr.pseudos,le.unique=r.uniqueSort,le.text=r.getText,le.isXMLDoc=r.isXML,le.contains=r.contains}(e);var xe=/Until$/,Ae=/^(?:parents|prev(?:Until|All))/,ke=/^.[^:#\[\.,]*$/,Ue=le.expr.match.needsContext,Ve={children:!0,contents:!0,next:!0,prev:!0};le.fn.extend({find:function(e){var t,n,o,i=this.length;if("string"!=typeof e)return o=this,this.pushStack(le(e).filter(function(){for(t=0;i>t;t++)if(le.contains(o[t],this))return!0}));for(n=[],t=0;i>t;t++)le.find(e,this[t],n);return n=this.pushStack(i>1?le.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=le(e,this),o=n.length;return this.filter(function(){for(t=0;o>t;t++)if(le.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(u(this,e,!1))},filter:function(e){return this.pushStack(u(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?Ue.test(e)?le(e,this.context).index(this[0])>=0:le.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,o=0,i=this.length,a=[],r=Ue.test(e)||"string"!=typeof e?le(e,t||this.context):0;i>o;o++)for(n=this[o];n&&n.ownerDocument&&n!==t&&11!==n.nodeType;){if(r?r.index(n)>-1:le.find.matchesSelector(n,e)){a.push(n);break}n=n.parentNode}return this.pushStack(a.length>1?le.unique(a):a)},index:function(e){return e?"string"==typeof e?le.inArray(this[0],le(e)):le.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?le(e,t):le.makeArray(e&&e.nodeType?[e]:e),o=le.merge(this.get(),n);return this.pushStack(le.unique(o))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),le.fn.andSelf=le.fn.addBack,le.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return le.dir(e,"parentNode")},parentsUntil:function(e,t,n){return le.dir(e,"parentNode",n)},next:function(e){return c(e,"nextSibling")},prev:function(e){return c(e,"previousSibling")},nextAll:function(e){return le.dir(e,"nextSibling")},prevAll:function(e){return le.dir(e,"previousSibling")},nextUntil:function(e,t,n){return le.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return le.dir(e,"previousSibling",n)},siblings:function(e){return le.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return le.sibling(e.firstChild)},contents:function(e){return le.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:le.merge([],e.childNodes)}},function(e,t){le.fn[e]=function(n,o){var i=le.map(this,t,n);return xe.test(e)||(o=n),o&&"string"==typeof o&&(i=le.filter(o,i)),i=this.length>1&&!Ve[e]?le.unique(i):i,this.length>1&&Ae.test(e)&&(i=i.reverse()),this.pushStack(i)}}),le.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?le.find.matchesSelector(t[0],e)?[t[0]]:[]:le.find.matches(e,t)},dir:function(e,n,o){for(var i=[],a=e[n];a&&9!==a.nodeType&&(o===t||1!==a.nodeType||!le(a).is(o));)1===a.nodeType&&i.push(a),a=a[n];return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var We="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Fe=RegExp("<(?:"+We+")[\\s/>]","i"),Me=/^\s+/,He=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Be=/<([\w:]+)/,je=/<tbody/i,$e=/<|&#?\w+;/,qe=/<(?:script|style|link)/i,ze=/^(?:checkbox|radio)$/i,Ke=/checked\s*(?:[^=]|=\s*.checked.)/i,Xe=/^$|\/(?:java|ecma)script/i,Je=/^true\/(.*)/,Ye={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:le.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Qe=h(K),Ze=Qe.appendChild(K.createElement("div"));Ye.optgroup=Ye.option,Ye.tbody=Ye.tfoot=Ye.colgroup=Ye.caption=Ye.thead,Ye.th=Ye.td,le.fn.extend({text:function(e){return le.access(this,function(e){return e===t?le.text(this):this.empty().append((this[0]&&this[0].ownerDocument||K).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(le.isFunction(e))return this.each(function(t){le(this).wrapAll(e.call(this,t))});if(this[0]){var t=le(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return le.isFunction(e)?this.each(function(t){le(this).wrapInner(e.call(this,t))}):this.each(function(){var t=le(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=le.isFunction(e);return this.each(function(n){le(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){le.nodeName(this,"body")||le(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,o=0;null!=(n=this[o]);o++)(!e||le.filter(e,[n]).length>0)&&(t||1!==n.nodeType||le.cleanData(w(n)),n.parentNode&&(t&&le.contains(n.ownerDocument,n)&&b(w(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&le.cleanData(w(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&le.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return le.clone(this,e,t)})},html:function(e){return le.access(this,function(e){var n=this[0]||{},o=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(/ jQuery\d+="(?:null|\d+)"/g,""):t;if(!("string"!=typeof e||qe.test(e)||!le.support.htmlSerialize&&Fe.test(e)||!le.support.leadingWhitespace&&Me.test(e)||Ye[(Be.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(He,"<$1></$2>");try{for(;i>o;o++)n=this[o]||{},1===n.nodeType&&(le.cleanData(w(n,!1)),n.innerHTML=e);n=0}catch(K){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return le.isFunction(e)||"string"==typeof e||(e=le(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(le(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,o){e=te.apply([],e);var i,a,r,s,l,p,c=0,u=this.length,h=this,b=u-1,_=e[0],f=le.isFunction(_);if(f||!(1>=u||"string"!=typeof _||le.support.checkClone)&&Ke.test(_))return this.each(function(i){var a=h.eq(i);f&&(e[0]=_.call(this,i,n?a.html():t)),a.domManip(e,n,o)});if(u&&(p=le.buildFragment(e,this[0].ownerDocument,!1,this),i=p.firstChild,1===p.childNodes.length&&(p=i),i)){for(n=n&&le.nodeName(i,"tr"),s=le.map(w(p,"script"),m),r=s.length;u>c;c++)a=p,c!==b&&(a=le.clone(a,!0,!0),r&&le.merge(s,w(a,"script"))),o.call(n&&le.nodeName(this[c],"table")?g(this[c],"tbody"):this[c],a,c);if(r)for(l=s[s.length-1].ownerDocument,le.map(s,d),c=0;r>c;c++)a=s[c],Xe.test(a.type||"")&&!le._data(a,"globalEval")&&le.contains(l,a)&&(a.src?le.ajax({url:a.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):le.globalEval((a.text||a.textContent||a.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,"")));p=i=null}return this}}),le.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){le.fn[e]=function(e){for(var n,o=0,i=[],a=le(e),r=a.length-1;r>=o;o++)n=o===r?this:this.clone(!0),le(a[o])[t](n),ne.apply(i,n.get());return this.pushStack(i)}}),le.extend({clone:function(e,t,n){var o,i,a,r,s,l=le.contains(e.ownerDocument,e);if(le.support.html5Clone||le.isXMLDoc(e)||!Fe.test("<"+e.nodeName+">")?a=e.cloneNode(!0):(Ze.innerHTML=e.outerHTML,Ze.removeChild(a=Ze.firstChild)),!(le.support.noCloneEvent&&le.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||le.isXMLDoc(e)))for(o=w(a),s=w(e),
r=0;null!=(i=s[r]);++r)o[r]&&f(i,o[r]);if(t)if(n)for(s=s||w(e),o=o||w(a),r=0;null!=(i=s[r]);r++)_(i,o[r]);else _(e,a);return o=w(a,"script"),o.length>0&&b(o,!l&&w(e,"script")),o=s=i=null,a},buildFragment:function(e,t,n,o){for(var i,a,r,s,l,p,c,u=e.length,g=h(t),m=[],d=0;u>d;d++)if((a=e[d])||0===a)if("object"===le.type(a))le.merge(m,a.nodeType?[a]:a);else if($e.test(a)){for(s=s||g.appendChild(t.createElement("div")),l=(Be.exec(a)||["",""])[1].toLowerCase(),c=Ye[l]||Ye._default,s.innerHTML=c[1]+a.replace(He,"<$1></$2>")+c[2],i=c[0];i--;)s=s.lastChild;if(!le.support.leadingWhitespace&&Me.test(a)&&m.push(t.createTextNode(Me.exec(a)[0])),!le.support.tbody)for(a="table"!==l||je.test(a)?"<table>"!==c[1]||je.test(a)?0:s:s.firstChild,i=a&&a.childNodes.length;i--;)le.nodeName(p=a.childNodes[i],"tbody")&&!p.childNodes.length&&a.removeChild(p);for(le.merge(m,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=g.lastChild}else m.push(t.createTextNode(a));for(s&&g.removeChild(s),le.support.appendChecked||le.grep(w(m,"input"),v),d=0;a=m[d++];)if((!o||-1===le.inArray(a,o))&&(r=le.contains(a.ownerDocument,a),s=w(g.appendChild(a),"script"),r&&b(s),n))for(i=0;a=s[i++];)Xe.test(a.type||"")&&n.push(a);return s=null,g},cleanData:function(e,t){for(var n,o,i,a,r=0,s=le.expando,l=le.cache,p=le.support.deleteExpando,c=le.event.special;null!=(n=e[r]);r++)if((t||le.acceptData(n))&&(i=n[s],a=i&&l[i])){if(a.events)for(o in a.events)c[o]?le.event.remove(n,o):le.removeEvent(n,o,a.handle);l[i]&&(delete l[i],p?delete n[s]:typeof n.removeAttribute!==z?n.removeAttribute(s):n[s]=null,Z.push(i))}}});var et,tt,nt,ot=/alpha\([^)]*\)/i,it=/opacity\s*=\s*([^)]*)/,at=/^(top|right|bottom|left)$/,rt=/^(none|table(?!-c[ea]).+)/,st=/^margin/,lt=RegExp("^("+pe+")(.*)$","i"),pt=RegExp("^("+pe+")(?!px)[a-z%]+$","i"),ct=RegExp("^([+-])=("+pe+")","i"),ut={BODY:"block"},ht={position:"absolute",visibility:"hidden",display:"block"},gt={letterSpacing:0,fontWeight:400},mt=["Top","Right","Bottom","Left"],dt=["Webkit","O","Moz","ms"];le.fn.extend({css:function(e,n){return le.access(this,function(e,n,o){var i,a,r={},s=0;if(le.isArray(n)){for(a=tt(e),i=n.length;i>s;s++)r[n[s]]=le.css(e,n[s],!1,a);return r}return o!==t?le.style(e,n,o):le.css(e,n)},e,n,arguments.length>1)},show:function(){return T(this,!0)},hide:function(){return T(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:E(this))?le(this).show():le(this).hide()})}}),le.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=nt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":le.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,o,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,r,s,l=le.camelCase(n),p=e.style;if(n=le.cssProps[l]||(le.cssProps[l]=P(p,l)),s=le.cssHooks[n]||le.cssHooks[l],o===t)return s&&"get"in s&&(a=s.get(e,!1,i))!==t?a:p[n];if(r=typeof o,"string"===r&&(a=ct.exec(o))&&(o=(a[1]+1)*a[2]+parseFloat(le.css(e,n)),r="number"),!(null==o||"number"===r&&isNaN(o)||("number"!==r||le.cssNumber[l]||(o+="px"),le.support.clearCloneStyle||""!==o||0!==n.indexOf("background")||(p[n]="inherit"),s&&"set"in s&&(o=s.set(e,o,i))===t)))try{p[n]=o}catch(Z){}}},css:function(e,n,o,i){var a,r,s,l=le.camelCase(n);return n=le.cssProps[l]||(le.cssProps[l]=P(e.style,l)),s=le.cssHooks[n]||le.cssHooks[l],s&&"get"in s&&(r=s.get(e,!0,o)),r===t&&(r=nt(e,n,i)),"normal"===r&&n in gt&&(r=gt[n]),""===o||o?(a=parseFloat(r),!0===o||le.isNumeric(a)?a||0:r):r},swap:function(e,t,n,o){var i,a,r={};for(a in t)r[a]=e.style[a],e.style[a]=t[a];i=n.apply(e,o||[]);for(a in t)e.style[a]=r[a];return i}}),e.getComputedStyle?(tt=function(t){return e.getComputedStyle(t,null)},nt=function(e,n,o){var i,a,r,s=o||tt(e),l=s?s.getPropertyValue(n)||s[n]:t,p=e.style;return s&&(""!==l||le.contains(e.ownerDocument,e)||(l=le.style(e,n)),pt.test(l)&&st.test(n)&&(i=p.width,a=p.minWidth,r=p.maxWidth,p.minWidth=p.maxWidth=p.width=l,l=s.width,p.width=i,p.minWidth=a,p.maxWidth=r)),l}):K.documentElement.currentStyle&&(tt=function(e){return e.currentStyle},nt=function(e,n,o){var i,a,r,s=o||tt(e),l=s?s[n]:t,p=e.style;return null==l&&p&&p[n]&&(l=p[n]),pt.test(l)&&!at.test(n)&&(i=p.left,a=e.runtimeStyle,r=a&&a.left,r&&(a.left=e.currentStyle.left),p.left="fontSize"===n?"1em":l,l=p.pixelLeft+"px",p.left=i,r&&(a.left=r)),""===l?"auto":l}),le.each(["height","width"],function(e,n){le.cssHooks[n]={get:function(e,o,i){return o?0===e.offsetWidth&&rt.test(le.css(e,"display"))?le.swap(e,ht,function(){return I(e,n,i)}):I(e,n,i):t},set:function(e,t,o){var i=o&&tt(e);return N(e,t,o?S(e,n,o,le.support.boxSizing&&"border-box"===le.css(e,"boxSizing",!1,i),i):0)}}}),le.support.opacity||(le.cssHooks.opacity={get:function(e,t){return it.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,o=e.currentStyle,i=le.isNumeric(t)?"alpha(opacity="+100*t+")":"",a=o&&o.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===le.trim(a.replace(ot,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||o&&!o.filter)||(n.filter=ot.test(a)?a.replace(ot,i):a+" "+i)}}),le(function(){le.support.reliableMarginRight||(le.cssHooks.marginRight={get:function(e,n){return n?le.swap(e,{display:"inline-block"},nt,[e,"marginRight"]):t}}),!le.support.pixelPosition&&le.fn.position&&le.each(["top","left"],function(e,n){le.cssHooks[n]={get:function(e,o){return o?(o=nt(e,n),pt.test(o)?le(e).position()[n]+"px":o):t}}})}),le.expr&&le.expr.filters&&(le.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!le.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||le.css(e,"display"))},le.expr.filters.visible=function(e){return!le.expr.filters.hidden(e)}),le.each({margin:"",padding:"",border:"Width"},function(e,t){le.cssHooks[e+t]={expand:function(n){for(var o=0,i={},a="string"==typeof n?n.split(" "):[n];4>o;o++)i[e+mt[o]+t]=a[o]||a[o-2]||a[0];return i}},st.test(e)||(le.cssHooks[e+t].set=N)});var bt=/\[\]$/,_t=/^(?:submit|button|image|reset|file)$/i,ft=/^(?:input|select|textarea|keygen)/i;le.fn.extend({serialize:function(){return le.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=le.prop(this,"elements");return e?le.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!le(this).is(":disabled")&&ft.test(this.nodeName)&&!_t.test(e)&&(this.checked||!ze.test(e))}).map(function(e,t){var n=le(this).val();return null==n?null:le.isArray(n)?le.map(n,function(e){return{name:t.name,value:e.replace(/\r?\n/g,"\r\n")}}):{name:t.name,value:n.replace(/\r?\n/g,"\r\n")}}).get()}}),le.param=function(e,n){var o,i=[],a=function(e,t){t=le.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=le.ajaxSettings&&le.ajaxSettings.traditional),le.isArray(e)||e.jquery&&!le.isPlainObject(e))le.each(e,function(){a(this.name,this.value)});else for(o in e)G(o,e[o],n,a);return i.join("&").replace(/%20/g,"+")},le.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){le.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),le.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var wt,vt,Pt=le.now(),Et=/\?/,Tt=/([?&])_=[^&]*/,Nt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,St=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,It=/^(?:GET|HEAD)$/,Ct=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Rt=le.fn.load,Gt={},yt={},Lt="*/".concat("*");try{vt=X.href}catch($t){vt=K.createElement("a"),vt.href="",vt=vt.href}wt=Ct.exec(vt.toLowerCase())||[],le.fn.load=function(e,n,o){if("string"!=typeof e&&Rt)return Rt.apply(this,arguments);var i,a,r,s=this,l=e.indexOf(" ");return l>=0&&(i=e.slice(l,e.length),e=e.slice(0,l)),le.isFunction(n)?(o=n,n=t):n&&"object"==typeof n&&(r="POST"),s.length>0&&le.ajax({url:e,type:r,dataType:"html",data:n}).done(function(e){a=arguments,s.html(i?le("<div>").append(le.parseHTML(e)).find(i):e)}).complete(o&&function(e,t){s.each(o,a||[e.responseText,t,e])}),this},le.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){le.fn[t]=function(e){return this.on(t,e)}}),le.each(["get","post"],function(e,n){le[n]=function(e,o,i,a){return le.isFunction(o)&&(a=a||i,i=o,o=t),le.ajax({url:e,type:n,dataType:a,data:o,success:i})}}),le.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:vt,type:"GET",isLocal:St.test(wt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Lt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":le.parseJSON,"text xml":le.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?O(O(e,le.ajaxSettings),t):O(le.ajaxSettings,e)},ajaxPrefilter:y(Gt),ajaxTransport:y(yt),ajax:function(e,n){function o(e,n,o,i){var a,u,f,w,P,T=n;2!==v&&(v=2,l&&clearTimeout(l),c=t,s=i||"",E.readyState=e>0?4:0,o&&(w=D(h,E,o)),e>=200&&300>e||304===e?(h.ifModified&&(P=E.getResponseHeader("Last-Modified"),P&&(le.lastModified[r]=P),(P=E.getResponseHeader("etag"))&&(le.etag[r]=P)),204===e?(a=!0,T="nocontent"):304===e?(a=!0,T="notmodified"):(a=x(h,w),T=a.state,u=a.data,f=a.error,a=!f)):(f=T,(e||!T)&&(T="error",0>e&&(e=0))),E.status=e,E.statusText=(n||T)+"",a?d.resolveWith(g,[u,T,E]):d.rejectWith(g,[E,T,f]),E.statusCode(_),_=t,p&&m.trigger(a?"ajaxSuccess":"ajaxError",[E,h,a?u:f]),b.fireWith(g,[E,T]),p&&(m.trigger("ajaxComplete",[E,h]),--le.active||le.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var i,a,r,s,l,p,c,u,h=le.ajaxSetup({},n),g=h.context||h,m=h.context&&(g.nodeType||g.jquery)?le(g):le.event,d=le.Deferred(),b=le.Callbacks("once memory"),_=h.statusCode||{},f={},w={},v=0,P="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(2===v){if(!u)for(u={};t=Nt.exec(s);)u[t[1].toLowerCase()]=t[2];t=u[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===v?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return v||(e=w[n]=w[n]||e,f[e]=t),this},overrideMimeType:function(e){return v||(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>v)for(t in e)_[t]=[_[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||P;return c&&c.abort(t),o(0,t),this}};if(d.promise(E).complete=b.add,E.success=E.done,E.error=E.fail,h.url=((e||h.url||vt)+"").replace(/#.*$/,"").replace(/^\/\//,wt[1]+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=le.trim(h.dataType||"*").toLowerCase().match(ce)||[""],null==h.crossDomain&&(i=Ct.exec(h.url.toLowerCase()),h.crossDomain=!(!i||i[1]===wt[1]&&i[2]===wt[2]&&(i[3]||("http:"===i[1]?80:443))==(wt[3]||("http:"===wt[1]?80:443)))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=le.param(h.data,h.traditional)),L(Gt,h,n,E),2===v)return E;p=h.global,p&&0==le.active++&&le.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!It.test(h.type),r=h.url,h.hasContent||(h.data&&(r=h.url+=(Et.test(r)?"&":"?")+h.data,delete h.data),!1===h.cache&&(h.url=Tt.test(r)?r.replace(Tt,"$1_="+Pt++):r+(Et.test(r)?"&":"?")+"_="+Pt++)),h.ifModified&&(le.lastModified[r]&&E.setRequestHeader("If-Modified-Since",le.lastModified[r]),le.etag[r]&&E.setRequestHeader("If-None-Match",le.etag[r])),(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&E.setRequestHeader("Content-Type",h.contentType),E.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+Lt+"; q=0.01":""):h.accepts["*"]);for(a in h.headers)E.setRequestHeader(a,h.headers[a]);if(h.beforeSend&&(!1===h.beforeSend.call(g,E,h)||2===v))return E.abort();P="abort";for(a in{success:1,error:1,complete:1})E[a](h[a]);if(c=L(yt,h,n,E)){E.readyState=1,p&&m.trigger("ajaxSend",[E,h]),h.async&&h.timeout>0&&(l=setTimeout(function(){E.abort("timeout")},h.timeout));try{v=1,c.send(f,o)}catch(he){if(!(2>v))throw he;o(-1,he)}}else o(-1,"No Transport");return E},getScript:function(e,n){return le.get(e,t,n,"script")},getJSON:function(e,t,n){return le.get(e,t,n,"json")}}),le.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return le.globalEval(e),e}}}),le.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),le.ajaxTransport("script",function(e){if(e.crossDomain){var n,o=K.head||le("head")[0]||K.documentElement;return{send:function(t,i){n=K.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},o.insertBefore(n,o.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Ot=[],Dt=/(=)\?(?=&|$)|\?\?/;le.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Ot.pop()||le.expando+"_"+Pt++;return this[e]=!0,e}}),le.ajaxPrefilter("json jsonp",function(n,o,i){var a,r,s,l=!1!==n.jsonp&&(Dt.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dt.test(n.data)&&"data");return l||"jsonp"===n.dataTypes[0]?(a=n.jsonpCallback=le.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,l?n[l]=n[l].replace(Dt,"$1"+a):!1!==n.jsonp&&(n.url+=(Et.test(n.url)?"&":"?")+n.jsonp+"="+a),n.converters["script json"]=function(){return s||le.error(a+" was not called"),s[0]},n.dataTypes[0]="json",r=e[a],e[a]=function(){s=arguments},i.always(function(){e[a]=r,n[a]&&(n.jsonpCallback=o.jsonpCallback,Ot.push(a)),s&&le.isFunction(r)&&r(s[0]),s=r=t}),"script"):t});var xt,At,kt=0,Ut=e.ActiveXObject&&function(){var e;for(e in xt)xt[e](t,!0)};le.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&A()||k()}:A,At=le.ajaxSettings.xhr(),le.support.cors=!!At&&"withCredentials"in At,(At=le.support.ajax=!!At)&&le.ajaxTransport(function(n){if(!n.crossDomain||le.support.cors){var o;return{send:function(i,a){var r,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)l[s]=n.xhrFields[s];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)l.setRequestHeader(s,i[s])}catch(Q){}l.send(n.hasContent&&n.data||null),o=function(e,i){var s,p,c,u;try{if(o&&(i||4===l.readyState))if(o=t,r&&(l.onreadystatechange=le.noop,Ut&&delete xt[r]),i)4!==l.readyState&&l.abort();else{u={},s=l.status,p=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(u.text=l.responseText);try{c=l.statusText}catch(te){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=u.text?200:404}}catch(ne){i||a(-1,ne)}u&&a(s,c,u,p)},n.async?4===l.readyState?setTimeout(o):(r=++kt,Ut&&(xt||(xt={},le(e).unload(Ut)),xt[r]=o),l.onreadystatechange=o):o()},abort:function(){o&&o(t,!0)}}}});var Vt,Wt,Ft=/^(?:toggle|show|hide)$/,Mt=RegExp("^(?:([+-])=|)("+pe+")([a-z%]*)$","i"),Ht=/queueHooks$/,Bt=[M],jt={"*":[function(e,t){var n,o,i=this.createTween(e,t),a=Mt.exec(t),r=i.cur(),s=+r||0,l=1,p=20;if(a){if(n=+a[2],"px"!==(o=a[3]||(le.cssNumber[e]?"":"px"))&&s){s=le.css(i.elem,e,!0)||n||1;do{l=l||".5",s/=l,le.style(i.elem,e,s+o)}while(l!==(l=i.cur()/r)&&1!==l&&--p)}i.unit=o,i.start=s,i.end=a[1]?s+(a[1]+1)*n:n}return i}]};le.Animation=le.extend(W,{tweener:function(e,t){le.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,o=0,i=e.length;i>o;o++)n=e[o],jt[n]=jt[n]||[],jt[n].unshift(t)},prefilter:function(e,t){t?Bt.unshift(e):Bt.push(e)}}),le.Tween=H,H.prototype={constructor:H,init:function(e,t,n,o,i,a){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=o,this.unit=a||(le.cssNumber[n]?"":"px")},cur:function(){var e=H.propHooks[this.prop];return e&&e.get?e.get(this):H.propHooks._default.get(this)},run:function(e){var t,n=H.propHooks[this.prop];return this.pos=t=this.options.duration?le.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):H.propHooks._default.set(this),this}},H.prototype.init.prototype=H.prototype,H.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=le.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){le.fx.step[e.prop]?le.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[le.cssProps[e.prop]]||le.cssHooks[e.prop])?le.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},H.propHooks.scrollTop=H.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},le.each(["toggle","show","hide"],function(e,t){var n=le.fn[t];le.fn[t]=function(e,o,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(B(t,!0),e,o,i)}}),le.fn.extend({fadeTo:function(e,t,n,o){return this.filter(E).css("opacity",0).show().end().animate({opacity:t},e,n,o)},animate:function(e,t,n,o){var i=le.isEmptyObject(e),a=le.speed(t,n,o),r=function(){var t=W(this,le.extend({},e),a);r.finish=function(){t.stop(!0)},(i||le._data(this,"finish"))&&t.stop(!0)};return r.finish=r,i||!1===a.queue?this.each(r):this.queue(a.queue,r)},stop:function(e,n,o){var i=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof e&&(o=n,n=e,e=t),n&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",a=le.timers,r=le._data(this);if(n)r[n]&&r[n].stop&&i(r[n]);else for(n in r)r[n]&&r[n].stop&&Ht.test(n)&&i(r[n]);for(n=a.length;n--;)a[n].elem!==this||null!=e&&a[n].queue!==e||(a[n].anim.stop(o),t=!1,a.splice(n,1));(t||!o)&&le.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=le._data(this),o=n[e+"queue"],i=n[e+"queueHooks"],a=le.timers,r=o?o.length:0;for(n.finish=!0,le.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1));for(t=0;r>t;t++)o[t]&&o[t].finish&&o[t].finish.call(this);delete n.finish})}}),le.each({slideDown:B("show"),slideUp:B("hide"),slideToggle:B("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){le.fn[e]=function(e,n,o){return this.animate(t,e,n,o)}}),le.speed=function(e,t,n){var o=e&&"object"==typeof e?le.extend({},e):{complete:n||!n&&t||le.isFunction(e)&&e,duration:e,easing:n&&t||t&&!le.isFunction(t)&&t};return o.duration=le.fx.off?0:"number"==typeof o.duration?o.duration:o.duration in le.fx.speeds?le.fx.speeds[o.duration]:le.fx.speeds._default,(null==o.queue||!0===o.queue)&&(o.queue="fx"),o.old=o.complete,o.complete=function(){le.isFunction(o.old)&&o.old.call(this),o.queue&&le.dequeue(this,o.queue)},o},le.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},le.timers=[],le.fx=H.prototype.init,le.fx.tick=function(){var e,n=le.timers,o=0;for(Vt=le.now();n.length>o;o++)(e=n[o])()||n[o]!==e||n.splice(o--,1);n.length||le.fx.stop(),Vt=t},le.fx.timer=function(e){e()&&le.timers.push(e)&&le.fx.start()},le.fx.interval=13,le.fx.start=function(){Wt||(Wt=setInterval(le.fx.tick,le.fx.interval))},le.fx.stop=function(){clearInterval(Wt),Wt=null},le.fx.speeds={slow:600,fast:200,_default:400},le.fx.step={},le.expr&&le.expr.filters&&(le.expr.filters.animated=function(e){return le.grep(le.timers,function(t){return e===t.elem}).length}),le.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){le.offset.setOffset(this,e,t)});var n,o,i={top:0,left:0},a=this[0],r=a&&a.ownerDocument;return r?(n=r.documentElement,le.contains(n,a)?(typeof a.getBoundingClientRect!==z&&(i=a.getBoundingClientRect()),o=j(r),{top:i.top+(o.pageYOffset||n.scrollTop)-(n.clientTop||0),left:i.left+(o.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):i):void 0},le.offset={setOffset:function(e,t,n){var o=le.css(e,"position");"static"===o&&(e.style.position="relative");var i,a,r=le(e),s=r.offset(),l=le.css(e,"top"),p=le.css(e,"left"),c=("absolute"===o||"fixed"===o)&&le.inArray("auto",[l,p])>-1,u={},h={};c?(h=r.position(),i=h.top,a=h.left):(i=parseFloat(l)||0,a=parseFloat(p)||0),le.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(u.top=t.top-s.top+i),null!=t.left&&(u.left=t.left-s.left+a),"using"in t?t.using.call(e,u):r.css(u)}},le.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},o=this[0];return"fixed"===le.css(o,"position")?t=o.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),le.nodeName(e[0],"html")||(n=e.offset()),n.top+=le.css(e[0],"borderTopWidth",!0),n.left+=le.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-le.css(o,"marginTop",!0),left:t.left-n.left-le.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||K.documentElement;e&&!le.nodeName(e,"html")&&"static"===le.css(e,"position");)e=e.offsetParent;return e||K.documentElement})}}),le.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var o=/Y/.test(n);le.fn[e]=function(i){return le.access(this,function(e,i,a){var r=j(e);return a===t?r?n in r?r[n]:r.document.documentElement[i]:e[i]:(r?r.scrollTo(o?le(r).scrollLeft():a,o?a:le(r).scrollTop()):e[i]=a,t)},e,i,arguments.length,null)}}),le.each({Height:"height",Width:"width"},function(e,n){le.each({padding:"inner"+e,content:n,"":"outer"+e},function(o,i){le.fn[i]=function(i,a){var r=arguments.length&&(o||"boolean"!=typeof i),s=o||(!0===i||!0===a?"margin":"border");return le.access(this,function(n,o,i){var a;return le.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(a=n.documentElement,Math.max(n.body["scroll"+e],a["scroll"+e],n.body["offset"+e],a["offset"+e],a["client"+e])):i===t?le.css(n,o,s):le.style(n,o,i,s)},n,r?i:t,r,null)}})}),e.webphone_api.$=le,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return le})}(window),webphone_api.global={isdebugversion_showengineselection:!1,isdebugversion:!1,isdebugversionwebrtc:!1,isdebugengine:!1,linnsengine:!0,macnsengine:!1,winlinmacnsengine:!1,deviceType:"-1",autoServerDeployVersion:!1,lastautoprovserver:"",checkforautoprov:!0,flagWaitforautoprov:!1,code_version:17,config_version:1,versionstr:"3.4.21076",minimumserviceversion:43,maximumserviceversion:52,useengine:"",useengineclicked_cache:0,last_useengine:"",ENGINE_JAVA:"java",ENGINE_WEBRTC:"webrtc",ENGINE_SERVICE:"ns",ENGINE_FLASH:"flash",ENGINE_APP:"app",webrtcavailable:-1,engineselecttime:0,engineselectstage:-1,ENGINE_DELAY:1e3,iscurrengineworking:!1,isfirststart:!1,recwsload:-1,usuk:"",predefLoglevel:5,logs:"",nrofrecentstodisplay:10,closeCallAtivity:!1,nrOfCallfunctionsToDisplay:5,pagewasrefreshed:!0,ringstart_time:0,callstart_time:0,lastringtimeouttick:0,wasSettModified:!1,wasCtModified:!1,wasChModified:!1,autoprovsrv_1:"https://www.webvoipphone.com/psettings/",autoprovsrv_2:"https://www.mizu-voip.com/phonesettings/",ctlist:[],chlist:[],aclist:[],recentlist:[],searchctlist:[],reloadcontactsaftersync:!1,refreshrecents:!1,readcallhistoryforrecents:!0,isencrypted:0,audio_rec_device_list:"",audio_play_device_list:"",audio_ring_device_list:"",audio_devices_loaded:!1,audio_rec_curr_device:"",audio_play_curr_device:"",audio_ring_curr_device:"",video_rec_device_list:"",video_rec_curr_device:"",usestorage:!1,phonestarted:0,service_last_life_signal:0,useajax_forservice:!1,serviceStatusPollTimer:null,webrtcsocketconnected:0,webrtcsipsignalingreceived:0,STORAGE_AUTO:0,STORAGE_COOKIE:1,STORAGE_LOCAL:2,ACCOUNTS_FILENAME:"wp_accounts",CONTACTS_FILENAME:"wp_contacts",SALT:"q8fgdahp9",SALT2:"vm1nye8ur2w",WIN_SOFTPHONE_URL:"http://127.0.0.1:18420",NATIVE_PLUGIN_URL:"ws://127.0.0.1",NATIVE_PLUGIN_URL_SECURE:"wss://ns4.webvoipphone.com",NATIVE_PLUGIN_URL_SECURE2:"",NATIVE_PLUGIN_URL_WIN_PORT:18520,NATIVE_PLUGIN_URL_LINMAC_PORT:18320,NATIVE_PLUGIN_URL_WIN_SSL_PORT:10443,NATIVE_PLUGIN_URL_LINMAC_SSL_PORT:19433,NPUSECURE1_YEAR:3022,NPUSECURE1_MONTH:1,NPUSECURE2_YEAR:3024,NPUSECURE2_MONTH:0,ENABLE_JAVA_URL:"http://java.com/en/download/help/enable_browser.xml",INSTALL_JAVA_URL:"http://www.java.com/download/",ec_apikey:"aJ6aqK4Nah3hnP7aht",ec_autoprov:"gJa6B2oa5Nx3Kya8n",wssupported:!1,httpmehod:"",currhttpmehodworking:!1,domloaded:!1,loglevel:1,incommingCall:!1,acceptReject:!1,checkIfInCall:!1,checkIfCallActive:!1,callTypeInOut:"",lastRingEvenet:"",hangupPressedCount:0,maintimerid:null,polltimerid:null,worktimer:null,httpkatimer:0,initcalled:!1,callName:"",credit:"",creditRequestIval:100,CREDIT_REQUEST_IVAL_DEFVAL:12e3,creditRequestTimer:0,apppletloaded:!1,presenceHM:{},waitforpresence:0,presence_started:!1,last_used_engine_cache:"",textmessaging:-1,applet_started:!1,speakerState:!0,bluetoothState:!0,lastcalldetails:"",lastcallduration:0,isfirstwsu:!0,wsuser_succeded:!1,notifs:[],intentsettings:[],intentctdetails:[],intentcall:[],intentaddeditct:[],intentchdetails:[],intentmsg:[],intentbrowser:[],intentstartpage:[],intentfiletransfer:[],intentsmscodeverify:[],rating:"",httpreqasynccallback:null,bwanswercallback:null,bwanswerfilename:null,bwanswerINCNUMBER:0,dispSaveSettMsg:0,showratewhiletype_cache:0,nsupdatepending:!1,isDialpadStarted:!1,isCallStarted:!1,isContactslistStarted:!1,isContactdetailsStarted:!1,isCallhistorylistStarted:!1,isCallhistorydetailsStarted:!1,isSettingsStarted:!1,isAddeditcontactStarted:!1,isMessagelistStarted:!1,isMessageStarted:!1,isInternalbrowserStarted:!1,isStartpageStarted:!1,isLogviewStarted:!1,isNewuserStarted:!1,isSmscodeverifyStarted:!1,isFiletransferStarted:!1,isFiltersStarted:!1,isAccountsStarted:!1,isExtra1Started:!1,isExtra2Started:!1,isExtra3Started:!1,isExtra4Started:!1,isExtra5Started:!1,alreadyCalledNrs:"",contactExists:!0,contactExistsNr:"",authenticated_displayed:!1,favafone_autologin:!1,aline:1,lastalineset:-5,lastalinesetreal:-5,lastalinesettick:0,lastalinesetrealtick:0,acallcount:0,onloaded_called:!1,wploaded:!1,ep:[],lnstat:[],redialof:!1,redialhideevt:!1,lastcallcdr:"",sendwsuserjsonp:!1,callhistoryfilter:-1,webrtcpermissionaccepted:!1,isconfcall:!1,sessionid:-1,dispregfailed:0,onunregistered_flag:!1,onunload_flag:!1,handlesett_finished:!1,dploadingdisplayed:!1,telsearchname:"",pres_set_at_start:!1,laststarttick:0,pres_unreg_called:!1,presenceinterval:72e4,msg_presence_timer:0,startendelayed_wascalled:!1,sipaccounts:[],waiting_conf_numbers:"",isconfroom_call:!1,checkpres_callback:[],active_incoming_call:!1,android_aletrnatebrowserurl_DEF:"https://play.google.com/store/apps/details?id=com.android.chrome",testmessagevalidity:3,last_event:"",wsl_uk_rec:!1,wsl_us_rec:!1,canfailover_gateway:!0,failover_gateway:!0,aua_handled:!1,stacknotstarted_time:0,stacknotstarted_retry:!1,dontshowdiscreason:!1,cansetuseengine:!1,lastconfroom:"",lastcontarget:"",lastconftargetstate:0,confcanfailover:!1,nostun:!1,noturn:!1,isvideocall:!1,lastpermreq:0,dontshow_closecall:!1,chrome_ss_plugin_url:"https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk",printwad_called:!1,custmenusL:[],bname_charcount:0,selected_apikey:"",dontclosecurrpopup:!1,last_presence_enabled:!1,currcallnumber:"",isfirstcall:!0,confanswer_received:!1,calltransf_completed:!1,flagclientreset:!1,phonestarttick:-1,httpheaderslogged:!1,onregisteredcalled:!1,flag_delsett:0,resetsett_handled:!1,apistartstate:0,apistarttick:0,wnotstartedsession:!1,flagnsreconnect:!1,colorizelog:0,webrtclastregsent:0,webrtcregtimer_exec:0,wsload_type:-1,webrtc_regstate:-1,addauser_header:!1,fcmstate:-1,fcmtoken:"",fcmIsEnabled:-1,decideusuk_finished:!1,wsc_contimeout:0,wsc_reqtimeout:0,add_recall_header:!1,domloaded_tick:0,last_ns_ws_succwss:0,callPageStatusCachePerLine:{},autoacceptsipheader:"",localforage_last_cb:null,last_wsu_tick:0,pingpong:0,ever_received_pong:!1,sipunicoderewritefrom:"",sipunicoderewriteto:"",firstregister_sessiontick:0,bothpartyhold:!1,firefoxholdcount:0,isholdresume:!1,isresume:0,holdresumecount:0,win_nsplugin_filename:"WebPhoneService_Install.exe",mac_nsplugin_filename:"webphone_ns_mac.zip",mac_nsplugin_path:"www",lin32_nsplugin_filename:"webphone_ns_lin32.zip",lin32arm_nsplugin_filename:"webphone_ns_lin32arm.zip",lin64_nsplugin_filename:"webphone_ns_lin64.zip",lin64arm_nsplugin_filename:"webphone_ns_lin64arm.zip",enstarteddisplayed:!1,usemutemutiline:!1,nuiswebpage:null,minimumservicebuild:0,last_good_status:"",display_last_status:!1,minten:!1,mto:"",last_transfer_tick:0,dontSendSignaling:!1,dontSendSignalingTimer:0,isappenginestarted:!1,smsCodeUser:"",isconfdtmf:!1,CLOSE_CALL_TIMER:-100,lastengine_working_ok:"",lastengine_started_ok:"",restartice_time:0,ice_timer:null,icecompleted:!1,ice_callaccepted:!1,settmap:{},settmap2:{},mRealm:"",webphone_started:!1,wenThisGlobal:null},webphone_api.common=function(){function ClassSipAccounts(){this.serveraddress,this.username,this.password,this.ival,this.enabled,this.ismain,this.callerid,this.displayname,this.proxyaddress,this.realm}function ReceiveNotifications(e){try{if(isNull(e)&&(e=""),e=Trim(e),0===e.length||e.indexOf(notsep)===e.lastIndexOf(notsep)&&e.indexOf(notsep2)===e.lastIndexOf(notsep2))CleanNotifications(e);else if(e.indexOf(notsep)!==e.lastIndexOf(notsep)){var t=e.split(notsep);if(!isNull(t)&&t.length>0)for(var n=0;n<t.length;n++)isNull(t[n])||CleanNotifications(t[n])}else if(e.indexOf(notsep2)!==e.lastIndexOf(notsep2)){var t=e.split(notsep2);if(!isNull(t)&&t.length>0)for(var n=0;n<t.length;n++)isNull(t[n])||CleanNotifications(t[n])}else CleanNotifications(e)}catch(o){PutToDebugLogException(2,"common: ReceiveNotifications",o)}}function CleanNotifications(e){try{isNull(e)&&(e=""),CanLog(7)&&PutToDebugLog(7,"RECEIVED: "+e),e=e.replace("WPNOTIFICATION,",""),!1===webphone_api.global.iscurrengineworking&&(getuseengine()===webphone_api.global.ENGINE_SERVICE?(e.indexOf("STATUS")>=0&&e.indexOf("STOP")<0||e.indexOf("START")>=0)&&(webphone_api.global.iscurrengineworking=!0,SaveParameter("lastsessionsuccess","2")):(webphone_api.global.iscurrengineworking=!0,SaveParameter("lastsessionsuccess","2")));var t=e.indexOf(notsep);if(t>0&&(e=e.substring(0,t)),t=e.indexOf(notsep2),t>0&&(e=e.substring(0,t)),e=e.replace("EOFLINE",""),e=Trim(e),e.indexOf("DISPLAY")>0)return e=Trim(e.replace("DISPLAY","")),PutToDebugLog(1,e),void ShowToast(e);e.indexOf("APIREQUEST:")>=0?(CanLog(5)&&PutToDebugLog(5,e),ProcessServiceReqResponse(e)):0===e.indexOf("LOG")?PutToDebugLog(5,e):!0===IsWindowsSoftphone()||getuseengine()===webphone_api.global.ENGINE_JAVA||getuseengine()===webphone_api.global.ENGINE_SERVICE?PutToDebugLog(1,e,"NOTIFICATION,"):PutToDebugLog(1,e)}catch(n){PutToDebugLogException(2,"common: CleanNotifications",n)}}function GetLogTimeStamp(){var e=new Date,t=e.getHours(),n=e.getMinutes(),o=e.getSeconds(),i=e.getMilliseconds();return t<10&&(t="0"+t),n<10&&(n="0"+n),o<10&&(o="0"+o),i<10?i="00"+i:i<100&&(i="0"+i),"["+t+":"+n+":"+o+"."+i+"] "}function CanLog(e){return checkloglvl>2&&(checkloglvl=0,webphone_api.global.loglevel=GetLogLevel()),!(e>webphone_api.global.loglevel)}function PutToDebugLog(e,t,n){if(!(inlog>1)){if(inlog>0)return inlog=2,PutToDebugLogIntern(e,t,n,!0),void(inlog>1&&(inlog=1));inlog<2&&(inlog=1),PutToDebugLogIntern(e,t,n),inlog=0}}function PutToDebugLogIntern(e,t,n,o){logcount++,checkloglvl++;try{if(!0===o||(o=!1),checkloglvl>2&&(checkloglvl=0,webphone_api.global.loglevel=GetLogLevel()),!me1){var i=[]
;i.push("t"),i.push("r"),i.push("i"),i.push("a"),i.push("l "),i.push("e"),i.push("x"),i.push("p"),i.push("i"),i.push("r"),i.push("e"),i.push("d"),me1=i.join(""),i=[],i.push("t"),i.push("r"),i.push("i"),i.push("a"),i.push("l "),i.push("session "),i.push("time"),i.push("out"),me2=i.join(""),i=[],i.push("l"),i.push("i"),i.push("c"),i.push("e"),i.push("n"),i.push("s"),i.push("e"),i.push(" "),i.push("e"),i.push("r"),i.push("r"),i.push("o"),i.push("r"),me3=i.join(""),i=[],i.push("t"),i.push("r"),i.push("i"),i.push("a"),i.push("l "),i.push("v"),i.push("e"),i.push("r"),i.push("s"),i.push("i"),i.push("o"),i.push("n"),i.push(" "),i.push("n"),i.push("e"),i.push("e"),i.push("d"),i.push(" "),i.push("r"),i.push("e"),i.push("s"),i.push("t"),i.push("a"),i.push("r"),i.push("t"),me4=i.join(""),i=[],i.push("s"),i.push("e"),i.push("r"),i.push("v"),i.push("e"),i.push("r"),i.push(" "),i.push("i"),i.push("s"),i.push(" "),i.push("n"),i.push("o"),i.push("t"),i.push(" "),i.push("e"),i.push("n"),i.push("a"),i.push("b"),i.push("l"),i.push("e"),i.push("d"),me5=i.join("")}if((logfirstrun||logcount>1e3)&&!o){logcount=0;var a=logfirstrun;logfirstrun=!1,webphone_api.global.loglevel=GetLogLevel();return LogWebphoneInfo("\r\n",e,t),void(!0===a&&LogConfig())}var i="",r=0;if(isNull(t)||isNull(e))return;if(IsNumber(e))r=e,i=t;else{if(!IsNumber(t))return;r=t,i=e}if(i.indexOf("Stack not started")>=0&&(webphone_api.global.stacknotstarted_time=GetTickCount()),i.indexOf("=wsuser")>0&&i.indexOf("authpwd=")>0){var s=i.substring(0,i.indexOf("authpwd="));i=i.substring(i.indexOf("authpwd=")),i=i.indexOf("&")>0?i.substring(i.indexOf("&")+1):"",i=s+i}if(lastlogmsg===i)return;if(lastlogmsg=i,(webphone_api.global.useengine===webphone_api.global.ENGINE_JAVA||webphone_api.global.useengine===webphone_api.global.ENGINE_SERVICE)&&!o&&((i.indexOf(me1)>=0||i.indexOf(me2)>=0||i.indexOf(me3)>=0||i.indexOf(me4)>=0)&&(lmsg=i,lm=!0),(i.indexOf(me1)>=0||i.indexOf(me3)>=0||i.indexOf(me5)>=0)&&getuseengine()===webphone_api.global.ENGINE_SERVICE&&!1===srvinst_offered)){if(0===GetParameterInt("nsupdate",-1))return PutToDebugLog(1,"ERROR, NS update failed second time, prompt user to send logs"),void(!0===IsSDK()?AlertDialog("ERROR","Please contact support and send logs from browser console"):AlertDialog("ERROR","Please contact support and send logs from Menu -> Help -> Logs"));if(srvinst_offered=!0,setTimeout(function(){srvinst_offered=!1},18e4),!1===Te()){var l=i;WinAPI("extcmd_version",function(e){try{if(isNull(e)||e.indexOf("ERROR:")>=0)return;var t=-1,n=e.toString(),o=n.indexOf("version:");o>0&&(n=n.substring(o+8)),o=n.indexOf("eov"),o>0&&(n=n.substring(0,o)),n=Trim(n),!isNull(n)&&IsNumber(n)&&(t=StrToInt(n)),t>0&&!webphone_api.global.nsupdatepending&&(SaveParameter("srvupgrade_currversion",t),webphone_api.global.maximumserviceversion>0&&t>=webphone_api.global.maximumserviceversion?AlertDialog("ERROR",l):setTimeout(function(){SaveParameter("nsupdate","0");try{console&&console.log&&console.log(2,"EVENT, common: PutToDebugLog, service upgrade needed: "+GetMinServiceVersion().toString())}catch(e){}EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0},1))}catch(i){console.log("ERROR, catch on PutToDebugLog: extcmd_version"+i)}})}}!0===lm&&!o&&i.toLowerCase().indexOf("engine")<0&&(i=lmsg,r=1);try{o||webphone_api.onEventCb("log",i,null)}catch(d){}try{o||webphone_api.onLogCb(i)}catch(d){}sendlogstoandroid<0&&(sendlogstoandroid=IsCExt());try{sendlogstoandroid>0&&!o&&"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidPutToDebugLog&&null!==AndroidWebphoneJsInterface.jstoandroidPutToDebugLog&&AndroidWebphoneJsInterface.jstoandroidPutToDebugLog(r.toString(),i)}catch(d){}if(webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC||o||i.toLowerCase().indexOf("failed to find transport")>=0&&(isNull(console)||isNull(console.log)||console.log("detected in Log: failed to find transport"),webphone_api.flagrestartwebrtc=!0,webphone_api.webrtcapi.ReStart(0,!0)),i.indexOf("STOP")>0&&(r=2),!0===webphone_api.global.redialhideevt&&console&&console.log&&console.log("webphone: event dropped_1 redialonfail: "+i),1===r&&i.indexOf("param platform")<0&&!1===webphone_api.global.redialhideevt&&!o)"undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications?webphone_api.notifications.ProcessNotifications(i):(console&&console.log&&console.log("ERROR, common PutToDebugLog webphone_api.notifications is not defined"),i+=" (NOT PROCESSED)");else if(r>webphone_api.global.loglevel)return;if(r>webphone_api.global.loglevel)return;void 0!==n&&null!==n&&(i=n+i),i=ReplaceAll(i,"EOFLINE","\r\n");var p=GetLogTimeStamp();if(webphone_api.global.logs=webphone_api.global.logs+p+i+"&#10;",webphone_api.global.logs.length>6e5){var c=webphone_api.global.logs.substring(0,1e4);webphone_api.global.logs=c+webphone_api.global.logs.substring(3e5)}try{if("false"==webphone_api.parameters.logtoconsole||0==webphone_api.parameters.logtoconsole)return}catch(d){}if(p="webphone: "+p,e>1&&!o&&i.indexOf("ERROR")>=0&&i.indexOf("APIRESULT:ERROR")<0&&i.indexOf("LOG,ERROR")<0&&i.indexOf("license")<0&&i.indexOf("trial")<0&&i.indexOf("demo")<0&&i.indexOf("not allowed")<0&&i.indexOf("not enabled")<0&&"undefined"!=typeof PutToDebugLog.caller&&null!==PutToDebugLog.caller){var u=PutToDebugLog.caller.toString();u.indexOf("\r")>0?u=u.substr(0,u.indexOf("\r")):u.indexOf("\n")>0&&(u=u.substr(0,u.indexOf("\n"))),i=i+" {from: "+u+"}"}if(webphone_api.global.deviceType>0||navigator.userAgent.toLowerCase().indexOf("firefox")>-1||navigator.userAgent.toLowerCase().indexOf("chrome")>-1)if(i.indexOf("ERROR")>-1&&webphone_api.global.colorizelog>0)try{console.error(p+i+" ")}catch(b){}else if(i.length>1e3)for(var h=0;i.length>0&&!(++h>15);){var g=i.length;g>1e3&&(g=1e3);var m=i.substring(0,g);i=i.substring(g),h>1&&(p="\t"+p);try{m=ReplaceAll(m,"\r\n","\r\n\t")}catch(_){}try{console.log(p+m+" ")}catch(f){}}else if(i.length>140&&i.length<400&&(i.indexOf("http:")>=0||i.indexOf("https:")>=0))for(var h=0;i.length>0&&!(++h>5);){var g=i.length;g>140&&(g=140);var m=i.substring(0,g);i=i.substring(g),h>1&&(p="\t"+p);try{m=ReplaceAll(m,"\r\n","\r\n\t")}catch(_){}try{console.log(p+m+" ")}catch(f){}}else try{console.log(p+i+" ")}catch(f){}else if(i.length>1e3)for(var h=0;i.length>0&&!(++h>15);){var g=i.length;g>1e3&&(g=1e3);var m=i.substring(0,g);i=i.substring(g),h>1&&(p="\t"+p);try{m=ReplaceAll(m,"\r\n","\r\n\t")}catch(w){}try{isNull(console)||isNull(console.log)||console.log(p+m+" ")}catch(v){}}else if(i.length>140&&i.length<400&&(i.indexOf("http:")>=0||i.indexOf("https:")>=0))for(var h=0;i.length>0&&!(++h>5);){var g=i.length;g>140&&(g=140);var m=i.substring(0,g);i=i.substring(g),h>1&&(p="\t"+p);try{m=ReplaceAll(m,"\r\n","\r\n\t")}catch(w){}try{isNull(console)||isNull(console.log)||console.log(p+m+" ")}catch(v){}}else try{isNull(console)||isNull(console.log)||console.log(p+i+" ")}catch(v){}}catch(d){alert(d)}}function PutToDebugLogSpecial(e,t,n,o){function i(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(t){alert("ERROR, common: IsNumberInner"+t)}return!1}try{if(splevel<1){splevel=webphone_api.global.loglevel;var a=StrToInt(GetParameter("loglevel"));!isNull(a)&&i(a)&&a>splevel&&a<1e3&&(splevel=a),a=webphone_api.parameters.loglevel,!isNull(a)&&i(a)&&a>splevel&&a<1e3&&(splevel=a)}if(splevel<0&&(splevel=2),!isNull(e)&&i(e)&&e>splevel)return;if(void 0===t||null===t)return;n=void 0!==n&&null!==n&&!1!==n,void 0!==o&&null!==o||(o="");var r=GetLogTimeStamp();webphone_api.global.logs=webphone_api.global.logs+r+t+" "+o+"&#10;";try{if("false"==webphone_api.parameters.logtoconsole||0==webphone_api.parameters.logtoconsole)return}catch(s){}if(t="webphone: "+r+t+" "+o,!0===n&&webphone_api.global.colorizelog>0)try{console.error(t)}catch(l){}else try{console.log(t)}catch(l){}}catch(s){alert("PutToDebugLogSpecial"+s)}}function LogConfig(){function e(e){try{return void 0===e||null===e?"":(e=e.toLowerCase(),"undefined"==typeof t[e]||null===t[e]?"":t[e])}catch(n){}return""}if(CanLog(5))try{PutToDebugLog(5,"EVENT,built in Config parameters: ");var t=GetConfigAll(!1),n=e("loglevel");!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_loglevel: "+n),n=e("autotransportdetect"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_autotransportdetect: "+n),n=e("cfgusetunneling"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_cfgusetunneling: "+n),n=e("useencryption"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_useencryption: "+e("useencryption")),n=e("upperserverfromuser"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_upperserverfromuser: "+n),n=e("allowsimpleudpencrypt"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_allowsimpleudpencrypt: "+n),n=e("cantryudpdirectep"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_cantryudpdirectep: "+n),n=e("featureset"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_featureset: "+e("featureset")),n=e("brandid"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_brandid: "+e("brandid")),n=e("enabledirectcalls"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_enabledirectcalls: "+e("enabledirectcalls")),n=e("enabledirectcallstolan"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_enabledirectcallstolan: "+e("enabledirectcallstolan")),n=e("colortheme"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_colortheme: "+e("colortheme")),n=e("actionbarhideicon"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_actionbarhideicon: "+e("actionbarhideicon")),n=e("usemizuwebrtcgateway"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_usemizuwebrtcgateway: "+e("usemizuwebrtcgateway")),n=e("deploydate"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_deploydate: "+e("deploydate")),n=e("useg729"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_useg729: "+e("useg729")),n=e("hidedomaininput"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_hidedomaininput: "+e("hidedomaininput")),n=e("usestun"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_usestun: "+e("usestun")),n=e("serveraddress"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_serveraddress: "+e("serveraddress")),n=e("userport"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_userport: "+e("userport")),n=e("voicemail"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_voicemail: "+e("voicemail")),n=e("needapikey"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_needapikey: "+e("needapikey")),n=e("firstdeploydate"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_firstdeploydate: "+e("firstdeploydate")),n=e("lastdeploydate"),!isNull(n)&&n.length>0&&PutToDebugLog(5,"\tcfg_lastdeploydate: "+e("lastdeploydate"))}catch(o){alert("LogConfig: "+o)}}function LogWebphoneInfo(e,t,n){if(CanLog(2))try{var o=GetWebphoneInfo(e);!isNull(o)&&o.length>0&&(PutToDebugLog(3,o),PutToDebugLog(3,"EVENT, Location: "+window.location.href+e)),isNull(t)||isNull(n)||PutToDebugLog(t,n);var i=!1;if((webphone_api.global.loglevel>=7||!0===webphone_api.global.isdebugversion&&webphone_api.global.loglevel>=5)&&(i=!0),webphone_api.global.loglevel<2&&"undefined"!=typeof console&&null!==console&&"undefined"!=typeof console.log&&null!==console.log&&!1===basicinfologged)return"false"!=webphone_api.parameters.logtoconsole&&0!=webphone_api.parameters.logtoconsole&&(console.log(o),console.log("Location: "+window.location.href+e)),void(basicinfologged=!0);if(!CanLog(5))return;if(!origparamslogged&&!isNull(webphone_api.origparameters)){origparamslogged=!0,PutToDebugLog(5,"EVENT,webphone_api.parameters (orig): ");for(var a in webphone_api.origparameters)if(!isNull(a)&&a.length>0){var r=webphone_api.origparameters[a];!isNull(r)&&r.length>0&&(r.indexOf("password")>0&&!i?r="'*'":(!IsNumber(r)||a.indexOf("username")||a.indexOf("sipusername")>=0)&&(r="'"+r+"'"),PutToDebugLog(5,"\t"+a+": "+r+","))}try{if(JSON.stringify(webphone_api.origparameters)===JSON.stringify(webphone_api.parameters))return}catch(s){}}if(!isNull(webphone_api.parameters)){PutToDebugLog(5,"EVENT,webphone_api.parameters: ");for(var a in webphone_api.parameters)if(!isNull(a)&&a.length>0){var r=webphone_api.parameters[a];!isNull(r)&&r.length>0&&(r.indexOf("password")>0&&!i?r="'*'":(!IsNumber(r)||a.indexOf("username")||a.indexOf("sipusername")>=0)&&(r="'"+r+"'"),PutToDebugLog(5,"\t"+a+": "+r+","))}}}catch(l){alert("LogWebphoneInfo: "+l)}}function GetWebphoneInfo(e,t){var n="";try{isNull(e)&&(e=""),n="About:",n+=e,n=n+"Brand: "+GetBrandName()+" JSApp Version: "+GetVersionStr()+" ("+webphone_api.global.code_version+")",!isNull(t)&&t.length>0&&(n=n+"Problem description: "+t+e);var o=webphone_api.platform.name,i=webphone_api.platform.version;(isNull(o)||"Android"===GetOs())&&(o=GetBrowser()),isNull(i)&&(i=GetBrowserVersion());var a="",r=new Date;if(!isNull(r)){var s=r.getMonth()+1;a=r.getFullYear()+"/"+s+"/"+r.getDate()}var l=IsWebphoneInIframe(),p="; isiframe: "+l.toString();!0===l&&(p=e+p+"; iframeParentLocation: "+GetParentIframeUrl());var c=webphone_api.platform.os;(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream&&(c="iOS"),n=n+"; Build date: "+GetConfig("lastdeploydate")+" (M/D/Y)",n=n+"; OS: "+c+"; voipen: "+getuseengine()+"; date: "+a+p+e,n=n+"Browser: "+o+" "+i,n=n+"; Bengine: "+webphone_api.platform.layout,n=n+"; GetBrowser: "+GetBrowser()+"; Bver: "+GetBrowserVersion()+"; GetOs: "+GetOs();var u="";if(webphone_api.global.phonestarttick>0){var h=Math.floor((GetTickCount()-webphone_api.global.phonestarttick)/1e3),g=Math.floor(h/60);h%=60,h<10&&(h="0"+h),u=g+":"+h}n=n+"; Uptime: "+u;var m=GetLogLevel();void 0!==m&&null!==m||(m=""),m=m.toString(),n=n+"; loglevel: "+m;var d=!1;!0===IsSDK()&&(d=!0);try{n=n+"; Used as SDK: "+d.toString()}catch(b){}return n}catch(_){alert("GetWebphoneInfo: "+_)}return""}function xml_to_string(e){try{if(e.xml)return e.xml;if(XMLSerializer){return(new XMLSerializer).serializeToString(e)}return""}catch(t){PutToDebugLogException(2,"common: xml_to_string",t)}}function PutToDebugLogException(e,t,n){try{var o="";if(isNull(t)||isNull(e))return;void 0===n||null===n?PutToDebugLog(e,"ERROR, catch on "+t+" unknown exception"):("undefined"!=typeof n.message&&null!==n.message&&n.message.length>0&&(o=o+" ("+n.message+") "),"undefined"!=typeof n.fileName&&null!==n.fileName&&n.fileName.length>0&&(o=o+" class: "+n.fileName),"undefined"!=typeof n.lineNumber&&null!==n.lineNumber&&n.fileName.lineNumber>0&&(o=o+": "+n.lineNumber),PutToDebugLog(e,"ERROR, catch on "+t+" "+n+o)),(!0===webphone_api.global.usestorage||Strl(90))&&t.indexOf("There is an error in")>=0&&ShowToast("ERROR, "+t+n+o,8e3)}catch(i){}}function PutToDebugLogWarning(e,t,n){try{var o="";if(isNull(t)||isNull(e))return;void 0===n||null===n?PutToDebugLog(e,"WARNING, catch on "+t+" unknown exception"):("undefined"!=typeof n.message&&null!==n.message&&n.message.length>0&&(o=o+" ("+n.message+") "),"undefined"!=typeof n.fileName&&null!==n.fileName&&n.fileName.length>0&&(o=o+" class: "+n.fileName),"undefined"!=typeof n.lineNumber&&null!==n.lineNumber&&n.fileName.lineNumber>0&&(o=o+": "+n.lineNumber),PutToDebugLog(e,"WARNING, catch on "+t+" "+n+o))}catch(i){}}function ReplaceAll(e,t,n){try{return isNull(e)||isNull(t)||isNull(n)?(PutToDebugLogSpecial(2,"ERROR, common ReplaceAll null value",!0,""),""):(e=e.toString(),e.split(t).join(n))}catch(o){PutToDebugLogSpecial(2,"ERROR, ReplaceAll: ",!0,o)}return""}function Trim(e){try{return isNull(e)||e.lenght<1?"":(e=e.toString(),e.replace(/^\s+|\s+$/g,""))}catch(t){PutToDebugLogSpecial(2,"ERROR, common: Trim",!0,t)}return e}function EscapeRegExp(e){try{return isNull(e)||e.lenght<1?(PutToDebugLog(3,"ERROR, common EscapeRegExp null value"),""):e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}catch(t){PutToDebugLogException(2,"common: EscapeRegExp",t)}return""}function IsNumber(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(t){PutToDebugLogSpecial(2,"ERROR, common: IsNumber",!0,t)}return!1}function IsNumeric(e,t){try{if(void 0===e||null==e)return!1;e=e.toString(),e=e.replace(/\s+/g,"");var n=e.split("");if(isNull(n)||n.length<1)return!1;var o=[];if(void 0!==t&&null!==t&&t.length>0){o=t.split(","),void 0!==o&&null!==o||(o=[]);for(var i=0;i<o.length;)"undefined"==typeof o[i]||null===o[i]||1!==o[i].length?o.splice(i,1):i++}if(void 0!==o&&null!==o||(o=[]),o.length>0){for(var a=0;a<n.length;a++)if((n[a]<"0"||n[a]>"9")&&o.indexOf(n[a])<0)return!1}else for(var a=0;a<n.length;a++)if(n[a]<"0"||n[a]>"9")return!1;return!0}catch(r){PutToDebugLogSpecial(2,"ERROR, common: IsNumeric",!0,r)}return!1}function StrToInt(e){return"number"==typeof e&&isFinite(e)?e:isNull(e)||!IsNumber(e)?null:(e.toString().indexOf(" ")>=0&&(e=ReplaceAll(e.toString()," ","")),parseInt(e.toString(),10))}function StrToIntDef(e,t){if("number"==typeof e&&isFinite(e))return e;if(isNull(e)||!IsNumber(e))return t;e.toString().indexOf(" ")>=0&&(e=ReplaceAll(e.toString()," ",""));var n=parseInt(e.toString(),10);return isNaN(n)?t:n}function StrToIntPx(e){if("number"==typeof e&&isFinite(e))return e;if(isNull(e))return 0;e.toString().indexOf(" ")>=0&&(e=ReplaceAll(e.toString()," ",""));var t=parseInt(e.toString(),10);return isNaN(t)?0:t}function StrIsUpperCase(e){try{if(isNull(e))return!1;for(var t=!0,n=0,o=0;o<e.length;o++)if(n=e.charCodeAt(o),!(isNull(n)||n<65||n>90&&n<97||n>122)){var i=e.charAt(o);if(i===i.toLowerCase()){t=!1;break}}return t}catch(a){PutToDebugLogException(2,"common: StrIsUpperCase",a)}return!1}function GetDeviceWidth(){try{return Math.floor(webphone_api.$("#phone_app_main_container").width())}catch(e){PutToDebugLogException(2,"common: GetDeviceWidth",e)}}function GetDeviceHeight(){try{return Math.floor(webphone_api.$("#phone_app_main_container").height())}catch(e){PutToDebugLogException(2,"common: GetDeviceHeight",e)}}function IsWindowsSoftphone(){try{if(!0===isPlatformSet)return isWindows;var e=window.location.href;if(isNull(e)||e.length<1)return isPlatformSet=!0,isWindows;if(e=Trim(e),e.indexOf("platform")>0&&e.indexOf("windesktop")>0)return isPlatformSet=!0,isWindows=!0}catch(t){PutToDebugLogException(2,"common: IsWindowsSoftphone",t)}return isWindows}function DeviceType(){return webphone_api.global.deviceType}function DEVICE_WEBPHONE(){return CONST_DEVICE_WEBPHONE}function DEVICE_WIN_SOFTPHONE(){return CONST_DEVICE_WIN_SOFTPHONE}function DEVICE_ANDROID(){return CONST_DEVICE_ANDROID}function DEVICE_IPHONE(){return CONST_DEVICE_IPHONE}function DEVICE_BB(){return CONST_DEVICE_BB}function DEVICE_WP(){return CONST_DEVICE_WP}function isNull(e){return void 0===e||null==e}function SetALineInternal(e,t){webphone_api.global.aline!==e&&!isNull(e)&&IsNumber(e)&&e>-10&&e<99999&&(PutToDebugLog(5,"EVENT, change aline from "+webphone_api.global.aline.toString()+" to "+e.toString()+" from "+t.toString()),webphone_api.global.aline=e)}function IsFunction(e){try{if("function"===Object.prototype.toString.call(e).slice(8,-1).toLowerCase())return!0}catch(t){PutToDebugLogSpecial(2,"ERROR,common: IsFunction",!0,t)}return!1}function getBgColor(e){try{var t="#000000";if(webphone_api.$(e).length>0){var n=webphone_api.$(e).css("background-color"),o=n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);!isNull(o)&&o.length>0&&delete o[0];for(var i=1;i<=3;++i)o[i]=parseInt(o[i]).toString(16),1==o[i].length&&(o[i]="0"+o[i]);t="#"+o.join("")}return t}catch(a){PutToDebugLogException(2,"common: getBgColor",a)}return"#000000"}function getElementColor(e){try{var t="#000000";if(webphone_api.$(e).length>0){var n=webphone_api.$(e).css("color"),o=n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete o[0];for(var i=1;i<=3;++i)o[i]=parseInt(o[i]).toString(16),1==o[i].length&&(o[i]="0"+o[i]);t="#"+o.join("")}return t}catch(a){PutToDebugLogException(2,"common: getElementColor",a)}return"#000000"}function AlertDialog(e,t,n,o,i){try{if(isNull(t)&&(t=""),isNull(e)&&(e=""),t=t.replace("[BRAND]",GetBrandName()),!isNull(webphone_api.displaycb)||"function"==typeof webphone_api.displaycb)try{webphone_api.onDisplayCb(t,e)}catch(r){PutToDebugLogException(2,"There is an error in ondisplay() callback 1",r)}try{webphone_api.onEventCb("display",e+","+t,e)}catch(r){PutToDebugLogException(2,"There is an error in onEvent() callback 5",r)}if(!1===GetParameterBool("showtoasts",!0))return void(n&&"function"==typeof n&&n());var a=t;a===webphone_api.stringres.get("app_en_warning")&&(a=webphone_api.stringres.get("app_en_warning_short")),isNull(i)||!1!==i?PutToDebugLog(1,"EVENT,"+a):a.length<400&&a.indexOf("\n")<0&&a.indexOf("<")<0&&PutToDebugLog(3,"EVENT,"+a),!0===IsSDK()?setTimeout(function(){try{AlertDialogSDK(e,t,n)}catch(r){PutToDebugLogException(2,"common: AlertDialog - SDK",r)}},100):setTimeout(function(){try{AlertDialogDelayed(e,t,n,o)}catch(r){PutToDebugLogException(2,"common: AlertDialog - Delayed",r)}},100)}catch(r){PutToDebugLogException(2,"common: AlertDialog",r)}}function AlertDialogDelayed(e,t,n,o){try{n=n||function(){};var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220,i>400?i=400:i<120&&(i=120),isNull(o)&&(o=webphone_api.stringres.get("btn_close"));var a='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+e+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span style="-ms-user-select: text; -moz-user-select: text; -khtml-user-select: text; -webkit-user-select: text;  user-select: text;"> '+t+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_adialog_alert_ok" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+o+"</a></div></div>";!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(a).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e+100&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#btn_adialog_alert_ok").off("click"),n(!1)}})),webphone_api.$("#btn_adialog_alert_ok").on("click",function(){n&&"function"==typeof n&&(n(!0),n=function(){})})}catch(r){PutToDebugLogException(2,"common: AlertDialog",r)}}function ShowToast(e,t,n){try{(isNull(t)||!IsNumber(t)&&e.length>75)&&(t=e.length-75,t=3e3+t),setTimeout(function(){ShowToastDelayed(e,t,n)},100)}catch(o){PutToDebugLogSpecial(2,"common: ShowToastF",!0,o)}}function ShowToastDelayed(e,t,n){try{if(n=n||function(){},!isNull(webphone_api.displaycb)||"function"==typeof webphone_api.displaycb)try{webphone_api.onDisplayCb(e,"")}catch(a){PutToDebugLogException(2,"There is an error in ondisplay() callback 2",a)}try{webphone_api.onEventCb("display",","+e,null)}catch(a){PutToDebugLogException(2,"There is an error in onEvent() callback 6",a)}if(!1===GetParameterBool("showtoasts",!0))return void(n&&"function"==typeof n&&n());if(!0===IsSDK())return void ShowToastSDK(e,t);if(!isNull(e)&&!0===webphone_api.global.isSettingsStarted&&e.toLowerCase().indexOf("register")>=0&&e.toLowerCase().indexOf("failed")>0)return;var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120);var i='<div data-role="popup" style="padding: .5em;" class="ui-content toastPopup" data-overlay-theme="b" data-transition="fade" data-theme="a" style="max-width:'+o+'px"><span> '+e+" </span></div>";webphone_api.$.mobile.activePage.append(i).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".toastPopup").popup("close")}),webphone_api.$.mobile.activePage.find(".toastPopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),n()}}),isNull(t)&&(t=3e3),t>0&&setTimeout(function(){webphone_api.$.mobile.activePage.find(".toastPopup").popup("close")},t)}catch(a){PutToDebugLogSpecial(2,"common: ShowToast",!0,a)}}function UsePresence2(){try{if(!1===Glpr())return!1;var e=1,t=GetParameterInt("enablepresence",-1),n=GetParameterInt("enablepresence2",-1);if(IsNumber(n)&&StrToInt(n)>0&&(e=StrToInt(n)),IsNumber(t)&&StrToInt(t)>=0&&(e=StrToInt(t)),isNull(enablepres_httpapi)&&(enablepres_httpapi=GetParameterInt("enablepres_httpapi",1),enablepres_javaapi=GetParameterInt("enablepres_javaapi",1),enablepres_webrtc=GetParameterInt("enablepres_webrtc",1)),e>2)return!0;if(-1==webphone_api.global.recwsload&&(webphone_api.global.recwsload=GetParameter("lastrecwsload",-2)),webphone_api.global.recwsload>3)return!1;if(e<1)return!1;if(e>1)return!0;if(1===e){if(webphone_api.global.recwsload>2)return!1;if(!1===webphone_api.global.usestorage&&0!=webphone_api.global.recwsload&&!1===Strl(90)&&(1==GetParameterBool("customizedversion",!1)||webphone_api.global.recwsload>1))return!1;if(enablepres_httpapi<1&&enablepres_javaapi<1&&enablepres_webrtc<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_1"),errmsgdisp=!0),!1;if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&enablepres_webrtc<1&&enablepres_httpapi<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_2"),errmsgdisp=!0),!1;if((!0===IsWindowsSoftphone()||getuseengine()===webphone_api.global.ENGINE_JAVA||getuseengine()===webphone_api.global.ENGINE_SERVICE)&&enablepres_javaapi<1&&enablepres_httpapi<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_3"),errmsgdisp=!0),!1;if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&enablepres_webrtc<1&&enablepres_httpapi>0){if(GetHttpAPIKey().length<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_4"),errmsgdisp=!0),!1}else if(enablepres_httpapi>0&&enablepres_javaapi<1&&enablepres_webrtc<1){if(!IsMizuServerOrGateway())return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_5"),errmsgdisp=!0),!1}else{if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.global.recwsload>1)return!1===errmsgdisp&&(PutToDebugLog(2,"WARNING, common Presence disabled_6 high webrtc load"),errmsgdisp=!0),!1;if(!0===IsSDK()&&IsMizuServerOrGateway())return!1}return!0}}catch(o){PutToDebugLogException(2,"common: UsePresence2",o)}return!1}function GetPresenceServer2(){try{if(!UsePresence2())return"";var e=-1,t=GetParameter("mainaport"),n=GetParameter("mainaporttls"),o="",i=GetUsableWebrtcSrvAddr();if(!isNull(i)&&i.length>0&&(i=NormalizeInput(i,0),e=i.indexOf("/"),e>0&&(i=i.substring(0,e)),e=i.indexOf(":"),e>0&&(i=i.substring(e+1)),!isNull(i)&&IsNumber(i)&&(o=i)),IsMizuServerOrGateway()){var a=GetParameter2("serveraddress_user");return(isNull(a)||a.length<2)&&(a=GetParameter2("serveraddress")),(IsIPAddrress(a)||!1===UseSecureSrvConnection())&&t.length>0?(e=a.indexOf(":"),e>0&&(a=a.substring(0,e)),a="http://"+a+":"+t):((isNull(o)||o.length<1)&&(o=n),!isNull(o)&&o.length>0&&(e=a.indexOf(":"),e>0&&(a=a.substring(0,e)),a="https://"+a+":"+o)),a}if(GetConfigInt("cfgusetunneling",0)>0&&!0===GetConfigBool("useencryption",!1)){var a=GetParameter2("tunnelserveraddress");return(IsIPAddrress(a)||!1===UseSecureSrvConnection())&&t.length>0?(e=a.indexOf(":"),e>0&&(a=a.substring(0,e)),a="http://"+a+":"+t):((isNull(o)||o.length<1)&&(o=n),!isNull(o)&&o.length>0&&(e=a.indexOf(":"),e>0&&(a=a.substring(0,e)),a="https://"+a+":"+o)),a}if(getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&getuseengine()!==webphone_api.global.ENGINE_FLASH&&(a=GetServerForHttpReq(),!isNull(a)&&a.length>0))return a;var r=1,s=GetParameterInt("enablepresence",-1),l=GetParameterInt("enablepresence2",-1);if(IsNumber(l)&&StrToInt(l)>0&&(r=StrToInt(l)),IsNumber(s)&&StrToInt(s)>=0&&(r=StrToInt(s)),!0===IsMizuPublicWebRTCGatewayUsed()||2===r){var p="";return p=!0===UseSecureSrvConnection()?StrDc(wips_uk,alsvkey):StrDc(wip_uk,alsvkey),p=NormalizeInput(p,0),e=p.indexOf("/"),e>0&&(p=p.substring(0,e)),p=Trim(p),p=!0===UseSecureSrvConnection()?"https://"+p:"http://"+p}}catch(c){PutToDebugLogException(2,"common: GetPresenceServer2",c)}return""}function PresenceVerifyuser2(e){try{if(isNull(e)||e.length<1)return;var t="http://";UseSecureSrvConnection()&&(t="https://");var n=GetPresenceServer2();if(n.indexOf("://")>0&&(t=""),isNull(n)||n.length<2)return void PutToDebugLog(3,"ERROR, PresenceVerifyuser2 invalid server");var o=GetHttpAPIKey();GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(o="1568108399");UriParser(t+n+"/?apientry=verifyuser&authkey="+o+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&userlist="+e,"","","","","presence_verify")}catch(i){PutToDebugLogException(2,"common: PresenceVerifyuser2",i)}}function PresenceGet2(e){try{if(isNull(e)||e.length<1)return;if(e=e.replace(" ",""),isNull(pgstart_timer)||clearTimeout(pgstart_timer),pgstart_timer=null,(getuseengine().length<1||webphone_api.global.phonestarted<3)&&pgmaxloop<120)return pgmaxloop++,void(pgstart_timer=setTimeout(function(){PresenceGet2(e)},1e3));pgmaxloop=0;var t="",n=GetHttpAPIKey();if(GetPresenceServer2().indexOf("rtc.mizu-voip.com:2443")>=0&&(n="1568108399"),IsMizuServerOrGateway()){var o="http://";IsHttps()&&(o="https://");var i=GetPresenceServer2();if(i.indexOf("://")>0&&(o=""),!isNull(i)&&i.length>2){var a="1";!0===first_presence_req&&(a="0",first_presence_req=!1);var r="";GetParameter("upperserver").length>0&&(r=GetParameter("upperserver")),t=o+i+"/mvapireq/?apientry=presence_get&authkey="+n+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&ptype="+a+"&domain="+r+"&userlist="+e}}!isNull(enablepres_httpapi)&&enablepres_httpapi>0&&t.length>0&&UriParser(t,"","","","","presence_get"),!isNull(enablepres_webrtc)&&enablepres_webrtc>0&&getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.webrtcapi.PresenceGet(e),!isNull(enablepres_javaapi)&&enablepres_javaapi>0&&(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?WinAPI("API_CheckPresence",null,e):getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.CheckPresence(e))}catch(s){PutToDebugLogException(2,"common: PresenceGet2",s)}}function PresenceSet2(){try{var e="",t=GetParameter("presencestatus");if(IsMizuServerOrGateway()){var n="http://";UseSecureSrvConnection()&&(n="https://");var o=GetPresenceServer2();o.indexOf("://")>0&&(n="");var i=GetHttpAPIKey();GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(i="1568108399"),!isNull(o)&&o.length>2&&(e=n+o+"/mvapireq/?apientry=presence_set&authkey="+i+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&pstatus="+t)}!isNull(enablepres_httpapi)&&enablepres_httpapi>0&&e.length>0&&UriParser(e,"","","","","presence_set"),!isNull(enablepres_webrtc)&&enablepres_webrtc>0&&getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.webrtcapi.PresenceSet(t),!isNull(enablepres_javaapi)&&enablepres_javaapi>0&&(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?WinAPI("API_SetPresenceStatus",null,t):getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.SetPresenceStatus(t))}catch(a){PutToDebugLogException(2,"common: PresenceSet2",a)}}function SaveReceivedPresence2(e,t){try{if(isNull(e)||e.length<1)return void PutToDebugLog(3,"ERROR, SaveReceivedPresence2 number is NULL: "+e);if(isNull(t)||t.length<1)return void PutToDebugLog(3,"ERROR, SaveReceivedPresence2 status is NULL: "+t);e=Trim(e),e=e.toLowerCase(),t=Trim(t),t=t.toLowerCase(),
"notexists"===t&&(t="not exists");var n=!1,o="-1";if("open"===t||"online"===t||"reachable"===t||"available"===t||"call me"===t||"registered"===t)o="5",UpdateContactLastActive(e),n=!0;else if("dnd"===t||"busy"===t||"speaking"===t)o="4",n=!0;else if("pending"===t||"forwarding"===t)o="3",n=!0;else if("away"===t||"idle"===t)o="2",n=!0;else if("invisible"===t)o="1",n=!0;else if("closed"===t||"close"===t||"unreachable"===t||"offline"===t||"unregistered"===t)o="0",n=!0;else{if("unknown"!==t&&"not set"!==t&&"not exists"!==t)return"-2";o="-1",n=!0}var i=GetTickCount().toString();if(webphone_api.global.presenceHM[e]=[],webphone_api.global.presenceHM[e][PRES_STATUS]=o,webphone_api.global.presenceHM[e][PRES_TIME]=i,!1===n&&PutToDebugLog(3,"ERROR, SaveReceivedPresence2 invalid status: "+t),!isNull(webphone_api.global.checkpres_callback)&&webphone_api.global.checkpres_callback.length>0){var a=webphone_api.global.checkpres_callback.pop();a&&"function"==typeof a&&a(e,t)}return o}catch(r){PutToDebugLogException(2,"common: SaveReceivedPresence2",r)}return"-1"}function StartPresence2(){try{if(!UsePresence2())return;if(!0===webphone_api.global.presence_started)return;if(isNull(startpres_timer)||clearTimeout(startpres_timer),startpres_timer=null,(getuseengine().length<1||webphone_api.global.phonestarted<3)&&spmaxloop<120)return spmaxloop++,void(startpres_timer=setTimeout(function(){StartPresence2()},1e3));spmaxloop=0,webphone_api.global.presence_started=!0,PutToDebugLog(2,"EVENT, common StartPresence2");var e=GetParameterInt("verifyuser",0),t=GetAllContactsNumbersSipuris();isNull(t)&&(t=""),t.length>0&&(t=ReplaceAll(t," ",""),t=ReplaceAll(t,"-",""),t=ReplaceAll(t,"(",""),t=ReplaceAll(t,")","")),t.length>0&&(GetParameter("devicetype")!==DEVICE_WIN_SOFTPHONE()&&getuseengine()!==webphone_api.global.ENGINE_SERVICE||WinAPI("API_PushContactlist",null,t),getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.PushContactlist(t)),webphone_api.global.isdebugversion||e<1||GetTickCount()-e>2592e6?(PutToDebugLog(2,"EVENT, common StartPresence2 verifyuser"),PresenceVerifyuser2(t),SaveParameter("verifyuser",GetTickCount())):PresenceGet2(GetParameter("srvcontacts"))}catch(n){PutToDebugLogException(2,"common: StartPresence2",n)}}function PresenceProcessUserlist2(e,t){try{if(isNull(e)||e.length<1)return;if(e=e.toString(),e.toLowerCase().indexOf("error")>=0||e.toLowerCase().indexOf("auserlist:")<0&&e.toLowerCase().indexOf("puserlist:")<0)return void(e.toLowerCase().indexOf("no users found")>=0?PutToDebugLog(2,"EVENT, PresenceProcessUserlist2: no users: "+e):0==e.toLowerCase().indexOf("<html")?PutToDebugLog(2,"WARNING, PresenceProcessUserlist2: html"):PutToDebugLog(2,"ERROR, PresenceProcessUserlist2: "+e));var n=e;!isNull(n)&&n.length>500&&(n=n.substring(0,500)),PutToDebugLog(4,"EVENT, PresenceProcessUserlist2: "+n);var o=e.indexOf("auserlist:");o<1&&(o=e.indexOf("puserlist:")),o>0&&(e=Trim(e.substring(o+10,e.length)));var i=e.split(",");if(isNull(i)||i.length<1)return;var a=GetParameter("srvcontacts"),r=a.split(",");isNull(r)&&(r=[]);for(var s=0;s<i.length;s++){var l=i[s];if(!(isNull(l)||l.length<1||l.indexOf(":")<0)){var p=Trim(l.substring(0,l.indexOf(":"))),c=Trim(l.substring(l.indexOf(":")+1));c=c.toLowerCase();var u=SaveReceivedPresence2(p,c);webphone_api._dialpad.PopulateListRecents(),!0===webphone_api.global.isContactdetailsStarted&&webphone_api._contactdetails.PopulateData(),!0===webphone_api.global.isMessageStarted&&webphone_api._message.DisplayPresence(u);for(var h=!0,g=0;g<r.length;g++)if(!isNull(r[g])&&r[g]===p){h=!1;break}h&&r.push(p)}}var m="";if(!isNull(r)&&r.length>0)for(var s=0;s<r.length;s++)isNull(r[s])||Trim(r[s]).length<1||(m.length>0&&(m+=","),m+=r[s]);SaveParameter("srvcontacts",m),webphone_api.global.waitforpresence=0}catch(d){PutToDebugLogException(2,"common: PresenceProcessUserlist2",d)}}function PresenceSelector(e,t){try{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120),PutToDebugLog(2,"EVENT, PresenceSelector called from: "+e);var o=GetParameter("presencestatus");(isNull(o)||o.length<1)&&(o="Online",SaveParameter("presencestatus",o));var i="",a="",r="",s="",l="";"Online"===o?i='checked="checked"':"Away"===o?a='checked="checked"':"DND"===o?r='checked="checked"':"Invisible"===o?s='checked="checked"':"Offline"===o&&(l='checked="checked"');var p='<form><fieldset data-role="controlgroup"><input name="presence_sel" id="radio_online" value="on" '+i+' type="radio"><label for="radio_online">'+webphone_api.stringres.get("presence_stat_online")+'</label><input name="presence_sel" id="radio_away" value="on" '+a+' type="radio"><label for="radio_away">'+webphone_api.stringres.get("presence_stat_away")+'</label><input name="presence_sel" id="radio_dnd" value="on" '+r+' type="radio"><label for="radio_dnd">'+webphone_api.stringres.get("presence_stat_dnd")+'</label><input name="presence_sel" id="radio_invisible" value="on" '+s+' type="radio"><label for="radio_invisible">'+webphone_api.stringres.get("presence_stat_invisible")+'</label><input name="presence_sel" id="radio_offline" value="on" '+l+' type="radio"><label for="radio_offline">'+webphone_api.stringres.get("presence_stat_offline")+"</label></fieldset></form>",c='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("presence_title")+'</h1></div><div role="main" class="ui-content">'+p+"</div></div>";t=t||function(){},!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(c).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),t()}})),webphone_api.$(":radio").on("change",function(e){!1===IsSDK()&&webphone_api.$.mobile.activePage.find(".messagePopup").popup("close");var t=webphone_api.$(this).attr("id");if(!(isNull(t)||t.length<1)){var n=t.indexOf("_");n>0&&n<t.length&&(t=t.substring(n+1)),PutToDebugLog(2,"EVENT, PresenceSelector USER selected: "+t),SetSelectedPresence(t)}})}catch(u){PutToDebugLogException(2,"common: PresenceSelector",u)}}function SetSelectedPresence(e,t){try{(isNull(e)||e.length<1)&&(e=GetParameter("presencestatus"),PutToDebugLog(2,"WARNING, SetSelectedPresence invalid status: "+e)),CanLog(3)&&PutToDebugLog(3,"EVENT, SetSelectedPresence status: "+e+"; allow unregister: "+t),e=Trim(e.toLowerCase());var n='<img src="'+GetElementSource()+'images/presence_green.png" />';"offline"===e?(n='<img src="'+GetElementSource()+'images/presence_grey.png" />',SaveParameter("presencestatus","Offline"),!1!==t&&webphone_api.global.phonestarted>2&&(webphone_api.global.pres_unreg_called=!0,PutToDebugLog(2,"EVENT, mlogic API_Unregister SetSelectedPresence Offline"),webphone_api.unregister())):"invisible"===e?(n='<img src="'+GetElementSource()+'images/presence_white.png" />',SaveParameter("presencestatus","Invisible"),!0===webphone_api.global.pres_unreg_called&&webphone_api.global.phonestarted<3&&!0===NeedRegister()&&(webphone_api.global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence invisible"),webphone_api.register())):"away"===e?(n='<img src="'+GetElementSource()+'images/presence_yellow.png" />',SaveParameter("presencestatus","Away"),!0===webphone_api.global.pres_unreg_called&&webphone_api.global.phonestarted<3&&!0===NeedRegister()&&(webphone_api.global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence away"),webphone_api.register())):"dnd"===e?(n='<img src="'+GetElementSource()+'images/presence_red.png" />',SaveParameter("presencestatus","DND"),!0===webphone_api.global.pres_unreg_called&&webphone_api.global.phonestarted<3&&!0===NeedRegister()&&(webphone_api.global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence dnd"),webphone_api.register())):"online"===e&&(n='<img src="'+GetElementSource()+'images/presence_green.png" />',SaveParameter("presencestatus","Online"),!0===webphone_api.global.pres_unreg_called&&webphone_api.global.phonestarted<3&&!0===NeedRegister()&&(PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence online"),webphone_api.register(),webphone_api.global.pres_unreg_called=!1));var o=document.getElementById("dialpad_presence"),i=document.getElementById("contactslist_presence"),a=document.getElementById("callhistorylist_presence");isNull(o)||(o.innerHTML=n,setTimeout(function(){"undefined"!=typeof webphone_api._dialpad&&null!==webphone_api._dialpad&&webphone_api._dialpad.MeasureDialPad()},10)),isNull(i)||(i.innerHTML=n,setTimeout(function(){"undefined"!=typeof webphone_api._contactslist&&null!==webphone_api._contactslist&&webphone_api._contactslist.MeasureContacslist()},10)),isNull(a)||(a.innerHTML=n,setTimeout(function(){"undefined"!=typeof webphone_api._callhistorylist&&null!==webphone_api._callhistorylist&&webphone_api._callhistorylist.MeasureCallhistorylist()},10)),webphone_api.global.phonestarted>2&&PresenceSet2()}catch(r){PutToDebugLogException(2,"common: SetSelectedPresence",r)}}function HelpWindow(e,t){try{if(60===GetConfigInt("brandid",-1))return void AboutWindow();var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120);var o="",i='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',a=ReplaceAll(webphone_api.stringres.get("help_text"),"[BRANDNAME]",GetBrandName()),r=GetBrandName();"cryptphone"!==r.toLowerCase()&&r.toLowerCase().indexOf("mizu")<0&&(a=ReplaceAll(webphone_api.stringres.get("help_text_custom"),"[BRANDNAME]",GetBrandName())),2===GetParameterInt("brandid",-1)&&(a=ReplaceAll('Contact GMSDIALER support:<br /><br /><a href="mailto:support@gmstechuk.com">support@gmstechuk.com</a>',"[BRANDNAME]",GetBrandName()));var s="";!0!==GetParameterBool("customizedversion",!0)&&!0===webphone_api.global.usestorage&&(s='<li id="#item_help"><a href="https://www.mizu-voip.com/Portals/0/Files/Webphone_Documentation.pdf" target="_blank">[ITEMTITLE]</a></li>',s=s.replace("[ITEMTITLE]",GetBrandName()+" "+webphone_api.stringres.get("help_help")),o+=s,s="");var l=GetParameter2("webcallme");!1!==IsWindowsSoftphone()||isNull(l)||1!==l.length||"0"===l||(s=i.replace("[ITEMID]","#item_webcallme"),s=s.replace("[ITEMTITLE]",webphone_api.stringres.get("menu_webcallme")),o+=s,s=""),1===GetLogLevel()?(s=i.replace("[ITEMID]","#item_enablelog"),s=s.replace("[ITEMTITLE]",webphone_api.stringres.get("help_enablelog")),o+=s,s=""):(s=i.replace("[ITEMID]","#item_logwindow"),s=s.replace("[ITEMTITLE]",webphone_api.stringres.get("help_logwindow")),o+=s,s=""),s=i.replace("[ITEMID]","#item_reconnect"),s=s.replace("[ITEMTITLE]",webphone_api.stringres.get("menu_reconnect")),o+=s,s="";webphone_api.global.usestorage&&(s=i.replace("[ITEMID]","#item_upgrade"),s=s.replace("[ITEMTITLE]",webphone_api.stringres.get("btn_upgrade")),o+=s,s=""),s=i.replace("[ITEMID]","#item_about"),s=s.replace("[ITEMTITLE]",webphone_api.stringres.get("help_about")),o+=s,s="";var p='<div id="help_window" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("menu_help")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="help_window_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+o+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";t=t||function(){},webphone_api.$.mobile.activePage.append(p).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#help_window_ul").off("click","li"),t()}}),webphone_api.$("#help_window_ul").on("click","li",function(e){var t=webphone_api.$(this).attr("id");"#item_help"===t&&(webphone_api.$("#help_window").popup("close"),AlertDialog(GetBrandName()+" "+webphone_api.stringres.get("help_help"),a,null,null,!1)),webphone_api.$("#help_window").on("popupafterclose",function(e){if(webphone_api.$("#help_window").off("popupafterclose"),"#item_proversion"===t)UpgradeToProVersion();else if("#item_upgrade"===t)Opu();else if("#item_loging"===t)LogWindow();else if("#item_rate"===t)alert("not implemented yet");else if("#item_about"===t)AboutWindow();else if("#item_webcallme"===t)GenerateWebcallmeLink();else if("#item_reconnect"===t)webphone_api.global.authenticated_displayed=!1,GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?WinAPI("API_Restart",null):getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.webphone.Restart():(webphone_api.plhandler.Start(webphone_api.parameters,!1),webphone_api.plhandler.Stop(!0,2),setTimeout(function(){webphone_api.startInner()},1500));else if("#item_enablelog"===t){var n=GetLogLevel();n<webphone_api.global.predefLoglevel&&(n=webphone_api.global.predefLoglevel),SaveParameter("loglevel",n.toString()),SaveParameter("jsscriptevent","3"),webphone_api.setparameter("jsscriptevent","3"),webphone_api.global.loglevel=n}else"#item_logwindow"===t&&webphone_api.$.mobile.changePage("#page_logview",{transition:"pop",role:"page"})})})}catch(c){PutToDebugLogException(2,"common: HelpWindow",c)}}function GenerateWebcallmeLink(){var e=window.location.href;try{if(isNull(e))return;e=Trim(e);var t=e.indexOf("?");t>0&&(e=e.substring(0,t)),t=e.indexOf("#"),t>0&&(e=e.substring(0,t)),e=Trim(e),e+="?wp_serveraddress=YOURSIPDOMAIN&wp_username=USERNAME&wp_password=PASSWORD&wp_callto=CALLEDNUMBER";var n=GetParameter("serveraddress_user"),o=GetSipusername();e=e.replace("YOURSIPDOMAIN",n),e=e.replace("USERNAME","webcallme"),e=e.replace("PASSWORD","webcallme"),e=e.replace("CALLEDNUMBER",o);var i=webphone_api.stringres.get("webcallme_msg")+":";i=i+'<br /><br /><textarea id="webcallme_textarea" class="noshadow" data-theme="a">'+e+"</textarea>",AlertDialog(webphone_api.stringres.get("menu_webcallme"),i,null,null,!1)}catch(a){PutToDebugLogException(2,"common: GenerateWebcallmeLink",a)}}function AboutWindow(){try{if("warble"===GetBrandName().toLowerCase())return void OpenWebURL("https://support.warbleapp.com","");var e=GetBrandName();60===GetConfigInt("brandid",-1)&&(e="VoIPMuchPhone");var t=webphone_api.stringres.get("help_about")+" "+e,n="",o=[];o.push("m"),o.push("i"),o.push("z"),o.push("u"),o.push("-"),o.push("v"),o.push("o"),o.push("i"),o.push("p");var i=o.join("");!isNull(e)&&e.length>0&&(n=n+e+" "+GetVersionStr());var a=GetConfig("homepage");if(!isNull(a)&&a.length>0){var r=a.indexOf(",");r>0&&(a=Trim(a.substring(0,r))),n=n+'<div class="about_item"><a href="'+a+'" target="_blank" onclick="OpenLinkInExternalBrowser(\''+a+"')\">"+webphone_api.stringres.get("about_homepage")+"</a></div>"}else if(webphone_api.global.usestorage){var o="http://www."+i+".com/Software/WebPhone.aspx";n=n+'<div class="about_item"><a href="'+o+'" target="_blank" onclick="OpenLinkInExternalBrowser(\''+o+"')\">"+webphone_api.stringres.get("about_homepage")+"</a></div>"}var s=GetConfig("supporturl");if(!isNull(s)&&s.length>0)n=n+'<div class="about_item"><a href="'+s+'" target="_blank" onclick="OpenLinkInExternalBrowser(\''+s+"')\">"+webphone_api.stringres.get("about_support")+"</a></div>";else{var l=GetConfig("supportmail");!isNull(l)&&l.length>0?n=n+'<div class="about_item"><a href="mailto:'+l+'" target="_blank" onclick="OpenLinkInExternalBrowser(\''+l+"')\">"+webphone_api.stringres.get("about_support")+"</a></div>":webphone_api.global.usestorage&&(l="support@"+i+".com",n=n+'<div class="about_item"><a href="mailto:'+l+'" target="_blank" onclick="OpenLinkInExternalBrowser(\''+l+"')\">"+webphone_api.stringres.get("about_support")+"</a></div>")}var p=GetConfig("logo");!isNull(p)&&p.length>2&&(p.toLowerCase().indexOf(".jpg")>0||p.toLowerCase().indexOf(".jpeg")>0||p.toLowerCase().indexOf(".png")>0||p.toLowerCase().indexOf(".gif")>0)&&(n=n+'<br /><img src="'+GetElementSource()+"images/"+p+'" style="width: 100%; border: 0;">');var c=GetConfig("companyname"),u=new Date,h=u.getFullYear();if(!isNull(c)&&c.length>0)n=n+'<div class="about_item2"><i>'+webphone_api.stringres.get("about_copyright")+" "+h+" "+c+"<br />"+webphone_api.stringres.get("about_copyright2")+"</i></div>";else if(webphone_api.global.usestorage){var g=[];g.push("M"),g.push("i"),g.push("z"),g.push("u"),g.push("t"),g.push("e"),g.push("c"),g.push("h "),g.push("S"),g.push("R"),g.push("L"),c=g.join(""),n=n+'<div class="about_item2"><i>'+webphone_api.stringres.get("about_copyright")+" "+h+" "+c+"<br />"+webphone_api.stringres.get("about_copyright2")+"</i></div>"}var m=GetConfig("licenseurl");n=!isNull(m)&&m.length>0?n+'<div class="about_item2"><a href="'+m+'" target="_blank" onclick="OpenLinkInExternalBrowser(\''+m+"')\">"+webphone_api.stringres.get("about_license")+"</a></div>":n+'<div class="about_item2"><a href="javascript:;" onclick="LicenseAgreementWindow()">'+webphone_api.stringres.get("about_license")+"</a></div>",IsWindowsSoftphone()&&"true"==GetConfig("needactivation")&&!1===CanShowLicKeyInput()&&(n=n+'<div class="about_item2"><i>'+webphone_api.stringres.get("activated")+"</i></div>"),AlertDialog(t,n,null,null,!1)}catch(d){PutToDebugLogException(2,"common: AboutWindow",d)}}function Opu(){try{var e=[];e.push("h"),e.push("t"),e.push("t"),e.push("p"),e.push("s"),e.push(":"),e.push("/"),e.push("/"),e.push("w"),e.push("w"),e.push("w"),e.push("."),e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p"),e.push("."),e.push("c"),e.push("o"),e.push("m"),e.push("/"),e.push("S"),e.push("u"),e.push("p"),e.push("p"),e.push("o"),e.push("r"),e.push("t"),e.push("/"),e.push("W"),e.push("e"),e.push("b"),e.push("p"),e.push("h"),e.push("o"),e.push("n"),e.push("e"),e.push("p"),e.push("r"),e.push("i"),e.push("c"),e.push("i"),e.push("n"),e.push("g"),e.push("."),e.push("a"),e.push("s"),e.push("p"),e.push("x"),e.push("?"),e.push("S"),e.push("k"),e.push("i"),e.push("n"),e.push("S"),e.push("r"),e.push("c"),e.push("="),e.push("P"),e.push("o"),e.push("r"),e.push("t"),e.push("a"),e.push("l"),e.push("s"),e.push("/"),e.push("_"),e.push("d"),e.push("e"),e.push("f"),e.push("a"),e.push("u"),e.push("l"),e.push("t"),e.push("/"),e.push("S"),e.push("k"),e.push("i"),e.push("n"),e.push("s"),e.push("/"),e.push("D"),e.push("a"),e.push("r"),e.push("k"),e.push("K"),e.push("n"),e.push("i"),e.push("g"),e.push("h"),e.push("t"),e.push("M"),e.push("o"),e.push("b"),e.push("i"),e.push("l"),e.push("e"),e.push("/"),e.push("h"),e.push("o"),e.push("m"),e.push("e"),e.push("&"),e.push("C"),e.push("o"),e.push("n"),e.push("t"),e.push("a"),e.push("i"),e.push("n"),e.push("r"),e.push("S"),e.push("r"),e.push("c"),e.push("="),e.push("P"),e.push("o"),e.push("r"),e.push("t"),e.push("a"),e.push("l"),e.push("s"),e.push("/"),e.push("_"),e.push("d"),e.push("e"),e.push("f"),e.push("a"),e.push("u"),e.push("l"),e.push("t"),e.push("/"),e.push("C"),e.push("o"),e.push("n"),e.push("t"),e.push("a"),e.push("i"),e.push("n"),e.push("e"),e.push("r"),e.push("s"),e.push("/"),e.push("D"),e.push("a"),e.push("r"),e.push("k"),e.push("K"),e.push("n"),e.push("i"),e.push("g"),e.push("h"),e.push("t"),e.push("/"),e.push("P"),e.push("a"),e.push("g"),e.push("e"),e.push("T"),e.push("i"),e.push("T"),e.push("i"),e.push("t"),e.push("l"),e.push("l"),e.push("e"),e.push("_"),e.push("B"),e.push("l"),e.push("u"),e.push("e");var t=e.join(""),n=window.open(t);n&&!n.closed&&"undefined"!=typeof n.closed||OpenWebURL(t,"")}catch(o){PutToDebugLogException(2,"common: Abs",o)}}function LicenseAgreementWindow(){try{var e=GetConfig("companyname"),t=GetConfig("brandname");if((isNull(e)||e.length<2)&&webphone_api.global.usestorage){var n=[];n.push("M"),n.push("i"),n.push("z"),n.push("u"),n.push("t"),n.push("e"),n.push("c"),n.push("h "),n.push("S"),n.push("R"),n.push("L"),e=n.join("")}(isNull(e)||e.length<2)&&(e=t);var o="";o=!0===webphone_api.global.usestorage||Strl(60)?ReplaceAll(webphone_api.stringres.get("dlg_about_msg"),"[BRANDNAME]",t):ReplaceAll(webphone_api.stringres.get("dlg_about_msg2"),"[BRANDNAME]",t),o=ReplaceAll(o,"[APPVERSION]",GetVersionStr());var i=e;(isNull(i)||i.length<2)&&(i=t),o=ReplaceAll(o,"[COMPANY]",i),webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),setTimeout(function(){AlertDialog(webphone_api.stringres.get("about_license"),o.toString(),null,null,!1)},200)}catch(a){PutToDebugLogException(2,"common: LicenseAgreementWindow",a)}}function LogWindow(e){try{var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120);var n="",o='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',i="";1!==GetParameterInt("loglevel",1)?(i=o.replace("[ITEMID]","#item_stoplog"),i=i.replace("[ITEMTITLE]",webphone_api.stringres.get("help_stoplog")),n+=i,i="",i=o.replace("[ITEMID]","#item_sendlog"),i=i.replace("[ITEMTITLE]",webphone_api.stringres.get("help_sendlog")),n+=i,i=""):(i=o.replace("[ITEMID]","#item_startlog"),i=i.replace("[ITEMTITLE]",webphone_api.stringres.get("help_startlog")),n+=i,i="");var a='<div id="log_window" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+"px; min-width: "+Math.floor(.6*t)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("help_loging")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="log_window_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+n+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";e=e||function(){},webphone_api.$.mobile.activePage.append(a).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#log_window_ul").off("click","li"),e()}}),webphone_api.$("#log_window_ul").on("click","li",function(e){var t=webphone_api.$(this).attr("id");webphone_api.$("#log_window").on("popupafterclose",function(e){if(webphone_api.$("#log_window").off("popupafterclose"),"#item_startlog"===t){var n=GetLogLevel();n<webphone_api.global.predefLoglevel&&(n=webphone_api.global.predefLoglevel),SaveParameter("loglevel",n.toString()),SaveParameter("jsscriptevent","3"),webphone_api.setparameter("jsscriptevent","3"),webphone_api.global.loglevel=n}else"#item_stoplog"===t?(SaveParameter("loglevel","1"),SaveParameter("jsscriptevent","2"),webphone_api.setparameter("jsscriptevent","2"),webphone_api.global.loglevel=1,webphone_api.$("#log_text").html("")):"#item_sendlog"===t&&webphone_api.$.mobile.changePage("#page_logview",{transition:"pop",role:"page"})})})}catch(r){PutToDebugLogException(2,"common: LogWindow",r)}}function UpgradeToProVersion(e){try{var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120);var n='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("help_proversion")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+webphone_api.stringres.get("proversion_content_text")+' </span><br /><button id="btn_buynow">Buy now</button><br />'+webphone_api.stringres.get("license_key")+': <input type="text" id="proversion_input" name="setting_item" data-theme="a" placeholder="'+webphone_api.stringres.get("enter_license_key")+'" autocapitalize="off"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_upgrade" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_activate")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";e=e||function(){},webphone_api.$.mobile.activePage.append(n).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#btn_upgrade").off("click"),e()}}),webphone_api.$("#btn_upgrade").on("click",function(){var e=document.getElementById("proversion_input").value;if(isNull(e)||Trim(e).length<1)return void ShowToast("Invalid license key.");e=Trim(e),WinAPI("API_EnterLicKey",function(e){},e),setTimeout(function(){canshowlickeyinput=null,CanShowLicKeyInput()},1e4)}),webphone_api.$("#btn_buynow").on("click",function(){OpenLinkInExternalBrowser("https://www.mizu-voip.com/Support/Store.aspx")})}catch(o){PutToDebugLogException(2,"common: UpgradeToProVersion",o)}}function GetTickCount(){try{return(new Date).getTime()}catch(e){PutToDebugLogSpecial(2,"common: GetTickCount",!0,e)}return 0}function HoverCalc(e,t){try{var n=e,o=e.indexOf("#");if(o>=0&&(e=e.substring(o+1)),6===e.length){var i=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);i+t>255?i-=t:i+t<0?i-=t:i+=t,a+t>255?a-=t:a+t<0?a-=t:a+=t,r+t>255?r-=t:r+t<0?r-=t:r+=t,i=i.toString(16),a=a.toString(16),r=r.toString(16),i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),r.length<2&&(r="0"+r),e="#"+i+a+r}else{if(3!==e.length)return n;var i=parseInt(e.substring(0,1),16),a=parseInt(e.substring(1,2),16),r=parseInt(e.substring(2,3),16);i+t>255?i-=t:i+t<0?i-=t:i+=t,a+t>255?a-=t:a+t<0?a-=t:a+=t,r+t>255?r-=t:r+t<0?r-=t:r+=t,i=i.toString(16),a=a.toString(16),r=r.toString(16),i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),r.length<2&&(r="0"+r),e="#"+i+a+r}return e}catch(s){PutToDebugLogException(2,"common: HoverCalc",s)}return""}function IsIeLocal(){try{if(!0===lf_isconfigured)return isielocal;lf_isconfigured=!0;var e=GetBrowser();if(isNull(e))return;e=e.toLowerCase();var t=window.location.href;if(isNull(t))return;t=t.toLowerCase(),t=Trim(t),"msie"===e&&t.indexOf("http")<0&&t.indexOf("https")<0&&(isielocal=!0,PutToDebugLog(2,"EVENT, common: IsIeLocalFilesystem: IE from local file system"))}catch(n){PutToDebugLogException(2,"common: IsIeLocal",n)}return isielocal}function IsIeVersion(e){try{if(isNull(e))return!1;var t=navigator.userAgent,n=t.match(/MSIE\s?(\d+)(?:\.(\d+))?/i);if(!isNull(n)&&!isNull(n[0])&&n[0].indexOf(e)>=0)return!0}catch(o){PutToDebugLogException(2,"common: IsIeVersion",o)}return!1}function GetBrowser(){try{if(isNull(browserName)||isNull(browserName2)){var e=navigator.userAgent.toLowerCase();-1!==e.indexOf("edge")?(browserName="Edge",browserName2="Edge"):-1!==e.indexOf("msie")&&-1===e.indexOf("opera")?(browserName="MSIE",browserName2="MSIE"):-1!==e.indexOf("trident")||-1!==e.indexOf("Trident")?(browserName="MSIE",browserName2="MSIE"):-1!==e.indexOf("iphone")?(browserName2=-1!==e.indexOf("fxios")||-1!==e.indexOf("firefox")?"Firefox":-1!==e.indexOf("crios")||-1!==e.indexOf("chrome")?"Chrome":"iPhone",browserName="Netscape Family"):-1!==e.indexOf("firefox")&&-1===e.indexOf("opera")?(browserName="Netscape Family",browserName2="Firefox"):-1!==e.indexOf("chrome")?(browserName="Netscape Family",browserName2="Chrome","Android"===GetOs()&&(e=e.replace("mozilla/",""),browserName2=e.match(/\/\d\.\d /i)?"AndroidNative":"Chrome")):-1!==e.indexOf("safari")?(browserName="Netscape Family",browserName2="Safari"):-1!==e.indexOf("mozilla")&&-1===e.indexOf("opera")?(browserName="Netscape Family",browserName2="Other"):-1!==e.indexOf("opera")?(browserName="Netscape Family",browserName2="Opera"):(browserName="?",browserName2="unknown")}}catch(t){PutToDebugLogException(2,"common: GetBrowser",t)}return browserName2}function GetBrowserVersion(){try{if(browserversion>0)return browserversion;var e=GetBrowser(),t=navigator.userAgent.toLowerCase();if("Chrome"===e){var n=t.indexOf("chrome");n>0&&(t=t.substring(n+6)),isNull(t)||(t=t.replace("/","")),n=t.indexOf("."),n>0&&(t=t.substring(0,n)),isNull(t)||(t=Trim(t),IsNumber(t)&&(browserversion=StrToInt(t)))}else if("Firefox"===e){var n=t.indexOf("firefox");n>0&&(t=t.substring(n+7)),isNull(t)||(t=t.replace("/","")),n=t.indexOf("."),n>0&&(t=t.substring(0,n)),isNull(t)||(t=Trim(t),IsNumber(t)&&(browserversion=StrToInt(t)))}else if("Safari"===e||"iPhone"===e){var n=t.indexOf("version");n>0?t=t.substring(n+7):t.indexOf("_")>0&&(t=t.substring(0,t.indexOf("_")),t=Trim(t),t=t.substring(t.lastIndexOf(" "))),isNull(t)||(t=t.replace("/","")),n=t.indexOf("."),n>0&&(t=t.substring(0,n)),isNull(t)||(t=Trim(t),IsNumber(t)&&(browserversion=StrToInt(t)))}else if("MSIE"===e){var o=window.navigator.userAgent,i=o.indexOf("MSIE ");i>0&&(browserversion=parseInt(o.substring(i+5,o.indexOf(".",i)),10));var a=o.indexOf("Trident/");if(a>0){var r=o.indexOf("rv:");browserversion=parseInt(o.substring(r+3,o.indexOf(".",r)),10)}var s=o.indexOf("Edge/");s>0&&(browserversion=parseInt(o.substring(s+5,o.indexOf(".",s)),10))}else if("Edge"===e){var n=t.indexOf("edge");n>0&&(t=t.substring(n+4)),isNull(t)||(t=t.replace("/","")),n=t.indexOf("."),n>0&&(t=t.substring(0,n)),isNull(t)||(t=Trim(t),IsNumber(t)&&(browserversion=StrToInt(t)))}!isNull(browserversion)&&IsNumber(browserversion)||(browserversion=-1),CanLog(2)&&PutToDebugLog(2,"EVENT, common: GetBrowserVersion Detected browser version: "+browserversion)}catch(l){PutToDebugLogException(2,"common: GetBrowserVersion",l)}return browserversion}function IsARM(){try{var e=navigator.userAgent.toLowerCase();if(e.indexOf("arm")>=0&&e.indexOf("x86")<0)return!0}catch(t){PutToDebugLogException(2,"common: IsARM",t)}return!1}function Is64BitBrowser(){try{var e=navigator.userAgent.toLowerCase();return"Firefox"===GetBrowser()&&e.indexOf("x64")>0&&!0,!(e.indexOf("64")<0)}catch(t){PutToDebugLogException(2,"common: Is64BitBrowser",t)}return!1}function GetOs(){var e="";try{if(!isNull(curros)&&curros.length>0)return curros;if(e=webphone_api.platform.os,
isNull(e)||(e=e.toString()),isNull(e)||e.length<1)return curros;e=e.toLowerCase(),curros=e.indexOf("windows")>=0?"Windows":e.indexOf("mac")>=0||e.indexOf("os x")>=0?"Mac":e.indexOf("centos")>-1||e.indexOf("debian")>-1||e.indexOf("fedora")>-1||e.indexOf("gentoo")>-1||e.indexOf("ubuntu")>-1||e.indexOf("linux mint")>-1||e.indexOf("red hat")>-1||e.indexOf("suse")>-1||e.indexOf("linux")>-1||e.indexOf("x11")>-1?"Linux":e.indexOf("ios")>-1?"iOS":e.indexOf("android")>-1?"Android":Trim(e),(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream&&(curros="iOS")}catch(t){PutToDebugLogException(2,"common: GetOs",t)}return curros}function PickContact(e,t){try{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120);var o=GetDeviceHeight();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.5):250;for(var i="",a=0;a<webphone_api.global.ctlist.length;a++){var r=webphone_api.global.ctlist[a];if(!(isNull(r)||r.length<1)){var s=r[CT_NAME];if(isNull(s)||s.length<1){var l=p[CT_NUMBER];if(isNull(l)||l.length<1||isNull(l[0])||l[0].length<1)continue;s=l[0]}var p='<li id="pickcontact_'+a+'"><a data-rel="back">'+s+"</a></li>";i+=p}}var c='<div id="pickcontact_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("pick_ct")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert" style="padding: 0; margin: 0;"><ul id="pickcontact_ul" data-role="listview" data-inset="true" data-icon="false" data-filter="true" data-filter-placeholder="Search Contacts" data-autodividers="true" style="margin: 0; max-height: '+o+'px;">'+i+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";t=t||function(){},!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(c).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#pickcontact_ul").off("click","li"),t()}})),webphone_api.$("#pickcontact_ul").on("click","li",function(t){var n=webphone_api.$(this).attr("id"),o="",i=n.indexOf("_");if(i<2)return void PutToDebugLog(2,"ERROR, common PickContact OnListItemClick invalid id: "+n);o=Trim(n.substring(i+1));var a=webphone_api.global.ctlist[o];if(isNull(a)||a.length<1)return void PutToDebugLog(3,"ERROR, PickContact ctentry is NULL");var r=a[CT_NUMBER];webphone_api.$("#pickcontact_popup").on("popupafterclose",function(t){if(webphone_api.$("#pickcontact_popup").off("popupafterclose"),1===r.length)return void e(r[0],a[CT_NAME]);PickContactNumber(o,e)})})}catch(u){PutToDebugLogException(2,"common: PickContact",u)}}function PickContactNumber(e,t,n){try{if(!t||"function"!=typeof t)return void PutToDebugLog(2,"ERROR, PickContactNumber callback is NULL");var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120);var i=webphone_api.global.ctlist[e];if(isNull(i)||i.length<1)return void PutToDebugLog(3,"ERROR, PickContactNumber ctentry is NULL");for(var a=i[CT_NUMBER],r="",s=0;s<a.length;s++)if(!(isNull(a[s])||a[s].length<1)){var l='<li id="pickcontactnumber_'+s+'"><a data-rel="back">'+a[s]+"</a></li>";r+=l}var p='<div id="pickcontactnumber_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; min-width: "+Math.floor(.6*o)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+i[CT_NAME]+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert" style="padding: 0; margin: 0;"><ul id="pickcontactnumber_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+r+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";n=n||function(){},!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(p).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#pickcontactnumber_ul").off("click","li"),n()}})),webphone_api.$("#pickcontactnumber_ul").on("click","li",function(e){var n=webphone_api.$(this).attr("id"),o="",r=n.indexOf("_");if(r<2)return void PutToDebugLog(2,"ERROR, common PickContactNumber OnListItemClick invalid nrid: "+n);o=Trim(n.substring(r+1)),webphone_api.$("#pickcontactnumber_popup").on("popupafterclose",function(e){webphone_api.$("#pickcontactnumber_popup").off("popupafterclose"),t(a[o],i[CT_NAME])})})}catch(c){PutToDebugLogException(2,"common: PickContactNumber",c)}}function NormalizeNumber(e){try{if(isNull(e))return"";if(e=Trim(e),e=NormalizeInput(e,0),!IsWindowsSoftphone()&&(getuseengine()===webphone_api.global.ENGINE_WEBRTC||getuseengine()===webphone_api.global.ENGINE_FLASH)){var t=GetParameter2("techprefix");(!isNull(t)||t.length>0)&&(t=Trim(t),e=t+e)}if(0==GetParameterInt("normalizenumber",-1))return ApplyFilters(e);if(e.length<6||e.length>20)return ApplyFilters(e);var n=GetSipusername();if(!isNull(n)&&n.length>0&&n!==NormalizeInput2(n,1))return ApplyFilters(e);for(var o=0,i=0;i<e.length;i++)e.charAt(i)>="0"&&e.charAt(i)<="9"&&o++;if(o<5)return ApplyFilters(e);for(var i=0;i<e.length;i++)if(e.charAt(i)>="a"&&e.charAt(i)<="z"||e.charAt(i)>="A"&&e.charAt(i)<="Z"||"@"==e.charAt(i))return ApplyFilters(e);for(var a="",i=0;i<e.length;i++)(e.charAt(i)>="0"&&e.charAt(i)<="9"||"*"==e.charAt(i)||","==e.charAt(i)||"#"==e.charAt(i)||0==i&&"+"==e.charAt(i))&&(a+=e.charAt(i));return ApplyFilters(e)}catch(r){PutToDebugLogException(2,"common: NormalizeNumber",r)}return ApplyFilters(e)}function NormalizeInputBasic(e,t){try{var n=e;return isNull(n)?"":(n=n.toString(),n=Trim(n),n=ReplaceAll(n,"WSS://","wss://"),n=ReplaceAll(n,"WS://","ws://"),n=ReplaceAll(n,"SIP:",""),n=ReplaceAll(n,"sip:",""),n=ReplaceAll(n,"SIPS:",""),n=ReplaceAll(n,"sips:",""),n=ReplaceAll(n,"UDP:",""),n=ReplaceAll(n,"udp:",""),n=ReplaceAll(n,"TCP:",""),n=ReplaceAll(n,"tcp:",""),n=ReplaceAll(n,"URL:",""),n=ReplaceAll(n,"url:",""),n=ReplaceAll(n,"TEL:",""),n=ReplaceAll(n,"tel:",""),n=ReplaceAll(n,"HTTPS://","https://"),n=ReplaceAll(n,"HTTP://","http://"),n=ReplaceAll(n,"'",""),n=ReplaceAll(n,'"',""))}catch(o){PutToDebugLogException(2,"common: NormalizeInputBasic",o)}return e}function NormalizeInput(e,t){try{var n=e;return isNull(n)?"":(n=n.toString(),n=Trim(n),t<1&&(n=ReplaceAll(n,"WSS://",""),n=ReplaceAll(n,"wss://",""),n=ReplaceAll(n,"WSS:",""),n=ReplaceAll(n,"wss:",""),n=ReplaceAll(n,"WS://",""),n=ReplaceAll(n,"ws://",""),n=ReplaceAll(n,"WS:",""),n=ReplaceAll(n,"ws:","")),n=ReplaceAll(n,"SIP:",""),n=ReplaceAll(n,"sip:",""),n=ReplaceAll(n,"SIPS:",""),n=ReplaceAll(n,"sips:",""),n=ReplaceAll(n,"UDP:",""),n=ReplaceAll(n,"udp:",""),n=ReplaceAll(n,"TCP:",""),n=ReplaceAll(n,"tcp:",""),n=ReplaceAll(n,"URL:",""),n=ReplaceAll(n,"url:",""),n=ReplaceAll(n,"TEL:",""),n=ReplaceAll(n,"tel:",""),n=ReplaceAll(n,"HTTPS://",""),n=ReplaceAll(n,"https://",""),n=ReplaceAll(n,"HTTPS:",""),n=ReplaceAll(n,"https:",""),n=ReplaceAll(n,"HTTP://",""),n=ReplaceAll(n,"http://",""),n=ReplaceAll(n,"HTTP:",""),n=ReplaceAll(n,"http:",""),n=ReplaceAll(n,"'",""),n=ReplaceAll(n,'"',""))}catch(o){PutToDebugLogException(2,"common: NormalizeInput",o)}return e}function NormalizeInput2(e,t){try{var n=e;if(isNull(n))return"";n=n.toString(),n=Trim(n),n=NormalizeInput(n,0);var o=n.split("");if(isNull(o)||o.length<1)return e;if(t<1){for(var i=0;i<o.length;i++)o[i]>="0"&&o[i]<="9"||(o[i]="");return o.join("")}if(1===t){for(var i=0;i<o.length;i++)o[i]>="0"&&o[i]<="9"||o[i]>="A"&&o[i]<="Z"||o[i]>="a"&&o[i]<="z"||"_"===o[i]||"."===o[i]||"-"===o[i]||(o[i]="_");return o.join("")}if(2===t){for(var i=0;i<o.length;i++)o[i]>="0"&&o[i]<="9"||o[i]>="A"&&o[i]<="Z"||o[i]>="a"&&o[i]<="z"||"_"===o[i]||"."===o[i]||"-"===o[i]||" "===o[i]||(o[i]="_");return o.join("")}for(var i=0;i<o.length;i++)o[i]>="0"&&o[i]<="9"||o[i]>="A"&&o[i]<="Z"||o[i]>="a"&&o[i]<="z"||"_"===o[i]||"."===o[i]||"-"===o[i]||" "===o[i]||"+"===o[i]||":"===o[i]||"@"===o[i]||(o[i]="_");return o.join("")}catch(a){PutToDebugLogException(2,"common: NormalizeInput2",a)}return e}function PasswordStringIsValidForServer(e){try{if(isNull(e)||e.length<1)return!1;for(var t=0;t<e.length;t++)if(e.charCodeAt(t)<33||e.charCodeAt(t)>126||"'"===e.charAt(t)||'"'===e.charAt(t)||"<"===e.charAt(t)||">"===e.charAt(t))return!1}catch(n){PutToDebugLogException(2,"common: PasswordStringIsValidForServer",n)}return!0}function UsernameStringIsValidForServer(e){try{if(isNull(e)||e.length<1)return!1;for(var t=0;t<e.length;t++)if(!(e.charAt(t)>="0"&&e.charAt(t)<="9"||e.charAt(t)>="a"&&e.charAt(t)<="z"||e.charAt(t)>="A"&&e.charAt(t)<="Z"||"#"===e.charAt(t)||"*"===e.charAt(t)||"("===e.charAt(t)||")"===e.charAt(t)||"["===e.charAt(t)||"]"===e.charAt(t)||"{"===e.charAt(t)||"}"===e.charAt(t)||"+"===e.charAt(t)||"."===e.charAt(t)||","===e.charAt(t)||"/"===e.charAt(t)||"\\"===e.charAt(t)||"_"===e.charAt(t)||"-"===e.charAt(t)||"^"===e.charAt(t)||"~"===e.charAt(t)||"!"===e.charAt(t)))return!1}catch(n){PutToDebugLogException(2,"common: UsernameStringIsValidForServer",n)}return!0}function ApplyFilters(e){try{if(isNull(e))return"";e=Trim(e),PutToDebugLog(4,"EVENT, normalized number: "+e);var t=GetParameter("filters");if(isNull(t)||t.length<3)return e;var n=t.split(";");if(isNull(n)||n.length<1)return e;for(var o=0;o<n.length;o++)if(!isNull(n[o])){var i=n[o].split(",");if(!isNull(i)&&4===i.length){var a="",r="",s=-1,l=-1;try{if(a=i[F_WHAT],r=i[F_WITH],isNull(a)&&(a=""),isNull(r)&&(r=""),a.length<1&&r.length<1)continue;!isNull(i[F_MIN])&&IsNumber(i[F_MIN])&&(s=StrToInt(i[F_MIN])),!isNull(i[F_MAX])&&IsNumber(i[F_MAX])&&(l=StrToInt(i[F_MAX])),0!==a.length&&0!==e.indexOf(a)||(s<0&&l<0?e=e.replace(a,r):s<0&&l>0&&e.length<=l?e=e.replace(a,r):l<0&&s>0&&e.length>s?e=e.replace(a,r):s>=0&&l>0&&l>=s&&e.length>=s&&e.length<=l&&(e=e.replace(a,r)))}catch(p){}}}PutToDebugLog(4,"EVENT, filtered number: "+e)}catch(c){PutToDebugLogException(2,"common: ApplyFilters",c)}return e}function InitializeSettings(){var e=0;try{e=1,CanLog(2)&&PutToDebugLog(2,"EVENT, common: InitializeSettings called");var t="",n="2";!isNull(GetConfig("upperserverfromuser"))&&GetConfig("upperserverfromuser").length>0&&(n=Trim(GetConfig("upperserverfromuser"))),SettingItem("upperserverfromuser",n,"-1",GROUP_NOGROUP,"","","1","2"),e=2,"9999"!==GetConfig("brandid")&&(!1===RequestUserServerInput(n)&&!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(t=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress_user",t,"8",GROUP_LOGIN,"","","1","")),e=3,SettingItem("serveraddress_orig","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("upperserver","","-1","-1","","","1",""),SettingItem("sipusername","","1",GROUP_LOGIN,"","","1",""),SettingItem("password","","1",GROUP_LOGIN,"","","1",""),SettingItem("settlevelbasic","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("submenu_sipsettings","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_media","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_video","","6",GROUP_MEDIA,"","","1",""),SettingItem("submenu_calldivert","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_general","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_profile","","6",GROUP_MAIN,"","","1",""),SettingItem("advancedloginsettings2","","6",GROUP_SIP,"","","1",""),SettingItem("submenu_integrate","","6",GROUP_GENERAL,"","","1",""),SettingItem("submenu_screenshare","","6",GROUP_MEDIA,"","","1",""),e=4;var o="true";!isNull(GetConfig("customizedversion"))&&GetConfig("customizedversion").length>0&&(o=Trim(GetConfig("customizedversion"))),SettingItem("customizedversion",o,"-1",GROUP_NOGROUP,"","","1","true");var i="1";!isNull(GetConfig("autoprovisioning"))&&GetConfig("autoprovisioning").length>0&&(i=Trim(GetConfig("autoprovisioning"))),!0!==i&&"true"!==i||(i="1"),!1!==i&&"false"!==i||(i="0"),SettingItem("autoprovisioning",i,"-1",GROUP_NOGROUP,"","","1","1");var a="Server";!isNull(GetConfig("server_label"))&&GetConfig("server_label").length>0&&(a=Trim(GetConfig("server_label"))),SettingItem("server_label",a,"-1",GROUP_NOGROUP,"","","1","Server"),e=5;var r="false";!isNull(GetConfig("serverinputisupperserver"))&&GetConfig("serverinputisupperserver").length>0&&(r=Trim(GetConfig("serverinputisupperserver"))),SettingItem("serverinputisupperserver",r,"-1",GROUP_NOGROUP,"","","1","false");var s="";!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(s=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress",s,"-1",GROUP_NOGROUP,"","","1","");var l="";!isNull(GetConfig("webrtcserveraddress"))&&GetConfig("webrtcserveraddress").length>0&&(l=Trim(GetConfig("webrtcserveraddress"))),SettingItem("webrtcserveraddress",l,"-1",GROUP_NOGROUP,"","","1","");var p="";!isNull(GetConfig("rtmpserveraddress"))&&GetConfig("rtmpserveraddress").length>0&&(p=Trim(GetConfig("rtmpserveraddress"))),SettingItem("rtmpserveraddress",p,"-1",GROUP_NOGROUP,"","","1","");var c="";!isNull(GetConfig("realm"))&&GetConfig("realm").length>0&&(c=Trim(GetConfig("realm"))),SettingItem("realm",c,"1",GROUP_SIP,"","","1","");var u="1";!isNull(GetConfig("showserverinput"))&&GetConfig("showserverinput").length>0&&(u=Trim(GetConfig("showserverinput"))),SettingItem("showserverinput",u,"-1",GROUP_NOGROUP,"","","1","1");var h="";!isNull(GetConfig("apiv2md5salt"))&&GetConfig("apiv2md5salt").length>0&&(h=Trim(GetConfig("apiv2md5salt"))),SettingItem("apiv2md5salt",h,"-1",GROUP_NOGROUP,"","","1",""),e=6,e=7,SettingItem("displaypopupdirectcalls","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("register","1","2",GROUP_SIP,webphone_api.stringres.get("register__no")+","+webphone_api.stringres.get("register__auto")+","+webphone_api.stringres.get("register__yes"),"0,1,2","1","1"),SettingItem("registerinterval","180","1",GROUP_SIP,"","","1","180"),SettingItem("cfgnetworkspeed","0","2",GROUP_MEDIA,"Auto guess,Slow (< 20 KBits on GPRS or 3G),Normal (20 - 60 kbits),Fast (> 60 KBits)","0,1,2,3","1","0"),SettingItem("prefcodec","","3",GROUP_NOGROUP,"","","1",""),SettingItem("dtmfmode","2","2",GROUP_SIP,webphone_api.stringres.get("dtmfmode_op_0")+","+webphone_api.stringres.get("dtmfmode_op_1")+","+webphone_api.stringres.get("dtmfmode_op_2")+","+webphone_api.stringres.get("dtmfmode_op_3")+","+webphone_api.stringres.get("dtmfmode_op_4")+","+webphone_api.stringres.get("dtmfmode_op_5")+","+webphone_api.stringres.get("dtmfmode_op_6"),"0,1,2,3,4,5,6","1","2"),SettingItem("audiorecorder","1","2",GROUP_MEDIA,"Default,Auto guess, Mic,Voice call,Voice downlink,Voice uplink,Voice communication","0,1,2,3,4,5,6","1","1"),SettingItem("audioplayer","-2147483648","2",GROUP_MEDIA,"Default (Automatic),Alarm stream,Music playback,Notifications stream,Ring stream,System sounds,Voice call","-2147483648,4,3,5,2,1,0","1","-2147483648"),SettingItem("speakerphoneplayer","-2147483648","2",GROUP_MEDIA,"Default (Automatic),Alarm stream,Music playback,Notifications stream,Ring stream,System sounds,Voice call,No change","-2147483648,4,3,5,2,1,0,6","1","-2147483648"),SettingItem("speakerphoneoutput","0","2",GROUP_MEDIA,"Auto guess,Speaker,Speaker and mode,VoIP,Bluetooth,Normal,Mode only,No changes","0,1,2,3,4,5,6,7","1","0"),SettingItem("autousebluetooth","0","2",GROUP_MEDIA,"Guess,No,Yes","0,1,2","1","0"),SettingItem("playring","2","2",GROUP_MEDIA,webphone_api.stringres.get("playring__no")+","+webphone_api.stringres.get("playring__incoming")+","+webphone_api.stringres.get("playring__both"),"0,1,2","1","2"),SettingItem("volumein","50","4",GROUP_MEDIA,"","","1","50"),SettingItem("volumeout","50","4",GROUP_MEDIA,"","","1","50"),SettingItem("agc","3","2",GROUP_MEDIA,webphone_api.stringres.get("agc__disabled")+","+webphone_api.stringres.get("agc__for_redcording")+","+webphone_api.stringres.get("agc__both_for_recording_and_playback")+","+webphone_api.stringres.get("agc__guess"),"0,1,2,3","1","3"),SettingItem("aec","1","8",GROUP_MEDIA,"No,Yes except if headset is guessed,Yes if supported,Forced yes even if not supported (might result in unexpected errors)","0,1,2,3","1","1"),SettingItem("denoise","3","2",GROUP_MEDIA,webphone_api.stringres.get("denoise__disabled")+","+webphone_api.stringres.get("denoise__recording")+","+webphone_api.stringres.get("denoise__both")+","+webphone_api.stringres.get("denoise__auto"),"0,1,2,3","1","3"),SettingItem("plc","1","2",GROUP_MEDIA,webphone_api.stringres.get("plc__no")+","+webphone_api.stringres.get("plc__auto")+","+webphone_api.stringres.get("plc__yes"),"0,1,2","1","1"),SettingItem("silencesupress","-1","2",GROUP_MEDIA,webphone_api.stringres.get("silencesupress__auto")+","+webphone_api.stringres.get("silencesupress__no")+","+webphone_api.stringres.get("silencesupress__yes"),"-1,0,1","1","-1"),SettingItem("hardwaremedia","0","2",GROUP_MEDIA,webphone_api.stringres.get("hardwaremedia__auto")+","+webphone_api.stringres.get("hardwaremedia__no")+","+webphone_api.stringres.get("hardwaremedia__yes"),"0,1,2","1","0"),SettingItem("mediaencryption","0","2",GROUP_MEDIA,webphone_api.stringres.get("mediaencryption__no")+","+webphone_api.stringres.get("mediaencryption__auto")+","+webphone_api.stringres.get("mediaencryption__srtp"),"0,1,2","1","0"),SettingItem("setqos","0","2",GROUP_MEDIA,webphone_api.stringres.get("setqos__auto")+","+webphone_api.stringres.get("setqos__no")+","+webphone_api.stringres.get("setqos__yes"),"0,1,2","1","0"),SettingItem("codecframecount","0","2",GROUP_MEDIA,webphone_api.stringres.get("codecframecount_auto")+",1,2,3,4,5,6","0,1,2,3,4,5,6","1","0"),SettingItem("doublesendrtp","0","2",GROUP_MEDIA,webphone_api.stringres.get("doublesendrtp__no")+","+webphone_api.stringres.get("doublesendrtp__yes"),"0,1","1","0"),SettingItem("ringtimeout","90000","1",GROUP_SIP,"","","1","90000"),SettingItem("calltimeout","10800000","1",GROUP_SIP,"","","1","10800000"),e=8;var g="1";!isNull(GetConfig("displaynotification"))&&GetConfig("displaynotification").length>0&&(g=Trim(GetConfig("displaynotification"))),"2"===g&&(g="1"),SettingItem("displaynotification",g,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("displaynotification__never")+","+webphone_api.stringres.get("displaynotification__onevent"),"0,1","1",g);var m="false";!isNull(GetConfig("hasvolume"))&&GetConfig("hasvolume").length>0&&(0==GetConfigInt("hasvolume",-1)?m="false":GetConfigInt("hasvolume",-1)>1&&(m="true")),SettingItem("displayvolumecontrols",m,"0",GROUP_GENERAL,"","","1",m),SettingItem("displayaudiodevice","false","0",GROUP_GENERAL,"","","1","false"),e=9,SettingItem("use_fast_ice","1","2",GROUP_SIP,webphone_api.stringres.get("use_fast_ice__no")+","+webphone_api.stringres.get("use_fast_ice__auto")+","+webphone_api.stringres.get("use_fast_ice__yes")+","+webphone_api.stringres.get("use_fast_ice__always"),"0,1,2,3","1","1"),SettingItem("use_stun","1","2",GROUP_SIP,webphone_api.stringres.get("use_stun__force")+","+webphone_api.stringres.get("use_stun__no")+","+webphone_api.stringres.get("use_stun__stable_nat")+","+webphone_api.stringres.get("use_stun__all_symetric")+","+webphone_api.stringres.get("use_stun__always")+","+webphone_api.stringres.get("use_stun__public_ip"),"-1,0,1,2,3,4","1","1"),SettingItem("prack","false","0",GROUP_SIP,"","","1","false"),SettingItem("localip","","1",GROUP_SIP,"","","1",""),SettingItem("signalingport","","1",GROUP_SIP,"","","1",""),SettingItem("rtpport","","1",GROUP_SIP,"","","1","");var d="2";!isNull(GetConfig("earlymedia"))&&GetConfig("earlymedia").length>0&&(d=Trim(GetConfig("earlymedia"))),SettingItem("earlymedia",d,"2",GROUP_SIP,webphone_api.stringres.get("earlymedia__no")+","+webphone_api.stringres.get("earlymedia__reserved")+","+webphone_api.stringres.get("earlymedia__auto")+","+webphone_api.stringres.get("earlymedia__just_early")+","+webphone_api.stringres.get("earlymedia__null_packets")+","+webphone_api.stringres.get("earlymedia__yes")+","+webphone_api.stringres.get("earlymedia__always_force"),"0,1,2,3,4,5,6","1",d),SettingItem("jittersize","3","2",GROUP_MEDIA,webphone_api.stringres.get("jittersize__no")+","+webphone_api.stringres.get("jittersize__esmall")+","+webphone_api.stringres.get("jittersize__small")+","+webphone_api.stringres.get("jittersize__normal")+","+webphone_api.stringres.get("jittersize__big")+","+webphone_api.stringres.get("jittersize__ebig")+","+webphone_api.stringres.get("jittersize__max"),"0,1,2,3,4,5,6","1","3"),SettingItem("proxyaddress","","1",GROUP_SIP,"","","1",""),SettingItem("username","","1",GROUP_SIP,"","","1",""),SettingItem("displayname","","1",GROUP_SIP,"","","1",""),SettingItem("email","","1",GROUP_GENERAL,"","","1",""),SettingItem("textmessaging","-1","2",GROUP_SIP,webphone_api.stringres.get("chatsms__auto_guess_or_ask")+","+webphone_api.stringres.get("chatsms__sms_only")+","+webphone_api.stringres.get("chatsms__chat_only")+","+webphone_api.stringres.get("chatsms__disable"),"-1,3,6,0","1","-1"),SettingItem("savetocontacts","1","2",GROUP_GENERAL,webphone_api.stringres.get("savetocontacts__no")+","+webphone_api.stringres.get("savetocontacts__ask")+","+webphone_api.stringres.get("savetocontacts__yes"),"0,1,2","1","1"),SettingItem("call_access","","7",GROUP_GENERAL,"","","1",""),e=10;var b="-1";!isNull(GetConfig("transfertype"))&&GetConfig("transfertype").length>0&&(b=Trim(GetConfig("transfertype"))),SettingItem("transfertype",b,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("transfertype__auto")+","+webphone_api.stringres.get("transfertype__unattended")+","+webphone_api.stringres.get("transfertype__withhold")+","+webphone_api.stringres.get("transfertype__attanded")+","+webphone_api.stringres.get("transfertype__with_no_hold")+","+webphone_api.stringres.get("transfertype__with_conf"),"-1,1,6,5,7,8","1",b),e=11,SettingItem("transfertype1",GetConfigInt("transfertype1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace1",GetConfigInt("transfwithreplace1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace1",GetConfigInt("allowreplace1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer1",GetConfigInt("discontransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer1",GetConfigInt("disconincomingrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer1",GetConfigInt("inversetransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay1",GetConfigInt("transferdelay1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer1",GetConfigInt("newdialogforrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer1",GetConfigInt("useserverdomainforrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer1",GetConfigInt("holdontransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype2",GetConfigInt("transfertype2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace2",GetConfigInt("transfwithreplace2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace2",GetConfigInt("allowreplace2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer2",GetConfigInt("discontransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer2",GetConfigInt("disconincomingrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer2",GetConfigInt("inversetransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay2",GetConfigInt("transferdelay2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer2",GetConfigInt("newdialogforrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer2",GetConfigInt("useserverdomainforrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer2",GetConfigInt("holdontransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype3",GetConfigInt("transfertype3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace3",GetConfigInt("transfwithreplace3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace3",GetConfigInt("allowreplace3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer3",GetConfigInt("discontransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer3",GetConfigInt("disconincomingrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer3",GetConfigInt("inversetransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay3",GetConfigInt("transferdelay3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer3",GetConfigInt("newdialogforrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer3",GetConfigInt("useserverdomainforrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer3",GetConfigInt("holdontransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype4",GetConfigInt("transfertype4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace4",GetConfigInt("transfwithreplace4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace4",GetConfigInt("allowreplace4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer4",GetConfigInt("discontransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer4",GetConfigInt("disconincomingrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer4",GetConfigInt("inversetransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay4",GetConfigInt("transferdelay4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer4",GetConfigInt("newdialogforrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer4",GetConfigInt("useserverdomainforrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer4",GetConfigInt("holdontransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype5",GetConfigInt("transfertype5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace5",GetConfigInt("transfwithreplace5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace5",GetConfigInt("allowreplace5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer5",GetConfigInt("discontransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer5",GetConfigInt("disconincomingrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer5",GetConfigInt("inversetransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay5",GetConfigInt("transferdelay5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer5",GetConfigInt("newdialogforrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer5",GetConfigInt("useserverdomainforrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer5",GetConfigInt("holdontransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype6",GetConfigInt("transfertype6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace6",GetConfigInt("transfwithreplace6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace6",GetConfigInt("allowreplace6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer6",GetConfigInt("discontransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer6",GetConfigInt("disconincomingrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer6",GetConfigInt("inversetransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay6",GetConfigInt("transferdelay6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer6",GetConfigInt("newdialogforrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer6",GetConfigInt("useserverdomainforrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer6",GetConfigInt("holdontransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype7",GetConfigInt("transfertype7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace7",GetConfigInt("transfwithreplace7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace7",GetConfigInt("allowreplace7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer7",GetConfigInt("discontransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer7",GetConfigInt("disconincomingrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer7",GetConfigInt("inversetransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay7",GetConfigInt("transferdelay7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer7",GetConfigInt("newdialogforrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer7",GetConfigInt("useserverdomainforrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer7",GetConfigInt("holdontransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype8",GetConfigInt("transfertype8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace8",GetConfigInt("transfwithreplace8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace8",GetConfigInt("allowreplace8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer8",GetConfigInt("discontransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer8",GetConfigInt("disconincomingrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer8",GetConfigInt("inversetransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay8",GetConfigInt("transferdelay8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer8",GetConfigInt("newdialogforrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer8",GetConfigInt("useserverdomainforrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer8",GetConfigInt("holdontransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype9",GetConfigInt("transfertype9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace9",GetConfigInt("transfwithreplace9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace9",GetConfigInt("allowreplace9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer9",GetConfigInt("discontransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer9",GetConfigInt("disconincomingrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer9",GetConfigInt("inversetransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay9",GetConfigInt("transferdelay9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer9",GetConfigInt("newdialogforrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer9",GetConfigInt("useserverdomainforrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),
SettingItem("holdontransfer9",GetConfigInt("holdontransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype10",GetConfigInt("transfertype10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace10",GetConfigInt("transfwithreplace10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace10",GetConfigInt("allowreplace10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer10",GetConfigInt("discontransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer10",GetConfigInt("disconincomingrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer10",GetConfigInt("inversetransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay10",GetConfigInt("transferdelay10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer10",GetConfigInt("newdialogforrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer10",GetConfigInt("useserverdomainforrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer10",GetConfigInt("holdontransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),e=12;var _="";!isNull(GetConfig("transfername1"))&&GetConfig("transfername1").length>0&&(_=Trim(GetConfig("transfername1"))),SettingItem("transfername1",_,"-1",GROUP_NOGROUP,"","","-1",_);var f="";!isNull(GetConfig("transfername2"))&&GetConfig("transfername2").length>0&&(f=Trim(GetConfig("transfername2"))),SettingItem("transfername2",f,"-1",GROUP_NOGROUP,"","","-1",f);var w="";!isNull(GetConfig("transfername3"))&&GetConfig("transfername3").length>0&&(w=Trim(GetConfig("transfername3"))),SettingItem("transfername3",w,"-1",GROUP_NOGROUP,"","","-1",w);var v="";!isNull(GetConfig("transfername4"))&&GetConfig("transfername4").length>0&&(v=Trim(GetConfig("transfername4"))),SettingItem("transfername4",v,"-1",GROUP_NOGROUP,"","","-1",v);var P="";!isNull(GetConfig("transfername5"))&&GetConfig("transfername5").length>0&&(P=Trim(GetConfig("transfername5"))),SettingItem("transfername5",P,"-1",GROUP_NOGROUP,"","","-1",P);var E="";!isNull(GetConfig("transfername6"))&&GetConfig("transfername6").length>0&&(E=Trim(GetConfig("transfername6"))),SettingItem("transfername6",E,"-1",GROUP_NOGROUP,"","","-1",E);var T="";!isNull(GetConfig("transfername7"))&&GetConfig("transfername7").length>0&&(T=Trim(GetConfig("transfername7"))),SettingItem("transfername7",T,"-1",GROUP_NOGROUP,"","","-1",T);var N="";!isNull(GetConfig("transfername8"))&&GetConfig("transfername8").length>0&&(N=Trim(GetConfig("transfername8"))),SettingItem("transfername8",N,"-1",GROUP_NOGROUP,"","","-1",N);var S="";!isNull(GetConfig("transfername9"))&&GetConfig("transfername9").length>0&&(S=Trim(GetConfig("transfername9"))),SettingItem("transfername9",S,"-1",GROUP_NOGROUP,"","","-1",S);var I="";!isNull(GetConfig("transfername10"))&&GetConfig("transfername10").length>0&&(I=Trim(GetConfig("transfername10"))),SettingItem("transfername10",I,"-1",GROUP_NOGROUP,"","","-1",I),e=13,SettingItem("startonboot","true","0",GROUP_GENERAL,"","","1","true"),SettingItem("callforwardonbusy","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("rejectonvoipbusy","3","2",GROUP_CALLDIVERT,"Auto,Reject calls,Allow calls,Forward calls","3,0,1,2","1","3"),SettingItem("rejectonphonebusy","0","2",GROUP_CALLDIVERT,"Reject calls,Allow calls,Forward calls","0,1,2","1","0");var C="";!isNull(GetConfig("voicemailnum"))&&GetConfig("voicemailnum").length>0&&(C=Trim(GetConfig("voicemailnum"))),SettingItem("voicemailnum",C,"1",GROUP_CALLDIVERT,"","","1","");var R="2";!isNull(GetConfig("voicemail"))&&GetConfig("voicemail").length>0&&(R=Trim(GetConfig("voicemail"))),SettingItem("voicemail",R,"2",GROUP_CALLDIVERT,"Disabled,Only if NOTIFY is received,Auto-detect if SUBSCRIBE is needed,Subscribe for voicemail after registration,Subscribe for voicemail on startup","0,1,2,3,4","1","false"),SettingItem("techprefix","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("filters","","5",GROUP_CALLDIVERT,"","","1",""),SettingItem("startonboot","true","0",GROUP_GENERAL,"","","1","true"),SettingItem("startwithos","true","0",GROUP_GENERAL,"","","1","true"),SettingItem("startwithos_was_sent","false","-1",GROUP_NOGROUP,"","","1","false"),e=4;var G="14";webphone_api.global.isdebugversion?(e=15,SettingItem("loglevel","5","0",GROUP_GENERAL,"","","1","1"),webphone_api.global.loglevel=5):(e=16,!isNull(webphone_api.parameters.loglevel)&&1===webphone_api.parameters.loglevel.length&&IsNumber(webphone_api.parameters.loglevel)&&(G=Trim(webphone_api.parameters.loglevel.length)),SettingItem("loglevel",G,"0",GROUP_GENERAL,"","","1","1")),e=17,SettingItem("loglevel_dbg",G,"1",GROUP_GENERAL,"","","1","1"),SettingItem("code_version","1","-1",GROUP_NOGROUP,"","","1","1"),e=18;var y="";!isNull(GetConfig("brandname"))&&GetConfig("brandname").length>0&&(y=Trim(GetConfig("brandname"))),SettingItem("brandname",y,"-1",GROUP_NOGROUP,"","","1","");!isNull(GetConfig("brandid"))&&GetConfig("brandid").length>0&&(y=Trim(GetConfig("brandid"))),SettingItem("brandid","","-1",GROUP_NOGROUP,"","","1","");var L="";!isNull(GetConfig("companyname"))&&GetConfig("companyname").length>0&&(L=Trim(GetConfig("companyname"))),SettingItem("companyname",L,"-1",GROUP_NOGROUP,"","","1","");var O="";!isNull(GetConfig("newuser"))&&GetConfig("newuser").length>0&&(O=Trim(GetConfig("newuser"))),SettingItem("newuser",O,"-1",GROUP_NOGROUP,"","","1","");var D="";!isNull(GetConfig("homepage"))&&GetConfig("homepage").length>0&&(D=Trim(GetConfig("homepage"))),SettingItem("homepage",D,"-1",GROUP_NOGROUP,"","","1","");var x="";!isNull(GetConfig("accounturi"))&&GetConfig("accounturi").length>0&&(x=Trim(GetConfig("accounturi"))),SettingItem("accounturi",x,"-1",GROUP_NOGROUP,"","","1","");var A="";!isNull(GetConfig("recharge"))&&GetConfig("recharge").length>0&&(A=Trim(GetConfig("recharge"))),SettingItem("recharge",A,"-1",GROUP_NOGROUP,"","","1","");var k="";!isNull(GetConfig("p2p"))&&GetConfig("p2p").length>0&&(k=Trim(GetConfig("p2p"))),SettingItem("p2p",k,"1",GROUP_CALLDIVERT,"","","1","");var U="";!isNull(GetConfig("callback"))&&GetConfig("callback").length>0&&(U=Trim(GetConfig("callback"))),SettingItem("callback",U,"1",GROUP_CALLDIVERT,"","","1","");var V="";!isNull(GetConfig("sms"))&&GetConfig("sms").length>0&&(V=Trim(GetConfig("sms"))),SettingItem("sms",V,"1",GROUP_CALLDIVERT,"","","1","");var W="";!isNull(GetConfig("sms_recieve"))&&GetConfig("sms_recieve").length>0&&(W=Trim(GetConfig("sms_recieve"))),SettingItem("sms_recieve",W,"-1",GROUP_NOGROUP,"","","1","");var F="";!isNull(GetConfig("creditrequest"))&&GetConfig("creditrequest").length>0&&(F=Trim(GetConfig("creditrequest"))),SettingItem("creditrequest",F,"1",GROUP_CALLDIVERT,"","","1","");var M="";!isNull(GetConfig("ratingrequest"))&&GetConfig("ratingrequest").length>0&&(M=Trim(GetConfig("ratingrequest"))),SettingItem("ratingrequest",M,"1",GROUP_CALLDIVERT,"","","1","");var H="";!isNull(GetConfig("supportmail"))&&GetConfig("supportmail").length>0&&(H=Trim(GetConfig("supportmail"))),SettingItem("supportmail",H,"-1",GROUP_NOGROUP,"","","1","");var B="";!isNull(GetConfig("supporturl"))&&GetConfig("supporturl").length>0&&(B=Trim(GetConfig("supporturl"))),SettingItem("supporturl",B,"-1",GROUP_NOGROUP,"","","1","");var j=GetParameter("header");!isNull(GetConfig("header"))&&GetConfig("header").length>0&&(j=Trim(GetConfig("header"))),(isNull(j)||j.length<1)&&!isNull(GetConfig("headertext"))&&GetConfig("headertext").length>0&&(j=GetConfig("headertext")),SettingItem("header",j,"-1",GROUP_NOGROUP,"","","1","");var $="";!isNull(GetConfig("footer"))&&GetConfig("footer").length>0&&($=Trim(GetConfig("footer"))),(isNull($)||$.length<1)&&!isNull(GetConfig("footertext"))&&GetConfig("footertext").length>0&&($=GetConfig("footertext")),SettingItem("footer",$,"-1",GROUP_NOGROUP,"","","1","");var q="";!isNull(GetConfig("logo"))&&GetConfig("logo").length>0&&(q=Trim(GetConfig("logo"))),SettingItem("logo",q,"-1",GROUP_NOGROUP,"","","1","");var z="";!isNull(GetConfig("version"))&&GetConfig("version").length>0&&(z=Trim(GetConfig("version"))),SettingItem("version",z,"-1",GROUP_NOGROUP,"","","1","");var K="";!isNull(GetConfig("messagedisplay"))&&GetConfig("messagedisplay").length>0&&(K=Trim(GetConfig("messagedisplay"))),SettingItem("messagedisplay",K,"-1",GROUP_NOGROUP,"","","1","");var X="";!isNull(GetConfig("messagepopup"))&&GetConfig("messagepopup").length>0&&(X=Trim(GetConfig("messagepopup"))),SettingItem("messagepopup",X,"-1",GROUP_NOGROUP,"","","1","");var J="";!isNull(GetConfig("advertisement"))&&GetConfig("advertisement").length>0&&(J=Trim(GetConfig("advertisement"))),SettingItem("advertisement",J,"-1",GROUP_NOGROUP,"","","1","");var Y="";!isNull(GetConfig("helpurl"))&&GetConfig("helpurl").length>0&&(Y=Trim(GetConfig("helpurl"))),SettingItem("helpurl",Y,"-1",GROUP_NOGROUP,"","","1","");var Q="";!isNull(GetConfig("licenseurl"))&&GetConfig("licenseurl").length>0&&(Q=Trim(GetConfig("licenseurl"))),SettingItem("licenseurl",Q,"-1",GROUP_NOGROUP,"","","1","");var Z="";!isNull(GetConfig("extramenuurl"))&&GetConfig("extramenuurl").length>0&&(Z=Trim(GetConfig("extramenuurl"))),SettingItem("extramenuurl",Z,"-1",GROUP_NOGROUP,"","","1","");var ee="";!isNull(GetConfig("extramenutxt"))&&GetConfig("extramenutxt").length>0&&(ee=Trim(GetConfig("extramenutxt"))),SettingItem("extramenutxt",ee,"-1",GROUP_NOGROUP,"","","1","");var te="";!isNull(GetConfig("extramenuurl1"))&&GetConfig("extramenuurl1").length>0&&(te=Trim(GetConfig("extramenuurl1"))),SettingItem("extramenuurl1",te,"-1",GROUP_NOGROUP,"","","1","");var ne="";!isNull(GetConfig("extramenutxt1"))&&GetConfig("extramenutxt1").length>0&&(ne=Trim(GetConfig("extramenutxt1"))),SettingItem("extramenutxt1",ne,"-1",GROUP_NOGROUP,"","","1","");var oe="";!isNull(GetConfig("extramenuurl2"))&&GetConfig("extramenuurl2").length>0&&(oe=Trim(GetConfig("extramenuurl2"))),SettingItem("extramenuurl2",oe,"-1",GROUP_NOGROUP,"","","1","");var ie="";!isNull(GetConfig("extramenutxt2"))&&GetConfig("extramenutxt2").length>0&&(ie=Trim(GetConfig("extramenutxt2"))),SettingItem("extramenutxt2",ie,"-1",GROUP_NOGROUP,"","","1","");var ae="";!isNull(GetConfig("extramenuurl3"))&&GetConfig("extramenuurl3").length>0&&(ae=Trim(GetConfig("extramenuurl3"))),SettingItem("extramenuurl3",ae,"-1",GROUP_NOGROUP,"","","1","");var re="";!isNull(GetConfig("extramenutxt3"))&&GetConfig("extramenutxt3").length>0&&(re=Trim(GetConfig("extramenutxt3"))),SettingItem("extramenutxt3",re,"-1",GROUP_NOGROUP,"","","1","");var se="";!isNull(GetConfig("extramenuurl4"))&&GetConfig("extramenuurl4").length>0&&(se=Trim(GetConfig("extramenuurl4"))),SettingItem("extramenuurl4",se,"-1",GROUP_NOGROUP,"","","1","");var le="";!isNull(GetConfig("extramenutxt4"))&&GetConfig("extramenutxt4").length>0&&(le=Trim(GetConfig("extramenutxt4"))),SettingItem("extramenutxt4",le,"-1",GROUP_NOGROUP,"","","1","");var pe="";!isNull(GetConfig("extramenuurl5"))&&GetConfig("extramenuurl5").length>0&&(pe=Trim(GetConfig("extramenuurl5"))),SettingItem("extramenuurl5",pe,"-1",GROUP_NOGROUP,"","","1","");var ce="";!isNull(GetConfig("extramenutxt5"))&&GetConfig("extramenutxt5").length>0&&(ce=Trim(GetConfig("extramenutxt5"))),SettingItem("extramenutxt5",ce,"-1",GROUP_NOGROUP,"","","1",""),e=19;var ue="1";!isNull(GetConfig("enablepresence"))&&GetConfig("enablepresence").length>0&&(ue=Trim(GetConfig("enablepresence"))),SettingItem("enablepresence",ue,"-1",GROUP_NOGROUP,"","","1","0"),SettingItem("presencestatus","Online","2",GROUP_PROFILE,"Online,Away,DND,Invisible,Offline","Online,Away,DND,Invisible,Offline","1","Online"),SettingItem("numexistscalled","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("servercontacts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("verifyuser","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("srvcontacts","","-1",GROUP_NOGROUP,"","","1","0");var he="false";!isNull(GetConfig("contacttoggle"))&&GetConfig("contacttoggle").length>0&&(he=Trim(GetConfig("contacttoggle"))),SettingItem("contacttoggle",he,"-1",GROUP_NOGROUP,"","","1","false"),e=20,SettingItem("last_callback_nr","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("callback_mode","0","2",GROUP_CALLDIVERT,"No,Ask,On no internet,On no WIFI,Always","0,1,2,3,4","1","0"),SettingItem("accounts","","5",GROUP_SIP,"","","1",""),SettingItem("reset_settings","","8",GROUP_GENERAL,"","","1","");var ge="false";!isNull(GetConfig("voicerecording"))&&GetConfig("voicerecording").length>0&&("true"==ge||"false"==ge)&&(ge=Trim(GetConfig("voicerecording"))),SettingItem("voicerecording",ge,"0",GROUP_GENERAL,"","","1",ge),e=21,SettingItem("ringtone","","8",GROUP_GENERAL,"Ringtone1,Ringtone2,Ringtone3","0,1,2","1",""),SettingItem("changesptoring","2","2",GROUP_SIP,webphone_api.stringres.get("changesptoring__nothing")+","+webphone_api.stringres.get("changesptoring__disp_ringing")+","+webphone_api.stringres.get("changesptoring__start_media")+","+webphone_api.stringres.get("changesptoring__start_media_disp"),"0,1,2,3","1","2");var me="-1";isNull(GetConfig("transport"))||(me=GetConfigInt("transport",-1)),SettingItem("transport",me.toString(),"2",GROUP_SIP,"Auto,UDP,TCP,TLS","-1,0,1,2","1",me.toString()),SettingItem("defmute","0","2",GROUP_SIP,webphone_api.stringres.get("defmute__both")+","+webphone_api.stringres.get("defmute__speakers_only")+","+webphone_api.stringres.get("defmute__mic_only"),"0,1,2","1","2"),SettingItem("automute","0","2",GROUP_CALLDIVERT,webphone_api.stringres.get("automute__no")+","+webphone_api.stringres.get("automute__incoming")+","+webphone_api.stringres.get("automute__outgoing")+","+webphone_api.stringres.get("automute__both")+","+webphone_api.stringres.get("automute__other_line"),"0,1,2,3,4","1","0"),SettingItem("autohold","0","2",GROUP_CALLDIVERT,webphone_api.stringres.get("autohold__no")+","+webphone_api.stringres.get("autohold__incoming")+","+webphone_api.stringres.get("autohold__outgoing")+","+webphone_api.stringres.get("autohold__both")+","+webphone_api.stringres.get("autohold__other_line"),"0,1,2,3,4","1","0"),e=22,SettingItem("customsipheader","","1",GROUP_SIP,"","","1",""),SettingItem("sendrtponmuted","false","0",GROUP_SIP,"","","1","false"),SettingItem("capabilityrequest","false","0",GROUP_SIP,"","","1","false"),SettingItem("devtest","0,0,0,0,0,0,0,0,0","8",GROUP_SIP,"","","1","0,0,0,0,0,0,0,0,0"),SettingItem("enableaudio","true","0",GROUP_CALLDIVERT,"","","1","true"),SettingItem("settobasefunctionality","true","8",GROUP_MAIN,"","","1","true"),SettingItem("dialerintegration","false","0",GROUP_INTEGRATE,"","","1","false"),SettingItem("screenrotation","0","2",GROUP_GENERAL,"Auto,No,Yes","0,1,2","1","0"),SettingItem("audiobufferlength","-1","1",GROUP_MEDIA,"","","1","-1"),SettingItem("keepaliveival","28000","1",GROUP_SIP,"","","1","28000"),SettingItem("cpualwayspartiallock","false","0",GROUP_GENERAL,"","","1","false"),SettingItem("disablewbforpstn","1","2",GROUP_MEDIA,"No,Yes (check on first call),Yes (check always)","0,1,2","1","1"),SettingItem("storecallhistory","1","2",GROUP_GENERAL,"Local + Native,Local,Native,No history","0,1,2,3","1","1"),SettingItem("keepdeviceawakeincall","2","2",GROUP_GENERAL,"No,Basic only,Auto,Full then partial,Always full","0,1,2,3,4","1","2"),SettingItem("speakermode","0","2",GROUP_MEDIA,webphone_api.stringres.get("speakermode__auto")+","+webphone_api.stringres.get("speakermode__never")+","+webphone_api.stringres.get("speakermode__always"),"0,1,2","1","0"),SettingItem("focusaudio","1","2",GROUP_MEDIA,"Auto guess,No,Yes","0,1,2","1","1"),SettingItem("useroutingapi","0","2",GROUP_MEDIA,"Auto,No,Yes","0,1,2","1","0"),SettingItem("integrateifwifionly","false","0",GROUP_INTEGRATE,"","","1","false"),SettingItem("nativefilterallow","","1",GROUP_INTEGRATE,"","","1",""),SettingItem("nativefilterblock","","1",GROUP_INTEGRATE,"","","1",""),SettingItem("companyname","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("supportpageuri","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("proversioncallcount","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("magicnumber",SETT_MAGIC_NUMBER,"-1",GROUP_NOGROUP,"","","1",SETT_MAGIC_NUMBER),SettingItem("upgradesettfromdatabase","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("cfgvideo","4","2",GROUP_VIDEO,"Never,On Request,Ask,Autoaccept,Always","2,4,6,8,10","1","4"),SettingItem("video_profile","0","2",GROUP_VIDEO,"Auto,Low,Medium,High,Ultra,Extra","0,4,6,8,10,15","1","0"),SettingItem("cust_lastautoprov","0","-1",GROUP_NOGROUP,"","","1","0"),e=23,SettingItem("lastautoprov","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("loglastusage","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("callfunctionsbtnusage","10,0,5,9,8,10,12,1,3,-2","-1",GROUP_NOGROUP,"","","1"),e=24,SettingItem("redial","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("vibrate","0","2",GROUP_GENERAL,"Auto,Never,Always","0,1,2","1","0"),SettingItem("video_fps","0","1",GROUP_VIDEO,"","","1","0"),SettingItem("setfinalcodec","1","2",GROUP_MEDIA,webphone_api.stringres.get("setfinalcodec__never")+","+webphone_api.stringres.get("setfinalcodec__auto")+","+webphone_api.stringres.get("setfinalcodec__multiple_codec")+","+webphone_api.stringres.get("setfinalcodec__always"),"0,1,2,3","1","1"),SettingItem("use_rport","1","2",GROUP_SIP,webphone_api.stringres.get("use_rport__no")+","+webphone_api.stringres.get("use_rport__simmetric_nat")+","+webphone_api.stringres.get("use_rport__always")+","+webphone_api.stringres.get("use_rport__public_ip")+","+webphone_api.stringres.get("use_rport__request"),"0,1,2,3,9","1","1"),SettingItem("natopenpackets","2","1",GROUP_SIP,"","","1","2"),SettingItem("video_accept_checkbox","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("successfulcalls","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webrtc_successfulcalls","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("wasrated","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("lastratedate","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("hidemyidentity","false","0",GROUP_SIP,"","","1","false"),SettingItem("last_transfer_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_conference_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_forward_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("validprovisioning","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("jsscriptevent","2","-1",GROUP_NOGROUP,"","","1","2"),SettingItem("devicetype",""+DEVICE_WEBPHONE(),"-1",GROUP_NOGROUP,"","","1",""+DEVICE_WEBPHONE()),SettingItem("extraoption","","1",GROUP_GENERAL,"","","1",""),e=25,SettingItem("enginepriority_java","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_webrtc","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_ns","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_flash","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_app","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_p2p","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_accessnum","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_nativedial","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_otherbrowser","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("engineoldavailable_java","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_webrtc","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_ns","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_flash","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_app","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_p2p","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_accessnum","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_nativedial","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("lastusedengine","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("ignoreengineselect","false","-1",GROUP_NOGROUP,"","","1","false"),e=26;var de="";!isNull(GetConfig("pc_alternatebrowserurl"))&&GetConfig("pc_alternatebrowserurl").length>0&&(de=Trim(GetConfig("pc_alternatebrowserurl"))),SettingItem("pc_alternatebrowserurl",de,"-1",GROUP_NOGROUP,"","","1",""),SettingItem("lccnr","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("vdnr","0","-1",GROUP_NOGROUP,"","","1","0");var be="";!isNull(GetConfig("ios_nativedialerurl"))&&GetConfig("ios_nativedialerurl").length>0&&(be=Trim(GetConfig("ios_nativedialerurl"))),SettingItem("ios_nativedialerurl",be,"-1",GROUP_NOGROUP,"","","1","");var _e="";!isNull(GetConfig("android_nativedialerurl"))&&GetConfig("android_nativedialerurl").length>0&&(_e=Trim(GetConfig("android_nativedialerurl"))),SettingItem("android_nativedialerurl",_e,"-1",GROUP_NOGROUP,"","","1","");var fe="";!isNull(GetConfig("showsynccontactsmenu"))&&GetConfig("showsynccontactsmenu").length>0&&(fe=Trim(GetConfig("showsynccontactsmenu"))),SettingItem("showsynccontactsmenu",fe,"-1",GROUP_NOGROUP,"","","1","");var we="";!isNull(GetConfig("accessnumber"))&&GetConfig("accessnumber").length>0&&(we=Trim(GetConfig("accessnumber"))),SettingItem("accessnumber",we,"-1",GROUP_NOGROUP,"","","1","");var ve="0";!isNull(GetConfig("colortheme"))&&GetConfig("colortheme").length>0&&(ve=Trim(GetConfig("colortheme"))),e=27,SettingItem("theme",ve,"2",GROUP_GENERAL,"Default,Light Blue,Light Green,Light Orange,Light Purple,Dark Red,Yellow,Blue,Purple,Turquoise,Light Skin,Green Orange,Custom 1,Custom 2,Custom 3,Custom 4,Custom 5,Blue2,iPhone,MZ,WebPhone,Custom","0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,18,19,21,22,23,24,25","1","0");var Pe="-1";!isNull(GetConfig("useloginpage"))&&GetConfig("useloginpage").length>0&&(Pe=Trim(GetConfig("useloginpage"))),SettingItem("useloginpage",Pe,"-1",GROUP_NOGROUP,"","","1","-1");var Ee="10";!isNull(GetConfig("featureset"))&&GetConfig("featureset").length>0&&(Ee=Trim(GetConfig("featureset"))),SettingItem("featureset",Ee,"-1",GROUP_NOGROUP,"","","1",Ee),SettingItem("wsusers","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("mainconfigs","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("notifications2","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("canshowlickeyinput","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("normalizenumber","-1","2",GROUP_CALLDIVERT,webphone_api.stringres.get("normalizenumber__auto")+","+webphone_api.stringres.get("normalizenumber__no")+","+webphone_api.stringres.get("normalizenumber__yes"),"-1,0,1","1","-1");var Te="";!isNull(GetConfig("callforwardonbusy"))&&GetConfig("callforwardonbusy").length>0&&(Te=Trim(GetConfig("callforwardonbusy"))),SettingItem("callforwardonbusy",Te,"1",GROUP_CALLDIVERT,"","","1","");var Ne="";!isNull(GetConfig("callforwardonnoanswer"))&&GetConfig("callforwardonnoanswer").length>0&&(Ne=Trim(GetConfig("callforwardonnoanswer"))),SettingItem("callforwardonnoanswer",Ne,"1",GROUP_CALLDIVERT,"","","1","");var Se="15";!isNull(GetConfig("callforwardonnoanswertimeout"))&&GetConfig("callforwardonnoanswertimeout").length>0&&(Se=Trim(GetConfig("callforwardonnoanswertimeout"))),SettingItem("callforwardonnoanswertimeout",Se,"1",GROUP_CALLDIVERT,"","","1","");var Ie="";!isNull(GetConfig("callforwardalways"))&&GetConfig("callforwardalways").length>0&&(Ie=Trim(GetConfig("callforwardalways"))),SettingItem("callforwardalways",Ie,"1",GROUP_CALLDIVERT,"","","1","");var Ce="";!isNull(GetConfig("calltransferalways"))&&GetConfig("calltransferalways").length>0&&(Ce=Trim(GetConfig("calltransferalways"))),SettingItem("calltransferalways",Ce,"1",GROUP_CALLDIVERT,"","","1","");var Re="0";!isNull(GetConfig("autoignore"))&&GetConfig("autoignore").length>0&&(Re=Trim(GetConfig("autoignore"))),SettingItem("autoignore",Re,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("autoignore__dont")+","+webphone_api.stringres.get("autoignore__silently")+","+webphone_api.stringres.get("autoignore__reject"),"0,1,2","1","0");var Ge="false";!isNull(GetConfig("enableautoaccept"))&&GetConfig("enableautoaccept").length>0&&("3"==GetConfig("enableautoaccept")?Ge="true":"0"==GetConfig("enableautoaccept")&&(Ge="false")),!isNull(GetConfig("autoaccept"))&&GetConfig("autoaccept").length>0&&(Ge=Trim(GetConfig("autoaccept"))),SettingItem("autoaccept",Ge,"0",GROUP_CALLDIVERT,"","","1","false"),SettingItem("filters","","5",GROUP_CALLDIVERT,"","","1",""),SettingItem("blocked_contacts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("usemizutlsproxy","1","-1",GROUP_NOGROUP,"No,Auto,Yes","0,1,2","1",""),SettingItem("usemizutlsproxy_userreload","","-1",GROUP_NOGROUP,"","0,1,2","1",""),SettingItem("notification_count2","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("autostart","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("displaypeerdetails","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("rejectonbusy","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("voicerecupload","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("lastsessionsuccess","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("codec","-1","3",GROUP_MEDIA,"Optimal,PCMU,PCMA,GSM,iLBC,SPEEX,SPEEX-WB,G.729,Opus,OpusWB,OpusUWB","-1,1,2,3,4,5,6,8,10,11,13","1","-1"),GetCodecsFromApiParam(),SettingItem("videocodec","-1","3",GROUP_MEDIA,"Optimal,H264,VP8,VP9","-1","1","-1"),SettingItem("use_h264","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("use_vp8","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("use_vp9","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("blacklist","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("sel_rtc_audio_in","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("sel_rtc_audio_out","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("sel_rtc_video_in","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("audiodevices","","8",GROUP_MEDIA,"","","1",""),SettingItem("autoaction","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webcallme","1","-1",GROUP_NOGROUP,"","","1","1"),e=28;var ye=GetConfigInt("conferencetype",1);SettingItem("conferencetype",ye.toString(),"2",GROUP_CALLDIVERT,webphone_api.stringres.get("conferencetype__disabled")+","+webphone_api.stringres.get("conferencetype__auto")+","+webphone_api.stringres.get("conferencetype__native")+","+webphone_api.stringres.get("conferencetype__server")+","+webphone_api.stringres.get("conferencetype__3way")+","+webphone_api.stringres.get("conferencetype__cr_msg_ref")+","+webphone_api.stringres.get("conferencetype__cr_msg")+","+webphone_api.stringres.get("conferencetype__cr_ref"),"0,1,2,3,4,5,6,7","1",ye.toString()),SettingItem("received_confrooms","","-1",GROUP_NOGROUP,"","","1","");var Le="";!isNull(GetConfig("callbacknumber"))&&GetConfig("callbacknumber").length>0&&(Le=Trim(GetConfig("callbacknumber"))),SettingItem("callbacknumber",Le,"1",GROUP_CALLDIVERT,"","","1",""),SettingItem("iswebrtcuppersrvfromuser","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("java_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("ns_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("webrtc_worked","false","-1",GROUP_NOGROUP,"","","1","false");var Oe="-1";!isNull(GetConfig("video"))&&GetConfig("video").length>0&&(Oe=Trim(GetConfig("video"))),SettingItem("video",Oe,"2",GROUP_MEDIA,webphone_api.stringres.get("video__auto")+","+webphone_api.stringres.get("video__disable")+","+webphone_api.stringres.get("video__enable")+","+webphone_api.stringres.get("video__force"),"-1,0,1,2","1","1");var De="0";!isNull(GetConfig("video_bandwidth"))&&GetConfig("video_bandwidth").length>0&&(De=Trim(GetConfig("video_bandwidth"))),SettingItem("video_bandwidth",De,"1",GROUP_MEDIA,"","","1","0");var xe="640";!isNull(GetConfig("video_width"))&&GetConfig("video_width").length>0&&(xe=Trim(GetConfig("video_width"))),SettingItem("video_width",xe,"1",GROUP_MEDIA,"","","1","640");var Ae="480";!isNull(GetConfig("video_height"))&&GetConfig("video_height").length>0&&(Ae=Trim(GetConfig("video_height"))),SettingItem("video_height",Ae,"1",GROUP_MEDIA,"","","1","480"),SettingItem("androidchromedisplayed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("conf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("transf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("filterchatduplicates","true","-1",GROUP_NOGROUP,"","","1","true");var ke="true";!isNull(GetConfig("has_video"))&&GetConfig("has_video").length>0&&(ke=Trim(GetConfig("has_video"))),"0"===GetParameter2("video")&&(ke="false"),SettingItem("has_video",ke,"1",GROUP_MEDIA,"","","1",ke),SettingItem("sendchatonenter","true","0",GROUP_GENERAL,"","","1","true");var Ue="-1";!isNull(GetConfig("transfwithreplace"))&&GetConfig("transfwithreplace").length>0&&(Ue=Trim(GetConfig("transfwithreplace"))),SettingItem("transfwithreplace",Ue,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("transfwithreplace__auto")+","+webphone_api.stringres.get("transfwithreplace__no")+","+webphone_api.stringres.get("transfwithreplace__yes"),"-1,0,1","1","-1"),SettingItem("acceptcall_onsharedevice","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("showratewhiletype_minlenth","3","-1",GROUP_NOGROUP,"","","1","3"),SettingItem("showratewhiletype_maxlenth","6","-1",GROUP_NOGROUP,"","","1","6");var Ve="1";!isNull(GetConfig("multilinegui"))&&GetConfig("multilinegui").length>0&&(Ve=Trim(GetConfig("multilinegui"))),SettingItem("multilinegui",Ve,"-1",GROUP_NOGROUP,"","","1",Ve),SettingItem("enginechecksum","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("redialonfail","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("autosrvupgrade","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("srvupgrade_count","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("srvupgrade_version","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("srvupgrade_currversion","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srvupgrade_currversion_extcmd_test","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srv_exe_version","0","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srv_java_version","0","-1",GROUP_NOGROUP,"","","1","-1"),e=30;var We="1";!isNull(GetConfig("useaudiodevicerecord"))&&GetConfig("useaudiodevicerecord").length>0&&(We=Trim(GetConfig("useaudiodevicerecord"))),SettingItem("useaudiodevicerecord",We,"-1",GROUP_NOGROUP,"","","1",We),SettingItem("fasthold","0","-1",GROUP_NOGROUP,"","","1","-1");SettingItem("calldivertchecksum",Md5Hash(Te+Ne+Ie+Se),"-1",GROUP_NOGROUP,"","","1",""),SettingItem("calldivertsuccess","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("muteholdalllines","0","-1",GROUP_NOGROUP,"","","1","0");var Fe="1";!isNull(GetConfig("allowcallredirect"))&&GetConfig("allowcallredirect").length>0&&(Fe=Trim(GetConfig("allowcallredirect"))),SettingItem("allowcallredirect",Fe,"-1",GROUP_NOGROUP,"","","1",Fe);var Me="1";!isNull(GetConfig("playdtmfsound"))&&GetConfig("playdtmfsound").length>0&&(Me=Trim(GetConfig("playdtmfsound"))),SettingItem("playdtmfsound",Me,"-1",GROUP_NOGROUP,"","","1",Me);var He="en";"rigitel"===GetConfig("brandname").toLowerCase()&&(He="de"),isNull(GetConfig("language"))||2!==GetConfig("language").length||(He=Trim(GetConfig("language"))),SettingItem("language",He,"2",GROUP_GENERAL,"English,German,Hungarian,Portuguese","en,de,hu,pt","1","en"),SettingItem("chrome_local_alert_displayed","false","-1",GROUP_NOGROUP,"","","1","false");var Be=GetConfig("telsearchurl");!isNull(Be)&&Be.length>0&&SettingItem("telsearchkey","3606e399f2ec49f31831949efba6daf1","1",GROUP_GENERAL,"","","1","3606e399f2ec49f31831949efba6daf1");var je="1";!isNull(GetConfig("screensharing"))&&GetConfig("screensharing").length>0&&(je=Trim(GetConfig("screensharing"))),SettingItem("screensharing",je,"-1",GROUP_NOGROUP,"","","1",je),
SettingItem("extraregisteraccounts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("lastsucc","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("enproblem","0","-1",GROUP_NOGROUP,"","","1","0");var $e="0";!isNull(GetConfig("audio_bandwidth"))&&GetConfig("audio_bandwidth").length>0&&($e=Trim(GetConfig("audio_bandwidth"))),SettingItem("audio_bandwidth",$e,"1",GROUP_MEDIA,"","","1","0");var qe="1";!isNull(GetConfig("enablepres_httpapi"))&&GetConfig("enablepres_httpapi").length>0&&(qe=Trim(GetConfig("enablepres_httpapi"))),SettingItem("enablepres_httpapi",qe,"-1",GROUP_NOGROUP,"","","1","1");var ze="1";!isNull(GetConfig("enablepres_javaapi"))&&GetConfig("enablepres_javaapi").length>0&&(ze=Trim(GetConfig("enablepres_javaapi"))),SettingItem("enablepres_javaapi",ze,"-1",GROUP_NOGROUP,"","","1","1");var Ke="1";!isNull(GetConfig("enablepres_webrtc"))&&GetConfig("enablepres_webrtc").length>0&&(Ke=Trim(GetConfig("enablepres_webrtc"))),SettingItem("enablepres_webrtc",Ke,"-1",GROUP_NOGROUP,"","","1","1"),e=31;var Xe="1";!isNull(GetConfig("incomingcallpopup"))&&GetConfig("incomingcallpopup").length>0&&(Xe=Trim(GetConfig("incomingcallpopup"))),SettingItem("incomingcallpopup",Xe,"2",GROUP_GENERAL,webphone_api.stringres.get("incomingcallpopup__no")+","+webphone_api.stringres.get("incomingcallpopup__auto")+","+webphone_api.stringres.get("incomingcallpopup__yes")+","+webphone_api.stringres.get("incomingcallpopup__always"),"0,1,2,3","1","1"),SettingItem("wpfirststart","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("useragent","","-1",GROUP_NOGROUP,"","","1","");var Je="1";!isNull(GetConfig("allowsipuriasusername"))&&GetConfig("allowsipuriasusername").length>0&&(Je=Trim(GetConfig("allowsipuriasusername")));var Ye=GetConfigInt("enabledirectcalls",-5);Ye>=0&&(Je=Ye.toString()),SettingItem("allowsipuriasusername",Je,"-1",GROUP_NOGROUP,"","","1","0");var Qe="0";!isNull(GetConfig("beeponconnect"))&&GetConfig("beeponconnect").length>0&&(Qe=Trim(GetConfig("beeponconnect"))),SettingItem("beeponconnect",Qe,"-1",GROUP_NOGROUP,"","","1","0");var Ze="0";!isNull(GetConfig("disablepopups"))&&GetConfig("disablepopups").length>0&&(Ze=Trim(GetConfig("disablepopups"))),SettingItem("disablepopups",Ze,"-1",GROUP_NOGROUP,"","","1",Ze);var et="true";!isNull(GetConfig("showtoasts"))&&GetConfig("showtoasts").length>0&&(et=Trim(GetConfig("showtoasts"))),SettingItem("showtoasts",et,"-1",GROUP_NOGROUP,"","","1","true"),SettingItem("isfirstcallfwd","true","-1",GROUP_NOGROUP,"","","1","true");var tt="0";!isNull(GetConfig("beeponincoming"))&&GetConfig("beeponincoming").length>0&&(tt=Trim(GetConfig("beeponincoming"))),SettingItem("beeponincoming",tt,"0",GROUP_GENERAL,"","","1","0");var nt="2";!isNull(GetConfig("flash"))&&GetConfig("flash").length>0&&(nt=Trim(GetConfig("flash"))),SettingItem("flash",nt,"0",GROUP_GENERAL,"","","1","2");var ot="1";!isNull(GetConfig("importonlywithnum"))&&GetConfig("importonlywithnum").length>0&&(ot=Trim(GetConfig("importonlywithnum"))),SettingItem("importonlywithnum",ot,"2",GROUP_GENERAL,webphone_api.stringres.get("importonlywithnum__no")+","+webphone_api.stringres.get("importonlywithnum__yes"),"0,1","1","1");var it="2";!isNull(GetConfig("videomode"))&&GetConfig("videomode").length>0&&(it=Trim(GetConfig("importonlywithnum"))),SettingItem("videomode",it,"2",GROUP_MEDIA,webphone_api.stringres.get("videomode__always")+","+webphone_api.stringres.get("videomode__noask")+","+webphone_api.stringres.get("videomode__askonce")+","+webphone_api.stringres.get("videomode__alwaysask")+","+webphone_api.stringres.get("videomode__disable"),"1,2,3,4,5","1","2");var at="2";!isNull(GetConfig("sscontrol"))&&GetConfig("sscontrol").length>0&&(at=Trim(GetConfig("sscontrol"))),SettingItem("sscontrol",at,"0",GROUP_SCRSHARE,"","","1","2");var rt="2";!isNull(GetConfig("ssscroll"))&&GetConfig("ssscroll").length>0&&(rt=Trim(GetConfig("ssscroll"))),SettingItem("ssscroll",rt,"0",GROUP_SCRSHARE,"","","1","2");var st="1";!isNull(GetConfig("sstop"))&&GetConfig("sstop").length>0&&(st=Trim(GetConfig("sstop"))),SettingItem("sstop",st,"0",GROUP_SCRSHARE,"","","1","1");var lt="2";!isNull(GetConfig("ssquality"))&&GetConfig("ssquality").length>0&&(lt=Trim(GetConfig("ssquality"))),SettingItem("ssquality",lt,"2",GROUP_SCRSHARE,webphone_api.stringres.get("ssquality__low")+","+webphone_api.stringres.get("ssquality__medium")+","+webphone_api.stringres.get("ssquality__high"),"1,2,3","1","2"),e=32;var pt="";!isNull(GetConfig("bundlepolicy"))&&GetConfig("bundlepolicy").length>0&&(pt=Trim(GetConfig("bundlepolicy"))),SettingItem("bundlepolicy",pt,"-1",GROUP_NOGROUP,"","","1",pt);var ct="";!isNull(GetConfig("icecandidatepoolsize"))&&GetConfig("icecandidatepoolsize").length>0&&(ct=Trim(GetConfig("icecandidatepoolsize"))),SettingItem("icecandidatepoolsize",ct,"-1",GROUP_NOGROUP,"","","1",ct);var ut="";!isNull(GetConfig("icetransportpolicy"))&&GetConfig("icetransportpolicy").length>0&&(ut=Trim(GetConfig("icetransportpolicy"))),SettingItem("icetransportpolicy",ut,"-1",GROUP_NOGROUP,"","","1",ut);var ht="0";!isNull(GetConfig("displayvideodevice"))&&GetConfig("displayvideodevice").length>0&&(ht=Trim(GetConfig("displayvideodevice"))),SettingItem("displayvideodevice",ht,"-1",GROUP_NOGROUP,"","","1",ht);var gt="30000";!isNull(GetConfig("wskeepaliveival"))&&GetConfig("wskeepaliveival").length>0&&(gt=Trim(GetConfig("wskeepaliveival"))),SettingItem("wskeepaliveival",gt,"-1",GROUP_NOGROUP,"","","1",gt);var mt="1";!isNull(GetConfig("enableblf"))&&GetConfig("enableblf").length>0&&(mt=Trim(GetConfig("enableblf"))),SettingItem("enableblf",mt,"-1",GROUP_SIP,"","","1",mt);var dt="";!isNull(GetConfig("profilestatustext"))&&GetConfig("profilestatustext").length>0&&(dt=Trim(GetConfig("profilestatustext"))),SettingItem("profilestatustext",dt,"1",GROUP_PROFILE,"","","1",dt);var bt="0";!isNull(GetConfig("share_location"))&&GetConfig("share_location").length>0&&(bt=Trim(GetConfig("share_location"))),SettingItem("share_location",bt,"2",GROUP_PROFILE,webphone_api.stringres.get("share_location__no")+","+webphone_api.stringres.get("share_location__yes"),"0,1","1",bt);var _t="";!isNull(GetConfig("profilepicture"))&&GetConfig("profilepicture").length>0&&(_t=Trim(GetConfig("profilepicture"))),SettingItem("profilepicture",_t,"1",GROUP_PROFILE,"","","1",_t),e=33,SettingItem("profilehistory","","-1",GROUP_NOGROUP,"","","1","");var ft="1";!isNull(GetConfig("p2psignaling"))&&GetConfig("p2psignaling").length>0&&(ft=Trim(GetConfig("p2psignaling"))),SettingItem("p2psignaling",ft,"-1",GROUP_NOGROUP,"","","1",ft),SettingItem("nsupdate","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("lastwpapixxx","","-1",GROUP_NOGROUP,"","","1","");var wt="1";!isNull(GetConfig("androidspeaker"))&&GetConfig("androidspeaker").length>0&&(wt=Trim(GetConfig("androidspeaker"))),SettingItem("androidspeaker",wt,"2",GROUP_MEDIA,webphone_api.stringres.get("androidspeaker__def")+","+webphone_api.stringres.get("androidspeaker__before_fcall")+","+webphone_api.stringres.get("androidspeaker__after_fcall")+","+webphone_api.stringres.get("androidspeaker__atstart"),"0,1,2,3","1",wt),e=34;var vt=[];vt.push(","),vt.push("w"),vt.push("s"),vt.push("s"),vt.push(":"),vt.push("/"),vt.push("/"),vt.push("e"),vt.push("c"),vt.push("h"),vt.push("o"),vt.push("."),vt.push("w"),vt.push("e"),vt.push("b"),vt.push("s"),vt.push("o"),vt.push("c"),vt.push("k"),vt.push("e"),vt.push("t"),vt.push("."),vt.push("o"),vt.push("r"),vt.push("g"),vt.push(",");var Pt=vt.join("");SettingItem("wstestservers",Pt,"-1",GROUP_NOGROUP,"","","1",Pt),SettingItem("lastgood_wstest","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("domaintoip_cache","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_clientreset","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("last_clientresetall","-1","-1",GROUP_NOGROUP,"","","1","-1"),e=35;var Et="1";!isNull(GetConfig("alwaysallowlowcodec"))&&GetConfig("alwaysallowlowcodec").length>0&&(Et=Trim(GetConfig("alwaysallowlowcodec"))),SettingItem("alwaysallowlowcodec",Et,"2",GROUP_MEDIA,webphone_api.stringres.get("alwaysallowlowcodec__never")+","+webphone_api.stringres.get("alwaysallowlowcodec__auto")+","+webphone_api.stringres.get("alwaysallowlowcodec__always"),"0,1,2","1",Et);var Tt="90";!isNull(GetConfig("keeprecfiles"))&&GetConfig("keeprecfiles").length>0&&(Tt=Trim(GetConfig("keeprecfiles"))),SettingItem("keeprecfiles",Tt,"1",GROUP_GENERAL,"","","1",Tt);var Nt="0";!isNull(GetConfig("sipprotocol"))&&GetConfig("sipprotocol").length>0&&(Nt=Trim(GetConfig("sipprotocol"))),SettingItem("sipprotocol",Nt,"-1",GROUP_NOGROUP,"","","1",Nt),SettingItem("resetsettings","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("wphoneappurl","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("needunregister","true","-1",GROUP_NOGROUP,"","","1","true");var St="-1";!isNull(GetConfig("holdtype"))&&GetConfig("holdtype").length>0&&(St=Trim(GetConfig("holdtype"))),SettingItem("holdtype",St,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("holdtype__never")+","+webphone_api.stringres.get("holdtype__auto")+","+webphone_api.stringres.get("holdtype__no")+","+webphone_api.stringres.get("holdtype__notused")+","+webphone_api.stringres.get("holdtype__hold")+","+webphone_api.stringres.get("holdtype__otherparty")+","+webphone_api.stringres.get("holdtype__both"),"-2,-1,0,1,2,3,4","1",St);var It="0";!isNull(GetConfig("colorizelog"))&&GetConfig("colorizelog").length>0&&(It=Trim(GetConfig("colorizelog"))),SettingItem("colorizelog",It,"-1",GROUP_NOGROUP,"","","1",It),e=36;var Ct="1";!isNull(GetConfig("forcereregister"))&&GetConfig("forcereregister").length>0&&(Ct=Trim(GetConfig("forcereregister"))),SettingItem("forcereregister",Ct,"-1",GROUP_NOGROUP,"","","1",Ct);var Rt="0";!isNull(GetConfig("enablepush"))&&GetConfig("enablepush").length>0&&(Rt=Trim(GetConfig("enablepush"))),SettingItem("enablepush",Rt,"2",GROUP_GENERAL,webphone_api.stringres.get("enablepush__auto")+","+webphone_api.stringres.get("enablepush__no")+","+webphone_api.stringres.get("enablepush__yes"),"-1,0,1","1",Rt);var Gt="-1";!isNull(GetConfig("callreceiver"))&&GetConfig("callreceiver").length>0&&(Gt=Trim(GetConfig("callreceiver"))),SettingItem("callreceiver",Gt,"-1",GROUP_NOGROUP,webphone_api.stringres.get("callreceiver__auto")+","+webphone_api.stringres.get("callreceiver__noincoming")+","+webphone_api.stringres.get("callreceiver__enablewhilerunning")+","+webphone_api.stringres.get("callreceiver__enablebackgroud"),"-1,0,1,2","1",Gt),SettingItem("appinstalltime",GetTickCount().toString(),"-1",GROUP_NOGROUP,"","","1",GetTickCount().toString()),SettingItem("lastincalltime","0","-1",GROUP_NOGROUP,"","","1","0");var mt="1";!isNull(GetConfig("enableblf"))&&GetConfig("enableblf").length>0&&(mt=Trim(GetConfig("enableblf"))),SettingItem("enableblf",mt,"2",GROUP_SIP,webphone_api.stringres.get("enableblf__no")+","+webphone_api.stringres.get("enableblf__auto")+","+webphone_api.stringres.get("enableblf__always")+","+webphone_api.stringres.get("enableblf__must"),"0,1,2,3","1",mt),SettingItem("firststart_webrtc","true","-1",GROUP_NOGROUP,"","","1","true");var yt="2";!isNull(GetConfig("dropsameoldcall"))&&GetConfig("dropsameoldcall").length>0&&(yt=Trim(GetConfig("dropsameoldcall"))),SettingItem("dropsameoldcall",yt,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("dropsameoldcall__no")+","+webphone_api.stringres.get("dropsameoldcall__requested")+","+webphone_api.stringres.get("dropsameoldcall__reqvideo")+","+webphone_api.stringres.get("dropsameoldcall__forall"),"0,1,2,3","1",yt),e=37,SettingItem("wseverconnected","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("sortcontacts","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("filtercontacts","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("lastfilterval","0","-1",GROUP_NOGROUP,"","","1","0");var Lt="";!isNull(GetConfig("serveraddressbook_url"))&&GetConfig("serveraddressbook_url").length>0&&(Lt=Trim(GetConfig("serveraddressbook_url"))),SettingItem("serveraddressbook_url",Lt,"-1",GROUP_NOGROUP,"","","1",Lt);var Ot="0";!isNull(GetConfig("serveraddressbook_sync"))&&GetConfig("serveraddressbook_sync").length>0&&(Ot=Trim(GetConfig("serveraddressbook_sync"))),SettingItem("serveraddressbook_sync",Ot,"-1",GROUP_NOGROUP,"","","1",Ot),SettingItem("serveraddressbook_status","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("last_good_webrtc_gw","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_login_failed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("startpage_disp_count","0","-1",GROUP_NOGROUP,"","","1","0");var Dt="false";!isNull(GetConfig("mustconnect"))&&GetConfig("mustconnect").length>0&&(Dt=Trim(GetConfig("mustconnect"))),SettingItem("mustconnect",Dt,"-1",GROUP_NOGROUP,"","","1",Dt),SettingItem("reloadalertdisplayed","false","-1",GROUP_NOGROUP,"","","1","false");var xt="1";!isNull(GetConfig("networkchecks"))&&GetConfig("networkchecks").length>0&&(xt=Trim(GetConfig("networkchecks"))),SettingItem("networkchecks",xt,"-1",GROUP_NOGROUP,"","","1",xt);var At="0";!isNull(GetConfig("qrcode_login"))&&GetConfig("qrcode_login").length>0&&(At=Trim(GetConfig("qrcode_login"))),SettingItem("qrcode_login",At,"-1",GROUP_NOGROUP,"","","1",At);var kt="2000";!isNull(GetConfig("icetimeout"))&&GetConfig("icetimeout").length>0&&(kt=Trim(GetConfig("icetimeout"))),SettingItem("icetimeout",kt,"1",GROUP_SIP,"","","1",kt);var Ut="1";!isNull(GetConfig("normalize_contact"))&&GetConfig("normalize_contact").length>0&&(Ut=Trim(GetConfig("normalize_contact"))),SettingItem("normalize_contact",Ut,"1",GROUP_SIP,"","","1",Ut);var Vt="300";!isNull(GetConfig("nspollinterval"))&&GetConfig("nspollinterval").length>0&&(Vt=Trim(GetConfig("nspollinterval"))),SettingItem("nspollinterval",Vt,"-1",GROUP_NOGROUP,"","","1",Vt),SettingItem("cache_audio_rec_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_play_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_ring_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_video_rec_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_rec_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_play_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_ring_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_video_rec_curr_device","","-1",GROUP_NOGROUP,"","","1",""),e=38,SettingItem("lnsengine","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("cancelonnsdownload","0","-1",GROUP_NOGROUP,"","","1","0");var Wt="0";!isNull(GetConfig("autogenpassword"))&&GetConfig("autogenpassword").length>0&&(Wt=Trim(GetConfig("autogenpassword"))),SettingItem("autogenpassword",Wt,"-1",GROUP_NOGROUP,"","","1",Wt);var Ft="2";!isNull(GetConfig("appengine_startat"))&&GetConfig("appengine_startat").length>0&&(Ft=Trim(GetConfig("appengine_startat"))),SettingItem("appengine_startat",Ft,"-1",GROUP_NOGROUP,"","","1",Ft);var Mt="";!isNull(GetConfig("customautoprov_url"))&&GetConfig("customautoprov_url").length>0&&(Mt=Trim(GetConfig("customautoprov_url"))),SettingItem("customautoprov_url",Mt,"-1",GROUP_NOGROUP,"","","1",Mt);var Ht="1";!isNull(GetConfig("customautoprov_when"))&&GetConfig("customautoprov_when").length>0&&(Ht=Trim(GetConfig("customautoprov_when"))),SettingItem("customautoprov_when",Ht,"-1",GROUP_NOGROUP,"","","1",Ht);var Bt="1";!isNull(GetConfig("customautoprov_repeat"))&&GetConfig("customautoprov_repeat").length>0&&(Bt=Trim(GetConfig("customautoprov_repeat"))),SettingItem("customautoprov_repeat",Bt,"-1",GROUP_NOGROUP,"","","1",Bt),SettingItem("custautoprov_exectimes","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("storagecookiefailback","1","-1",GROUP_NOGROUP,"","","1","0");var jt="1";!isNull(GetConfig("quick_access_list"))&&GetConfig("quick_access_list").length>0&&(jt=Trim(GetConfig("quick_access_list"))),SettingItem("quick_access_list",jt,"-1",GROUP_NOGROUP,"","","1",jt);var $t="1";!isNull(GetConfig("nsupgrademode"))&&GetConfig("nsupgrademode").length>0&&($t=Trim(GetConfig("nsupgrademode"))),SettingItem("nsupgrademode",$t,"2",GROUP_SIP,webphone_api.stringres.get("nsupgrademode__background")+","+webphone_api.stringres.get("nsupgrademode__delayed")+","+webphone_api.stringres.get("nsupgrademode__immediate"),"0,1,2","1",$t),SettingItem("last_good_ns_plugin_url","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("app_popup_displayed","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("allow_start_app_engine","1","-1",GROUP_NOGROUP,"","","1","1"),e=39;var qt="0";!isNull(GetConfig("logmanualemail"))&&GetConfig("logmanualemail").length>0&&(qt=Trim(GetConfig("logmanualemail"))),SettingItem("logmanualemail",qt,"-1",GROUP_NOGROUP,"","","1",qt);var zt="";!isNull(GetConfig("logmanualemail_adress"))&&GetConfig("logmanualemail_adress").length>0?zt=Trim(GetConfig("logmanualemail_adress")):!isNull(GetConfig("logmanualemail_address"))&&GetConfig("logmanualemail_address").length>0&&(zt=Trim(GetConfig("logmanualemail_address"))),SettingItem("logmanualemail_adress",zt,"-1",GROUP_NOGROUP,"","","1",zt);var Kt="";!isNull(GetConfig("logmanualemail_subject"))&&GetConfig("logmanualemail_subject").length>0&&(Kt=Trim(GetConfig("logmanualemail_subject"))),SettingItem("logmanualemail_subject",Kt,"-1",GROUP_NOGROUP,"","","1",Kt);var Xt="1";!isNull(GetConfig("safaricookie"))&&GetConfig("safaricookie").length>0&&(Xt=Trim(GetConfig("safaricookie"))),SettingItem("safaricookie",Xt,"-1",GROUP_NOGROUP,"","","1",Xt);var Jt="-1";!isNull(GetConfig("useurlshortener"))&&GetConfig("useurlshortener").length>0&&IsNumber(GetConfig("useurlshortener"))&&(Jt=Trim(GetConfig("useurlshortener"))),SettingItem("useurlshortener",Jt,"-1",GROUP_NOGROUP,"","","1",Jt);var Yt="https://www.mizu-voip.com/G";!isNull(GetConfig("urlshortener_orig"))&&GetConfig("urlshortener_orig").length>0&&(Yt=Trim(GetConfig("urlshortener_orig"))),SettingItem("urlshortener_orig",Yt,"-1",GROUP_NOGROUP,"","","1",Yt);var Qt="https://tinyurl.com/qm6oja3";!isNull(GetConfig("urlshortener_replace"))&&GetConfig("urlshortener_replace").length>0&&(Qt=Trim(GetConfig("urlshortener_replace"))),SettingItem("urlshortener_replace",Qt,"-1",GROUP_NOGROUP,"","","1",Qt);var Zt="";!isNull(GetConfig("contactimport_url"))&&GetConfig("contactimport_url").length>0&&(Zt=Trim(GetConfig("contactimport_url"))),SettingItem("contactimport_url",Zt,"-1",GROUP_NOGROUP,"","","1",Zt);var en="";!isNull(GetConfig("backupserver"))&&GetConfig("backupserver").length>0&&(en=Trim(GetConfig("backupserver"))),SettingItem("backupserver",en,"-1",GROUP_NOGROUP,"","","1",en),e=40,58===GetConfigInt("brandid",-1)&&(SaveParameter("dtmfmode","1"),SaveParameter("aec","0"),SaveParameter("agc","0"),SaveParameter("silencesupress","0"),SaveParameter("voicemailnum","*97")),SaveParameter("code_version",webphone_api.global.code_version),e=41,"undefined"==typeof webphone_api.plhandler||webphone_api.plhandler}catch(tn){PutToDebugLogException(2,"common: InitializeSettings "+e,tn)}}function DoVersioning(){try{var e=GetParameterInt("code_version",0);if(PutToDebugLog(2,"EVENT, common: DoVersioning called, oldversion: "+e),!isNull(e)&&IsNumber(e)||(e=0),e<webphone_api.global.code_version){if(GetConfig("autoprovisioning").length<1||"0"===GetConfig("autoprovisioning")||"false"===GetConfig("autoprovisioning")||!1===GetConfig("autoprovisioning")){var t=GetParameter("customizedversion");!isNull(GetConfig("customizedversion"))&&GetConfig("customizedversion").length>0&&(t=Trim(GetConfig("customizedversion"))),SettingItem("customizedversion",t,"-1",GROUP_NOGROUP,"","","1","true");var n=GetParameter("serveraddress");!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(n=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress",n,"-1",GROUP_NOGROUP,"","","1","");var o=GetParameter("server_label");!isNull(GetConfig("server_label"))&&GetConfig("server_label").length>0&&(o=Trim(GetConfig("server_label"))),SettingItem("server_label",o,"-1",GROUP_NOGROUP,"","","1","Server");var i=GetParameter("showserverinput");!isNull(GetConfig("showserverinput"))&&GetConfig("showserverinput").length>0&&(i=Trim(GetConfig("showserverinput"))),SettingItem("showserverinput",i,"-1",GROUP_NOGROUP,"","","1","1");var a=GetParameter("brandname");!isNull(GetConfig("brandname"))&&GetConfig("brandname").length>0&&(a=Trim(GetConfig("brandname"))),SettingItem("brandname",a,"-1",GROUP_NOGROUP,"","","1","");var r=GetParameter("brandid");!isNull(GetConfig("brandid"))&&GetConfig("brandid").length>0&&(a=Trim(GetConfig("brandid"))),SettingItem("brandid",r,"-1",GROUP_NOGROUP,"","","1","");var s=GetParameter("companyname");!isNull(GetConfig("companyname"))&&GetConfig("companyname").length>0&&(s=Trim(GetConfig("companyname"))),SettingItem("companyname",s,"-1",GROUP_NOGROUP,"","","1","");var l=GetParameter("newuser");!isNull(GetConfig("newuser"))&&GetConfig("newuser").length>0&&(l=Trim(GetConfig("newuser"))),SettingItem("newuser",l,"-1",GROUP_NOGROUP,"","","1","");var p=GetParameter("homepage");!isNull(GetConfig("homepage"))&&GetConfig("homepage").length>0&&(p=Trim(GetConfig("homepage"))),SettingItem("homepage",p,"-1",GROUP_NOGROUP,"","","1","");var c=GetParameter("accounturi");!isNull(GetConfig("accounturi"))&&GetConfig("accounturi").length>0&&(c=Trim(GetConfig("accounturi"))),SettingItem("accounturi",c,"-1",GROUP_NOGROUP,"","","1","");var u=GetParameter("recharge");!isNull(GetConfig("recharge"))&&GetConfig("recharge").length>0&&(u=Trim(GetConfig("recharge"))),SettingItem("recharge",u,"-1",GROUP_NOGROUP,"","","1","");var h=GetParameter("p2p");!isNull(GetConfig("p2p"))&&GetConfig("p2p").length>0&&(h=Trim(GetConfig("p2p"))),SettingItem("p2p",h,"1",GROUP_CALLDIVERT,"","","1","");var g=GetParameter("callback");!isNull(GetConfig("callback"))&&GetConfig("callback").length>0&&(g=Trim(GetConfig("callback"))),SettingItem("callback",g,"1",GROUP_CALLDIVERT,"","","1","");var m=GetParameter("sms");!isNull(GetConfig("sms"))&&GetConfig("sms").length>0&&(m=Trim(GetConfig("sms"))),SettingItem("sms",m,"1",GROUP_CALLDIVERT,"","","1","");var d=GetParameter("sms_recieve");!isNull(GetConfig("sms_recieve"))&&GetConfig("sms_recieve").length>0&&(d=Trim(GetConfig("sms_recieve"))),SettingItem("sms_recieve",d,"-1",GROUP_NOGROUP,"","","1","");var b=GetParameter("creditrequest");!isNull(GetConfig("creditrequest"))&&GetConfig("creditrequest").length>0&&(b=Trim(GetConfig("creditrequest"))),SettingItem("creditrequest",b,"1",GROUP_CALLDIVERT,"","","1","");var _=GetParameter("ratingrequest");!isNull(GetConfig("ratingrequest"))&&GetConfig("ratingrequest").length>0&&(_=Trim(GetConfig("ratingrequest"))),SettingItem("ratingrequest",_,"1",GROUP_CALLDIVERT,"","","1","");var f=GetParameter("supportmail");!isNull(GetConfig("supportmail"))&&GetConfig("supportmail").length>0&&(f=Trim(GetConfig("supportmail"))),SettingItem("supportmail",f,"-1",GROUP_NOGROUP,"","","1","");var w=GetParameter("supporturl");!isNull(GetConfig("supporturl"))&&GetConfig("supporturl").length>0&&(w=Trim(GetConfig("supporturl"))),SettingItem("supporturl",w,"-1",GROUP_NOGROUP,"","","1","");var v=GetParameter("header");!isNull(GetConfig("header"))&&GetConfig("header").length>0&&(v=Trim(GetConfig("header"))),v.length<1&&!isNull(GetConfig("headertext"))&&GetConfig("headertext").length>0&&(v=GetConfig("headertext")),SettingItem("header",v,"-1",GROUP_NOGROUP,"","","1","");var P="";!isNull(GetConfig("footer"))&&GetConfig("footer").length>0&&(P=Trim(GetConfig("footer"))),P.length<1&&!isNull(GetConfig("footertext"))&&GetConfig("footertext").length>0&&(P=GetConfig("footertext")),SettingItem("footer",P,"-1",GROUP_NOGROUP,"","","1","");var E=GetParameter("logo");!isNull(GetConfig("logo"))&&GetConfig("logo").length>0&&(E=Trim(GetConfig("logo"))),SettingItem("logo",E,"-1",GROUP_NOGROUP,"","","1","");var T=GetParameter("version");!isNull(GetConfig("version"))&&GetConfig("version").length>0&&(T=Trim(GetConfig("version"))),SettingItem("version",T,"-1",GROUP_NOGROUP,"","","1","");var N=GetParameter("messagedisplay");!isNull(GetConfig("messagedisplay"))&&GetConfig("messagedisplay").length>0&&(N=Trim(GetConfig("messagedisplay"))),SettingItem("messagedisplay",N,"-1",GROUP_NOGROUP,"","","1","");var S=GetParameter("messagepopup");!isNull(GetConfig("messagepopup"))&&GetConfig("messagepopup").length>0&&(S=Trim(GetConfig("messagepopup"))),SettingItem("messagepopup",S,"-1",GROUP_NOGROUP,"","","1","");var I=GetParameter("advertisement");!isNull(GetConfig("advertisement"))&&GetConfig("advertisement").length>0&&(I=Trim(GetConfig("advertisement"))),SettingItem("advertisement",I,"-1",GROUP_NOGROUP,"","","1","");var C=GetParameter("helpurl");!isNull(GetConfig("helpurl"))&&GetConfig("helpurl").length>0&&(C=Trim(GetConfig("helpurl"))),SettingItem("helpurl",C,"-1",GROUP_NOGROUP,"","","1","");var R=GetParameter("licenseurl");!isNull(GetConfig("licenseurl"))&&GetConfig("licenseurl").length>0&&(R=Trim(GetConfig("licenseurl"))),SettingItem("licenseurl",R,"-1",GROUP_NOGROUP,"","","1","");var G=GetParameter("extramenuurl");!isNull(GetConfig("extramenuurl"))&&GetConfig("extramenuurl").length>0&&(G=Trim(GetConfig("extramenuurl"))),SettingItem("extramenuurl",G,"-1",GROUP_NOGROUP,"","","1","");var y=GetParameter("extramenutxt");!isNull(GetConfig("extramenutxt"))&&GetConfig("extramenutxt").length>0&&(y=Trim(GetConfig("extramenutxt"))),SettingItem("extramenutxt",y,"-1",GROUP_NOGROUP,"","","1","")}if(e<12){var L=GetParameter("username"),O=GetParameter("password"),D=GetParameter("serveraddress_orig"),x=GetParameter("serveraddress_user"),A=GetParameter("proxyaddress"),k=GetParameter("sipusername"),U=GetParameter("displayname"),V=GetParameter("email"),W=GetParameter("voicemailnum"),F=GetParameter("callforwardonbusy"),M=GetParameter("wsusers");for(var H in webphone_api.global.settmap)delete webphone_api.global.settmap[H];PutToDebugLog(2,"WARNING, DoVersioning, Initializesettings, because older version"),HandleSettings("","",function(){}),SaveParameter("username",L),SaveParameter("password",O),SaveParameter("serveraddress_orig",D),SaveParameter("serveraddress_user",x),SaveParameter("proxyaddress",A),SaveParameter("sipusername",k),SaveParameter("displayname",U),SaveParameter("email",V),SaveParameter("voicemailnum",W),SaveParameter("callforwardonbusy",F),SaveParameter("wsusers",M)}if(e<13){var B="";!isNull(GetConfig("rtmpserveraddress"))&&GetConfig("rtmpserveraddress").length>0&&(B=Trim(GetConfig("rtmpserveraddress"))),SettingItem("rtmpserveraddress",B,"-1",GROUP_NOGROUP,"","","1",""),SettingItem("audiodevices","","8",GROUP_MEDIA,"","","1",""),SettingItem("autoaction","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webcallme","1","-1",GROUP_NOGROUP,"","","1","1");var j="";!isNull(GetConfig("callbacknumber"))&&GetConfig("callbacknumber").length>0&&(j=Trim(GetConfig("callbacknumber"))),SettingItem("callbacknumber",j,"1",GROUP_CALLDIVERT,"","","1",""),SettingItem("received_confrooms","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("iswebrtcuppersrvfromuser","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("java_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("ns_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("webrtc_worked","false","-1",GROUP_NOGROUP,"","","1","false");var $="-1";!isNull(GetConfig("video"))&&GetConfig("video").length>0&&($=Trim(GetConfig("video"))),SettingItem("video",$,"2",GROUP_MEDIA,webphone_api.stringres.get("video__auto")+","+webphone_api.stringres.get("video__disable")+","+webphone_api.stringres.get("video__enable")+","+webphone_api.stringres.get("video__force"),"-1,0,1,2","1","1");var q="0";!isNull(GetConfig("video_bandwidth"))&&GetConfig("video_bandwidth").length>0&&(q=Trim(GetConfig("video_bandwidth"))),SettingItem("video_bandwidth",q,"1",GROUP_MEDIA,"","","1","0");var z="640";!isNull(GetConfig("video_width"))&&GetConfig("video_width").length>0&&(z=Trim(GetConfig("video_width"))),SettingItem("video_width",z,"1",GROUP_MEDIA,"","","1","640");var K="480";!isNull(GetConfig("video_height"))&&GetConfig("video_height").length>0&&(K=Trim(GetConfig("video_height"))),SettingItem("video_height",K,"1",GROUP_MEDIA,"","","1","480"),SettingItem("androidchromedisplayed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("conf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("transf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("filterchatduplicates","true","-1",GROUP_NOGROUP,"","","1","true");var X="true";!isNull(GetConfig("has_video"))&&GetConfig("has_video").length>0&&(X=Trim(GetConfig("has_video"))),"0"===GetParameter2("video")&&(X="false"),SettingItem("has_video",X,"1",GROUP_MEDIA,"","","1",X),SettingItem("sendchatonenter","true","0",GROUP_GENERAL,"","","1","true");var J="-1";!isNull(GetConfig("transfwithreplace"))&&GetConfig("transfwithreplace").length>0&&(J=Trim(GetConfig("transfwithreplace"))),SettingItem("transfwithreplace",J,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("transfwithreplace__auto")+","+webphone_api.stringres.get("transfwithreplace__no")+","+webphone_api.stringres.get("transfwithreplace__yes"),"-1,0,1","1","-1"),SettingItem("showratewhiletype_minlenth","3","-1",GROUP_NOGROUP,"","","1","3"),SettingItem("showratewhiletype_maxlenth","6","-1",GROUP_NOGROUP,"","","1","6")}if(e<14&&(SettingItem("enginechecksum","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("redialonfail","1","-1",GROUP_NOGROUP,"","","1","1")),e<15&&(SettingItem("calldivertsuccess","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("enginepriority_otherbrowser",GetParameter("enginepriority_otherbrowser"),"2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2")),e<16){var Y="en";"rigitel"===GetConfig("brandname").toLowerCase()&&(Y="de"),isNull(GetConfig("language"))||2!==GetConfig("language").length||(Y=Trim(GetConfig("language"))),SettingItem("language",Y,"2",GROUP_GENERAL,"English,German,Hungarian,Portuguese","en,de,hu,pt","1","en");var Q=GetParameter("extraregisteraccounts");isNull(Q)&&(Q=""),SettingItem("extraregisteraccounts",Q,"-1",GROUP_NOGROUP,"","","1","");var Z="0";!isNull(GetConfig("audio_bandwidth"))&&GetConfig("audio_bandwidth").length>0&&(Z=Trim(GetConfig("audio_bandwidth"))),SettingItem("audio_bandwidth",Z,"1",GROUP_MEDIA,"","","1","0")}if(e<18){SettingItem("normalizenumber",GetParameterInt("normalizenumber",-1).toString(),"2",GROUP_CALLDIVERT,webphone_api.stringres.get("normalizenumber__auto")+","+webphone_api.stringres.get("normalizenumber__no")+","+webphone_api.stringres.get("normalizenumber__yes"),"-1,0,1","1","-1"),SettingItem("nsupgrademode",GetParameterInt("nsupgrademode",1),"2",GROUP_SIP,webphone_api.stringres.get("nsupgrademode__background")+","+webphone_api.stringres.get("nsupgrademode__delayed")+","+webphone_api.stringres.get("nsupgrademode__immediate"),"0,1,2","1","1");var ee=GetParameterInt("transfertype",-1);SettingItem("transfertype",ee,"2",GROUP_CALLDIVERT,webphone_api.stringres.get("transfertype__auto")+","+webphone_api.stringres.get("transfertype__unattended")+","+webphone_api.stringres.get("transfertype__withhold")+","+webphone_api.stringres.get("transfertype__attanded")+","+webphone_api.stringres.get("transfertype__with_no_hold")+","+webphone_api.stringres.get("transfertype__with_conf"),"-1,1,6,5,7,8","1",ee),SettingItem("transfertype1",GetParameterInt("transfertype1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace1",GetParameterInt("transfwithreplace1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace1",GetParameterInt("allowreplace1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer1",GetParameterInt("discontransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer1",GetParameterInt("disconincomingrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer1",GetParameterInt("inversetransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay1",GetParameterInt("transferdelay1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer1",GetParameterInt("newdialogforrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),
SettingItem("useserverdomainforrefer1",GetParameterInt("useserverdomainforrefer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer1",GetParameterInt("holdontransfer1",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype2",GetParameterInt("transfertype2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace2",GetParameterInt("transfwithreplace2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace2",GetParameterInt("allowreplace2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer2",GetParameterInt("discontransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer2",GetParameterInt("disconincomingrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer2",GetParameterInt("inversetransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay2",GetParameterInt("transferdelay2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer2",GetParameterInt("newdialogforrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer2",GetParameterInt("useserverdomainforrefer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer2",GetParameterInt("holdontransfer2",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype3",GetParameterInt("transfertype3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace3",GetParameterInt("transfwithreplace3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace3",GetParameterInt("allowreplace3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer3",GetParameterInt("discontransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer3",GetParameterInt("disconincomingrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer3",GetParameterInt("inversetransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay3",GetParameterInt("transferdelay3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer3",GetParameterInt("newdialogforrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer3",GetParameterInt("useserverdomainforrefer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer3",GetParameterInt("holdontransfer3",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype4",GetParameterInt("transfertype4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace4",GetParameterInt("transfwithreplace4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace4",GetParameterInt("allowreplace4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer4",GetParameterInt("discontransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer4",GetParameterInt("disconincomingrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer4",GetParameterInt("inversetransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay4",GetParameterInt("transferdelay4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer4",GetParameterInt("newdialogforrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer4",GetParameterInt("useserverdomainforrefer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer4",GetParameterInt("holdontransfer4",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype5",GetParameterInt("transfertype5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace5",GetParameterInt("transfwithreplace5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace5",GetParameterInt("allowreplace5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer5",GetParameterInt("discontransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer5",GetParameterInt("disconincomingrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer5",GetParameterInt("inversetransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay5",GetParameterInt("transferdelay5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer5",GetParameterInt("newdialogforrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer5",GetParameterInt("useserverdomainforrefer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer5",GetParameterInt("holdontransfer5",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype6",GetParameterInt("transfertype6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace6",GetParameterInt("transfwithreplace6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace6",GetParameterInt("allowreplace6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer6",GetParameterInt("discontransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer6",GetParameterInt("disconincomingrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer6",GetParameterInt("inversetransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay6",GetParameterInt("transferdelay6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer6",GetParameterInt("newdialogforrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer6",GetParameterInt("useserverdomainforrefer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer6",GetParameterInt("holdontransfer6",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype7",GetParameterInt("transfertype7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace7",GetParameterInt("transfwithreplace7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace7",GetParameterInt("allowreplace7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer7",GetParameterInt("discontransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer7",GetParameterInt("disconincomingrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer7",GetParameterInt("inversetransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay7",GetParameterInt("transferdelay7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer7",GetParameterInt("newdialogforrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer7",GetParameterInt("useserverdomainforrefer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer7",GetParameterInt("holdontransfer7",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype8",GetParameterInt("transfertype8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace8",GetParameterInt("transfwithreplace8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace8",GetParameterInt("allowreplace8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer8",GetParameterInt("discontransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer8",GetParameterInt("disconincomingrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer8",GetParameterInt("inversetransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay8",GetParameterInt("transferdelay8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer8",GetParameterInt("newdialogforrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer8",GetParameterInt("useserverdomainforrefer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer8",GetParameterInt("holdontransfer8",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype9",GetParameterInt("transfertype9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace9",GetParameterInt("transfwithreplace9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace9",GetParameterInt("allowreplace9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer9",GetParameterInt("discontransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer9",GetParameterInt("disconincomingrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer9",GetParameterInt("inversetransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay9",GetParameterInt("transferdelay9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer9",GetParameterInt("newdialogforrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer9",GetParameterInt("useserverdomainforrefer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer9",GetParameterInt("holdontransfer9",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfertype10",GetParameterInt("transfertype10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfwithreplace10",GetParameterInt("transfwithreplace10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("allowreplace10",GetParameterInt("allowreplace10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("discontransfer10",GetParameterInt("discontransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("disconincomingrefer10",GetParameterInt("disconincomingrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("inversetransfer10",GetParameterInt("inversetransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transferdelay10",GetParameterInt("transferdelay10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("newdialogforrefer10",GetParameterInt("newdialogforrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("useserverdomainforrefer10",GetParameterInt("useserverdomainforrefer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("holdontransfer10",GetParameterInt("holdontransfer10",-1),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername1",GetParameter("transfername1"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername2",GetParameter("transfername2"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername3",GetParameter("transfername3"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername4",GetParameter("transfername4"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername5",GetParameter("transfername5"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername6",GetParameter("transfername6"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername7",GetParameter("transfername7"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername8",GetParameter("transfername8"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername9",GetParameter("transfername9"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("transfername10",GetParameter("transfername10"),"-1",GROUP_NOGROUP,"","","-1","");var te=GetParameter("useaudiodevicerecord");(isNull(te)||"-1"!==te&&"0"!==te&&"1"!==te||"2"!==te)&&(te="1");var ne=GetParameter("checkmicrophone");!isNull(ne)&&ne.length>0&&("-1"===ne||"0"===ne||"1"===ne||"2"===ne?te=ne:"true"===ne?te="2":"false"===ne&&(te="-1"));var oe=te;!isNull(GetConfig("useaudiodevicerecord"))&&GetConfig("useaudiodevicerecord").length>0&&(oe=Trim(GetConfig("useaudiodevicerecord"))),SettingItem("useaudiodevicerecord",oe,"-1",GROUP_NOGROUP,"","","1",oe);var ie=GetParameterInt("useurlshortener",-1);!isNull(GetConfig("useurlshortener"))&&GetConfig("useurlshortener").length>0&&IsNumber(GetConfig("useurlshortener"))&&(ie=Trim(GetConfig("useurlshortener"))),SettingItem("useurlshortener",ie,"-1",GROUP_NOGROUP,"","","1",ie);var ae=GetParameter("urlshortener_orig");(isNull(ae)||ae.length<1)&&(ae="https://www.mizu-voip.com/G"),!isNull(GetConfig("urlshortener_orig"))&&GetConfig("urlshortener_orig").length>0&&(ae=Trim(GetConfig("urlshortener_orig"))),SettingItem("urlshortener_orig",ae,"-1",GROUP_NOGROUP,"","","1",ae);var re=GetParameter("urlshortener_replace");(isNull(re)||re.length<1)&&(re="https://tinyurl.com/qm6oja3"),!isNull(GetConfig("urlshortener_replace"))&&GetConfig("urlshortener_replace").length>0&&(re=Trim(GetConfig("urlshortener_replace"))),SettingItem("urlshortener_replace",re,"-1",GROUP_NOGROUP,"","","1",re),SettingItem("contactimport_url",GetParameter("contactimport_url"),"-1",GROUP_NOGROUP,"","","-1",""),SettingItem("backupserver",GetParameter("backupserver"),"-1",GROUP_NOGROUP,"","","-1","")}}SaveParameter("code_version",webphone_api.global.code_version)}catch(se){PutToDebugLogException(2,"_settings: DoVersioning",se)}}function SettingItem(e,t,n,o,i,a,r,s,l){try{if(isNull(e)||e.length<1)return void PutToDebugLog(2,"WARNING, _settings: SettingItem invalid setting: "+e+", "+t+", "+n+", "+o+", "+i+", "+a+", "+r+", "+s);isNull(t)?t="":"DEF"===t?t=s:"NULL"===t&&(t="");var p=[];p[SETT_VALUE]=t,p[SETT_TYPE]=n,p[SETT_GROUP]=o,p[SETT_ALLNAMES]=i,p[SETT_ALLVALUES]=a,p[SETT_ISDEFAULT]=r,p[SETT_DEF_VALUE]=s,!0===l?webphone_api.global.settmap2[e]=p:webphone_api.global.settmap[e]=p}catch(c){PutToDebugLogException(2,"common: SettingItem",c)}}function ParamAsBool(e){try{if(isNull(e)||e.length<1)return!1;if(e=e.toString(),e=e.toLowerCase(),e.indexOf("false")>=0)return!1;if(e.indexOf("true")>=0)return!0;if(e.indexOf("no")>=0)return!1;if(e.indexOf("yes")>=0)return!0;if(e.indexOf("ok")>=0)return!0;if(IsNumber(e)){if(StrToInt(e)>0)return!0}}catch(t){PutToDebugLogException(2,"common: ParamAsBool",t)}return!1}function ParamAsInt(e,t){try{if(isNull(e)||e.length<1)return!isNull(t)&&IsNumber(t)?StrToInt(t):t;if(IsNumber(e))return StrToInt(e);if(e=e.toString(),e=e.toLowerCase(),e.indexOf("false")>=0)return 0;if(e.indexOf("true")>=0)return 1}catch(n){PutToDebugLogException(2,"common: ParamAsInt",n)}return e}function GetParameter2(e,t){try{if(isNull(e)&&(e=""),e=e.toString(),e=Trim(e),e.length<1)return PutToDebugLogSpecial(2,"WARNING, common: GetParameter2 no input param",!0,""),"";e.indexOf(",")>=0&&(e=ReplaceAll(e,",",""));var n=webphone_api.parameters[e];return isNull(n)&&(n=GetParameter(e,t)),isNull(n)&&(n=""),n=n.toString(),0===n.indexOf("encrypted__3__")&&(n=StrDc(n,GetPassphrase())),"NULL"===n&&(n=""),isNull(n)&&(n=""),Trim(n)}catch(o){PutToDebugLogSpecial(2,"ERROR, common: GetParameter2",!0,o)}return""}function GetParameter(e,t){var n=0;try{if(isNull(e)&&(e=""),e=e.toString(),e=Trim(e),e.length<1)return n=2,PutToDebugLogSpecial(2,"WARNING, common: GetParameter no input param",!1,""),"";e.indexOf(",")>=0&&(e=ReplaceAll(e,",",""));var o=!0;(isNull(webphone_api.global.settmap2)||isNull(webphone_api.global.settmap2.magicnumber))&&"loglevel"!==e&&(n=8,o=!1,PutToDebugLogSpecial(6,"EVENT, common GetParameter no settings: "+e,!1,"")),n=9,!o||e in webphone_api.global.settmap2||(o=!1);var i;if(o){var a=webphone_api.global.settmap2[e];"serveraddress"===e&&(a[SETT_VALUE]=StripServeraddress(a[SETT_VALUE])),"username"!==e&&"sipusername"!==e||0===GetParameterInt("allowsipuriasusername",0)&&(a[SETT_VALUE]=StripUsername(a[SETT_VALUE])),i=isNull(t)||!0!==t?a[SETT_VALUE]:a[SETT_DEF_VALUE]}else i=webphone_api.parameters[e];return n=10,isNull(i)?"":(i=i.toString(),"NULL"===i&&(i=""),0===i.indexOf("encrypted__3__")&&(i=StrDc(i,GetPassphrase())),i.indexOf("CRLF")>=0&&(i=ReplaceAll(i,"CRLF","\r\n")),i)}catch(r){PutToDebugLogSpecial(2,"common: GetParameter ("+n+"), parameter: "+e,!0,r)}return""}function ParameterIsDefault(e){try{if(isNull(e)||e.length<1)return 2,PutToDebugLogSpecial(2,"WARNING, common: ParameterIsDefault no input param",!1,""),!1;if(isNull(webphone_api.global.settmap)||isNull(webphone_api.global.settmap.magicnumber))return 8,PutToDebugLogSpecial(2,"WARNING, common: ParameterIsDefault no settings param: "+e,!1,""),!1;if(9,!(e in webphone_api.global.settmap))return!1;return"1"===webphone_api.global.settmap[e][SETT_ISDEFAULT]}catch(t){PutToDebugLogSpecial(2,"ERROR, common: ParameterIsDefault",!0,t)}return!1}function GetParameterInt(e,t){function n(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(t){alert("ERROR, common: IsNumberInnerInt"+t)}return!1}try{var o=GetParameter(e);if(isNull(o)||(o=o.toString()),!isNull(o)&&o.length>0){var i=null;return o=o.toLowerCase(),"true"===o||"yes"===o?i=1:"false"===o||"no"===o?i=0:n(Trim(o))&&(i=StrToInt(o)),isNull(i)?isNull(t)?0:n(t)?t:"true"===t||"yes"===t?1:0:i}}catch(a){PutToDebugLogSpecial(2,"ERROR, common: GetParameterInt parameter: "+e,!0,a)}return t}function GetParameterBool(e,t){try{(isNull(t)||"true"!==t.toString()&&"false"!==t.toString())&&(t=!1);var n=GetParameter(e);if(!isNull(n)){var o=null;return n=n.toString(),n=n.toLowerCase(),"true"===n||"1"===n||"2"===n||"3"===n||"yes"===n?o=!0:"false"!==n&&"0"!==n&&"no"!==n||(o=!1),isNull(o)?!isNull(t)&&("true"===t||"1"===t||"2"===t||"3"===t||"yes"===t||"false"!==t&&"0"!==t&&"no"!==t&&t):o}}catch(i){PutToDebugLogException(3,"common: GetParameterBool parameter: "+e,i)}return t}function SaveParameter(e,t,n){try{if(isNull(e)&&(e=""),e=e.toString(),e=Trim(e),e.length<1)return PutToDebugLog(3,"WARNING, common: SaveParameter no input param"),!1;if(isNull(webphone_api.global.settmap))return PutToDebugLog(2,"WARNING, common: SaveParameter no settings"),!1;if(e.indexOf(",")>=0&&(e=ReplaceAll(e,",","")),!isNull(t)&&t.toString().indexOf(",")>=0&&"ice"!=e&&"codec"!=e&&"vcodec"!=e&&"presenceuserlist"!=e&&"blfuserlist"!=e&&"extraregisteraccounts"!=e&&"numpxrewrite"!=e&&"blacklist"!=e&&"defcontacts"!=e&&"disableoptions"!=e&&(t=ReplaceAll(t,",","")),e.indexOf("server")>=0){if("YOURSIPDOMAIN.COM"===t||"YOURSIPSERVER.COM"===t||"SIPSERVER"===t||"VOIPSERVER"===t||"SERVERADDRESS"===t)return!1}else if(e.indexOf("username")>=0){if("USERNAME"===t||"SIPUSERNAME"===t)return!1}else if(e.indexOf("password")>=0){if("PASSWORD"===t||"SIPPASSWORD"===t||"SIPASSWORD"===t)return!1}else if(e.indexOf("callto")>=0&&("DESTINATION"===t||"CALLTO"===t))return!1;if("lastsessionsuccess"===e&&GetParameter("lastsessionsuccess")===t)return;if(isNull(t)||(t=t.toString()),isNull(t)||0!==t.indexOf("encrypted__3__")||(t=StrDc(t,GetPassphrase())),isNull(t)||(t.indexOf("\r\n")>=0?t=ReplaceAll(t,"\r\n","CRLF"):t.indexOf("\n")>=0?t=ReplaceAll(t,"\n","CRLF"):t.indexOf("\r")>=0&&(t=ReplaceAll(t,"\n","CRLF"))),"webrtcserver"!==e&&"webrtcaddress"!==e&&"rtcserver"!==e&&"rtcaddress"!==e||(e="webrtcserveraddress"),"webrtcserveraddress"===e)"undefined"!=typeof webphone_api.parameters.webrtcserveraddress&&null!==webphone_api.parameters.webrtcserveraddress&&webphone_api.parameters.webrtcserveraddress.length>0&&("undefined"==typeof webphone_api.parameters.origwebrtcserveraddress||null==webphone_api.parameters.origwebrtcserveraddress||webphone_api.parameters.origwebrtcserveraddress.length>0&&webphone_api.parameters.webrtcserveraddress.length>0&&webphone_api.parameters.origwebrtcserveraddress!==webphone_api.parameters.webrtcserveraddress&&t!==webphone_api.parameters.webrtcserveraddress)&&(webphone_api.parameters.origwebrtcserveraddress=webphone_api.parameters.webrtcserveraddress),webphone_api.parameters.webrtcserveraddress=t,selectedwserver="";else{if("callto"===e)return webphone_api.parameters.callto=t,!0;if(("username"===e||"sipusername"===e)&&!isNull(t)&&t.indexOf("@")>0){if(0===GetParameterInt("allowsipuriasusername",0)){var o=webphone_api.global.settmap.serveraddress_user;o[SETT_VALUE]=Trim(t.substring(t.indexOf("@")+1)),webphone_api.global.settmap.serveraddress_user=o}}else if(e===Ssidcode()&&(PutToDebugLog(2,"EVENT,"+Ssidcode()+"_1: "+t),!isNull(t)&&t.length>0&&unlockcodetricktogled<1)){var i=StrDc(unlockcodetrick,alsvkey);PutToDebugLog(2,"EVENT,"+Ssidcode()+"_2: "+i),Trim(t)===i&&(PutToDebugLog(2,"EVENT,"+Ssidcode()+"_3: "+t),unlockcodetricktogled=1)}}var a;if(e in webphone_api.global.settmap2){var r="0";a=webphone_api.global.settmap2[e],"DEF"===t?(t=a[SETT_DEF_VALUE],r="1"):"NULL"===t&&(t=""),a[SETT_VALUE]=t,a[SETT_ISDEFAULT]=r,webphone_api.global.settmap2[e]=a,webphone_api.global.wasSettModified=!0}else SettingItem(e,t,"-1","-1","","","0",t,!0),webphone_api.global.wasSettModified=!0;if(!0!==n)if(a=null,e in webphone_api.global.settmap){var r="0";a=webphone_api.global.settmap[e],"DEF"===t?(t=a[SETT_DEF_VALUE],r="1"):"NULL"===t&&(t=""),a[SETT_VALUE]=t,a[SETT_ISDEFAULT]=r,webphone_api.global.settmap[e]=a,webphone_api.global.wasSettModified=!0}else SettingItem(e,t,"-1","-1","","","0",t),webphone_api.global.wasSettModified=!0;return"extraregisteraccounts"===e&&ParseSipAccounts(),!0}catch(s){PutToDebugLogException(3,"common: SaveParameter",s)}return!1}function Ssidcode(){if(null!==ssidcode_string)return ssidcode_string;var e=[];return e.push("s"),e.push("s"),e.push("i"),e.push("d"),e.push("c"),e.push("o"),e.push("d"),e.push("e"),ssidcode_string=e.join("")}function GetConfigAll(e){var t=webphone_api.mwphonecfg.getAll();try{if(void 0!==t&&null!==t&&!0===e&&GetPassphrase().length>0){var n=GetPassphrase();for(var o in t)void 0===o||null===o||o.length<1||"undefined"==typeof t[o]||null===t[o]||t[o].toString().indexOf("encrypted__3__")<0||(t[o]=StrDc(t[o],n))}}catch(i){PutToDebugLogException(3,"common: GetConfigAll",i)}return t}function GetConfig(e,t){try{if(isNull(e)||e.length<1)return PutToDebugLog(3,"WARNING, common: GetConfig no input param"),"";isNull(t)&&(t=!0);var n=webphone_api.mwphonecfg.get(e);return isNull(n)?(PutToDebugLog(3,"WARNING, common: GetConfig value is NULL"),""):(n=n.toString(),t&&GetPassphrase().length>0&&(n=StrDc(n,GetPassphrase())),0===n.indexOf("encrypted__3__")&&GetPassphrase().length>0&&(n=StrDc(n,GetPassphrase())),"serveraddress"===e&&(n=StripServeraddress(n)),"username"!==e&&"sipusername"!==e||(n=StripUsername(n)),n)}catch(o){PutToDebugLogException(3,"common: GetConfig",o)}return""}function GetConfigInt(e,t){try{!isNull(t)&&IsNumber(t)||(t=0);var n=GetConfig(e);if(!isNull(n)&&n.length>0){var o=null;return n=n.toLowerCase(),"true"===n||"yes"===n?o=1:"false"===n||"no"===n?o=0:IsNumber(Trim(n))&&(o=StrToInt(n)),isNull(o)?t:o}}catch(i){PutToDebugLogException(3,"common: GetConfigInt parameter: "+e,i)}return t}function GetConfigBool(e,t){try{(isNull(t)||"true"!==t.toString()&&"false"!==t.toString())&&(t=!1);var n=GetConfig(e);if(!isNull(n)){var o=null;return"true"===n.toLowerCase()||"1"===n||"2"===n||"3"===n||"yes"===n.toLowerCase()?o=!0:"false"!==n.toLowerCase()&&"0"!==n&&"no"!==n.toLowerCase()||(o=!1),isNull(o)?t:o}}catch(i){PutToDebugLogException(3,"common: GetConfigBool parameter: "+e,i)}return t}function SaveSettingsFile(e,t,n){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveSettingsFile do not save because preferred_storage is 0 from "+e.toString()),void n(!0);if(webphone_api.global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return PutToDebugLog(2,"EVENT, SaveSettingsFile DO NOT SAVE, flag delsett is: "+webphone_api.global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1)+" from: "+e.toString()),void n(!0);if(!n||"function"!=typeof n)return PutToDebugLog(2,"ERROR, common: SaveSettingsFile callback not defined from "+e.toString()),!1;if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, common: SaveSettingsFile filename is NULL from "+e.toString()),n(!1),!1;if(isNull(webphone_api.global.settmap)||isNull(webphone_api.global.settmap.magicnumber))return PutToDebugLog(2,"WARNING, common: SaveSettingsFile no setings to be saved from "+e.toString()),n(!1),!1;webphone_api.global.dispSaveSettMsg++,webphone_api.global.dispSaveSettMsg<3&&PutToDebugLog(2,"EVENT, SaveSettingsFile filename: "+t+" from "+e.toString());var o="",i="";if(!0===GetParameterBool("serverinputisupperserver",!1)){var a=GetParameter("upperserver"),r=GetParameter("serveraddress_user");if((a.length<0||r.indexOf(".")>0)&&ShowServerInput()){var s=GetConfigInt("upperserverfromuser",2),l=GetConfig("upperserver");s<2&&l.length>0?SaveParameter("upperserver",l):SaveParameter("upperserver",r),webphone_api.global.wasSettModified=!1}}var p=GetSafariCookie();for(var c in webphone_api.global.settmap)if(!(isNull(c)||c.length<1)&&"clientreset"!==c&&"clientresetall"!==c){var u=webphone_api.global.settmap[c];o=o+c+";"+u[SETT_VALUE]+";"+u[SETT_TYPE]+";"+u[SETT_GROUP]+";"+u[SETT_ALLNAMES]+";"+u[SETT_ALLVALUES]+";"+u[SETT_ISDEFAULT]+";"+u[SETT_DEF_VALUE]+"\r\n","username"===c||"sipusername"===c||"password"===c||"serveraddress_user"===c||"serveraddress_orig"===c||"upperserver"===c||"loglevel"===c||"code_version"===c||"lastusedengine"===c?i=i+c+";"+u[SETT_VALUE]+"\r\n":1===p&&("server_label"!==c&&"realm"!==c&&"register"!==c&&"registerinterval"!==c&&"enginepriority_java"!==c&&"enginepriority_webrtc"!==c&&"enginepriority_ns"!==c&&"enginepriority_flash"!==c&&"enginepriority_app"!==c&&"enginepriority_p2p"!==c&&"enginepriority_accessnum"!==c&&"enginepriority_nativedial"!==c&&"enginepriority_otherbrowser"!==c&&"last_good_webrtc_gw"!==c&&"volumein"!==c&&"volumeout"!==c&&"codecframecount"!==c&&"displaynotification"!==c&&"signalingport"!==c&&"proxyaddress"!==c&&"displayname"!==c&&"email"!==c&&"chatsms"!==c&&"textmessaging"!==c&&"savetocontacts"!==c&&"transfertype"!==c&&"techprefix"!==c&&"callforwardonbusy"!==c&&"voicemail"!==c&&"filters"!==c&&"startwithos"!==c&&"brandname"!==c&&"brandid"!==c&&"enablepresence"!==c&&"presencestatus"!==c&&"accounts"!==c&&"transport"!==c&&"accessnumber"!==c&&"theme"!==c&&"autostart"!==c&&"conferencetype"!==c&&"sendchatonenter"!==c&&"language"!==c&&"extraregisteraccounts"!==c&&"incomingcallpopup"!==c&&"enablepush"!==c&&"serveraddressbook_url"!==c&&"quick_access_list"!==c||(i=i+c+";"+u[SETT_VALUE]+"\r\n"))}if(1!==GetParameterInt("storagecookiefailback",1)&&1!==p||webphone_api.global.dispSaveSettMsg<3&&webphone_api.global.loglevel>6&&PutToDebugLog(2,"EVENT, SaveSettingsFile save coockie backup = "+i+" from: "+e.toString()),isNull(webphone_api.File))return CanLog(2)&&PutToDebugLog(2,"EVENT, SaveSettingsFile File handling module not loaded yet from: "+e.toString()),n(!1),!1;1!==GetParameterInt("storagecookiefailback",1)&&1!==p||webphone_api.File.SaveFile(t+"_backup",i,webphone_api.global.STORAGE_COOKIE,function(t){webphone_api.global.dispSaveSettMsg<3&&PutToDebugLog(3,"EVENT, SaveSettingsFile save coockie backup: "+t.toString()+" from: "+e.toString())}),IsWindowsSoftphone()?ApiWinSaveFile(t,o,function(e){n(!0)}):webphone_api.File.SaveFile(t,o,webphone_api.global.STORAGE_LOCAL,function(e){n(!0)})}catch(h){PutToDebugLogException(2,"common: SaveSettingsFile",h)}}function ReadSettingsFile(e,t){try{if(PutToDebugLogSpecial(3,"EVENT, common ReadSettingsFile called; filename: "+e,!1,""),!t||"function"!=typeof t)return void PutToDebugLog(2,"ERROR, common: ReadSettingsFile callback not defined");if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, common: ReadSettingsFile filename is NULL");if(isNull(webphone_api.File))return PutToDebugLog(2,"ERROR, ReadSettingsFile File handling module not loaded yet"),t(!1),!1;if(!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===settdeleted&&(settdeleted=!0,webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(GetActiveAccSettingsFilename(),function(e){PutToDebugLog(2,"EVENT, delete settings file resetsettings: "+GetActiveAccSettingsFilename()+" result: "+e)})),PutToDebugLog(2,"EVENT, ReadSettingsFile not read because resetsettings"),InitializeSettings(),t(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(e,function(n){n+="",(isNull(n)||Trim(n).length<2||"null"==n)&&(PutToDebugLog(4,"EVENT, common: ReadSettingsFile no content WinApi"),webphone_api.File.ReadFile(e+"_backup",webphone_api.global.STORAGE_COOKIE,function(n){(isNull(n)||Trim(n).length<1)&&(n=""),PutToDebugLog(2,"READ contentfromcookie WinApi = "+HideClearPassword(n)),HandleSettings("",e,t),webphone_api.plhandler.ConfigChanged();var o=n.split("\r\n");(isNull(o)||o.length<1)&&(o=[]);for(var i=0;i<o.length;i++)if(!(isNull(o[i])||o[i].length<2||o[i].indexOf(";")<0)){var a=o[i].indexOf(";");if(!(a<1)){var r=Trim(o[i].substring(0,a)),s=Trim(o[i].substring(a+1));SaveParameter(r,s)}}PutToDebugLog(2,"EVENT, common: ReadSettingsFile important settings restored from cookie WinApi: "+n)})),HandleSettings(n,e,t),webphone_api.plhandler.ConfigChanged()}):webphone_api.File.ReadFile(e,webphone_api.global.STORAGE_LOCAL,function(n){isNull(n)||Trim(n).length<1?(PutToDebugLog(4,"EVENT, common: ReadSettingsFile no content"),1!==GetParameterInt("storagecookiefailback",1)&&1!==GetSafariCookie()||webphone_api.File.ReadFile(e+"_backup",webphone_api.global.STORAGE_COOKIE,function(n){(isNull(n)||Trim(n).length<1)&&(n=""),PutToDebugLog(2,"READ contentfromcookie = "+HideClearPassword(n)),HandleSettings("",e,t),webphone_api.plhandler.ConfigChanged();var o=n.split("\r\n");(isNull(o)||o.length<1)&&(o=[]);for(var i=0;i<o.length;i++)if(!(isNull(o[i])||o[i].length<2||o[i].indexOf(";")<0)){var a=o[i].indexOf(";");if(!(a<1)){var r=Trim(o[i].substring(0,a)),s=Trim(o[i].substring(a+1));"lastusedengine"===r?s.length>0&&(SaveParameter(r,s),webphone_api.global.last_used_engine_cache=s):SaveParameter(r,s)}}PutToDebugLog(2,"EVENT, common: ReadSettingsFile important settings restored from cookie: "+HideClearPassword(n))})):(HandleSettings(n,e,t),webphone_api.plhandler.ConfigChanged())})}catch(n){PutToDebugLogException(2,"common: ReadSettingsFile",n)}}function ClientReset(e,t,n,o){try{if(!0===webphone_api.global.flagclientreset)return;if((isNull(n)||n.length<1)&&(n=!0===IsSDK()?GetSettFilenameSDK():GetActiveAccSettingsFilename()),!0===o){webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, ClientReset delete call history file: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),webphone_api.global.chlist=[],webphone_api.global.recentlist=[];var i=GetParameter("messagefiles");if(!isNull(i)){for(var a=i.split(","),r=0;r<a.length;r++)if(!(isNull(a[r])||a[r].length<3)){var s=a[r].indexOf("[#");s>0&&(a[r]=a[r].substring(0,s));a[r]}SaveParameter("messagefiles","")}var l=GetConfig("brandid");(isNull(l)||l.length<1||"-1"==l)&&(l=GetBrandName().toLowerCase()),webphone_api.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, ClientReset delete accounts file result: "+e)}),webphone_api.global.aclist=[],webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME+l,function(e){PutToDebugLog(2,"EVENT, ClientReset delete contacts file result: "+e)}),webphone_api.global.ctlist=[]}!isNull(n)&&n.length>0&&(webphone_api.global.flagclientreset=!0,webphone_api.global.flag_delsett=1,webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(filename,function(n){PutToDebugLog(2,"EVENT, ClientReset delete settings file result: "+n),webphone_api.global.flag_delsett=0,HandleSettings("","",function(){}),webphone_api.global.flagclientreset=!1,SaveParameter("last_clientreset",e),SaveParameter("last_clientresetall",t),!1===IsSDK()&&OpenSettings(!0,1)}))}catch(p){PutToDebugLogException(2,"common: ClientReset",p)}}function HandleSettings(e,t,n){try{if(PutToDebugLogSpecial(1,"EVENT,HandleSettings",!1,""),isNull(webphone_api.global.settmap))webphone_api.global.settmap={};else for(var o in webphone_api.global.settmap)delete webphone_api.global.settmap[o];if(isNull(webphone_api.global.settmap2))webphone_api.global.settmap2={};else for(var o in webphone_api.global.settmap2)delete webphone_api.global.settmap2[o];InitializeSettings();var i=GetConfigAll(!0);if(!isNull(i)){CanLog(3)&&PutToDebugLog(3,"EVENT,HandleSettings cfg "+i.length);for(var a in i)if(!(isNull(a)||a.length<1||a.indexOf("overwrite_")>=0)){var r=i[a];"NULL"===r&&(r=""),SaveParameter(a,r)}}var s=e.split("\r\n");if(isNull(s)||s.length<1)PutToDebugLog(2,"ERROR, common: ParseSettingsReadFromFile empty content");else if(e.indexOf("magicnumber")<0&&e.length>30)PutToDebugLog(3,"ERROR, common ParseSettingsReadFromFile settings file is corrupt "+e.length),webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(t,function(e){PutToDebugLog(2,"EVENT, ParseSettingsReadFromFile delete settings file result: "+e)});else{CanLog(3)&&PutToDebugLog(3,"EVENT,HandleSettings file "+e.length);for(var l=!1,p=!1,c="",u="",h="",g="",m="",d="",b=-1,_=-1,f=0;f<s.length;f++)if(!(isNull(s[f])||s[f].length<2||s[f].indexOf(";")<0)){var w=s[f].split(";");isNull(w)||8!==w.length||("serveraddress"===w[0]&&(c=w[1]),
"webrtcserveraddress"===w[0]&&(u=w[1]),"upperserver"===w[0]&&(h=w[1]),"proxyaddress"===w[0]&&(g=w[1]),"lastsettcrc"===w[0]&&(m=w[1]),"last_clientreset"===w[0]&&IsNumber(w[1])&&(b=StrToInt(w[1])),"last_clientresetall"===w[0]&&IsNumber(w[1])&&(_=StrToInt(w[1])))}!isNull(webphone_api.parameters.last_clientreset)&&IsNumber(webphone_api.parameters.last_clientreset)&&(b=StrToInt(webphone_api.parameters.last_clientreset)),!isNull(webphone_api.parameters.last_clientresetall)&&IsNumber(webphone_api.parameters.last_clientresetall)&&(_=StrToInt(webphone_api.parameters.last_clientresetall));var v=-1,P=-1;if(!isNull(webphone_api.parameters.clientreset)&&IsNumber(webphone_api.parameters.clientreset)&&(v=StrToInt(webphone_api.parameters.clientreset)),!isNull(webphone_api.parameters.clientresetall)&&IsNumber(webphone_api.parameters.clientresetall)&&(P=StrToInt(webphone_api.parameters.clientresetall)),P>_&&(ClientReset(v,P,t,!0),l=!0),v>b&&(ClientReset(v,P,t,!1),l=!0),!isNull(webphone_api.parameters.serveraddress)&&webphone_api.parameters.serveraddress.length>0&&(c=webphone_api.parameters.serveraddress),!isNull(webphone_api.parameters.webrtcserveraddress)&&webphone_api.parameters.webrtcserveraddress.length>0&&(u=webphone_api.parameters.webrtcserveraddress),!isNull(webphone_api.parameters.upperserver)&&webphone_api.parameters.upperserver.length>0&&(h=webphone_api.parameters.upperserver),!isNull(webphone_api.parameters.proxyaddress)&&webphone_api.parameters.proxyaddress.length>0&&(g=webphone_api.parameters.proxyaddress),isNull(c)&&(c=""),isNull(u)&&(u=""),isNull(h)&&(h=""),isNull(g)&&(g=""),isNull(m)&&(m=""),d=Md5Hash(c+u+h+g),m.length>0&&!isNull(d)&&d!==m&&(p=!0,PutToDebugLog(2,"EVENT, HandleSettings: key settings changed, omit them from local storage"),SaveParameter("autostart",0)),setTimeout(function(){SaveParameter("lastsettcrc",d)},500),!1===l)for(var E="",T="",N="",S="",I="",C="",R="",G="",y=0;y<s.length;y++)if(!(isNull(s[y])||s[y].length<2||s[y].indexOf(";")<0)){var L=s[y].split(";");if(isNull(L))PutToDebugLog(2,"WARNING, common ReadSettingsFile can't parse. clen: "+e.length+", alen: "+s.length+", setting: "+s[y]);else if(8===L.length||"get"===L[0]||"getAll"===L[0])E=L[0],(!0!==p||"serveraddress"!==E&&"serveraddress_orig"!==E&&"serveraddress_user"!==E&&"webrtcserveraddress"!==E&&"upperserver"!==E&&"proxyaddress"!==E&&"realm"!==E&&"lastsettcrc"!==E)&&(T=L[1],N=L[2],S=L[3],I=L[4],C=L[5],R=L[6],G=L[7],SettingItem(E,T,N,S,I,C,R,G),"loglevel"===E&&SettingItem(E,T,N,S,I,C,R,G,!0),E="",T="",N="",S="",I="",C="",R="",G="");else{PutToDebugLog(2,"WARNING, common ReadSettingsFile broken or invalid setting after parse. clen: "+e.length+", alen: "+s.length+", len: "+L.length)}}}if(!isNull(i))for(var a in i)if(!(isNull(a)||a.length<1||a.indexOf("overwrite_")<0)){a=a.replace("overwrite_","");var r=i[a];"NULL"===r&&(r=""),SaveParameter(a,r)}for(var o in webphone_api.global.settmap)isNull(o)||o.length<1||(webphone_api.global.settmap2[o]=webphone_api.global.settmap[o]);if(!isNull(webphone_api.parameters)){for(var o in webphone_api.parameters)if(!(isNull(o)||o.length<1||"codec"===o||"extraregisteraccounts"==o)){var T=webphone_api.parameters[o];if(isNull(T)&&(T=""),"object"==typeof T)try{T=JSON.stringify(T)}catch(x){}T=isNull(T)?"":T.toString(),T.length<1||0===o.indexOf("ucfg_")&&!isNull(GetParameter(o))&&GetParameter(o).length>0||(o=o.replace("ucfg_",""),"NULL"===T&&(T=""),"webrtcserver"!==o&&"webrtcaddress"!==o&&"rtcserver"!==o&&"rtcaddress"!==o||(o="webrtcserveraddress"),"loglevel"===o?!isNull(StrToInt(T))&&StrToInt(T)>1&&SaveParameter(o,T,!0):SaveParameter(o,T,!0),"username"!==o||"undefined"!=typeof webphone_api.parameters.sipusername&&null!==webphone_api.parameters.sipusername?"sipusername"!==o||"undefined"!=typeof webphone_api.parameters.username&&null!==webphone_api.parameters.username||SaveParameter("username",T,!0):SaveParameter("sipusername",T,!0))}var O=webphone_api.parameters.serveraddress;!isNull(O)&&O.length>1&&(SaveParameter("serveraddress",O,!0),SaveParameter("serveraddress_user",O,!0),SaveParameter("serveraddress_orig",O,!0)),GetCodecsFromApiParam()}GetSettingsFromUrl();var D=GetParameter("serveraddress");return!isNull(D)&&D.length>0&&SaveParameter("serveraddress",NormalizeInput(D,0)),D=GetParameter("serveraddress_user"),!isNull(D)&&D.length>0&&SaveParameter("serveraddress_user",NormalizeInput(D,0)),D=GetParameter("serveraddress_orig"),!isNull(D)&&D.length>0&&SaveParameter("serveraddress_orig",NormalizeInput(D,0)),D=GetParameter("webrtcserveraddress"),!isNull(D)&&D.length>0&&SaveParameter("webrtcserveraddress",NormalizeInputBasic(D,0)),D=GetParameter("turnserveraddress"),!isNull(D)&&D.length>0&&SaveParameter("turnserveraddress",NormalizeInput(D,0)),D=GetParameter("sipusername"),!isNull(D)&&D.length>0&&SaveParameter("sipusername",NormalizeInput(D,0)),D=GetParameter("username"),!isNull(D)&&D.length>0&&SaveParameter("username",NormalizeInput(D,0)),IsCExt(),SetLanguage(),SetCurrTheme(),HandleScurlSetparameters(),ParseSipAccounts(),void n(!0)}catch(A){PutToDebugLog(2,"EVENT, common: HandleSettings er1")}HandleScurlSetparameters(),ParseSipAccounts(),n(!1)}function GetSettingsFromUrl(){var e=!1;try{var t=window.location.href,n="",o="",i="";if(isNull(t)||t.length<1)return;t=decodeURIComponent(t),t=Trim(t),CanLog(3)&&PutToDebugLog(3,"EVENT, GetSettingsFromUrl url: "+t);var a=t.indexOf("?");if(a<0)return;t=t.substring(a+1,t.length),a=t.indexOf("#page_"),a>0&&(t=t.substring(0,a));for(var r=0;t.length>3&&r<100;){r++,a=t.indexOf("&"),a<0&&(a=t.length);var s=t.substring(0,a);if(t=t.substring(a,t.length),0===t.indexOf("&")&&(t=t.substring(1,t.length)),!(isNull(s)||s.length<1))if(s=Trim(s),(a=s.indexOf("="))<1)PutToDebugLog(3,"EVENT, GetSettingsFromUrl invalid settings: "+s);else{var l=Trim(s.substring(0,a)),p=Trim(s.substring(a+1,s.length));p=StrDc(p,"1AzbNh5FdLT9m"),"platform"!==l||"windesktop"!==p?0===l.indexOf("wp_")&&((l.indexOf("serveraddres")>0||l.indexOf("username")>0||l.indexOf("sipusername")>0||l.indexOf("password")>0)&&(webphone_api.global.sipaccounts=[],SaveSipAccounts()),l=l.substring(l.indexOf("wp_")+3,l.length),"brandnamestr"===l&&p.length>0?l="brandname":"resetsettings"===l&&p.length>0&&("1"===p.toLowerCase()||"true"===p.toLowerCase())?e=!0:"serveraddress"===l&&p.length>0&&(SaveParameter("iswebrtcuppersrvfromuser","true",!0),SaveParameter("serveraddress_user",Trim(p),!0),SaveParameter("serveraddress_orig",Trim(p),!0)),"video"===l&&!0===CanIUseWebRTC()&&(PutToDebugLog(2,"WARNING, Enginepriority_WebRTC is set manually to 4 because video is forced"),SaveParameter("enginepriority_webrtc","4")),"callto"===l&&!isNull(p)&&p.length>0?n=p:"sendchat"===l&&!isNull(p)&&p.length>0?o=p:"to"===l&&!isNull(p)&&p.length>0?i=p:SaveParameter(l,Trim(p),!0)):(l="devicetype",p=""+DEVICE_WIN_SOFTPHONE(),SaveParameter(l,p,!0))}}if(!0===e)return PutToDebugLog(2,"EVENT, mlogic Delsettings GetSettingsFromUrl"),void webphone_api.delsettings(2);(isNull(n)||n.length<1)&&(n=GetParameter("callto")),!isNull(n)&&n.length>0&&!1===autocall_called&&(autocall_called=!0,webphone_api.global.aua_handled=!0,setTimeout(function(){3===GetParameterInt("autoaction",0)?(PutToDebugLog(2,"EVENT,GetSettingsFromUrl initiate autoaction video call to: "+n),PutToDebugLog(2,"EVENT, mlogic API_VideoCall GetSettingsFromUrl"),webphone_api.videocall(decodeURIComponent(n))):(PutToDebugLog(2,"EVENT,GetSettingsFromUrl initiate autoaction call to: "+n),PutToDebugLog(2,"EVENT, mlogic API_Call GetSettingsFromUrl"),webphone_api.call(decodeURIComponent(n)))},200)),!isNull(o)&&o.length>0&&!isNull(i)&&i.length>0&&!1===sendchat_called&&(sendchat_called=!0,webphone_api.global.aua_handled=!0,setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_SendChat GetSettingsFromUrl"),webphone_api.sendchat(decodeURIComponent(i),decodeURIComponent(o))},200))}catch(c){PutToDebugLogException(2,"common: GetSettingsFromUrl",c)}}function GetOverWriteSettings(){try{var e=GetConfigAll(!0);if(isNull(e))return;for(var t in e)isNull(t)||t.length<1||t.indexOf("overwrite_")<0||(t=t.replace("overwrite_",""),SaveParameter(t,e[t]))}catch(n){PutToDebugLogException(2,"common: GetOverWriteSettings",n)}}function OpenSettings(e,t){try{3===t&&(getuseengine()===webphone_api.global.ENGINE_SERVICE||getuseengine()===webphone_api.global.ENGINE_JAVA)||8===t?PutToDebugLog(2,"EVENT, mlogic OpenSettings: "+t):(PutToDebugLog(2,"EVENT, mlogic API_Unregister OpenSettings: "+t),webphone_api.unregister(),PutToDebugLog(2,"EVENT, mlogic API_Stop OpenSettings: "+t),webphone_api.stop()),!1===IsSDK()&&(isNull(e)||!0!==e||(webphone_api.global.intentsettings[0]="startedfrom=app"),"undefined"!=typeof webphone_api.$&&null!==webphone_api.$&&"undefined"!=typeof webphone_api.$.mobile&&null!==webphone_api.$.mobile&&webphone_api.$.mobile.changePage("#page_settings",{transition:"pop",role:"page"})),IsWindowsSoftphone()||"Android"===GetOs()||setTimeout(function(){ChooseEngineLogic(function(){PutToDebugLog(3,"ChooseEngineLogic called on goind to settings page")},!1)},350)}catch(n){PutToDebugLogException(2,"common: OpenSettings",n)}}function GetIntentParam(e,t){try{if(isNull(e)||isNull(t))return"";if(t=Trim(t),e.length<1||t.length<1)return"";for(var n=0;n<e.length;n++)if(!isNull(e[n])&&0===e[n].indexOf(t)&&e[n].indexOf("=")>0){var o=e[n].substring(e[n].indexOf("=")+1);return Trim(o)}}catch(i){PutToDebugLogException(2,"common: GetIntentParam",i)}return""}function SaveContactsFile(e){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveContactsFile do not save because preferred_storage is 0"),void e(!0);if(webphone_api.global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveContactsFile DO NOT SAVE, flag delsett is: "+webphone_api.global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveContactsFile callback not defined");if(isNull(webphone_api.global.ctlist))return PutToDebugLog(2,"EVENT, SaveContactsFile no contacts to be saved"),e(!1),!1;if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, SaveContactsFile File handling module not loaded yet"),e(!1),!1;for(var t="",n=null,o=0;o<webphone_api.global.ctlist.length;o++)if(n=webphone_api.global.ctlist[o],!isNull(n)){var i=n[CT_EMAIL],a=n[CT_ADDRESS],r=n[CT_NOTES],s=n[CT_WEBSITE],l=n[CT_LASTACTIVE],p=n[CT_ISFROMSYNC];isNull(i)&&(i=""),isNull(a)&&(a=""),isNull(r)&&(r=""),isNull(s)&&(s=""),(isNull(l)||l.length<1||!1===IsNumber(l))&&(l="0"),(isNull(p)||p.length<1||!1===IsNumber(p))&&(p="1"),t=t+n[CT_NAME]+",[",t=t+n[CT_NUMBER].join(";")+"],[",t=t+n[CT_PTYPE].join(";")+"],",t=t+n[CT_USAGE]+","+n[CT_LASTMODIF]+","+n[CT_DELFLAG]+","+n[CT_FAV]+","+i+","+a+","+r+","+s+","+l+","+p+"\r\n"}var c=GetConfig("brandid");(isNull(c)||c.length<1||"-1"==c)&&(c=GetBrandName().toLowerCase()),IsWindowsSoftphone()?ApiWinSaveFile(webphone_api.global.CONTACTS_FILENAME+c,t,function(t){webphone_api.global.wereCtModified=!1,e(!0)}):webphone_api.File.SaveFile(webphone_api.global.CONTACTS_FILENAME+c,t,webphone_api.global.STORAGE_LOCAL,function(t){webphone_api.global.wereCtModified=!1,e(t)})}catch(u){PutToDebugLogException(2,"common: SaveContactsFile",u)}}function ReadContactsFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadContactsFile callback not defined");if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, ReadContactsFile File handling module not loaded yet"),e(!1),!1;var t=GetConfig("brandid");if((isNull(t)||t.length<1||"-1"==t)&&(t=GetBrandName().toLowerCase()),!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===contactsdeleted&&(contactsdeleted=!0,webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME+t,function(e){PutToDebugLog(2,"EVENT, delete contacts file resetsettings result: "+e)}),webphone_api.global.ctlist=[]),PutToDebugLog(2,"EVENT, ReadContactsFile not read because resetsettings"),e(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(webphone_api.global.CONTACTS_FILENAME+t,function(t){if(isNull(t)||Trim(t).length<1)return PutToDebugLog(2,"EVENT, common: ReadContactsFile no content WinApi"),e(!1),!1;ParseContactsReadFromFile(t,!0,e)}):webphone_api.File.ReadFile(webphone_api.global.CONTACTS_FILENAME+t,webphone_api.global.STORAGE_LOCAL,function(t){if(isNull(t)||Trim(t).length<1)return PutToDebugLog(2,"EVENT, common: ReadContactsFile no content"),e(!1),!1;ParseContactsReadFromFile(t,!0,e)})}catch(n){PutToDebugLogException(2,"common: ReadContactsFile",n)}}function ParseContactsReadFromFile(e,t,n){try{var o=e.split("\r\n");if(isNull(o)||o.length<1)return PutToDebugLog(2,"ERROR, common: ParseContactsReadFromFile empty content"),n&&n(!1),!1;if(!0===t&&!isNull(webphone_api.global.ctlist))for(var i in webphone_api.global.ctlist)delete webphone_api.global.ctlist[i];for(var a="",r="",s=0;s<o.length;s++)if(isNull(o[s])||o[s].length<2||o[s].indexOf(",")<0)PutToDebugLog(2,"EVENT, common ParseContactsReadFromFile broken or invalid contact (1): "+o[s]);else if(a=o[s].split(","),r="",r=a[CT_NUMBER],isNull(r)||r.length<2||r.indexOf("[")<0)PutToDebugLog(2,"EVENT, common ParseContactsReadFromFile broken or invalid contact: (2)"+o[s]);else{r=r.substring(1,r.length-1);var l=r.split(";");if(isNull(l)&&(l=[]),r="",r=a[CT_PTYPE],isNull(r)||r.length<2||r.indexOf("[")<0)PutToDebugLog(2,"WARNING, common ParseContactsReadFromFile broken or invalid contact: (3)"+o[s]);else{r=r.substring(1,r.length-1);var p=r.split(";");isNull(p)&&(p=[]);var c=a[CT_EMAIL],u=a[CT_ADDRESS],h=a[CT_NOTES],g=a[CT_WEBSITE],m="0";a.length>CT_LASTACTIVE&&(m=a[CT_LASTACTIVE]);var d="1";a.length>CT_ISFROMSYNC&&(d=a[CT_ISFROMSYNC]),isNull(c)&&(c=""),isNull(u)&&(u=""),isNull(h)&&(h=""),isNull(g)&&(g="");var b=[];b[CT_NAME]=a[CT_NAME],b[CT_NUMBER]=l,b[CT_PTYPE]=p,b[CT_USAGE]=a[CT_USAGE],b[CT_LASTMODIF]=a[CT_LASTMODIF],b[CT_DELFLAG]=a[CT_DELFLAG],b[CT_FAV]=a[CT_FAV],b[CT_EMAIL]=c,b[CT_ADDRESS]=u,b[CT_NOTES]=h,b[CT_WEBSITE]=g,b[CT_LASTACTIVE]=m,b[CT_ISFROMSYNC]=d,webphone_api.global.ctlist.push(b)}}SortContacts(),n&&n(!0)}catch(_){PutToDebugLogException(2,"common: ParseContactsReadFromFile",_)}}function ParseContactsFromServer(e,t,n){try{var o=e.split("\r\n");if(isNull(o)||o.length<1)return PutToDebugLog(2,"ERROR, common: ParseContactsFromServer empty content"),n(!1),!1;if(!0===t&&!isNull(webphone_api.global.ctlist))for(var i in webphone_api.global.ctlist)delete webphone_api.global.ctlist[i];for(var a="",r=0;r<o.length;r++)if(isNull(o[r])||o[r].length<2||o[r].indexOf(",")<0)PutToDebugLog(2,"EVENT, common ParseContactsFromServer broken or invalid contact ["+r.toString()+"] (1): "+o[r]);else if(a=o[r].split(","),isNull(a)||a.length<7)PutToDebugLog(2,"EVENT, common ParseContactsFromServer broken or invalid contact ["+r.toString()+"] (2): "+o[r]);else{var s=a[0];isNull(s)&&(s=""),s=Trim(s);for(var l=[],p=[],c=1;c<=5;){var u=a[c];!isNull(u)&&u.length>0&&(u=ReplaceAll(u," ",""),u=ReplaceAll(u,"-",""),u=ReplaceAll(u,"(",""),u=ReplaceAll(u,")",""),l.indexOf(u)<0&&(l.push(a[c]),!0===IsNumeric(a[c],"+")&&a[c].length>6?p.push("phone"):p.push("sip"))),c++}var h=[];h[CT_NAME]=s,h[CT_NUMBER]=l,h[CT_PTYPE]=p,h[CT_USAGE]="0",h[CT_LASTMODIF]="0",h[CT_DELFLAG]="0",h[CT_FAV]="0",h[CT_EMAIL]="",h[CT_ADDRESS]="",h[CT_NOTES]="",h[CT_WEBSITE]="",h[CT_LASTACTIVE]="0",h[CT_ISFROMSYNC]="1",webphone_api.global.ctlist.push(h)}SortContacts(),n(!0)}catch(g){PutToDebugLogException(2,"common: ParseContactsFromServer",g)}}function GetContacts(e){try{isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1||GetParameter("lastfilterval")!==GetParameter("filtercontacts")?ReadContactsFile(function(t){SortContacts(),e&&e(t)}):webphone_api.global.wasCtModified?(SortContacts(),e&&e(!0)):e&&e(!0)}catch(t){PutToDebugLogException(2,"common: GetContacts",t)}}function SortContacts(){try{var e=GetParameterInt("sortcontacts",0);0===e?webphone_api.global.ctlist.sort(function(e,t){return e[CT_NAME].toLowerCase()<t[CT_NAME].toLowerCase()?-1:e[CT_NAME].toLowerCase()>t[CT_NAME].toLowerCase()?1:0}):1===e?webphone_api.global.ctlist.sort(function(e,t){return StrToInt(e[CT_USAGE])<StrToInt(t[CT_USAGE])?1:StrToInt(e[CT_USAGE])>StrToInt(t[CT_USAGE])?-1:0}):2===e&&webphone_api.global.ctlist.sort(function(e,t){for(var n=0,o=0,i=0;i<e[CT_NUMBER].length;i++){var a=webphone_api.global.presenceHM[e[CT_NUMBER][i]];if(!isNull(a)&&"5"===a[PRES_STATUS]){n=5;break}}for(var r=0;r<t[CT_NUMBER].length;r++){var s=webphone_api.global.presenceHM[e[CT_NUMBER][r]];if(!isNull(s)&&"5"===s[PRES_STATUS]){o=5;break}}return n<o?1:n>o?-1:0})}catch(t){PutToDebugLogException(2,"common: SortContacts",t)}}function UpdateContactLastActive(e){try{if(isNull(e)||e.length<1)return;var t=GetContactIdFromNumber(e);if(t>=0){var n=webphone_api.global.ctlist[t];n[CT_LASTACTIVE]=GetTickCount().toString(),webphone_api.global.ctlist[t]=n}}catch(o){PutToDebugLogException(2,"common: UpdateContactLastActive",o)}}function GetContactIdFromNumber(e){var t=-1,n=0;try{if(n=1,isNull(e)||Trim(e).length<1||isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1)return-1;n=2,e=Trim(e.replace("+",""));var o=e;o.length>4&&(o=Trim(o.substring(1))),o.length>4&&"0"===o.charAt(0)&&(o=Trim(o.substring(1)));var i=o;i=i.replace("-",""),i=i.replace(" ",""),i=i.replace("(",""),i=i.replace(")",""),i=Trim(i),n=3;for(var a,r=0;r<webphone_api.global.ctlist.length;r++){n=4;var s=webphone_api.global.ctlist[r];if(!isNull(s)){var l=s[CT_NUMBER];if(!isNull(l)){n=5;for(var p=0;p<l.length;p++)if(!isNull(l[p])&&(n=55,a=l[p].toString(),n=6,!(a.length<1)&&(n=7,a.indexOf(e)>=0&&a.indexOf(e)<5&&a.indexOf(e)==a.length-e.length||a.indexOf(o)>=0&&a.indexOf(o)<5&&a.indexOf(o)==a.length-o.length||a.indexOf(i)>=0&&a.indexOf(i)<5&&a.indexOf(i)==a.length-i.length))){t=r;break}}}}}catch(c){PutToDebugLogException(2,"common: GetContactIdFromNumber ("+n.toString()+")",c)}return t}function GetContactNameFromNumber(e){var t=e;try{if(isNull(e)||Trim(e).length<1)return"";if(isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1)return e;e=Trim(e),e=e.replace("-",""),e=e.replace(" ",""),e=e.replace("(",""),e=e.replace(")","");for(var n=!1,o=0;o<webphone_api.global.ctlist.length;o++){var i=webphone_api.global.ctlist[o];if(!isNull(i)){var a=i[CT_NUMBER];if(!isNull(a))for(var r=0;r<a.length;r++)if(!isNull(a[r])&&a[r]===e){t=i[CT_NAME],n=!0;break}}}if(!1===n)for(var o=0;o<webphone_api.global.ctlist.length;o++){var i=webphone_api.global.ctlist[o];if(!isNull(i)){var a=i[CT_NUMBER];if(!isNull(a))for(var r=0;r<a.length;r++)if(!isNull(a[r])&&(a[r].length>6&&e.length>5&&a[r].indexOf(e)>=0||a[r].length>5&&e.length>6&&e.indexOf(a[r])>=0||e==="+"+a[r]||e==="00"+a[r]||a[r]==="+"+e||a[r]==="00"+e)){t=i[CT_NAME],n=!0;break}}}}catch(s){PutToDebugLogException(2,"common: GetContactNameFromNumber",s)}return t}function ContactExists(e,t){try{if(isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1)return!1;isNull(e)&&(e=""),e=Trim(e),isNull(t)&&(t=""),t=Trim(t);var n=!1,o=!1;if(e.length>0&&(n=!0),t.length>0&&(o=!0),(isNull(e)||e.length<1)&&(isNull(t)||t.length<1)||!1===n&&!1===o)return PutToDebugLog(2,"ERROR, ContactExists invalid name and number"),!1;for(var i=0;i<webphone_api.global.ctlist.length;i++){var a=webphone_api.global.ctlist[i];if(!(isNull(a)||a.length<4)){if(!0===n&&a[CT_NAME]===e)return!0;if(!0===o){var r=a[CT_NUMBER];if(isNull(r)||r.length<1)continue;for(var s=0;s<r.length;s++)if(r[s]===t)return!0}}}}catch(l){PutToDebugLogException(2,"common: ContactExists",l)}return!1}function SaveCallhistoryFile(e){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveCallhistoryFile do not save because preferred_storage is 0"),void e(!0);if(webphone_api.global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveCallhistoryFile DO NOT SAVE, flag delsett is: "+webphone_api.global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveCallhistoryFile callback not defined");if(isNull(webphone_api.global.chlist))return PutToDebugLog(2,"EVENT, SaveCallhistoryFile no contacts to be saved"),e(!1),!1;if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, SaveCallhistoryFile File handling module not loaded yet"),e(!1),!1;for(var t="",n=null,o=0;o<webphone_api.global.chlist.length;o++)if(n=webphone_api.global.chlist[o],!isNull(n)){var i="";n.length>6&&(i=n[CH_REASON]),t.length>3&&(t+="\r\n"),t=t+n[CH_TYPE]+","+n[CH_NAME]+","+n[CH_NUMBER]+","+n[CH_DATE]+","+n[CH_DURATION]+","+n[CH_RECORDING]+","+i}IsWindowsSoftphone()?ApiWinSaveFile(GetActiveAccCallhistoryFilename(),t,function(t){webphone_api.global.wasChModified=!1,e(!0)}):webphone_api.File.SaveFile(GetActiveAccCallhistoryFilename(),t,webphone_api.global.STORAGE_LOCAL,function(t){webphone_api.global.wasChModified=!1,e(t)})}catch(a){PutToDebugLogException(2,"common: SaveCallhistoryFile",a)}}function ReadCallhistoryFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadCallhistoryFile callback not defined");if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, ReadCallhistoryFile File handling module not loaded yet"),e(!1),!1;if(!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===callhdeleted&&(callhdeleted=!0,webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, delete call history file resetsettings: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),webphone_api.global.chlist=[],webphone_api.global.recentlist=[]),PutToDebugLog(2,"EVENT, ReadCallhistoryFile not read because resetsettings"),e(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(GetActiveAccCallhistoryFilename(),function(t){if(isNull(t)||Trim(t).length<1)return PutToDebugLog(2,"EVENT, common: ReadCallhistoryFile no content WinApi"),e(!1),!1;ParseCallhistoryReadFromFile(t,e)}):webphone_api.File.ReadFile(GetActiveAccCallhistoryFilename(),webphone_api.global.STORAGE_LOCAL,function(t){if(isNull(t)||Trim(t).length<1)return PutToDebugLog(2,"EVENT, common: ReadCallhistoryFile no content"),e(!1),!1;ParseCallhistoryReadFromFile(t,e)})}catch(t){PutToDebugLogException(2,"common: ReadCallhistoryFile",t)}}function ParseCallhistoryReadFromFile(e,t){try{var n=e.split("\r\n");if(isNull(n)||n.length<1)return PutToDebugLog(2,"ERROR, common: ReadCallhistoryFile empty content"),t(!1),!1;if(!isNull(webphone_api.global.chlist))for(var o in webphone_api.global.chlist)delete webphone_api.global.chlist[o];for(var i=null,a=0;a<n.length;a++)isNull(n[a])?PutToDebugLog(2,"WARNING, common ReadCallhistoryFile broken or invalid contact (1a): "+n.length.toString()+":"+n[a]):n[a].length<2||n[a].indexOf(",")<0?PutToDebugLog(2,"WARNING, common ReadCallhistoryFile broken or invalid contact (1): "+n.length.toString()+":"+n[a].length.toString()+":"+n[a]):(i=n[a].split(","),isNull(i)||i.length<2?PutToDebugLog(2,"WARNING, common ReadCallhistoryFile broken or invalid contact: (2): "+n.length.toString()+":"+n[a].length.toString()+":"+n[a]):(i.length<7&&i.push(""),webphone_api.global.chlist.push(i)));t(!0)}catch(r){PutToDebugLogException(2,"common: ParseCallhistoryReadFromFile",r)}}function StartMsg(e,t,n){try{e=NormalizeNumber(e);var o="",i=GetParameter("sms"),a=GetParameterInt("textmessaging",-2);if(a<-1){switch(GetParameterInt("chatsms",-2)){case 0:a=-1;break;case 1:a=3;break;case 2:a=6;break;case 3:a=0}if(a<-1){switch(GetParameterInt("haschat",-2)){case 0:a=0;break;case 1:a=3;break;case 2:a=5;break;case 3:a=6;break;case 4:a=-1}}}if(!isNull(i)&&i.length>0)if(3===a||4===a||5===a)o="sms",PutToDebugLog(4,"EVENT, StartMsg called action: "+o+"; number: "+e+"; fromclass: "+n+" (1)"),StartMsgActivity(e,t,o,n);else if(6===a)o="chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+o+"; number: "+e+"; fromclass: "+n+" (2)"),StartMsgActivity(e,t,o,n);else{var r=e;r.indexOf("+")>=0&&(r=r.substring(r.indexOf("+")+1,r.length)),IsNumber(r)&&r.length>6&&r.length<20?(o="sms",PutToDebugLog(4,"EVENT, StartMsg called action: "+o+"; number: "+e+"; fromclass: "+n+" (3)"),StartMsgActivity(e,t,o,n)):(o="chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+o+"; number: "+e+"; fromclass: "+n+" (4)"),StartMsgActivity(e,t,o,n))}else o=3===a||4===a||5===a?"sms":"chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+o+"; number: "+e+"; fromclass: "+n+" (5)"),StartMsgActivity(e,t,o,n)}catch(s){PutToDebugLogException(2,"common: StartMsg",s)}}function ChooseChatOrSms(e,t,n,o){try{var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220,i>400?i=400:i<120&&(i=120);var a="",r='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',s="";s=r.replace("[ITEMID]","#item_chat"),s=s.replace("[ITEMTITLE]",webphone_api.stringres.get("chat")),a+=s,s="",s=r.replace("[ITEMID]","#item_sms"),s=s.replace("[ITEMTITLE]",webphone_api.stringres.get("sms")),a+=s,s="";var l='<div id="chatsms_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+"px; min-width: "+Math.floor(.6*i)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("chat_sms_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="chatsms_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+a+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";o=o||function(){},!1===IsSDK()&&(webphone_api.$.mobile.activePage.append(l).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#chatsms_ul").off("click","li"),o()}}));var p="";webphone_api.$("#chatsms_ul").on("click","li",function(o){var i=webphone_api.$(this).attr("id");"#item_chat"===i&&(p="chat"),"#item_sms"===i&&(p="sms"),webphone_api.$("#chatsms_popup").on("popupafterclose",function(o){webphone_api.$("#chatsms_popup").off("popupafterclose"),PutToDebugLog(5,"EVENT, ChooseChatOrSms: action: "+p+"; number: "+e+"; fromclass: "+n+"; msg: "+t),StartMsgActivity(e,t,p,n)})})}catch(c){PutToDebugLogException(2,"common: ChooseChatOrSms",c)}}function StartMsgActivity(e,t,n,o){try{if("_messagelist"!==o&&(isNull(e)||e.length<1)){var i=GetParameter("messagefiles");isNull(i)||i.length<3?(isNull(t)&&(t=""),webphone_api.global.intentmsg[0]="action="+n,webphone_api.global.intentmsg[1]="to="+e,webphone_api.global.intentmsg[2]="message="+t,webphone_api.$.mobile.changePage("#page_message",{transition:"slide",role:"page"})):webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})}else isNull(t)&&(t=""),webphone_api.global.intentmsg[0]="action="+n,webphone_api.global.intentmsg[1]="to="+e,webphone_api.global.intentmsg[2]="message="+t,webphone_api.$.mobile.changePage("#page_message",{transition:"slide",role:"page"})}catch(a){PutToDebugLogException(2,"common: StartMsgActivity",a)}}function OpenLinkInExternalBrowser(e){try{!isNull(e)&&e.length>0&&GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()&&(PutToDebugLog(2,"EVENT, OpenLinkInExternalBrowser: "+e),WinAPI("API_BrowserOpenExtern",null,e))}catch(t){PutToDebugLogException(2,"common: OpenLinkInExternalBrowser",t)}}function OpenLinkInInternalBrowser(e){try{!isNull(e)&&e.length>0&&GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()&&WinAPI("API_BrowserOpen",null,e)}catch(t){PutToDebugLogException(2,"common: OpenLinkInInternalBrowser",t)}}function OpenWebURL(e,t,n){try{if(isNull(e)||e.length<3)return void PutToDebugLog(2,"WARNING, common OpenWebURL no url passed");var o=GetSipusername(),i=GetParameter("password"),a="",r="",s="",l="",p="",c="",u="",h=RandomInt(1e4,9999999).toString();return s=Md5Hash("C8y5:"+o+":"+i+":"+h),l=Md5Hash(o+":"+i),p=Md5Hash(o+":"+i+":"+h),c=Md5Hash("rD58s:"+o+":"+i+":"+h),u=Md5Hash("ck5Gp"+o+i+GetParameter("apiv2md5salt")+h),1===GetParameter("brandid")&&(a=Md5Hash("C8y5:"+o+":"+i+":8294032567")),e.indexOf("mvapireq")>0&&(o=encodeURIComponent(o),i=encodeURIComponent(i),a=encodeURIComponent(a),r=encodeURIComponent(r),s=encodeURIComponent(s),l=encodeURIComponent(l),p=encodeURIComponent(p),h=encodeURIComponent(h),c=encodeURIComponent(c),u=encodeURIComponent(u)),e=Trim(e),e=e.replace("[USERNAME]",o),e=e.replace("USERNAME",o),e=e.replace("USRNAME",o),e=e.replace("[PASSWORD]",i),e=e.replace("PASSWORD",i),e=e.replace("PWD",i),e=e.replace("[MD5AUTH]",a),e=e.replace("[SHA1HASH]",r),e=e.replace("SHA1CHECKSUM",r),e=e.replace("MD5WEB",s),e=e.replace("MD5SIMPLE",l),e=e.replace("MD5NORMAL",p),e=e.replace("MD5SALT",h),e=e.replace("MD5CHECKSUM",c),e=e.replace("MD5VALUE",u),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("SERVERAPIKEY",GetConfig("serverapikey")),Trim(e.toLowerCase()).indexOf("http")<0&&t!==webphone_api.stringres.get("np_download")&&(e="http://"+e),!1!==n&&(IsHttps()&&e.indexOf("https:")<0&&(e=GetTlsProxyUrl(e)),PutToDebugLog(3,"EVENT, OpenWebURL = "+e),webphone_api.global.intentbrowser[0]="url="+e,webphone_api.global.intentbrowser[1]="lastpage="+webphone_api.$.mobile.activePage.attr("id"),isNull(t)&&(t=""),webphone_api.global.intentbrowser[2]="title="+t,webphone_api.$.mobile.changePage("#page_internalbrowser",{transition:"pop",role:"page"})),e}catch(g){PutToDebugLogException(2,"common: OpenWebURL",g)}return e}function Md5Hash(e){var t="";try{return isNull(e)||Trim(e).length<1?(PutToDebugLog(2,"EVENT, common: Md5Hash string to hash is NULL"),""):(t=Md5Lib(e),isNull(t)&&(t=""),t)}catch(n){PutToDebugLogException(2,"common: Md5Hash",n)}return""}function Md5Lib(e){function t(e,t){var n=e[0],s=e[1],l=e[2],p=e[3];n=o(n,s,l,p,t[0],7,-680876936),p=o(p,n,s,l,t[1],12,-389564586),l=o(l,p,n,s,t[2],17,606105819),s=o(s,l,p,n,t[3],22,-1044525330),n=o(n,s,l,p,t[4],7,-176418897),p=o(p,n,s,l,t[5],12,1200080426),l=o(l,p,n,s,t[6],17,-1473231341),s=o(s,l,p,n,t[7],22,-45705983),n=o(n,s,l,p,t[8],7,1770035416),p=o(p,n,s,l,t[9],12,-1958414417),l=o(l,p,n,s,t[10],17,-42063),s=o(s,l,p,n,t[11],22,-1990404162),n=o(n,s,l,p,t[12],7,1804603682),p=o(p,n,s,l,t[13],12,-40341101),l=o(l,p,n,s,t[14],17,-1502002290),s=o(s,l,p,n,t[15],22,1236535329),n=i(n,s,l,p,t[1],5,-165796510),p=i(p,n,s,l,t[6],9,-1069501632),l=i(l,p,n,s,t[11],14,643717713),s=i(s,l,p,n,t[0],20,-373897302),n=i(n,s,l,p,t[5],5,-701558691),p=i(p,n,s,l,t[10],9,38016083),l=i(l,p,n,s,t[15],14,-660478335),s=i(s,l,p,n,t[4],20,-405537848),n=i(n,s,l,p,t[9],5,568446438),p=i(p,n,s,l,t[14],9,-1019803690),l=i(l,p,n,s,t[3],14,-187363961),s=i(s,l,p,n,t[8],20,1163531501),n=i(n,s,l,p,t[13],5,-1444681467),p=i(p,n,s,l,t[2],9,-51403784),l=i(l,p,n,s,t[7],14,1735328473),s=i(s,l,p,n,t[12],20,-1926607734),n=a(n,s,l,p,t[5],4,-378558),p=a(p,n,s,l,t[8],11,-2022574463),l=a(l,p,n,s,t[11],16,1839030562),s=a(s,l,p,n,t[14],23,-35309556),n=a(n,s,l,p,t[1],4,-1530992060),p=a(p,n,s,l,t[4],11,1272893353),l=a(l,p,n,s,t[7],16,-155497632),s=a(s,l,p,n,t[10],23,-1094730640),n=a(n,s,l,p,t[13],4,681279174),p=a(p,n,s,l,t[0],11,-358537222),l=a(l,p,n,s,t[3],16,-722521979),s=a(s,l,p,n,t[6],23,76029189),n=a(n,s,l,p,t[9],4,-640364487),p=a(p,n,s,l,t[12],11,-421815835),l=a(l,p,n,s,t[15],16,530742520),s=a(s,l,p,n,t[2],23,-995338651),n=r(n,s,l,p,t[0],6,-198630844),p=r(p,n,s,l,t[7],10,1126891415),l=r(l,p,n,s,t[14],15,-1416354905),s=r(s,l,p,n,t[5],21,-57434055),n=r(n,s,l,p,t[12],6,1700485571),p=r(p,n,s,l,t[3],10,-1894986606),
l=r(l,p,n,s,t[10],15,-1051523),s=r(s,l,p,n,t[1],21,-2054922799),n=r(n,s,l,p,t[8],6,1873313359),p=r(p,n,s,l,t[15],10,-30611744),l=r(l,p,n,s,t[6],15,-1560198380),s=r(s,l,p,n,t[13],21,1309151649),n=r(n,s,l,p,t[4],6,-145523070),p=r(p,n,s,l,t[11],10,-1120210379),l=r(l,p,n,s,t[2],15,718787259),s=r(s,l,p,n,t[9],21,-343485551),e[0]=h(n,e[0]),e[1]=h(s,e[1]),e[2]=h(l,e[2]),e[3]=h(p,e[3])}function n(e,t,n,o,i,a){return t=h(h(t,e),h(o,a)),h(t<<i|t>>>32-i,n)}function o(e,t,o,i,a,r,s){return n(t&o|~t&i,e,t,a,r,s)}function i(e,t,o,i,a,r,s){return n(t&i|o&~i,e,t,a,r,s)}function a(e,t,o,i,a,r,s){return n(t^o^i,e,t,a,r,s)}function r(e,t,o,i,a,r,s){return n(o^(t|~i),e,t,a,r,s)}function s(e){var n,o=e.length,i=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=e.length;n+=64)t(i,l(e.substring(n-64,n)));e=e.substring(n-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<e.length;n++)a[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(t(i,a),n=0;n<16;n++)a[n]=0;return a[14]=8*o,t(i,a),i}function l(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function p(e){for(var t="",n=0;n<4;n++)t+=g[e>>8*n+4&15]+g[e>>8*n&15];return t}function c(e){for(var t=0;t<e.length;t++)e[t]=p(e[t]);return e.join("")}function u(e){return c(s(e))}function h(e,t){return e+t&4294967295}function h(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}try{var g="0123456789abcdef".split("");return u("hello"),u(e)}catch(m){PutToDebugLogException(2,"common: Md5Lib",m)}return""}function UriParser(e,t,n,o,i,a){try{if(isNull(e)||Trim(e).length<1)return void PutToDebugLog(2,"WARNING, common: UriParser uri is NULL");var r=GetSipusername(),s=GetParameter("password"),l="";!isNull(s)&&s.length>0&&(l=Md5Hash(s));var p="",c="",u="",h="",g="",m="",d=RandomInt(1e4,9999999).toString();c=Md5Hash("C8y5:"+r+":"+s+":"+d),u=Md5Hash(r+":"+s),h=Md5Hash(r+":"+s+":"+d),g=Md5Hash("rD58s:"+r+":"+s+":"+d),m=Md5Hash("ck5Gp"+r+s+GetParameter("apiv2md5salt")+d),0===Trim(e).indexOf("*")&&(e=e.substring(1));var b=e,_=b.indexOf("authpwd=");if(_>0&&GetLogLevel()<5){var f=b.substring(0,_+8);b=b.substring(_+8),_=b.indexOf("&"),_<0&&(_=b.length),b=b.substring(_),b=f+"*****"+b}PutToDebugLog(3,"EVENT, uri = "+b),e.indexOf("mvapireq")>0&&(r=encodeURIComponent(r),s=encodeURIComponent(s),l=encodeURIComponent(l),t=encodeURIComponent(t),n=encodeURIComponent(n),o=encodeURIComponent(o),p=encodeURIComponent(p),c=encodeURIComponent(c),u=encodeURIComponent(u),h=encodeURIComponent(h),d=encodeURIComponent(d),g=encodeURIComponent(g),m=encodeURIComponent(m)),e=Trim(e),e=e.replace("[USERNAME]",r),e=e.replace("USERNAME",r),e=e.replace("USRNAME",r),e=e.replace("[PASSWORD]",s),e=e.replace("PASSWORD",s),e=e.replace("PWD",s),e=e.replace("[MD5AUTH]",l),e=e.replace("MD5AUTH",l),e=e.replace("[PIN]",t),e=e.replace("PINCODE",t),e=e.replace("[ANUM]",n),e=e.replace("ANUM",n),e=e.replace("MYNUMBER",n),e=e.replace("PHONE1",n),e=e.replace("PREFIX_OR_NUMBER",n),e=e.replace("CALLEDNUMBER",n),e=e.replace("[CALLBACKNR]",GetParameter("callbacknumber")),e=e.replace("CALLBACKNR",GetParameter("callbacknumber")),e=e.replace("[BNUM]",o),e=e.replace("BNUM",o),e=e.replace("PHONE2",o),e=e.replace("TARGETMOBILE",o),e=e.replace("[TXT]",i),e=e.replace("TEXT",i),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("[SHA1HASH]",p),e=e.replace("SHA1CHECKSUM",p),e=e.replace("MD5WEB",c),e=e.replace("MD5SIMPLE",u),e=e.replace("MD5NORMAL",h),e=e.replace("MD5SALT",d),e=e.replace("SALT",d),e=e.replace("MD5CHECKSUM",g),e=e.replace("MD5VALUE",m),e=e.replace("BRANDNAME",encodeURIComponent(GetBrandName()));var w=GetParameter("upperserver");if((isNull(w)||w.length<1)&&(w=GetWebrtcUpperServer()),e=e.replace("UPPERSERVER",w),e=e.replace("SERVERAPIKEY",GetConfig("serverapikey")),e=e.replace("KEY",GetConfig("serverapikey")),e.indexOf("tel.search")>0){var v=GetParameter2("telsearchkey");isNull(v)&&(v=""),e=e.replace("TELSEARCHKEY",v)}Trim(e.toLowerCase()).indexOf("http")<0&&(e=UseSecureSrvConnection()?"https://"+e:"http://"+e),!1===P&&IsMizuServerOrGateway()&&e.indexOf("mvapireq")>0&&e.indexOf("?")>0&&(e=e+"&requestid="+GetRequestId());var b=e,_=b.indexOf("authpwd=");if(_>0){var f=b.substring(0,_+8);b=b.substring(_+8),_=b.indexOf("&"),_<0&&(_=b.length),b=b.substring(_),b=f+"*****"+b}if(PutToDebugLog(5,"EVENT,httpRequestUri = "+b+";   action = "+a),"return_uri"===a)return e;var P=!1,E="";e.indexOf("[POST]")>0?(P=!0,E=e.substring(e.indexOf("[POST]")+6),e=e.substring(0,e.indexOf("[POST]"))):(E=GetUrlParamVal(e,"POSTDATA"),!isNull(E)&&E.length>2&&(P=!0,e.indexOf("?")>0&&(e=e.substring(0,e.indexOf("?"))))),!1===webphone_api.global.isdebugversion&&!1===P&&IsMizuServerOrGateway()&&e.indexOf("mvapireq")>0&&(e=McrfsEnc(e,a)),HttpRequest(e,a,P,E)}catch(T){PutToDebugLogException(2,"common: UriParser",T)}}function McrfsEnc(e,t){try{if(isNull(e)||e.length<1)return e;var n=e,o=n.indexOf("?");if(o<0)return n;var i=n.substring(o+1);n=n.substring(0,o+1);var a="",r="",s=i.split("&");if(!isNull(s)&&s.length>0){i="";for(var l=0;l<s.length;l++)if(!isNull(s[l])){var p=s[l].indexOf("=");if(!(p<1)){var c=s[l].substring(0,p+1),u=s[l].substring(p+1);i.length>0&&(i+="&"),i=i+c+encodeURIComponent(u),"authkey="===c||"authid="===c||"authpwd="===c?(r.length>0&&(r+="&"),r=r+c+encodeURIComponent(u)):(a.length>0&&(a+="&"),a=a+c+encodeURIComponent(u))}}}var h=StrEc(i,webphone_api.global.ec_apikey,!0);if(i===StrDc("mcrfs_"+h,webphone_api.global.ec_apikey,!0))return n=n+"mcrfs="+h,PutToDebugLog(5,"EVENT,httpRequestUri ENC All = "+n+";   action = "+t),n;if(!isNull(r)&&r.length>0){var g=StrEc(r,webphone_api.global.ec_apikey,!0);if(r===StrDc("mcrfs_"+g,webphone_api.global.ec_apikey,!0))return!isNull(a)&&a.length>0&&(n=n+a+"&"),n=n+"mcrfs="+g,PutToDebugLog(5,"EVENT,httpRequestUri ENC main = "+n+";   action = "+t),n}}catch(m){PutToDebugLogException(2,"common: McrfsEnc",m)}return e}function ConfigureRequestEngine(e,t,n){try{if(e&&("jsonp"===webphone_api.global.httpmehod||"ws"===webphone_api.global.httpmehod))return void ReConfigureRequestEngine(1,e);if(!1===e&&t.indexOf("mvapireq")<1&&t.indexOf("mcrfs=")<1&&"ws"===webphone_api.global.httpmehod)return GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?void(webphone_api.global.httpmehod="win"):void(webphone_api.global.httpmehod="jsonp");if(t.indexOf("mvapireq")>=0||t.indexOf("mcrfs=")>=0&&getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void(webphone_api.global.httpmehod="ws");if(webphone_api.global.httpmehod.length>0)return;return"waitforparameters"===n?void(webphone_api.global.httpmehod="cors"):(IsMizuServerOrGateway()&&window.WebSocket&&!0!==e&&(webphone_api.global.wssupported=!0),!0===webphone_api.global.wssupported?void(webphone_api.global.httpmehod="ws"):GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE?void(webphone_api.global.httpmehod="win"):getuseengine()===webphone_api.global.ENGINE_JAVA?void(webphone_api.global.httpmehod="java"):IsMizuServerOrGateway()||!isNull(t)&&t.indexOf("xautoprov")>=0?void(webphone_api.global.httpmehod="cors"):void(webphone_api.global.httpmehod="jsonp"))}catch(o){PutToDebugLogException(2,"common: ConfigureRequestEngine",o)}}function ReConfigureRequestEngine(e,t){try{if(!1===webphone_api.global.currhttpmehodworking&&"ws"===webphone_api.global.httpmehod&&CheckInternetConnectionWS(),!0===t)return void(webphone_api.global.httpmehod="cors");if(!0===webphone_api.global.currhttpmehodworking)return;GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()?"win"===webphone_api.global.httpmehod?!0===webphone_api.global.wssupported&&(webphone_api.global.httpmehod="ws"):"ws"===webphone_api.global.httpmehod&&getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.global.httpmehod="java":"ws"===webphone_api.global.httpmehod||"java"===webphone_api.global.httpmehod?webphone_api.global.httpmehod="cors":"cors"===webphone_api.global.httpmehod?webphone_api.global.httpmehod="jsonp":webphone_api.global.httpmehod="win":"ws"===webphone_api.global.httpmehod?getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.global.httpmehod="java":getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.global.httpmehod="win":webphone_api.global.httpmehod="cors":"java"===webphone_api.global.httpmehod||"win"===webphone_api.global.httpmehod?webphone_api.global.httpmehod="cors":"cors"===webphone_api.global.httpmehod&&(webphone_api.global.httpmehod="jsonp"),PutToDebugLog(4,"EVENT, common:ReConfigureRequestEngine called from: "+e+" post: "+t+" . HTTP method: "+webphone_api.global.httpmehod)}catch(n){PutToDebugLogException(2,"common: ReConfigureRequestEngine",n)}}function HttpRequest(e,t,n,o){var i=0;try{if(isNull(o)&&(o=""),"downloadcontacts"===t&&"cors"!==webphone_api.global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: cors downloadcontacts");var a=CORSRequest(e,t,n,o);return void(!1===a&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available downloadcontacts; retry with other method"),ReConfigureRequestEngine(2,!1),HttpRequest(e,t,n,o)))}if(ConfigureRequestEngine(n,e,t),setTimeout(function(){ReConfigureRequestEngine(3,n)},3500),isNull(n)||!0!==n||"post",i=1,"telsearchname"===t){PutToDebugLog(2,"EVENT, HttpRequest method: cors telsearchname");var a=CORSRequest(e,t,n,o);return void(!1===a&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available telsearchname"),ReConfigureRequestEngine(4,!1),HttpRequest(e,t,n,o)))}if(i=2,50===GetConfigInt("brandid",-1)&&(webphone_api.global.httpmehod="win"),"win"===webphone_api.global.httpmehod){if(i=10,PutToDebugLog(2,"EVENT, HttpRequest method: win"),e=e.replace("[POST]",""),(isNull(o)||o.length<1)&&(o="data=dummy"),50===GetConfigInt("brandid",-1))return void WinAPI("API_HTTPReqAsyncFavafone",function(e){PutToDebugLog(2,"EVENT, common: API_HTTPReqAsyncFavafone returned (4): "+e+" waiting for response in notifications")},e,o);i=11,WinAPI("API_HTTPReqAsync",function(e){PutToDebugLog(2,"EVENT, common: API_HTTPReqAsync returned (4): "+e+" waiting for response in notifications")},e,o)}else if("ws"===webphone_api.global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: ws");var a=WSRequest(e,t,n);!1===a&&(i=20,PutToDebugLog(2,"WARNING, HttpRequest method: ws not available"),ReConfigureRequestEngine(5,!1),i=21,HttpRequest(e,t,n,o))}else if("java"===webphone_api.global.httpmehod)PutToDebugLog(2,"EVENT, HttpRequest method: java"),i=25,webphone_api.webphone_handle.API_HTTPReqAsync(e,o),i=26;else if("cors"===webphone_api.global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: cors"),i=30;var a=CORSRequest(e,t,n,o);i=31,!1===a&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available"),ReConfigureRequestEngine(6,!1),i=32,HttpRequest(e,t,n,o))}else if("jsonp"===webphone_api.global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: jsonp"),i=40;var r=decodeURIComponent(e);if(r=encodeURIComponent(r),r.toLowerCase().indexOf("wsuser")>0||r.toLowerCase().indexOf("wsload")>0)return PutToDebugLog(2,"WARNING, will not send wsuser/wsload over jsonp"),void(webphone_api.global.sendwsuserjsonp=!0);i=41;var s="http://";IsHttps()&&(s="https://"),r.toLowerCase().indexOf("wsuser")>0&&(s="https://");var l="rtc.mizu-voip.com";if("us"===webphone_api.global.usuk&&(l="usrtcx.webvoipphone.com"),i=42,IsMizuServerOrGateway()&&webphone_api.global.usuk.length<1&&(r.toLowerCase().indexOf("wsuser")<0||r.toLowerCase().indexOf("wsload")<0))if(i=45,GetWsAddressCfg().length>3){l=GetWsAddressCfg();var p=l.indexOf("://");p>=0&&(l=l.substring(p+3)),p=l.indexOf("/"),p>0&&(l=l.substring(0,p))}else GetConfig("serveraddress").length>1?l=GetConfig("serveraddress"):!isNull(webphone_api.parameters)&&!isNull(webphone_api.parameters.serveraddress)&&webphone_api.parameters.serveraddress.length>1&&(l=Trim(webphone_api.parameters.serveraddress),l=NormalizeInput(l,0),l.indexOf(":")>0&&(l=l.substring(0,l.indexOf(":"))));i=46,IsHttps()&&IsIPAddrress(l)&&jsonpmaxloop<3&&(jsonpmaxloop++,ReConfigureRequestEngine(7,n),HttpRequest(e,t,n,o)),jsonpmaxloop=0,i=50;var c=GetConfig("mainaport");!isNull(c)&&c.length>0&&(l.indexOf(":")>0&&(l=l.substring(0,l.indexOf(":"))),l+=c);var u=s+l+"/mvapireq/jppget?url="+r+"&callback=cbf";PutToDebugLog(4,"EVENT, jsonpurl: "+u),i=51,webphone_api.$.getJSON(u,function(e){var n="";isNull(e)?PutToDebugLog(2,"ERROR, HttpRequest jsonp response is NULL"):n=e.contents,HttpResponseHandler(n,t)})}else PutToDebugLog(2,"ERROR, common: HttpRequest NO supported http request method");i=59}catch(h){PutToDebugLogException(2,"common: HttpRequest ("+i.toString()+")",h);try{"creditrequest"===t&&(webphone_api.global.creditRequestIval<3e4?webphone_api.global.creditRequestIval=2*webphone_api.global.creditRequestIval:webphone_api.global.creditRequestIval=webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL)}catch(g){}}}function CORSRequest(e,t,n,o){try{var i="GET";n&&(i="POST"),e=e.replace("[POST]","");var a=new XMLHttpRequest;if(PutToDebugLog(2,"EVENT, CORSRequest url: "+e+"; action: "+t+"; ispost: "+n+"; postdata: "+o),"withCredentials"in a)a.open(i,e,!0);else{if("undefined"==typeof XDomainRequest)return a=null,PutToDebugLog(2,"ERROR, common: CORSRequest, CORS not supported"),webphone_api.global.httpmehod="jsonp",!1;a=new XDomainRequest,a.open(i,e)}var r=0;a.onload=function(){try{if(PutToDebugLog(4,"EVENT, CORSRequest.onload"),r=19,!1===webphone_api.global.httpheaderslogged&&a.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 1: "+a.getAllResponseHeaders())}var e=a.responseText,n="";n=!isNull(e)&&e.length>250?e.substring(0,250)+"....":e,isNull(n)&&(n="NULL"),r=20,PutToDebugLog(2,"EVENT, CORSRequest response: "+n);return r=21,isNull(e)||e.length<1?(r=23,PutToDebugLog(2,"ERROR, CORSRequest response is NULL"),!1):(HttpResponseHandler(e,t),e)}catch(o){PutToDebugLogException(2,"common: CORSRequest.onload inner ("+r+")",o)}},a.onerror=function(e){var t="";isNull(e)||(t=e.toString(),isNull(e.target)||(t=isNull(e.target.status)?t+" "+e.target.toString():t+" "+e.target.status.toString())),PutToDebugLog(2,"ERROR, common: CORSRequest: onerror: "+t)};var s=reqtimeout;!0===n&&(s+=2e3),e.indexOf("xautoprov")>=0&&(s+=15e3),a.timeout=s,a.ontimeout=function(e){PutToDebugLog(2,"ERROR, common: CORSRequest: Timeout")},n?(isNull(o)&&(o=""),o=Trim(o),0===o.indexOf("?")&&(o=o.replace("?","")),a.send(o)):a.send()}catch(l){PutToDebugLogException(2,"common: CORSRequest",l)}}function ResetWsapisocket(e){try{isNull(e)&&(e=""),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, ResetWsapisocket, websocketNS close from: "+e),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen&&(wsapisocket.onopen=null),wsapisocket.onclose&&(wsapisocket.onclose=null),wsapisocket.onerror&&(wsapisocket.onerror=null))}catch(t){PutToDebugLogException(2,"common: ResetWsapisocket",t)}wsapisocket=null}function WSAPIRequest(method,data,apiname,callback){try{if(!callback||"function"!=typeof callback)return void PutToDebugLog(2,"ERROR, WSAPIRequest websocketNS callback is NULL");if(!1===Glsp())return void PutToDebugLog(2,"WARNING, WSAPIRequest websocketNS do not send");if(!isNull(apiname)&&apiname.length>0&&(apiname=Trim(apiname),0===apiname.indexOf("API_")&&"API_Poll"!==apiname&&"API_Stop"!==apiname)){srv_cb.push(callback),srv_apiname.push(apiname.toLowerCase());var finalparam="";if(!isNull(data)&&data.indexOf("param1=")>0){var tmp=ReplaceAll(data,"BOFLINE","");tmp=ReplaceAll(tmp,"EOFLINE","");var param1=tmp.substring(tmp.indexOf("param1=")+7),param2="";param1.indexOf("param2=")>=0?(param2=param1.substring(param1.indexOf("param2=")+7),param2=param2.indexOf("param3=")>=0?param2.substring(0,param2.indexOf("param3=")):param2.substring(0,param2.indexOf("EOFCOMMAND")),param2=Trim(param2),param1=param1.substring(0,param1.indexOf("param2=")),param1=Trim(param1)):(param1=param1.substring(0,param1.indexOf("EOFCOMMAND")),param1=Trim(param1)),finalparam=param1+param2}var sparamtmp=finalparam;sparamtmp.indexOf("requestid=")>=0&&(sparamtmp=sparamtmp.replace("requestid=","")),srv_params.push(sparamtmp)}if(!0===TestNSPolling()&&(webphone_api.global.useajax_forservice=!0),wsapimaxloop>15&&!IsMacLin()&&!IsWinMacLinNsTest()&&(webphone_api.global.useajax_forservice=!0),!0===webphone_api.global.useajax_forservice||"API_Poll"===apiname)WSAPIReqHTTP(method,data,callback);else if(!0===webphone_api.global.flagnsreconnect&&(PutToDebugLog(2,"EVENT,WSAPIReconnect websocketNS because engine was stopped"),webphone_api.global.flagnsreconnect=!1,void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null),void 0===wsapisocket||null===wsapisocket){var url=GetParameter("last_good_ns_plugin_url");(isNull(url)||url.length<5)&&!isNull(lastgoodnspluginurl)&&lastgoodnspluginurl.length>0?url=lastgoodnspluginurl:lastgoodnspluginurl=url,"API_Poll"!==apiname&&"API_Stop"!==apiname&&"API_HTTPKeepAlive"!==apiname&&(wsapi_method.push(method),wsapi_data.push(data),wsapi_cb.push(callback)),isNull(url)||url.length<5?IsServiceInstalled(function(e){PutToDebugLog(2,"EVENT, WSAPIRequest IsServiceInstalled returned: "+e)}):WSAPIConnect(url,method,data,callback)}else{if((!1===wsapiready||wsapi_method.length>0)&&"API_Poll"!==apiname&&"API_Stop"!==apiname&&"API_HTTPKeepAlive"!==apiname){"API_SetParameters"===apiname||"API_Start"===apiname||"API_SetDIDChange"===apiname?RemoveFromWsapiQueue(apiname):RemoveFromWsapiQueue(apiname,data),wsapi_method.push(method),wsapi_data.push(data),wsapi_cb.push(callback);var toprint=data;return isNull(toprint)&&(toprint=""),toprint.length>100&&(toprint=toprint.substring(0,99)),void(!0===wsapiready&&wsapi_method.length>0?(CanLog(2)&&PutToDebugLog(2,"EVENT, WSAPIRequest websocketNS attempt to start sending out cached data: "+wsapiready+"("+wsapi_method.length+"): "+toprint),HandleWsapiQueue()):CanLog(2)&&PutToDebugLog(2,"EVENT, WSAPIRequest websocketNS cached for later execution: Websocket not ready: "+wsapiready+"("+wsapi_method.length+"): "+toprint))}if("API_Start"!==apiname&&"API_SetParameters"!==apiname&&"API_Poll"!==apiname&&"API_Stop"!==apiname&&webphone_api.global.apistartstate<2&&webphone_api.global.apistarttick>0&&GetTickCount()-webphone_api.global.apistarttick<3e3){if("API_Poll"!==apiname){wsapi_method.push(method),wsapi_data.push(data),wsapi_cb.push(callback);var toprint=data;isNull(toprint)&&(toprint=""),toprint.length>100&&(toprint=toprint.substring(0,99)),CanLog(2)&&PutToDebugLog(2,"EVENT, WSAPIRequest websocketNS cached for later execution: no API_Start feedback: "+toprint)}return}CanLog(4)&&PutToDebugLog(4,"EVENT, _common: WSAPIRequest websocketNS SEND data: "+data),void 0!==wsapisocket&&null!==wsapisocket||PutToDebugLog(2,"ERROR, _common: WSAPIRequest websocketNS wsapisocket is NULL 1"),wsapisocket.send(data),wsapisocket.onmessage=function(evt){var recdata=null;if(isNull(evt)||(recdata=evt.data),isNull(recdata))return void PutToDebugLog(2,"ERROR, common: WSAPIRequest.onmessage websocketNS, received data is NULL");webphone_api.webphone_pollstatus=!1;var resp=ArrayBufferToString(recdata);if((resp.indexOf("WPNOTIFICATION,")>=0||0==resp.indexOf("STATUS,"))&&!0===webphone_api.global.cansetuseengine&&(StrToIntDef(GetParameter2("enginepriority_ns"),6)>0&&(webphone_api.global.useengine=webphone_api.global.ENGINE_SERVICE,webphone_api.common.PutToDebugLog(5,"EVENT, Settings set useengine to NS on NS answer received")),webphone_api.global.cansetuseengine=!1),isNull(resp)||(resp=Trim(resp)),0!==resp.indexOf("webphone_api.")||resp.lastIndexOf(")")!==resp.length-1&&resp.lastIndexOf(");")!==resp.length-2)ProcessServiceReqResponse(resp,callback);else{resp=Trim(resp),PutToDebugLog(2,"EVENT, Process service command: "+resp);try{eval(resp)}catch(errp){PutToDebugLogException(2,"ERROR, Process service command failed: "+resp,errp)}}}}}catch(err){PutToDebugLogException(2,"common: WSAPIRequest websocketNS",err)}}function WSAPIHandleReConnect(){try{if(0!=-webphone_api.global.service_last_life_signal&&webphone_api.common.GetTickCount()-webphone_api.global.service_last_life_signal<8e3)return void PutToDebugLog(2,"EVENT, skip exec WSAPIReConnect because data received meantime");WinAPI("extcmd_version",function(e){isNull(e)||e.indexOf("ERROR:")>=0||(webphone_api.global.last_ns_ws_succwss=GetTickCount())}),setTimeout(function(){0==webphone_api.global.last_ns_ws_succwss||GetTickCount()-webphone_api.global.last_ns_ws_succwss>1200?(PutToDebugLog(2,"ERROR, exec WSAPIReConnect from timer (1)"),WSAPIReConnect()):!0===webphone_api.isincall()?PutToDebugLog(2,"EVENT, skip exec WSAPIReConnect from timer (2) incall and responded to version request"):WinAPI("API_Start2",function(e){PutToDebugLog(2,"EVENT, exec API_Start2 because NS engine was not responsive: answer: "+e)})},1e3)}catch(e){PutToDebugLogException(2,"common: WSAPIHandleReConnect",e)}}function WSAPIReConnect(){try{wsar_count++;var e=GetTickCount();if(e-wsar_lastcalled<100)return;if(wsar_lastcalled=e,(!0===wsa_ever_connected&&wsar_count<150||wsar_count<50)&&null===wsar_timer){wsar_delay>2e3&&getuseengine()===webphone_api.global.ENGINE_SERVICE&&webphone_api.global.phonestarted>1&&(PutToDebugLog(1,"STATUS,"+webphone_api.stringres.get("ns_engine_unreachable")),webphone_api.global.display_last_status=!0),wsar_delay<32e3&&(wsar_delay*=2);return PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS after: "+(wsar_delay/1e3).toString()+" sec"),wsar_timer=setTimeout(function(){wsar_delay>3e4?(PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS whole SIPStack restart"),WSAPIConnect(wsapi_reconnect_address,"","",function(){})):(PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS reconnecting..."),WSAPIConnect(wsapi_reconnect_address,"","",function(){})),isNull(wsar_timer)||clearTimeout(wsar_timer),wsar_timer=null},wsar_delay),wsar_delay<10&&(wsar_delay=500),!0}}catch(t){PutToDebugLogException(2,"common: WSAPIReConnect websocketNS",t)}}function WSAPIConnect(e,t,n,o){try{if(isNull(e)||e.length<1){PutToDebugLog(2,"EVENT, load WSAPIConnect websocketNS url from scratch c");var i=GetNsPluginWsUrl();if(null===i||i.length<1)return void PutToDebugLog(2,"ERROR, WSAPIReqHTTP could not find a valid URL c");e=i[0]}0!==e.indexOf("ws")&&(e="ws://"+e),CanLog(3)&&PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS url: "+e),wsapi_reconnect_address=e,wsapiskt_closedmanually=!1;var a=!1;0===e.toLowerCase().indexOf("wss:")&&(a=!0),(e.indexOf("/mvstwebsock")>0||e.indexOf("/mfstwebsock")>0)&&e.indexOf("requestid=")<0&&(e=e.indexOf("?")>0?e+"&requestid="+GetRequestId():e+"?requestid="+GetRequestId());var r=!1;if(!1===TestNSPolling()){try{CanLog(2)&&PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (1)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (1)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError,r=!0,webphone_api.global.cansetuseengine=!0}catch(s){PutToDebugLogException(2,"common: WSAPIConnect websocketNS failed to connect to: "+e,s)}if(!1===r&&!1===a){e=GetParameter("nsdomain",webphone_api.global.NATIVE_PLUGIN_URL_SECURE),0!=e.indexOf("ws")&&(e="wss://"+e),(e.indexOf("/mvstwebsock")>0||e.indexOf("/mfstwebsock")>0)&&e.indexOf("requestid=")<0&&(e=e.indexOf("?")>0?e+"&requestid="+GetRequestId():e+"?requestid="+GetRequestId());try{CanLog(2)&&PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (2)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (2)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError,r=!0}catch(l){PutToDebugLogException(2,"WSAPIConnect failed to connect on 2nd attempt to (on SECURE connection) : "+e,l)}}}if(!1===r)return void(IsMacLin()||IsWinMacLinNsTest()||(WSAPIReqHTTP(t,n,o),webphone_api.global.useajax_forservice=!0));(isNull(wsapisocket)||!1===r)&&(CanLog(2)&&PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (3)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (3)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen&&(wsapisocket.onopen=null),wsapisocket.onclose&&(wsapisocket.onclose=null),wsapisocket.onerror&&(wsapisocket.onerror=null)),(e.indexOf("/mvstwebsock")>0||e.indexOf("/mfstwebsock")>0)&&e.indexOf("requestid=")<0&&(e=e.indexOf("?")>0?e+"&requestid="+GetRequestId():e+"?requestid="+GetRequestId()),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError),wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError}catch(p){PutToDebugLogException(2,"common: WSAPIConnect websocketNS",p)}}function WsapisktOnOpen(){CanLog(2)&&PutToDebugLog(2,"EVENT, common: WSAPIConnect.onopen websocketNS, connection ready"),wsapiready=!0,wsapimaxloop=0,wsa_ever_connected=!0,wsar_delay=1,webphone_api.global.display_last_status&&(webphone_api.global.display_last_status=!1,PutToDebugLog(2,"EVENT, Display last good status to hide Engine unreachable"),PutToDebugLog(1,"EVENT, "+webphone_api.global.last_good_status)),HandleWsapiQueue()}function WsapisktOnClose(){CanLog(2)&&PutToDebugLog(2,"EVENT, common: WSAPIConnect.onclose websocketNS, connection closed"),wsapisocket=null,wsapiready=!1,!1===wsapiskt_closedmanually&&(PutToDebugLog(2,"ERROR, common: WSAPIConnect.onclose connection interrupted"),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onclose websocketNS, call WSAPIReConnect"),WSAPIReConnect())}function WsapisktOnError(){var e="";"undefined"!=typeof wserr&&null!==wserr&&(e=wserr.toString()),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onerror websocketNS, connection onerror: "+e),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onerror websocketNS, call WSAPIReConnect"),WSAPIReConnect(),setTimeout(function(){void 0!==wsapisocket&&null!==wsapisocket&&!0===wsapiready&&(webphone_api.global.wnotstartedsession=!1)},1500),wsapiready=!1,wsapimaxloop++}function RemoveFromWsapiQueue(e,t){try{if(isNull(e)||e.length<1)return;if(isNull(wsapi_method)||wsapi_method.length<1)return;for(var n=wsapi_method.length-1;n>=0;n--)wsapi_method[n]===e&&(isNull(t)||t.length<1||wsapi_data[n]===t)&&(delete wsapi_method[n],delete wsapi_data[n],delete wsapi_cb[n])}catch(o){PutToDebugLogException(2,"common: RemoveFromWsapiQueue",o)}}function HandleWsapiQueue(){try{if(isNull(wsapi_data)||wsapi_data.length<1)return wsapi_method=[],wsapi_data=[],void(wsapi_cb=[]);if(!isNull(hwqueue_timer))return;CanLog(5)&&PutToDebugLog(5,"EVENT, HandleWsapiQueue "+wsapi_data.length),hwqueue_timer=setInterval(function(){try{if(isNull(wsapi_data)||wsapi_data.length<1)return isNull(hwqueue_timer)||clearInterval(hwqueue_timer),hwqueue_timer=null,wsapi_method=[],wsapi_data=[],void(wsapi_cb=[]);if(void 0===wsapisocket||null===wsapisocket)return void PutToDebugLog(2,"WANING, _common: WSAPIRequest websocketNS HandleWsapiQueue wsapisocket is NULL 2");var e=wsapi_data[0],t="",n=e.indexOf("function=");if(n>0&&(t=e.substring(n+9),n=t.indexOf("EOFLINE"),t=n>0?t.substring(0,n):""),"API_Start"!==t&&"API_SetParameters"!==t&&webphone_api.global.apistartstate<2&&webphone_api.global.apistarttick>0&&GetTickCount()-webphone_api.global.apistarttick<3e3)return;e=wsapi_data.shift();var o=(wsapi_method.shift(),wsapi_cb.shift());CanLog(4)&&PutToDebugLog(4,"EVENT, _common: WSAPIRequest websocketNS HandleWsapiQueue SEND data: "+e),wsapisocket.send(e),wsapisocket.onmessage=function(e){var t=null;if(isNull(e)||(t=e.data),isNull(t))return void PutToDebugLog(2,"ERROR, common: WSAPIRequest.onmessage websocketNS HandleWsapiQueue, received data is NULL");ProcessServiceReqResponse(ArrayBufferToString(t),o)}}catch(i){PutToDebugLogException(2,"common: HandleWsapiQueue Timer, skip all cached requests",i),wsapi_method=[],wsapi_data=[],wsapi_cb=[]}},2)}catch(e){PutToDebugLogException(2,"common: HandleWsapiQueue",e)}}function WSAPIReqHTTP(e,t,n){try{if(isNull(wreqhttp)||wreqhttp.length<1){if(wreqhttp=GetParameter("last_good_ns_plugin_url"),isNull(wreqhttp)||wreqhttp.length<5){var o=GetNsPluginWsUrl();if(null===o||o.length<1)return void PutToDebugLog(2,"ERROR, WSAPIReqHTTP could not find a valid URL");wreqhttp=o[0],o.length>1&&UseSecureSrvConnection()&&o[0].indexOf("wss://")<0&&o[1].indexOf("wss://")>=0&&(wreqhttp=o[1])}wreqhttp=wreqhttp.toLowerCase(),wreqhttp=wreqhttp.replace("wss:","https:"),wreqhttp=wreqhttp.replace("ws:","http:"),wreqhttp=wreqhttp.replace("msstwebsock",""),PutToDebugLog(2,"EVENT, WSAPIReqHTTP url: "+wreqhttp)}PollServiceStatus(e,wreqhttp);var i="POST";"get"===e.toLowerCase()&&(i="GET"),webphone_api.$.ajax({url:wreqhttp,data:t,timeout:2500,method:i}).done(function(e,t,o){if(PutToDebugLog(2,"EVENT, common: WSAPIReqHTTP response: "+e),isNull(e))return void PutToDebugLog(2,"ERROR, common: WSAPIReqHTTP received data is NULL");ProcessServiceReqResponse(e,n)}).fail(function(e,t,n){PutToDebugLog(2,"ERROR, common: WSAPIReqHTTP ajax failed, status: "+t+"; error: "+n)})}catch(a){PutToDebugLogException(2,"common: WSAPIReqHTTP",a)}}function PollServiceStatus(e,t){try{if(!0!==webphone_api.global.useajax_forservice)return;if(!isNull(webphone_api.global.serviceStatusPollTimer))return;nspollinterval<1&&(nspollinterval=GetParameterInt("nspollinterval",300)),webphone_api.global.serviceStatusPollTimer=setInterval(function(){pollreqcount++,!0===TestNSPolling()&&PutToDebugLog(2,"EVENT, common: PollServiceStatus: send extcmd_poll; request sent count: "+pollreqcount),webphone_api.$.ajax({url:t,data:"extcmd_poll",timeout:1e3,method:e.toUpperCase()}).done(function(e,t,n){isNull(e)&&(e="");var o=e.indexOf("APIRESULT:");o>0&&(e=e.substring(o+10),e.indexOf("nomessage")<0&&(o=e.indexOf("message:"))>0&&(e=Trim(e.substring(o+8)),webphonetojs(e)))}).fail(function(e,t,n){PutToDebugLog(2,"ERROR, common: PollServiceStatus ajax failed, status: "+t+"; error: "+n)})},nspollinterval)}catch(n){PutToDebugLogException(2,"common: WSAPIReqHTTP",n)}}function ProcessServiceReqResponse(e,t){var n=0;try{var o="";if(n=11,isNull(e)||e.length<1)return n=13,CanLog(4)&&PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(1) is null: "+e),t(null),t=null,"";if(CanLog(7)&&PutToDebugLog(7,"PROCESSING_SRVRESPONSE: "+e),e=e.replace("NORETRY",""),e.indexOf("webphone_api.")>=0&&(")"===e.charAt(e.length-1)||")"===e.charAt(e.length-2)&&";"===e.charAt(e.length-1)))return CanLog(2)&&PutToDebugLog(2,"EVENT, common: ServiceResponse exec function received form websocket: "+e),void ExecFunction(e);if(e.indexOf("OK: pending")>=0)return void(CanLog(2)&&PutToDebugLog(2,"EVENT, common: ServiceResponse received pending, waiting for answer"));if(e.indexOf("WPNOTIFICATION")>=0)return webphonetojs(e),!0;if(!(e.indexOf("APIREQUEST:")>=0))return CanLog(4)&&PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(3): "+e),n=46,void 0!==t&&null!==t&&IsFunction(t)&&t(o),t=null,o;if(CanLog(4)){var i=e;i.indexOf("ERROR:")>=0&&(i=i.replace("ERROR:","EVENT: (err) ")),PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(2): "+i)}n=14;var a="",r="",s=""
;if(e.indexOf("APIRESULT:")>0&&(n=15,getuseengine()===webphone_api.global.ENGINE_SERVICE&&(webphone_api.global.service_last_life_signal=GetTickCount()),e.indexOf("RPARAM1")>0?(a=e.substring(e.indexOf("APIREQUEST:")+11,e.indexOf("RPARAM1:")),e.indexOf("RPARAM2")>0?(r=e.substring(e.indexOf("RPARAM1:")+8,e.indexOf("RPARAM2")),s=e.substring(e.indexOf("RPARAM2:")+8,e.indexOf("APIRESULT:"))):r=e.substring(e.indexOf("RPARAM1:")+8,e.indexOf("APIRESULT:")),o=e.substring(e.indexOf("APIRESULT:")+10,e.length)):(a=e.substring(e.indexOf("APIREQUEST:")+11,e.indexOf("APIRESULT:")),o=e.substring(e.indexOf("APIRESULT:")+10,e.length))),n=18,isNull(a)?a="":(a=Trim(a),a=a.toLowerCase()),o=isNull(o)?"":Trim(o),n=19,50===GetConfigInt("brandid",-1)&&(isNull(r)&&(r=""),r=r.toLowerCase(),r.indexOf("ww.favafone")>0))return r.indexOf("countries-list")>0?HttpResponseHandler(o,"get_new_user_countrylist"):r.indexOf("registration-form")>0?HttpResponseHandler(o,"get_new_user_form_fields"):r.indexOf("create-account")>0&&HttpResponseHandler(o,"newuser_dynamic"),o;if(n=20,"api_poll"===a)n=21,webphonetojs(o),n=22;else{if(0!==a.indexOf("api_"))return o.indexOf("ERROR")>=0?(n=30,PutToDebugLog(2,"ERROR, "+o),n=31,t&&IsFunction(t)&&(n=32,t(o),t=null),""):"true"===o.toLowerCase()?(n=35,t(!0),t=null,!0):"false"===o.toLowerCase()?(n=36,t(!1),t=null,!1):IsNumber(o)?(n=37,t(StrToInt(o)),t=null,StrToInt(o)):o.indexOf("OK")>=0&&o.length<12?(n=40,t(!0),t=null,!0):(n=41,t(o),t=null,o);if(n=23,o.indexOf("ERROR")>=0)if(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===webphone_api.global.ENGINE_SERVICE)o.indexOf("wphone")>0&&o.indexOf("not")>0&&o.indexOf("started")>0&&!1===webphone_api.global.wnotstartedsession&&webphone_api.global.apistartstate>0&&webphone_api.global.apistarttick>0&&GetTickCount()-webphone_api.global.apistarttick>3e3&&(webphone_api.global.wnotstartedsession=!0,PutToDebugLog(2,"WARNING, mlogic API_Sart because: wphone not started received"),WinAPI("API_Start",function(e){PutToDebugLog(2,"ERROR, API_Start because: wphone not started answer: "+e)}));else if("api_call"===a){n=24;var l=o.replace("ERROR","");l=l.replace(":",""),PutToDebugLog(1,"ERROR, "+l)}else n=25,PutToDebugLog(2,"ERROR, "+o);n=26;var p=null,c=!1;if(!isNull(srv_cb)&&srv_cb.length>0){var u=r+s;!isNull(u)&&u.length>85&&(u=u.substring(0,85));for(var h=0;h<srv_apiname.length;h++)if(srv_apiname[h]===a){!isNull(srv_params[h])&&srv_params[h].length>85&&(srv_params[h]=srv_params[h].substring(0,85));var g=srv_params[h],m=u,d=g.indexOf("\r");if(d>0&&(g=g.substring(0,d)),g=Trim(g),d=m.indexOf("\r"),d>0&&(m=m.substring(0,d)),m=Trim(m),srv_params[h]===u||!isNull(g)&&g.length>0&&g===m){srv_apiname[h],p=srv_cb[h],isNull(p)||IsFunction(p)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a functionC ("+typeof p+") ("+srv_apiname+"): "+e),p=null),srv_apiname.splice(h,1),srv_cb.splice(h,1),srv_params.splice(h,1),c=!0;break}}if(!c)for(var h=0;h<srv_apiname.length;h++)if(srv_apiname[h]===a){!isNull(srv_params[h])&&srv_params[h].length>10&&(srv_params[h]=srv_params[h].substring(0,10)),!isNull(u)&&u.length>10&&(u=u.substring(0,10));var g=srv_params[h],m=u,d=g.indexOf("\r");if(d>0&&(g=g.substring(0,d)),g=Trim(g),d=m.indexOf("\r"),d>0&&(m=m.substring(0,d)),m=Trim(m),srv_params[h]===u||!isNull(g)&&g.length>0&&g===m||!isNull(g)&&g.length>0&&(0==g.indexOf(m)||0==m.indexOf(g))){srv_apiname[h],p=srv_cb[h],isNull(p)||IsFunction(p)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a functionC2 ("+typeof p+") ("+srv_apiname+"): "+e),p=null),srv_apiname.splice(h,1),srv_cb.splice(h,1),srv_params.splice(h,1),c=!0;break}}if(!c)for(var h=0;h<srv_apiname.length;h++)if(srv_apiname[h]===a){!isNull(srv_params[h])&&srv_params[h].length>1&&(srv_params[h]=srv_params[h].substring(0,1)),!isNull(u)&&u.length>1&&(u=u.substring(0,1));var g=srv_params[h],m=u,d=g.indexOf("\r");if(d>0&&(g=g.substring(0,d)),g=Trim(g),d=m.indexOf("\r"),d>0&&(m=m.substring(0,d)),m=Trim(m),srv_params[h]===u||!isNull(g)&&g.length>0&&g===m){srv_apiname[h],p=srv_cb[h],isNull(p)||IsFunction(p)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a functionC3 ("+typeof p+") ("+srv_apiname+"): "+e),p=null),srv_apiname.splice(h,1),srv_cb.splice(h,1),srv_params.splice(h,1),c=!0;break}}if(!c)for(var h=0;h<srv_apiname.length;h++)if(srv_apiname[h]===a){srv_apiname[h],p=srv_cb[h],isNull(p)||IsFunction(p)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a functionC4 ("+typeof p+") ("+srv_apiname+"): "+e),p=null),srv_apiname.splice(h,1),srv_cb.splice(h,1),srv_params.splice(h,1),c=!0;break}}if(n=27,!isNull(p)&&IsFunction(p)){if(n=28,isNull(o)&&(n=102,o=""),n=103,o=o.toString(),n=104,"true"===o.toLowerCase())return n=105,p(!0),n=106,!0;if("false"===o.toLowerCase())return n=107,p(!1),n=108,!1;if(o.toString&&IsNumber(o.toString().replace("OK:","")))return n=109,p(StrToInt(o.toString().replace("OK:",""))),StrToInt(o.toString().replace("OK:",""));if(o.indexOf("OK")>=0&&o.length<15)return n=110,p(!0),n=111,!0;n=112;try{"function"==typeof p?(n=1120101,p(o)):PutToDebugLog(2,"WARNING, ProcessServiceResponse cb_tmp is not a functionA ("+n+") ("+srv_apiname+"): "+e)}catch(w){PutToDebugLogException(2,"common: ProcessServiceReqResponseInner ("+n.toString()+") res: "+o+", cb: "+p,w)}return n=113,o}var b="";if(isNull(p))b="NULL";else try{b=p.toString()}catch(w){b="NOTAFUNCTION"}"api_setparameters"===a||"api_setdidchange"===a||"api_httpkeepalive"===a||"api_checkconnection"===a||"api_isnewbrowserconnection"===a||"api_setachange"===a||"api_setbchange"===a?PutToDebugLog(5,"EVENT, ProcessServiceResponse cb_tmp is not a functionB1 "+a):PutToDebugLog(2,"WARNING, ProcessServiceResponse cb_tmp is not a functionB. req: "+a+", cb: "+b+", list: "+srv_apiname+", received: "+e),n=29}n=45}catch(w){if(void 0!==w&&null!==w){var _=w.toString(),f="";if("undefined"!=typeof w.message&&null!==w.message&&(f=w.message),_.toLowerCase().indexOf("is not a function")>=0||f.toLowerCase().indexOf("is not a function")>=0)return void PutToDebugLog(2,"EVENT, common: ProcessServiceReqResponse ("+n.toString()+")"+_+" "+f)}PutToDebugLogException(2,"common: ProcessServiceReqResponse ("+n.toString()+")",w)}}function WSRequest(e,t,n){var o=0;try{if(isNull(wssocket)){PutToDebugLog(2,"EVENT, WSRequest need WsConnect websocketAPI, url: "+e),o=1;var i=GetWebrtcSrvAddr();if(o=2,isNull(i)||i.length<2){if(i=GetWp(),IsLocalServer(!0))return void PutToDebugLog(2,"ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+" (1)")}else PutToDebugLog(2,"EVENT, WSRequest webrtcserveraddress found: "+i);if(i=i.replace("*",""),o=11,IsMizuServerOrGateway()){o=12;var a=i.indexOf("/mfst");a>0&&(i=i.substring(0,a)),i+="/mvstwebsock"}if(i=i.replace("/mfstwebsock","/mvstwebsock"),ws_inurl.push(e),ws_action.push(t),ws_ispost.push(n),HandleQueueOverload(),IsMizuPublicWebRTCGatewayUsed()&&!1===webphone_api.global.decideusuk_finished&&getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void PutToDebugLog(2,"EVENT, WSRequest decideusuk not yet finished");PutToDebugLog(2,"EVENT, WSRequest call WsConnect websocketAPI "+e+" / "+i),WSConnect(e,t,n,i),o=17}else{if(!1===wsready||ws_inurl.length>0)return ws_inurl.push(e),ws_action.push(t),ws_ispost.push(n),HandleQueueOverload(),void PutToDebugLog(2,"EVENT, WSRequest request cached for later execution "+wsready.toString()+" "+ws_inurl.length);var r=e;r=r.replace("mvapireq","mvstwebsock/mvapireq"),r=HandleApiKey(r),!isNull(r)&&r.indexOf("google.com")>0?PutToDebugLog(4,"EVENT, _common: WSRequest initialized"):PutToDebugLog(4,"EVENT, _common: WSRequest url: "+r);try{o=30,isNull(ws_action_sent)&&(ws_action_sent=[]),isNull(t)&&(t=""),ws_action_sent.push(t),void 0!==wssocket&&null!==wssocket||PutToDebugLog(2,"ERROR, _common: WSRequest wssocket is NULL 1"),webphone_api.global.wsc_reqtimeout=GetTickCount(),wssocket.send(r+"\r\n"),o=34}catch(s){PutToDebugLogWarning(3,"WARNING, common: WSRequest",s)}o=35}}catch(l){PutToDebugLogException(2,"common: WSRequest ("+o.toString()+")",l)}}function HandleQueueOverload(){try{var e=0,t=0;if(!isNull(ws_inurl)&&ws_inurl.length>0)for(;t<ws_inurl.length&&e<15;)"webrtcload"===ws_action[t]||"webrtccreateuser"===ws_action[t]?t++:(ws_inurl.splice(t,1),ws_action.splice(t,1),ws_ispost.splice(t,1),e++)}catch(n){PutToDebugLogException(2,"common: HandleQueueOverload",n)}}function WSConnect(e,t,n,o){var i=0;try{if(isNull(o)||o.length<2)PutToDebugLog(2,"ERROR, common: WSConnect websocketAPI address is NULL");else{i=2,0!==o.indexOf("ws")&&(o=BrowserRequiresHttps()?"wss://"+o:"ws://"+o);var a="";try{a=location.host.toLowerCase()}catch(s){}if(UseSecureSrvConnection()||a.indexOf("localhost")>=0||a.indexOf("127.0.0.1")>=0){var r=GetWsAddressCfg();(isNull(r)||void 0===r||r.length<4||r.indexOf("wss:")<0&&r.indexOf("ws:")<0)&&(r=GetParameter("webrtcserveraddress"),(isNull(r)||void 0===r||r.length<4||r.indexOf("wss:")<0&&r.indexOf("ws:")<0)&&"undefined"!=typeof webphone_api.parameters.origwebrtcserveraddress&&null!==webphone_api.parameters.origwebrtcserveraddress&&webphone_api.parameters.origwebrtcserveraddress.length>3&&(r=webphone_api.parameters.origwebrtcserveraddress)),!isNull(r)&&void 0!==r&&null!==r&&r.length>4&&r.indexOf("ws:")>=0||(o=o.replace("ws:","wss:"))}o=o.toString(),(o.indexOf("/mvstwebsock")>0||o.indexOf("/mfstwebsock")>0)&&o.indexOf("requestid=")<0&&(o=o.indexOf("?")>0?o+"&requestid="+GetRequestId():o+"?requestid="+GetRequestId()),PutToDebugLog(2,"EVENT, WSConnect websocketAPI address: "+o),webphone_api.global.wsc_contimeout=GetTickCount(),wsconnect_address=o,wssocket=new WebSocket(o,"api"),wssocket.binaryType="arraybuffer",i=5}wssocket.onopen=function(){webphone_api.global.wsc_contimeout=0;var e="";isNull(wssocket)||isNull(wssocket.url)||(e=wssocket.url.toString()),PutToDebugLog(2,"EVENT, common: WSConnect.onopen websocketAPI, connection ready "+e),SaveParameter("wseverconnected","true"),wsready=!0,HandleWsQueue()},wssocket.onclose=function(){var e="";isNull(wssocket)||isNull(wssocket.url)||(e=wssocket.url.toString()),PutToDebugLog(2,"EVENT, common: WSConnect.onclose websocketAPI, connection closed "+e),wssocket=null,wsready=!1},wssocket.onerror=function(e){var t="";isNull(e)||(t=e.toString());var n="";isNull(wssocket)||isNull(wssocket.url)||(n=wssocket.url.toString()),PutToDebugLog(2,"ERROR, common: WSConnect.onerror websocketAPI, connection onerror: "+t+" url: "+n),wsready=!1,wssocket=null,PutToDebugLog(2,"ERROR, common: WSConnect.onerror websocketAPI, call WSReConnect"),WSReConnect()},i=20,wssocket.onmessage=function(e){webphone_api.global.wsc_reqtimeout=0;var t=null;if(isNull(e)||(t=e.data),isNull(t))return void PutToDebugLog(2,"ERROR, common: WSConnect.onmessage websocketAPI, received data is NULL");var n="";isNull(ws_action_sent)||isNull(ws_action_sent[0])||(n=ws_action_sent.shift()),HttpResponseHandler(ArrayBufferToString(t),n)}}catch(l){PutToDebugLogException(2,"common: WSConnect websocketAPI ("+i.toString()+")",l)}}function WSReConnect(){try{if(++wsr_count<80&&null===wsr_timer){wsr_delay<32e3&&(wsr_delay*=2);return PutToDebugLog(2,"EVENT, WSReConnect websocketAPI after: "+(wsr_delay/1e3).toString()+" sec"),wsr_timer=setTimeout(function(){PutToDebugLog(2,"EVENT, WSReConnect websocketAPI reconnecting..."),WSConnect("","","",wsconnect_address),isNull(wsr_timer)||clearTimeout(wsr_timer),wsr_timer=null},wsr_delay),wsr_delay<10&&(wsr_delay=500),!0}}catch(e){PutToDebugLogException(2,"common: WSReConnect websocketAPI",e)}return!1}function HandleWsQueue(){try{if(isNull(ws_inurl)||ws_inurl.length<1)return;if(!isNull(hawsqueue_timer))return;hawsqueue_timer=setInterval(function(){if(isNull(ws_inurl)||ws_inurl.length<1)return isNull(hawsqueue_timer)||clearInterval(hawsqueue_timer),void(hawsqueue_timer=null);if(void 0===wssocket||null===wssocket)return void PutToDebugLog(2,"WARNING, _common: WSRequest HandleWsQueue wssocket is NULL 2");var e=ws_inurl.shift(),t=ws_action.shift();ws_ispost.shift();ws_action_sent.push(t),e=HandleApiKey(e),PutToDebugLog(4,"EVENT, _common: WSRequest HandleWsQueue SEND data: "+e),webphone_api.global.wsc_reqtimeout=GetTickCount(),wssocket.send(e+"\r\n")},200)}catch(e){PutToDebugLogException(2,"common: HandleWsQueue",e)}}function HandleApiKey(e){try{if(isNull(e))return e;var t=e,n=t.indexOf("mcrfs=");if(n>0&&(t=StrDc("mcrfs_"+t.substring(n+6),webphone_api.global.ec_apikey)),!isNull(webphone_api.global.selected_apikey)&&webphone_api.global.selected_apikey.length>0){var o=t.indexOf("authkey=");if(o>0){var i=t.substring(0,o+8),a="";t=t.substring(o+8),o=t.indexOf("&"),o>0&&(a=t.substring(o+1)),e=i+webphone_api.global.selected_apikey+a}n>0&&(e=e.substring(0,n+6)+StrEc(t,webphone_api.global.ec_apikey,!0))}else{if(t.indexOf("1568108399")>0)return e;if(t.indexOf("authkey=1568108345")>0&&"us"===webphone_api.global.usuk)t=t.replace("authkey=1568108345","authkey=1552303117"),e=n>0?e.substring(0,n+6)+StrEc(t,webphone_api.global.ec_apikey,!0):t;else if(t.indexOf("authkey=1552303117")>0&&"uk"===webphone_api.global.usuk)t=t.replace("authkey=1552303117","authkey=1568108345"),e=n>0?e.substring(0,n+6)+StrEc(t,webphone_api.global.ec_apikey,!0):t;else if(!isNull(wsconnect_address)&&wsconnect_address.length>3&&webphone_api.global.usuk.length>0){var r=0;if(wsuk_ip.length<1&&(wsuk_ip=StrDc(wip_uk,alsvkey),wsuk_domain=StrDc(wips_uk,alsvkey),wsus_ip=StrDc(wip_us,alsvkey),wsus_domain=StrDc(wips_us,alsvkey),n=-1,wsuk_ip=wsuk_ip.replace("ws://",""),n=wsuk_ip.lastIndexOf("/"),n>0&&(wsuk_ip=wsuk_ip.substring(0,n)),n=wsuk_ip.lastIndexOf(":"),n>0&&(wsuk_ip=wsuk_ip.substring(0,n)),wsus_ip=wsus_ip.replace("ws://",""),n=wsus_ip.lastIndexOf("/"),n>0&&(wsus_ip=wsus_ip.substring(0,n)),n=wsus_ip.lastIndexOf(":"),n>0&&(wsus_ip=wsus_ip.substring(0,n)),wsuk_domain=wsuk_domain.replace("wss://",""),n=wsuk_domain.lastIndexOf("/"),n>0&&(wsuk_domain=wsuk_domain.substring(0,n)),n=wsuk_domain.lastIndexOf(":"),n>0&&(wsuk_domain=wsuk_domain.substring(0,n)),wsus_domain=wsus_domain.replace("wss://",""),n=wsus_domain.lastIndexOf("/"),n>0&&(wsus_domain=wsus_domain.substring(0,n)),(n=wsus_domain.lastIndexOf(":"))>0&&(wsus_domain=wsus_domain.substring(0,n))),t.indexOf("authkey=1552303117")<0&&t.indexOf("authkey=1568108345")<0&&(wsconnect_address.indexOf(wsuk_ip)>=0||wsconnect_address.indexOf(wsuk_domain)>=0?r=1:(wsconnect_address.indexOf(wsus_ip)>=0||wsconnect_address.indexOf(wsus_domain)>=0)&&(r=2),r>0)){var s="";if(n=e.indexOf("mcrfs="),n>0&&(s=e.substring(0,e.indexOf("mcrfs=")+6)),(n=t.indexOf("authkey="))>0){var l=t.substring(0,n),p="";t=t.substring(n),n=t.indexOf("&"),n<0&&(n=t.length),n>0&&(p=t.substring(n)),isNull(p)&&(p="");var c="";c=1===r?"authkey=1568108345":"authkey=1552303117",t=l+c+p,e.indexOf("mcrfs=")>0&&(t=StrEc(t,webphone_api.global.ec_apikey,!0)),e=s+t}}}}}catch(u){PutToDebugLogException(2,"common: HandleApiKey",u)}return e}function HttpAsyncHandler(e){try{if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, HttpAsyncHandler notification is NULL");e=Trim(e),webphone_api.global.currhttpmehodworking=!0;var t="",n="";if(IsMizuServerOrGateway()){var o=e.indexOf("oenc1_");o>0&&(e=e.substring(o+6),e=StrDc(e,webphone_api.global.ec_apikey))}var o=e.indexOf("REQUEST:");if(o>0&&(n=e.substring(o+8,e.length),n=Trim(n)),(o=e.indexOf("RESULT:"))>=0){var i=e.indexOf("REQUEST:");i<1&&(i=e.length),t=e.substring(o+7,i),t=Trim(t),t.lastIndexOf(",")===t.length-1&&(t=Trim(t.substring(0,t.length-1)))}if(isNull(t)||t.length<1)return void PutToDebugLog(2,"WARNING, HttpAsyncHandler response is NULL");if(isNull(n)||n.length<1)return void PutToDebugLog(2,"WARNING, HttpAsyncHandler request is NULL");if(n.indexOf("AUTOPROVISIONING")>=0){if(isNull(t)||!(t.toLowerCase().indexOf("endofautoprovisioning")>0))return void PutToDebugLog(2,"ERROR, HttpAsyncHandler autoprovidioning error: "+t);PutToDebugLog(2,"EVENT, HttpAsyncHandler autoprovidioning succeded: "+t),ParseAutoprovisioning(t),"false"===GetParameter("serverinputisupperserver")&&RestartPhone()}n.toLowerCase().indexOf("balance")>0||n.toLowerCase().indexOf("includecurrency")>0?HttpResponseHandler(t,"creditrequest"):n.toLowerCase().indexOf("rating")>0||n.toLowerCase().indexOf("tariffs")>0?HttpResponseHandler(t,"getrating"):n.toLowerCase().indexOf("=callback")>0?HttpResponseHandler(t,"callback"):n.toLowerCase().indexOf("=wsload")>0?HttpResponseHandler(t,"webrtcload"):n.toLowerCase().indexOf("srvct")>0?HttpResponseHandler(t,"downloadcontacts"):n.toLowerCase().indexOf("lastcalldetails")>0?HttpResponseHandler(t,"lastcalldetails"):n.toLowerCase().indexOf("wrtcload_uk")>0?HttpResponseHandler(t,"wrtcload_uk"):n.toLowerCase().indexOf("wrtcload_us")>0?HttpResponseHandler(t,"wrtcload_us"):n.toLowerCase().indexOf("scurl_displaypeerdetails")>0?HttpResponseHandler(t,"scurl_displaypeerdetails"):n.toLowerCase().indexOf("getconfroom")>0?HttpResponseHandler(t,"getconferenceroom"):n.toLowerCase().indexOf("waitforparameters")>0?HttpResponseHandler(t,"waitforparameters"):n.toLowerCase().indexOf("recharge")>0?HttpResponseHandler(t,"recharge"):n.toLowerCase().indexOf("tel.search.ch")>0?HttpResponseHandler(t,"telsearchname"):n.toLowerCase().indexOf("calldivert")>0?HttpResponseHandler(t,"calldivertapi"):n.toLowerCase().indexOf("presence_set")>0?HttpResponseHandler(t,"presence_set"):(n.toLowerCase().indexOf("get_custom_menu")>0||n.toLowerCase().indexOf("logincheck")>0)&&HttpResponseHandler(t,"get_custom_menu")}catch(a){PutToDebugLogException(2,"common: HttpAsyncHandler",a)}}function HttpResponseHandler(e,t){try{if(webphone_api.global.currhttpmehodworking=!0,!isNull(e)&&e.toString().indexOf("auth failed: wrong key")>=0){var n=e.toString();n=n.substring(0,n.indexOf("wrong key")+9)}if(isNull(e))return void PutToDebugLog(3,"ERROR, common: httpResponse is NULL");var o=e.toString(),i="";i=o.length>600?o.substring(0,600)+" ...":o;var a=o.toLowerCase();if(a.indexOf("wsuser")>=0||"webrtccreateuser"===t){var r=o;if(r.indexOf("DISPLAY")>0)return r=Trim(r.replace("DISPLAY","")),PutToDebugLog(1,r),void ShowToast(r);if(a.indexOf("ok:")>=0){var s=GetParameter("wsusers"),l=GetSipusername();if(webphone_api.iswebrtcengineworking=1,webphone_api.global.last_wsu_tick=GetTickCount(),l.length>0)s.indexOf(l)<0&&(s.length>0&&","!==s.charAt(s.length-1)&&(s+=","),s+=l,SaveParameter("wsusers",s));else{a.indexOf(" ")>0&&(a=Trim(a),l=a.substring(a.lastIndexOf(" ")+1),l=Trim(l),l.length>0&&s.indexOf(l)<0&&(s.length>0&&","!==s.charAt(s.length-1)&&(s+=","),s+=l,SaveParameter("wsusers",s)))}PutToDebugLog(3,"EVENT, common wsuser response: "+i),webphone_api.global.wsuser_succeded=!0}else PutToDebugLog(3,"ERROR, common wsuser failed, response: "+i);return}if(PutToDebugLog(3,"EVENT, common: httpResponse: "+i+"; action: "+t),isNull(t)||Trim(t).length<1)return void PutToDebugLog(2,"ERROR, common: HttpResponseHandler action is NULL");if("creditrequest"===t){var p=o.toLowerCase();if(p.indexOf("error")>=0&&50!==GetConfigInt("brandid",-1)||p.indexOf("postpaid")>=0||p.indexOf("invalid")>=0||p.indexOf("not found")>=0)webphone_api.global.creditRequestIval<3e4?webphone_api.global.creditRequestIval=2*webphone_api.global.creditRequestIval:webphone_api.global.creditRequestIval=webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL;else{if(50===GetConfigInt("brandid",-1)){var c=JSON.parse(o),u=c.data,h=c.error;if(!isNull(h)&&h.length>0)return void PutToDebugLog(2,"ERROR, Favafone creditrequest error: "+h);if(isNull(u))return void PutToDebugLog(3,"ERROR, Favafone creditrequest httpresponsehandler data is NULL");var g=u.balance,m=u.currency_sign;return g.length>0&&(webphone_api.global.credit="Credit: "+m+" "+g),void PutToDebugLog(4,"EVENT, Favafone received credit balance: "+webphone_api.global.credit)}o=o.replace("{",""),o=o.replace("}",""),o=ReplaceAll(o,'"',"");webphone_api.global.credit=""+o,webphone_api.global.credit.indexOf("Your credit is")>=0&&(webphone_api.global.credit=webphone_api.global.credit.replace("Your credit is","Credit:")),webphone_api.global.creditRequestIval=webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL}}else if("getrating"===t){if((o.toLowerCase().indexOf("error")>=0||o.indexOf("postpaid")>=0||o.indexOf("invalid")>=0||o.indexOf("not found")>=0)&&50!==GetConfigInt("brandid",-1))return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: Call, error: "+o);var d=o;if(50===GetConfigInt("brandid",-1)){var c=JSON.parse(o),b=c.data,h=c.error;if(!isNull(h)&&h.length>0)return void PutToDebugLog(2,"ERROR, Favafone getrating error: "+h);if(isNull(b)||isNull(b[0]))return void PutToDebugLog(3,"ERROR, Favafone getrating httpresponsehandler data is NULL");var _=b[0].voice_rate,f=b[0].description,m=b.currency_sign;if(_.length<1||"null"===_.toLowerCase())return void PutToDebugLog(2,"ERROR, Favafone getrating, rating request respose2: "+o);d=m+" "+_+" / min ("+f+")"}50!==GetConfigInt("brandid",-1)&&(d+=webphone_api.stringres.get("rating_minute")),ShowRatingWhyleType(d),webphone_api.global.rating=" ("+d+webphone_api.stringres.get("rating_minute")+")"}else if("get_custom_menu"===t)ProcessCustomMenu(o);else if("waitforparameters"===t)webphone_api.plhandler.ParseReceivedParameters(o);else if("presence_set"===t)HandleOfflineMessages(o);else if("webrtcload"===t){if(o.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: webrtcload, error: "+o);var w=o.toLowerCase(),v=w.indexOf("ws load:");if(v>=0){if(w.indexOf("type:")>0){var P=w.substring(w.indexOf("type:")+5);P=Trim(P),!isNull(P)&&IsNumber(P)&&(webphone_api.global.wsload_type=StrToInt(P))}w=w.substring(v+8),w=Trim(w);var E=-1;webphone_api.iswebrtcengineworking=1;try{E=parseInt(w,10)}catch(A){PutToDebugLogException(2,"common: HttpResponseHandler parse webrtc load",A)}var T=GetEngine("webrtc");if(T.serversupport_cache=E,SetEngine("webrtc",T),webphone_api.global.recwsload!=E&&E>=0&&E<=7&&(webphone_api.global.recwsload=E,SaveParameter("lastrecwsload",E)),E>2)if(E>3){if(!1===webphone_api.global.usestorage&&!1===Strl(60)&&getuseengine()===webphone_api.global.ENGINE_WEBRTC&&!0===CanIUseService()){SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var N=GetEngine("ns");N.clicked=2,SetEngine("ns",N),EngineSelect(1,6),PutToDebugLog(2,"WARNING, common wsload: offer ns engine because webrtc load is too high: "+E.toString()),EngineForcedInstall("ns",webphone_api.stringres.get("serviceengine_msg"),function(){webphone_api.startInner()})}}else webphone_api.global.presenceinterval=244e4,getuseengine()===webphone_api.global.ENGINE_WEBRTC?(SaveParameter("enablepresence","0"),PutToDebugLog(2,"EVENT, disable presence because wsload is high: "+E.toString())):setTimeout(function(){getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(SaveParameter("enablepresence","0"),PutToDebugLog(2,"EVENT, disable presence because wsload is high: "+E.toString()))},5e3);else 2===E?webphone_api.global.presenceinterval=144e4:0===E&&(webphone_api.global.presenceinterval=36e4)}}else if("wrtcload_uk"===t||"wrtcload_us"===t){if(o.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: webrtcload, error: "+o);var w=o.toLowerCase(),v=w.indexOf("ws load:");if(v>=0){var S=0;if(w.indexOf("pmsec:")>0){var I=w.substring(w.indexOf("pmsec:")+6);I=Trim(I),!isNull(I)&&IsNumber(I)&&(S=StrToInt(I))}w=w.substring(v+8),w=Trim(w);var E=-1;try{E=parseInt(w,10)}catch(A){PutToDebugLogException(2,"common: HttpResponseHandler parse webrtc load",A)}var C=GetParameter("last_good_webrtc_gw");"wrtcload_uk"===t?(wsl_uk=E,wsl_uk_time=GetTickCount()-S,isNull(C)||"uk"!==C||(wsl_uk_time-=15),webphone_api.global.wsl_uk_rec=!0,wsloadanswersreceived=1==wsloadanswersreceived?3:2):(wsl_us=E,wsl_us_time=GetTickCount()-S,isNull(C)||"us"!==C||(wsl_us_time-=15),webphone_api.global.wsl_us_rec=!0,wsloadanswersreceived=2==wsloadanswersreceived?3:1),DecideUsUk()}}else if("recharge"===t)o.toLowerCase().indexOf("error")>=0&&PutToDebugLog(2,"ERROR, HttpResponseHandler action: recharge, error: "+o),ShowToast(o);else if("newuserreg"===t)webphone_api._newuser.HttpResponseHandler(o,t);else if("get_new_user_form_fields"===t||"newuser_dynamic"===t||"get_new_user_countrylist"===t)webphone_api._newuser.HttpResponseHandler(o,t);else if("verifysmscode"===t)webphone_api._smscodeverify.HttpResponseHandler(o,t);else if("phone2phone"===t)o.toLowerCase().indexOf("error")>=0&&PutToDebugLog(2,"ERROR, HttpResponseHandler action: phone2phone, error: "+o),ShowToast(o);else if("callback"===t){if(o.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: callback, error: "+o);isNull(o)&&(o=""),o=Trim(o),ShowToast(o)}else if("presence_verify"===t||"presence_get"===t)PresenceProcessUserlist2(Trim(o),t);else if("downloadcontacts"===t){if(o.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+o);ParseContactsFromServer(o,!1,function(e){e?(PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("sync_succeded")),PutToDebugLog(1,"EVENT, POPUP, "+webphone_api.stringres.get("sync_succeded")),webphone_api.global.reloadcontactsaftersync=!0):(PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("sync_failed")),PutToDebugLog(1,"EVENT, POPUP, "+webphone_api.stringres.get("sync_failed")))})}else if("lastcalldetails"===t)webphone_api.global.lastcalldetails=o;else if("additional_info"===t){if(o.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+o);var R=o;R=ReplaceAll(R,"\r\n","<br>"),R=ReplaceAll(R,"\n","<br>"),isNull(document.getElementById("page_call_additional_info"))||(PutToDebugLog(4,"EVENT, HttpResponseHandler Display additional call info: "+R),document.getElementById("page_call_additional_info").innerHTML=R)}else if("scurl_displaypeerdetails"===t){if(o.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+o);DisplayPeerDetails(o)}else if("getconferenceroom"===t)ConferenceRoomReceived(o);else if("webcontactsearch"===t)WebContactReceived(o);else if("telsearchname"===t)TelSearchNameReceived(o);else if("calldivertapi"===t){var G=o.toLowerCase();if(G.indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+o);if(G.indexOf("ok")>=0){SaveParameter("calldivertsuccess","1");var y=GetParameter2("callforwardonbusy"),L=GetParameter2("callforwardonnoanswer"),O=GetParameter2("callforwardalways"),D=GetParameter2("callforwardonnoanswertimeout"),x=Md5Hash(y+L+O+D);SaveParameter("calldivertchecksum",x)}}else if("get_custom_menu"===t){var G=o.toLowerCase();if(G.indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+o);ProcessCustomMenu(o)}}catch(k){PutToDebugLogException(2,"common: HttpResponseHandler",k)}}function WinAPI(e,t,n,o,i,a,r,s,l,p,c){var u="BOFLINE",h="EOFLINE";try{if(t&&"function"==typeof t||(t=function(e){isNull(e)||(e=e.toString(),e.indexOf("OK:")>=0&&e.indexOf("wphone")>0&&e.indexOf("started")>0&&setTimeout(function(){webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2)},2e3)),PutToDebugLog(2,"EVENT, common: WinAPI NO callback specified; result: "+e)}),isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: WinAPI: apiname is NULL"),t(!1),!1;var g="BOFCOMMAND";g=g+u+"function="+e+h,!isNull(n)&&n.toString().length>0&&(n=Trim(n),g=g+u+"param1="+n+h),!isNull(o)&&o.toString().length>0&&(o=Trim(o),g=g+u+"param2="+o+h),!isNull(i)&&i.toString().length>0&&(i=Trim(i),g=g+u+"param3="+i+h),!isNull(a)&&a.toString().length>0&&(a=Trim(a),g=g+u+"param4="+a+h),!isNull(r)&&r.toString().length>0&&(r=Trim(r),g=g+u+"param5="+r+h),!isNull(s)&&s.toString().length>0&&(s=Trim(s),g=g+u+"param6="+s+h),!isNull(l)&&l.toString().length>0&&(l=Trim(l),g=g+u+"param7="+l+h),!isNull(p)&&p.toString().length>0&&(p=Trim(p),g=g+u+"param8="+p+h),!isNull(c)&&c.toString().length>0&&(c=Trim(c),g=g+u+"param9="+c+h),g=g+u+"requestid="+GetRequestId()+h,g+="EOFCOMMAND";var m="";webphone_api.global.httpkatimer=GetTickCount(),IsWindowsSoftphone()?(m=AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+m,CanLog(7)&&PutToDebugLog(7,"EVENT, WinAPI windows url: "+m),WinSoftphoneHttpReq(m,"POST","data="+g,e,function(e){return t(e),e})):getuseengine()===webphone_api.global.ENGINE_SERVICE||!0===webphone_api.global.onunload_flag?WSAPIRequest("POST","data="+g,e,function(e){return t(e),e}):CanLog(5)&&(e.indexOf("API_Unregister")>=0||e.indexOf("API_Stop")>=0||e.indexOf("API_Exit")>=0?PutToDebugLog(3,"EVENT, (warn) common: winapi invalid engine/device: "+getuseengine()+"; apiname: "+e+"; data="+g):PutToDebugLog(2,"ERROR, common: winapi invalid engine/device: "+getuseengine()+"; apiname: "+e+"; data="+g))}catch(d){PutToDebugLogException(2,"common: WinAPI",d)}return!1}function WinSoftphoneHttpReq(e,t,n,o,i){var a=0;try{var r="";if(isNull(n)||(r=n.length>300?n.substring(0,300)+"....":n),CanLog(5)&&PutToDebugLog(5,"EVENT, WinSoftphoneHttpReq called "+t+" url: "+e+"; data: "+r),(isNull(t)||t.length<1)&&(a=1,PutToDebugLog(2,"WARNING, common: WinSoftphoneHttpReq: method not specified; fallback to GET"),t="GET"),a=2,isNull(n))return a=3,PutToDebugLog(2,"ERROR, common: WinSoftphoneHttpReq: data is NULL "),cbexecuted=!0,i(null),"";a=4,n.indexOf("API_CallEOFLINE"),a=5,setTimeout(function(){if(a=6,!isNull(i)&&i&&"function"==typeof i)return a=7,PutToDebugLog(3,"EVENT, common: WinSoftphoneHttpReq: manual Timeout"),i(null),i=null,""},reqtimeout+1e3);var s=!1;if(!isNull(o)&&o.length>0&&!isNull(i)&&"function"==typeof i&&(o=Trim(o),0===o.indexOf("API_")&&"API_Poll"!==o&&"API_Stop"!==o&&o.indexOf("extcmd_")<0)){srv_cb.push(i),srv_apiname.push(o.toLowerCase()),s=!0;var l="";if(!isNull(n)&&n.indexOf("param1=")>0){var p=ReplaceAll(n,"BOFLINE","");p=ReplaceAll(p,"EOFLINE","");var c=p.substring(p.indexOf("param1=")+7),u="";c.indexOf("param2=")>=0?(u=c.substring(c.indexOf("param2=")+7),u=u.indexOf("param3=")>=0?u.substring(0,u.indexOf("param3=")):u.substring(0,u.indexOf("EOFCOMMAND")),u=Trim(u),c=c.substring(0,c.indexOf("param2=")),c=Trim(c)):(c=c.substring(0,c.indexOf("EOFCOMMAND")),c=Trim(c)),l=c+u}var h=l;h.indexOf("requestid=")>=0&&(h=h.replace("requestid=","")),srv_params.push(h)}var g;window.XMLHttpRequest?(a=8,g=new XMLHttpRequest):(a=9,g=new ActiveXObject("Microsoft.XMLHTTP")),"get"===t.toLowerCase()?(a=10,g.open("GET",e+n,!0)):(g.open("POST",e,!0),a=11),g.onreadystatechange=function(){try{if(CanLog(7)&&PutToDebugLog(7,"EVENT, WinSoftphoneHttpReq: xmlhttp.readyState: "+g.readyState+";  xmlhttp.status: "+g.status),a=19,4==g.readyState&&200==g.status){if(!1===webphone_api.global.httpheaderslogged&&g.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;var e=g.getAllResponseHeaders();CanLog(5)&&PutToDebugLog(5,"EVENT, HTTP request answer headers 2: "+e)}var t=g.responseText;if(CanLog(5)){a=20;var n="";n=!isNull(t)&&t.length>250?t.substring(0,250)+"....":t,isNull(n)&&(n="NULL"),n.indexOf("ERROR: header not found")>0&&(n=n.replace("ERROR: header not found","ERR: header not found")),PutToDebugLog(5,"EVENT, WinSoftphoneHttpReq response ("+t.length.toString()+"): "+n)}cbexecuted=!0;var o="";if(a=21,isNull(t)||t.length<1)return a=23,isNull(i)?PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__1"):i(null),i=null,"";if(s&&0==t.indexOf("OK: pending"));else{if(!(t.indexOf("APIREQUEST:")>=0))return a=42,isNull(i)?PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__3"):i(o),i=null,o;a=24;var r="",l="";if(t.indexOf("APIRESULT:")>0&&(a=25,t.indexOf("RPARAM1")>0?(r=t.substring(t.indexOf("APIREQUEST:")+11,t.indexOf("RPARAM1:")),t.indexOf("RPARAM2")>0?(l=t.substring(t.indexOf("RPARAM1:")+8,t.indexOf("RPARAM2")),t.substring(t.indexOf("RPARAM2:")+8,t.indexOf("APIRESULT:"))):l=t.substring(t.indexOf("RPARAM1:")+8,t.indexOf("APIRESULT:")),o=t.substring(t.indexOf("APIRESULT:")+10,t.length)):(r=t.substring(t.indexOf("APIREQUEST:")+11,t.indexOf("APIRESULT:")),o=t.substring(t.indexOf("APIRESULT:")+10,t.length))),a=28,isNull(r)?r="":(r=Trim(r),r=r.toLowerCase()),
o=isNull(o)?"":Trim(o),a=29,50===GetConfigInt("brandid",-1)&&(isNull(l)&&(l=""),l=l.toLowerCase(),l.indexOf("ww.favafone")>0))return l.indexOf("countries-list")>0?HttpResponseHandler(o,"get_new_user_countrylist"):l.indexOf("registration-form")>0?HttpResponseHandler(o,"get_new_user_form_fields"):l.indexOf("create-account")>0&&HttpResponseHandler(o,"newuser_dynamic"),o;if(isNull(i)&&PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__2"),a=30,"api_poll"!==r){if(o.indexOf("ERROR")>=0){if(a=33,o.indexOf("ERROR: header not found")>=0)PutToDebugLog(5,"EVENT, whresponse: header not found");else if("api_call"===r){var p=o.replace("ERROR","");p=p.replace(":",""),PutToDebugLog(1,"ERROR, whresponse: "+p)}else PutToDebugLog(2,"ERROR, whresponse: "+o);return a=34,isNull(i)||i(null),i=null,""}return"true"===o.toLowerCase()?(isNull(i)||i(!0),i=null,!0):"false"===o.toLowerCase()?(isNull(i)||i(!1),i=null,!1):IsNumber(o)?(isNull(i)||i(StrToInt(o)),i=null,StrToInt(o)):o.indexOf("OK")>=0&&o.length<12?(a=37,isNull(i)||i(!0),i=null,!0):(a=3888,isNull(i)||i(o),i=null,o)}a=31,webphonetojs(o),a=32,a=40}a=48}}catch(c){PutToDebugLogException(2,"common: WinSoftphoneHttpReq inner_1 ("+a+")",c)}},g.timeout=reqtimeout,g.ontimeout=function(e){if(!isNull(i)&&i&&"function"==typeof i)return a=49,PutToDebugLog(2,"ERROR, common: WinSoftphoneHttpReq: Timeout"),cbexecuted=!0,i(null),i=null,""},"get"===t.toLowerCase()?(n.length>0&&(n="?"+n),a=50,g.send()):(a=51,50===GetConfigInt("brandid",-1)&&PutToDebugLog(2,"EVENT, WinSoftphoneHttpReq SEND post request with data: "+n),g.send(n))}catch(m){PutToDebugLogException(2,"common: WinSoftphoneHttpReq ("+a+")",m)}}function GetNotifications2(){try{if(!0===nread)return;nread=!0;var e=GetParameter("notifications2");if(webphone_api.global.notifs=[],isNull(e)||e.length<10)return;var t=e.split(not_linesep);if(isNull(t)||t.length<1)return;for(var n=0;n<t.length;n++)if(!(isNull(t[n])||t[n].length<1||t[n].indexOf(",")<0)){var o=t[n].split(not_sep);isNull(o)||o.length<4||webphone_api.global.notifs.push(o)}}catch(i){PutToDebugLogException(2,"common: GetNotifications2",i)}}function SaveNotifications2(){var e="";try{if(!isNull(webphone_api.global.notifs)&&webphone_api.global.notifs.length>0)for(var t=0;t<webphone_api.global.notifs.length;t++)if(!(isNull(webphone_api.global.notifs[t])||webphone_api.global.notifs[t].length<1)){var n=webphone_api.global.notifs[t];isNull(n)||n.length<4||(e.length>0&&(e+=not_linesep),e=e+n[0]+not_sep+n[1]+not_sep+n[2]+not_sep+n[3])}SaveParameter("notifications2",e)}catch(o){PutToDebugLogException(2,"common: SaveNotifications2",o)}}function PutNotifications2(e,t,n,o){try{if(GetParameterInt("displaynotification",0)<1)return;if(isNull(e)||!IsNumber(e))return void PutToDebugLog(4,"ERROR, common: PutNotifications2 invalid type");GetNotifications2(),isNull(t)&&(t=""),isNull(n)&&(n=""),(isNull(o)||!IsNumber(o)||o<1e3)&&(o=GetTickCount());var i=[];i[0]=e,i[1]=t,i[2]=n,i[3]=o.toString(),webphone_api.global.notifs.unshift(i),SaveNotifications2(),ShowNotifications2();var a=GetParameterInt("notification_count2",0);a<0&&(a=0),a++,SaveParameter("notification_count2",a)}catch(r){PutToDebugLogException(2,"common: PutNotifications2",r)}}function GetDateForNotifications(e){try{if(isNull(e)||!IsNumber(e)||e<1)return"";var t=new Date(e),n=t.getMinutes();n<10&&(n="0"+n);var o=t.getDate();o<10&&(o="0"+o);return month[t.getMonth()]+", "+o+" "+t.getHours()+":"+n}catch(i){PutToDebugLogException(2,"common: GetDateForNotifications",i)}return""}function ShowNotifications2(){try{if(GetNotifications2(),isNull(webphone_api.global.notifs)||webphone_api.global.notifs.length<1)return void HideNotificationsElements();for(var e="",t="",n="",o="",i='<li class="mlistitem"><a id="[PAGE]_notitem_[NOTID]" class="nt_anchor"><div class="nt_title">[TITLE]</div><div class="nt_desc">[DESC]</div><div class="nt_date">[DATE]</div></a><a id="[PAGE]_notmenu_[NOTID]" class="ui-btn ui-btn-inline ui-icon-delete nt_menu">'+webphone_api.stringres.get("hint_notif_clear")+"</a></li>",a=0;a<webphone_api.global.notifs.length;a++)if(!(isNull(webphone_api.global.notifs[a])||webphone_api.global.notifs[a].length<1)){var r=webphone_api.global.notifs[a],s=i;"0"===r[0]?(s=s.replace("[TITLE]",webphone_api.stringres.get("not_missed_call")+":"),s=s.replace("[DESC]",r[2])):"1"===r[0]&&(s=s.replace("[TITLE]",webphone_api.stringres.get("not_missed_chat")+":"),s=s.replace("[DESC]",r[2]));var l=StrToInt(r[3]);isNull(l)&&(l=0);var p=GetDateForNotifications(l);s=s.replace("[DATE]",p),s=ReplaceAll(s,"[NOTID]",a.toString()),e+=ReplaceAll(s,"[PAGE]","dialpad"),t+=ReplaceAll(s,"[PAGE]","contactslist"),n+=ReplaceAll(s,"[PAGE]","callhistorylist"),o+=ReplaceAll(s,"[PAGE]","message")}var c=GetParameterInt("notification_count2",0);e.length>0?(webphone_api.$(".not_panel_title").html(webphone_api.stringres.get("not_panel_title")),webphone_api.$(".not_close_btn").html(webphone_api.stringres.get("btn_close")),webphone_api.$("#dialpad_notification_list").html(""),webphone_api.$("#dialpad_notification_list").hasClass("ui-listview")&&webphone_api.$("#dialpad_notification_list").append(e).listview("refresh"),c>0?(webphone_api.$("#dialpad_not_counter").html(c),webphone_api.$("#dialpad_not_counter").show()):(webphone_api.$("#dialpad_not_counter").html(""),webphone_api.$("#dialpad_not_counter").hide()),webphone_api.$("#dialpad_not_btn").show(),webphone_api.$("#contactslist_notification_list").html(""),webphone_api.$("#contactslist_notification_list").hasClass("ui-listview")&&webphone_api.$("#contactslist_notification_list").append(t).listview("refresh"),c>0?(webphone_api.$("#contactslist_not_counter").html(c),webphone_api.$("#contactslist_not_counter").show()):(webphone_api.$("#contactslist_not_counter").html(""),webphone_api.$("#contactslist_not_counter").hide()),webphone_api.$("#contactslist_not_btn").show(),webphone_api.$("#callhistorylist_notification_list").html(""),webphone_api.$("#callhistorylist_notification_list").hasClass("ui-listview")&&webphone_api.$("#callhistorylist_notification_list").append(n).listview("refresh"),c>0?(webphone_api.$("#callhistorylist_not_counter").html(c),webphone_api.$("#callhistorylist_not_counter").show()):(webphone_api.$("#callhistorylist_not_counter").html(""),webphone_api.$("#callhistorylist_not_counter").hide()),webphone_api.$("#callhistorylist_not_btn").show(),webphone_api.$("#messagelist_notification_list").html(""),webphone_api.$("#messagelist_notification_list").hasClass("ui-listview")&&webphone_api.$("#messagelist_notification_list").append(o).listview("refresh"),c>0?(webphone_api.$("#messagelist_not_counter").html(c),webphone_api.$("#messagelist_not_counter").show()):(webphone_api.$("#messagelist_not_counter").html(""),webphone_api.$("#messagelist_not_counter").hide()),webphone_api.$("#messagelist_not_btn").show()):HideNotificationsElements()}catch(u){PutToDebugLogException(2,"common: ShowNotifications2",u)}}function HideNotificationsElements(){webphone_api.$("#dialpad_notification_list").html(""),webphone_api.$("#dialpad_not_counter").html(""),webphone_api.$("#dialpad_not_counter").hide(),webphone_api.$("#dialpad_not_btn").hide(),webphone_api.$("#contactslist_notification_list").html(""),webphone_api.$("#contactslist_not_counter").html(""),webphone_api.$("#contactslist_not_counter").hide(),webphone_api.$("#contactslist_not_btn").hide(),webphone_api.$("#callhistorylist_notification_list").html(""),webphone_api.$("#callhistorylist_not_counter").html(""),webphone_api.$("#callhistorylist_not_counter").hide(),webphone_api.$("#callhistorylist_not_btn").hide(),webphone_api.$("#messagelist_notification_list").html(""),webphone_api.$("#messagelist_not_counter").html(""),webphone_api.$("#messagelist_not_counter").hide(),webphone_api.$("#messagelist_not_btn").hide()}function HideCallNotifications2(){try{if(!isNull(webphone_api.global.notifs)||webphone_api.global.notifs.length>0){for(var e=0;e<webphone_api.global.notifs.length&&webphone_api.global.notifs.length>0;){var t=webphone_api.global.notifs[e];!isNull(t)&&t.length>0&&"0"===t[0]?webphone_api.global.notifs.splice(e,1):e++}SaveNotifications2()}ShowNotifications2()}catch(n){PutToDebugLogException(2,"common: HideCallNotifications2",n)}}function HideMessageNotifications2(){try{if(!isNull(webphone_api.global.notifs)||webphone_api.global.notifs.length>0){for(var e=0;e<webphone_api.global.notifs.length&&webphone_api.global.notifs.length>0;){var t=webphone_api.global.notifs[e];!isNull(t)&&t.length>0&&"1"===t[0]?webphone_api.global.notifs.splice(e,1):e++}SaveNotifications2()}ShowNotifications2()}catch(n){PutToDebugLogException(2,"common: HideMessageNotifications2",n)}}function NotificationOnClick2(e,t){try{if(isNull(e)||e.indexOf("notitem_")<0&&e.indexOf("notmenu_")<0)return void PutToDebugLog(4,"ERROR, common: NotificationOnClick2 invalid id: "+e);if(t){if(e=e.substring(e.indexOf("notmenu_")+8),isNull(e)||!IsNumber(e))return;var n=StrToInt(e);if(n>=0&&n<webphone_api.global.notifs.length)return webphone_api.global.notifs.splice(n,1),void ShowNotifications2()}else{if(e=e.substring(e.indexOf("notitem_")+8),isNull(e)||!IsNumber(e))return;var n=StrToInt(e);if(n>=0&&n<webphone_api.global.notifs.length){var o=webphone_api.global.notifs[n],i=o[0];"0"===i?webphone_api.$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"}):"1"===i&&webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})}}}catch(a){PutToDebugLogException(2,"common: NotificationOnClick2",a)}}function PutNotifications(e,t,n){try{if(GetParameterInt("displaynotification",0)<1)return;if(isNull(n)&&(n=!0),isNull(t))return void PutToDebugLog(2,"ERROR, common: PutNotifications number is NULL");var o=GetParameter("call_notifications"),i=GetParameter("message_notifications");if(o=isNull(o)?"":Trim(o),i=isNull(i)?"":Trim(i),n)if(o.length>2)if(IsNumber(o.charAt(0))){var a=StrToInt(o.charAt(0));o=o.replace(a.toString(),(a+1).toString())}else o="2 "+webphone_api.stringres.get("calls");else o=webphone_api.stringres.get("call_from")+": "+e+", "+t;else if(i.length>2)if(IsNumber(i.charAt(0))){var a=StrToInt(i.charAt(0));i=i.replace(a.toString(),(a+1).toString())}else i="2 "+webphone_api.stringres.get("messages");else i=webphone_api.stringres.get("message_from")+": "+e+", "+t;SaveParameter("call_notifications",o),SaveParameter("message_notifications",i),ShowNotifications()}catch(r){PutToDebugLogException(2,"common: PutNotifications",r)}}function ShowNotifications(){try{var e=GetParameter("call_notifications"),t=GetParameter("message_notifications"),n="";!isNull(e)&&e.length>2&&(n=e+"<br>"),n+=t,PutToDebugLog(2,"EVENT, ShowNotifications: "+n),webphone_api.$("#dialpad_notification").html(n),webphone_api.$("#contactslist_notification").html(n),webphone_api.$("#callhistorylist_notification").html(n),webphone_api.$("#messagelist_notification").html(n),!isNull(n)&&n.length>2?(webphone_api.$("#msglist_title").hide(),webphone_api.$("#messagelist_notification").show(),webphone_api.$("#ctlist_title").hide(),webphone_api.$("#contactslist_notification").show(),webphone_api.$("#chlist_title").hide(),webphone_api.$("#callhistorylist_notification").show(),webphone_api.$("#dialpad_title").hide(),webphone_api.$("#dialpad_notification").show()):(webphone_api.$("#msglist_title").show(),webphone_api.$("#messagelist_notification").hide(),webphone_api.$("#ctlist_title").show(),webphone_api.$("#contactslist_notification").hide(),webphone_api.$("#chlist_title").show(),webphone_api.$("#callhistorylist_notification").hide(),webphone_api.$("#dialpad_title").show(),webphone_api.$("#dialpad_notification").hide())}catch(o){PutToDebugLogException(2,"common: ShowNotifications",o)}}function HideCallNotifications(){try{SaveParameter("call_notifications","");var e=GetParameter("message_notifications");webphone_api.$("#dialpad_notification").html(e),webphone_api.$("#contactslist_notification").html(e),webphone_api.$("#callhistorylist_notification").html(e),webphone_api.$("#messagelist_notification").html(e),!isNull(e)&&e.length>2?(webphone_api.$("#msglist_title").hide(),webphone_api.$("#messagelist_notification").show(),webphone_api.$("#ctlist_title").hide(),webphone_api.$("#contactslist_notification").show(),webphone_api.$("#chlist_title").hide(),webphone_api.$("#callhistorylist_notification").show(),webphone_api.$("#dialpad_title").hide(),webphone_api.$("#dialpad_notification").show()):(webphone_api.$("#msglist_title").show(),webphone_api.$("#messagelist_notification").hide(),webphone_api.$("#ctlist_title").show(),webphone_api.$("#contactslist_notification").hide(),webphone_api.$("#chlist_title").show(),webphone_api.$("#callhistorylist_notification").hide(),webphone_api.$("#dialpad_title").show(),webphone_api.$("#dialpad_notification").hide())}catch(t){PutToDebugLogException(2,"common: HideCallNotifications",t)}}function HideMessageNotifications(){try{SaveParameter("message_notifications","");var e=GetParameter("call_notifications");webphone_api.$("#dialpad_notification").html(e),webphone_api.$("#contactslist_notification").html(e),webphone_api.$("#callhistorylist_notification").html(e),webphone_api.$("#messagelist_notification").html(e),!isNull(e)&&e.length>2?(webphone_api.$("#msglist_title").hide(),webphone_api.$("#messagelist_notification").show(),webphone_api.$("#ctlist_title").hide(),webphone_api.$("#contactslist_notification").show(),webphone_api.$("#chlist_title").hide(),webphone_api.$("#callhistorylist_notification").show(),webphone_api.$("#dialpad_title").hide(),webphone_api.$("#dialpad_notification").show()):(webphone_api.$("#msglist_title").show(),webphone_api.$("#messagelist_notification").hide(),webphone_api.$("#ctlist_title").show(),webphone_api.$("#contactslist_notification").hide(),webphone_api.$("#chlist_title").show(),webphone_api.$("#callhistorylist_notification").hide(),webphone_api.$("#dialpad_title").show(),webphone_api.$("#dialpad_notification").hide())}catch(t){PutToDebugLogException(2,"common: HideMessageNotifications",t)}}function HideAllNotifications(){try{SaveParameter("call_notifications",""),SaveParameter("message_notifications",""),webphone_api.$("#dialpad_notification").html(""),webphone_api.$("#contactslist_notification").html(""),webphone_api.$("#callhistorylist_notification").html(""),webphone_api.$("#messagelist_notification").html(""),webphone_api.$("#msglist_title").show(),webphone_api.$("#messagelist_notification").hide(),webphone_api.$("#ctlist_title").show(),webphone_api.$("#contactslist_notification").hide(),webphone_api.$("#chlist_title").show(),webphone_api.$("#callhistorylist_notification").hide(),webphone_api.$("#dialpad_title").show(),webphone_api.$("#dialpad_notification").hide()}catch(e){PutToDebugLogException(2,"common: HideAllNotifications",e)}}function NotificationOnClick(e){try{var t=GetParameter("call_notifications"),n=GetParameter("message_notifications");if(isNull(t)&&(t=""),isNull(n)&&(n=""),t.length<2&&n.length<2)return;if(t.length>2&&n.length<2)webphone_api.$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"});else if(t.length<2&&n.length>2)webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"});else{var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120);var i="",a='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',r="";r=a.replace("[ITEMID]","#item_call_history"),r=r.replace("[ITEMTITLE]",webphone_api.stringres.get("callhistory")),i+=r,r="",r=a.replace("[ITEMID]","#item_message_history"),r=r.replace("[ITEMTITLE]",webphone_api.stringres.get("messagehistory")),i+=r,r="";var s='<div id="notification_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; min-width: "+Math.floor(.6*o)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("goto")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="notifications_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+i+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";e=e||function(){},webphone_api.$.mobile.activePage.append(s).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#notifications_ul").off("click","li"),e()}}),webphone_api.$("#notifications_ul").on("click","li",function(e){var t=webphone_api.$(this).attr("id");webphone_api.$("#notification_popup").on("popupafterclose",function(e){webphone_api.$("#notification_popup").off("popupafterclose"),"#item_call_history"===t?webphone_api.$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"}):"#item_message_history"===t&&webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})})})}}catch(l){PutToDebugLogException(2,"common: NotificationOnClick",l)}}function RestartPhone(){try{OpenSettings(!0,2),webphone_api.global.flagWaitforautoprov=!1,!1===IsSDK()&&webphone_api.$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"}),webphone_api.startInner()}catch(e){PutToDebugLogException(2,"common: RestartPhone",e)}}function ApiWinSaveFile(e,t,n){try{if(!n||"function"!=typeof n)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile callback not defined"),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile: filename is NULL"),n(!1),!1;if(isNull(t))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile: content is NULL"),n(!1),!1;t="BOFFILE"+t+"EOFFILE",e=Trim(e);WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_savedata="+e,"POST","data="+t,"",function(e){return n(e),e})}catch(o){PutToDebugLogException(2,"common: ApiWinSaveFile",o)}}function ApiWinLoadFile(e,t){try{if(!t||"function"!=typeof t)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFile callback not defined"),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFile: filename is NULL"),t(null),!1;e=Trim(e);WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_loaddata="+e,"GET","","",function(e){return isNull(e)||(e=StrDc(e,webphone_api.global.ec_apikey)),t(e),e})}catch(n){PutToDebugLogException(2,"common: ApiWinLoadFile",n)}}function ApiWinSaveFileNew(e,t,n,o){try{if(!n||"function"!=typeof n)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew callback not defined"),!1;var i=document.getElementById("EXTERNREQUESTELEM");if(isNull(i))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: html element: EXTERNREQUESTELEM is NULL"),n(!1),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: filename is NULL"),n(!1),!1;if(isNull(t))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: content is NULL"),n(!1),!1;t="BOFFILE"+t+"EOFFILEEOFCOMMAND",e=Trim(e);var a="";a=!isNull(o)&&o.length>0?o:"extcmd_savedata="+e,webphone_api.global.bwanswerINCNUMBER++,a=a+"&now="+webphone_api.global.bwanswerINCNUMBER.toString()+"\r\n",PutToDebugLog(2,"EVENT, common: ApiWinSaveFileNew cmd: "+a);var r=a+encodeURIComponent(t);return PutToDebugLog(2,"EVENT, common: ApiWinSaveFileNew encoded: "+r),i.innerHTML=r,n(!0),!0}catch(s){PutToDebugLogException(2,"common: ApiWinSaveFileNew",s)}}function bwanswer(e){try{if(PutToDebugLog(2,"ERROR, bwanswer called; answer: "+e),webphone_api.global.bwanswercallback&&"function"==typeof webphone_api.global.bwanswercallback)if(isNull(e)||e.length<1||e.indexOf("ERROR")>=0)webphone_api.global.bwanswercallback(null),webphone_api.global.bwanswercallback=null;else if(e.length>100||tempfile.length>10){if(tempfile=tempfile=e,tempfile.indexOf("EOFFILE")){var t=decodeURIComponent(tempfile);webphone_api.global.bwanswercallback(t),webphone_api.global.bwanswercallback=null}}else{var t=decodeURIComponent(e);webphone_api.global.bwanswercallback(t),webphone_api.global.bwanswercallback=null}else PutToDebugLog(2,"ERROR, bwanswer: bwanswercallback is NULL")}catch(n){PutToDebugLogException(2,"common: bwanswer",n)}}function ApiWinLoadFileNew(e,t){try{if(!t||"function"!=typeof t)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew callback not defined"),!1;var n=document.getElementById("EXTERNREQUESTELEM");if(isNull(n))return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew: html element: EXTERNREQUESTELEM is NULL"),t(!1),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew: filename is NULL"),t(null),!1;e=Trim(e),webphone_api.global.bwanswerINCNUMBER++;var o="extcmd_loaddata="+e+"&now="+webphone_api.global.bwanswerINCNUMBER.toString()+"\r\n";PutToDebugLog(2,"EVENT, common: ApiWinLoadFileNew cmd: "+o+"EOFCOMMAND"),webphone_api.global.bwanswercallback=t,n.innerHTML=o+"EOFCOMMAND",PutToDebugLog(2,"EVENT, common: ApiWinLoadFileNew  element.innerHTML: "+n.innerHTML)}catch(i){PutToDebugLogException(2,"common: ApiWinLoadFileNew",i)}}function Exit(){WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_exit=true","GET","","",function(e){PutToDebugLog(2,"EVENT, common: Exit response: "+e)})}function CallNumberProtocolHandler(e,t){try{if(isNull(e)||e.length<2||e.length>10)return void PutToDebugLog(2,"ERROR, CallNumberProtocolHandler invalid protocol: "+e);if(isNull(t)||t.length<1)return void PutToDebugLog(2,"ERROR, CallNumberProtocolHandler invalid number: "+t);var n=e+"://"+encodeURIComponent(t),o='<a href="'+n+'" id="make_native_call" style="display: none;">call</a>';webphone_api.$("body").append(o),webphone_api.$("#make_native_call").on("click",function(){var e=webphone_api.$("#make_native_call").attr("href");webphone_api.$("#make_native_call").remove(),window.location=e}),webphone_api.$("#make_native_call").click(),ShowToast(webphone_api.stringres.get("native_call"))}catch(i){PutToDebugLogException(2,"common: CallNumberProtocolHandler",i)}}function EnterKeyPress(){try{return"page_dialpad"===webphone_api.$.mobile.activePage.attr("id")?webphone_api.$("#btn_call").click():"page_settings"===webphone_api.$.mobile.activePage.attr("id")&&webphone_api.$("#adialog_positive").click(),!0}catch(e){PutToDebugLogException(2,"common: EnterKeyPress",e)}return!1}function GetNrOfAcc(){try{if(!isNull(webphone_api.global.sipaccounts))return webphone_api.global.sipaccounts.length}catch(e){PutToDebugLogException(2,"common: GetNrOfAcc",e)}return 1}function SaveAccountsFile(e){try{if(webphone_api.global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveAccountsFile DO NOT SAVE, flag delsett is: "+webphone_api.global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveAccountsFile callback not defined");var t=GetAccountsFilename();if(isNull(webphone_api.global.aclist))return PutToDebugLog(2,"EVENT, SaveAccountsFile no accounts to be saved"),e(!1),!1;if(isNull(webphone_api.File))return PutToDebugLog(2,"EVENT, SaveAccountsFile File handling module not loaded yet"),e(!1),!1;for(var n="",o=null,i=0;i<webphone_api.global.aclist.length;i++)o=webphone_api.global.aclist[i],isNull(o)||(n.length>2&&(n+="\r\n"),n=n+o[AC_NAME]+","+o[AC_SIPUSERNAME]+","+o[AC_SETTFILE]+","+o[AC_CHFILE]+","+o[AC_ISACTIVE]);PutToDebugLog(2,"EVENT, acfile = "+n),IsWindowsSoftphone()&&(ApiWinSaveFile(t,n,function(t){e(!0)}),webphone_api.File.SaveFile(t,n,webphone_api.global.STORAGE_COOKIE,function(e){PutToDebugLog(2,"EVENT, SaveAccountsFile saved in cookie")})),webphone_api.File.SaveFile(t,n,webphone_api.global.STORAGE_LOCAL,function(t){e(t)})}catch(a){PutToDebugLogException(2,"common: SaveAccountsFile",a)}}function ReadAccountsFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadAccountsFile callback not defined");var t=GetAccountsFilename();if(isNull(webphone_api.File))return PutToDebugLog(2,"ERROR, ReadAccountsFile File handling module not loaded yet"),e(!1),!1;IsWindowsSoftphone()?ApiWinLoadFile(t,function(n){isNull(n)||Trim(n).length<1?(PutToDebugLog(2,"WARNING, common: ReadAccountsFile no content WinApi"),webphone_api.File.ReadFile(t,webphone_api.global.STORAGE_COOKIE,function(t){if(isNull(t)||Trim(t).length<1){var n=[],o="Account"+GetSipusername(),i=Md5Hash(o+GetParameter("serveraddress_user")+GetSipusername()+webphone_api.global.SALT+GetParameter("password")+GetLocationPathName());n[AC_NAME]=o,n[AC_SIPUSERNAME]=GetSipusername(),n[AC_SETTFILE]=i,n[AC_CHFILE]=i+"_ch",n[AC_ISACTIVE]="true",(isNull(n)||n.length<2||n.indexOf(",")<0||n.indexOf("true")<0&&n.indexOf("false")<0)&&PutToDebugLog(2,"WARNING, trying to save invalid acc : "+n),webphone_api.global.aclist.push(n),PutToDebugLog(3,"EEVENT, common ReadAccountsFile(2) save new account file"),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ReadAccountsFile(2) saved successfully"):PutToDebugLog(3,"EVENT, common ReadAccountsFile(2) failed to saved")}),t=o+","+GetSipusername()+","+i+","+i+"_ch,true"}ParseAccountsReadFromFile(t,e)})):ParseAccountsReadFromFile(n,e)}):webphone_api.File.ReadFile(t,webphone_api.global.STORAGE_LOCAL,function(t){if(isNull(t)||Trim(t).length<1){var n=[],o=GetSipusername(),i="Account"+o,a=Md5Hash(i+GetParameter("serveraddress_user")+o+webphone_api.global.SALT+GetParameter("password")+GetLocationPathName());n[AC_NAME]=i,n[AC_SIPUSERNAME]=o,n[AC_SETTFILE]=a,n[AC_CHFILE]=a+"_ch",n[AC_ISACTIVE]="true",webphone_api.global.aclist.push(n),PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) save new account file"),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) saved successfully"):PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) failed to saved")}),t=i+","+o+","+a+","+a+"_ch,true"}ParseAccountsReadFromFile(t,e)})}catch(n){PutToDebugLogException(2,"common: ReadAccountsFile",n)}}function ParseAccountsReadFromFile(e,t){try{var n=e.split("\r\n");if(isNull(n)||n.length<1)return PutToDebugLog(2,"ERROR, common: ParseAccountsReadFromFile empty content"),t(!1),!1;if(!isNull(webphone_api.global.aclist))for(var o in webphone_api.global.aclist)delete webphone_api.global.aclist[o];for(var i=1,a=0;a<n.length;a++)if(isNull(n[a])||n[a].length<2||n[a].indexOf(",")<0||n[a].indexOf("true")<0&&n[a].indexOf("false")<0)i=2,PutToDebugLog(2,"WARNING, common ParseAccountsReadFromFile broken or invalid account (1) ("+GetAccountsFilename()+":"+parseInt(a,10)+"): "+n[a]);else{if(i=i<2?0:1){for(var r=!0,s=n[a],l=0;l<s.length;l++)if(s[l].charCodeAt(0)<32||s[l].charCodeAt(0)>122){r=!1;break}if(!r)continue;PutToDebugLog(2,"EVENT, broken account file but allowing ("+parseInt(a,10)+"): "+s)}var p=n[a].split(",");webphone_api.global.aclist.push(p)}return i>0&&(2==i?PutToDebugLog(3,"ERROR, common ParseAccountsReadFromFile accounts is corrupt"):PutToDebugLog(3,"WARNING, common ParseAccountsReadFromFile accounts missing"),webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, delsettings accounts result: "+e);var t=[],n="Account"+GetSipusername(),o=Md5Hash(n+GetParameter("serveraddress_user")+GetSipusername()+webphone_api.global.SALT+GetParameter("password")+GetLocationPathName());t[AC_NAME]=n,t[AC_SIPUSERNAME]=GetSipusername(),t[AC_SETTFILE]=o,t[AC_CHFILE]=o+"_ch",t[AC_ISACTIVE]="true",webphone_api.global.aclist.push(t),PutToDebugLog(3,"EVENT, common ParseAccountsReadFromFile save new account file "+o),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ParseAccountsReadFromFile Accounts file saved successfully"):PutToDebugLog(2,"ERROR, common ParseAccountsReadFromFile Accounts file save failed")})})),t(!0),!0}catch(c){PutToDebugLogException(2,"common: ParseAccountsReadFromFile",c)}}function GetActiveAccount(){try{if(isNull(webphone_api.global.aclist)||webphone_api.global.aclist.length<1)return PutToDebugLog(2,"EVENT, common GetActiveAccount no available accounts"),null;for(var e=0;e<webphone_api.global.aclist.length;e++)if(!(isNull(webphone_api.global.aclist[e])||webphone_api.global.aclist[e].length<2)){var t=webphone_api.global.aclist[e];if("true"===t[AC_ISACTIVE])return t}}catch(n){PutToDebugLogException(2,"common: GetActiveAccount",n)}return null}function GetActiveAccSettingsFilename(){try{var e=GetActiveAccount();return isNull(e)||e.length<2?(PutToDebugLog(2,"EVENT, common GetActiveAccSettingsFilename cant get filename, probably doesn't exist"),""):isNull(e[AC_SETTFILE])||e[AC_SETTFILE].length<1?(PutToDebugLog(2,"ERROR, common GetActiveAccSettingsFilename no filename"),""):e[AC_SETTFILE]}catch(t){PutToDebugLogException(2,"common: GetActiveAccount",t)}return""}function GetActiveAccCallhistoryFilename(){try{var e=GetActiveAccSettingsFilename();return isNull(e)||e.length<1?"":e+"_ch"}catch(t){PutToDebugLogException(2,"common: GetActiveAccCallhistoryFilename",t)}return""}function GetActiveAccUsername(){try{var e=GetActiveAccount();return isNull(e)||e.length<2?(PutToDebugLog(2,"EVENT, common GetActiveAccUsername cant get active account"),""):isNull(e[AC_SIPUSERNAME])||e[AC_SIPUSERNAME].length<1?GetSipusername():e[AC_SIPUSERNAME]}catch(t){PutToDebugLogException(2,"common: GetActiveAccUsername",t)}return""}function GetAccountsFilename(){try{if(!isNull(sessionaccfilename)&&sessionaccfilename.length>0)return sessionaccfilename;var e=GetConfig("brandid");return(isNull(e)||e.length<1||"-1"==e)&&(e=GetBrandName().toLowerCase()),sessionaccfilename=webphone_api.global.ACCOUNTS_FILENAME+"_"+Md5Hash(GetLocationPathName()+e)}catch(t){PutToDebugLogException(2,"common: GetAccountsFilename",t)}return""}function GetLocationPathName(){try{if(!isNull(lpname)&&lpname.length>0)return lpname;if(upfn_fname<0)if("undefined"!=typeof webphone_api.parameters.usepathinfilenames&&null!==webphone_api.parameters.usepathinfilenames)"false"===webphone_api.parameters.usepathinfilenames.toString()?upfn_fname=0:"true"===webphone_api.parameters.usepathinfilenames.toString()?upfn_fname=3:IsNumber(webphone_api.parameters.usepathinfilenames)&&(upfn_fname=StrToIntDef(webphone_api.parameters.usepathinfilenames,3));else{var e=GetConfig("usepathinfilenames");void 0!==e&&null!==e&&("false"===e.toString()?upfn_fname=0:"true"===e.toString()?upfn_fname=3:IsNumber(e)&&(upfn_fname=StrToIntDef(e,3)))}if((upfn_fname<0||upfn_fname>3)&&(upfn_fname=3),0===upfn_fname)return"";var t=GetProfile();isNull(t)&&(t="");var n=location.href;isNull(n)&&(n=""),n=Trim(n),n=n.toLowerCase();var o=n.indexOf("file:");if(o>=0&&o<5){o=n.indexOf("?"),o>0&&(n=n.substring(0,o)),o=n.indexOf("#"),o>0&&(n=n.substring(0,o));var i="";o=n.lastIndexOf("/"),o>0&&(i=n.substring(o+1),n=n.substring(0,o),(isNull(i)||i.indexOf(".")>0)&&(i="")),lpname=n+i,isNull(lpname)&&(lpname=""),lpname=ReplaceAll(lpname,"/",""),t.length>0&&(lpname=lpname+"_"+t),PutToDebugLog(2,"EVENT, LPname local and profile: "+lpname)}else{var a=location.hostname;if(isNull(a)&&(a=""),1===upfn_fname);else{!isNull(location.pathname)&&location.pathname.toString().length>0&&(2===upfn_fname?a+=location.pathname:a=location.pathname),a=Trim(a);var o=a.indexOf("://");o>0&&(a=a.substring(o+3)),a=Trim(a);var o=a.indexOf("/");if(0===o&&(a=a.substring(1)),(o=a.lastIndexOf("/"))>0){var r=a.substring(o);!isNull(r)&&r.indexOf(".")>0&&(a=a.substring(0,o))}o=a.lastIndexOf("?"),o>0&&(a=a.substring(0,o)),o=a.lastIndexOf("#"),o>0&&(a=a.substring(0,o)),a=ReplaceAll(a,"/",""),isNull(a)&&(a=""),a=Trim(a)}lpname=a,t.length>0&&(lpname=lpname+"_"+t),
CanLog(2)&&PutToDebugLog(2,"EVENT, LPname: "+lpname)}return lpname}catch(s){PutToDebugLogException(2,"common: GetLocationPathName",s)}return""}function GetProfile(){try{if(!isNull(currprofile))return currprofile;currprofile="";var e=window.location.href;e=decodeURIComponent(e),e=e.toLowerCase();var t=e.indexOf("profile=");t>0&&(e=e.substring(t+8),t=e.indexOf("&"),t>0&&(e=e.substring(0,t)),t=e.indexOf("#"),t>0&&(e=e.substring(0,t)),e=Trim(e),currprofile=e),currprofile.length<1&&!isNull(webphone_api.parameters)&&!isNull(webphone_api.parameters.profile)&&webphone_api.parameters.profile.length>0&&(currprofile=webphone_api.parameters.profile),currprofile.length<1&&!isNull(GetConfig("profile"))&&GetConfig("profile").length>0&&(currprofile=GetConfig("profile"))}catch(n){PutToDebugLogException(2,"common: GetProfile",n)}return currprofile}function GetSettFilenameSDK(){try{var e=Md5Hash("sdksettfilename"+GetLocationPathName()),t=GetConfig("brandid");return(isNull(t)||t.length<1||"-1"==t)&&(t=GetBrandName().toLowerCase()),e+=t}catch(n){PutToDebugLogException(2,"common: GetSettFilenameSDK",n)}return""}function Encrypt(e,t){try{if(isNull(t)||t.length<1||isNull(e))return PutToDebugLog(2,"ERROR, file: common no key or value"),null;for(var n="",o=0;o<t.length;o++)n+=t.charCodeAt(o).toString();var i=Math.floor(n.length/5),a=parseInt(n.charAt(i)+n.charAt(2*i)+n.charAt(3*i)+n.charAt(4*i)+n.charAt(5*i)),r=Math.ceil(t.length/2),s=Math.pow(2,31)-1;if(a<2)return PutToDebugLog(2,"ERROR, Algorithm cannot find a suitable hash. Please choose a different key. \nPossible considerations are to choose a more complex or longer key."),null;var l=Math.round(1e9*Math.random())%1e8;for(n+=l;n.length>10;)n=(parseInt(n.substring(0,10))+parseInt(n.substring(10,n.length))).toString();n=(a*n+r)%s;for(var p,c="",o=0;o<e.length;o++)p=parseInt(e.charCodeAt(o)^Math.floor(n/s*255)),c+=p<16?"0"+p.toString(16):p.toString(16),n=(a*n+r)%s;for(l=l.toString(16);l.length<8;)l="0"+l;return c+=l}catch(u){PutToDebugLogException(2,"common: Encrypt",u)}return null}function Decrypt(e,t){try{if(isNull(e)||e.length<8)return PutToDebugLog(2,"ERROR, A salt value could not be extracted from the encrypted message because it's length is too short. The message cannot be decrypted."),null;if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, Please enter a key with which to decrypt the message."),null;var n="",o=e.indexOf("almakorte_2_");o>=0&&(e=e.substring(o+12));for(var i=0;i<t.length;i++)n+=t.charCodeAt(i).toString();var a=Math.floor(n.length/5),r=parseInt(n.charAt(a)+n.charAt(2*a)+n.charAt(3*a)+n.charAt(4*a)+n.charAt(5*a)),s=Math.round(t.length/2),l=Math.pow(2,31)-1,p=parseInt(e.substring(e.length-8,e.length),16);for(e=e.substring(0,e.length-8),n+=p;n.length>10;)n=(parseInt(n.substring(0,10))+parseInt(n.substring(10,n.length))).toString();n=(r*n+s)%l;for(var c,u="",i=0;i<e.length;i+=2)c=parseInt(parseInt(e.substring(i,i+2),16)^Math.floor(n/l*255)),u+=String.fromCharCode(c),n=(r*n+s)%l;return u}catch(h){PutToDebugLogException(2,"common: Decrypt",h)}return null}function B64Enc(e){try{if(isNull(e))return PutToDebugLog(2,"ERROR, B6 value could not be extracted"),null;if(e.length<1)return"";var t=e;return t=Base64.encode(t),t=ReplaceAll(t,"=","-"),t=ReplaceAll(t,"+","_"),t=ReplaceAll(t,"/",".")}catch(n){PutToDebugLogException(2,"common: B64Enc",n)}return e}function B64Dec(e){try{if(isNull(e))return"";if(e.indexOf("_BASE64_")<0)return e;var t=e.replace("_BASE64_","");return t=ReplaceAll(t,"-","="),t=ReplaceAll(t,"_","+"),t=ReplaceAll(t,".","/"),t=Base64.decode(t)}catch(n){PutToDebugLogException(2,"common: B64Dec",n)}return e}function StrEc(e,t,n){var o="";try{if(isNull(e))return PutToDebugLog(2,"ERROR, A salt value could not be extracted(2)"),"";if(e.length<1)return"";if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, Please enter a correct key(2)"),e;if(0===e.indexOf("encrypted")||0===e.indexOf("oenc1_")||0===e.indexOf("alenc1_")||0===e.indexOf("dcid_")||0===e.indexOf("wetrt_")||0===e.indexOf("mcrfs_"))return e;for(var i=0,a=t.length,r=0,s=0;s<e.length;s++){r=e.charCodeAt(s)^t.charCodeAt(i),!0===n&&(r%=128)<0&&(r=95);o+=String.fromCharCode(r),i<a-1?i++:i=0}return o=Base64.encode(o),o=ReplaceAll(o,"=","-"),o=ReplaceAll(o,"+","_"),o=ReplaceAll(o,"/",".")}catch(l){PutToDebugLogException(2,"common: StrEc",l)}return e}function StrDc(e,t,n){var o="";try{if(isNull(e))return PutToDebugLog(2,"ERROR, A salt value could not be extracted(3)"),"";if(e.lenght<1)return e;if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, Please enter a correct key(3)"),e;if(e=e.toString(),e=Trim(e),0!==e.indexOf("encrypted")&&0!==e.indexOf("oenc1_")&&0!==e.indexOf("alenc1_")&&0!==e.indexOf("dcid_")&&0!==e.indexOf("wetrt_")&&0!==e.indexOf("mcrfs_"))return e;if(e=e.replace("oenc1_",""),e=e.replace("alenc1_",""),e=e.replace("dcid_",""),e=e.replace("wetrt_",""),e=e.replace("encrypted__3__",""),e=e.replace("encrypted__16__",""),e=e.replace("mcrfs_",""),e.lenght<1)return e;if(e.indexOf("encrypted__4")>=0)return e=e.replace("encrypted__4__",""),e=Base64.decode(e);var i=e.indexOf("__");i>0&&(e=e.substring(i+2));i=e.indexOf("__"),i>=0&&(e.substring(0,i),e=e.substring(i+2)),e=ReplaceAll(e,"-","="),e=ReplaceAll(e,"_","+"),e=ReplaceAll(e,".","/"),e=Base64.decode(e);for(var a=0,r=t.length,s=0,l=0;l<e.length;l++){s=e.charCodeAt(l)^t.charCodeAt(a),!0===n&&(s%=128)<0&&(s=95);o+=String.fromCharCode(s),a<r-1?a++:a=0}return o}catch(p){PutToDebugLogException(2,"common: StrDc",p)}return e}function delsettings(e){try{if(isNull(e)||e<1)return void PutToDebugLog(4,"WARNING, delsettings invalid level parameter");if(PutToDebugLog(2,"EVENT, common delsettings called, level: "+e.toString()),e>2&&(e=2),webphone_api.global.flag_delsett=e,webphone_api.global.resetsett_handled=!0,!isNull(webphone_api.origparameters)&&!isNull(webphone_api.parameters))if(webphone_api.parameters={},Object.assign)Object.assign(webphone_api.parameters,webphone_api.origparameters);else for(var t in webphone_api.origparameters)webphone_api.parameters[t]=webphone_api.origparameters[t];if(2===e){webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, delete call history file: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),webphone_api.global.chlist=[],webphone_api.global.recentlist=[];var n=GetParameter("messagefiles");if(!isNull(n)){for(var o=n.split(","),i=0;i<o.length;i++)if(!(isNull(o[i])||o[i].length<3)){var a=o[i].indexOf("[#");a>0&&(o[i]=o[i].substring(0,a));o[i]}SaveParameter("messagefiles","")}var r=GetConfig("brandid");(isNull(r)||r.length<1||"-1"==r)&&(r=GetBrandName().toLowerCase()),webphone_api.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, delete accounts file result: "+e)}),webphone_api.global.aclist=[],webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME+r,function(e){PutToDebugLog(2,"EVENT, delete contacts file result: "+e)}),webphone_api.global.ctlist=[]}webphone_api.File.DeleteAllCookies(),webphone_api.File.DeleteFile(GetActiveAccSettingsFilename(),function(e){PutToDebugLog(2,"EVENT, delete settings file: "+GetActiveAccSettingsFilename()+" result: "+e)}),webphone_api.global.settmap={},HandleSettings("","",function(){}),setTimeout(function(){webphone_api.global.flag_delsett=0,PutToDebugLog(2,"EVENT, delete settings flag delsett is reset to: 0")},250),OpenSettings(!0,3)}catch(s){PutToDebugLogException(2,"common: delsettings",s)}}function HideClearPassword(e){var t=e,n="";try{if(isNull(e))return PutToDebugLog(2,"WARNING, common: HideClearPassword textin is NULL"),"";var o=t.indexOf("password");if(o>0)return n=t.substring(0,o)+"password: *****",t=t.substring(o,t.length),o=t.indexOf("\r\n"),o<0&&(o=("password "+GetParameter("password")).length)>t.length&&(o=t.length-1),t=t.substring(o,t.length),n+=t}catch(i){PutToDebugLogException(2,"common: HideClearPassword",i)}return e}function UseCustomAutoprov(e){try{var t=GetParameter("customautoprov_url");if(isNull(t)||t.length<3)return!1;if(1==GetParameterInt("customautoprov_repeat",1)&&GetParameterInt("custautoprov_exectimes",0)>0)return!1;var n=GetParameterInt("customautoprov_when",1);return!(!0===e&&2==n||!1===e&&1==n)}catch(o){PutToDebugLogException(2,"common: UseCustomAutoprov",o)}return!1}function GetCustomAutoprov(e){try{var t=GetParameter("customautoprov_url");if(isNull(t)||t.length<5)return PutToDebugLog(2,"ERROR, GetCustomAutoprov invalid url"),void e("ERROR, GetCustomAutoprov invalid url");IsHttps()&&(t=t.replace("http:","https:")),t=UriParser(t,"","","","","return_uri"),PutToDebugLog(3,"EVENT, GetCustomAutoprov url: "+t),acploop++;var n=new XMLHttpRequest;if("withCredentials"in n)n.open("GET",t,!0);else{if("undefined"==typeof XDomainRequest)return PutToDebugLog(2,"ERROR, common: GetCustomAutoprov, CORS not supported"),void e("ERROR, GetCustomAutoprov CORS not supported callback");n=new XDomainRequest,n.open("GET",t)}var o=0;n.onload=function(){try{if(PutToDebugLog(4,"EVENT, GetCustomAutoprov.onload"),o=19,!1===webphone_api.global.httpheaderslogged&&n.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, GetCustomAutoprov: HTTP request answer headers 3: "+n.getAllResponseHeaders())}var t=n.responseText;return o=20,PutToDebugLog(2,"EVENT, GetCustomAutoprov response: "+t),o=21,isNull(t)||t.length<1?(o=23,PutToDebugLog(2,"ERROR, GetCustomAutoprov response is NULL"),void e("")):void e(t)}catch(i){PutToDebugLogException(2,"common: GetCustomAutoprov.onload inner ("+o+")",i),e("ERROR, catch on: common: GetCustomAutoprov.onload inner ("+o+")")}},n.onerror=function(t){var n="";isNull(t)||(n=t.toString(),isNull(t.target)||(n=isNull(t.target.status)?n+" "+t.target.toString():n+" "+t.target.status.toString())),PutToDebugLog(2,"ERROR, common: GetCustomAutoprov: onerror: "+n),e("ERROR, common: GetCustomAutoprov: onerror FAILED")},n.timeout=9e3,n.ontimeout=function(t){PutToDebugLog(2,"ERROR, common: GetCustomAutoprov: Timeout"),e("ERROR, common: GetCustomAutoprov: ontimeout FAILED")},n.send()}catch(i){PutToDebugLogException(2,"common: GetCustomAutoprov",i),e("ERROR, common: GetCustomAutoprov: global failure")}}function RecAutoprovCustom(e){try{PutToDebugLog(3,"EVENT, RecAutoprovCustom: "+e);if(isNull(e)||Trim(e).length<=0||e.toLowerCase().indexOf("error")>=0&&e.length<160)return void PutToDebugLog(3,"ERROR, can't get custom autoprovisioning: "+e);if(e.indexOf("AUTOPROVISIONINGSTART")<0||e.indexOf("AUTOPROVISIONINGEND")<0)return void PutToDebugLog(3,"ERROR, custom autoprovisioning: no AUTOPROVISIONINGSTART and AUTOPROVISIONINGEND found: "+e);e=e.substring(e.indexOf("AUTOPROVISIONINGSTART")+21,e.indexOf("AUTOPROVISIONINGEND")),e=Trim(e);var t=e.split("\n");if(isNull(t)||t.length<1)return void PutToDebugLog(3,"ERROR, custom autoprovisioning invalid received data: "+e);var n=[];n.push("s"),n.push("e"),n.push("r"),n.push("v"),n.push("e"),n.push("r"),n.push("a"),n.push("d"),n.push("d"),n.push("r"),n.push("e"),n.push("s"),n.push("s");for(var o=n.join(""),i=0,a=0;a<t.length;a++)if(!(isNull(t[a])||t[a].length<3||t[a].indexOf(":")<1)){t[a]=Trim(t[a]);var r=Trim(t[a].substring(0,t[a].indexOf(":"))),s=Trim(t[a].substring(t[a].indexOf(":")+1));r=r.toLowerCase(),PutToDebugLog(5,"EVENT, custom autoprovisioning set: "+r+" = "+s),r!==o&&0!==Trim(r).indexOf(o)&&(SaveParameter(r,s),i++)}if(PutToDebugLog(2,"EVENT, RecAutoprovCustom number of configs received: "+i),i>1){var l=GetParameterInt("custautoprov_exectimes",0);l+=1,SaveParameter("custautoprov_exectimes",l.toString())}else PutToDebugLog(5,"WARNING, custom autoprovisioning probably failed because too few parameters found: "+i)}catch(p){PutToDebugLogException(2,"common: RecAutoprovCustom",p)}}function GetAutoprovisioning(e,t){try{if(getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&getuseengine()!==webphone_api.global.ENGINE_FLASH)return PutToDebugLog(2,"ERROR, GetAutoprovisioning invalid engine: "+getuseengine()),void t("");(isNull(e)||e.length<1)&&(e=webphone_api.global.autoprovsrv_1);var n=GetParameter("serveraddress_user");if(isNull(n)||Trim(n).length<1)return PutToDebugLog(2,"ERROR, GetAutoprovisioning no serveraddress_user specified"),void t("ERROR, GetAutoprovisioning no serveraddress_user specified callback");e=e+n+".txt",IsHttps()&&(e=e.replace("http:","https:")),PutToDebugLog(3,"EVENT, GetAutoprovisioning url: "+e),aploop++;var o=new XMLHttpRequest;if("withCredentials"in o)o.open("GET",e,!0);else{if("undefined"==typeof XDomainRequest)return PutToDebugLog(2,"ERROR, common: GetAutoprovisioning, CORS not supported"),void t("ERROR, GetAutoprovisioning CORS not supported callback");o=new XDomainRequest,o.open("GET",e)}var i=0;o.onload=function(){try{if(PutToDebugLog(4,"EVENT, GetAutoprovisioning.onload"),i=19,!1===webphone_api.global.httpheaderslogged&&o.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 3: "+o.getAllResponseHeaders())}var e=o.responseText;return i=20,PutToDebugLog(2,"EVENT, GetAutoprovisioning response: "+e),i=21,isNull(e)||e.length<1?(i=23,PutToDebugLog(2,"ERROR, GetAutoprovisioning response is NULL"),void t("")):void t(e)}catch(n){PutToDebugLogException(2,"common: GetAutoprovisioning.onload inner ("+i+")",n),t("ERROR, catch on: common: GetAutoprovisioning.onload inner ("+i+")")}},o.onerror=function(e){var n="";isNull(e)||(n=e.toString(),isNull(e.target)||(n=isNull(e.target.status)?n+" "+e.target.toString():n+" "+e.target.status.toString())),PutToDebugLog(2,"ERROR, common: GetAutoprovisioning: onerror: "+n),t("ERROR, common: GetAutoprovisioning: onerror FAILED")},o.timeout=9e3,o.ontimeout=function(e){PutToDebugLog(2,"ERROR, common: GetAutoprovisioning: Timeout"),t("ERROR, common: GetAutoprovisioning: ontimeout FAILED")},o.send()}catch(a){PutToDebugLogException(2,"common: GetAutoprovisioning",a),t("ERROR, common: GetAutoprovisioning: global failure")}}function ParseAutoprovisioning(e,t){try{!0===t?SaveParameter("cust_lastautoprov",GetTickCount().toString()):SaveParameter("lastautoprov",GetTickCount().toString()),e.lastIndexOf("EOFLINE")>0&&(e=ReplaceAll(e,"EOFLINE","\r\n")),SaveParameter("serveraddress_orig",GetAPparam("server",e)),SaveParameter("proxyaddress",GetAPparam("proxyserver",e)),SaveParameter("cfgusetunneling",GetAPparam("encryption",e)),SaveParameter("cfgusetunneling",GetAPparam("cfgusetunneling",e)),SaveParameter("techprefix",GetAPparam("techprefix",e)),SaveParameter("creditrequest",GetAPparam("creditrequest",e)),SaveParameter("ratingrequest",GetAPparam("ratingrequest",e)),SaveParameter("accounturi",GetAPparam("accounturi",e)),SaveParameter("newuser",GetAPparam("newuser",e)),SaveParameter("callback",GetAPparam("callback",e)),SaveParameter("p2p",GetAPparam("p2p",e)),SaveParameter("sms",GetAPparam("sms",e)),SaveParameter("brandname",GetAPparam("brandname",e)),SaveParameter("companyname",GetAPparam("companyname",e)),SaveParameter("homepage",GetAPparam("website",e)),SaveParameter("recharge",GetAPparam("recharge",e)),SaveParameter("brandtext",GetAPparam("brandtext",e)),SaveParameter("voicemail",GetAPparam("voicemail",e)),SaveParameter("voicemailnum",GetAPparam("voicemailnum",e)),SaveParameter("messagepopup",GetAPparam("messagepopup",e)),SaveParameter("messagedisplay",GetAPparam("messagedisplay",e)),SaveParameter("encryptionseries",GetAPparam("encryptionseries",e)),SaveParameter("directserveraddress",GetAPparam("directserveraddress",e)),SaveParameter("consoleaddress",GetAPparam("consoleaddress",e)),SaveParameter("httptunnelport",GetAPparam("httptunnelport",e)),SaveParameter("tcptunnelingport",GetAPparam("tcptunnelingport",e)),SaveParameter("rsakey_public_k",GetAPparam("rsakey_public_k",e)),SaveParameter("fastencryptkey",GetAPparam("fastencryptkey",e)),SaveParameter("autotransportdetect",GetAPparam("autotransportdetect",e)),SaveParameter("remotehttpport",GetAPparam("remotehttpport",e)),SaveParameter("encryptionmethod",GetAPparam("encryptionmethod",e)),SaveParameter("cantryudpdirectep",GetAPparam("cantryudpdirectep",e)),SaveParameter("usingmizuserver",GetAPparam("usingmizuserver",e)),SaveParameter("upperserver",GetAPparam("upperserver",e)),SaveParameter("serverinputisupperserver",GetAPparam("serverinputisupperserver",e)),SaveParameter("version",GetAPparam("version",e)),SaveParameter("header",GetAPparam("header",e)),SaveParameter("footer",GetAPparam("footer",e)),SaveParameter("logo",GetAPparam("logo",e)),SaveParameter("supportmail",GetAPparam("supportmail",e)),SaveParameter("supporturl",GetAPparam("supporturl",e)),SaveParameter("advertisement",GetAPparam("advertisement",e)),SaveParameter("helpurl",GetAPparam("helpurl",e)),SaveParameter("licenseurl",GetAPparam("licenseurl",e)),SaveParameter("extramenuurl",GetAPparam("extramenuurl",e)),SaveParameter("extramenutxt",GetAPparam("extramenutxt",e)),SaveParameter("extramenuurl1",GetAPparam("extramenuurl1",e)),SaveParameter("extramenutxt1",GetAPparam("extramenutxt1",e)),SaveParameter("extramenuurl2",GetAPparam("extramenuurl2",e)),SaveParameter("extramenutxt2",GetAPparam("extramenutxt2",e)),SaveParameter("extramenuurl3",GetAPparam("extramenuurl3",e)),SaveParameter("extramenutxt3",GetAPparam("extramenutxt3",e)),SaveParameter("extramenuurl4",GetAPparam("extramenuurl4",e)),SaveParameter("extramenutxt4",GetAPparam("extramenutxt4",e)),SaveParameter("extramenuurl5",GetAPparam("extramenuurl5",e)),SaveParameter("extramenutxt5",GetAPparam("extramenutxt5",e))}catch(n){PutToDebugLogException(2,"common: ParseAutoprovisioning",n)}}function GetAPparam(e,t){try{if(isNull(e)||e.length<1||isNull(t)||t.indexOf(e)<0)return"";var n=t.split("\r\n");if(isNull(n)||n.length<1)return"";for(var o=0;o<n.length;o++)if(!isNull(n[o])&&0===Trim(n[o]).indexOf(e+":")){var i=n[o].substring(n[o].indexOf(e+":")+e.length+1,n[o].length);return Trim(i)}}catch(a){PutToDebugLogException(2,"common: GetAPparam",a)}return""}function RandomInt(e,t){try{var n=t-e+1,o=Math.round(Math.random()*n)%n;return o+=Math.round(e)}catch(i){PutToDebugLogException(2,"common: RandomInt",i)}return 0}function RandomStr(e,t,n){try{if(isNull(e)||e<1)return"";isNull(t)&&(t=!1),isNull(n)&&(n=!1);var o=48;!1===n&&(o=65);for(var i="",a=0;a<5e3;a++){var r=RandomInt(o,122);if(!1===t?ASCII_NRLOWER.indexOf(r)>-1&&(i+=String.fromCharCode(r)):ASCII_ALL.indexOf(r)>-1&&(i+=String.fromCharCode(r)),i.length>=e)return i}return i}catch(s){PutToDebugLogException(2,"common: RandomStr",s)}return 0}function ShowModalLoader(e){try{if(!0===IsSDK())return;webphone_api.$("body").append('<div class="modalWindow"/>'),!1===IsSDK()&&webphone_api.$.mobile.loading("show",{text:e,textVisible:!0,theme:"b",html:""})}catch(t){PutToDebugLogException(2,"common: ShowModalLoader",t)}}function HideModalLoader(){try{webphone_api.$(".modalWindow").remove(),!1===IsSDK()&&webphone_api.$.mobile.loading("hide")}catch(e){PutToDebugLogException(2,"common: HideModalLoader",e)}}function GetDefaultFontSize(e){var t=0;try{e=e||document.body;var n=document.createElement("span");return n.style.cssText="display:inline-block; padding:0; line-height:1; position:absolute; visibility:hidden; font-size:1em",n.appendChild(document.createTextNode("M")),e.appendChild(n),t=n.offsetHeight,e.removeChild(n),isNull(t)&&(t=0),t}catch(o){PutToDebugLogException(2,"common: GetDefaultFontSize",o)}return 0}function ShowServerInput(){try{var e=GetParameter("showserverinput");if("0"===e)return!1;if("2"===e)return!0;if("1"===e){var t=webphone_api.parameters.serveraddress,n=GetConfig("serveraddress");return isNull(t)&&(t=""),isNull(n)&&(n=""),!(t.length>0||n.length>0)||"false"!==GetParameter("serverinputisupperserver")}}catch(o){PutToDebugLogException(2,"common: ShowServerInput",o)}return!1}function RequestUserServerInput(e){try{if(isNull(e)&&(e=GetParameter("upperserverfromuser")),"0"===e||"1"===e)return!1;if("3"===e)return!0;if("2"===e)return!!ShowServerInput()}catch(t){PutToDebugLogException(2,"common: RequestUserServerInput",t)}return!1}function GetAllContactsNumbersSipuris(){var e="";try{if(isNull(webphone_api.global.ctlist))return PutToDebugLog(2,"WARNING, common: GetAllContactsNumbersSipuris no numbers to return"),"";if(webphone_api.global.ctlist.length<1)return PutToDebugLog(2,"EVENT, common: GetAllContactsNumbersSipuris no numbers to return"),"";for(var t=0;t<webphone_api.global.ctlist.length;t++){var n=webphone_api.global.ctlist[t];if(!(isNull(n)||n.length<1)){var o=n[CT_NUMBER];if(!(isNull(o)||o.length<1))for(var i=0;i<o.length;i++)!isNull(o[i])&&o[i].length>0&&(e.length>0&&(e+=","),e+=o[i])}}return e}catch(a){PutToDebugLogException(2,"common: GetAllContactsNumbersSipuris",a)}return""}function SetDID(){try{if(sdcalled)return;sdt++,sdt>3&&(sdcalled=!0),setTimeout(function(){SetDID()},8e3);var e=RandomInt(1e4,99999999);WinAPI("API_SetDIDChange",null,e,Md5Hash("didchange"+e))}catch(t){PutToDebugLogException(2,"common: SetDIDX",t)}}function GtUc(){return unlockcodetrick}function GtUct(){return unlockcodetricktogled}function Hasesw(){return!isNull(alsv)&&alsv.length>0||!isNull(alsww)&&alsww.length>0}function Us(){return webphone_api.global.usestorage}function Alwr(){var e=!1;try{if(webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC||isNull(alswrt)||Trim(alswrt).length<1)return!0;var t=GetWebrtcSrvAddr();t=t.toLowerCase();var n=[];n.push("l"),n.push("o"),n.push("c"),n.push("a"),n.push("l"),n.push("f"),n.push("i"),n.push("l"),n.push("e");var o=n.join("");n=[],n.push("l"),n.push("o"),n.push("c"),n.push("a"),n.push("l");var i=n.join("");n=[],n.push("1"),n.push("2"),n.push("7"),n.push("."),n.push("0"),n.push("."),n.push("0"),n.push("."),n.push("1");var a=n.join("");n=[],n.push("l"),n.push("o"),n.push("c"),n.push("a"),n.push("l"),n.push("h"),n.push("o"),n.push("s"),n.push("t");var r=n.join(""),s=t.indexOf("//");if(s>0&&(t=t.substring(s+2,t.length)),s=t.indexOf("/"),s>0&&(t=t.substring(0,s)),s=t.indexOf(":"),s>0&&(t=t.substring(0,s)),t=t.replace("www.",""),isNull(t)||Trim(t).length<1)return!1;t=Trim(t);var l=StrDc(alswrt,alsvkey);if(!isNull(l)&&l.length>0){var p=l.split(",");if(!isNull(p)&&p.length>0)for(var c=0;c<p.length;c++)if(!(isNull(p[c])||p[c].length<1)){if(p[c]=Trim(p[c]),p[c]=p[c].toLowerCase(),t.indexOf(p[c])>=0){e=!0;break}if(p[c]===o&&!0===IsLocalFileSys()||p[c]===r&&(t.indexOf(a)>=0||t.indexOf(r)>=0)||p[c]===i&&(!0===IsLocalFileSys()||t.indexOf(a)>=0||t.indexOf(r)>=0)){e=!0;break}}}return e}catch(u){PutToDebugLogException(2,"common: Alwr",u)}return!1}function Awre(){if(!1===Alwr()){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("w"),e.push("e"),e.push("b"),e.push("r"),e.push("t"),e.push("c"),e.push(" "),e.push("s"),e.push("e"),e.push("r"),e.push("v"),e.push("e"),e.push("r"),e.push(" "),e.push("n"),e.push("o"),e.push("t"),e.push(" "),e.push("a"),e.push("l"),e.push("l"),e.push("o"),e.push("w"),e.push("e"),e.push("d"),e.push("_"),e.push("1");var t=e.join("");setTimeout(function(){PutToDebugLog(1,t)},1881)}}function Alwm(){var e=!1,t=!1;try{if(webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC)return!0;if(void 0===alsww||isNull(alsww)||null==alsww||Trim(alsww).length<2)return void 0!==malsx2&&null!=malsx2&&44===malsx2;al_isreliable=!1,al2_isreliable=!1;var n=GetParameter("aldm");(isNull(n)||Trim(n).length<2)&&(n=window.location.href),isNull(n)||Trim(n).length<2?n="":(n=decodeURIComponent(n),al_isreliable=!0,0!=n.toLowerCase().indexOf("http")&&0!=n.toLowerCase().indexOf("file")&&(al_isreliable=!1),n=GetDomainFromURL(n),isNull(n)&&(n=""),n=n.toLowerCase(),n=Trim(n));var o=webphone_api.getbasedir2();if(isNull(o)&&(o=""),o.length>1&&(o=decodeURIComponent(o),al2_isreliable=!0,0!=o.toLowerCase().indexOf("http")&&0!=o.toLowerCase().indexOf("file")&&(al2_isreliable=!1),o=GetDomainFromURL(o),isNull(o)&&(o=""),o=o.toLowerCase(),o=Trim(o)),(isNull(o)||o.length<2)&&(o=n),(isNull(o)||o.length<2)&&(t=!0),(isNull(n)||n.length<2)&&(n=o),isNull(n)||n.length<2)return!0;al_isreliable||!IsIPAddrress(n)&&!IsDomainName(n)||(al_isreliable=!0),al2_isreliable||!IsIPAddrress(o)&&!IsDomainName(o)||(al2_isreliable=!0);var i=[];i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("f"),i.push("i"),i.push("l"),i.push("e");var a=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l");var r=i.join("");i=[],i.push("1"),i.push("2"),i.push("7"),i.push("."),i.push("0"),i.push("."),i.push("0"),i.push(".");var s=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("h"),i.push("o"),i.push("s"),i.push("t");var l=i.join("");if((n.indexOf("localhost")>=0||n.indexOf("127.0.0.1")>=0)&&(!al2_isreliable||o.indexOf("localhost")>=0||o.indexOf("127.0.0.1")>=0))return!0;if((o.indexOf("localhost")>=0||o.indexOf("127.0.0.1")>=0)&&(!al_isreliable||n.indexOf("localhost")>=0||n.indexOf("127.0.0.1")>=0))return!0;var p=StrDc(alsww,alsvkey);if(!isNull(p)&&p.length>0){var c=p.split(",");if(!isNull(c)&&c.length>0)for(var u=0;u<c.length;u++)isNull(c[u])||c[u].length<2||(c[u]=Trim(c[u]),c[u]=c[u].toLowerCase(),!1===e&&(n.indexOf(c[u])>=0&&(e=!0),(c[u]===a&&!0===IsLocalFileSys()||c[u]===l&&(n.indexOf(s)>=0||n.indexOf(l)>=0)||c[u]===r&&(!0===IsLocalFileSys()||n.indexOf(s)>=0||n.indexOf(l)>=0))&&(e=!0)),!1===t&&(o.indexOf(c[u])>=0&&(t=!0),(c[u]===a&&!0===IsLocalFileSys()||c[u]===l&&(o.indexOf(s)>=0||o.indexOf(l)>=0)||c[u]===r&&(!0===IsLocalFileSys()||o.indexOf(s)>=0||o.indexOf(l)>=0))&&(t=!0)))}return!(!0!==e||!0!==t&&al2_isreliable)||!(!0!==t||!0!==e&&a1_isreliable)}catch(h){PutToDebugLogException(2,"common: Alwm",h)}return!0}function Awe(){if(!1===Alwm()){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("W"),e.push("e"),e.push("b"),e.push("s"),e.push("e"),e.push("r"),e.push("v"),e.push("e"),e.push("r"),e.push(" "),e.push("n"),e.push("o"),e.push("t"),e.push(" "),e.push("a"),e.push("l"),e.push("l"),e.push("o"),e.push("w"),e.push("e"),e.push("d"),e.push("_"),e.push("1");var t=e.join(""),n=t,o=t;try{var i=GetParameter("aldm");(isNull(i)||Trim(i).length<1)&&(i=window.location.href),isNull(i)||Trim(i).length<1?i="":(i=decodeURIComponent(i),i=GetDomainFromURL(i),isNull(i)&&(i=""),i=i.toLowerCase(),i=Trim(i));var a=webphone_api.getbasedir2();isNull(a)&&(a=""),a=decodeURIComponent(a),a=GetDomainFromURL(a),isNull(a)&&(a=""),a=a.toLowerCase(),a=Trim(a),o+=" ",o+="(",o+="a ",o+=": ",o+=alsww,o+=")",t+=" ",t+="(",t+="d ",t+=": ",t+=i,t+=",",t+=al_isreliable.toString(),t+=",",t+=a,t+=",",t+=al2_isreliable.toString(),t+=",",t+=webphone_api.getbasedir2(),t+=",",t+=window.location.href,t+=",",t+=window.location,t+=",",t+=window.location.domain,t+=")"}catch(r){PutToDebugLogException(2,"common: CheckDIDXInnerA",r)}setTimeout(function(){PutToDebugLog(2,t)},1881),setTimeout(function(){PutToDebugLog(2,o)},1889),setTimeout(function(){PutToDebugLog(1,n)},1353),setTimeout(function(){ShowToast(n)},1246)}}function Awb(){var e=Alwm();return!1===e&&Awe(),e=Alwr(),!1===e&&Awre(),e}function Awb2(){var e=Alwm();return!1===e&&Awe(),e}function CheckDID(e,t){var n=!1;try{if(isNull(e)||e.length<1)return!0!==t;e=e.toLowerCase();var o=e.indexOf(":");if(o>0&&(e=e.substring(0,o)),e=Trim(e),e.indexOf(".")<1)return!0;var i=[];i.push("l"),i.push("a"),i.push("n"),i.push("i"),i.push("p");var a=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("f"),i.push("i"),i.push("l"),i.push("e");var r=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l");var s=i.join("");i=[],i.push("1"),i.push("2"),i.push("7"),i.push("."),i.push("0"),i.push("."),i.push("0"),i.push("."),i.push("1");var l=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("h"),i.push("o"),i.push("s"),i.push("t");var p=i.join(""),c=[];c.push("w"),c.push("e"),c.push("b"),c.push("s"),c.push("e"),c.push("r"),c.push("v"),c.push("e"),c.push("r");var u=c.join("");if(void 0===alsv||null==alsv||Trim(alsv).length<1)return void 0!==malsx1&&null!=malsx1&&77===malsx1;if(!(!isNull(alsv)&&alsv.length>0||!isNull(alsvir1)&&alsvir1.length>0||!isNull(alsvir2)&&alsvir2.length>0||!isNull(alsvir3)&&alsvir3.length>0))return!0!==t;var h=StrDc(alsv,alsvkey);if(!isNull(h)&&h.length>0){var g=h.split(",");if(!isNull(g)&&g.length>0){for(var m=0;m<g.length;m++)if(!(isNull(g[m])||g[m].length<1)&&(g[m]=Trim(g[m]),g[m]=g[m].toLowerCase(),u===g[m])){var d=e.indexOf("sip.");0===d&&(e=e.substring(d+4));var b=GetDomainFromURL(window.location.href);return!(isNull(b)||b.length<3)&&(b=b.toLowerCase(),b=Trim(b),d=b.indexOf("www."),0===d&&(b=b.substring(d+4)),e===b)}for(var m=0;m<g.length;m++)if(!(isNull(g[m])||g[m].length<1)){if(g[m]=Trim(g[m]),g[m]=g[m].toLowerCase(),e.indexOf(g[m])>=0){n=!0;break}if(g[m]===a&&IsLanIP(e)){n=!0;break}if(g[m]===r&&!0===IsLocalFileSys()||g[m]===p&&(e.indexOf(l)>=0||e.indexOf(p)>=0)||g[m]===s&&(!0===IsLocalFileSys()||e.indexOf(l)>=0||e.indexOf(p)>=0)){n=!0;break}}}}if(!isNull(alsvir1)&&Trim(alsvir1).length>2){var _=StrDc(alsvir1,alsvkey);_=Trim(_),_=_.toLowerCase(),0===e.indexOf(_)&&(n=!0)}if(!isNull(alsvir2)&&Trim(alsvir2).length>2){var f=StrDc(alsvir2,alsvkey);f=Trim(f),f=f.toLowerCase(),0===e.indexOf(f)&&(n=!0)}if(!isNull(alsvir3)&&Trim(alsvir3).length>2){var w=StrDc(alsvir3,alsvkey);w=Trim(w),w=w.toLowerCase(),0===e.indexOf(w)&&(n=!0)}}catch(v){PutToDebugLogException(2,"common: CheckDIDX",v)}return n}function Ch(){try{if(alsvu1.length<1&&alsvu2.length<1&&alsvu3.length<1)return!0;if(hua.length<1&&(hua=GetSipHeader("User-agent")),hsrv.length<1&&(hsrv=GetSipHeader("Server")),hsrvx.length<1&&(hsrvx=GetSipHeader("X-Server")),webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC)return!0;if(hua.length<1&&hsrv.length<1)return!1;hua=hua.toLowerCase(),hsrv=hsrv.toLowerCase(),hsrvx=hsrvx.toLowerCase();var e=alsvu1,t=alsvu2,n=alsvu3;isNull(e)&&(e=""),isNull(t)&&(t=""),isNull(n)&&(n=""),e=StrDc(e,alsvkey),t=StrDc(t,alsvkey),n=StrDc(n,alsvkey),e=e.toLowerCase(),t=t.toLowerCase(),n=n.toLowerCase();var o=!1;if(hua.length>0&&(e.length>0&&hua.indexOf(e)>=0?o=!0:t.length>0&&hua.indexOf(t)>=0?o=!0:n.length>0&&hua.indexOf(n)>=0&&(o=!0)),hsrv.length>0&&(e.length>0&&hsrv.indexOf(e)>=0?o=!0:t.length>0&&hsrv.indexOf(t)>=0?o=!0:n.length>0&&hsrv.indexOf(n)>=0&&(o=!0)),hsrvx.length>0&&(e.length>0&&hsrvx.indexOf(e)>=0?o=!0:t.length>0&&hsrvx.indexOf(t)>=0?o=!0:n.length>0&&hsrvx.indexOf(n)>=0&&(o=!0)),void 0===alsv||null==alsv||Trim(alsv).length<1)return void 0!==malsx1&&null!=malsx1&&77===malsx1;if(!1===o&&!isNull(alsv)&&alsv.length>2){var i=GetParameter("serveraddress_user");(isNull(i)||i.length<2)&&(i=GetParameter("serveraddress")),o=CheckDID(i,!0)}return o}catch(a){PutToDebugLogException(2,"common: Ch",a)}return!0}function Loa(){if(lic_onlyandroidvideo<1)return!0;if(null===myLoaCachedvalueFrom){var e=[];e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push("e"),e.push("r"),e.push("e"),e.push("x"),e.push("t"),e.push("e"),e.push("n"),e.push("s"),e.push("i"),e.push("o"),e.push("n"),e.push("="),e.push("3"),e.push("4"),e.push("5");var t=e.join("");e=[],e.push("A"),e.push("n"),e.push("d"),e.push("r"),e.push("o"),e.push("i"),e.push("d");var n=e.join("");e=[],e.push("w"),e.push("e"),e.push("b"),e.push("v"),e.push("o"),e.push("i"),e.push("p"),e.push("p"),e.push("h"),e.push("o"),e.push("n"),e.push("e"),e.push("."),e.push("c"),e.push("o"),e.push("m");var o=e.join("");e=[],e.push("a"),e.push("r"),e.push("t"),e.push("c"),e.push("v"),e.push("i"),e.push("d"),e.push("e"),e.push("o"),e.push("c"),e.push("a"),e.push("l"),e.push("l");var i=e.join(""),a=window.location.href;myLoaCachedvalueFrom=!(GetOs()!==n||a.indexOf(o)<1||a.indexOf(i)<1||a.indexOf(t)<1)}return myLoaCachedvalueFrom}function Glsp(){var e=GetOs();e=e.toLowerCase();var t=[];t.push("w"),t.push("i"),t.push("n"),t.push("d"),t.push("o"),t.push("w"),t.push("s");var n=t.join("");t=[],t.push("m"),t.push("a"),t.push("c");var o=t.join("");t=[],t.push("l"),t.push("i"),t.push("n"),t.push("u"),t.push("x");var i=t.join("");return t=[],e===n||e===o||e===i||!(lic_smartphone<1)&&!(lic_smartphone<2&&lversion<2)}function Glv(){return lversion}function Glss(){
return!(lic_screensharing<1)&&!(lic_screensharing<2&&lversion<2)}function Glbr(){return!(lic_balancerating<1)&&!(lic_balancerating<2&&lversion<2)}function Glop(){return!(lic_opus<1)&&!(lic_opus<2&&lversion<2)}function Glpr(){return!(lic_presence<1)&&!(lic_presence<2&&lversion<2)}function Glcr(){return!(lic_callrecord<1)&&!(lic_callrecord<2&&lversion<2)}function Glcf(){var e=[];return e.push("h"),e.push("a"),e.push("s"),e.push("c"),e.push("o"),e.push("n"),e.push("f"),e.push("e"),e.push("r"),e.push("e"),e.push("n"),e.push("c"),e.push("e"),!(!1===GetParameterBool(e.join(""),!0)||lic_conference<1||lic_conference<2&&lversion<2)}function Glft(){return!(lic_filetransfer<1)&&!(lic_filetransfer<2&&lversion<1)}function Glvd(){return!(lic_video<1)&&!(lic_video<2&&lversion<2)}function Glt(){return!(lic_transfer<1)&&!(lic_transfer<2&&lversion<1)}function Te(){try{var e=1011,t=11,n=25;e*=2;try{e=StrToInt(StrDc(usestoragetry,alsvkey))}catch(s){return!1}try{t=StrToInt(StrDc(usestoragetrm,alsvkey))}catch(s){t=11}try{n=StrToInt(StrDc(usestoragetrd,alsvkey))}catch(s){n=25}if(e>2300)return!1;var o=new Date,i=o.getFullYear(),a=o.getMonth(),r=o.getDate();return a+=1,i>e||(i===e&&a>t||i===e&&a===t&&r>=n)}catch(s){PutToDebugLogException(2,"common: te",s)}return!1}function Te2(){try{var e=1011,t=11,n=gtriald;e*=2;try{e=StrToInt(StrDc(usestoragetry2,alsvkey))}catch(l){return!1}try{t=StrToInt(StrDc(usestoragetrm2,alsvkey))}catch(l){t=11}if(e>2300)return!1;var o=new Date,i=o.getFullYear(),a=o.getMonth(),r=o.getDate();if(a+=1,n<0||n>27){var s=GetParameterInt("stgrnd",-1);(s<0||s>27)&&(s=RandomInt(1,27),SaveParameter("stgrnd",s)),n=s}return i>e||(i===e&&a>t||i===e&&a===t&&r>=n)}catch(l){PutToDebugLogException(2,"common: te2",l)}return!1}function Ted(){try{var e=1011,t=11,n=25;e*=2;try{e=StrToInt(StrDc(usestoragetry,alsvkey))}catch(l){return 1e4}try{t=StrToInt(StrDc(usestoragetrm,alsvkey))}catch(l){t=11}try{n=StrToInt(StrDc(usestoragetrd,alsvkey))}catch(l){n=25}if(e>2300)return 1e4;var o=new Date,i=o.getFullYear(),a=o.getMonth(),r=o.getDate();a+=1;var s=183;return s=2*s*(e-i),s+=30*(t-a),s+=n-r}catch(l){PutToDebugLogException(2,"common: ted",l)}return 1e4}function Strl(e){try{if(void 0!==e&&null!==e&&IsNumber(e)||(e=9,e*=10),Ted()<e){if(null===days_since_deploy){days_since_deploy=130;var t=GetConfig("lastdeploydate");if(!isNull(t)&&t.length>0&&t.indexOf("/")>0){var n=StrToIntDef(Trim(t.substring(0,t.indexOf("/"))),1);t=t.substring(t.indexOf("/")+1);var o=StrToIntDef(Trim(t.substring(0,t.indexOf("/"))),1);t=t.substring(t.indexOf("/")+1);var i=StrToIntDef(Trim(t.substring(0,t.indexOf(" "))),2018),a=new Date,r=a.getFullYear(),s=a.getMonth(),l=a.getDate();return s+=1,days_since_deploy=183,days_since_deploy=2*days_since_deploy*(r-i),days_since_deploy+=30*(s-n),!((days_since_deploy+=l-o)>e+10)}return!0}return!(days_since_deploy>e+10)}}catch(p){PutToDebugLogException(2,"common: strl",p)}return!1}function GetFp(){return StrDc(fip,alsvkey)}function GetWp(e){try{(isNull(e)||e.length<1)&&(e=webphone_api.global.usuk);var t="";return t=!0===BrowserRequiresHttps(!1)?"us"===e?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey):"us"===e?StrDc(wip_us,alsvkey):StrDc(wip_uk,alsvkey),t=t.replace("*","")}catch(n){PutToDebugLogException(2,"common: GetWp",n)}return""}function GetWpS(e){try{var t="";return t=isNull(e)||"uk"!==e&&"us"!==e?"us"===webphone_api.global.usuk?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey):"us"===e?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey),t=t.replace("*","")}catch(n){PutToDebugLogException(2,"common: GetWpS",n)}return""}function GetPassphrase(){try{return!isNull(pphe)&&pphe.length>0?pphe:(pphe=GetConfig("passphrase",!1),isNull(pphe)?"":(pphe.indexOf("dcid_")>=0&&(pphe=StrDc(pphe,alsvkey)),pphe))}catch(e){PutToDebugLogException(2,"common: GetPassphrase",e)}return""}function SvCont(){try{var e=[];e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p");var t=e.join(""),n=GetParameter("serveraddress_user"),o=GetParameter("serveraddress_orig"),i=GetParameter("serveraddress");if(n.length>0&&n.toLowerCase().indexOf(t)||o.length>0&&o.toLowerCase().indexOf(t)||i.length>0&&i.toLowerCase().indexOf(t))return!0}catch(a){PutToDebugLogException(2,"common: SvCont",a)}return!1}function WbCont(){try{var e=[];e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p");var t=e.join(""),n=document.location.hostname;if(!isNull(n)&&n.length>2&&(n=n.toLowerCase(),n.indexOf(t)>=0))return!0}catch(o){PutToDebugLogException(2,"common: WbCont",o)}return!1}function IsServiceInstalled(e,t){function n(e){function t(e){if(isNull(g)||g.length<5)return o(e),!1;if(n)return!1;n=!0,CanLog(2)&&(PutToDebugLog(2,"EVENT, common: IsServiceInstalled.CheckWebsocket3 exec: "+e),PutToDebugLog(2,"EVENT, IsServiceInstalled url_3: "+g));try{wsocket3&&wsocket3.close&&wsocket3.close(),wsocket3=null,wsocket3=new WebSocket(g),wsocket3.binaryType="arraybuffer",wsocket3.onopen=function(){ws3ready=!0,wready=!0,i(wsocket3,3,g)},wsocket3.onclose=function(){a(3)},wsocket3.onerror=function(e){r(3,e),o("onerror")},wsocket3.onmessage=function(e){s(3,e)},m=!0}catch(t){PutToDebugLogException(2,"IsServiceInstalled.CheckWebsocket2 failed to connect to: "+g,t),o("onexception")}isNull(wstimer3)||clearTimeout(wstimer3),wstimer3=setTimeout(function(){ws3ready||o("ontimer")},srvinstalled_timeout)}if(isNull(h)||h.length<5)return o(e,u),!1;if(d)return!1;d=!0,CanLog(2)&&(PutToDebugLog(2,"EVENT, common: IsServiceInstalled.CheckWebsocket2 exec: "+e),PutToDebugLog(2,"EVENT, IsServiceInstalled url_2: "+h));try{wsocket2&&wsocket2.close&&wsocket2.close(),wsocket2=null,wsocket2=new WebSocket(h),wsocket2.binaryType="arraybuffer",wsocket2.onopen=function(){ws2ready=!0,wready=!0,i(wsocket2,2,h)},wsocket2.onclose=function(){a(2)},wsocket2.onerror=function(e){r(2,e),t("onerror")},wsocket2.onmessage=function(e){s(2,e)},m=!0}catch(l){PutToDebugLogException(2,"IsServiceInstalled.CheckWebsocket2 failed to connect to: "+h,l),t("onexception")}isNull(wstimer2)||clearTimeout(wstimer2),wstimer2=setTimeout(function(){ws2ready||t("ontimer")},srvinstalled_timeout);var n=!1}function o(e,t){try{if(!0===NSMacLinEnabled())return PutToDebugLog(2,"EVENT, IsServiceInstalled.CheckHttpPolling returned FLASE because http polling is not available on: "+GetOs()),ExecSrvInstalledCallback(!1),!1;PutToDebugLog(2,"EVENT, common: IsServiceInstalled.CheckHttpPolling exec: "+e+"; addr: "+u);var n="";if(!isNull(t)&&t.length>5&&(n=t),isNull(n)||n.length<5)for(var o=0;o<l.length;o++)if(!(isNull(l[o])||!0===IsHttps&&l[o].indexOf("wss://")<0)){n=l[o];break}n=n.toLowerCase(),n=n.replace("wss:","https:"),n=n.replace("ws:","http:"),n=n.replace("msstwebsock","extcmd_test"),!0===IsHttps()&&(n=n.replace("http:","https:")),PutToDebugLog(2,"EVENT, IsServiceInstalled try ajax, url: "+n),webphone_api.$.ajax(n).done(function(e,t,n){if(wready=!0,PutToDebugLog(2,"EVENT, common: IsServiceInstalled ajax connected, status: "+t+"; msg: "+e),!isNull(e)&&(e=e.toLowerCase(),e.indexOf("error")<0)){var o=e.indexOf("apiresult:");if(o>0&&(e=e.substring(o+10)),!isNull(e)&&e.length>0&&!webphone_api.global.nsupdatepending)if(e.indexOf("version")<0)CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, service upgrade needed(1): "+GetMinServiceVersion().toString()),setTimeout(function(){EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0},5e3);else{var i=e.substring(e.indexOf("version")+7);isNull(i)&&(i=""),i=i.replace(":",""),i=Trim(i),i.indexOf(" ")>0&&(i=Trim(i.substring(0,i.indexOf(" ")))),!isNull(i)&&IsNumber(i)&&SaveParameter("srvupgrade_currversion_extcmd_test",i)}}return PutToDebugLog(2,"EVENT, common: IsServiceInstalled AJAX it is installed"),ExecSrvInstalledCallback(!0),!0}).fail(function(e,t,n){return wready=!1,PutToDebugLog(2,"EVENT, Note: it is not a webphone bug if the connection attempt will fail. We are just checking the availability of the local NS engine here"),PutToDebugLog(2,"EVENT, common: IsServiceInstalled ajax failed, status: "+t+"; error: "+n),ExecSrvInstalledCallback(!1),!1})}catch(i){return PutToDebugLogException(2,"IsServiceInstalled.CheckHttpPolling",i),ExecSrvInstalledCallback(!1),!1}}function i(e,t,n){if(CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onopen, connection ready: "+t+"; addr: "+n),!isNull(n)&&n.length>0&&(SaveParameter("last_good_ns_plugin_url",n),lastgoodnspluginurl=n.toString()),isNull(e))return void PutToDebugLog(2,"ERROR, common: IsServiceInstalled.onopen websocket is NULL");if(e!==wsocket&&e!==wsocket2&&e!==wsocket3)return void PutToDebugLog(2,"ERROR, common: IsServiceInstalled.onopen invalid websocket connection");e===wsocket?(void 0!==wsocket&&null!==wsocket||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled wsocket is NULL"),wsocket.send("extcmd_test")):e===wsocket2?(void 0!==wsocket2&&null!==wsocket2||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled wsocket2 is NULL"),wsocket2.send("extcmd_test")):e===wsocket3&&(void 0!==wsocket3&&null!==wsocket3||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled wsocket3 is NULL"),wsocket3.send("extcmd_test"));var o=GetEngine("ns");return o.isinstalled_cache=2,SetEngine("ns",o),ExecSrvInstalledCallback(!0),!0}function a(e){return PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onclose, connection closed: "+e),!1}function r(e,t){var n="";if(void 0!==t&&null!==t)try{n=JSON.stringify(t)}catch(o){n=t.toString()}PutToDebugLog(2,"EVENT, Note: it is not a webphone bug if the connection attempt will fail. We are just checking the availability of the local NS engine here"),PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onerror: "+e+": "+n)}function s(e,t){var n=null;if(isNull(t)||isNull(t.data)||(n=ArrayBufferToString(t.data)),!isNull(wsocket)&&wsocket.close&&(wsocket.close(),CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage websocket closed_1")),wsocket=null,!isNull(wsocket2)&&wsocket2.close&&(wsocket2.close(),CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage websocket closed_2")),wsocket2=null,!isNull(wsocket3)&&wsocket3.close&&(wsocket3.close(),CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage websocket closed_3")),wsocket3=null,!isNull(n)&&(CanLog(2)&&PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, received data: "+e+": "+n),n=n.toLowerCase(),n.indexOf("error")<0&&n.indexOf("extcmd_test")>=0&&!webphone_api.global.nsupdatepending)){var o=n.indexOf("apiresult:");if(o>0&&(n=n.substring(o+10)),!isNull(n)&&n.length>0)if(n.indexOf("version")<0)PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, service upgrade needed(2): "+GetMinServiceVersion().toString()),setTimeout(function(){EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0},5e3);else{var i=n.substring(n.indexOf("version")+7);isNull(i)&&(i=""),i=i.replace(":",""),i=Trim(i),i.indexOf(" ")>0&&(i=Trim(i.substring(0,i.indexOf(" ")))),!isNull(i)&&IsNumber(i)&&SaveParameter("srvupgrade_currversion_extcmd_test",i)}}return ExecSrvInstalledCallback(!0),!0}if(!0===IsWinMacLinNsTest()){if((isNull(lastgoodnspluginurl)||lastgoodnspluginurl.length<1)&&(lastgoodnspluginurl=GetParameter("last_good_ns_plugin_url"),isNull(lastgoodnspluginurl)||lastgoodnspluginurl.length<1)){PutToDebugLog(5,"EVENT, load WSAPIConnect websocketNS url from scratch d");var l=GetNsPluginWsUrl();if(null===l||l.length<1)return void PutToDebugLog(4,"WARNING, WSAPIReqHTTP could not find a valid URL d");lastgoodnspluginurl=l[0],SaveParameter("last_good_ns_plugin_url",lastgoodnspluginurl)}return e(!0),!0}var l=null;try{if(e&&"function"==typeof e||(e=function(){}),"Windows"!==GetOs()&&!IsMacLin()||IsMacLin()&&!1===NSMacLinEnabled())return e(!1),!1;if(void 0!==srvinstalled_callback&&null!==srvinstalled_callback||(srvinstalled_callback=[]),srvinstalled_callback.push(e),!MightUseEngine("ns"))return PutToDebugLog(2,"EVENT, IsServiceInstalled returned FLASE because of might not use"),ExecSrvInstalledCallback(!1),!1;if(!0!==t){var p=GetLastUsedEngine(),c=GetParameterInt("enginepriority_ns",2);if(!isNull(p)&&p.length>0&&p!==webphone_api.global.ENGINE_SERVICE&&c<=2)return PutToDebugLog(2,"EVENT, IsServiceInstalled returned FLASE because of priority2"),ExecSrvInstalledCallback(!1),!1}if(wready)return PutToDebugLog(2,"EVENT, IsServiceInstalled returned TRUE already checked"),ExecSrvInstalledCallback(!0),!0;if(lastCheckTick>0&&GetTickCount()-lastCheckTick<2e3)return void((isNull(srvinstalled_callback)||srvinstalled_callback.length<2)&&(PutToDebugLog(2,"EVENT, IsServiceInstalled skip because recently checked: "+wready.toString()),ExecSrvInstalledCallback(wready?!0:!1)));if(lastCheckTick=GetTickCount(),l=GetNsPluginWsUrl(),isNull(l)||l.length<1)return PutToDebugLog("ERROR, IsServiceInstalled win failed, address list is empty"),ExecSrvInstalledCallback(!1),!1;var u=l[0],h="",g="",m=!1;l.length>1&&(h=l[1]),l.length>2&&(g=l[2]),CanLog(2)&&PutToDebugLog(2,"EVENT, IsServiceInstalled url_1: "+u);try{wsocket&&wsocket.close&&wsocket.close(),wsocket=null,wsocket=new WebSocket(u),wsocket.binaryType="arraybuffer",wsocket.onopen=function(){ws1ready=!0,wready=!0,i(wsocket,1,u)},wsocket.onclose=function(){a(1)},wsocket.onerror=function(e){r(1,e),n("onerror")},wsocket.onmessage=function(e){s(1,e)},m=!0}catch(b){PutToDebugLogException(2,"IsServiceInstalled failed to connect to: "+u,b),n("onexception")}isNull(wstimer1)||clearTimeout(wstimer1),wstimer1=setTimeout(function(){ws1ready||n("ontimer")},srvinstalled_timeout);var d=!1}catch(_){return PutToDebugLogException(2,"common: ServiceInstalled",_),e&&"function"==typeof e&&e(!1),!1}}function ExecSrvInstalledCallback(e){try{if(void 0===srvinstalled_callback||null===srvinstalled_callback||srvinstalled_callback.length<1)return;for(;srvinstalled_callback.length>0;)try{var t=srvinstalled_callback.shift();if("function"!=typeof t||null===t)continue;t(e)}catch(n){PutToDebugLogException(2,"common: ExecSrvInstalledCallback inner while",n)}}catch(n){PutToDebugLogException(2,"common: ExecSrvInstalledCallback",n)}srvinstalled_callback=null,srvinstalled_callback=[]}function ServiceStartPolling(){try{if(stopPolling)return;PutToDebugLog(5,"EVENT, common: ServiceStartPolling"),IsServiceInstalled(function(e){webphone_api.global.phonestarted<3&&(!1===e?setTimeout(function(){ServiceStartPolling()},1e3):(SaveParameter("lastusedengine","ns"),webphone_api.startInner(),!1===IsSDK()&&webphone_api.$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"})))},!0)}catch(e){PutToDebugLogException(2,"common: ServiceStartPolling",e)}}function ApplyParameters(e){try{if(!isNull(e)){var t;for(t in e)if(!isNull(t)&&t.length>0&&!isNull(e[t])){if("loglevel"===t&&!1===ParameterIsDefault("loglevel"))continue;var n=t;"aec"===n?n="aec_orig":"agc"===n?n="agc_orig":"denoise"===n?n="denoise_orig":"plc"===n?n="plc_orig":"sippassword"===n&&(n="password");var o=Trim(e[t]);0===o.indexOf("encrypted__3__")&&(o=StrDc(o,GetPassphrase())),webphone_api.setparameter(n,o),"serveraddress"===t?(SaveParameter("serveraddress_user",o),"true"===GetParameter("serverinputisupperserver")?SaveParameter("upperserver",o):SaveParameter("serveraddress_orig",o)):SaveParameter(t,o)}}}catch(i){PutToDebugLogException(2,"common: ApplyParameters",i)}}function GetEngineDisplayName(e){var t="";try{if(isNull(e)||e.length<1)return"";switch(e){case"java":t="Java";break;case"ns":t="NS - Service Plugin";break;case"webrtc":t="WebRTC";break;case"flash":t="Flash";break;case"app":t="App - Native Application";break;case"p2p":t="Phone to Phone";break;case"accessnum":t="Access Number";break;case"nativedial":t="Native Dialer";break;case"otherbrowser":t="Alternate Browser";break;default:t="Engine"}return t}catch(n){PutToDebugLogException(2,"common: GetEngineDisplayName",n)}return""}function ChooseEngineLogic2(e){try{if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return;if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, ChooseEngineLogic2 invalid engine");if("java"===e)return void(IsJavaInstalled()<1&&InstallJavaPopup(!0));if("ns"!==e)return;var t=GetEngine("ns");t.isinstalled_cache<0?IsServiceInstalled(function(e){!1===e&&NPDownloadAndInstall()},!0):0===t.isinstalled_cache&&NPDownloadAndInstall()}catch(n){PutToDebugLogException(2,"common: ChooseEngineLogic2",n)}}function ChooseEngineLogic(e,t){try{if(CanLog(4)&&PutToDebugLog(4,"EVENT, ChooseEngineLogic; isstart: "+t),!1===Glsp())return void PutToDebugLog(2,"WARNING, ChooseEngineLogic wait");var n=[];if(n.push("E"),n.push("R"),n.push("R"),n.push("O"),n.push("R"),n.push(","),n.push(" "),n.push("T"),n.push("h"),n.push("e"),n.push(" "),n.push("B"),n.push("a"),n.push("s"),n.push("i"),n.push("c"),n.push(" "),n.push("v"),n.push("e"),n.push("r"),n.push("s"),n.push("i"),n.push("o"),n.push("n"),n.push(" "),n.push("o"),n.push("f"),n.push(" "),n.push("W"),n.push("e"),n.push("b"),n.push("p"),n.push("h"),n.push("o"),n.push("n"),n.push("e"),n.push(" "),n.push("d"),n.push("o"),n.push("e"),n.push("s"),n.push(" "),n.push("n"),n.push("o"),n.push("t"),n.push(" "),n.push("s"),n.push("u"),n.push("p"),n.push("p"),n.push("o"),n.push("r"),n.push("t"),n.push(" "),n.push("["),n.push("B"),n.push("R"),n.push("S"),n.push("]"),n.push(" "),n.push("b"),n.push("r"),n.push("o"),n.push("w"),n.push("s"),n.push("e"),n.push("r"),n.push("_"),Glv()<=0&&"Chrome"===GetBrowser()){var o=n.join("");return o=o.replace("[BRS]",GetBrowser()),setTimeout(function(){PutToDebugLog(1,o)},1400),setTimeout(function(){PutToDebugLog(1,o.replace("ERROR","STATUS"))},2400),setTimeout(function(){AlertDialog("",o)},2400),void e(!1)}if(Glv()<=0&&!1===CanIUseApplet()){var o=n.join("");return o=o.replace("[BRS]",GetBrowser()),setTimeout(function(){PutToDebugLog(1,o)},1450),setTimeout(function(){PutToDebugLog(1,o.replace("ERROR","STATUS"))},2450),setTimeout(function(){AlertDialog("",o)},2450),void e(!1)}var i="",a=GetSelectedEngine(),r=GetRecommendedEngine();if(!isNull(a)&&a.name===webphone_api.global.ENGINE_SERVICE&&-3===GetMinServiceVersion())return PutToDebugLog(2,"EVENT, ChooseEngineLogic: "+a.name+"; install popup is disabled by minserviceversion: "+GetMinServiceVersion().toString()),void e();if(!0===t){var s=GetSinglePossibleEngine(),l="";if(isNull(a)||(l=a.name),s.length>0&&!MightUseEngine(s)&&(s=""),l.length>0&&!MightUseEngine(l)&&(l=""),l!==s);else{if(l===webphone_api.global.ENGINE_APP||s===webphone_api.global.ENGINE_APP)return GetParameterInt("enginepriority_app",2)<1?void(!0===webphone_api.global.usestorage||Strl(60)?(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_app_engine1")),AlertDialog("Warning",webphone_api.stringres.get("only_app_engine1"))):(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_app_engine2")),AlertDialog("Warning",webphone_api.stringres.get("only_app_engine2")))):(PutToDebugLog(2,"EVENT, Selected only possible engine: "+webphone_api.global.ENGINE_APP),selected_engine=GetEngine(webphone_api.global.ENGINE_APP),void e());if(l===webphone_api.global.ENGINE_SERVICE||s===webphone_api.global.ENGINE_SERVICE){var p=GetParameterInt("enginepriority_ns",2);return p<1?void("Windows"===GetOs()&&l===webphone_api.global.ENGINE_JAVA?(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine3")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine3"))):!0===webphone_api.global.usestorage||Strl(60)?(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine1")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine1"))):(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine2")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine2")))):(PutToDebugLog(2,"EVENT, Selected only possible engine: "+webphone_api.global.ENGINE_SERVICE),selected_engine=GetEngine(webphone_api.global.ENGINE_SERVICE),e(),void(5!==p&&IsServiceInstalled(function(e){if(!1===e){var t=GetParameterBool("wpfirststart",!0),n=GetParameterInt("prev_sess_failed",0);(!0===t||n<1||n>1)&&(PutToDebugLog(2,"EVENT, common: ChooseEngineLogic, install service: "+GetMinServiceVersion().toString()),EngineForcedInstall("ns"))}},!0)))}if(l===webphone_api.global.ENGINE_JAVA&&0==CanIUseApplet()&&s===webphone_api.global.ENGINE_WEBRTC&&GetParameterInt("enginepriority_java",2)>GetParameterInt("enginepriority_webrtc",2)+1)return void("Windows"===GetOs()?(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine3")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine3"))):(PutToDebugLog(1,"WARNING,"+webphone_api.stringres.get("only_ns_engine4")),AlertDialog("Warning",webphone_api.stringres.get("only_ns_engine4"))))}}var c=-1,u=-1,h="",g="",m="";!0!==IsSDK()&&(m=webphone_api.$.mobile.activePage.attr("id"));var d=m.indexOf("page_");if(d>=0&&(m=m.substring(d+5)),isNull(a)||(c=a.pushlevel,h=a.name),isNull(r)||(u=r.pushlevel,g=r.name),PutToDebugLog(4,"EVENT, ChooseEngineLogic selected engine> "+h+" pushlevel: "+c),PutToDebugLog(4,"EVENT, ChooseEngineLogic recommended engine> "+g+" pushlevel: "+u),PutToDebugLog(4,"EVENT, ChooseEngineLogic active page: "+m),webphone_api.global.isdebugengine&&(c=3,u=3,h="ns",g="webrtc"),"Android"!==GetOs()&&"iOS"!==GetOs()||"app"===h&&(isNull(g)||g.length<1)&&(c=6),c<3&&u<3)return PutToDebugLog(4,"EVENT, ChooseEngineLogic return callback"),void e(!1);var b=GetNPLocation(),_='<a href="'+b+'" target="_blank" id="adialog_nativeplugin">'+webphone_api.stringres.get("nativeplugin")+"</a>";PutToDebugLog(5,"EVENT, common ChooseEngineLogic nplink: "+_);var f=webphone_api.stringres.get("ce_installnativeplugin");f=f.replace("[NATIVE_PLUGIN]",_);var w=!1,v=!1,P='Enable Java in your browser or enable from the settings( <a href="'+webphone_api.global.ENABLE_JAVA_URL+'" id="click_enable_java" target="_blank">How to enable Java ?</a>)',E='Install Java from <a href="'+webphone_api.global.INSTALL_JAVA_URL+'" id="click_install_java" target="_blank">here.</a>',T='<a href="'+GetNPLocation()+'" target="_blank" id="adialog_nativeplugin">Install '+webphone_api.stringres.get("nativeplugin")+"</a>",N="For best experience: ",S='<a href="javascript:;" id="click_use_webrtc" target="_blank">Use WebRTC.</a>',I='Use <a href="[BWURL]" id="click_use_alternatebrowser" target="_blank">alternate browser.</a>',C="",R='Use <a href="javascript:;" id="click_use_p2p">phone to phone</a> server initiated call.',G='Call <a href="javascript:;" id="click_use_accessnumber">access number</a> using native dialer.',y='<a href="javascript:;" id="click_use_internetexplorer">use Internet Explorer</a>';if("iOS"===GetOs()){var L=GetParameter("ios_nativedialerurl");if((isNull(L)||L.length<3)&&(L="https://itunes.apple.com/ro/app/mizuphone/id483685573"),i="",("Safari"===GetBrowser()||"iPhone"===GetBrowser())&&GetBrowserVersion()<11)i="&SmallCircle; "+webphone_api.stringres.get("ce_native_ios_safari")+' <a href="javascript:;" id="click_use_app">'+webphone_api.stringres.get("ce_native_ios2")+"</a><br /><br />";else{try{var O=webphone_api.platform.os;if(!isNull(O)&&O.length>0&&(O=Trim(O),O.indexOf(" ")>0)){O=O.substring(O.indexOf(" ")+1),O.indexOf(".")>0&&(O=O.substring(0,O.indexOf("."))),O=Trim(O);var D=StrToIntDef(O,-1);D>0&&D>=11&&(i="&SmallCircle; "+webphone_api.stringres.get("ce_native_ios_not_safari")+' <a href="javascript:;" id="click_use_app">'+webphone_api.stringres.get("ce_native_ios2")+"</a><br /><br />")}}catch(U){PutToDebugLogException(2,"common: ChooseEngineLogic inner iOS",U)}i.length<1&&(i="&SmallCircle; "+webphone_api.stringres.get("ce_native_ios_safari")+' <a href="javascript:;" id="click_use_app">'+webphone_api.stringres.get("ce_native_ios2")+"</a><br /><br />")}}else if("Android"===GetOs()){if(GetBrowserVersion()<40){if(GetParameterInt("enginepriority_otherbrowser",2)>0){var x=GetConfig("android_aletrnatebrowserurl");(isNull(x)||x.length<5)&&(x=webphone_api.global.android_aletrnatebrowserurl_DEF),i=i+"&SmallCircle; "+webphone_api.stringres.get("ce_browser_install")+' <a href="'+x+'" target="_blank">'+webphone_api.stringres.get("ce_browser_alternate")+"</a>",i+="<br /><br />"}}else i=i+'&SmallCircle; <a href="javascript:;" id="click_use_webrtc">'+webphone_api.stringres.get("ce_usewebrtc")+"</a>",-1==webphone_api.global.recwsload&&(webphone_api.global.recwsload=GetParameter("lastrecwsload",-2)),webphone_api.global.recwsload>2&&(i=i+" "+webphone_api.stringres.get("ce_webrtcnot")),i+="<br /><br />";"app"===h&&GetParameterInt("enginepriority_app",2)>0&&(i=i+'&SmallCircle; <a href="javascript:;" id="click_use_app">'+webphone_api.stringres.get("ce_native_android")+"</a>")}else{if(3===c||4===c||5===c||6===c){if("java"===h){var A=IsJavaInstalled();0===A?(6===c&&(w=!0),"MSIE"===GetBrowser()&&(i=i+P+" OR "),i=i+E+"<br><br>"):1===A&&(6===c&&(w=!0),i=i+P+"<br><br>")}else if("ns"!==h||webphone_api.global.isdebugengine)if("otherbrowser"===h){var x="";x=GetParameter("Windows"===GetOs()?"pc_alternatebrowserurl":"pc_alternatebrowserurl"),I=I.replace("[BWURL]",x),i+=N,i=i+I+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>"}else"p2p"===h?i=i+R+"<br><br>":"accessnum"===h&&(i=i+G+"<br><br>");else!isNull(selected_engine)&&selected_engine.isinstalled_cache<2?(6===c&&(w=!0),i=i+T+"<br><br>"):e(!1);"Edge"===GetBrowser()&&(i+=N,i=i+y+"<br><br>")}if(3===u||4===u||5===u||6===u){if(6===u&&(w=!0),3===u&&"settings"!==m)return void UserChooseEnginePopup(i,w,v,e);if("true"===GetParameter("ignoreengineselect"))return void UserChooseEnginePopup(i,w,v,e);var k=GetEngineDisplayName(h);if(C=k.length>0?C.replace("[ENGINE]",k):"",v=!0,"java"===g){var A=IsJavaInstalled();0===A?"MSIE"===GetBrowser()?(i+=N,i=i+P+" OR ",i=i+E+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>"):(i+=N,i=i+E+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>"):1===A&&(i+=N,i=i+P+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>")}else if("ns"===g)recommend_engine.isinstalled_cache<2&&(i+=N,i=i+T+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>");else if("webrtc"===g)i=i+S+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>";else if("app"===g){if(GetParameterInt("enginepriority_otherbrowser",2)>0){var x="";x=GetParameter("Windows"===GetOs()?"pc_alternatebrowserurl":"pc_alternatebrowserurl"),I=I.replace("[BWURL]",x),i+=N,i=i+I+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>"}}else"p2p"===g?i=i+R+"<br><br>":"accessnum"===g?i=i+G+"<br><br>":"nativedial"===g&&(i+='Direct call with <a href="javascript:;" id="click_use_nativedialer">native dialer</a>.<br><br>');"Edge"===GetBrowser()&&i.indexOf(y)<1&&(i+=N,i=i+y+"<br><br>")}}webphone_api.global.isdebugengine&&(C=C.replace("[ENGINE]","JAVA"),i=E+"<br><br>",i+=N,i=i+T+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>",i+=N,i=i+S+"<br>",C.length>0&&(i=i+C.replace("[ENGINE]",k)+"<br>"),i+="<br>",x=GetParameter("pc_alternatebrowserurl"),I=I.replace("[BWURL]",x),i+=N,i=i+I+"<br><br>",i=i+R+"<br><br>",i+=N,i=i+y+"<br><br>",w=!0,v=!1),UserChooseEnginePopup(i,w,v,e)}catch(V){PutToDebugLogException(2,"common: ChooseEngineLogic",V)}}function UserChooseEnginePopupSDK(e,t,n,o,i){try{PutToDebugLog(4,"EVENT, UserChooseEnginePopupSDK");var a=!1;if(isNull(e)||e.length<2)return void o(!1);var r='<span style="width: 100%; display: inline-block; background: #eeeeee; padding-top: 1.2em; padding-bottom: 1.2em;">',s="",l=e.split("<br><br>"),p=0;if(!isNull(l)&&l.length>0)for(var c=0;c<l.length;c++)isNull(l[c])||l[c].length<3||(s+='<div style="margin:0; padding:0; border:0; width:100%; height: .1em; clear:both; background: #dddddd;">\x3c!--//--\x3e</div>',s=s+r+"&nbsp;&nbsp;&nbsp;"+l[c]+"</span>",p++);else s=r+"&nbsp;&nbsp;&nbsp;"+e+"</span>";var u=webphone_api.stringres.get("choose_engine_title");p<2&&(u=webphone_api.stringres.get("choose_engine_title_single_engine")),s='<div id="adialog_formattedmsg" style="display: inline-block; width: 100%;">'+s+"</div>";var h="";if(h='<div id="checkbox_ignore_container" style="width: 100%; background: #eeeeee; height: 3.5em; line-height: 3.5em; border-top: .1em solid #dddddd; border-bottom: .1em solid #dddddd; text-align: right;"><label for="checkbox_ignore">'+webphone_api.stringres.get("ce_dontask")+'&nbsp;&nbsp;</label><input name="checkbox_ignore" id="checkbox_ignore" type="checkbox">&nbsp;&nbsp;&nbsp;</div>',!isNull(cemodal))return void cemodal.show();cemodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container" style="height: 100%;"><div id="ce_modal_header" class="pmodal_header">'+u+'</div><div id="ce_modal_content" class="pmodal_content"><div id="ce_modal_content_inner">'+s+"</div>"+h+'</div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_adialog">'+webphone_api.stringres.get("btn_close")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{width:"20em"},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){try{var t=webphone_api.$("#ce_modal").height()-webphone_api.$("#ce_modal_header").height()-webphone_api.$("#ce_modal_footer").height()-1;webphone_api.$("#ce_modal_content").height(t),webphone_api.$("#ce_modal_content_inner").height(t-webphone_api.$("#checkbox_ignore_container").height()-5);var n=webphone_api.$("#ce_modal_content_inner").height()-webphone_api.$("#adialog_formattedmsg").height();webphone_api.$("#adialog_formattedmsg").css("margin-top",n/2)}catch(o){PutToDebugLogException(2,"common: UserChooseEnginePopupSDK afterShow",o)}}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),cemodal=null,(!1===a||"MSIE"===GetBrowser()&&IsJavaInstalled()<2||"flash"===GetSelectedEngineName())&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback onclose"),a=!0,EngineSelect(1,7),o(!0))}),cemodal.show(),t&&webphone_api.$("#ce_modal_footer").hide(),webphone_api.$("#checkbox_ignore").on("change",function(e){webphone_api.$(this).prop("checked")?SaveParameter("ignoreengineselect","true"):SaveParameter("ignoreengineselect","false")}),webphone_api.$("#click_use_alternatebrowser").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close()}),webphone_api.$("#click_enable_java").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e)}),webphone_api.$("#click_install_java").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e),setTimeout(function(){InstallJavaPopup(!1)},400)}),webphone_api.$("#adialog_nativeplugin").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("ns");e.clicked=2,SetEngine("ns",e),setTimeout(function(){NPDownloadAndInstall()},400);var t=GetNPLocation();!isNull(t)&&t.length>0&&window.open(t)}),webphone_api.$("#click_use_webrtc").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!0,cemodal.close(),ResetEngineClicked();var e=GetEngine("webrtc");e.clicked=2,SetEngine("webrtc",e),EngineSeengineprioritylect(1),o(!0)}),webphone_api.$("#click_use_p2p").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("p2p");e.clicked=2,SetEngine("p2p",e),EngineSelect(1,8),o(!0)}),webphone_api.$("#click_use_accessnumber").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("accessnum");e.clicked=2,SetEngine("accessnum",e),EngineSelect(1,9),o(!0)}),webphone_api.$("#click_use_nativedialer").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("nativedial");e.clicked=2,SetEngine("nativedial",e),
EngineSelect(1,10),o(!0)}),webphone_api.$("#click_use_app").on("click",function(){SaveParameter("allow_start_app_engine","1"),a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("app");e.clicked=2,SetEngine("app",e),StartAppEngine(!1,"")}),webphone_api.$("#click_use_internetexplorer").on("click",function(){a=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close()}),webphone_api.$("#btn_close_adialog").on("click",function(){PutToDebugLog(5,"EVENT, common UserChooseEngineSDK close on click"),cemodal.close(),(t||!1===a)&&(PutToDebugLog(3,"EVENT, UserChooseEngineSDK callback"),EngineSelect(1,11),a=!0,o(!0))})}catch(g){PutToDebugLogException(2,"common: UserChooseEnginePopupSDK",g)}}function UserChooseEnginePopup(e,t,n,o,i){try{PutToDebugLog(2,"EVENT, UserChooseEnginePopup message: "+e);var a=GetBrowserVersion();if("java"===GetSelectedEngineName()&&"Chrome"===GetBrowser()&&StrToIntDef(a,70)>webphone_api.getmaxchromeversionforjava()){PutToDebugLog(2,"EVENT,"+webphone_api.stringres.get("jnotsupported")+"_1"),e=webphone_api.stringres.get("jnotsupported");var r=GetConfig("pc_alternatebrowserurl");return!isNull(r)&&r.length>2&&(e=e+': <a href="'+r+'" target="_blank">'+r+"</a>"),AlertDialog("Warning",e),void o(!1)}var s=!1;if("true"===GetParameter("ignoreengineselect"))return void o(!1);if(isNull(e)||e.length<2)return void o(!1);if(1==IsSDK())return void UserChooseEnginePopupSDK(e,t,n,o,i);SaveParameter("enproblem","1"),PutToDebugLog(4,"EVENT, UserChooseEnginePopup");var l="",p=e.split("<br><br>"),c=0;if(!isNull(p)&&p.length>0)for(var u=0;u<p.length;u++)isNull(p[u])||p[u].length<3||(l+='<div class="separator_line_chooseengine">\x3c!--//--\x3e</div>',l=l+"<span>&nbsp;&nbsp;&nbsp;"+p[u]+"</span>",c++);else l="<span>&nbsp;&nbsp;&nbsp;"+e+"</span>";var h=webphone_api.stringres.get("choose_engine_title");c<2&&(h=webphone_api.stringres.get("choose_engine_title_single_engine")),l='<div id="adialog_formattedmsg" style="display: inline-block; width: 100%;">'+l+"</div>";var g="";n&&!t&&(g='<div id="checkbox_ignore_container"><label for="checkbox_ignore">'+webphone_api.stringres.get("ce_dontask")+'</label><input name="checkbox_ignore" id="checkbox_ignore" type="checkbox"></div>');var m=GetDeviceWidth();(isNull(m)||m<10)&&(m=220);var d='<div data-role="popup" id="choose_engine" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+m+"px; width:"+m+"px; margin=0; float:left; height="+GetDeviceHeight()+'px;"><div data-role="header" data-theme="b" id="choose_engine_header"><h1 class="adialog_title" style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+h+'</h1></div><div role="main" id="choose_engine_container" class="ui-content adialog_content adialog_alert"><div id="choose_engine_top_section" style="margin: 0em;"><div id="chooseengine_spacer" style="display: inline-block; width: 100%;">&nbsp;</div>'+l+"</div>"+g+'</div><div data-role="footer" data-theme="b" class="adialog_footer" id="choose_engine_footer"><a href="javascript:;" id="adialog_positive" style="width: 100%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_close")+"</a></div></div>";i=i||function(){},webphone_api.$.mobile.activePage.append(d).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").popup({beforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).css({width:window.innerWidth,height:window.innerHeight-10}),t&&webphone_api.$("#choose_engine_footer").hide();var e=GetDeviceHeight()-webphone_api.$("#choose_engine_header").height();webphone_api.$("#choose_engine_footer").is(":visible")&&(e-=webphone_api.$("#choose_engine_footer").height()),e=Math.floor(e),webphone_api.$(".messagePopup .ui-content").height(e-Math.floor(.015*e)),webphone_api.$(".messagePopup .ui-content").css({padding:0,margin:0,background:"#ffffff"})},afteropen:function(e,t){webphone_api.$(this).parent().css({top:0,left:0,position:"absolute"});var n=webphone_api.$("#choose_engine_container").height()-20;isNull(document.getElementById("checkbox_ignore_container"))||(n-=webphone_api.$("#checkbox_ignore_container").height()),document.getElementById("choose_engine_top_section").style.height=n+"px";var o=n-webphone_api.$("#adialog_formattedmsg").height();document.getElementById("chooseengine_spacer").style.height=Math.floor(o/2)+"px"}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),i(),(!1===s||"MSIE"===GetBrowser()&&IsJavaInstalled()<2||"flash"===GetSelectedEngineName())&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback onclose"),EngineSelect(1,12),s=!0,o(!0))}}),webphone_api.$("#checkbox_ignore").on("change",function(e){webphone_api.$(this).prop("checked")?SaveParameter("ignoreengineselect","true"):SaveParameter("ignoreengineselect","false")}),webphone_api.$("#click_use_alternatebrowser").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$("#click_enable_java").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e)}),webphone_api.$("#click_install_java").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e),webphone_api.$("#choose_engine").on("popupafterclose",function(e){OpenSettings(!0,5),setTimeout(function(){InstallJavaPopup(!1)},400)})}),webphone_api.$("#adialog_nativeplugin").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.$("#choose_engine").on("popupafterclose",function(e){ResetEngineClicked();var t=GetEngine("ns");t.clicked=2,SetEngine("ns",t),setTimeout(function(){NPDownloadAndInstall()},400);var n=GetNPLocation();!isNull(n)&&n.length>0&&window.open(n)})}),webphone_api.$("#click_use_webrtc").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!0,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("webrtc");e.clicked=2,SetEngine("webrtc",e),EngineSelect(1,13),o(!0)}),webphone_api.$("#click_use_p2p").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("p2p");e.clicked=2,SetEngine("p2p",e),EngineSelect(1,14),o(!0)}),webphone_api.$("#click_use_accessnumber").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("accessnum");e.clicked=2,SetEngine("accessnum",e),EngineSelect(1,15),o(!0)}),webphone_api.$("#click_use_nativedialer").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("nativedial");e.clicked=2,SetEngine("nativedial",e),EngineSelect(1,16),o(!0)}),webphone_api.$("#click_use_app").on("click",function(){SaveParameter("allow_start_app_engine","1"),s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("app");e.clicked=2,SetEngine("app",e),StartAppEngine(!1,"")}),webphone_api.$("#click_use_internetexplorer").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common UserChooseEngine close on click"),(t||!1===s)&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback"),EngineSelect(1,17),s=!0,o(!0))})}catch(b){PutToDebugLogException(2,"common: UserChooseEnginePopup",b)}}function AppEngineClick(){try{alert("AppEngineClick")}catch(e){PutToDebugLogException(2,"common: AppEngineClick",e)}}function ShowEngineOptionOnPage(e){try{if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return void e("","");if("true"===GetParameter("ignoreengineselect"))return void e("","");if(isNull(GetSelectedEngine())&&semaxloop<10)return setTimeout(function(){ShowEngineOptionOnPage(e)},500),void semaxloop++;semaxloop=0;var t=GetSelectedEngine(),n=GetRecommendedEngine(),o=-1,i=-1,a="",r="";isNull(t)||(o=t.pushlevel,a=t.name),isNull(n)||(i=n.pushlevel,r=n.name);var s="Engine is [XXX]. Click here if wish to use [YYY].",l="";webphone_api.global.useengine.length>0&&a.length>0&&webphone_api.global.useengine!==a&&2===o?(l=s.replace("[XXX]",GetEngineDisplayName(webphone_api.global.useengine)),l=l.replace("[YYY]",GetEngineDisplayName(a)),e(l,a)):webphone_api.global.useengine.length>0&&r.length>0&&webphone_api.global.useengine!==r&&2===i&&(l=s.replace("[XXX]",GetEngineDisplayName(webphone_api.global.useengine)),l=l.replace("[YYY]",GetEngineDisplayName(r)),e(l,r))}catch(p){PutToDebugLogException(2,"common: ShowEngineOptionOnPage",p)}e("","")}function GatewayFailower(e,t){try{if(gwround++,PutToDebugLog(2,"EVENT,GatewayCheck called: "+t+" ("+gwround+")"),getuseengine()!==webphone_api.global.ENGINE_WEBRTC)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not WebRTC ("+gwround+")");if(!1===webphone_api.global.canfailover_gateway)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because already failowered once in this session ("+gwround+")");if(!1===IsMizuPublicWebRTCGateway())return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not Mwebrtc gateway ("+gwround+")");isNull(fail_timer)||clearTimeout(fail_timer),fail_timer=null,e<0&&(e=8e3),PutToDebugLog(2,"EVENT,GatewayCheck started checking, delay: "+e.toString()+" ("+gwround+")"),webphone_api.global.canfailover_gateway=!1,fail_timer=setTimeout(function(){try{if("us"===webphone_api.global.usuk&&!1===webphone_api.global.wsl_uk_rec||"uk"===webphone_api.global.usuk&&!1===webphone_api.global.wsl_us_rec)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because no answers for wsload, UK: "+webphone_api.global.wsl_uk_rec+"; US: "+webphone_api.global.wsl_us_rec+" ("+gwround+")");if(!1===IsMizuPublicWebRTCGateway())return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not Mwebrtc gateway from timer ("+gwround+")");if(isNull(webphone_api.global.usuk)||webphone_api.global.usuk.length<1)return void PutToDebugLog(2,"ERROR,skip GatewayCheck failower usuk NOT defined ("+gwround+")");var e=GetWsAddressCfg(1);if(!isNull(e)&&e.length>3){var t=StrDc(wip_uk,alsvkey),n=StrDc(wips_uk,alsvkey),o=StrDc(wip_us,alsvkey),i=StrDc(wips_us,alsvkey);if(t.indexOf(e)>=0||n.indexOf(e)>=0||o.indexOf(e)>=0||i.indexOf(e)>=0)return void PutToDebugLog(2,"EVENT,GatewayCheck do NOT failower because gateway address is set manually ("+gwround+")")}!0===webphone_api.global.failover_gateway&&!0===NeedRegister()?(webphone_api.global.failover_gateway=!1,selectedwserver="","uk"===webphone_api.global.usuk?webphone_api.global.usuk="us":webphone_api.global.usuk="uk",isNull(webphone_api.global.worktimer)||(clearTimeout(webphone_api.global.worktimer),webphone_api.global.worktimer=null),PutToDebugLog(2,"EVENT, mlogic API_Unregister GatewayCheck ("+gwround+")"),PutToDebugLog(2,"ERROR,GatewayCheck  failower to: "+webphone_api.global.usuk+" ("+gwround+")"),!isNull(wssocket)&&wssocket.close&&wssocket.close(),wssocket=null,PutToDebugLog(2,"EVENT, mlogic API_Start GatewayCheck ("+gwround+")"),webphone_api.start()):PutToDebugLog(2,"EVENT,skip GatewayCheck because failover_gateway: "+webphone_api.global.failover_gateway.toString()+"; NeedRegister: "+NeedRegister()+" ("+gwround+")")}catch(a){PutToDebugLogException(2,"common: GatewayCheck inner timer",a)}},e)}catch(n){PutToDebugLogException(2,"common: GatewayCheck",n)}}function CheckEngineFirstStart(e){try{if(isNull(isWebphoneFirstStart)&&(isWebphoneFirstStart=GetParameterBool("wpfirststart",!1)),!1===isWebphoneFirstStart)return;isWebphoneFirstStart=!1,isNull(cestimer)||clearTimeout(cestimer),cestimer=setTimeout(function(t){try{if(getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.iswebrtcengineworking<1&&!0===CanIUseService()){var n=StrToInt(GetParameter2("enginepriority_webrtc")),o=StrToInt(GetParameter2("enginepriority_ns"));if(n<5&&n<=o){IsCurrentEngineWorking(e,1,!0);var i=GetParameter2("serveraddress");(isNull(i)||i.length<2||"YOURSIPDOMAIN.COM"===i||"YOURSIPSERVER.COM"===i||"SIPSERVER"===i||"VOIPSERVER"===i||"SERVERADDRESS"===i)&&(SaveParameter("serveraddress",""),i=GetParameter2("serveraddress_user"),(isNull(i)||i.length<2||"YOURSIPDOMAIN.COM"===i||"YOURSIPSERVER.COM"===i||"SIPSERVER"===i||"VOIPSERVER"===i||"SERVERADDRESS"===i)&&("undefined"!=typeof webphone_api.global.worktimer&&null!==webphone_api.global.worktimer&&clearTimeout(webphone_api.global.worktimer),webphone_api.global.worktimer=null))}}}catch(a){PutToDebugLogException(2,"common: CheckEngineFirstStart Inner Timer",a)}},4e3)}catch(t){PutToDebugLogException(2,"common: CheckEngineFirstStart",t)}}function IsCurrentEngineWorking(e,t,n){try{if((isNull(t)||!1===IsNumber(t))&&(t=25e3,GetTickCount()-lastcalledtick<2500))return;lastcalledtick=GetTickCount(),isNull(webphone_api.global.worktimer)||clearTimeout(webphone_api.global.worktimer),paramcache=e,webphone_api.global.iscurrengineworking=!1,webphone_api.global.lastengine_working_ok="",webphone_api.global.worktimer=setTimeout(function(e){try{if(HandleCalldivert(),"app"===getuseengine()||"p2p"===getuseengine()||"accessnum"===getuseengine()||"nativedial"===getuseengine()||"otherbrowser"===getuseengine())return;if(webphone_api.global.phonestarted>2&&(SaveParameter("wpfirststart","false"),PutToDebugLog(2,"EVENT, Save wpfirststart = false")),webphone_api.global.useengine===webphone_api.global.ENGINE_WEBRTC&&!1===backupserver_tried&&1===webphone_api.global.webrtcsocketconnected&&0===webphone_api.global.webrtcsipsignalingreceived){var t=GetParameter("backupserver");if(!isNull(t)&&t.length>0){var o=GetUDPServerAddress();return SaveParameter("serveraddress_user",t),SaveParameter("backupserver",o),backupserver_tried=!0,PutToDebugLog(2,"WARNING, common: IsCurrentEngineWorking: trying to register using backupserver: "+GetUDPServerAddress()),void webphone_api.startInner(e)}}if(!1===webphone_api.global.iscurrengineworking){PutToDebugLog(3,"ERROR, common: IsCurrentEngineWorking "+getuseengine()+"> NOT WORKING no SIP signaling received from server");var i=GetEngine(webphone_api.global.useengine),a=GetParameterBool("wpfirststart",!0),r=GetParameterInt("prev_sess_failed",0);if(!0===a||r<1||(EngineSelect(1,18),isNull(i)||("Linux"!==GetOs()&&"Mac"!==GetOs()||!1!==CanIUseService()||0!=CanIUseApplet())&&(i.failed=1,SetEngine(webphone_api.global.useengine,i))),SaveParameter("prev_sess_failed",(r+1).toString()),!1===a){var s=GetSelectedEngineName();EngineSelect(1,19);var l=GetSelectedEngineName();if(s!==l){var p=GetParameterInt("enginepriority_"+s,2),c=GetParameterInt("enginepriority_"+l,2);if(s!==webphone_api.global.ENGINE_WEBRTC&&s!==webphone_api.global.ENGINE_SERVICE||l!==webphone_api.global.ENGINE_WEBRTC&&l!==webphone_api.global.ENGINE_SERVICE){if(l!==webphone_api.global.ENGINE_WEBRTC&&l!==webphone_api.global.ENGINE_SERVICE&&p>=c)return void PutToDebugLog(2,"WARNING, IsCurrentEngineWorking, NO engine switch because of priority HIGHER or EQUAL from: "+s+"("+p.toString()+") to: "+l+"("+c.toString()+")")}else if(p>c)return void PutToDebugLog(2,"WARNING, IsCurrentEngineWorking, NO engine switch because of priority HIGHER from: "+s+"("+p.toString()+") to: "+l+"("+c.toString()+")")}}if(2===webphone_api.global.useengineclicked_cache||!0===n){webphone_api.global.useengineclicked_cache=1;var u=webphone_api.stringres.get("ce_ask_user"),h=GetSelectedEngineName();u=u.replace("[SELECTEDENGINE]",GetEngineDisplayName(h)),PutToDebugLog(2,"WARNING, IsCurrentEngineWorking: "+u),EngineSelect(1,20),ChooseEngineLogic(function(t){if(!1===t){var n=GetSelectedEngineName();if(u=u.replace("[RECOMMENDED]",GetEngineDisplayName(n)),PutToDebugLog(2,"WARNING, IsCurrentEngineWorking 2: "+u),isNull(h)||h.length<1||isNull(n)||n.length<1||h===n)return PutToDebugLog(2,"ERROR, IsCurrentEngineWorking invalid message to be displayed: "+u+" reset useengine"),webphone_api.global.useengine="",void webphone_api.plhandler.StartUp(e);if(!0!==confirm(u))return PutToDebugLog(2,"WARNING, user denied recommended engine failback"),void IsCurrentEngineWorking(e);PutToDebugLog(2,"EVENT, user confirmed recommended engine failback reset useengine"),webphone_api.global.useengine="",webphone_api.plhandler.StartUp(e)}else webphone_api.plhandler.StartUp(e)},!0)}else PutToDebugLog(2,"WARNING, IsCurrentEngineWorking just start webphone"),webphone_api.startInner(e)}else webphone_api.global.lastengine_started_ok=webphone_api.global.useengine,webphone_api.global.lastengine_working_ok=webphone_api.global.useengine,PutToDebugLog(3,"EVENT, this engine is working: "+webphone_api.global.useengine),"java"!==webphone_api.global.useengine&&"ns"!==webphone_api.global.useengine&&"webrtc"!==webphone_api.global.useengine||SaveParameter(webphone_api.global.useengine+"_worked","true"),"ns"===webphone_api.global.useengine&&HandleServiceBuildUpgrade(),setTimeout(function(){webphone_api.global.isencrypted=webphone_api.isencrypted()},3e3)}catch(g){PutToDebugLogException(2,"common: IsCurrentEngineWorking timer",g)}},t)}catch(o){PutToDebugLogException(2,"common: IsCurrentEngineWorking",o)}}function InstallJavaPopupSDK(e,t){try{if(PutToDebugLog(4,"EVENT, InstallJavaPopupSDK"),e&&window.open(webphone_api.global.INSTALL_JAVA_URL,"_blank"),!isNull(jinstallmodal))return void jinstallmodal.show();jinstallmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("java_install_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+webphone_api.stringres.get("java_install")+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_jsinst_adialog">'+webphone_api.stringres.get("btn_ok")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),jinstallmodal=null}),jinstallmodal.show(),webphone_api.$("#btn_close_jsinst_adialog").on("click",function(){jinstallmodal.close()})}catch(n){PutToDebugLogException(2,"common: InstallJavaPopupSDK",n)}}function InstallJavaPopup(e,t){try{if(1==IsSDK())return void InstallJavaPopupSDK(e,t);PutToDebugLog(4,"EVENT, InstallJavaPopup");var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120);var o=webphone_api.stringres.get("java_install"),i='<div data-role="popup" id="np_downloadinstall" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("java_install_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+o+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" style="width: 100%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+"</a></div></div>";t=t||function(){},webphone_api.$.mobile.activePage.append(i).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition")}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),t()}}),webphone_api.$("#adialog_positive").on("click",function(t){e&&window.open(webphone_api.global.INSTALL_JAVA_URL,"_blank"),PutToDebugLog(5,"EVENT, common InstallJavaPopup ok click")})}catch(a){PutToDebugLogException(2,"common: InstallJavaPopup",a)}}function GetNPLocation(){var e="";try{if(e=GetConfig("nativepluginurl"),(isNull(e)||e.length<2)&&(e=GetParameter2("nativepluginurl")),!isNull(e)&&e.length>5)return CanLog(4)&&PutToDebugLog(4,"EVENT, GetNPLocation service location(1): "+e),e;e=webphone_api.getbasedir2(),isNull(e)&&(e="");var t=GetConfig("nativepluginname");"Mac"===GetOs()?t=GetConfig("nativepluginname_mac"):"Linux"===GetOs()&&(t=GetConfig("nativepluginname_linux"));var n=e+"native/";return(isNull(t)||t.length<3)&&(!0===NSMacLinEnabled()?"Mac"===GetOs()?(!isNull(webphone_api.global.mac_nsplugin_path)&&webphone_api.global.mac_nsplugin_path.length>0&&("www"==webphone_api.global.mac_nsplugin_path&&(webphone_api.global.mac_nsplugin_path="https://www.mizu-voip.com/G/webphone/publicfiles/"),n=webphone_api.global.mac_nsplugin_path),t=webphone_api.global.mac_nsplugin_filename):t=!0===Is64BitBrowser()?!0===IsARM()?webphone_api.global.lin64arm_nsplugin_filename:webphone_api.global.lin64_nsplugin_filename:!0===IsARM()?webphone_api.global.lin32arm_nsplugin_filename:webphone_api.global.lin32_nsplugin_filename:t=webphone_api.global.win_nsplugin_filename),"/"!==n.charAt(n.length-1)&&(n+="/"),e=n+t,CanLog(4)&&(PutToDebugLog(4,"EVENT, GetNPLocation doc location: "+location.href),PutToDebugLog(4,"EVENT, GetNPLocation service location: "+e)),e}catch(o){PutToDebugLogException(2,"common: GetNPLocation",o)}return""}function NPDownloadAndInstallSDK(e,t){try{if(PutToDebugLog(4,"EVENT, NPDownloadAndInstallSDK popup displayed"),ServiceStartPolling(),!isNull(npmodal))return void npmodal.show();t=t||function(){};var n=webphone_api.stringres.get("np_install_msg"),o='<a href="https://www.webvoipphone.com/hosted/webphonedemo/nsenginedownload.html" target="_blank">'+webphone_api.stringres.get("np_install_why")+"</a>";"Linux"===GetOs()?(n=webphone_api.stringres.get("np_install_msg_lin"),(!0===webphone_api.global.usestorage||Strl(90))&&(n=n+"<br><br>"+o)):"Mac"===GetOs()&&(n=webphone_api.stringres.get("np_install_msg_mac"),(!0===webphone_api.global.usestorage||Strl(90))&&(n=n+"<br><br>"+o));var i='<button id="btn_np_negative">'+webphone_api.stringres.get("btn_cancel")+"</button>";!0===e&&(i=""),npmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("np_install_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+n+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_np_positive">'+webphone_api.stringres.get("btn_ok")+"</button>"+i+"</div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),npmodal=null,PutToDebugLog(4,"EVENT, NPDownloadAndInstallSDK popup closed")}),npmodal.show(),webphone_api.$("#btn_np_positive").on("click",function(){npmodal.close(),PutToDebugLog(5,"EVENT, common NPDownloadAndInstallSDK 1 ok"),lm=!1,!0===webphone_api.global.nsupdatepending&&(webphone_api.global.nsupdatepending=!1,PutToDebugLog(2,"EVENT, mlogic API_Start NPDownloadAndInstallSDK"),webphone_api.start()),t("ok")}),webphone_api.$("#btn_np_negative").on("click",function(){npmodal.close(),PutToDebugLog(5,"EVENT, settings NPDownloadAndInstallSDK 1 cancel");var e=GetEngine("webrtc");e.clicked=0,SetEngine("webrtc",e),EngineSelect(1,21),stopPolling=!0,t("cancel")})}catch(a){PutToDebugLogException(2,"common: NPDownloadAndInstallSDK",a)}}function NPDownloadAndInstall(e,t){try{if(npclosehandled=!1,1==IsSDK())return void NPDownloadAndInstallSDK(e,t);PutToDebugLog(4,"EVENT, NPDownloadAndInstall popup displayed"),ServiceStartPolling();var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120),enginep.ns=enginep.ns+5e3;var o=webphone_api.stringres.get("np_install_msg"),i='<a href="https://www.webvoipphone.com/hosted/webphonedemo/nsenginedownload.html" target="_blank">'+webphone_api.stringres.get("np_install_why")+"</a>";o=o+"<br><br>"+i,"Linux"===GetOs()?(o=webphone_api.stringres.get("np_install_msg_lin"),(!0===webphone_api.global.usestorage||Strl(90))&&(o=o+"<br><br>"+i)):"Mac"===GetOs()&&(o=webphone_api.stringres.get("np_install_msg_mac"),(!0===webphone_api.global.usestorage||Strl(90))&&(o=o+"<br><br>"+i));var a='<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a>";!0===e&&(a="");var r='<div data-role="popup" id="np_downloadinstall" class="ui-content messagePopup" data-overlay-theme="a" data-dismissible="false" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("np_install_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+o+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+"</a>"+a+"</div></div>";t=t||function(){},webphone_api.$.mobile.activePage.append(r).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){!1===npclosehandled&&NPHandleCancel(),webphone_api.$(this).unbind("popupafterclose").remove(),PutToDebugLog(4,"EVENT, NPDownloadAndInstall popup closed")}}),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common NPDownloadAndInstall 1 ok"),npclosehandled=!0,lm=!1,setTimeout(function(){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")},500),!0===webphone_api.global.nsupdatepending&&(webphone_api.global.nsupdatepending=!1,PutToDebugLog(2,"EVENT, mlogic API_Start NPDownloadAndInstall"),webphone_api.start()),setTimeout(function(){IsServiceInstalled(function(e){!1===e&&(PutToDebugLog(2,"WARNING, on NPDownloadAndInstall OK clikc, NS service is not reachable"),AlertDialog(webphone_api.stringres.get("warning"),webphone_api.stringres.get("np_install_warn")))},!0)},500),t("ok")}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, settings NPDownloadAndInstall 1 cancel"),t("cancel"),NPHandleCancel(),setTimeout(function(){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")},500)})}catch(s){PutToDebugLogException(2,"common: NPDownloadAndInstall",s)}}function NPHandleCancel(){npclosehandled=!0;var e=GetEngine("ns");e.clicked=0,SetEngine("ns",e),EngineSelect(1,22),stopPolling=!0,webphone_api.startInner()}function EngineForcedInstallSDK(e,t,n,o){function i(){if("java"===e)InstallJavaPopup(!0),o("ok");else if("ns"===e){o("ok"),setTimeout(function(){NPDownloadAndInstall(!0)},450);var t=GetNPLocation();!isNull(t)&&t.length>0&&window.open(t)}}try{var a=!1;if(PutToDebugLog(4,"EVENT, EngineForcedInstallSDK popup displayed: "+e+"; message: "+t),o=o||function(){},!isNull(efmodal))return void efmodal.show();if(isNull(t)||t.length<1)if("java"===e&&"Chrome"===GetBrowser()){PutToDebugLog(2,"EVENT,"+webphone_api.stringres.get("jnotsupported")+"_2"),t=webphone_api.stringres.get("jnotsupported");var r=GetConfig("pc_alternatebrowserurl");!isNull(r)&&r.length>2&&(t=t+': <a href="'+r+'" target="_blank">'+r+"</a>"),a=!0}else t=webphone_api.stringres.get("ce_alert_user")+" "+GetEngineDisplayName(e)+".",t=t.replace("[BRAND]",GetBrandName());t.indexOf(webphone_api.stringres.get("service_update"))>=0&&(t+='<br /><a id="efi_download_link" style="cursor:pointer; color:#3f8fcf;">Download NS -Service Plugin</a>');var s=webphone_api.stringres.get("btn_ok");e===webphone_api.global.ENGINE_SERVICE&&(s=webphone_api.stringres.get("btn_download"));var l='<button id="btn_ef_positive">'+s+"</button>";!0===n&&(l='<button id="btn_ef_negative">'+webphone_api.stringres.get("btn_cancel")+"</button>"+l),efmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("ce_alert_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+t+'</div></div><div id="ce_modal_footer" class="pmodal_footer">'+l+"</div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){webphone_api.$("#efi_download_link").off("click"),e.destroy(),PutToDebugLog(4,"EVENT, EngineForcedInstallSDK popup closed"),efmodal=null}),efmodal.show(),webphone_api.$("#efi_download_link").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK link click"),i(),efmodal.close()}),webphone_api.$("#btn_ef_positive").on("click",function(){efmodal.close(),!0!==a&&(PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK 1 ok"),i())}),webphone_api.$("#btn_ef_negative").on("click",function(){efmodal.close(),PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK 1 cancel");var e=GetEngine("webrtc");e.clicked=0,SetEngine("webrtc",e),EngineSelect(1,23),stopPolling=!0,o("cancel")})}catch(p){PutToDebugLogException(2,"common: EngineForcedInstallSDK",p)}}function EngineForcedInstall(e,t,n,o){function i(){if("java"===e)InstallJavaPopup(!0),o("ok");else if("ns"===e){o("ok"),setTimeout(function(){NPDownloadAndInstall(!0)},450);var t=GetNPLocation();!isNull(t)&&t.length>0&&window.open(t)}setTimeout(function(){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")},200)}try{if("ns"===e&&-3===GetMinServiceVersion())return void PutToDebugLog(2,"ERROR, EngineForcedInstall: "+e+"; install popup is disabled by minserviceversion: "+GetMinServiceVersion().toString());var a=!1;if(1==IsSDK())return void EngineForcedInstallSDK(e,t,n,o);PutToDebugLog(4,"EVENT, EngineForcedInstall popup displayed: "+e+"; message: "+t);var r=GetDeviceWidth();if(r=!isNull(r)&&IsNumber(r)&&r>100?Math.floor(r/1.2):220,r>400?r=400:r<120&&(r=120),isNull(t)||t.length<1)if("java"===e&&"Chrome"===GetBrowser()){PutToDebugLog(2,"EVENT,"+webphone_api.stringres.get("jnotsupported")+"_3"),t=webphone_api.stringres.get("jnotsupported")
;var s=GetConfig("pc_alternatebrowserurl");!isNull(s)&&s.length>2&&(t=t+': <a href="'+s+'" target="_blank">'+s+"</a>"),a=!0}else t=webphone_api.stringres.get("ce_alert_user")+" "+GetEngineDisplayName(e)+".",t=t.replace("[BRAND]",GetBrandName());var l=webphone_api.stringres.get("btn_ok");e===webphone_api.global.ENGINE_SERVICE&&(l=webphone_api.stringres.get("btn_download")),t.indexOf(webphone_api.stringres.get("service_update"))>=0&&(t+='<br /><a id="efi_download_link" style="cursor:pointer;">Download NS -Service Plugin</a>');var p='<a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+l+"</a>";!0===n&&(p='<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a>"+p);var c='<div data-role="popup" id="np_forcedinstall" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+r+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title" style="margin-left: 2.2em;">'+webphone_api.stringres.get("ce_alert_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+t+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer">'+p+"</div></div>";o=o||function(){},webphone_api.$.mobile.activePage.append(c).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$("#efi_download_link").off("click"),webphone_api.$(this).unbind("popupafterclose").remove(),PutToDebugLog(4,"EVENT, EngineForcedInstall popup closed")}}),webphone_api.$("#efi_download_link").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstall link click"),webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),i()}),webphone_api.$("#adialog_positive").on("click",function(e){!0!==a&&(PutToDebugLog(5,"EVENT, common EngineForcedInstall ok"),i())}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstall 1 cancel"),o("cancel"),NPHandleCancel(),setTimeout(function(){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")},200)})}catch(u){PutToDebugLogException(2,"common: EngineForcedInstall",u)}}function GetAppEnProtocol(e){try{var t=GetConfig("app_protocol");if((isNull(t)||t.length<1)&&(t="webphone:"),t.indexOf(":")<1&&(t+=":"),t.indexOf("//")<1&&(t+="//"),"Mac"!==GetOs()&&"Linux"!==GetOs()||(t="sip://"),(isNull(t)||t.length<1)&&(t="webphone://"),t=t.toLowerCase(),!0===e){var n=GetParameter("callto");isNull(n)&&(n=""),n=Trim(n),t+=n}return t}catch(o){PutToDebugLogException(2,"common: GetAppEnProtocol",o)}return"webphone://"}function HandleProtocol(e){var t=0;try{if(PutToDebugLog(2,"EVENT, HandleProtocol called: "+e),!1===webphone_api.global.isdebugversion&&"iOS"!==GetOs()&&"Android"!==GetOs())return;t=1;var n=window.location;if(t=2,t=5,PutToDebugLog(2,"EVENT, HandleProtocol: "+e),"iOS"===GetOs())if(t=6,!0===IsWebphoneInIframe()){var o=GetNativeDialerUrl(GetOs());PutToDebugLog(2,"EVENT, HandleProtocol open protocol (iOS-iframe): "+o),window.open(o)}else PutToDebugLog(2,"EVENT, HandleProtocol open protocol (iOS): "+e),window.location=e;else if("Chrome"===GetBrowser()){var i=e;i=i.replace(":",""),i=i.replace("//",""),i=i.replace("\\","");var a=GetNativeDialerUrl(GetOs());a=a.toLowerCase();var r=a.indexOf("id=");r>0?(a=a.substring(r+3),r=a.indexOf("&"),r>0&&(a=a.substring(0,r)),r=a.indexOf("#"),r>0&&(a=a.substring(0,r)),a=Trim(a)):a="com.mizuvoip.mizudroid.app";var s=encodeURIComponent(GetNativeDialerUrl(GetOs())),l="intent://#Intent;scheme="+i+";apppackage="+a+";S.browser_fallback_url="+s+";end";PutToDebugLog(2,"EVENT, HandleProtocol for Chrome in Android: "+l),window.location=l}else{t=7;var p=document.getElementById("loader");if(isNull(p))return PutToDebugLog(1,"ERROR, HandleProtocol loader iframe is NULL"),void ShowToast("ERROR, app loader is not defined.");p.src=e}t=11,n=GetNativeDialerUrl(GetOs()),t=14,PutToDebugLog(2,"EVENT, HandleProtocol fallbackLink: "+n),redirect_timer=setTimeout(function(){try{t=15,PutToDebugLog(2,"EVENT, HandleProtocol open fallback link because could not open app"),window.location=n,t=16}catch(e){PutToDebugLogException(2,"common: HandleProtocol inner timer second( "+t+" ), fallbackLink: "+n,e)}},3e3),t=17,clear_timer=setInterval(function(){try{t=18,protocolmaxloop++;var e=window.document.hasFocus();t=17,(!e||document.hidden||protocolmaxloop>100)&&(t=21,protocolmaxloop=0,isNull(clear_timer)||clearInterval(clear_timer),clear_timer=null,t=22,isNull(redirect_timer)||clearTimeout(redirect_timer),redirect_timer=null,t=23,PutToDebugLog(2,"EVENT, HandleProtocol redirect timer cleared, because app was found and opened"))}catch(n){PutToDebugLogException(2,"common: HandleProtocol inner timer( "+t+" )",n)}},200),t=24}catch(c){PutToDebugLogException(2,"common: HandleProtocol( "+t+" )",c)}}function StartAppEngine(e,t,n,o){try{if(GetParameterInt("allow_start_app_engine",1)<1)return void PutToDebugLog(1,"STATUS, Skip app engine start, last start was cancelled");0===GetAppEnProtocol(n).indexOf("webphone:")?(UploadAutoprov(),setTimeout(function(){StartAppEnginePopup(e,t,n,o)},600)):StartAppEnginePopup(e,t,n,o)}catch(i){PutToDebugLogException(2,"common: StartAppEngine",i)}}function StartAppEnginePopup(e,t,n,o){try{var i=GetParameterInt("app_popup_displayed",0);if((!0!==e||i>0)&&("iOS"!==GetOs()||!0!==IsWebphoneInIframe()))return void StartAppEngineExec(e,t,n,o);var a=GetParameterInt("enginepriority_webrtc",2),r=GetParameterInt("enginepriority_app",2),s=GetParameterInt("enginepriority_p2p",2),l=GetParameterInt("enginepriority_accessnum",2);if((r>=5&&a<5&&s<5&&l<5||r>=2&&a<r&&s<r&&l<r)&&("iOS"!==GetOs()||!0!==IsWebphoneInIframe()))return void StartAppEngineExec(e,t,n,o);var p=webphone_api.stringres.get("app_en_message3");a<1&&(p=webphone_api.stringres.get("app_en_message2")),i+=1,SaveParameter("app_popup_displayed",i.toString());var c=GetDeviceWidth();c=!isNull(c)&&IsNumber(c)&&c>100?Math.floor(c/1.2):220,c>400?c=400:c<120&&(c=120);var u='<div id="adialog_appenalert" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+c+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("warning")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+p+'</span><div style="clear: both;">\x3c!--//--\x3e</div></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(u).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click")}}),webphone_api.$("#adialog_positive").on("click",function(i){StartAppEngineExec(e,t,n,o)}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(1,"STATUS, No engines to start."),ShowToast("ERROR, No engines to start!",8e3),PutToDebugLog(2,"ERROR, StartAppEngine user clicked cancel, so do NOT start APP engine"),SaveParameter("allow_start_app_engine","0")})}catch(h){PutToDebugLogException(2,"common: StartAppEngine",h)}}function StartAppEngineExec(e,t,n,o){try{void 0!==n&&null!==n||(n=!1),void 0!==o&&null!==o&&o.length>0&&Trim(o),function(e,t,n){try{webphone_api.global.isappenginestarted=!0,!isNull(e)&&e.length>0&&PutToDebugLog(2,e),isNull(n)&&(n=""),HandleProtocol(GetAppEnProtocol(t)+n)}catch(o){PutToDebugLogException(2,"common: StartAE",o)}}(t,n,o)}catch(i){PutToDebugLogException(2,"common: StartAppEngineExec",i)}}function Phone2Phone(e,t){try{var n=GetParameter("p2p");if(0!==Trim(n).indexOf("*"))return void OpenWebURL(n,webphone_api.stringres.get("p2p"));var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120),isNull(e)&&(e=""),isNull(t)&&(t="");var i='<div id="adialog_p2p" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("p2p")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+webphone_api.stringres.get("p2p_nra")+'</span><input type="text" id="phonea_input" name="phonea_input" value="'+e+'" data-theme="a" autocapitalize="off"/><span>'+webphone_api.stringres.get("p2p_nrb")+'</span><input type="text" id="phoneb_input" name="phoneb_input" value="'+t+'" data-theme="a" autocapitalize="off"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(i).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click")}});var a=document.getElementById("phonea_input"),r=document.getElementById("phoneb_input");isNull(a)||a.focus(),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, _dialpad Phone2Phone 1 ok");var t=a.value,n=r.value;return isNull(t)||Trim(t).length<1?void ShowToast(webphone_api.stringres.get("p2p_err1")):(t=Trim(t),isNull(n)||Trim(n).length<1?void ShowToast(webphone_api.stringres.get("p2p_err2")):(n=Trim(n),void UriParser(GetParameter("p2p"),"",t,n,"","phone2phone")))}),webphone_api.$("#adialog_negative").on("click",function(e){})}catch(s){PutToDebugLogException(2,"common: Phone2Phone",s)}}function AlertDialogSDK(e,t,n,o){try{if(!isNull(admodal))return void admodal.show();isNull(o)&&(o=webphone_api.stringres.get("btn_ok")),admodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+e+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+t+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_adialog">'+o+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),admodal=null}),admodal.show(),webphone_api.$("#btn_close_adialog").on("click",function(){admodal.close(),n&&"function"==typeof n&&(n(!0),n=null)})}catch(i){PutToDebugLogException(2,"common: AlertDialogSDK",i)}}function ShowToastSDK(e,t){try{if(!isNull(toastmodal))return void toastmodal.show();toastmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_content" class="modal_content" style="font-size: .8em; padding: .7em;"><div id="ce_modal_content_inner" style="margin-right: 1.6em;">'+e+"</div></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{padding:"0",margin:"0",border:".2em solid #d8d8d8",borderRadius:".5em",width:"auto",background:"#ffffff",fontFamily:"sans-serif"},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),toastmodal=null}),toastmodal.show(),webphone_api.$("#btn_close_adialog").on("click",function(){toastmodal.close()}),isNull(t)&&(t=3e3),t>0&&setTimeout(function(){isNull(toastmodal)||toastmodal.close()},t)}catch(n){PutToDebugLogSpecial(2,"common: ShowToastSDK",!0,n)}}function LcAc(e,t){try{if(IsWindowsSoftphone()||!webphone_api.global.usestorage)return!0;if(e&&isNull(lctmr))return lctmr=setTimeout(function(){lcsexp=!0},36e5),!0;var n=1;!0===SvCont()&&!0===WbCont()?n=5:!0===SvCont()?n=3:!0===WbCont()&&(n=2);if(lccsenr>15*n&&(lcsexp=!0),!0===t){var o=GetParameter("lccnr"),i=0;if(!isNull(o)&&o.length>0){o=Trim(o);try{i=StrToInt(o)}catch(c){PutToDebugLogException(2,"_call: convert to int",c)}var a=n;a>1&&(a/=2),a*=100,i>a?lcsexp=!0:(i++,lccsenr++,SaveParameter("lccnr",i.toString()))}else SaveParameter("lccnr","1")}if(lcsexp){var r=[];r.push("D"),r.push("e"),r.push("m"),r.push("o "),r.push("l"),r.push("i"),r.push("m"),r.push("i"),r.push("t "),r.push("r"),r.push("e"),r.push("a"),r.push("c"),r.push("h"),r.push("e"),r.push("d"),r.push(". "),r.push("P"),r.push("l"),r.push("e"),r.push("a"),r.push("s"),r.push("e "),r.push("r"),r.push("e"),r.push("s"),r.push("t"),r.push("a"),r.push("r"),r.push("t "),r.push("t"),r.push("h"),r.push("e "),r.push("b"),r.push("r"),r.push("o"),r.push("w"),r.push("s"),r.push("e"),r.push("r "),r.push("t"),r.push("o "),r.push("c"),r.push("o"),r.push("n"),r.push("t"),r.push("i"),r.push("n"),r.push("u"),r.push("e "),r.push("t"),r.push("e"),r.push("s"),r.push("t"),r.push("i"),r.push("n"),r.push("g"),r.push(". "),r.push("\n<br>"),r.push("C"),r.push("o"),r.push("n"),r.push("t"),r.push("a"),r.push("c"),r.push("t "),r.push("M"),r.push("i"),r.push("z"),r.push("u"),r.push("t"),r.push("e"),r.push("c"),r.push("h "),r.push("t"),r.push("o "),r.push("b"),r.push("u"),r.push("y "),r.push("a "),r.push("l"),r.push("i"),r.push("c"),r.push("e"),r.push("n"),r.push("s"),r.push("e"),r.push("d "),r.push("c"),r.push("o"),r.push("p"),r.push("y"),r.push(": "),r.push("s"),r.push("u"),r.push("p"),r.push("p"),r.push("o"),r.push("r"),r.push("t"),r.push("@"),r.push("m"),r.push("i"),r.push("z"),r.push("u"),r.push("-"),r.push("v"),r.push("o"),r.push("i"),r.push("p"),r.push("."),r.push("c"),r.push("o"),r.push("m");var s=r.join(""),l=[];l.push("D"),l.push("e"),l.push("m"),l.push("o");var p=l.join("");return setTimeout(function(){AlertDialog(p,s)},950),!1}}catch(c){PutToDebugLogException(2,"common: LcAc",c)}return!0}function GetServerForHttpReq(){var e="";try{e=GetParameter("serveraddress_user");var t=GetParameter("upperserver");return(GetConfigInt("cfgusetunneling",0)>0||!isNull(e)&&e.length>0&&e.indexOf(".")<1)&&!isNull(t)&&t.length>1&&(e=t),(isNull(e)||e.length<1)&&(e=GetParameter2("serveraddress"),(isNull(e)||e.length<1)&&(e=GetParameter("serveraddress_user")),(isNull(e)||e.length<1)&&(e=GetParameter("serveraddress_orig")),(isNull(e)||e.length<1)&&(e=GetConfig("serveraddress")),(isNull(e)||e.length<1)&&(e=GetProxyaddress("")),(isNull(e)||e.length<1)&&(e=GetWebrtcUpperServer("")),(isNull(e)||e.length<1)&&(e=GetParameter("upperserver")),GetConfigInt("cfgusetunneling",0)>0&&!isNull(GetConfig("upperserver"))&&GetConfig("upperserver").length>1&&(e=GetConfig("upperserver"))),isNull(e)&&(e=""),e.indexOf(":")>0&&(e=e.substring(0,e.indexOf(":"))),e}catch(n){PutToDebugLogException(2,"common: GetServerForHttpReq",n)}return""}function GetProxyaddress(e){try{var t="";if(!isNull(e)&&e.length>0)t=e;else{if((isNull(t)||t.length<3)&&(t=GetConfig("proxyaddress")),!isNull(t)&&t.length>2&&t.indexOf(":")<1){var n=GetConfig("serverport");!isNull(n)&&n.length>0&&"5060"!==n&&(t=t+":"+n)}(isNull(t)||t.length<3)&&(t=GetParameter("proxyaddress"))}return isNull(t)&&(t=""),t=t.toLowerCase(),t=t.replace("udp://",""),t=t.replace("tcp://",""),t=t.replace("http://",""),t=t.replace("https://",""),t=t.replace("udp:",""),t=t.replace("tcp:",""),t=t.replace("http:",""),t=t.replace("https:",""),t=Trim(t),0===t.indexOf("udp")&&(t=t.replace("udp","")),0===t.indexOf("tcp")&&(t=t.replace("tcp","")),0===t.indexOf("http")&&(t=t.replace("http","")),0===t.indexOf("https")&&(t=t.replace("https","")),t}catch(o){PutToDebugLogException(2,"common: GetProxyaddress",o)}return""}function GetWebrtcUpperServer(e){var t=0;try{t=1;var n="",o=GetParameter("upperserverip");if(!isNull(o)&&Trim(o).length>0)return o;if(t=2,!0!==e){t=3;var i=GetParameter("upperserverdomain");if(!isNull(i)&&Trim(i).length>0)return i}t=4;var a=GetConfig("wsuser");if(!isNull(a)&&a.length>10){if(t=5,o=GetUrlParamVal("upperserverip"),i=GetUrlParamVal("upperserverdomain"),!isNull(o)&&Trim(o).length>0)return o;if(!0!==e&&!isNull(i)&&Trim(i).length>0)return i}t=6;var r=GetWsAddressCfg();if(isNull(r)||r.length<2){t=7,n=GetParameter("serveraddress_user");var s=GetParameter("upperserver");return(GetConfigInt("cfgusetunneling",0)>0||!isNull(n)&&n.length>0&&n.indexOf(".")<1)&&!isNull(s)&&s.length>1&&(n=s),Trim(n)}return t=8,n=GetParameter2("serveraddress"),(isNull(n)||n.length<1)&&(n=GetParameter("serveraddress_user")),(isNull(n)||n.length<1)&&(n=GetParameter("serveraddress_orig")),(isNull(n)||n.length<1)&&(n=GetConfig("serveraddress")),t=9,GetConfigInt("cfgusetunneling",0)>0&&!isNull(GetConfig("upperserver"))&&GetConfig("upperserver").length>1&&(n=GetConfig("upperserver")),n}catch(l){PutToDebugLogException(2,"common: GetWebrtcUpperServer "+t,l)}return""}function GetWebrtcSyUpperHeader(e){try{var t=GetParameter("jsupperserver");if((isNull(t)||t.length<1)&&(t=GetWebrtcUpperServer(!0)),!isNull(t)&&t.length>0){var n=GetConfig("transport");return!isNull(n)&&n.length>0&&(n.indexOf(":")<0&&(n=":"+n),t=n+t),t}PutToDebugLog(2,"WARNING, GetWebrtcUpperServer is NULL ("+e+")")}catch(o){PutToDebugLogException(2,"common: GetWebrtcSyUpperHeader",o)}return""}function GetWebrtcSyUpperDomainHeader(e){try{var t=GetParameter("upperserverd");isNull(t)&&(t="");var n=GetConfig("wsuser");if(!isNull(n)&&n.length>10){var o=GetParameter("upperserverdomain");if(!isNull(o)&&Trim(o).length>0)return o}if(t.length>0){var i=GetConfig("transport");return!isNull(i)&&i.length>0&&(i.indexOf(":")<0&&(i=":"+i),t=i+t),t}}catch(a){PutToDebugLogException(2,"common: GetWebrtcSyUpperHeader",a)}return""}function GetUpperProxyHeaderForSignaling(){var e="";try{if(e=GetParameter("upperproxy"),!isNull(e)&&Trim(e).length>0)return e;if(e=GetParameter("proxyaddress"),!isNull(e)&&Trim(e).length>0)return e;var t=GetConfig("wsuser");if(!isNull(t)&&t.length>10&&(e=GetUrlParamVal(t,"proxyaddress"),!isNull(e)&&Trim(e).length>0))return e}catch(n){PutToDebugLogException(2,"common:  GetUpperProxyHeaderForSignaling",n)}return""}function GetWebrtcSrvAddr(){return GetBestWsAddress()}function GetUsableWebrtcSrvAddr(){var e=GetWsAddressCfg();if(!isNull(e)&&e.length>3)return e;var t=getuseengine();if(isNull(t)||t.length<1);else if(t===webphone_api.global.ENGINE_WEBRTC)return e=GetWebrtcSrvAddr(),!isNull(e)&&e.length,e;return""}function HandleAddress(e){try{if(isNull(e)||e.length<1)return"";e=e.toLowerCase(),e=Trim(e);var t=!1;location.host.toLowerCase();!0!==PreferWss()&&!0!==IsHttps()||(t=!0),!0===t&&0===e.indexOf("ws:")&&(e=e.replace("ws:","wss:")),e.indexOf("ws:")<0&&e.indexOf("wss:")<0&&(e=!0===t?"wss://"+e:"ws://"+e),e.indexOf("?")>0&&(e=e.substring(0,e.indexOf("?")))}catch(n){PutToDebugLogException(2,"common: HandleAddress",n)}return e}function AddWsAddress(e,t){try{if(isNull(e)||!e.address||isNull(e.address)||e.address.length<4)return void PutToDebugLog(2,"ERROR, AddWsAddress invalid object");if(isNull(wsrvL)&&(wsrvL=[]),wsrvL.length>0)for(var n=0;n<wsrvL.length;n++)if(wsrvL[n].address===e.address)return void(wsrvL[n].answertime<2&&(wsrvL[n].answertime=e.answertime,wsrvL[n].load=e.load));var o=GetParameter("lastwebrtcserver");!isNull(o)&&o.length>3&&o===e.address&&(e.answertime=e.answertime-20),wsrvL.push(e),GetBestWsAddress(t)}catch(i){PutToDebugLogException(2,"common: AddWsAddress",i)}}function GetWsAddressCfg(e){var t;if((isNull(e)||e<2)&&void 0!==(t=selectedwserver)&&null!==t&&t.length>3)return t;if(void 0!==(t=GetParameter("webrtcserveraddress"))&&null!==t&&t.length>3&&0==t.indexOf("ws")&&t.indexOf(",")<0)return t;if(void 0!==(t=webphone_api.parameters.webrtcserveraddress)&&null!==t&&t.length>3&&0==t.indexOf("ws")&&t.indexOf(",")<0)return t;if(webphone_api.global.decideusuk_finished&&webphone_api.global.usuk.length>0&&!waitingforusukdecide&&(isNull(e)||e<1)){if("uk"===webphone_api.global.usuk)return StrDc(wips_uk,alsvkey);if("us"===webphone_api.global.usuk)return StrDc(wips_us,alsvkey)}return void 0!==(t=GetParameter("webrtcserveraddress"))&&null!==t&&t.length>3?t:void 0!==(t=webphone_api.parameters.webrtcserveraddress)&&null!==t&&t.length>3?t:void 0!==(t=GetParameter("origwebrtcserveraddress"))&&null!==t&&t.length>3?t:void 0!==(t=GetParameter("webrtcserver"))&&null!==t&&t.length>3?t:void 0!==(t=GetParameter("webrtcaddress"))&&null!==t&&t.length>3?t:void 0!==(t=GetParameter("rtcserver"))&&null!==t&&t.length>3?t:void 0!==(t=GetParameter("rtcaddress"))&&null!==t&&t.length>3?t:void 0!==(t=webphone_api.parameters.webrtcserver)&&null!==t&&t.length>3?t:void 0!==(t=webphone_api.parameters.webrtcaddress)&&null!==t&&t.length>3?t:void 0!==(t=webphone_api.parameters.rtcserver)&&null!==t&&t.length>3?t:(t=webphone_api.parameters.rtcaddress,void 0!==t&&null!==t&&t.length>3?t:"")}function GetBestWsAddress(e){try{if(!isNull(selectedwserver)&&selectedwserver.length>3)return selectedwserver;var t=GetWsAddressCfg();if(void 0!==t&&null!==t&&t.length>3&&t.indexOf(",")<0)return selectedwserver=t;var n=!0;if(MightUseEngine("webrtc")||MightUseEngine("flash")||(PutToDebugLog(5,"EVENT, might not use engine webrtc and flash"),n=!1),n||(decide_already_run=!0),!1===decide_already_run)return DecideWebrtcServer(),"";if(!1===n)return"";if(!0===e){if(!isNull(wsrvL)&&!isNull(wsrvL[0])&&!isNull(wsrvL[0].address)&&wsrvL[0].address.length>0){decide_already_run=!0,selectedwserver=wsrvL[0].address;var o=wsrvL[0].load;return webphone_api.global.recwsload!=o&&o>=0&&o<=7&&(webphone_api.global.recwsload=o,SaveParameter("lastrecwsload",o)),wsrvL[0].apikey.length>0&&(webphone_api.global.selected_apikey=wsrvL[0].apikey),!0===e&&SaveParameter("lastwebrtcserver",selectedwserver),selectedwserver}return""}isNull(addrtimer)&&(ADDR_TIMERSTART=GetTickCount(),addrtimer=setInterval(function(){if(addr_maxloop>60||!isNull(selectedwserver)&&selectedwserver.length>3)return isNull(addrtimer)||clearInterval(addrtimer),void(addrtimer=null);var e=null;if(!isNull(wsrvL)&&wsrvL.length>0)for(var t=0;t<wsrvL.length;t++)!0!==wsrvL[t].worked||wsrvL[t].load<0||(isNull(e)&&wsrvL[t].answertime<9e4&&wsrvL[t].load<2||e.answertime>wsrvL[t].answertime&&wsrvL[t].load<2)&&(e=wsrvL[t]);if(isNull(e)){var n=GetTickCount(),o=!0,i=!1;wsrvL.length<1&&(o=!1);for(var t=0;t<wsrvL.length;t++)wsrvL[t].load<0?o=!1:i=!0;if(!0===o||n-ADDR_TIMERSTART>=3e3&&!0===i||n-ADDR_TIMERSTART>=6e3){for(var a=wsrvL.length,r=0,t=0;t<a&&(wsrvL[t].load<0&&(wsrvL.push(wsrvL.splice(t,1)[0]),t<a-1&&t--),!(++r>3*a));t++);for(var t=0;t<a;t++)for(var s=t+1;s<a;s++)if(wsrvL[t].load>-1&&wsrvL[s].load>-1&&wsrvL[t].load>wsrvL[s].load){var l=wsrvL[t];wsrvL[t]=wsrvL[s],wsrvL[s]=l}for(var p=-1,t=0;t<a;t++)wsrvL[t].load<0||(p<0&&(p=wsrvL[t].load),isNull(e)&&(e=wsrvL[t]),wsrvL[t].load>p||e.answertime>wsrvL[t].answertime&&(e=wsrvL[t]))}if(!isNull(e)){selectedwserver=e.address;var c=e.load;if(webphone_api.global.recwsload!=c&&c>=0&&c<=7&&(webphone_api.global.recwsload=c,SaveParameter("lastrecwsload",c)),e.apikey.length>0&&(webphone_api.global.selected_apikey=e.apikey),isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,!0===IsUKGateway(selectedwserver)?webphone_api.global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(webphone_api.global.usuk="us"),!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var u=GetWsAddressCfg();u.length>0&&SaveParameter("lastwebrtcserver",u),PutToDebugLog(5,"EVENT, DecideUsUk select finished on fastest2 "+u)}}}else{selectedwserver=e.address;var c=e.load;if(webphone_api.global.recwsload!=c&&c>=0&&c<=7&&(webphone_api.global.recwsload=c,SaveParameter("lastrecwsload",c)),e.apikey.length>0&&(webphone_api.global.selected_apikey=e.apikey),isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,!0===IsUKGateway(selectedwserver)?webphone_api.global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(webphone_api.global.usuk="us"),!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var u=GetWsAddressCfg();u.length>0&&SaveParameter("lastwebrtcserver",u),PutToDebugLog(5,"EVENT, DecideUsUk select finished on fastest1 "+u)}}},100))}catch(i){PutToDebugLogException(2,"common: GetBestWsAddress",i)}return""}function GetSpecialWsloadUrl(e){try{var t=GetWsloadUrl(GetSipusername()),n=t.indexOf("://");if(n>0){var o=t.substring(0,n+3),i=t.substring(n+3);i=i.substring(i.indexOf("/"));t=o+NormalizeInput(e,0)+i}return t}catch(a){PutToDebugLogException(2,"common: GetSpecialWsloadUrl",a)}return""}function IsUKGateway(e){try{if(isNull(e)||e.length<3)return!1;isNull(uk_ip)&&(uk_ip=StrDc(wip_uk,alsvkey),uk_domain=StrDc(wips_uk,alsvkey));var t=-1;if(uk_ip=uk_ip.replace("ws://",""),t=uk_ip.lastIndexOf("/"),t>0&&(uk_ip=uk_ip.substring(0,t)),t=uk_ip.lastIndexOf(":"),t>0&&(uk_ip=uk_ip.substring(0,t)),uk_domain=uk_domain.replace("wss://",""),t=uk_domain.lastIndexOf("/"),t>0&&(uk_domain=uk_domain.substring(0,t)),t=uk_domain.lastIndexOf(":"),t>0&&(uk_domain=uk_domain.substring(0,t)),e.indexOf(uk_ip)>=0||e.indexOf(uk_domain)>=0)return!0}catch(n){PutToDebugLogException(2,"common: IsUKGateway",n)}return!1}function IsUSGateway(e){try{if(isNull(e)||e.length<3)return!1;isNull(us_ip)&&(us_ip=StrDc(wip_us,alsvkey),us_domain=StrDc(wips_us,alsvkey));var t=-1;if(us_ip=us_ip.replace("ws://",""),t=us_ip.lastIndexOf("/"),t>0&&(us_ip=us_ip.substring(0,t)),t=us_ip.lastIndexOf(":"),t>0&&(us_ip=us_ip.substring(0,t)),us_domain=us_domain.replace("wss://",""),t=us_domain.lastIndexOf("/"),t>0&&(us_domain=us_domain.substring(0,t)),t=us_domain.lastIndexOf(":"),t>0&&(us_domain=us_domain.substring(0,t)),e.indexOf(us_ip)>=0||e.indexOf(us_domain)>=0)return!0}catch(n){PutToDebugLogException(2,"common: IsUSGateway",n)}return!1}function ClassWServers(){this.address="",this.worked=!1,this.answertime=99999,this.load=-1,this.apikey=""}function DecideWebrtcServer(){try{if(!isNull(selectedwserver)&&selectedwserver.length>3)return;if(!0===decide_already_run)return void PutToDebugLog(5,"EVENT, DecideWebrtcServer already run");var e=GetWsAddressCfg(),t=GetParameter("lastwebrtcserver"),n=GetParameter("topprioritywebrtcserver");if(isNull(e)||e.length<4){if(!isNull(t)&&t.length>0||!isNull(n)&&n.length>0)return;if(!IsMizuPublicWebRTCGateway())return;e=StrDc(wip_uk,alsvkey)+","+StrDc(wip_us,alsvkey)}if(PutToDebugLog(5,"EVENT, DecideWebrtcServer "+e),e.indexOf(",")<0){e.indexOf("://")<0&&(e=UseSecureSrvConnection()||!1===IsIPAddrress(e)?"wss://"+e:"ws://"+e),selectedwserver=e;var o="",i=selectedwserver.indexOf("authkey=");if(i>0&&(o=selectedwserver.substring(i+8),selectedwserver=selectedwserver.substring(0,i),isNull(o)&&(o=""),i=o.indexOf("&"),i>0&&(o=o.substring(0,i)),o=Trim(o),webphone_api.global.selected_apikey=api_key,!0===IsUKGateway(selectedwserver)?webphone_api.global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(webphone_api.global.usuk="us"),!webphone_api.global.decideusuk_finished)){webphone_api.global.decideusuk_finished=!0;var a=GetWsAddressCfg();a.length>0&&SaveParameter("lastwebrtcserver",a),PutToDebugLog(5,"EVENT, DecideUsUk select finished on single "+a)}return}for(var r=e.split(","),s=0;s<r.length;)isNull(r[s])||r[s].length<4?r.splice(s,1):s++;if(isNull(r)||r.length<1)return;for(var l=!0,p=r.length,c=0;c<p;c++)if(r[c].toLowerCase().indexOf("mfstwebsock")<1&&r[c].toLowerCase().indexOf("mvstwebsock")<1){l=!1;break}if(r=ShuffleArray(r),!isNull(n)&&n.length>0)for(var c=0;c<p;c++)if(r[c]===n){var u=splice(c,1);r.unshift(u);break}if(!isNull(t)&&t.length>0)for(var c=0;c<p;c++)if(r[c]===t){var u=splice(c,1);r.unshift(u);break}var h=GetTickCount();if(wsrvL=[],isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,addr_maxloop=0,decide_already_run=!0,!0===l)for(var c=0;c<p;c++)!function(){function e(){!isNull(p)&&p.close&&p.close(),p=null}var t=c,n=new ClassWServers;try{var o=r[t],i="",a=o.indexOf("authkey=");a>0&&(i=o.substring(a+8),isNull(i)&&(i=""),a=i.indexOf("&"),a>0&&(i=i.substring(0,a)),i=Trim(i));var s=!1;o.indexOf("mfstwebsock")>0&&(s=!0);var l=HandleAddress(o);n.address=l,n.apikey=i,PutToDebugLog(2,"EVENT, DecideWebrtcServer ("+t+") url: "+l);var p=new WebSocket(l,"sip");p.binaryType="arraybuffer",p.onopen=function(){h=!0};var u=0,h=!1,g=setInterval(function(){u++,1===p.readyState&&!0===h&&!0===s&&(d=GetTickCount(),p.send("mrtcping\r\n")),(u>25||1===p.readyState)&&(isNull(g)||clearInterval(g),g=null)},100),m=-1,d=0;p.onerror=function(){n.worked=!1,AddWsAddress(n)},p.onclose=function(){n.worked=!1,AddWsAddress(n)},p.onmessage=function(o){var i=null;if(isNull(o)||(i=o.data),!isNull(i)){var r=ArrayBufferToString(i);if(r=r.toLowerCase(),r.indexOf("mrtcpong")>=0){m=GetTickCount()-d,n.answertime=m;var s=GetSpecialWsloadUrl(l);PutToDebugLog(2,"EVENT, DecideWebrtcServer send wsload ("+t+") url: "+l+"; answertime: "+m.toString()+"; url: "+s),p.send(s+"\r\n")}else{var c=r;if((a=c.indexOf("ws load:"))>=0){c=c.substring(a+8),c=Trim(c),a=c.indexOf(" "),a>0&&(c=c.substring(0,a));var u=-1;!isNull(c)&&IsNumber(c)&&(u=StrToInt(c)),n.load=u,PutToDebugLog(2,"EVENT, DecideWebrtcServer rec wsload ("+t+") url: "+l+"; answertime: "+m.toString()+"; load: "+c),AddWsAddress(n),e()}}}},setTimeout(function(){e()},6500)}catch(b){n.worked=!1,PutToDebugLogException(2,"DecideWebrtcServer ("+t+") failure",b)}}();else{var g=0;if(g<p){var m=g,d=new ClassWServers;try{var b=HandleAddress(r[m]);d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=HandleAddress(r[m]);d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",
_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=r[m];d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=r[m];d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=r[m];d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=r[m];d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=r[m];d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=r[m];d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=r[m];d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}if(++g<p){var m=g,d=new ClassWServers;try{var b=r[m];d.address=b,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+m+") url: "+b);var _=new WebSocket(b,"sip");_.binaryType="arraybuffer",_.onopen=function(){var e=GetTickCount()-h;d.answertime=e,d.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+m+") url: "+b+"; answertime: "+e.toString()),!isNull(_)&&_.close&&_.close(),_=null,AddWsAddress(d,!0)}}catch(f){d.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+m+") failed to connect",f)}}g++}}catch(w){PutToDebugLogException(2,"common: DecideWebrtcServer",w)}}function ShuffleArray(e){try{var t,n,o,i=e;for(o=i.length-1;o>0;o--)t=Math.floor(Math.random()*(o+1)),n=i[o],i[o]=i[t],i[t]=n;return i}catch(a){PutToDebugLogException(2,"common: ShuffleArray",a)}return e}function Engine(){this.name,this.cfg_priority,this.defpriority,this.available,this.serversupport,this.finalscore,this.finalscorex,this.pushlevel,this.failed,this.clicked,this.issupported_cache,this.isinstalled_cache,this.serversupport_cache,this.available_old,this.asyncreqbegintime}function GetEngineList(){if(isNull(engines)){engines=[];var e=30;!1===CanIUseApplet()&&(e=.1),engine=new Engine,engine.name="java",engine.defpriority=GetEngineDefPriority("java",e),engines.push(engine),engine=new Engine,engine.name="webrtc",engine.defpriority=GetEngineDefPriority("webrtc",26),engines.push(engine),engine=new Engine,engine.name="flash",engine.defpriority=GetEngineDefPriority("flash",13),engines.push(engine),engine=new Engine,engine.name="ns",engine.defpriority=GetEngineDefPriority("ns",31),engines.push(engine);var t=10;"Windows"!==GetOs()&&"Mac"!==GetOs()&&"Linux"!==GetOs()||(t=.1),engine=new Engine,engine.name="app",engine.defpriority=GetEngineDefPriority("app",t),engines.push(engine),engine=new Engine,engine.name="p2p",engine.defpriority=GetEngineDefPriority("p2p",5),engines.push(engine),engine=new Engine,engine.name="nativedial",engine.defpriority=GetEngineDefPriority("nativedial",3),engines.push(engine),engine=new Engine,engine.name="otherbrowser",engine.defpriority=GetEngineDefPriority("otherbrowser",2),engines.push(engine),engine=new Engine,engine.name="java_avail",engine.defpriority=GetEngineDefPriority("java_avail",33),engines.push(engine),engine=new Engine,engine.name="ns_avail",engine.defpriority=GetEngineDefPriority("ns_avail",31),engines.push(engine),engine=new Engine,engine.name="app_avail",engine.defpriority=GetEngineDefPriority("app_avail",t),engines.push(engine);for(var n=0;n<engines.length;n++)engine=engines[n],engine.pushlevel=-1,engine.issupported_cache=-1,engine.isinstalled_cache=-1,engine.serversupport_cache=-1,engine.failed=0,engine.clicked=0,engine.asyncreqbegintime=0,engine.available_old=GetCfgOldAvailable(engine.name)}return engines}function GetSelectedEngine(){return selected_engine}function GetRecommendedEngine(){return recommend_engine}function GetSelectedEngineName(){try{if(!isNull(selected_engine)&&!isNull(selected_engine.name))return selected_engine.name}catch(e){PutToDebugLogException(2,"common: GetSelectedEngineName",e)}return null}function GetRecommendedEngineName(){try{if(!isNull(recommend_engine)&&!isNull(recommend_engine.name))return recommend_engine.name}catch(e){PutToDebugLogException(2,"common: GetRecommendedEngineName",e)}return null}function GetEngine(e){try{if(isNull(engines))return null;for(var t,n=0;n<engines.length;n++)if(t=engines[n],t.name===e)return t;for(var n=0;n<engines.length;n++){if(t=engines[n],t.name+"_avail"===e)return t;if(t.name===e+"_avail")return t}for(var n=0;n<engines.length;n++)if((t=engines[n])===e)return t}catch(o){PutToDebugLogException(2,"common: GetEngine",o)}return null}function SetEngine(e,t){try{if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common SetEngine invalid engine name: "+e),!1;if(isNull(t))return PutToDebugLog(2,"ERROR, common SetEngine invalid engine object"),!1;if(isNull(engines))return PutToDebugLog(2,"ERROR, common SetEngine engines is NULL"),!1;for(var n=0;n<engines.length;n++)engines[n].name===e&&(engines[n]=t)}catch(o){PutToDebugLogException(2,"common: GetEngine",o)}return!1}function ResetEngineClicked(){try{if(isNull(engines))return PutToDebugLog(2,"ERROR, common ResetEngineClicked engines is NULL"),!1;for(var e,t=0;t<engines.length;t++)e=engines[t],e.clicked=0,engines[t]=e}catch(n){PutToDebugLogException(2,"common: ResetEngineClicked",n)}}function HasUsableEngine(e){try{if(isNull(engines))return!1;for(var t,n=0;n<engines.length;n++)if(t=engines[n],t.available>1&&t.failed<1&&e.name!==t.name&&t.name.indexOf("_avail")<0&&t.defpriority>0)return!0}catch(o){PutToDebugLogException(2,"common: HasUsableEngine",o)}return!1}function HasUsableEngineFromEngines(e,t){try{if(isNull(engines))return!1;for(var n,o=0;o<engines.length;o++)if(n=engines[o],!(t.indexOf(n.name)<0)&&n.available>1&&n.failed<1&&e.name!==n.name&&n.name.indexOf("_avail")<0&&n.defpriority>0)return!0}catch(i){PutToDebugLogException(2,"common: HasUsableEngineFromEngines",i)}return!1}function IsMizuPublicWebRTCGateway(){return IsMizuPublicWebRTCGatewayIntern(!0)}function IsMizuPublicWebRTCGatewayUsed(){return IsMizuPublicWebRTCGatewayIntern(!1)}function IsMizuPublicWebRTCGatewayIntern(e){try{if(0===GetConfigInt("usemizuwebrtcgateway",1))return!1;var t=GetWsAddressCfg();if(isNull(t)||t.length<3)return!(!webphone_api.global.decideusuk_finished||!(webphone_api.global.usuk.length>0||getuseengine()===webphone_api.global.ENGINE_WEBRTC))||(!(!(webphone_api.global.usuk.length>0)||!webphone_api.global.decideusuk_finished&&getuseengine()!==webphone_api.global.ENGINE_WEBRTC)||(2===GetConfigInt("usemizuwebrtcgateway",1)||!!e));t=t.toLowerCase(),t=NormalizeInput(t,0),t=t.replace("*","");var n=t.indexOf("/");n>0&&(t=t.substring(0,n));var n=0,o=StrDc(wip_uk,alsvkey);o=o.toLowerCase(),o=NormalizeInput(o,0),o=o.replace("*",""),n=o.indexOf(":"),n>0&&(o=o.substring(0,n)),n=o.indexOf("/"),n>0&&(o=o.substring(0,n));var i=StrDc(wips_uk,alsvkey);i=i.toLowerCase(),i=NormalizeInput(i,0),i=i.replace("*",""),n=i.indexOf(":"),n>0&&(i=i.substring(0,n)),n=i.indexOf("/"),n>0&&(i=i.substring(0,n));var a=StrDc(wip_us,alsvkey);a=a.toLowerCase(),a=NormalizeInput(a,0),a=a.replace("*",""),n=a.indexOf(":"),n>0&&(a=a.substring(0,n)),n=a.indexOf("/"),n>0&&(a=a.substring(0,n));var r=StrDc(wips_us,alsvkey);if(r=r.toLowerCase(),r=NormalizeInput(r,0),r=r.replace("*",""),n=r.indexOf(":"),n>0&&(r=r.substring(0,n)),n=r.indexOf("/"),n>0&&(r=r.substring(0,n)),o===t||i===t||a===t||r===t)return!0}catch(s){PutToDebugLogException(2,"common: IsMizuPublicWebRTCGateway",s)}return!1}function IsMizuWebRTCGatewayAndNotMizuServer(){try{if(ismizuserverdetected>=2)return!1;if(!0===GetConfigBool("usingmizuserver",!1))return!1;if(!0===GetConfigBool("usingmizuserveronly",!1))return!1;if(0===GetConfigInt("usemizuwebrtcgateway",1))return!1;if(GetConfigInt("ismrtcgateway",0)>0)return!0;if(webphone_api.global.wsload_type>0)return!0;var e=GetWsAddressCfg();return!(!(isNull(e)||e.length<3)||1!=ismizuserverdetected)||IsMizuPublicWebRTCGateway()}catch(t){PutToDebugLogException(2,"common: IsMizuWebRTCGateway2",t)}return!1}function IsMizuServer(){return!(!IsMizuServerOrGateway()||IsMizuWebRTCGatewayAndNotMizuServer())}function IsMizuServerOrGateway(){try{if(ismizuserverdetected>0)return!0;if(!0===GetConfigBool("usingmizuserver",!1))return!0;if(!0===GetConfigBool("usingmizuserveronly",!1))return!0;if(GetConfigInt("ismrtcgateway",0)>0)return!0;if(webphone_api.global.wsload_type>0)return!0;if(GetConfigInt("cfgusetunneling",0)>0&&!0===GetConfigBool("useencryption",!1))return!0;var e=GetServerForHttpReq();if(!isNull(e)&&(e.indexOf("mizu-voip.com")>=0||e.indexOf("webvoipphone.com")>=0))return!0;var t=GetWsAddressCfg();if(t=t.toLowerCase(),t.indexOf("mfstwebsock")>0)return!0;if((isNull(t)||t.length<3)&&getuseengine()===webphone_api.global.ENGINE_WEBRTC){if(webphone_api.global.decideusuk_finished&&webphone_api.global.usuk.length>0)return!0;if(2===GetConfigInt("usemizuwebrtcgateway",1))return!0}}catch(n){PutToDebugLogException(2,"common: IsMizuServerOrGateway",n)}return!1}function CanIUseApplet(){return gcaniuseapplet||(gcaniuseapplet=CanIUseAppletInternal())}function CanIUseAppletInternal(){try{var e=GetBrowserVersion(),t=GetBrowser(),n=GetOs(),o=webphone_api.getmaxchromeversionforjava();if(CanLog(4)&&PutToDebugLog(4,"EVENT, CanIUseApplet, OS: "+n+"; browser: "+t),"Windows"===n){if("Chrome"===t)return!(isNull(e)||IsNumber(e)&&(e<1||e>o));if("Firefox"===t){var i=GetParameterInt("nojavaforff",52);return!(!0===Is64BitBrowser()||GetBrowserVersion()>=i)||(CanLog(4)&&PutToDebugLog(4,"EVENT, CanIUseApplet, nojavaforff: "+i),!1)}return"Safari"===t?GetBrowserVersion()<6:"Edge"!==t}if("Mac"===n)return"Chrome"===t?!(isNull(e)||IsNumber(e)&&(e<1||e>o)):"Safari"!==t||!!(!isNull(e)&&IsNumber(e)&&e>0&&e<7);if("Linux"===n)return"Chrome"!==t||!(isNull(e)||IsNumber(e)&&(e<1||e>o))}catch(a){PutToDebugLogException(2,"common: CanIUseApplet",a)}return!1}function GetUDPServerAddress(){try{var e="";if((isNull(e)||e.length<3)&&(e=GetParameter("serveraddress_user")),(isNull(e)||e.length<3)&&(e=GetConfig("serverdomain")),(isNull(e)||e.length<3)&&(e=GetConfig("serveraddress")),(isNull(e)||e.length<3)&&(e=GetConfig("server")),(isNull(e)||e.length<3)&&(e=GetConfig("serverip")),!isNull(e)&&e.length>2&&e.indexOf(":")<1){var t=GetConfig("serverport");!isNull(t)&&t.length>0&&"5060"!==t&&(e=e+":"+t)}return(isNull(e)||e.length<3||e.indexOf(".")<1)&&(e=GetParameter("upperserver")),(isNull(e)||e.length<3)&&(e=GetFp()),e=e.toLowerCase(),e=e.replace("udp://",""),e=e.replace("tcp://",""),e=e.replace("http://",""),e=e.replace("https://","")}catch(n){PutToDebugLogException(2,"common: GetUDPServerAddress",n)}return""}function CanIUseWebRTC(e){return gcaniusewebrtc||(gcaniusewebrtc=CanIUseWebRTCInternal(e))}function CanIUseWebRTCInternal(e){try{if(lversion<=0){var t=[];if("Android"===GetOs()||"iOS"===GetOs()){t.push("D"),t.push("e"),t.push("s"),t.push("k"),t.push("t"),t.push("o"),t.push("p"),t.push(" "),t.push("o"),t.push("n"),t.push("l"),t.push("y"),t.push("_");var n=t.join("");setTimeout(function(){PutToDebugLog(1,"ERROR, "+n)},500)}return!1}if(1===lversion&&!1===Glsp()){var t=[];t.push("D"),t.push("e"),t.push("s"),t.push("k"),t.push("t"),t.push("o"),t.push("p"),t.push(" "),t.push("o"),t.push("n"),t.push("l"),t.push("y"),t.push("_");var n=t.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+n)},510),!1}if(IsMizuPublicWebRTCGateway()&&1==IsLanIPEx(GetWebrtcUpperServer()))return PutToDebugLog(2,"EVENT, CanIUseWebRTC server is on local network"),!1;var o=-1;if(webphone_api.webrtcapi){var i=webphone_api.webrtcapi.WebRtcIsSupported();if(!0===i)o=1;else if(!1===i)return o=0,PutToDebugLog(5,"EVENT, CanIUseWebRTC no capabilities"),!1}if("iOS"===GetOs()){if("Safari"!==GetBrowser()&&"iPhone"!==GetBrowser())return 1===o?PutToDebugLog(5,"EVENT, (warn) CanIUseWebRTC ios other browser but webrtc supported"):PutToDebugLog(5,"EVENT, CanIUseWebRTC ios other browser"),!1;if(GetBrowserVersion()<11)return 1===o?PutToDebugLog(5,"EVENT, (warn) CanIUseWebRTC old safari but webrtc supported"):PutToDebugLog(5,"EVENT, CanIUseWebRTC old safari "),!1}var a="";if(75!==GetParameterInt("brandid",-1)){var r=GetWsAddressCfg();if(isNull(r)||Trim(r).length<1){var s=GetUDPServerAddress();if(isNull(s)&&(s=""),s=NormalizeInput(GetDomainPart(s)),s.length>0&&!1===IsIPAddrress(s)){var l=GetParameterInt("enginepriority_java",2),p=GetParameterInt("enginepriority_webrtc",2),c=GetParameterInt("enginepriority_ns",2),u=GetParameterInt("enginepriority_flash",2);p>2||p>l&&p>c&&p>u||DomainToIpServer(s,function(e){isNull(e)||e.length<1||(a=e,canresolvedomain=!(e.indexOf("cannotresolve")>=0)&&(!IsIPAddrress(e)||!IsLanIP(e)))})}else s.length>0&&IsIPAddrress(s)&&IsLanIP(s)&&(canresolvedomain=!1);if(!1===canresolvedomain&&!CanUseAnyAddrForWebRTC())return PutToDebugLog(3,"EVENT, CanIUseWebRTC WebRTC NOT available: Cannot resolve SIP server domain ("+s+") to public ip: "+a),!1}}if(webphone_api.global.webrtcavailable<1)return PutToDebugLog(2,"EVENT, CanIUseWebRTC WebRTC NOT available in this environment: "+webphone_api.global.webrtcavailable.toString()),!1;if(0===GetConfigInt("usemizuwebrtcgateway",1)&&GetWsAddressCfg(1).length<2)return PutToDebugLog(2,"WARNING, CanIUseWebRTC WebRTC available but there is no webrtc server"),!1;if("Windows"===GetOs()){if("MSIE"===GetBrowser())return!1;if("Edge"===GetBrowser()&&GetBrowserVersion()<14)return!1}return!0}catch(h){PutToDebugLogException(2,"common: CanIUseWebRTC",h)}return!1}function CanIUseService(){try{if("Windows"!==GetOs()&&!IsMacLin()||IsMacLin()&&!1===NSMacLinEnabled())return PutToDebugLog(2,"EVENT, CanIUseService not windows/mac/linux: false"),!1;var e=StrToInt(GetParameter2("enginepriority_java")),t=StrToInt(GetParameter2("enginepriority_webrtc")),n=StrToInt(GetParameter2("enginepriority_ns")),o=StrToInt(GetParameter2("enginepriority_flash")),i=StrToInt(GetParameter2("enginepriority_app")),a=StrToInt(GetParameter2("enginepriority_p2p")),r=StrToInt(GetParameter2("enginepriority_accessnum")),s=StrToInt(GetParameter2("enginepriority_nativedial")),l=!1;if(!isNull(e)&&IsNumber(e)||(l=!0,e=2),!isNull(t)&&IsNumber(t)||(l=!0,t=2),!isNull(n)&&IsNumber(n)||(l=!0,n=2),!isNull(o)&&IsNumber(o)||(l=!0,o=2),!isNull(i)&&IsNumber(i)||(l=!0,i=2),!isNull(a)&&IsNumber(a)||(l=!0,a=2),!isNull(r)&&IsNumber(r)||(l=!0,r=2),!isNull(s)&&IsNumber(s)||(l=!0,s=2),!0===l&&PutToDebugLog(2,"EVENT, CanIUseService priorities are NULL, probably couldnt read settings"),n<1||e>4||t>4||o>4||i>4||a>4||r>4||s>4)return PutToDebugLog(2,"EVENT, CanIUseService: false, other forced "+n),!1;if(lversion<=0)return!1;if(1===lversion&&!1===Glsp()){var p=[];p.push("D"),p.push("e"),p.push("s"),p.push("k"),p.push("t"),p.push("o"),p.push("p"),p.push(" "),p.push("o"),p.push("n"),p.push("l"),p.push("y"),p.push("_"),p.push("2");var c=p.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+c)},620),!1}if(window.WebSocket)return PutToDebugLog(2,"EVENT, CanIUseService_1 true "+n),!0;if("Chrome"===GetBrowser())return PutToDebugLog(2,"EVENT, CanIUseService_2 true "+n),!0;PutToDebugLog(2,"EVENT, CanIUseService final false "+n)}catch(u){PutToDebugLogException(2,"common: CanIUseService",u)}return!1}function CanIUseFlash(){return gcaniuseflash||(gcaniuseflash=CanIUseWebRTCInternal())}function CanIUseFlashInternal(){try{if(PutToDebugLog("EVENT, CanIUseFlash__1"),IsLocalServer(!0))return PutToDebugLog("EVENT, CanIUseFlash__2"),PutToDebugLog(2,"EVENT, Cannot use flash (can i use this engine) server to connect to local network VoIP server"),!1;if(lversion<=0){PutToDebugLog("EVENT, CanIUseFlash__3");var e=[];if("Android"===GetOs()||"iOS"===GetOs()){e.push("D"),e.push("e"),e.push("s"),e.push("k"),e.push("t"),e.push("o"),e.push("p"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push("_"),e.push("3");var t=e.join("");setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},650)}return!1}if(1===lversion&&(PutToDebugLog("EVENT, CanIUseFlash__4"),!1===Glsp())){e.push("D"),e.push("e"),e.push("s"),e.push("k"),e.push("t"),e.push("o"),e.push("p"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push("_"),e.push("3");var t=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},680),!1}PutToDebugLog("EVENT, CanIUseFlash__5");var n=GetParameterInt("enginepriority_java",2),o=GetParameterInt("enginepriority_webrtc",2),i=GetParameterInt("enginepriority_ns",2),a=GetParameterInt("enginepriority_flash",2),r=GetParameterInt("enginepriority_app",2),s=GetParameterInt("enginepriority_p2p",2),l=GetParameterInt("enginepriority_accessnum",2),p=GetParameterInt("enginepriority_nativedial",2);if(PutToDebugLog("EVENT, CanIUseFlash__6"),a>2||n<a&&o<a&&i<a&&r<a&&s<a&&l<a&&p<a){if(PutToDebugLog("EVENT, CanIUseFlash__7 old style detect"),webphone_api.flashdeepdetect=!0,webphone_api.swfobject.hasFlashPlayerVersion("9.0.115"))return!0}else{PutToDebugLog("EVENT, CanIUseFlash__8");try{var c=navigator.plugins["ShockwaveFlash.ShockwaveFlash"];if(c)return PutToDebugLog("EVENT, CanIUseFlash__9"),!0;if(PutToDebugLog("EVENT, CanIUseFlash__10"),c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(u){if(PutToDebugLog("EVENT, CanIUseFlash__11"),navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!=undefined&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return PutToDebugLog("EVENT, CanIUseFlash__12"),!0}PutToDebugLog("EVENT, CanIUseFlash__13")}PutToDebugLog("EVENT, CanIUseFlash__14")}catch(h){PutToDebugLogException(2,"common: CanIUseFlash",h)}return!1}function IsJavaInstalled(){try{if("Windows"===GetOs()&&"Edge"===GetBrowser())return 0;var e=null,t=!1,n=0;if(navigator.mimeTypes&&navigator.mimeTypes.length?(e=navigator.mimeTypes["application/x-java-jnlp-file"],null==e&&(e=navigator.mimeTypes["application/x-java-vm"]),null==e&&(e=navigator.mimeTypes["application/x-java-applet"]),e?n=1:"MSIE"===GetBrowser()&&(t=!0)):t=!0,t){isNull(document.getElementById("deployJavaPlugin"))&&mwpdeploy.writePluginTag();var o=mwpdeploy.getJREs();if(!isNull(o)&&o.length>0)for(var i=0;i<o.length;i++)n=1;return n<1?0:2}return n?navigator.javaEnabled()?2:1:0}catch(a){PutToDebugLogException(2,"common: IsJavaInstalled",a)}return 0}function EngineIsSupported(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var t=[];if(lversion<=0){if("Android"===GetOs()||"iOS"===GetOs()){t.push("D"),t.push("e"),t.push("s"),t.push("k"),t.push("t"),t.push("o"),t.push("p"),t.push(" "),t.push("o"),t.push("n"),t.push("l"),t.push("y");var n=t.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+n)},500),0}if("java"!==e)return 0}else if(1===lversion){if(!1===Glsp()){t.push("D"),t.push("e"),t.push("s"),t.push("k"),t.push("t"),t.push("o"),t.push("p"),t.push(" "),t.push("o"),t.push("n"),t.push("l"),t.push("y");var n=t.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+n)},500),0}if("java"!==e&&"webrtc"!==e&&"ns"!==e)return 0}if("java"===e){var o=CanIUseApplet();return PutToDebugLog(2,"EVENT, EngineIsSupported CanIUseApplet returned: "+o.toString()),!0===o?1:0}if("webrtc"===e){if(CanIUseWebRTC()){if(!0===BrowserRequiresHttps(!0)&&!1===IsHttps()){var i=GetUsemizutlsproxy();return"false"===GetParameter("usemizutlsproxy_userreload")||"2"!==i&&("1"!==i||!0!==webphone_api.global.usestorage&&!Strl(60))?(PutToDebugLog(2,"EVENT, CanIUseWebRTC engine maybe supported"),1):(PutToDebugLog(2,"EVENT, CanIUseWebRTC engine supported"),2)}return PutToDebugLog(2,"EVENT, CanIUseWebRTC engine supported"),2}return PutToDebugLog(2,"EVENT, CanIUseWebRTC engine not supported"),0}if("ns"===e)return CanIUseService()?1:0;if("flash"===e)return CanIUseFlash()?2:0;if("app"===e){var a=GetNativeDialerUrl(GetOs());return!isNull(a)&&a.length>5?2:(PutToDebugLog(2,"ERROR, EngineIsSupported: app engine not supported, because cannot find URL"),0)}return"p2p"===e?GetParameter("p2p").length<4?0:2:"accessnum"===e?("Android"===GetOs()||"iOS"===GetOs())&&GetParameter("accessnumber").length>2?2:0:"nativedial"===e?"Android"===GetOs()||"iOS"===GetOs()?2:0:"otherbrowser"===e?("Windows"===GetOs()||"Mac"===GetOs()||"Linux"===GetOs())&&GetParameterInt("enginepriority_otherbrowser",2)>0&&GetParameter("pc_alternatebrowserurl").length>3?2:0:(PutToDebugLog(2,"ERROR, common: EngineIsSupported invalid engine name: "+e),0)}catch(r){PutToDebugLogException(2,"common: EngineIsSupported",r)}}function EngineIsInstalled(e,t,n){var o=EngineIsInstalledInternal(e,t,n),i=GetEngine(e);return-1==i.isinstalled_cache&&(i.isinstalled_cache=-2),o>=0&&i.isinstalled_cache<0&&(i.isinstalled_cache=o),o}function EngineIsInstalledInternal(e,t,n){try{if(e.indexOf("_avail")>0)return 2;if("java"!==e&&"ns"!==e&&"app"!==e&&"webrtc"!==e)return 2;var o=GetEngine(e);if(o.isinstalled_cache>=0)return o.isinstalled_cache;if(t>0&&0===o.asyncreqbegintime&&(t=0),"java"!==e)return 0===t&&0!==o.asyncreqbegintime?1:t>0&&-2==o.isinstalled_cache&&0!==o.asyncreqbegintime&&GetTickCount()-o.asyncreqbegintime>3e3?0:(0===o.asyncreqbegintime&&(o.asyncreqbegintime=GetTickCount()),t>0&&-2==o.isinstalled_cache?-1:(o.isinstalled_cache=-2,"ns"===e?(PutToDebugLog(2,"EVENT, engine waiting for IsServiceInstalled"),IsServiceInstalled(function(e){PutToDebugLog(2,"EVENT, engine IsServiceInstalled: "+e);var t=GetEngine("ns");t.isinstalled_cache=e?2:0,SetEngine("ns",t)},!1),-2):"app"===e?2:"webrtc"===e?CanIUseWebRTC()?!0===BrowserRequiresHttps(!0)?1:2:0:1));if("java"===e){if("Windows"===GetOs()&&"Edge"===GetBrowser()||"Chrome"===GetBrowser())return 0;var i=IsJavaInstalled(),a=GetEngine("java");return a.isinstalled_cache=i,SetEngine("java",a),1===i?-2:i}return 1}catch(r){PutToDebugLogException(2,"common: EngineIsInstalled",r)}return 0}function GetServersupport(e,t){try{if(e.indexOf("_avail")>0)return 1;if("webrtc"!==e)return 1;var n=GetEngine(e);if(n.serversupport_cache>=0)return n.serversupport_cache;if(t>0&&0===n.asyncreqbegintime&&(t=0),0===t&&0!==n.asyncreqbegintime)return 1;if(t>0&&0!==n.asyncreqbegintime&&GetTickCount()-n.asyncreqbegintime>3e3)return 0;if(0===n.asyncreqbegintime&&(n.asyncreqbegintime=GetTickCount()),t>0)return-1;var o=GetConfig("brandid"),i=GetBrandName(),a=GetConfig("companyname"),r="";GetSipusername().length>0&&(r="&username="+GetSipusername());var s=GetLastUsedEngine(),l=GetSelectedEngineName();if(isNull(s)||s.length<1||"webrtc"===s||"java"!==s&&"ns"!==s||"webrtc"===l){PutToDebugLog(5,"EVENT, GetServersupport check for webrtc: "+s+" / "+l),DecideWebrtcServer();var p=1;if(wsloadanswersreceived=0,IsMizuPublicWebRTCGateway()){PutToDebugLog(5,"EVENT, GetServersupport check mzpublicgateway"),webphone_api.global.decideusuk_finished=!1;var c=3200;waitingforusukdecide=!0,setTimeout(function(){if(!1===webphone_api.global.decideusuk_finished){PutToDebugLog(2,"EVENT, decideusuk not yet finihed after delay: "+c.toString()),waitingforusukdecide=!1;var e=GetWebrtcSrvAddr();if((isNull(e)||e.length<2)&&(e=GetWp()),IsUKGateway(e)?(PutToDebugLog(2,"WARNING, common manually setting UK gateway, because DecideUsUk has not yet finished after delay: "+c.toString()),webphone_api.global.usuk="uk"):IsUSGateway(e)&&(PutToDebugLog(2,"WARNING, common manually setting US gateway, because DecideUsUk has not yet finished after delay: "+c.toString()),webphone_api.global.usuk="us"),!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var t=GetWsAddressCfg();t.length>0&&SaveParameter("lastwebrtcserver",t),PutToDebugLog(5,"EVENT, DecideUsUk select finished on timeout2 "+t)}}},c);var u="http://rtc.mizu-voip.com/mvapireq/?authkey=1568108345&apientry=wsload&brandid="+o+"&brandname="+i+"&companyname="+a+"&upperserver="+GetWebrtcUpperServer()+"&authid="+r+"&now=415",h="http://usrtcx.webvoipphone.com/mvapireq/?authkey=1552303117&apientry=wsload&brandid="+o+"&brandname="+i+"&companyname="+a+"&upperserver="+GetWebrtcUpperServer()+"&authid="+r+"&now=415";PutToDebugLog(2,"EVENT, DecideUsUk UK_url (UK Websocket connect): "+u),PutToDebugLog(2,"EVENT, DecideUsUk US_url (US Websocket connect): "+h),!0===BrowserRequiresHttps(!1)&&(u=u.replace("http:","https:"),h=h.replace("http:","https:"));var g=GetWp("uk"),m=GetWp("us");if(g=g.replace("*",""),m=m.replace("*",""),g=g.replace("/mfstwebsock","/mvstwebsock"),m=m.replace("/mfstwebsock","/mvstwebsock"),(g.indexOf("/mvstwebsock")>0||g.indexOf("/mfstwebsock")>0)&&g.indexOf("requestid=")<0&&(g=g.indexOf("?")>0?g+"&requestid="+GetRequestId():g+"?requestid="+GetRequestId()),(m.indexOf("/mvstwebsock")>0||m.indexOf("/mfstwebsock")>0)&&m.indexOf("requestid=")<0&&(m=m.indexOf("?")>0?m+"&requestid="+GetRequestId():m+"?requestid="+GetRequestId()),IsLocalServer(!0))waitingforusukdecide=!1,PutToDebugLog(2,"ERROR, wsload decide"+webphone_api.stringres.get("webrtc_local_sipserver")+" (8)");else try{waitingforusukdecide=!0;var d=new WebSocket(g,"api"),b=new WebSocket(m,"api");d.binaryType="arraybuffer",b.binaryType="arraybuffer",d.onopen=function(){d.send(u+"\r\n"),PutToDebugLog(2,"EVENT, UK wsload sent (UK Websocket onopen)"),SaveParameter("wseverconnected","true")},b.onopen=function(){b.send(h+"\r\n"),PutToDebugLog(2,"EVENT, US wsload sent (US Websocket onopen)"),SaveParameter("wseverconnected","true")},d.onclose=function(){d=null},b.onclose=function(){b=null},d.onerror=function(e){},b.onerror=function(e){},d.onmessage=function(e){var t=null;if(isNull(e)||(t=e.data),isNull(t))PutToDebugLog(2,"ERROR, UK wsload failed, received data is NULL");else{HttpResponseHandler(ArrayBufferToString(t),"wrtcload_uk")}d&&d.close&&d.close()},b.onmessage=function(e){var t=null;if(isNull(e)||(t=e.data),isNull(t))PutToDebugLog(2,"ERROR, US wsload failed, received data is NULL");else{HttpResponseHandler(ArrayBufferToString(t),"wrtcload_us")}b&&b.close&&b.close()},p=1300}catch(P){PutToDebugLogException(2,"common: GetServersupport wsload inner",P)}}else if(PutToDebugLog(5,"EVENT, GetServersupport not mzpublicgateway"),!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var _=GetWsAddressCfg();_.length>0&&SaveParameter("lastwebrtcserver",_),PutToDebugLog(5,"EVENT, DecideUsUk select finished on notpublgw "+_)}if(p<10)PutToDebugLog(5,"EVENT, common: GetServersupport imnmediate"),MSendWebRTCLoad();else var f=p/60,w=0,v=setInterval(function(){(++w>=f||webphone_api.global.decideusuk_finished&&3==wsloadanswersreceived&&webphone_api.global.usuk.length>0)&&(w>=f&&PutToDebugLog(5,"EVENT, common: GetServersupport timeout "+webphone_api.global.usuk+" / "+webphone_api.global.decideusuk_finished.toString()+" / "+wsloadanswersreceived.toString()),MSendWebRTCLoad(),clearInterval(v))},60)}else PutToDebugLog(5,"EVENT, GetServersupport check for not webrtc: "+s+" / "+l);IsMizuServerOrGateway()||(n.serversupport_cache=0,SetEngine(e,n))}catch(P){PutToDebugLogException(2,"common: GetServersupport",P)}return 0}function MSendWebRTCLoad(){try{var e=GetWsloadUrl(GetSipusername());waitingforusukdecide=!1,(isNull(e)||e.length<1)&&(e=GetWsloadUrl(GetSipusername())),!isNull(e)&&e.length>0&&(PutToDebugLog(5,"EVENT, common: GetServersupport GetWebrtcLoad "+webphone_api.global.usuk+" / "+webphone_api.global.decideusuk_finished.toString()+" / "+wsloadanswersreceived.toString()+" / "+e),UriParser(e,"","","","","webrtcload"))}catch(t){PutToDebugLogException(2,"common: MSendWebRTCLoad",t)}}function GetCfgPriority(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var t=2;try{t=parseInt(GetParameter2("enginepriority_"+e))}catch(o){PutToDebugLogException(2,"common: GetCfgPriority parseint: "+e,o)}var n=window.location.protocol;return"flash"===e&&!isNull(n)&&n.length>0&&n.toLowerCase().indexOf("file")>=0&&(t=0),t}catch(o){PutToDebugLogException(2,"common: GetCfgPriority",o)}return 2}function GetCfgOldAvailable(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var t=1;try{t=parseInt(GetParameter("engineoldavailable_"+e))}catch(n){PutToDebugLogException(2,"common: GetCfgOldAvailable parseint: "+e,n)}return IsNumber(t)||(t=1),t}catch(n){PutToDebugLogException(2,"common: GetCfgOldAvailable",n)}return 1}function SaveCfgOldAvailable(e,t){try{if(e.indexOf("_avail")>0)return;SaveParameter("engineoldavailable_"+e,t)}catch(n){PutToDebugLogException(2,"common: SaveCfgOldAvailable",n)}}function GetEngineDefPriority(e,t){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var n=GetConfig("enginedefpriority_"+e);if(!isNull(n)&&n.length>0&&IsNumber(n))return StrToInt(n)}catch(o){PutToDebugLogException(2,"common: GetEngineDefPriority",o)}return t}function GetSinglePossibleEngine(){try{var e=GetParameterInt("enginepriority_java",2),t=GetParameter2("enginepriority_webrtc",2),n=GetParameter2("enginepriority_ns",2),o=CanIUseWebRTC(),i=CanIUseApplet(),a=GetOs();if("Android"===a){if(!1===o)return webphone_api.global.ENGINE_APP}else if("iOS"===a){if(!1===o)return webphone_api.global.ENGINE_APP}else if("Windows"===a)if("Edge"===GetBrowser()){if(!1===o)return webphone_api.global.ENGINE_SERVICE}else if(!1===i||e<1){if(!1===o||t<1)return webphone_api.global.ENGINE_SERVICE;if(!0===o&&n<1)return webphone_api.global.ENGINE_WEBRTC}}catch(r){
PutToDebugLogException(2,"common: GetSinglePossibleEngine",r)}return""}function MightUseEngine(e){try{if(isNull(e)||e.length<1)return!0;GetEngineList();var t=GetEngine(e);if(isNull(t))return!0;var n=GetOs();if(gcaniusewebrtc&&!1===gcaniusewebrtc&&"webrtc"===e)return!1;if(gcaniuseapplet&&!1===gcaniuseapplet&&"java"===e)return!1;if(gcaniuseflash&&!1===gcaniuseflash&&"flash"===e)return!1;if(!("Android"!=n&&"iOS"!=n||"ns"!=t.name&&"java"!=t.name&&"flash"!=t.name))return!1;var o=GetForcedEngine();if(o){if(e===o.name)return!0;if(e!==o.name+"_avail"&&e+"_avail"!==o.name)return!1}if(o=GetSelectedEngine()){if(e===o.name||e===o.name+"_avail"||e+"_avail"===o.name)return!0;if(GetCfgPriority(o.name)>=GetCfgPriority(t.name)&&"flash"!==o.name&&"app"!==o.name&&"p2p"!==o.name&&"nativedial"!==o.name&&"otherbrowser"!==o.name)return!1}if(webphone_api.global.lastengine_working_ok.length<1?webphone_api.global.lastengine_working_ok=GetLastUsedEngine():webphone_api.global.lastengine_working_ok.length<1&&(webphone_api.global.lastengine_started_ok=GetLastUsedEngine(),webphone_api.global.lastengine_working_ok=webphone_api.global.lastengine_started_ok),webphone_api.global.lastengine_working_ok.length>0&&(o=GetEngine(webphone_api.global.lastengine_working_ok))){if(e===o.name||e===o.name+"_avail"||e+"_avail"===o.name)return!0;if(o.failed<1&&o.name.indexOf("_avail")<0&&GetCfgPriority(o.name)>=GetCfgPriority(t.name)&&"flash"!==o.name&&"app"!==o.name&&"p2p"!==o.name&&"nativedial"!==o.name&&"otherbrowser"!==o.name)return!1}}catch(i){PutToDebugLogException(2,"common: MightUseEngine",i)}return!0}function CanUseAnyAddrForWebRTC(){if(GetParameterInt("enginepriority_webrtc",2)>1&&GetWsAddressCfg(2).length>0)return!0;var e=GetForcedEngine();return!(!e||"webrtc"!==e)}function GetForcedEngine(){try{if(forced_engine_checked)return forced_engine;forced_engine_checked=!0,GetEngineList();for(var e=GetOs(),t=0;t<engines.length;t++)if(engine=engines[t],engine.cfg_priority=GetCfgPriority(engine.name),IsNumber(engine.cfg_priority)&&(engine.cfg_priority>=5||engine.clicked>=2)&&engine.name.indexOf("_avail")<0&&(isNull(selected_engine)||selected_engine.name===engine.name))if(gcaniusewebrtc&&!1===gcaniusewebrtc&&"webrtc"===engine.name);else if(gcaniuseapplet&&!1===gcaniuseapplet&&"java"===engine.name);else if(gcaniuseflash&&!1===gcaniuseflash&&"flash"===engine.name);else if("Android"!=e&&"iOS"!=e||"ns"!=engine.name&&"java"!=engine.name&&"flash"!=engine.name)return forced_engine=engine,engine;for(var n=null,t=0;t<engines.length;t++)if(engine=engines[t],engine.cfg_priority=GetCfgPriority(engine.name),IsNumber(engine.cfg_priority))if(engine.cfg_priority<1){if(n&&n.name===engine.name){n=null;break}}else{if(n){n=null;break}n=engine}if(n&&n.name.indexOf("_avail")<0&&(isNull(selected_engine)||selected_engine.name===n.name))if(gcaniusewebrtc&&!1===gcaniusewebrtc&&"webrtc"===engine.name);else if(gcaniuseapplet&&!1===gcaniuseapplet&&"java"===engine.name);else if(gcaniuseflash&&!1===gcaniuseflash&&"flash"===engine.name);else if("Android"!=e&&"iOS"!=e||"ns"!=engine.name&&"java"!=engine.name&&"flash"!=engine.name)return forced_engine=n,n}catch(o){PutToDebugLogException(2,"common: GetForcedEngine",o)}return forced_engine}function EngineSelect(e,t,n){try{webphone_api.plhandler.ConfigChanged();var o;CanLog(2)&&(!1===n?PutToDebugLog(2,"ERROR, Engine select called with cannot wait stage: "+e+" from: "+t):PutToDebugLog(2,"EVENT, EngineSelect called with stage: "+e+" from: "+t)),webphone_api.global.engineselecttime=GetTickCount(),webphone_api.global.engineselectstage=e,GetEngineList();var i=GetForcedEngine();if(!isNull(i))return selected_engine=i,selected_engine.pushlevel=1,recommend_engine=null,CanLog(2)&&PutToDebugLog(2,"EVENT, Returning forced only engine allowed by config: "+i.name),"webrtc"===i.name&&!1===getsrvsupportcalled&&(getsrvsupportcalled=!0,GetServersupport("webrtc",e)),1;var a=GetWsAddressCfg(1);if(!isNull(a)&&a.length>3){2===GetParameterInt("enginepriority_webrtc",2)&&(PutToDebugLog(2,"EVENT, enginepriority_webrtc auto increased to: 3"),SaveParameter("enginepriority_webrtc","3"))}if(webphone_api.global.lastengine_started_ok=GetLastUsedEngine(),webphone_api.global.lastengine_working_ok=webphone_api.global.lastengine_started_ok,PutToDebugLog(2,"EVENT, EngineSelect at stage: "+e+"; last working engine: "+webphone_api.global.lastengine_working_ok),webphone_api.global.lastengine_working_ok.length>0)for(var r=0;r<engines.length;r++)if(o=engines[r],o.name===webphone_api.global.lastengine_working_ok&&o.failed<1&&o.name.indexOf("_avail")<0&&o.defpriority>0)if("webrtc"===o.name&&IsMizuServerOrGateway())avoidjavapopup=2;else if("flash"!==o.name||"true"!==GetParameter("java_worked")&&"true"!==GetParameter("ns_worked")&&"true"!==GetParameter("webrtc_worked")){selected_engine=o,selected_engine.pushlevel=1,recommend_engine=null;var s="";try{s=selected_engine.name}catch(R){}return PutToDebugLog(2,"Returning last working ok engine: "+s),1}for(var r=0;r<engines.length;r++){o=engines[r];var l=o.issupported_cache;"webrtc"===o.name&&e>0&&(l=-1),l<0&&(l=EngineIsSupported(o.name)),o.issupported_cache=l,0===l?o.available=0:2===l?o.available=3:webphone_api.global.lastengine_started_ok===o.name||webphone_api.global.lastengine_working_ok===o.name?o.available=2:o.available=1}for(var p=0,c=null,r=0;r<engines.length;r++)if(o=engines[r],o.available>2&&o.failed<1&&o.name.indexOf("_avail")<0){if(c=o,++p>1){c=null;break}}else if(o.available>0){c=null;break}if(!isNull(c))return selected_engine=c,selected_engine.pushlevel=1,recommend_engine=null,PutToDebugLog(2,"Returning the only good engine: "+selected_engine.name),1;if(1===avoidjavapopup){var u=GetEngine("java");avoidjavapopup=u.available_old>2?2:0===u.available_old?2:0}for(var r=0;r<engines.length;r++)if(o=engines[r],!(o.available<1||o.available>2))if(o.name.indexOf("_avail")>0)o.available=3;else if(!((avoidjavapopup>1||0===e)&&"java"===o.name||(avoidflashpopup>1||0===e)&&"flash"===o.name)){var l=o.isinstalled_cache,h=HasUsableEngine(o);if(l<0&&(l=EngineIsInstalled(o.name,e,h)),l<0){if(!0===n)return 0;o.available=1,l=1}else o.isinstalled_cache=l,0===l?o.available=0:2===l&&(o.available=3)}if(IsMizuServerOrGateway())for(var r=0;r<engines.length;r++)if(o=engines[r],o.serversupport=1,"webrtc"===o.name)if(o.available<1)o.serversupport=2;else if(o.serversupport=o.serversupport_cache,o.serversupport<0&&(o.serversupport=GetServersupport(o.name,e)),o.serversupport<0){if(n)return 0;o.serversupport=3}else o.serversupport_cache=o.serversupport;if(avoidjavapopup>1&&e>0){var u=GetEngine("java"),h=HasUsableEngine(u);if(u.available_old>2?u.available=u.available_old:0===u.available_old&&h&&(u.available=u.available_old),u.available<1||u.available>2);else{var g=GetEngine("webrtc"),m=GetEngine("ns");if((1===u.available||2===u.available)&&u.cfg_priority<=2&&(g.available>2&&g.cfg_priority>=2&&g.serversupport<=1||m.available>2&&m.cfg_priority>=2));else{var l=o.isinstalled_cache;if(l<0&&(l=EngineIsInstalled(u.name,e,h)),l<0)return 0;o.isinstalled_cache=l,0===l?u.available=0:2===l&&(u.available=3)}}}if(avoidflashpopup>1&&e>0){var d=GetEngine("flash"),h=HasUsableEngine(d);if(d.available_old>2?d.available=d.available_old:0==d.available_old&&h&&(d.available=d.available_old),d.available<1||d.available>2);else{var g=GetEngine("webrtc"),m=GetEngine("service"),u=GetEngine("java");if((1==d.available||2==d.available)&&d.cfg_priority<=2&&(g.available>2&&g.cfg_priority>=2&&g.serversupport<=1||m.available>2&&m.cfg_priority>=2||u.available>2&&u.cfg_priority>=2));else{var l=o.isinstalled_cache;if(l<0&&(l=EngineIsInstalled(d.name,e,h)),l<0)return 0;o.isinstalled_cache=l,0==l?d.available=0:2==l&&(d.available=3)}}}for(var r=0;r<engines.length;r++)if(o=engines[r],e>0&&o.name.indexOf("_avail")<0&&(o.available_old=o.available,SaveCfgOldAvailable(o.name,o.available)),o.cfg_priority<1)o.finalscore=0;else{switch(o.available){case 0:o.finalscore=10;break;case 1:o.finalscore=25;break;case 2:o.finalscore=35;break;case 3:o.finalscore=60;break;default:o.finalscore=25}switch(!0===NSMacLinEnabled()||"ns"===o.name&&"Windows"!==GetOs()&&(o.finalscore=0),o.cfg_priority){case 1:o.finalscore*=.75;break;case 3:o.finalscore*=1.66;break;case 4:o.finalscore*=2.5}switch(o.defpriority<=3?o.finalscore*=.1:o.defpriority<=4?o.finalscore*=.2:o.defpriority<=6?o.finalscore*=.3:o.defpriority<=15?o.finalscore*=.4:o.defpriority<=25?o.finalscore*=.8:o.defpriority<=30?o.finalscore*=.9:o.defpriority<=35||(o.defpriority<=45?o.finalscore*=1.2:o.defpriority<=55?o.finalscore*=1.35:o.finalscore*=1.45),o.serversupport){case 0:o.finalscore*=1.1;break;case-1:case 2:o.finalscore*=.7;break;case 3:o.finalscore*=.4;break;case 4:o.finalscore*=.2}IsMizuPublicWebRTCGateway()||(o.finalscore*=1.5),o.clicked>0&&(o.clicked=0,o.finalscore*=1.25),webphone_api.global.lastengine_started_ok.length>0&&webphone_api.global.lastengine_started_ok===o.name&&(o.finalscore*=1.1),o.failed&&o.finalscore>13&&(o.finalscore=13),lversion<1&&"java"!==o.name&&(o.finalscore*=.8)}if(e>0&&!0===CanIUseService()){var b=GetEngine("ns"),_=GetEngine("webrtc");if(GetParameterInt("enginepriority_ns",2)>=GetParameterInt("enginepriority_webrtc",2)){var f=b.finalscore;if(_.failed>0&&IsNumber(f)){for(var r=0;r<engines.length;r++)o=engines[r],"ns"===o.name||o.name.indexOf("_avail")>0||o.finalscore>=f&&(f=o.finalscore+1);b.finalscore=f,SetEngine("ns",b)}}}if(e>0&&!0===CanIUseService()&&!1===IsHttps()&&!0===UseTLSReload()&&("Chrome"===GetBrowser()||"Safari"===GetBrowser()||"Firefox"===GetBrowser()&&GetBrowserVersion()>=68)){var b=GetEngine("ns"),_=GetEngine("webrtc");if(GetParameterInt("enginepriority_ns",2)>=GetParameterInt("enginepriority_webrtc",2)){var f=1.1*b.finalscore;SetEngine("ns",b),(!0===webphone_api.global.usestorage||Strl(90))&&!1===GetParameterBool("reloadalertdisplayed",!0)&&(AlertDialog(webphone_api.stringres.get("warning"),webphone_api.stringres.get("chrome_https")),PutToDebugLog(2,"WARNING, "+webphone_api.stringres.get("chrome_https")),SaveParameter("reloadalertdisplayed","true"))}}var w,v=null;w=-1e3;for(var r=0;r<engines.length;r++)o=engines[r],"java_avail"!==o.name&&"ns_avail"!==o.name&&"app_avail"!==o.name&&o.finalscore>w&&(w=o.finalscore,v=o);if(isNull(v))return PutToDebugLog(2,"No best engine"),1;if("webrtc"===v.name&&!0===CanIUseService()&&GetEngine("ns").finalscore>15&&GetParameterInt("enginepriority_ns",2)>GetParameterInt("enginepriority_webrtc",2)+1&&!0===GetParameterBool("isfirststart",!0)){PutToDebugLog("EVENT, Engineselect switch to NS because it has higher priority");for(var P=GetEngine("ns").finalscore,E=GetEngine("webrtc").finalscore,r=0;r<engines.length;r++)"ns"===engines[r].name&&(engines[r].finalscore=E),"webrtc"===engines[r].name&&(engines[r].finalscore=P);v=GetEngine("ns")}v.finalscorex=v.finalscore,recommend_engine=null,selected_engine=v,selected_engine.pushlevel=1;var T=null;w=-1e3;for(var r=0;r<engines.length;r++)o=engines[r],o.finalscorex=o.finalscore,o!==v&&"java_avail"!==o.name&&"ns_avail"!==o.name&&"app_avail"!==o.name&&(!(v.finalscorex>40)||"ns"!==v.name&&"app"!==v.name||"ns"!==o.name&&"app"!==o.name)&&(!(v.finalscorex>50)||"java"!==v.name&&"ns"!==v.name&&"app"!==v.name||"java"!==o.name&&"ns"!==o.name&&"app"!==o.name||(o.finalscorex=.75*o.finalscorex),o.finalscorex>w&&(w=o.finalscorex,T=o));var N=null;w=-1e3;for(var r=0;r<engines.length;r++)o=engines[r],"java_avail"!==o.name&&"ns_avail"!==o.name&&"app_avail"!==o.name||o.name!==v.name+"_avail"&&(v.finalscorex>40&&("ns"===v.name||"app"===v.name)||(v.finalscorex>50&&("java"===v.name||"ns"===v.name||"app"===v.name)&&(o.finalscorex=.75*o.finalscorex),o.finalscorex>w&&(w=o.finalscorex,N=o)));if("webrtc"===v.name||"flash"===v.name||"p2p"===v.name||"accessnum"===v.name||"nativedial"===v.name)selected_engine.pushlevel=1;else switch(v.available){case 0:selected_engine.pushlevel=5;break;case 1:selected_engine.pushlevel=4;break;case 2:selected_engine.pushlevel=3;break;case 3:selected_engine.pushlevel=1}var N=null;if(w=-1e3,e>0)try{for(var S="",r=0;r<engines.length;r++)o=engines[r],o.name.indexOf("_avail")>0||(S.length>0&&(S+="\r\n"),S+="EngineSelectPriority: "+o.name+": "+o.finalscorex+" (available: "+o.available+", cfg_priority: "+o.cfg_priority+", defpriority: "+o.defpriority+", serversupport: "+o.serversupport+", finalscore: "+o.finalscore+", pushlevel: "+o.pushlevel+", failed: "+o.failed+", clicked: "+o.clicked+", issupported_cache: "+o.issupported_cache+", isinstalled_cache: "+o.isinstalled_cache+", serversupport_cache: "+o.serversupport_cache+", available_old: "+o.available_old+", asyncreqbegintime: "+o.asyncreqbegintime+")");!isNull(S)&&S.length>0&&PutToDebugLog(2,"EVENT\r\n"+S)}catch(R){}if(isNull(T)&&isNull(N))return PutToDebugLog(2,"recommended engine result: same as selected"),1;if(isNull(T)&&!isNull(N)?T=N:!isNull(T)&&isNull(N)||T.finalscorex>50||T.finalscorex>.8*N.finalscorex||(T=N),isNull(T))return PutToDebugLog(2,"recommended engine result: null"),1;if(v.finalscorex>60)return PutToDebugLog(2,"recommended engine result: not needed1 "+v.finalscorex+"       "+TestEngineToString(T,!1)),1;if(T.finalscorex<15&&T.available<1)return PutToDebugLog(2,"recommended engine result: not needed3 "+v.finalscorex+"       "+TestEngineToString(T,!1)),1;if(v.finalscorex>22&&T.finalscorex<=10)return PutToDebugLog(2,"recommended engine result: not needed3 "+v.finalscorex+"       "+TestEngineToString(T,!1)),1;if(v.finalscorex>30&&v.finalscorex>1.35*T.finalscorex)return PutToDebugLog(2,"recommended engine result: not needed2 "+v.finalscorex+" > "+1.35*T.finalscorex+"       "+TestEngineToString(T,!1)),1;recommend_engine=T;var I=3;if(v.finalscorex<20&&recommend_engine.finalscorex>=60?I=6:v.finalscorex<30&&recommend_engine.finalscorex>50?I=5:v.finalscorex>60||v.finalscorex>50&&recommend_engine.finalscorex<30||v.finalscorex>2*recommend_engine.finalscorex?I=0:recommend_engine.finalscorex>15&&recommend_engine.finalscorex>v.finalscorex&&(v.finalscorex<30||v.finalscorex<35&&recommend_engine.finalscorex>45||recommend_engine.finalscorex>2*v.finalscorex||recommend_engine.finalscorex-v.finalscorex>25)?I=4:v.finalscorex>55&&v.finalscorex>.9*recommend_engine.finalscorex&&(I=2),recommend_engine.name.indexOf("_avail")>0){PutToDebugLog(2,"adjusting from virtual engine "+TestEngineToString(recommend_engine,!1));for(var C=recommend_engine.name.substring(0,recommend_engine.name.indexOf("_avail")),r=0;r<engines.length;r++)if(o=engines[r],o.name===C){recommend_engine=o;break}}recommend_engine.pushlevel=I,recommend_engine===selected_engine&&(recommend_engine=null)}catch(G){PutToDebugLogException(2,"common: EngineSelect",G)}return 1}function TestEngineToString(e,t){try{if(isNull(e))return"engine not set";var n=e.name;return t&&(n=n.toUpperCase()),n+"> cfgpriority: "+e.cfg_priority+", available: "+e.available+", serversupport: "+e.serversupport+", finalscore: "+e.finalscore+" ("+e.finalscorex+"), pushlevel: "+e.pushlevel+" "+TestPushLevelToString(e.pushlevel)}catch(o){PutToDebugLogException(2,"common: TestEngineToString",o)}}function TestPushLevelToString(e){try{switch(e){case-1:return"not set";case 0:return"no";case 1:return"just use";case 2:return"barely mention";case 3:return"mention on login/settings page";case 4:return"offer also after login";case 5:return"always ask for";case 6:return"force (allow only this)";default:return"unknown"}}catch(t){PutToDebugLogException(2,"common: TestPushLevelToString",t)}}function CheckInternetConnection(){try{if(0===GetParameterInt("networkchecks",1))return;if(!0===IsLocalServer())return;if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return;isNull(contimer)&&(contimer=setInterval(function(){if(++ccmaxloop>100)return isNull(contimer)||clearInterval(contimer),contimer=null,void(ccmaxloop=0);webphone_api.$(".messagePopup").is(":visible")||(isNull(contimer)||clearInterval(contimer),contimer=null,ccmaxloop=0,"undefined"!=typeof navigator.onLine&&null!==navigator.onLine?!1===navigator.onLine&&(ShowToast(webphone_api.stringres.get("connection_msg")+"_2",5e3),PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("connection_msg")+"_2"),PutToDebugLog(2,"ERROR, CheckInternetConnection No internet connection is available at this time")):PutToDebugLog(2,"EVENT, CheckInternetConnection could NOT check"))},1e3))}catch(e){PutToDebugLogException(2,"common: CheckInternetConnection",e)}}function CheckInternetConnectionWS(){try{var e=GetParameterInt("networkchecks",1);if(0===e)return;if(lastnetsucceded>0&&GetTickCount()-lastnetsucceded<6e5)return;if(lastgood_set=!1,good_succeded=!1,e<2&&GetLogLevel()<2)return void PutToDebugLog(2,"EVENT, skip CheckInternetConnectionWS because loglevel is 1");var t=GetParameter("wstestservers");if(isNull(t)||t.length<3||"null"===t.toLowerCase())return void PutToDebugLog(2,"EVENT, CheckInternetConnectionWS no websocket addresses");if(!0===IsLocalServer())return;var n=t.split(",");if(isNull(n)||n.length<1)return void PutToDebugLog(2,"ERROR, CheckInternetConnectionWS list is NULL");if(!1===GetParameterBool("wseverconnected",!1))return void PutToDebugLog(2,"EVENT, skip CheckInternetConnectionWS because no previous sucessfull WebSocket connection");var o=GetParameter("lastgood_wstest");isNull(o)&&(o="");for(var i=0;i<n.length;)isNull(n[i])||n[i].length<3?n.splice(i,1):(!0===BrowserRequiresHttps(!1)&&(n[i]=n[i].replace("ws:","wss:")),i++);if(isNull(n)||n.length<1)return void PutToDebugLog(3,"WARNING, CheckInternetConnectionWS list is NULL after checksplit");o.length>0&&n.unshift(o);var a=1;webphone_api.global.domloaded_tick>0&&GetTickCount()-webphone_api.global.domloaded_tick<2e4&&(a=2e4-(GetTickCount()-webphone_api.global.domloaded_tick))<1&&(a=1),isNull(wsconn_timer)||clearTimeout(wsconn_timer),wsconn_timer=null,wsconn_timer=setTimeout(function(){try{if(PutToDebugLog(2,"EVENT, CheckInternetConnectionWS start: "+n.length.toString()),n.length>0){ws1ok=-1;var e=new WebSocket(n[0]);e.onopen=function(){ws1ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",n[0]),lastgood_set=!0),good_succeded=!0,PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(1)"),e&&e.close&&e.close(),e=null},e.onclose=function(){e=null},e.onerror=function(t){ws1ok=0,e=null}}setTimeout(function(){if(!1===good_succeded){if(n.length>1){ws2ok=-1;var e=new WebSocket(n[1]);e.onopen=function(){ws2ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",n[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(2)"),e&&e.close&&e.close(),e=null},e.onclose=function(){e=null},e.onerror=function(t){ws2ok=0,e=null}}if(n.length>2){ws3ok=-1;var t=new WebSocket(n[2]);t.onopen=function(){ws3ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",n[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(3)"),t&&t.close&&t.close(),t=null},t.onclose=function(){t=null},t.onerror=function(e){ws3ok=0,t=null}}if(n.length>3){ws4ok=-1;var o=new WebSocket(n[2]);o.onopen=function(){ws4ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",n[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(4)"),o&&o.close&&o.close(),o=null},o.onclose=function(){o=null},o.onerror=function(e){ws4ok=0,o=null}}}},1200),isNull(cic_timer)||clearTimeout(cic_timer),cic_timer=null,cic_timer=setTimeout(function(){PutToDebugLog(2,"EVENT, CheckInternetConnectionWS result: con1: "+ws1ok.toString()+"; con2: "+ws2ok.toString()+"; con3: "+ws3ok.toString()),-1!==ws1ok&&0!==ws1ok||-1!==ws2ok&&0!==ws2ok||-1!==ws3ok&&0!==ws3ok||-1!==ws4ok&&0!==ws4ok?lastnetsucceded=GetTickCount():(ShowToast(webphone_api.stringres.get("connection_msg"),5e3),PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("connection_msg")),PutToDebugLog(2,"ERROR, CheckInternetConnectionWS.onerror, public Internet connection NOT available")),lastgood_set=!1},3500)}catch(t){PutToDebugLogException(2,"common: CheckInternetConnectionWS inner timer",t)}},a)}catch(r){PutToDebugLogException(2,"common: CheckInternetConnectionWS",r)}}function GetAvailableCallfunctions(){var e="callforward,conference,transfer,numpad,mute,hold,chat";if(!0===CanIUseVideo()&&(e+=",video"),0===GetParameterInt("conferencetype",1)&&(e=e.replace("conference,","")),!1===Glcf()&&(e=e.replace("conference,","")),!1===Glvd()&&(e=e.replace("video,",""),e=e.replace(",video","")),lversion<2&&(e="callforward,transfer,numpad,mute,hold,chat"),!1===Glt()&&(e=e.replace("callforward,",""),e=e.replace("transfer,","")),GetParameterInt("featureset",10)<10&&(e="numpad,mute,chat"),5===GetParameterInt("defmute",0)&&(e=e.replace("mute,",""),e=e.replace(",mute",""),e=e.replace("mute","")),getuseengine()===webphone_api.global.ENGINE_WEBRTC&&"Firefox"===GetBrowser()&&GetBrowserVersion()>=63){var t=ParamAsInt(GetParameter2("fasthold"),-1);1===t?e=e.replace("mute,",""):-1===t&&getuseengine()===webphone_api.global.ENGINE_WEBRTC&&"Firefox"===GetBrowser()&&(e=e.replace("mute,",""))}else getuseengine()===webphone_api.global.ENGINE_FLASH&&(e="transfer,numpad,chat",lversion<1&&(e=e.replace("transfer,","")));var n=e.split(",");if(!isNull(n)&&n.length>0){e="";for(var o=0;o<n.length;o++)isNull(n[o])||n[o].length<1||!1===HideSettings(n[o],webphone_api.stringres.get("sett_display_name_"+n[o]),n[o],!0)&&(e.length>0&&(e+=","),e+=n[o])}return e}function UploadAutoprov(){try{var e="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xautoprovpush",t="";if(isNull(webphone_api.global.settmap2))return void PutToDebugLog(2,"ERROR, common: UploadAutoprov no settins to be uploaded (1)");for(var n in webphone_api.global.settmap2)if(!(isNull(n)||n.length<1||"enablepush"===n)){var o=webphone_api.global.settmap2[n];t.length>0&&(t+="\r\n"),t=t+n+";"+o[SETT_VALUE]}var i=location.href;i=decodeURIComponent(i);var a=i.indexOf("?");if(a>0&&(i=i.substring(0,a)),a=i.indexOf("#"),a>0&&(i=i.substring(0,a)),a=i.lastIndexOf("."),a>0&&i.length-a<7&&(a=i.lastIndexOf("/"))>0&&(i=i.substring(0,a)),i+="/webphone_api.js",PutToDebugLog(2,"EVENT, UploadAutoprov pathtowpapi: "+i),t+="\r\n",t=t+"pathtowpapi;"+i,isNull(t)||t.length<10)return void PutToDebugLog(2,"ERROR, common: UploadAutoprov no settins to be uploaded (2)");t="aenc_10_"+StrEc(t,webphone_api.global.ec_autoprov,!0),t="WPAUTOPROVSTART"+t+"WPAUTOPROVEND",!0===IsHttps()&&(e=GetTlsProxyUrl(e)),PutToDebugLog(2,"EVENT, UploadAutoprov url: "+e),HttpRequest(e,"wpautoprov",!0,t)}catch(r){PutToDebugLogException(2,"common: UploadAutoprov",r)}}function SendLog(e){try{if(isNull(e))return void PutToDebugLog(1,"ERROR, common: SendLog no logs to be sent");HttpRequest("http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xlogpush","wpsendlog",!0,e)}catch(t){PutToDebugLogException(2,"common: SendLog",t)}}function GetColortheme(){try{var e=GetParameter("theme");(isNull(e)||e.length<1)&&(e=GetConfig("colortheme")),isNull(webphone_api.parameters.theme)||(e=webphone_api.parameters.theme),isNull(webphone_api.parameters.colortheme)||(e=webphone_api.parameters.colortheme),(isNull(e)||e.length<1)&&(e="0");var t=0;try{t=StrToInt(e)}catch(n){}return(isNull(t)||t<0||t>100)&&(t=0),t}catch(o){PutToDebugLogException(2,"common: GetColortheme",o)}return 0}function SetCurrTheme(){try{if(1==IsSDK())return;if(isNull(document.getElementById("colortheme"))){webphone_api.$("<style />").appendTo("head").attr("id","colortheme")}var e=GetColortheme();if(0===e){webphone_api.$("#colortheme").html("");return"MSIE"!==GetBrowser()&&"Edge"!==GetBrowser()||webphone_api.$("#colortheme").html("#phone_app_main_container{scrollbar-face-color: #151515;scrollbar-base-color: #1d1d1d;scrollbar-3dlight-color: #1d1d1d;scrollbar-highlight-color: #1d1d1d;scrollbar-track-color: #3c3c3c;scrollbar-arrow-color: #000000;scrollbar-shadow-color: #1d1d1d;scrollbar-dark-shadow-color: #1d1d1d;"),void(CanLog(4)&&PutToDebugLog(4,"EVENT, SetCurrTheme, default theme"))}var t=webphone_api.themes.gettheme("theme_"+e);if(isNull(t))return void PutToDebugLog(2,"WARNING, common: SetCurrTheme no available theme "+t);var n=t.bgcolorheader,o=t.bgcolor,i=t.scrollbarcolor,a=t.listbgcolor,r=t.listitembgcolor,s=t.buttoncolor,l=t.buttonhover,p=t.buttonbordercolor,c=t.tabcolor,u=t.tabselectedcolor,h=t.bgdialpadnrfield,g=t.bgdialpadbtn,m=t.bgdialpadfooter,d=t.fontctheme,b=t.fontcwhite,_=t.fontfamily;if(isNull(n.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid bgcolorheader");if(isNull(o.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid bgcolor");if(isNull(i.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid scrollbarcolor");if(isNull(a.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid listbgcolor");if(isNull(r.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid listitembgcolor");if(isNull(s.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttoncolor");if(isNull(l.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttonhover");if(isNull(p.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttonbordercolor");if(isNull(c.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid tabcolor");if(isNull(u.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid tabselectedcolor");if(isNull(d.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid fontctheme");if(isNull(b.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid fontcwhite");isNull(_)&&(_="sans-serif"),PutToDebugLog(4,"EVENT, SetCurrTheme, applying color theme");webphone_api.$("#js_not_enabled_settings").css("background-color",o),webphone_api.$("#js_not_enabled_dialpad").css("background-color",o),webphone_api.$("#js_not_enabled").css("background-color",o),webphone_api.$("#choose_engine").css("background-color",o),webphone_api.$("#colortheme").html("");var f="";f+=".ui-overlay-b .ui-content, .ui-content, .all_app_pages, .ui-body-b, .ui-page-theme-b .ui-body-inherit, html .ui-bar-b .ui-body-inherit, html .ui-body-b .ui-body-inherit, html body .ui-group-theme-b .ui-body-inherit, html .ui-panel-page-container-b { background-color: "+o+"; }",f+="#phone_app_main_container { background-color: "+o+" !important;}","MSIE"!==GetBrowser()&&"Edge"!==GetBrowser()||(f+="body{scrollbar-face-color: #151515;scrollbar-base-color: "+o+";scrollbar-3dlight-color: "+o+";scrollbar-highlight-color: "+o+";scrollbar-track-color: #3c3c3c;scrollbar-arrow-color: #000000;scrollbar-shadow-color: "+o+";scrollbar-dark-shadow-color: "+o+";}"),f+="#phone_app_main_container ::-webkit-scrollbar { background: "+o+"; }#phone_app_main_container ::-webkit-scrollbar-thumb { background: "+i+"; }#phone_app_main_container ::-webkit-scrollbar-corner { background: #000; }",f+="#page_call_content #page_call_additional_info, #page_call_content #page_call_peer_details { color: "+b+"; }",f+=".ui-body-b,.ui-page-theme-b .ui-body-inherit,html .ui-bar-b .ui-body-inherit,html .ui-body-b .ui-body-inherit,html body .ui-group-theme-b .ui-body-inherit,html .ui-panel-page-container-b { background-color: "+a+"; text-shadow:0 0 0; }",f+=".mlistview .mlistitem { background-color: "+r+" !important; text-shadow:0 0 0; }",f+=".mlistview .mlistitem:hover { background-color: "+l+" !important; text-shadow:0 0 0; }",f+=".ui-page-theme-b .ui-btn,html .ui-bar-b .ui-btn,html .ui-body-b .ui-btn,html body .ui-group-theme-b .ui-btn,html head + body .ui-btn.ui-btn-b,.ui-page-theme-b .ui-btn:visited,html .ui-bar-b .ui-btn:visited,html .ui-body-b .ui-btn:visited,html body .ui-group-theme-b .ui-btn:visited,html head + body .ui-btn.ui-btn-b:visited {background-color: "+s+"; border-color: "+p+"; color: "+b+"; text-shadow:0 0 0; }",f+="#page_contactdetails_content .cd_container, #page_callhistorydetails_content .ch_container { border-bottom: .1em solid "+p+"; }",f+=".ui-page-theme-b .ui-btn:hover,html .ui-bar-b .ui-btn:hover,html .ui-body-b .ui-btn:hover,html body .ui-group-theme-b .ui-btn:hover,html head + body .ui-btn.ui-btn-b:hover,.ui-page-theme-b .ui-btn:active,html .ui-bar-b .ui-btn:active,html .ui-body-b .ui-btn:active,html body .ui-group-theme-b .ui-btn:active,html head + body .ui-btn.ui-btn-b:active {background-color: "+l+"; border-color: "+p+"; color: "+b+"; text-shadow:0 0 0; }",f+=".additional_header_left .btn_header_back SPAN { color: "+b+"; }",f+=".ui-bar-b,.ui-page-theme-b .ui-bar-inherit,html .ui-bar-b .ui-bar-inherit,html .ui-body-b .ui-bar-inherit,html body .ui-group-theme-b .ui-bar-inherit {background-color: "+n+"; border-color: "+o+"; color: "+b+";text-shadow: 0 0 0; }",f+=".navigation_bar .ui-btn {background-color: "+c+" !important; border-color: #125d79;color: "+b+"; text-shadow: 0 0 0; }",f+=".navigation_bar .ui-btn.ui-btn-active {background-color: "+u+" !important; border-color: #125d79;color: "+b+"; text-shadow: 0 0 0; }",f+="#phone_number_container { background: "+h+"; }",f+="#dialpad_btn_grid, #numpad_btn_grid { background: "+g+"; }",f+="#dialpad_call_grid { background: "+m+"; }",f+="#page_dialpad_content #phone_number_container .ui-btn:hover, #dialpad_btn_grid .ui-btn:hover, #dialpad_footer .ui-btn:hover { background: "+l+"; filter: Alpha(Opacity=5); opacity: .5; }",22===GetColortheme()?(f+="#contact_name, #ch_contact_name { background: "+c+"; }",f+="#dialpad_btn_grid .ui-btn .number, #numpad_btn_grid .ui-btn .number { font-size: 2.6em; font-family: Courier New, Courier, Helvetica, Lucida Sans Unicode, Trebuchet MS; }",f+="#dialpad_footer #dialpad_call_grid #btn_call .ui-btn:hover { background: "+l+"; }",f+=".navigation_bar .ui-btn.ui-btn-active { background-color: #ffffff !important; }",f+="#page_contactdetails_content .cd_call:hover, #page_contactdetails_content .cd_msg:hover, #page_callhistorydetails_content .ch_call:hover, #page_callhistorydetails_content .ch_msg:hover { background:#e8e8e8 !important; filter: Alpha(Opacity=7) !important; opacity: .7 !important; }"):f+="#contact_name, #ch_contact_name { background: "+m+"; }",f+="#page_call_content #callfunctions_layout { background: "+m+"; }",f+=".page_title, .additional_header_middle, .additional_header_left SPAN, .additional_header_left .page_title_small, #page_dialpad_content .ch_numberonly, #page_dialpad_content .ch_data .ch_name, #page_dialpad_content .ch_ctname, #page_contactdetails_content .cd_number, #page_callhistorylist_content .ch_data .ch_name, #page_callhistorydetails_content .ch_number, UL#settings_list .sett_display_name, .ui-header H1.adialog_title, #page_addeditcontact_content .aec_label, #page_messagelist_content #btn_newmessage, #page_messagelist_content .msg_name, #page_newuser_content SPAN, .notification_list .nt_title { color: "+d+"; }",f+=d===g?"#dialpad_btn_grid .ui-btn SPAN, #numpad_btn_grid .ui-btn SPAN{ color: "+b+"; }":"#dialpad_btn_grid .ui-btn SPAN, #numpad_btn_grid .ui-btn SPAN{ color: "+d+"; }",f+="#sendtosupport_container #btn_sendlog { background: "+d+"; }",f+=".all_app_pages .notification:hover, #page_contactdetails_content .cd_call:hover, #page_contactdetails_content .cd_msg:hover, #page_callhistorydetails_content .ch_call:hover, #page_callhistorydetails_content .ch_msg:hover, #callfunctions_layout .callfunc_status_on, #callfunctions_layout .ui-btn:hover { background: "+d+"; }",f+=".ui-page .ui-header, .ui-page .ui-bar-b { background-color: "+n+" !important; }",f+=".separator_color_bg { background-color: "+p+" !important; }",f+="#phone_number_container .ui-input-text, #page_contactslist_content .ui-input-search, #contact_name, #page_contactdetails_content .cd_type, #page_contactdetails_content .cd_button, #ch_contact_name, #page_callhistorydetails_content .ch_type { color: "+b+"; }",webphone_api.$("#colortheme").html(f)}catch(w){PutToDebugLogException(2,"common: SetCurrTheme",w)}}
function NeedRegister(){try{var e=GetParameter("register");if("0"===e)return!1;if("2"===e)return!0;if("1"===e){var t=GetSipusername(),n=GetParameter("password");return t.length>0&&n.length>0}}catch(o){PutToDebugLogException(2,"common: NeedRegister",o)}return!0}function IsDomainName(e){try{if(isNull(e)||e.length<1)return!1;var t=e.indexOf("://");if(t>=0&&(e=e.substring(t+3)),t=e.indexOf("/"),t>=0&&(e=e.substring(0,t)),e=Trim(e),isNull(e)||e.length<1)return!1;if("localhost"===(e=e.toLowerCase()))return!0;var n=e.lastIndexOf(".");return!(n<2)&&(e=e.substr(n+1),!(e.length<2||e.length>3)&&("com"===e||"net"===e||"org"===e||"gov"===e||"ro"===e||"hu"===e||"ru"===e||"biz"===e||"edu"===e||"mil"===e||"de"===e||"in"===e||"it"===e||"uk"===e))}catch(o){PutToDebugLogException(2,"common: IsDomainName",o)}return!1}function IsIPAddrress(e){try{if(isNull(e)||e.length<1)return!1;var t=e.indexOf("://");if(t>=0&&(e=e.substring(t+3)),t=e.indexOf("/"),t>=0&&(e=e.substring(0,t)),e=Trim(e),isNull(e)||e.length<1)return!1;for(var n=0,o=0;o<e.length;o++)"."==e.charAt(o)&&++n;return 3==n&&(e=ReplaceAll(e,".",""),e=ReplaceAll(e," ",""),e=ReplaceAll(e,":",""),IsNumber(e))}catch(i){PutToDebugLogException(2,"common: IsIPAddrress",i)}return!1}function IsLanIP(e,t){if(IsLanIPEx(e)>0)return!0;if(!isNull(t)){if(!0===t)return!0;if(!1===t)return!1}return!1}function IsLanIPEx(e){try{if(isNull(e))return-1;if(e=e.toString(),e.length<5)return-1;if("mnt.mizu-voip.com"===e||"rtc.mizu-voip.com"===e||"usrtc3.webvoipphone.com"===e||"usrtcx.webvoipphone.com"===e||"usrtc.webvoipphone.com"===e||"www.webvoipphone.com"===e||"www.mizu-voip.com"===e||"fcm.webvoipphone.com"===e||"voip.mizu-voip.com"===e||"sip.mizu-voip.com"===e)return 0;if(IsIPAddrress(e)||(isNull(dtisrvcache)||isNull(dtisrvcache[e.toLowerCase()])||!IsIPAddrress(dtisrvcache[e.toLowerCase()])?e===GetConfig("knowndomain")&&!isNull(GetConfig("knownip"))&&IsIPAddrress(GetConfig("knownip"))?e=GetConfig("knownip"):lasttrytoresolveadd&&lasttrytoresolveadd.length>0&&lasttrytoresolveadd.toLowerCase()!==e.toLowerCase()&&(isNull(dtisrvcache)||isNull(dtisrvcache[e.toLowerCase()]))&&(lasttrytoresolveadd=e,DomainToIpServer(e,function(e){})):e=dtisrvcache[e.toLowerCase()]),e=e.toLowerCase(),0===e.indexOf("192.168.")||0===e.indexOf("10.")||0===e.indexOf("172.")&&(0===e.indexOf("172.16.")||0===e.indexOf("172.17.")||0===e.indexOf("172.18.")||0===e.indexOf("172.19.")||0===e.indexOf("172.20.")||0===e.indexOf("172.21.")||0===e.indexOf("172.22.")||0===e.indexOf("172.23.")||0===e.indexOf("172.24.")||0===e.indexOf("172.25.")||0===e.indexOf("172.26.")||0===e.indexOf("172.27.")||0===e.indexOf("172.28.")||0===e.indexOf("172.29.")||0===e.indexOf("172.30.")||0===e.indexOf("172.31."))||0===e.indexOf("169.254.")||0===e.indexOf("127.")||0===e.indexOf("0.")||"4.3.2.1"===e||"9.8.7.6"===e||0===e.indexOf("192.0.0.")||0===e.indexOf("192.0.2.")||e.indexOf("intranet")>=0||e.indexOf("private")>=0||e.indexOf("inner")>=0||e.indexOf("intern")>=0||e.indexOf(".lan")>=0||e.indexOf("local")>=0)return 1;if(0===e.indexOf("ERROR")||e.indexOf("cannotresolve")>=0)return-1;if(e.indexOf(".")<0)return 1;if(IsIPAddrress(e))return 0;if(e.indexOf("mizu-voip.com")>=0||e.indexOf("google.com")>=0)return 0}catch(t){PutToDebugLogException(2,"common: IsLanIP",t)}return-1}function IsLocalUpperServer(){try{var e=GetWsuserUrl(GetSipusername(),GetParameter("password"));if(!isNull(e)&&e.indexOf("upperserver=")>0&&(e=e.substring(e.indexOf("upperserver=")+12),e.indexOf("&")>=0&&(e=e.substring(0,e.indexOf("&"))),!isNull(e)&&e.length>0&&1===IsLanIPEx(e)))return!0}catch(t){PutToDebugLogException(2,"common: IsLocalUpperServer",t)}return!1}function IsLocalServer(e){try{(isNull(ils_srv1)||ils_srv1.length<1)&&(ils_srv1=GetParameter("serveraddress_user")),(isNull(ils_srv2)||ils_srv2.length<1)&&(ils_srv2=GetParameter("serveraddress_orig")),(isNull(ils_srv3)||ils_srv3.length<1)&&(ils_srv3=GetParameter("serveraddress"));var t=GetConfig("serverip");isNull(t)&&(t=""),t=Trim(t);var n=GetConfig("server");isNull(n)&&(n=""),n=Trim(n);var o=GetConfig("knownip");if(isNull(o)&&(o=""),o=Trim(o),t.length>0||n.length>0||o.length>0)return!!(t.length>0&&IsIPAddrress(t)&&1==IsLanIPEx(t))||(!!(n.length>0&&IsIPAddrress(n)&&1==IsLanIPEx(n))||(!!(o.length>0&&IsIPAddrress(o)&&1==IsLanIPEx(o))||!(t.length>0&&IsIPAddrress(t)&&0==IsLanIPEx(t))&&(!(n.length>0&&IsIPAddrress(n)&&0==IsLanIPEx(n))&&(!(o.length>0&&IsIPAddrress(o)&&0==IsLanIPEx(o))&&(!!(t.length>0&&IsIPAddrress(t)&&IsLanIP(t))||(!!(n.length>0&&IsIPAddrress(n)&&IsLanIP(n))||!!(o.length>0&&IsIPAddrress(o)&&IsLanIP(o))))))));if(!isNull(alsv)&&alsv.length>0){var i=StrDc(alsv,alsvkey),a=i.split(",");if(!isNull(a)&&a.length>0){var r=!0,s=!0,l=!1,p=!1,c=[];c.push("l"),c.push("a"),c.push("n"),c.push("i"),c.push("p");var u=c.join("");c=[],c.push("l"),c.push("o"),c.push("c"),c.push("a"),c.push("l"),c.push("f"),c.push("i"),c.push("l"),c.push("e");var h=c.join("");c=[],c.push("l"),c.push("o"),c.push("c"),c.push("a"),c.push("l");var g=c.join("");c=[],c.push("l"),c.push("o"),c.push("c"),c.push("a"),c.push("l"),c.push("h"),c.push("o"),c.push("s"),c.push("t");for(var m=c.join(""),d=-1,b=0;b<a.length;b++)isNull(a[b])||Trim(a[b]).length<1||(a[b]=Trim(a[b]),a[b]!==u?a[b]!==h&&a[b]!==g&&a[b]!==u&&a[b]!==m&&"127.0.0.1"!==a[b]&&"file"!==a[b]&&(IsIPAddrress(a[b])?a[b].length<1||0!==(d=IsLanIPEx(a[b]))&&1!==d||(l=!0,p=!0,1==d?s=!1:0==d&&(r=!1)):a[b]=HostToIPQuick(a[b])):(l=!0,s=!1));if(!0===l&&!0===r)return!0;if(!0===p&&!0===s)return!1}}if(ils_srv1.length>0&&!IsIPAddrress(ils_srv1)&&DomainToIp(ils_srv1,function(e){ils_srv1=e}),ils_srv2.length>0&&!IsIPAddrress(ils_srv1)&&DomainToIp(ils_srv2,function(e){ils_srv2=e}),ils_srv3.length>0&&!IsIPAddrress(ils_srv3)&&DomainToIp(ils_srv3,function(e){ils_srv3=e}),!0===e){var _="",f="",w="",v=GetParameter("serveraddress_user");!isNull(v)&&v.length>0&&(_=DomainToIp(v,function(){}),isNull(_)&&(_=""));var P=GetParameter("serveraddress_orig");!isNull(P)&&P.length>0&&(f=DomainToIp(P,function(){}),isNull(f)&&(f=""));var E=GetParameter("serveraddress");return!isNull(E)&&E.length>0&&(w=DomainToIp(E,function(){}),isNull(w)&&(w="")),v.length>0&&1==IsLanIPEx(v)||(P.length>0&&1==IsLanIPEx(P)||(E.length>0&&1==IsLanIPEx(E)||(_.length>0&&1==IsLanIPEx(_)||(f.length>0&&1==IsLanIPEx(f)||(w.length>0&&1==IsLanIPEx(w)||!(v.length>0&&0==IsLanIPEx(v))&&(!(P.length>0&&0==IsLanIPEx(P))&&(!(E.length>0&&0==IsLanIPEx(E))&&(!(_.length>0&&0==IsLanIPEx(_))&&(!(f.length>0&&0==IsLanIPEx(f))&&(!(w.length>0&&0==IsLanIPEx(w))&&(!!(v.length>0&&IsLanIP(v))||(!!(P.length>0&&IsLanIP(P))||(!!(E.length>0&&IsLanIP(E))||(!(!(_.length>0)||!IsLanIP(_)&&!1!==IsIPAddrress(_))||(!(!(f.length>0)||!IsLanIP(f)&&!1!==IsIPAddrress(f))||!(!(w.length>0)||!IsLanIP(w)&&!1!==IsIPAddrress(w)))))))))))))))))}var T=GetWebrtcSrvAddr();if(T.length<2){if(ils_srv1.length>0&&1===IsLanIPEx(ils_srv1))return!0;if(ils_srv2.length>0&&1===IsLanIPEx(ils_srv2))return!0;if(ils_srv3.length>0&&1===IsLanIPEx(ils_srv3))return!0;if(ils_srv1.length>0&&0===IsLanIPEx(ils_srv1))return!1;if(ils_srv2.length>0&&0===IsLanIPEx(ils_srv2))return!1;if(ils_srv3.length>0&&0===IsLanIPEx(ils_srv3))return!1;if(ils_srv1.length>0&&(IsLanIP(ils_srv1)||!1===IsIPAddrress(ils_srv1)))return!0;if(ils_srv2.length>0&&(IsLanIP(ils_srv2)||!1===IsIPAddrress(ils_srv1)))return!0;if(ils_srv3.length>0&&(IsLanIP(ils_srv3)||!1===IsIPAddrress(ils_srv1)))return!0}else{var N=T.indexOf("://");if(N>0&&(T=T.substring(N+3)),N=T.indexOf(":"),N>0&&(T=T.substring(0,N)),N=T.indexOf("/"),N>0&&(T=T.substring(0,N)),N=T.indexOf("?"),N>0&&(T=T.substring(0,N)),!isNull(T)&&T.length>0&&!0===IsLanIP(T))return!0}}catch(S){PutToDebugLogException(2,"common: IsLanIP",S)}return!1}function GetWebdomain(){try{var e=window.location.host,t=window.location.protocol;return isNull(e)&&(e=""),isNull(t)||t.length<1?t="":t+="//",t+e}catch(n){PutToDebugLogException(2,"common: GetWebdomain",n)}return""}function GetBrandName(){try{var e="";return webphone_api.global.usestorage?(e=GetParameter("brandname"),(isNull(e)||e.length<1)&&(e=GetConfig("brandname")),(isNull(e)||e.length<1)&&(e=IsWindowsSoftphone()?"Softphone":"WebPhone")):(e=GetParameter("brandname"),(isNull(e)||e.length<1)&&(e=GetConfig("brandname")),isNull(e)&&(e="")),e}catch(t){PutToDebugLogException(2,"common: GetWebdomain",t)}return"WebPhone"}function CanShowLicKeyInput(){try{if(!IsWindowsSoftphone())return!1;if(!isNull(canshowlickeyinput)&&(!0===canshowlickeyinput||!1===canshowlickeyinput))return canshowlickeyinput;WinAPI("API_CanShowLicKeyUserInput",function(e){canshowlickeyinput=!(isNull(e)||!0!==e&&"true"!=e),SaveParameter("canshowlickeyinput",canshowlickeyinput.toString()),PutToDebugLog(4,"EVENT, common API_CanShow: "+e)})}catch(e){PutToDebugLogException(2,"common: CanShowLicKeyInput",e)}return!1}function BrowserRequiresHttps(e){try{if(UseSecureSrvConnection())return!0;var t=GetBrowser();if(!0===e){var n=window.location.href;if(isNull(n)&&(n=""),n=Trim(n.toLowerCase()),n.length<1&&(n=window.location.protocol,isNull(n)&&(n=""),n=Trim(n.toLowerCase()),n.length<1&&(n=location.href,isNull(n)&&(n=""),n=Trim(n.toLowerCase()))),n.toLowerCase().indexOf("file://")>=0)return!1;if(n.indexOf("localhost")<0&&n.indexOf("127.0.0.1")<0&&("Chrome"===t||"Safari"===t||"Firefox"===t&&GetBrowserVersion()>=68))return!0}else if("Chrome"===t||"Safari"===t||"Firefox"===t&&GetBrowserVersion()>=68)return!0}catch(o){PutToDebugLogException(2,"common: BrowserRequiresHttps",o)}return!1}function IsHttps(){try{if(!isNull(is_https))return is_https;if(!0===PreferWss())return is_https=null,!0;is_https=!1;var e=window.location.protocol;return isNull(e)&&(e=""),(e=Trim(e.toLowerCase()),(e.length<4||e.indexOf("http")<0||e.indexOf("extension")<0)&&(e=location.href,isNull(e)&&(e=""),e=Trim(e.toLowerCase())),e.length<4)?is_https=!1:((e.indexOf("https")>=0&&e.indexOf("https")<10||e.indexOf("extension")>=0&&e.indexOf("extension")<12)&&(is_https=!0),is_https)}catch(t){PutToDebugLogException(2,"common: IsHttps",t)}return!1}function UseSecureSrvConnection(){try{if(!0===PreferWss())return!0;var e=window.location.protocol;if(isNull(e)&&(e=""),e=Trim(e.toLowerCase()),(e.length<1||0!=e.indexOf("http"))&&(e=location.href,isNull(e)&&(e=""),e=Trim(e.toLowerCase()),(e.length<1||0!=e.indexOf("http"))&&(e=window.location.href,isNull(e)&&(e=""),e=Trim(e.toLowerCase()))),0==e.indexOf("https:"))return!0;var t=GetWsAddressCfg();if(isNull(t)&&(t=""),0==t.indexOf("*")&&(t=t.substring(1)),0==t.indexOf("wss:"))return!0;if(0==t.indexOf("ws:"))return!1;if(t=GetConfig("wsuser"),isNull(t)&&(t=""),0==t.indexOf("*")&&(t=t.substring(1)),0==t.indexOf("https:"))return!0;if(0==t.indexOf("http:"))return!1}catch(n){PutToDebugLogException(2,"common: UseSecureSrvConnection",n)}return IsHttps()}function PreferWss(){var e=!1;try{return!0===GetConfig("preferwss")&&(e=!0),isNull(webphone_api.parameters.preferwss)||!0!==webphone_api.parameters.preferwss&&!1!==webphone_api.parameters.preferwss||(e=webphone_api.parameters.preferwss,wsprinted||(wsprinted=!0,PutToDebugLog(3,"EVENT, PreferWss() set manually in webphone_api."))),e}catch(t){PutToDebugLogException(2,"common: PreferWss",t)}return!1}function MediaStreamPermissionDenied(){var e=GetBrandName();try{e+=" "+webphone_api.stringres.get("allowmedia_general"),1==IsSDK()?AlertDialogSDK(webphone_api.stringres.get("allowmedia_title"),e):AlertDialog(webphone_api.stringres.get("allowmedia_title"),e)}catch(t){PutToDebugLogException(2,"common: MediaStreamPermissionDenied",t)}}function GetTransferDirectoryName(e){try{var t=GetSipusername(),n=GetParameter("password"),o=GetParameter("serveraddress_user");isNull(t)&&(t=""),isNull(n)&&(n=""),isNull(o)&&(o=""),isNull(e)&&(e="");return Md5Hash(t+n+o+e+"539249178376")}catch(i){PutToDebugLogException(2,"common: GetTransferDirectoryName",i)}return""}function FileTransfer(e){try{isNull(e)&&(e=""),e=Trim(e),webphone_api.global.intentfiletransfer[0]="destination="+e,!1===IsSDK()&&webphone_api.$.mobile.changePage("#page_filetransfer",{transition:"slide",role:"page"})}catch(t){PutToDebugLogException(2,"common: FileTransfer",t)}}function GetLastUsedEngine(){var e="";try{var t=GetParameter("enginechecksum"),n=GetNewConfig(),o=Md5Hash(n);return t!==o&&(SaveParameter("enginechecksum",o),t.length>0)?(PutToDebugLog(2,"Reset lastusedengine because config changed: "+n),PutToDebugLog(2,"old checksum: "+t+"; new checksum: "+o),gcaniusewebrtc=null,gcaniuseapplet=null,gcaniuseflash=null,webphone_api.global.last_used_engine_cache="",SaveParameter("lastusedengine",""),SaveParameter("engineoldavailable_werbrtc",""),SaveParameter("engineoldavailable_ns",""),SaveParameter("engineoldavailable_java",""),SaveParameter("engineoldavailable_p2p",""),SaveParameter("engineoldavailable_app",""),SaveParameter("engineoldavailable_flash",""),SaveParameter("engineoldavailable_nativedial",""),""):(e=GetParameter("lastusedengine"),(isNull(e)||e.length<1)&&(e=webphone_api.global.last_used_engine_cache),isNull(e)&&(e=""),e)}catch(i){PutToDebugLogException(2,"common: GetLastUsedEngine",i)}return""}function IsConfigChanged(){try{if(GetParameter("enginechecksum")!==Md5Hash(GetNewConfig()))return!0}catch(e){PutToDebugLogException(2,"common: IsConfigChanged",e)}return!1}function GetNewConfig(){try{var e=location.href;isNull(e)&&(e=""),e=decodeURIComponent(e),e=e.toLowerCase();var t;t=e.indexOf("?"),t>=0&&(e=e.substring(0,t)),t=e.indexOf("#"),t>=0&&(e=e.substring(0,t)),e=Trim(e);var n=GetParameter("serveraddress_user");(isNull(n)||n.length<2)&&(n=GetParameter("serveraddress")),isNull(n)&&(n=""),n=n.toLowerCase();var o=GetWsAddressCfg(2);isNull(o)&&(o=""),o=o.toLowerCase();var i=GetProxyaddress(),a=GetParameter("transport"),r=GetParameterInt("enginepriority_java",2),s=GetParameterInt("enginepriority_webrtc",2),l=GetParameterInt("enginepriority_ns",2),p=GetParameterInt("enginepriority_flash",2),c=GetParameterInt("enginepriority_app",2),u=GetParameterInt("enginepriority_p2p",2),h=GetParameterInt("enginepriority_accessnum",2),g=GetParameterInt("enginepriority_nativedial",2),m=GetParameter("realm");isNull(m)&&(m="");var d=GetParameter("webphonebasedir");isNull(d)&&(d="");return e+":"+n+":"+o+":"+r+":"+s+":"+l+":"+p+":"+c+":"+u+":"+h+":"+g+":"+m+":"+d+":"+i+":"+a}catch(b){PutToDebugLogException(2,"common: GetNewConfig",b)}return""}function IsLastUsedEngineSaved(){return lastusedenginesaved}function SaveLastUsedEngine(){try{var e="";getuseengine()===webphone_api.global.ENGINE_JAVA?e="java":getuseengine()===webphone_api.global.ENGINE_WEBRTC?e="webrtc":getuseengine()===webphone_api.global.ENGINE_SERVICE?e="ns":getuseengine()===webphone_api.global.ENGINE_FLASH&&(e="flash"),lastusedenginesaved=!0,"Windows"===GetOs()&&"flash"===e||(SaveParameter("lastusedengine",e),!isNull(e)&&e.length>0&&(webphone_api.global.last_used_engine_cache=e),PutToDebugLog(2,"EVENT, lastusedengine saved: "+e))}catch(t){PutToDebugLogException(2,"common: SaveLastUsedEngine",t)}}function IsLocalFileSystem(){try{var e=location.protocol;if(isNull(e)&&(e=location.href,e=decodeURIComponent(e),isNull(e)||e.length<2))return!1;if(e=e.toLowerCase(),e=Trim(e),e.indexOf("file:")>=0)return!0}catch(t){PutToDebugLogException(2,"common: IsLocalFileSystem",t)}return!1}function IsLocalFileSys(){try{var e=location.protocol;if(isNull(e)&&(e=location.href,e=decodeURIComponent(e),isNull(e)||e.length<2))return!1;var t=[];t.push("f"),t.push("i"),t.push("l"),t.push("e"),t.push(":");var n=t.join("");if(e=e.toLowerCase(),e=Trim(e),e.indexOf(n)>=0)return!0}catch(o){PutToDebugLogException(2,"common: ilfs",o)}return!1}function CallScriptingUrl(e,t,n,o,i,a,r,s,l,p){try{if(isNull(e)||Trim(e).length<4)return;isNull(t)&&(t=""),isNull(n)&&(n=""),isNull(o)&&(o=""),isNull(a)&&(a=""),isNull(s)&&(s=""),isNull(l)&&(l=""),isNull(i)&&(i="");var c=GetSipusername(),u=GetParameter("password"),h=GetParameter("serveraddress"),g=RandomInt(1e4,9999999).toString(),m=Md5Hash(c+":"+u),d=Md5Hash(c+":"+u+":"+g);(isNull(r)||r.length<1)&&(r="scripting_cb"),e.indexOf("USERNAME")>0?e=e.replace("USERNAME",c):(e.indexOf("?")<0?e+="?":e+="&",e=e+"username="+c),e=e.replace("PASSWORD",u),e=e.replace("CALLEDNUMBER",o),e.indexOf("PEERNUM")>0?e=e.replace("PEERNUM",o):(e.indexOf("?")<0?e+="?":e+="&",e=e+"peernumber="+o),e.indexOf("PEERDETAILS")>0?e=e.replace("PEERDETAILS",i):(e.indexOf("?")<0?e+="?":e+="&",e=e+"peerdetails="+i),e.indexOf("SERVERADDRESS")>0?e=e.replace("SERVERADDRESS",h):(e.indexOf("?")<0?e+="?":e+="&",e=e+"server="+h),e=e.replace("DIRECTION",n),e=e.replace("STATUS",t),e=e.replace("TEXT",a),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("CONNECTTIME",s),e=e.replace("DURATION",l),e=e.replace("MD5SIMPLE",m),e=e.replace("MD5NORMAL",d),e=e.replace("MD5SALT",g),!isNull(p)&&p.length>0&&(e=e+"&cdr="+encodeURIComponent(p)),PutToDebugLogSpecial(3,"EVENT,CallScriptingUrl: "+e,!1,""),UriParser(e,"","","","",r)}catch(b){PutToDebugLogException(2,"common: CallScriptingUrl",b)}}function ShowOfferSaveContact(){try{if(webphone_api.global.lastcallduration<1)return;if(IsCExt()>0)return;if(webphone_api.global.lastcallduration=0,webphone_api.$(".ui-page-active .ui-popup-active").length>0)return;!1===webphone_api.global.contactExists&&!isNull(webphone_api.global.contactExistsNr)&&webphone_api.global.contactExistsNr.length>0&&"1"===GetParameter("savetocontacts")&&(OfferSaveContact(webphone_api.global.contactExistsNr,webphone_api.global.callName),webphone_api.global.contactExists=!0,webphone_api.global.contactExistsNr="")}catch(e){PutToDebugLogException(2,"common: ShowOfferSaveContact",e)}}function OfferSaveContact(e,t,n){try{if(!0===IsSDK())return;var o=GetDeviceWidth();if(o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,o>400?o=400:o<120&&(o=120),!isNull(webphone_api.global.lastconfroom)&&webphone_api.global.lastconfroom.length>2){var i=" "+e;if(webphone_api.global.lastconfroom.indexOf(i)>0)return}t=isNull(t)||t===e?"":"<br />"+t;var a="";a='<li id="#offer_item_save"><a data-rel="back" style="text-align: center;">'+webphone_api.stringres.get("btn_save_to_contacts_1")+"</a></li>"+('<li id="#offer_item_cancel"><a data-rel="back" style="text-align: center;">'+webphone_api.stringres.get("btn_cancel")+"</a></li>")+('<li id="#offer_item_dontask"><a data-rel="back">'+webphone_api.stringres.get("btn_save_to_contacts_dontask")+"</a></li>");var r='<div id="savetocontacts" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; min-width: "+Math.floor(.6*o)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("save_to_contacts_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><div style="text-align: center; margin-top: .5em; margin-bottom: .5em;">'+webphone_api.stringres.get("save_to_contacts_msg")+"<br />"+e+t+'</div><ul id="savetocontacts_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+a+"</ul></div></div>";savectpopup_wasclosed=!1,n=n||function(){},webphone_api.$.mobile.activePage.append(r).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),savectpopup_wasclosed=!0}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){savectpopup_wasclosed=!0,webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#savetocontacts_ul").off("click","li"),n()}}),webphone_api.$("#savetocontacts_ul").on("click","li",function(n){var o=webphone_api.$(this).attr("id");webphone_api.$("#savetocontacts").on("popupafterclose",function(n){savectpopup_wasclosed=!0,"#offer_item_save"===o&&(webphone_api.global.intentaddeditct[0]="action=add",webphone_api.global.intentaddeditct[1]="numbertoadd="+e,webphone_api.global.intentaddeditct[2]="nametoadd="+t,webphone_api.$.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})),"#offer_item_cancel"===o||"#offer_item_dontask"===o&&SaveParameter("savetocontacts","0")})}),setTimeout(function(){!1===savectpopup_wasclosed&&webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),savectpopup_wasclosed=!0,webphone_api.global.contactExists=!0,webphone_api.global.contactExistsNr=""},15e3)}catch(s){PutToDebugLogException(2,"common: OfferSaveContact",s)}}function ContactIsFavorite(e){try{if(isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1||isNull(e)||e.length<1||!IsNumber(e))return!1;var t=webphone_api.global.ctlist[e];if(isNull(t))return!1;var n=t[CT_FAV];if(!isNull(n)&&"1"===n)return!0}catch(o){PutToDebugLogException(2,"common: ContactIsFavorite",o)}return!1}function ContactSetFavorite(e,t){try{if(isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1||isNull(e)||e.length<1)return;var n="0";isNull(t)||!0!==t||(n="1");var o=webphone_api.global.ctlist[e];if(isNull(o))return;o[CT_FAV]=n,webphone_api.global.ctlist[e]=o,webphone_api.global.wasCtModified=!0}catch(i){PutToDebugLogException(2,"common: ContactSetFavorite",i)}}function AudioDevicePopupSDK(e,t,n,o){try{if(!isNull(audiomodal))return void audiomodal.show();var i=GetParameter("volumein"),a=GetParameter("volumeout");!isNull(i)&&IsNumber(i)||(i="50"),!isNull(a)&&IsNumber(a)||(a="50");var r="";getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&(r='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_ring_label" style="display: inline-block; margin-top: 1.3em;">'+webphone_api.stringres.get("audio_ring")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_ring" id="audioselect_ring" style="margin: 0; width: 100%;">'+n+"</select></div>");var s="";!isNull(o)&&o.length>0&&(s='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="video_rec_label" style="display: inline-block; margin-top: 1.3em;">'+webphone_api.stringres.get("video_rec")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="videoselect_rec" id="videoselect_rec" style="margin: 0; width: 100%;">'+o+"</select></div>");var l="";!isNull(t)&&t.length>0&&(l='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_rec_label" style="display: inline-block; margin-top: 2.3em;">'+webphone_api.stringres.get("audio_rec")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_play" id="audioselect_play" style="margin: 0; width: 100%;">'+t+'</select><span id="audio_volumeout_value" style="background: #ccc; padding: .5em;">'+a+'</span><input name="audio_volumeout" id="audio_volumeout" min="0" max="100" value="'+a+'" type="range" style="margin-top: 1em; width: 80%;"></div>');var p='<span id="audio_volumein_value" style="background: #ccc; padding: .5em;">'+i+'</span><input name="audio_volumein" id="audio_volumein" min="0" max="100" value="'+i+'" type="range" style="margin-top: 1em; width: 80%;">';getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(p=""),audiomodal=webphone_api.picoModal({content:'<div id="audiodevice_modal" class="pmodal_container"><div id="audiodevice_modal_header" class="pmodal_header">'+webphone_api.stringres.get("audio_title")+'</div><div id="audiodevice_modal_content" class="pmodal_content" style="padding: 1em;"><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_mic_label" style="display: inline-block; margin-top: 2.3em;">'+webphone_api.stringres.get("audio_mic")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_rec" id="audioselect_rec" style="margin: 0; width: 100%;">'+e+"</select>"+p+"</div>"+l+r+s+'</div><div id="audiodevice_modal_footer" class="pmodal_footer" style="float: left; width: 100%; margin-top: 1em;"><button id="btn_audiodevice_positive">'+webphone_api.stringres.get("btn_ok")+'</button><button id="btn_audiodevice_negative">'+webphone_api.stringres.get("btn_cancel")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{width:"20em"},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),audiomodal=null,webphone_api.webrtcapi.HideVideoPriview()}),audiomodal.show(),webphone_api.$("#audio_volumein").on("change",function(){webphone_api.$("#audio_volumein_value").html(webphone_api.$(this).val())}),webphone_api.$("#audio_volumeout").on("change",function(){webphone_api.$("#audio_volumeout_value").html(webphone_api.$(this).val())}),webphone_api.$("#videoselect_rec").on("change",function(){var e=webphone_api.$("#videoselect_rec").val();webphone_api.webrtcapi.MyCameraPreview(e)}),webphone_api.$("#btn_audiodevice_positive").on("click",function(){try{PutToDebugLog(5,"EVENT, common AudioDevicePopupSDK OK click");var e=webphone_api.$("#audioselect_rec").val(),t=webphone_api.$("#audioselect_play").val(),n=webphone_api.$("#audioselect_ring").val(),o="";isNull(document.getElementById("videoselect_rec"))||(o=webphone_api.$("#videoselect_rec").val()),!isNull(arecL)&&arecL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 0"),webphone_api.setdevice(0,e,2)),!isNull(aplayL)&&aplayL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 1"),webphone_api.setdevice(1,t,2)),!isNull(n)&&!isNull(aringL)&&aringL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 2"),webphone_api.setdevice(2,n,2)),!isNull(o)&&o.length>0&&!isNull(vrecL)&&vrecL.length>0&&vrecL[0]!==o&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 3"),webphone_api.setdevice(3,o,2)),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 0"),webphone_api.getdevice(0,function(e){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 1"),webphone_api.getdevice(1,function(e){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 3"),webphone_api.getdevice(3,function(e){})},300);var i=webphone_api.$("#audio_volumein").val(),a=webphone_api.$("#audio_volumeout").val();!isNull(i)&&i.length>0&&IsNumber(i)&&(SaveParameter("volumein",i),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopupSDK 0"),webphone_api.setvolume(0,i)),!isNull(a)&&a.length>0&&IsNumber(a)&&(SaveParameter("volumeout",a),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopupSDK 1"),webphone_api.setvolume(1,a)),audiomodal.close()}catch(r){PutToDebugLogException(2,"common: AudioDevicePopupSDK OK click",r)}}),webphone_api.$("#btn_audiodevice_negative").on("click",function(){audiomodal.close()})}catch(c){PutToDebugLogException(2,"common: AudioDevicePopupSDK",c)}}function GetAudioDevToSelect(e,t){if(isNull(e)||isNull(t)||e.length<1||t.length<1)return"";for(var n=0;n<e.length;n++)if(!(isNull(e[n])||e[n].length<1)&&e[n]===t)return e[n];for(var n=0;n<e.length;n++)if(!(isNull(e[n])||e[n].length<1)&&(t.indexOf(e[n])>=0||e[n].indexOf(t)>=0))return e[n];for(var n=0;n<e.length;n++)if(!(isNull(e[n])||e[n].length<1)&&(t.indexOf(e[n].substr(0,12))>=0||e[n].indexOf(t.substr(0,12))>=0))return e[n];for(var n=0;n<e.length;n++)if(!(isNull(e[n])||e[n].length<1)&&(t.indexOf(e[n].substr(0,6))>=0||e[n].indexOf(t.substr(0,6))>=0))return e[n];for(var n=0;n<e.length;n++)if(!(isNull(e[n])||e[n].length<1)&&(t.indexOf(e[n].substr(0,3))>=0||e[n].indexOf(t.substr(0,3))>=0))return e[n];for(var n=0;n<e.length;n++)if(!(isNull(e[n])||e[n].length<1)&&(t.indexOf(e[n].substr(0,1))>=0||e[n].indexOf(t.substr(0,1))>=0))return e[n];return t}function AudioDevicePopup(e){try{var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120),arecL=GetAudioRecList().split("\r\n"),aplayL=GetAudioPlayList().split("\r\n"),aringL=GetAudioRingList().split("\r\n"),getuseengine()===webphone_api.global.ENGINE_WEBRTC&&!isNull(GetVideoRecList())&&GetVideoRecList().length>0&&(vrecL=GetVideoRecList().split("\r\n"));var n='<option value="[VALUE]">[TEXT]</option>',o="",i="",a="",r="";if(!isNull(arecL))for(var s=GetAudioDevToSelect(arecL,GetAudioRecDev()),l=0;l<arecL.length;l++)if(!(isNull(arecL[l])||arecL[l].length<1)){var p=!1;s===arecL[l]&&(p=!0,o=n+o),!1===p&&(o+=n),o=o.replace("[VALUE]",arecL[l]),o=o.replace("[TEXT]",arecL[l])}if(!isNull(aplayL))for(var c=GetAudioDevToSelect(aplayL,GetAudioPlayDev()),l=0;l<aplayL.length;l++)if(!(isNull(aplayL[l])||aplayL[l].length<1)){var p=!1;c===aplayL[l]&&(p=!0,i=n+i),!1===p&&(i+=n),i=i.replace("[VALUE]",aplayL[l]),i=i.replace("[TEXT]",aplayL[l])}if(!isNull(aringL))for(var u=GetAudioDevToSelect(aringL,GetAudioRingDev()),l=0;l<aringL.length;l++)if(!(isNull(aringL[l])||aringL[l].length<1)){var p=!1;u===aringL[l]&&(p=!0,a=n+a),!1===p&&(a+=n),a=a.replace("[VALUE]",aringL[l]),a=a.replace("[TEXT]",aringL[l])}if(!isNull(vrecL))for(var h=GetAudioDevToSelect(vrecL,webphone_api.global.video_rec_curr_device),l=0;l<vrecL.length;l++)if(!(isNull(vrecL[l])||vrecL[l].length<1)){var p=!1;h===vrecL[l]&&(p=!0,r=n+r),!1===p&&(r+=n),r=r.replace("[VALUE]",vrecL[l]),r=r.replace("[TEXT]",vrecL[l])}if(!0===IsSDK())return void AudioDevicePopupSDK(o,i,a,r);var g=GetParameter("volumein"),m=GetParameter("volumeout");!isNull(g)&&IsNumber(g)||(g="50"),!isNull(m)&&IsNumber(m)||(m="50");var d="";getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&(d='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="audio_ring_label">'+webphone_api.stringres.get("audio_ring")+':</label></div><div class="audio_right_container"><select name="audioselect_ring" id="audioselect_ring" style="margin: 0;">'+a+"</select></div>");var b="";!isNull(r)&&r.length>0&&(b='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="video_rec_label">'+webphone_api.stringres.get("video_rec")+':</label></div><div class="audio_right_container"><select name="videoselect_rec" id="videoselect_rec" style="margin: 0;">'+r+"</select></div>");var _="";!isNull(i)&&i.length>0&&(_='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="audio_rec_label">'+webphone_api.stringres.get("audio_rec")+':</label></div><div class="audio_right_container"><select name="audioselect_play" id="audioselect_play" style="margin: 0;">'+i+'</select><input name="audio_volumeout" id="audio_volumeout" data-highlight="true" data-mini="true" min="0" max="100" value="'+m+'" type="range"></div>');var f='<input name="audio_volumein" id="audio_volumein" data-highlight="true" data-mini="true" min="0" max="100" value="'+g+'" type="range">';getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(f="")
;var w='<div id="audiodevice_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="width:'+t+"px; max-width:"+t+"px; min-width: "+Math.floor(.6*t)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("audio_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0; width: 100%;"><div class="audio_left_container"><label id="audio_mic_label">'+webphone_api.stringres.get("audio_mic")+':</label></div><div class="audio_right_container"><select name="audioselect_rec" id="audioselect_rec" style="margin: 0;">'+o+"</select>"+f+"</div>"+_+d+b+'</div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";savectpopup_wasclosed=!1,e=e||function(){},webphone_api.$.mobile.activePage.append(w).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#videoselect_rec").off("change"),webphone_api.webrtcapi.HideVideoPriview(),e()}}),webphone_api.$("#videoselect_rec").on("change",function(){var e=webphone_api.$("#videoselect_rec").val();webphone_api.webrtcapi.MyCameraPreview(e)}),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common AudioDevicePopup close on click");var t=(webphone_api.$(this).attr("id"),webphone_api.$("#audioselect_rec").val()),n=webphone_api.$("#audioselect_play").val(),o=webphone_api.$("#audioselect_ring").val(),i="";isNull(document.getElementById("videoselect_rec"))||(i=webphone_api.$("#videoselect_rec").val()),!isNull(arecL)&&arecL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 0"),webphone_api.setdevice(0,t,2)),!isNull(aplayL)&&aplayL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 1"),webphone_api.setdevice(1,n,2)),!isNull(o)&&!isNull(aringL)&&aringL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 2"),webphone_api.setdevice(2,o,2)),!isNull(i)&&i.length>0&&!isNull(vrecL)&&vrecL.length>0&&vrecL[0]!==i&&webphone_api.setdevice(3,i,2),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 0"),webphone_api.getdevice(0,function(e){})},200),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 1"),webphone_api.getdevice(1,function(e){})},300),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 2"),webphone_api.getdevice(2,function(e){})},400),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 3"),webphone_api.getdevice(3,function(e){})},500);var a=webphone_api.$("#audio_volumein").val(),r=webphone_api.$("#audio_volumeout").val();!isNull(a)&&a.length>0&&IsNumber(a)&&(SaveParameter("volumein",a),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopup 0"),webphone_api.setvolume(0,a)),!isNull(r)&&r.length>0&&IsNumber(r)&&(SaveParameter("volumeout",r),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopup 1"),webphone_api.setvolume(1,r))})}catch(v){PutToDebugLogException(2,"common: AudioDevicePopup",v)}}function IsContactBlocked(e,t){try{if((isNull(e)||e.length<1)&&(isNull(t)||t.length<1))return!1;var n=GetParameter2("blocked_contacts");if(isNull(n)||n.length<1)return!1;n=Trim(n);var o=n.split(",");if(isNull(o)||o.length<1)return!1;if(!isNull(e)&&Trim(e).length>0)for(var i=0;i<o.length;i++)if(!(isNull(o[i])||o[i].length<1)&&o[i]===e)return!0;if(!isNull(t)&&t.length>0)for(var i=0;i<o.length;i++)if(!(isNull(o[i])||o[i].length<1))for(var a=0;a<t.length;a++)if(!(isNull(t[a])||[a].length<1)&&o[i]===t[a])return!0}catch(r){PutToDebugLogException(2,"common: IsContactBlocked",r)}return!1}function IsNumberBlacklisted(e,t){try{if((isNull(e)||e.length<1)&&(isNull(t)||t.length<1))return!1;var n=GetParameter2("blacklist");if(isNull(n)||n.length<1)return!1;n=Trim(n);var o=n.split(",");if(isNull(o)||o.length<1)return!1;if(!isNull(e)&&Trim(e).length>0)for(var i=0;i<o.length;i++)if(!(isNull(o[i])||o[i].length<1)&&o[i]===e)return!0;if(!isNull(t)&&t.length>0)for(var i=0;i<o.length;i++)if(!(isNull(o[i])||o[i].length<1))for(var a=0;a<t.length;a++)if(!(isNull(t[a])||[a].length<1)&&o[i]===t[a])return!0}catch(r){PutToDebugLogException(2,"common: IsNumberBlacklisted",r)}return!1}function BlockContact(e,t){try{if((isNull(e)||e.length<1)&&(isNull(t)||t.length<1))return;var n=GetParameter2("blocked_contacts");if(isNull(n)&&(n=""),n=Trim(n),isNull(e)&&Trim(e).length>0||(n.length>0&&(n+=","),n+=Trim(e)),!(isNull(t)&&t.length>0))for(var o=0;o<t.length;o++)isNull(t[o])||Trim(t[o]).length<1||(n.length>0&&(n+=","),n+=Trim(t[o]));SaveParameter("blocked_contacts",n)}catch(i){PutToDebugLogException(2,"common: BlockContact",i)}}function UnBlockContact(e,t){try{if((isNull(e)||e.length<1)&&(isNull(t)||t.length<1))return;var n=GetParameter2("blocked_contacts");if(isNull(n)||n.length<1)return;n=Trim(n);var o=n.split(",");if(isNull(o)||o.length<1)return;if(!isNull(e)&&Trim(e).length>0){e=Trim(e);for(var i=0;i<o.length;i++)isNull(o[i])||o[i].length<1||o[i]===e&&(o[i]="")}if(!isNull(t)&&t.length>0)for(var i=0;i<o.length;i++)if(!(isNull(o[i])||o[i].length<1))for(var a=0;a<t.length;a++)isNull(t[a])||[a].length<1||o[i]===t[a]&&(o[i]="");n="";for(var i=0;i<o.length;i++)isNull(o[i])||o[i].length<1||(n.length>0&&(n+=","),n+=o[i]);SaveParameter("blocked_contacts",n)}catch(r){PutToDebugLogException(2,"common: UnBlockContact",r)}}function GetTlsProxyUrl(e){try{if(isNull(e)||e.length<1)return"";var t=RandomInt(1e5,999999999);return"https://rtc.mizu-voip.com:4443/?hsforward="+StrEc(e,"s7n1k8fnz7ejian4k",!1)+"&nocache="+t.toString()}catch(n){PutToDebugLogException(2,"common: GetTlsProxyUrl",n)}return""}function SetLogFormAction(){try{if(!0===IsSDK())return;var e=document.getElementById("xlogpush");if(isNull(e))return void PutToDebugLog(2,"ERROR, log form not found in HTML");var t=GetParameter("logform_action");(isNull(t)||t.length<3)&&(t="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xlogpush"),t=t.toLowerCase(),t=Trim(t),0!==t.indexOf("http")&&(t="http://"+t);var n="";n=!0===IsHttps()?GetTlsProxyUrl(t):t,e.action=n,PutToDebugLog(5,"EVENT, SetLogFormAction: "+n.replace("mnt.mizu-voip","*"))}catch(o){PutToDebugLogException(2,"common: SetLogFormAction",o)}}function SentWebrtcSignaling(e){if(!(isNull(e)||e.length<1)&&0!==e.indexOf("INVITE sip")&&(e.indexOf("REGISTER sip:")>=0||e.indexOf("REGISTER sips:")>=0)){webphone_api.global.webrtclastregsent=GetTickCount(),isNull(wrereg_timer)||clearTimeout(wrereg_timer),wrereg_timer=null;var t=GetParameterInt("regtimeout",6e3);0!=t&&t<100&&(t=6e3),0!=t&&GetTickCount()-webphone_api.global.webrtcregtimer_exec>t+2e3&&(wrereg_timer=setTimeout(function(){webphone_api.global.webrtcregtimer_exec=GetTickCount(),PutToDebugLog(2,"WARNING, Webrtc resend REGISTER because no answer received for previous register"),webphone_api.webrtcapi.ResendRegister()},t))}}function GetRecentInviteIn(){return lastinvite_in}function GetWebrtcDisplayName(){return!isNull(webphone_api.global.sipunicoderewritefrom)&&webphone_api.global.sipunicoderewritefrom.length>0&&!isNull(webphone_api.global.sipunicoderewriteto)&&webphone_api.global.sipunicoderewriteto.length>0&&webphone_api.global.sipunicoderewriteto===displayname?webphone_api.global.sipunicoderewritefrom:displayname}function CatchWebrtcSignaling(e,t){try{if(isNull(e)||e.length<1||isNull(t))return;getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),webphone_api.iswebrtcengineworking=1,webphone_api.global.webrtcsipsignalingreceived=1,e=e.toString(),webphone_api.global.failover_gateway=!1;try{var n="",o=Trim(e),i=o.indexOf("\r\n");i>0&&(n=o.substring(0,i)),isNull(n)&&(n=""),n=n.toLowerCase()}catch(R){PutToDebugLogException(2,"common: CatchWebrtcSignaling inner 1",R)}if(GetParameterInt("forcereregister",1)>0){var a=GetSipHeaderFromMsg(e,"CSeq");if(!isNull(a)&&a.indexOf("REGISTER")>0){var r=e.indexOf("\r\n");if(r>0){var s=e.substring(0,i);if(!isNull(s)&&(s=Trim(s),(r=s.indexOf(" "))>0&&(s=Trim(s.substring(r)),!isNull(s)&&(r=s.indexOf(" "),r>0&&(s=s.substring(0,r)),!isNull(s)&&IsNumber(s))))){var l=StrToInt(s);l>=200?(isNull(wrereg_timer)||clearTimeout(wrereg_timer),wrereg_timer=null):200===l&&1===GetParameterInt("forcereregister",1)&&webphone_api.webrtcapi.StartReRegister(!0)}}}}if(!isNull(n)&&n.indexOf("message")>=0)try{var p=GetSipHeaderFromMsg(e,"X-Sms");if((isNull(p)||p.length<1)&&(p=GetSipHeaderFromMsg(e,"P-Sms")),!isNull(p)&&p.length>0&&p.toLowerCase().indexOf("yes")>=0&&e.indexOf("\r\n\r\n")>0){var c=e.substring(e.indexOf("\r\n\r\n")+4);if(isNull(c)&&(c=""),c=Trim(c),c.length>0){var u=GetSipHeaderFromMsg(e,"From");if(!isNull(u)&&u.length>0&&u.indexOf("<")>=0&&(u=u.substring(u.indexOf("<")+1),u.indexOf("@")>0)){u=u.substring(0,u.indexOf("@")),u=u.replace("sips:",""),u=u.replace("sip:","");try{webphone_api.onSmsCb(u,c)}catch(R){PutToDebugLogException(2,"There is an error in onSms() callback",R)}}}}}catch(R){PutToDebugLogException(2,"common: CatchWebrtcSignaling handle SMS",R)}if(!isNull(n)&&n.indexOf("invite")>=0){var h="";if(e.indexOf("recv=")>=0){var g=GetParameterBool("autoaccept",!1),m=1;g&&(m=3);var d=GetParameterInt("enableautoaccept",m),b=GetParameter("autoacceptheader","").toLowerCase(),_=e.toLowerCase();if(3==d||d>0&&b.length>0&&_.indexOf(b)>0||d>=2&&(_.indexOf("auto-answer")>0&&(_.indexOf("auto-answer:normal")>0||_.indexOf("auto-answer: normal")>0||_.indexOf("auto-answer:  normal")>0)||_.indexOf("answer-mode")>0&&(_.indexOf("answer-mode:auto")>0||_.indexOf("answer-mode: auto")>0||_.indexOf("answer-mode:  auto")>0)||_.indexOf("call-info")>0&&_.indexOf("answer-after")>0||_.indexOf("alert-info")>0&&_.indexOf("alert-autoanswer")>0)){var f=GetParameterInt("autoacceptdelay",-1);if(f<0&&_.indexOf("answer-after=")>0){var w=StrGetAfter(_,"answer-after=");_.indexOf("\r")>0&&(w=StrGetUntill(w,"\r")),_.indexOf(";")>0&&(w=StrGetUntill(w,";"));var v=StrToIntDef(Trim(w),-1);v>=0&&(f=1e3*v)}f<800&&(f=800),setTimeout(function(){PutToDebugLog(3,"EVENT, autoaccept INVITE sip header: WebRTC accept with delay msec: "+f),webphone_api.webrtcapi.SipAccept(webphone_api.global.aline,!1)},f)}var u=GetSipHeaderFromMsg(e,"From");!isNull(u)&&u.length>0&&u.indexOf("<")>=0&&(u=u.substring(u.indexOf("<")+1),u.indexOf("@")>0&&(u=u.substring(0,u.indexOf("@")),u=u.replace("sips:",""),u=u.replace("sip:",""),h=Trim(u)))}else{var u=GetSipHeaderFromMsg(e,"To");!isNull(u)&&u.length>0&&u.indexOf("<")>=0&&(u=u.substring(u.indexOf("<")+1),u.indexOf("@")>0&&(u=u.substring(0,u.indexOf("@")),u=u.replace("sips:",""),u=u.replace("sip:",""),h=Trim(u)))}if(!isNull(h)&&h.length>0)for(var P=0;P<webphone_api.global.ep.length;P++){var E=webphone_api.global.ep[P][EP_DESTNR];if(!isNull(E)&&E.length>0&&E.toLowerCase()===h.toLowerCase()){webphone_api.global.ep[P][EP_SIPINVITE]=e,webphone_api.global.ep[P][EP_CALLID]=GetSipHeaderFromMsg(e,"Call-ID");break}}}if(!0===webphone_api.global.redialof&&!isNull(e)&&e.length>0)try{var T=GetSipHeaderFromMsg(e,"CSeq");isNull(T)&&(T=""),T=T.toLowerCase(),T.indexOf("invite")>=0&&(n.indexOf("100 trying")>0||n.indexOf("603 decline")>0||n.indexOf("486 busy here")>0)&&(webphone_api.global.redialof=!1)}catch(R){PutToDebugLogException(2,"common: CatchWebrtcSignaling inner 2",R)}n.indexOf("503 ")>0&&(PutToDebugLog(2,"WARNING,Restating webrtc sipstack because 503 received: "+n),webphone_api.flagrestartwebrtc=!0,webphone_api.webrtcapi.ReStart(5e3,!1));var N=!1;switch(t){case SIP_REGISTER:e.length>10&&(lastreg=e,lastmsg=e);break;case SIP_INVITE_IN:e.length>10&&(lastinvite_in=e,lastmsg=e);break;case SIP_INVITE_OUT:e.length>10&&(lastinvite_out=e,lastmsg=e);break;case SIP_UNKNOWN:N=!0;break;default:N=!0}if(lastmsg=e,e.indexOf("X-UT: g")>=0?ismizuserverdetected=2==ismizuserverdetected?3:1:e.indexOf("X-UT: s")>=0?ismizuserverdetected=1==ismizuserverdetected?3:2:ismizuserverdetected<0&&(ismizuserverdetected=0),!0===N){var S=e.toLowerCase();if(S.indexOf("invite sip")>=0&&S.indexOf("invite sip")<10&&(lastinvite_in=e,e.indexOf("recv=")>=0)){var u=GetSipHeaderFromMsg(e,"From");!isNull(u)&&u.length>0&&u.indexOf("<")>0&&(u=u.substring(0,u.indexOf("<")),isNull(u)&&(u=""),u=ReplaceAll(u,'"',""),displayname=Trim(u))}}var I=GetSipHeaderFromMsg(e,"X-IMStatus");if(!isNull(I)&&I.length>0){var u=GetSipHeaderFromMsg(e,"From");isNull(u)&&(u="");var C=u.indexOf("<sip:");C>=0&&(u=u.substring(C+5),C=u.indexOf("@"),C>=0&&(u=u.substring(0,C)),u=Trim(u)),u!==GetSipusername()&&u!==GetCallerid()&&SaveReceivedPresence2(u,I)}GetWebrtcCreditRating(e),GetWebrtcOptions(e),UpdateShCache(lastmsg)}catch(R){PutToDebugLogException(2,"common: CatchWebrtcSignaling",R)}}function GetSipHeaderFromMsg(e,t){try{if(isNull(e)||e.length<10||isNull(t)||t.length<1)return"";var n="";t=Trim(t),t=t.toLowerCase(),0===t.indexOf("x-r-")&&(t=t.replace("x-r-",""));var o="\r\n";e.indexOf("\r\n")<0&&e.indexOf("\n")>=0&&(o="\n");var i=e.split(o);if(isNull(i))return"";for(var a=0,r=0;r<i.length;r++)if(!(isNull(i[r])||i[r].indexOf(":")<1)){a=i[r].indexOf(":");var s=Trim(i[r].substring(0,a));if(s=s.toLowerCase(),0===s.indexOf("x-r-")&&(s=s.replace("x-r-","")),s===t){n=Trim(i[r].substring(a+1,i[r].length));break}}return isNull(n)&&(n=""),n}catch(l){PutToDebugLogException(2,"common: GetSipHeaderFromMsg",l)}return""}function RewriteSipHeaderInMsg(e,t,n){try{if(isNull(e)||e.length<10||isNull(t)||t.length<1||isNull(n))return e;var o=e;t.indexOf(":")<0&&(t+=":");var i=o.indexOf(t);if(i<0)return e;var a=o.substring(0,i);o=o.substring(i);var r="\r\n";o.indexOf("\r\n")<0&&o.indexOf("\n")>=0&&(r="\n"),o=o.substring(o.indexOf(r)+r.length);return a+t+" "+n+r+o}catch(s){PutToDebugLogException(2,"common: RewriteSipHeaderInMsg",s)}return e}function ClassSipHeader(){this.line,this.header,this.value}function UpdateShCache(e){try{if(isNull(e)||e.length<10)return;isNull(shcache)&&(shcache=[]);var t=StrToInt(webphone_api.global.aline),n=GetSipHeaderFromMsg(e,"CSeq");if(isNull(n))return;if(n=n.toLowerCase(),n.indexOf("register")>=0)t=0;else{if(!(n.indexOf("invite")>=0))return;var o=GetSipHeaderFromMsg(e,"From");isNull(o)&&(o="");var i=GetSipHeaderFromMsg(e,"To");isNull(i)&&(i="");var a=GetSipHeaderFromMsg(e,"Call-ID");isNull(a)&&(a=""),a=Trim(a),o.indexOf("<")>=0&&(o=o.substring(o.indexOf("<")+1)),o.indexOf(">")>0&&(o=o.substring(0,o.indexOf(">"))),o.indexOf("sip:")>=0&&(o=o.substring(o.indexOf("sip:")+4)),o.indexOf("sips:")>=0&&(o=o.substring(o.indexOf("sips:")+5)),o.indexOf("@")>=0&&(o=o.substring(0,o.indexOf("@"))),o.indexOf(";")>=0&&(o=o.substring(0,o.indexOf(";"))),i.indexOf("<")>=0&&(i=i.substring(i.indexOf("<")+1)),i.indexOf(">")>0&&(i=i.substring(0,i.indexOf(">"))),i.indexOf("sip:")>=0&&(i=i.substring(i.indexOf("sip:")+4)),i.indexOf("sips:")>=0&&(i=i.substring(i.indexOf("sips:")+5)),i.indexOf("@")>=0&&(i=i.substring(0,i.indexOf("@"))),i.indexOf(";")>=0&&(i=i.substring(0,i.indexOf(";")));var r="";r=o===GetSipusername()?i:o;var s=GetEndpoint(1013,-1,r,a,"",!1,!0);!isNull(s)&&s.length>4&&(t=StrToIntDef(s[EP_LINE],t)),t<1&&(t=1)}for(var l=0;l<shcache.length;l++)if(isNull(shcache[l])&&(shcache.splice(l,1),l--),shcache[l].line===t){var p=shcache[l].header,c=GetSipHeaderFromMsg(e,p);!isNull(c)&&c.length>0&&(shcache[l].value=c)}}catch(u){PutToDebugLogException(2,"common: UpdateShCache",u)}}function RemoveSipHeadreFromCache(e){try{if(isNull(e)||e.length<1)return!1;e=Trim(e),e=e.toLowerCase(),0===e.indexOf("x-r-")&&(e=e.replace("x-r-","")),isNull(shcache)&&(shcache=[]);for(var t=0;t<shcache.length;t++)isNull(shcache[t])&&(shcache.splice(t,1),t--),shcache[t].header===e&&(shcache.splice(t,1),t--)}catch(n){PutToDebugLogException(2,"common: RemoveSipHeadreFromCache",n)}}function RemoveSessionHeadersFromCache(e){try{if(isNull(shcache))return void(shcache=[]);var t=StrToIntDef(e,webphone_api.global.aline);if(t<1)return;for(var n=0;n<shcache.length;n++)isNull(shcache[n])&&(shcache.splice(n,1),n--),shcache[n].line===t&&(shcache.splice(n,1),n--)}catch(o){PutToDebugLogException(2,"common: RemoveSipHeadreFromCache",o)}}function GetSipHeaderInternal(e){return GetSipHeader(e,!0)}function GetSipHeader(e,t){try{if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, GetSipHeader header is NULL"),"ERROR, GetSipHeader header is NULL";e=e.toLowerCase(),e=Trim(e),0===e.indexOf("x-r-")&&(e=e.replace("x-r-","")),isNull(shcache)&&(shcache=[]);for(var n="",o=StrToInt(webphone_api.global.aline),i=0;i<shcache.length&&(isNull(shcache[i])&&(shcache.splice(i,1),i--),shcache[i].header!==e||(n=shcache[i].value,shcache[i].line!==o));i++);if(!isNull(n)&&n.length>0)return n;n=GetSipHeaderFromMsg(lastmsg,e),isNull(n)&&(n="");var a=GetSipHeaderFromMsg(lastmsg,"CSeq");isNull(a)&&(a=""),a=a.toLowerCase();var r=StrToInt(webphone_api.global.aline);if(a.indexOf("invite")<0&&a.indexOf("message")<0&&(r=0),r<0&&(r=1),n.length>0){var s=new ClassSipHeader;s.line=r,s.header=e,s.value=n,shcache.push(s)}return n.length<1?!0===t||"warning"==e||"x-reason"==e||"reason"==e?"":(PutToDebugLog(3,"EVENT, GetSipHeader no header available at this moment: "+e),"WARNING: header not found"):n}catch(l){PutToDebugLogException(2,"common: GetSipHeader",l)}return"ERROR, common: GetSipHeader failed"}function GetSipMessage(e,t,n){try{return lastmsg}catch(o){PutToDebugLogException(2,"common: GetSipMessage",o)}return"ERROR, common: GetSipMessage failed"}function GetWebrtcCreditRating(e){try{if(!1===Glbr())return;if(isNull(e))return;e=e.toString();var t=e.indexOf("Credit:");if(t>0){var n=e.substring(t+7);t=n.indexOf("\r\n"),t>0&&(n=n.substring(0,t)),t=n.indexOf("\n"),t>0&&(n=n.substring(0,t)),!isNull(n)&&n.length>0&&PutToDebugLog(1,"CREDIT,Credit: "+Trim(n))}var t=e.indexOf("Rating:");if(t>0){var o=e.substring(t+7);t=e.indexOf("\r\n"),t>0&&(o=o.substring(0,t)),t=e.indexOf("\n"),t>0&&(o=o.substring(0,t)),!isNull(o)&&o.length>0&&(webphone_api.global.rating=" ("+Trim(o)+")",PutToDebugLog(4,"GetWebrtcCreditRating received rating: "+Trim(o)))}}catch(i){PutToDebugLogException(2,"common: GetWebrtcCreditRating",i)}}function GetWebrtcOptions(e){try{if(isNull(e))return;e=e.toString();var t=e.indexOf("X-RTCOptions:");if(t>0){var n=e.substring(t+13);t=n.indexOf("\r\n"),t>0&&(n=n.substring(0,t)),t=n.indexOf("\n"),t>0&&(n=n.substring(0,t)),!isNull(n)&&n.length>0&&(PutToDebugLog(3,"EVENT,GetWebrtcOptions received: "+n),n.indexOf("nostun")>=0&&(webphone_api.global.nostun=!0),n.indexOf("noturn")>=0&&(webphone_api.global.noturn=!0))}}catch(o){PutToDebugLogException(2,"common: GetWebrtcOptions",o)}}function GetUsemizutlsproxy(){try{var e=GetParameter("usemizutlsproxy"),t=GetConfig("usemizutlsproxy"),n=webphone_api.parameters.usemizutlsproxy;return!isNull(t)&&t.length>0&&IsNumber(t)&&(e=t),!isNull(n)&&n.length>0&&IsNumber(n)&&(e=n),(isNull(e)||1!==e.length)&&(e="1"),e}catch(o){PutToDebugLogException(2,"common: GetUsemizutlsproxy",o)}return"1"}function UseTLSReload(){try{if(!0===IsHttps())return!1;var e=window.location.href;if(!0===IsLanIP(GetDomainFromURL(e),!0)||"localhost"===GetDomainFromURL(e)||e.toLowerCase().indexOf("file:")>=0)return CanLog(4)&&PutToDebugLog(4,"EVENT, TLSReload, page will NOT be reloaded because local webserver"),!1;var t=!1,n=GetParameter2("webrtcserveraddress");if((isNull(n)||n.length<3)&&(n=GetConfig("webrtcserveraddress")),(isNull(n)||n.length<3)&&(n=GetWsAddressCfg()),!isNull(n)&&n.length>3&&n.indexOf("ws:")>=0)return CanLog(4)&&PutToDebugLog(4,"EVENT, TLSReload, page will NOT be reloaded because webrtcserveraddress is not secure"),!1;var o=GetUsemizutlsproxy();"2"===o||"1"===o&&(!0===webphone_api.global.usestorage||Strl(60))?t=!0:PutToDebugLog(2,"EVENT, TLSReload skipped because usemizutlsproxy: "+o);try{decodeURIComponent(window.location.href).toLowerCase()}catch(c){""}if(!0===t&&!0===BrowserRequiresHttps(!0)){SaveParameter("aldm",decodeURIComponent(window.location.href)),PutToDebugLog(2,"EVENT, TLSReload, page will reload over https");var i=GetParameter("serveraddress_user"),a=GetParameter("serveraddress_orig"),r=GetParameter("serveraddress"),s=window.location.hostname;if(s=Trim(s),s=s.toLowerCase(),!1===webphone_api.global.isdebugversion){var l=!0;if(i&&i.length>0&&(1==IsLanIPEx(i)||i.indexOf("localhost")>=0)?l=!0:i&&i.length>0&&0==IsLanIPEx(i)&&i.indexOf("localhost")<0?l=!1:a&&a.length>0&&(1==IsLanIPEx(a)||a.indexOf("localhost")>=0)?l=!0:a&&a.length>0&&0==IsLanIPEx(a)&&a.indexOf("localhost")<0?l=!1:r&&r.length>0&&(1==IsLanIPEx(r)||r.indexOf("localhost")>=0)?l=!0:r&&r.length>0&&0==IsLanIPEx(r)&&r.indexOf("localhost")<0&&(l=!1),l)return PutToDebugLog(4,"EVENT, TLSReload, will NOT reload page, because server is on local network or webphone hosted on localhost"),!1}var p=StrToInt(GetParameter2("enginepriority_webrtc"));if(isNull(p)&&(p=2),p>=2)return PutToDebugLog(3,"EVENT, TLSReload, enginepriority_webrtc: "+p.toString()+"; higher priority, will not ask user, just automatically reload page"),!0;if(p<2)return PutToDebugLog(4,"EVENT, TLSReload, enginepriority_webrtc: "+p.toString()+"; lower priority, will NOT reload page"),!1;GetParameter("usemizutlsproxy_userreload")}}catch(u){PutToDebugLogException(2,"common: UseTLSReload",u)}return!1}function TLSReload(){try{if(!0===tlsrcalled)return;PutToDebugLog(2,"EVENT, TLSReload, reloading page over https"),tlsrcalled=!0;SaveSettingsFile(2,GetActiveAccSettingsFilename(),function(e){e?PutToDebugLog(2,"EVENT, SaveSettingsFile from TLSReload Successfull"):PutToDebugLog(2,"ERROR, SaveSettingsFile from TLSReload Failed");var t=window.location.href;if(!(isNull(t)||t.length<4)){t=decodeURIComponent(t),t.indexOf("#")>0&&(t=t.substring(0,t.indexOf("#"))),PutToDebugLog(2,"EVENT, TLSReload, current location: "+t);var n=GetTlsProxyUrl(t);PutToDebugLog(2,"EVENT, TLSReload, new location: "+n),window.location.href=n}})}catch(e){PutToDebugLogException(2,"common: TLSReload",e)}}function GetDomainFromURL(e){try{if(isNull(e))return"";if(e=decodeURIComponent(e),e.toLowerCase().indexOf("file:")>=0)return e;e=e.toLowerCase();var t=e.indexOf("//");t>=0&&(e=e.substring(t+2)),t=e.indexOf(":"),t>=0&&(e=e.substring(0,t)),t=e.indexOf("/"),t>=0&&(e=e.substring(0,t)),t=e.indexOf("#"),t>=0&&(e=e.substring(0,t)),e=Trim(e)}catch(n){PutToDebugLogException(2,"common: GetDomainFromURL",n)}return e}function CallWsuserKeepAlive(e){try{if(webphone_api.global.useengine!==webphone_api.global.ENGINE_WEBRTC)return;if(!IsMizuServerOrGateway())return;if(IsLocalServer())return;var t=GetTickCount();if(!0!==e&&t-wsuserka_lasttick<36e3)return;wsuserka_lasttick=t;var n=GetSipusername(),o=GetParameter("password");if(isNull(n)||n.length<1)return void PutToDebugLog(2,"ERROR, common CallWsuserKeepAlive will NOT send, because invalid username ("+n+")");if(!0!==e&&(isNull(o)||o.length<1))return void PutToDebugLog(2,"EVENT, common CallWsuserKeepAlive will not send wsuser, because we have no password ("+o+")");var i=GetWsuserUrl(n,o);if(i.length<3)return void PutToDebugLog(2,"ERROR, common CallWsuserKeepAlive wsuser not needed");IsMizuServerOrGateway()&&UriParser(i,"","","","","webrtccreateuser")}catch(a){PutToDebugLogException(2,"common: CallWsuserKeepAlive",a)}}function GetVersionStr(){try{if(!isNull(e))return e;var e=webphone_api.versionstr;return(isNull(e)||Trim(e).length<1)&&(e=webphone_api.global.versionstr),e}catch(t){PutToDebugLogException(2,"common: GetVersionStr",t)}return""}function IsSDK(){try{if(isnotsdkcache)return!1;if(1190===GetConfigInt("brandid",-1)&&!isNull(document.getElementById("page_dialpad")))return!1;var e=null;if("undefined"==typeof window.pageissdk||null===window.pageissdk||"false"!=window.pageissdk&&0!=window.pageissdk&&1!=window.pageissdk&&"true"!=window.pageissdk||(e=("undefined"==typeof window.pageissdk||null===window.pageissdk||"false"!==window.pageissdk)&&("undefined"!=typeof window.pageissdk&&null!==window.pageissdk&&"true"===window.pageissdk||window.pageissdk))||(isnotsdkcache=!0),isNull(e)&&webphone_api.parameters&&(e=webphone_api.parameters.issdk),isNull(e)||1==e||"true"==e||e.length<1)return!0}catch(t){PutToDebugLogException(2,"common: IsSDK",t)}return!1}function GetStunServersStr(){var e=0;if(0===GetParameterInt("use_fast_stun",1))return null;if(!0===webphone_api.global.nostun||!0===IsLocalServer(!0))return null;ParseStunTurnNew();var t="",n=!0;try{var o=GetConfig("stunserveraddress");o.length<1&&(n=!1),e=1;var i=o,a="stun:rtc.mizu-voip.com:8090",r=GetSipusername(),s=GetParameter("password"),l=GetWsuserUrl(r,s),p=l;e=2;var c=GetParameter("stunserveraddress");if(null===c||"null"===c||"Null"===c||"NULL"===c)return PutToDebugLog(2,"EVENT, GetStunServersStr2: NULL"),null;if(void 0===c||c.length<1?n=!1:(e=3,i=c,n=!0),i.length>0&&(n=!0),e=4,!1===n)if(e=10,!0===IsMizuServerOrGateway()&&!isNull(l)&&l.length>3){e=11;var u=l,h=u.indexOf("://");if(e=12,h>0&&(u=u.substring(h+3)),h=u.indexOf("/"),h>0&&(u=u.substring(0,h)),e=13,l.indexOf("wss:")>=0||l.indexOf("https:")>=0)if(e=14,(h=u.indexOf(":"))<1)e=15,t="stun:"+u+":8090";else{e=16;var g=u.substring(h+1);u=u.substring(0,h),e=20,t="8090"===g||"443"===g?"stun:"+u+":8090":a}else e=20,h=u.indexOf(":"),t=h<1?"stun:"+u+":80":"stun:"+u,e=21}else t=a;else if("null"==i.toLowerCase())e=22,t=null;else{e=23;var m=i.split(",");if(!isNull(m)&&m.length>0){e=24;for(var d=0;d<m.length;d++)isNull(m[d])||m[d].length<1||(t.length>0&&(t+=","),m[d].indexOf(":")<0&&(m[d]=m[d]+":80"),t=t+"stun:"+Trim(m[d]));e=25}}if(e=30,!isNull(p)&&p.length>0){e=31;var h=p.indexOf("://");h>=0&&(p=p.substring(h+3)),e=32,h=p.indexOf("/"),h>0&&(p=p.substring(0,h)),e=33,(p.indexOf("148.251.28.181")>=0||p.indexOf("rtc.mizu-voip.com")>=0)&&(p.indexOf("18080")>0||p.indexOf("2443")>0)&&(e=34,t=a)}if(e=35,t.indexOf("148.251.28.181")>=0||t.indexOf("rtc.mizu-voip.com")>=0||t.indexOf("107.175.156.227")>=0||t.indexOf("usrtcx.webvoipphone.com")>=0||t.indexOf("usrtc3.webvoipphone.com")>=0){e=36;var h=t.lastIndexOf(":");h>0&&(e=40,t=t.substring(0,h+1)+"8090"),e=41}webphone_api.global.loglevel>=5&&t.indexOf("mizu-voip.com")<0&&t.indexOf("webvoipphone.com")<0&&t.indexOf("jsiprtc.com")<0&&t.indexOf("webrtc-sip.org")<0&&PutToDebugLog(5,"EVENT, def stun server: "+t)}catch(b){PutToDebugLogException(2,"common: GetStunServersStr: ("+e.toString()+")",b)}return t}function GetOneStunSrv(){var e="";try{var t=GetStunServersStr();if(!isNull(t)&&t.length>3){var n=t.indexOf(",");e=n>0?Trim(t.substring(0,n)):t}isNull(e)&&(e=""),PutToDebugLog(2,"EVENT, GetOneStunSrv: "+e)}catch(o){PutToDebugLogException(2,"common: GetOneStunSrv",o)}return e}function GetTurnSrv(){if(!0===webphone_api.global.noturn||!0===IsLocalServer(!0))return null;ParseStunTurnNew();var e={},t=!0;try{var n=GetConfig("turnserveraddress"),o=GetConfig("turnparameters"),i=GetConfig("turnusername"),a=GetConfig("turnpassword");(n.length<1||i.length<1||a.length<1)&&(t=!1);var r=n,s=o,l=i,p=a;if(null===webphone_api.parameters.turnserveraddress||"null"==webphone_api.parameters.turnserveraddress||"NULL"==webphone_api.parameters.turnserveraddress)return PutToDebugLog(2,"EVENT, GetTurnSrv3: NULL"),null;var c=GetParameter2("turnserveraddress"),u=GetParameter2("turnparameters"),h=GetParameter2("turnusername"),g=GetParameter2("turnpassword");if(null===c||"null"===c||"Null"===c||"NULL"===c)return PutToDebugLog(2,"EVENT, GetTurnSrv4: NULL"),null;if(void 0===c||c.length<1||void 0===h||h.length<1||void 0===g||g.length<1?t=!(r.length<1):(r=c,s=u,l=h,p=g,t=!0),isNull(r)||"null"===r||"NULL"===r||isNull(l)||"null"===l||"NULL"===l||isNull(p)||"null"===p||"NULL"===p)return PutToDebugLog(2,"EVENT, GetTurnSrv2: NULL"),null;var m=!1;if(GetBrowserVersion()>40&&(m=!0),!1===t){var d=webphone_api.parameters.webrtcserveraddress;(isNull(d)||d.length<2)&&(d=GetWsAddressCfg(),(isNull(d)||d.length<2)&&(d=GetWp())),isNull(d)&&(d=""),d=d.toLowerCase();var b=GetConfig("mainaport");if(!0===IsMizuServerOrGateway()&&d.length>0){var _=d,f=d.indexOf("://");if(f>0&&(d=d.substring(f+3)),f=d.indexOf("/"),f>0&&(d=d.substring(0,f)),!isNull(b)&&b.length>0&&IsNumber(b)&&(f=d.indexOf(":"),f>0&&(d=d.substring(0,f)),d=d+":"+b),_.indexOf("wss:")>=0)if((f=d.indexOf(":"))>0){var w=d.substring(f+1);if(d=d.substring(0,f),"80"===w||"443"===w||"2443"===w){var v="turn:"+d+":"+w+"?transport=tcp";e=!0===m?{urls:v,username:"mzturnusr",credential:"rnd87719318572"}:{url:v,username:"mzturnusr",credential:"rnd87719318572"}}else e=null;t=!0}else{var v="turn:"+d+":80?transport=tcp";e=!0===m?{urls:v,username:"mzturnusr",credential:"rnd87719318572"}:{url:v,username:"mzturnusr",credential:"rnd87719318572"},t=!0}else{d.indexOf(":")<0&&(d+=":80");var v="turn:"+d+"?transport=tcp";e=!0===m?{urls:v,username:"mzturnusr",credential:"rnd87719318572"}:{url:v,username:"mzturnusr",credential:"rnd87719318572"},t=!0}}}else null==r?e=null:(r=Trim(r),0!==r.indexOf("turn:")&&(r="turn:"+r),r.indexOf(":")===r.lastIndexOf(":")&&(r+=":80"),isNull(s)&&(s=""),s.length>0&&0!==s.indexOf("?")&&(s="?"+s),e=!0===m?{urls:r+s,username:l,credential:p}:{url:r+s,username:l,credential:p},t=!0);if(!1===t&&(e=null),isNull(e))PutToDebugLog(2,"EVENT, def turn server: NULL");else{var P=JSON.stringify(e);P=P.substring(0,P.indexOf("credential")+10),P+='":"*****"}',PutToDebugLog(2,"EVENT, def turn server: "+P)}return e}catch(E){PutToDebugLogException(2,"common: GetTurnSrv",E)}return{}}function ParseStunTurnNew(){try{var e=GetParameter("stunserveraddress"),t=GetParameter("turnserveraddress");isNull(e)&&(e=""),e=ReplaceAll(e," ",""),e=ReplaceAll(e,'"',""),e=ReplaceAll(e,"'",""),isNull(t)&&(t=""),t=ReplaceAll(t," ",""),t=ReplaceAll(t,'"',""),t=ReplaceAll(t,"'",""),e=ReplaceAll(e,"{",""),e=ReplaceAll(e,"}",""),e=ReplaceAll(e,"[",""),e=ReplaceAll(e,"]",""),t=ReplaceAll(t,"{",""),t=ReplaceAll(t,"}",""),t=ReplaceAll(t,"[",""),t=ReplaceAll(t,"]","");var n=-1,o="";if(t.toLowerCase().indexOf("turn")>=0||t.toLowerCase().indexOf("transport")>=0?o=t:(e.toLowerCase().indexOf("turn")>=0||e.toLowerCase().indexOf("transport")>=0)&&(o=e),o.length>3){n=o.toLowerCase().indexOf("turn:"),n>=0&&(o=o.substring(n+5)),n=o.toLowerCase().indexOf("stun:"),n>=0&&(o=o.substring(0,n));var i="",a="",r="",s="";n=o.toLowerCase().indexOf("username:"),n>=0&&(a=o.substring(n+9),(n=a.indexOf(","))>0&&(a=a.substring(0,n))),n=o.toLowerCase().indexOf("credential:"),n>=0&&(r=o.substring(n+11),(n=r.indexOf(","))>0&&(r=r.substring(0,n))),n=o.toLowerCase().indexOf("?"),n>=0&&(s=o.substring(n+1),(n=s.indexOf(","))>0&&(s=s.substring(0,n))),isNull(a)&&(a=""),isNull(r)&&(r=""),isNull(s)&&(s=""),i=o.toLowerCase(),i=i.replace("username:"+a,""),i=i.replace("credential:"+r,""),i=i.replace("?"+s,""),i=ReplaceAll(i,",",""),n=i.indexOf("url:"),n>=0&&(i=i.substring(n+4)),n=i.indexOf("urls:"),n>=0&&(i=i.substring(n+5)),isNull(i)&&(i=""),i.length>0&&SaveParameter("turnserveraddress",i),s.length>0&&SaveParameter("turnparameters",s),a.length>0&&SaveParameter("turnusername",a),r.length>0&&SaveParameter("turnpassword",r)}var l="";if(l=t.toLowerCase().indexOf("stun:")>=0?t.toLowerCase():e.toLowerCase(),l.length>3){l=ReplaceAll(l,"url:",""),l=ReplaceAll(l,"urls:","");var p=l.indexOf("turn:");n=l.indexOf("stun:"),n>=0&&p>=0&&(l=n>p?l.substring(n):l.substring(n,p)),n=l.toLowerCase().indexOf("url:"),n>=0&&(l=l.substring(n+4)),n=l.toLowerCase().indexOf("urls:"),n>=0&&(l=l.substring(n+5)),n=l.toLowerCase().indexOf("stun:"),n>=0&&(l=l.substring(n+5)),n=l.toLowerCase().indexOf(","),n>=0&&(l=l.substring(0,n)),isNull(l)&&(l=""),
l.length>0&&SaveParameter("stunserveraddress",l)}}catch(c){PutToDebugLogException(2,"common: ParseStunTurnNew",c)}return""}function GetDeviceId(){try{if(!isNull(cachedevid)&&cachedevid.length>1)return cachedevid;var e="",t=GetBrandName();isNull(t)&&(t=""),t=t.toLowerCase(),t=Trim(t);var n=location.host;isNull(n)?n="":n.indexOf(":")>0&&(n=n.substring(0,n.indexOf(":"))),n=n.toLowerCase(),n=Trim(n),t=t+"_"+n;for(var o=t+"=",i=document.cookie.split(";"),a=0;a<i.length;a++){for(var r=i[a];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(o)){e=r.substring(o.length,r.length);break}}if(isNull(e)||Trim(e).length<1){e=Md5Hash(RandomInt(1e3,9999999)+"_"+GetTickCount()+"_"+t)}if(!isNull(e)&&Trim(e).length>1){var s=new Date;s.setTime(s.getTime()+31536e6);var l="; expires="+s.toGMTString();return document.cookie=t+"="+e+l+"; path=/;SameSite=Lax",cachedevid=e,e}}catch(p){PutToDebugLogException(2,"common: GetDeviceId",p)}return""}function LogAllParameters(e,t){if(CanLog(4)){try{if(isNull(e)&&(e="All parameters:"),isNull(t))return void PutToDebugLog(2,"ERROR, LogAllParameters params is NULL");var n=[];n.push("d"),n.push("e"),n.push("m"),n.push("o");var o=n.join("");n=[],n.push("s"),n.push("u"),n.push("p"),n.push("p"),n.push("o"),n.push("r"),n.push("t"),n.push("e"),n.push("n"),n.push("d");var i=n.join("");n=[],n.push("h"),n.push("a"),n.push("s");var a=n.join("");n=[],n.push("u"),n.push("s"),n.push("e");var r=n.join("");n=[],n.push("e"),n.push("n"),n.push("a"),n.push("b"),n.push("l"),n.push("e");var s=n.join("");delete t.domaintoip_cache;for(var l in t)if("get"!==l&&"getAll"!==l)if("password"===l&&GetLogLevel()<5){var p=StrEc(t[l],webphone_api.global.ec_apikey,!0);e=e+"\r\nep="+p}else"needactivation"===l||"passphrase"===l||0===l.indexOf(o)||0===l.indexOf(i)||GetLogLevel()<6&&(0===l.indexOf(r)||0===l.indexOf(a)||0===l.indexOf(s))||(e=e+"\r\n"+l+"="+t[l]);PutToDebugLog(4,"EVENT, All parameters: "+e)}catch(c){PutToDebugLogException(2,"common: GetDeviceId",c)}return""}}function AutodetectDirectWebrtc(){try{if("true"===GetParameter("autodetectwebrtc_completed")||!1===CanIUseWebRTC())return;if("java"===getuseengine()||"ns"===getuseengine()||"java"===getuseengine()||IsMizuServerOrGateway()||GetWsAddressCfg().length>3)return void PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc not needed "+getuseengine()+" "+GetWsAddressCfg());var e=GetUA();if(GetParameter("useragent").length>0&&!1===IsMizuPublicWebRTCGateway()&&(e=GetParameter("useragent")),GetConfigInt("autodetectwebrtc",1)<1)return;var t=GetViaRandomAddress(),n="OPTIONS sip:domain.com SIP/2.0\r\nVia: SIP/2.0/WSS "+t+';branch=z9hG4bKZm6ekwKTdh4HVt5KZKbFAiPsa7HfefiL;rport\r\nFrom: "1234"<sip:1234@domain.com>;tag=ExB7vRKwE52lvEsR1WrC\r\nTo: "1234"<sip:1234@domain.com>\r\nContact: "1234"<sips:1234@'+t+";transport=wss>;expires=180\r\nCall-ID: 5ff2d63f-4939-2816-eeb8-6feca8245b92\r\nCSeq: 1522 REGISTER\r\nContent-Length: 0\r\nMax-Forwards: 70\r\nUser-Agent: "+e+"\r\nOrganization: DTC\r\nSupported: path\r\n",o=GetParameter("serveraddress");if((isNull(o)||o.length<2)&&(o=GetParameter("serveraddress_user")),isNull(o)||o.length<2)return void PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc cannot find serveraddress");o=NormalizeInput(o,0),o.indexOf(":")>0&&(o=o.substring(0,o.indexOf(":"))),o.indexOf("/")>0&&(o=o.substring(0,o.indexOf("/"))),PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc base serveraddress: "+o),!0===BrowserRequiresHttps(!1)?(wsuri_1="wss://"+o+":80/ws",wsuri_2="wss://"+o+":8080/ws",wsuri_3="wss://"+o+":443/ws",wsuri_4="wss://"+o+":8088/ws",wsuri_5="wss://"+o+":8089/ws"):(wsuri_1="wss://"+o+":80/ws",wsuri_2="wss://"+o+":8080/ws",wsuri_3="wss://"+o+":443/ws",wsuri_4="wss://"+o+":8088/ws",wsuri_5="wss://"+o+":8089/ws",wsuri_6="ws://"+o+":80/ws",wsuri_7="ws://"+o+":8080/ws",wsuri_8="ws://"+o+":443/ws",wsuri_9="ws://"+o+":8088/ws"),wsuri_1.length>0&&(ws_1=new WebSocket(wsuri_1),ws_1.binaryType="arraybuffer",ws_1.onopen=function(e){ws_1.send(n)},ws_1.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_1)}),wsuri_2.length>0&&(ws_2=new WebSocket(wsuri_2),ws_2.binaryType="arraybuffer",ws_2.onopen=function(e){ws_2.send(n)},ws_2.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_2)}),wsuri_3.length>0&&(ws_3=new WebSocket(wsuri_3),ws_3.binaryType="arraybuffer",ws_3.onopen=function(e){ws_3.send(n)},ws_3.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_3)}),wsuri_4.length>0&&(ws_4=new WebSocket(wsuri_4),ws_4.binaryType="arraybuffer",ws_4.onopen=function(e){ws_4.send(n)},ws_4.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_4)}),wsuri_5.length>0&&(ws_5=new WebSocket(wsuri_5),ws_5.binaryType="arraybuffer",ws_5.onopen=function(e){ws_5.send(n)},ws_5.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_5)}),wsuri_6.length>0&&(ws_6=new WebSocket(wsuri_6),ws_6.binaryType="arraybuffer",ws_6.onopen=function(e){ws_6.send(n)},ws_6.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_6)}),wsuri_7.length>0&&(ws_7=new WebSocket(wsuri_7),ws_7.binaryType="arraybuffer",ws_7.onopen=function(e){ws_7.send(n)},ws_7.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_7)}),wsuri_8.length>0&&(ws_8=new WebSocket(wsuri_8),ws_8.binaryType="arraybuffer",ws_8.onopen=function(e){ws_8.send(n)},ws_8.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_8)}),wsuri_9.length>0&&(ws_9=new WebSocket(wsuri_9),ws_9.binaryType="arraybuffer",ws_9.onopen=function(e){ws_9.send(n)},ws_9.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&t.indexOf("SIP/2.0")>=0&&(at_addr[at_addr.length]=wsuri_9)}),setTimeout(function(){if(SaveParameter("autodetectwebrtc_completed","true"),isNull(ws_1)||ws_1.close(),isNull(ws_2)||ws_2.close(),isNull(ws_3)||ws_3.close(),isNull(ws_4)||ws_4.close(),isNull(ws_5)||ws_5.close(),isNull(ws_6)||ws_6.close(),isNull(ws_7)||ws_7.close(),isNull(ws_8)||ws_8.close(),isNull(ws_9)||ws_9.close(),!isNull(at_addr)&&at_addr.length>0){for(var e="",t=0;t<at_addr.length;t++)isNull(at_addr[t])||at_addr[t].length<1||(PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc list["+t+"] = "+at_addr[t]),e.length<1&&(e=at_addr[t]),at_addr[t].indexOf("wss:")>=0&&(e=at_addr[t]));!isNull(e)&&e.length>0&&(SaveParameter("webrtcserveraddress",e),PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc best webrtcserveraddress: "+e))}else PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc not found any valid server")},2500)}catch(i){PutToDebugLogException(2,"common: AutodetectDirectWebrtc",i)}}function GetMediaConstraints(e,t){try{if(!0===webphone_api.isscreensharecall){return{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}}}var n=GetParameter("sel_rtc_audio_in"),o="";if(!0===e&&!isNull(n)&&n.length>1&&!0!==webphone_api.global.isholdresume){var i=webphone_api.webrtcapi.GetAudioVideoInputId(n,!1);if(gmc={audio:{deviceId:{exact:i}}},!0===t&&(o=GetParameter("sel_rtc_video_in"),!isNull(o)&&o.length>0)){var a=webphone_api.webrtcapi.GetAudioVideoInputId(o,!0);!isNull(a)&&a.length>0&&(gmc.video={deviceId:{exact:a}})}}else gmc={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}};if(!0===e)try{var r=JSON.stringify(gmc);isNull(r)?PutToDebugLog(2,"ERROR,GetMediaConstraints is NULL"):(PutToDebugLog(2,"EVENT,GetMediaConstraints: "+r),PutToDebugLog(2,"EVENT,GetMediaConstraints audioSource: "+n+"; videoSource: "+o))}catch(s){PutToDebugLogException(2,"common: GetMediaConstraints inner",s)}return gmc}catch(s){PutToDebugLogException(2,"common: GetMediaConstraints",s)}return null}function GetScreenshareConstraints(){try{return{video:{cursor:"always"},audio:!1}}catch(e){PutToDebugLogException(2,"common: GetScreenshareConstraints",e)}return null}function StripServeraddress(e){try{if(isNull(e))return"";e=e.toLowerCase(),e=e.replace("sip:","");var t=e.indexOf("@");if(t>0){e.substring(0,t);e=e.substring(t+1)}return e=Trim(e)}catch(n){PutToDebugLogException(2,"common: StripServeraddress",n)}return""}function StripUsername(e){try{if(isNull(e))return"";e=e.replace("sip:",""),e=e.replace("SIP:",""),e=e.replace("Sip:","");var t=e.indexOf("@");return t>0&&(e=e.substring(0,t)),e=Trim(e)}catch(n){PutToDebugLogException(2,"common: StripServeraddress",n)}return""}function AddJscommport(e){try{if(isNull(e))return"";if(isNull(jscport)||jscport.length<1){var t="",n=window.location.href;if(isNull(n)||n.length<1)return e;n=decodeURIComponent(n),n=Trim(n);var o=n.indexOf("jscommport=");o>0&&(t=n.substring(o+11),o=t.indexOf("&"),o>0&&(t=t.substring(0,o)),o=t.indexOf("#page_"),o>0&&(t=t.substring(0,o)),o=t.indexOf("/"),o>0&&(t=t.substring(0,o)),t=Trim(t),!isNull(t)&&t.length>0&&IsNumber(t)&&(PutToDebugLog(2,"EVENT, AddJscommport jscommport found: "+t),jscport=t))}if(!isNull(jscport)&&jscport.length>0&&IsNumber(jscport)){PutToDebugLog(2,"EVENT, AddJscommport adding port: "+jscport);var o=e.lastIndexOf(":");return o>0&&(e=e.substring(0,o)),e+":"+jscport}}catch(i){PutToDebugLogException(2,"common: AddJscommport",i)}return e}function DecideUsUk(){try{if(!0===webphone_api.global.decideusuk_finished&&("uk"===webphone_api.global.usuk||"us"===webphone_api.global.usuk))return;webphone_api.global.usuk.length<1?wsl_uk_time>0?(webphone_api.global.usuk="uk",ddu_lastload=wsl_uk):wsl_us_time>0&&(webphone_api.global.usuk="us",ddu_lastload=wsl_us):ddu_lastload>2&&-1!==ddu_lastcalled&&GetTickCount()-ddu_lastcalled<800&&(ddu_lastload>wsl_uk&&(webphone_api.global.usuk="uk"),ddu_lastload>wsl_us&&(webphone_api.global.usuk="us"));var e=GetWsAddressCfg();if(!isNull(e)&&e.length>3){var t=StrDc(wip_uk,alsvkey),n=StrDc(wips_uk,alsvkey),o=StrDc(wip_us,alsvkey),i=StrDc(wips_us,alsvkey);t.indexOf(e)>=0||n.indexOf(e)>=0?webphone_api.global.usuk="uk":(o.indexOf(e)>=0||i.indexOf(e)>=0)&&(webphone_api.global.usuk="us")}var a=!0,r=GetParameter("lastwebrtcserver"),s=GetParameter("topprioritywebrtcserver");if((!isNull(r)&&r.length>0||!isNull(s)&&s.length>0)&&(a=!1),PutToDebugLog(2,"EVENT, DecideUsUk selected: "+webphone_api.global.usuk),PutToDebugLog(2,"EVENT, DecideUsUk uk load: "+wsl_uk+"; uk timestamp: "+wsl_uk_time),PutToDebugLog(2,"EVENT, DecideUsUk us load: "+wsl_us+"; us timestamp: "+wsl_us_time),a)setTimeout(function(){if(!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var e=GetWsAddressCfg();e.length>0&&SaveParameter("lastwebrtcserver",e),PutToDebugLog(5,"EVENT, DecideUsUk select finished on timeout "+webphone_api.global.usuk+" "+e)}},1600);else{webphone_api.global.decideusuk_finished=!0;var l=GetWsAddressCfg();l.length>0&&SaveParameter("lastwebrtcserver",l),PutToDebugLog(5,"EVENT, DecideUsUk select finished on firstanswer "+webphone_api.global.usuk+" "+l+" ("+r+" / "+s+")")}ddu_lastcalled=GetTickCount()}catch(p){PutToDebugLogException(2,"common: DecideUsUk",p)}}function getuseengine(){try{isNull(webphone_api.global.useengine)||webphone_api.global.useengine.length<1?isNull(webphone_api.global.maintimerid)||GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||CanLog(2)&&PutToDebugLog(2,"EVENT, useengine is not set"):webphone_api.global.last_useengine=webphone_api.global.useengine}catch(e){PutToDebugLogException(2,"common: GetUseengine",e)}return webphone_api.global.useengine}function DisplayPeerDetails(e){try{var t=GetParameter2("displaypeerdetails");(isNull(t)||t.length<1)&&(t="0"),IsNumber(t)?"0"===t&&!0===IsSDK()?isNull(document.getElementById("page_call_additional_info"))||(PutToDebugLog(4,"EVENT, DisplayPeerDetails Display additional call info: "+e),document.getElementById("page_call_additional_info").innerHTML=e):"1"===t&&AlertDialog("Peer details",e):isNull(document.getElementById(t))||(document.getElementById(t).innerHTML=e,document.getElementById(t).value=e)}catch(n){PutToDebugLogException(2,"common: DisplayPeerDetails",n)}}function Beep(e){try{(isNull(e)||e.length<1)&&(e="1");var t=document.getElementById("justbeep_"+e);isNull(t)||t.play()}catch(n){PutToDebugLogException(2,"common: Beep",n)}}function GetCodecsFromApiParam(){try{if(isNull(webphone_api.parameters.codec))return;var e=webphone_api.parameters.codec;if(e.length<1)return;e=e.toLowerCase();var t=e.split(",");if(isNull(t)||t.length<1)return;for(var n="",o=0;o<t.length;o++)if(!isNull(t[o])){if(t[o]=t[o].replace(".",""),t[o]=Trim(t[o]),"auto"===t[o]){n="-1";break}"g711"===t[o]||"g.711"===t[o]?(n.length>0&&(n+=","),n+="1,2"):"pcmu"===t[o]?(n.length>0&&(n+=","),n+="1"):"pcma"===t[o]?(n.length>0&&(n+=","),n+="2"):"gsm"===t[o]?(n.length>0&&(n+=","),n+="3"):"ilbc"===t[o]?(n.length>0&&(n+=","),n+="4"):"speex"===t[o]?(n.length>0&&(n+=","),n+="5"):"speex-wb"===t[o]||"speexwb"===t[o]?(n.length>0&&(n+=","),n+="6"):"g729"===t[o]||"g.729"===t[o]?(n.length>0&&(n+=","),n+="8"):"opus"===t[o]?(n.length>0&&(n+=","),n+="10"):"opuswb"===t[o]||"opus-wb"===t[o]?(n.length>0&&(n+=","),n+="11"):"opusswb"===t[o]?(n.length>0&&(n+=","),n+="12"):"opusuwb"===t[o]?(n.length>0&&(n+=","),n+="13"):"g.722"===t[o]||"g722"===t[o]?(n.length>0&&(n+=","),n+="14"):"isac"===t[o]?(n.length>0&&(n+=","),n+="15"):"h.264"===t[o]||"h264"===t[o]?(n.length>0&&(n+=","),n+="50"):"h.265"===t[o]||"h265"===t[o]?(n.length>0&&(n+=","),n+="51"):"vp8"===t[o]?(n.length>0&&(n+=","),n+="52"):"vp9"===t[o]?(n.length>0&&(n+=","),n+="53"):"vp10"===t[o]?(n.length>0&&(n+=","),n+="54"):"av1"===t[o]&&(n.length>0&&(n+=","),n+="55")}n.length<1&&(n="-1"),SaveParameter("codec",n)}catch(i){PutToDebugLogException(2,"common: GetCodecsFromApiParam",i)}}function GetHttpAPIKey(){try{if(!isNull(apikey_cache))return apikey_cache;var e=GetConfig("serverapikey");if(!(isNull(e)||e.length<2))return apikey_cache=e,e;var t=GetConfigAll(!0);if(isNull(t))return"";for(var n in t)if(!isNull(t[n])&&(e=t[n],e=e.toString(),!(e.indexOf("mvapireq")<1||e.indexOf("authkey=")<1)&&(e=e.substring(e.indexOf("authkey=")+8),e.indexOf("&")>=0&&(e=e.substring(0,e.indexOf("&"))),isNull(e)&&(e=""),"key"!==e&&"KEY"!==e||(e=""),e=Trim(e),e.length>0)))return apikey_cache=e,e}catch(o){PutToDebugLogException(2,"common: GetHttpAPIKey",o)}return apikey_cache="",""}function Wsunreg(){try{var e=GetTickCount();if(unregcalledtime>0&&e-unregcalledtime<1500)return void PutToDebugLog(3,"WARNING, Wsunreg NOT called twice");if(unregcalledtime=e,isNull(webphone_api.global.usuk)||webphone_api.global.usuk.length<1)return;if(!IsMizuServerOrGateway())return;if(IsLocalServer())return;PutToDebugLog(2,"common: Wsunreg called: "+webphone_api.global.usuk);var t=GetConfig("wsunreg");if(isNull(t)||t.length<3){var n=GetWebrtcSrvAddr(),o=GetSipusername(),i=GetParameter("password");(isNull(n)||n.length<2)&&(n=GetWp()),n=n.toLowerCase(),n=NormalizeInput(n,0),n=n.replace("*","");var a=n.indexOf("/");a>0&&(n=n.substring(0,a));var r="1568108345";if("us"===webphone_api.global.usuk&&(r="1552303117"),IsMizuPublicWebRTCGateway()||(r=GetConfig("serverapikey")),n.indexOf("rtc.mizu-voip.com:2443")>=0&&(r="1568108399"),isNull(o)||o.length<1||isNull(i)||i.length<1)return void PutToDebugLog(2,"EVENT, common Wsunreg invalid username ("+o+") or invalid password ("+i+")");var s="http://";UseSecureSrvConnection()&&(s="https://"),t=s+n+"/mvapireq/?apientry=wsunreg&authkey="+r+"&authid="+o+"&authpwd="+i+"&sessionid="+GetSessionId()}else 0!==t.indexOf("http")&&(t="http://"+t),UseSecureSrvConnection()&&(t=t.replace("http:","https:"));IsMizuServerOrGateway()&&UriParser(t,"","","","","webrtcunregisteruser")}catch(l){PutToDebugLogException(2,"common: Wsunreg",l)}}function GetWsuserUrl(e,t){try{if(isNull(e)||e.length<1)return"";if(e.indexOf("@")>0&&(e=e.substring(0,e.indexOf("@")),e.length<1))return"";if(!1===UsernameStringIsValidForServer(e)){var n="ERROR, "+webphone_api.stringres.get("username_err")+": "+e;return ShowToast(n,5e3),PutToDebugLog(1,n),""}if(!isNull(t)&&t.length>0&&!1===PasswordStringIsValidForServer(t)){var n="ERROR, "+webphone_api.stringres.get("password_err")+": "+t;return ShowToast(n,5e3),PutToDebugLog(1,n),""}var o=GetWebrtcSrvAddr();if((isNull(o)||o.length<2)&&(o=GetWp()),o=o.toLowerCase(),o.indexOf("mfstwebsock")<0)return"";var i=GetConfig("brandid"),a=GetBrandName(),r=GetConfig("companyname"),s=GetParameter2("voicerecupload");isNull(s)&&(s=""),s.length<1&&(s=GetParameter2("voicerecftp_addr")),isNull(s)&&(s=""),s=Trim(s);var l=GetParameter("username"),p=GetParameter("displayname"),c=GetParameter("upperproxy");if(isNull(c)||Trim(c).length<1)c=GetProxyaddress();else if(!isNull(c)&&c.length>2&&c.indexOf(":")<1){var u=GetConfigInt("serverport",-1);u>0&&5060!==u&&(c=c+":"+u.toString())}isNull(c)&&(c=""),c=Trim(c);var h=GetParameter2("inbounddtmf");isNull(h)&&(h=""),h=Trim(h);var g=GetParameter2("outbounddtmf");isNull(g)&&(g=""),g=Trim(g);var m=GetParameter("dtmfmode");isNull(m)&&(m="");var d=GetParameter("transport");isNull(d)&&(d=""),!0===voice_wasset&&s.length<1&&(s="null"),!0===proxy_wasset&&c.length<1&&(c="null"),s.length>0&&(voice_wasset=!0),c.length>0&&(proxy_wasset=!0);var b=ParamAsBool(GetParameter2("use_h264"));isNull(b)&&(b=!0);var _=ParamAsBool(GetParameter2("use_vp8"));isNull(_)&&(_=!0);var f=ParamAsBool(GetParameter2("use_vp9"));isNull(f)&&(f=!0),o=NormalizeInput(o,0),o=o.replace("*","");var w=o.indexOf("/");w>0&&(o=o.substring(0,w));var v="1568108345";"us"===webphone_api.global.usuk&&(v="1552303117"),IsMizuPublicWebRTCGateway()||(v=GetConfig("serverapikey")),o.indexOf("rtc.mizu-voip.com:2443")>=0&&(v="1568108399");var P=NeedRegister(),E=GetParameter("wsuser"),T=!1,N="1";getuseengine()===webphone_api.global.ENGINE_FLASH&&(N="2");var S="https://";!isNull(E)&&E.length>10&&(o=E,w=o.indexOf("://"),w>0&&(o=o.substring(w+3)),w=o.indexOf("?"),w>0&&(o=o.substring(0,w+1)),0==E.indexOf("http:")&&(S="http://"));var I=o;if(w=I.indexOf("/"),w>0&&(I=I.substring(0,w)),w=I.indexOf("?"),w>0&&(I=I.substring(0,w)),w=I.indexOf(":"),w>0&&(I=I.substring(0,w)),I.length>3&&IsIPAddrress(I)&&!1===UseSecureSrvConnection()&&(S="http://"),!isNull(E)&&E.length>10&&E.indexOf("?")>0&&E.indexOf("&")>0){o=E,w=o.indexOf("://"),w>0&&(o=o.substring(w+3)),w=o.indexOf("?"),o=o.substring(0,w+1),w=E.indexOf("?");var C=E.substring(w+1);C=C.toLowerCase();var R=C.split("&");if(!isNull(R)&&R.length>0){for(var G=0;G<R.length;G++)if(!(isNull(R[G])||R[G].indexOf("=")<2||0===R[G].indexOf("apientry=")||0===R[G].indexOf("authkey="))){var y=R[G].substring(0,R[G].indexOf("="));if("upperserver"!==y&&"upperserverdomain"!==y)if("transport"!==y)switch(y){case"authid":R[G]="authid="+e;break;case"username":R[G]="username="+e;break;case"authpwd":R[G]="authpwd="+t;break;case"brandid":R[G]="brandid="+i;break;case"brandname":R[G]="brandname="+a;break;case"companyname":R[G]="companyname="+r;break;case"needregister":R[G]="needregister="+P.toString();break;case"callerid":R[G]="callerid="+l;break;case"displayname":R[G]="displayname="+p;break;case"voicerecupload":R[G]="voicerecupload="+s;break;case"engine":R[G]="engine="+N;break;case"proxyaddress":R[G]="proxyaddress="+c}else{var L=R[G].substring(R[G].indexOf("=")+1),O=ParameterIsDefault("transport"),D=GetParameterInt("transport",-1),x="udp";1===D?x="tcp":2===D&&(x="tls"),D<0||(isNull(L)||L.length<1?O||(R[G]=y+"="+x):R[G]=y+"="+x)}else{var L=R[G].substring(R[G].indexOf("=")+1);isNull(L)||L.length<1?R[G]=y+"="+GetWebrtcUpperServer():"true"===GetParameter("iswebrtcuppersrvfromuser")&&(R[G]=y+"="+GetWebrtcUpperServer())}}C="";for(var G=0;G<R.length;G++)isNull(R[G])||R[G].indexOf("=")<2||(C.length>0&&(C+="&"),C+=R[G]);E=S+o+C,h.length>0&&(E=E+"&inbounddtmf="+h),g.length>0&&(E=E+"&outbounddtmf="+g)}E.indexOf("authid=")<0&&(E=E+"&authid="+e),E.indexOf("authpwd=")<0&&(E=E+"&authpwd="+t),E.indexOf("upperserver=")<0&&(E=E+"&upperserver="+GetWebrtcUpperServer()),E.indexOf("upperserverdomain=")<0&&(E=E+"&upperserverdomain="+GetWebrtcUpperServer()),E.indexOf("voicerecupload=")<0&&(E=E+"&voicerecupload="+s),E.indexOf("needregister=")<0&&(E=E+"&needregister="+P.toString()),E.indexOf("callerid=")<0&&(E=E+"&callerid="+l),E.indexOf("displayname=")<0&&(E=E+"&displayname="+p),E.indexOf("proxyaddress=")<0&&(E=E+"&proxyaddress="+c),E.indexOf("dtmfmode=")<0&&(E=E+"&dtmfmode="+m),E.indexOf("engine=")<0&&(E=E+"&engine="+N),d.length>0&&"-1"!=d&&E.indexOf("transport=")<0&&(E=E+"&transport="+d),T=!0}if(!1===T){var A="&authpwd="+t;!1===IsMizuWebRTCGatewayAndNotMizuServer()&&o.indexOf("rtc.mizu-voip.com:2443")<0&&(A="&authmd5=MD5VALUE&authsalt=MD5SALT"),E=S+o+"/mvapireq/?apientry=wsuser&authkey="+v+"&authid="+e+A+"&brandid="+i+"&brandname="+a+"&companyname="+r+"&upperserver="+GetWebrtcUpperServer()+"&needregister="+P.toString()+"&callerid="+l+"&displayname="+p+"&voicerecupload="+s+"&engine="+N+"&dtmfmode="+m+"&proxyaddress="+c+"&sessionid="+GetSessionId()+"&now=415",h.length>0&&(E=E+"&inbounddtmf="+h),g.length>0&&(E=E+"&outbounddtmf="+g)}if(E.indexOf("appversion=")<0&&(E=E+"&appversion="+webphone_api.global.versionstr),E.indexOf("transport=")<0&&!1===ParameterIsDefault("transport")){var D=GetParameterInt("transport",0),x="udp";1===D?x="tcp":2===D&&(x="tls"),E=E+"&transport="+x}if(!1===Glcr()&&(w=E.indexOf("voicerecupload"))>0){var k=E.substring(0,w),U="";U=E.substring(w),w=U.indexOf("&"),U=w>0?U.substring(w+1):"",E=k+U}return E}catch(V){PutToDebugLogException(2,"common: GetWsuserUrl",V)}return""}function GetWsloadUrl(e){try{var t=GetWebrtcSrvAddr(),n=GetConfig("brandid"),o=GetBrandName(),i=GetConfig("companyname"),a="http://";if(UseSecureSrvConnection()&&(a="https://"),(isNull(t)||t.length<2)&&(t=GetWp()),t=t.toLowerCase(),t.indexOf("mfstwebsock")<0)return"";t=NormalizeInput(t,0),t=t.replace("*","");var r=t.indexOf("/");r>0&&(t=t.substring(0,r));var s="1568108345";"us"===webphone_api.global.usuk&&(s="1552303117"),IsMizuPublicWebRTCGateway()||(s=GetConfig("serverapikey")),t.indexOf("rtc.mizu-voip.com:2443")>=0&&(s="1568108399");var l=GetConfig("wsload"),p=!1;if(!isNull(l)&&l.length>10&&l.indexOf("?")>0&&l.indexOf("&")>0){t=l,r=t.indexOf("://"),r>0&&(t=t.substring(r+3)),r=t.indexOf("?"),t=t.substring(0,r+1);var c=l.substring(r+1);c=c.toLowerCase();var u=c.split("&");if(!isNull(u)&&u.length>0){for(var h=0;h<u.length;h++)if(!(isNull(u[h])||u[h].indexOf("=")<2||0===u[h].indexOf("apientry=")||0===u[h].indexOf("authkey="))){var g=u[h].substring(0,u[h].indexOf("="));switch(g){case"authid":u[h]="authid="+e;break;case"username":u[h]="username="+e;break;case"brandid":u[h]="brandid="+n;break;case"brandname":u[h]="brandname="+o;break;case"companyname":u[h]="companyname="+i;break;case"upperserver":u[h]="upperserver="+GetWebrtcUpperServer()}}c="";for(var h=0;h<u.length;h++)isNull(u[h])||u[h].indexOf("=")<2||(c.length>0&&(c+="&"),c+=u[h]);l=a+t+c}p=!0}else{var m=GetConfig("wsuser");if(!isNull(m)&&m.length>10){var d=m;if(r=d.indexOf("://"),r>0&&(d=d.substring(r+3)),r=d.indexOf("/"),r>0&&(d=d.substring(0,r)),r=d.indexOf("?"),r>0&&(d=d.substring(0,r)),d.length>0&&(PutToDebugLog(4,"EVENT, GetWsloadUrl guessed domain: "+d),t=d),(r=m.indexOf("authkey="))>0){var b=m.substring(r+8);r=b.indexOf("&"),r>0&&(b=b.substring(0,r)),!isNull(b)&&b.length>2&&(PutToDebugLog(4,"EVENT, GetWsloadUrl guessed apikey: "+b),s=b)}}}return!1===p&&(l=a+t+"/mvapireq/?authkey="+s+"&apientry=wsload&brandid="+n+"&brandname="+o+"&companyname="+i+"&upperserver="+GetWebrtcUpperServer()+"&authid="+e+"&now=415"),l}catch(_){PutToDebugLogException(2,"common: GetWsloadUrl",_)}return""}function HandleCalldivert(){try{if(!IsMizuServerOrGateway())return;var e=GetParameter("calldivertchecksum");isNull(e)&&(e="");if("1"===GetParameter("calldivertsuccess"))return;var t=GetParameter2("callforwardonbusy"),n=GetParameter2("callforwardonnoanswer"),o=GetParameter2("callforwardalways"),i=GetParameter2("callforwardonnoanswertimeout"),a=Md5Hash(t+n+o+i);if(e===a)return;PutToDebugLog(2,"EVENT, HandleCalldivert old checksum: "+e+" ; new checksum: "+a),(isNull(t)||t.length<1)&&(t="null"),(isNull(n)||n.length<1)&&(n="null"),(isNull(o)||o.length<1)&&(o="null"),SaveParameter("calldivertsuccess","0");var r=GetWebrtcSrvAddr(),s="http://";UseSecureSrvConnection()&&(s="https://"),(isNull(r)||r.length<2)&&(r=GetWp()),r=r.toLowerCase(),r=NormalizeInput(r,0),r=r.replace("*","");var l=r.indexOf("/");l>0&&(r=r.substring(0,l));var p="1568108345";"us"===webphone_api.global.usuk&&(p="1552303117"),IsMizuPublicWebRTCGateway()||(p=GetConfig("serverapikey"));var c=GetConfig("wsload"),u=GetConfig("wsuser");if(!isNull(u)&&u.length>10){var h=u;if(l=h.indexOf("://"),l>0&&(h=h.substring(l+3)),l=h.indexOf("/"),l>0&&(h=h.substring(0,l)),l=h.indexOf("?"),l>0&&(h=h.substring(0,l)),h.length>0&&(PutToDebugLog(4,"EVENT, GetCalldivertUrl guessed domain: "+h),r=h),(l=u.indexOf("authkey="))>0){var g=u.substring(l+8);l=g.indexOf("&"),l>0&&(g=g.substring(0,l)),!isNull(g)&&g.length>0&&(PutToDebugLog(4,"EVENT, GetCalldivertUrl guessed apikey: "+g),p=g)}}c=s+r+"/mvapireq/?authkey="+p+"&authid="+GetSipusername()+"&authpwd="+GetParameter("password")+"&apientry=calldivert&callforwardonbusy="+t+"&callforwardonnoanswer="+n+"&callforwardalways="+o+"&callforwardonnoanswertimeout="+i+"&now=415",UriParser(c,"","","","","calldivertapi")}catch(m){PutToDebugLogException(2,"common: HandleCalldivert",m)}}function SetVoiceMailNumber(e){try{var t="";webphone_api.getsipheader("Server",function(e){!isNull(e)&&e.length>0&&(t=e),webphone_api.getsipheader("User-Agent",function(e){!isNull(e)&&e.length>0&&(hua=e),hua.indexOf("Asterisk")>=0||hua.indexOf("FPBX")>=0||hua.indexOf("FreePBX")>=0||hua.indexOf("FreeSWITCH")>=0||hua.indexOf("Asterisk")>=0||t.indexOf("FPBX")>=0||t.indexOf("FreePBX")>=0||t.indexOf("FreeSWITCH"),SetVoiceMailNumberDelayed(null,"*97")})})}catch(n){PutToDebugLogException(2,"common: HandleCalldivert",n)}}function SetVoiceMailNumberDelayed(e,t){try{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,n>400?n=400:n<120&&(n=120),void 0!==t&&null!==t||(t=""),t=Trim(t);var o='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("voicemail_title")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+webphone_api.stringres.get("voicemail_msg")+'</span><input type="text" id="voicemail_input" name="setting_item" data-theme="a" autocapitalize="off" value="'+t+'"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(o).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click")}});var i=document.getElementById("voicemail_input");isNull(i)||i.focus(),webphone_api.$("#adialog_positive").on("click",function(t){PutToDebugLog(5,"EVENT, common SetVoiceMailNumber OK click");var n="";isNull(i)||(n=i.value),!isNull(n)&&n.length>0&&(n=Trim(n),SaveParameter("voicemailnum",n)),e&&"function"==typeof e&&e(n)}),webphone_api.$("#adialog_negative").on("click",function(e){})}catch(a){PutToDebugLogException(2,"common: SetVoiceMailNumber",a)}}function CreateConferenceRoom(e,t){var n="";try{webphone_api.global.lastcontarget=t;var o=GetConfigAll(!0);if(!isNull(o)&&n.length<1)for(var i in o){var a=o[i];if(!isNull(a)&&a.toString().indexOf("/mvapireq/?apientry=")>0){var r=a.toString();r.indexOf("authkey=")>0&&(r=r.substring(r.indexOf("authkey=")),r.indexOf("&")>0&&(r=r.substring(0,r.indexOf("&")))),n=a.toString(),n=n.substring(0,n.indexOf("?")+1),n=n+r+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&target="+t+"&apientry=getconfroom";break}}if(n.length<1){var s=GetConfig("mainaport");s=!isNull(s)&&s.length>0?":"+s:"";var l=GetParameter("serveraddress");if((isNull(l)||l.length<1)&&(l=GetParameter("serveraddress_user")),!isNull(l)&&l.length>0){var p="";GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(p="1568108399"),(isNull(p)||p.length<1)&&(p="1568108345","us"===webphone_api.global.usuk&&(p="1552303117"),l=GetDomainFromURL(GetWsuserUrl(GetSipusername(),GetParameter("password"))));var c="http://";!0===UseSecureSrvConnection()&&(c="https://"),n=c+l+s+"/mvapireq/?authkey="+p+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&target="+t+"&apientry=getconfroom"}}if(n.length>0){if(!0!==e)return n;!isNull(webphone_api.global.lastconfroom)&&webphone_api.global.lastconfroom.length>2?(PutToDebugLog(3,"EVENT, CreateConferenceRoom returning cached conference room: "+webphone_api.global.lastconfroom),ConferenceRoomReceived(webphone_api.global.lastconfroom)):UriParser(n,"","","","","getconferenceroom")}else PutToDebugLog(1,"ERROR, Cannot create conference room"),PutToDebugLog(2,"ERROR, CreateConferenceRoom invalid uri: "+n)}catch(u){PutToDebugLogException(2,"common: CreateConferenceRoom",u)}return""}function ConferenceRoomReceived(e){try{if(isNull(e))return PutToDebugLog(1,"ERROR, Ivalid conference room"),void PutToDebugLog(2,"ERROR, Ivalid conference room: "+e);var t=e.toLowerCase().indexOf("error:");if(t>=0){return void PutToDebugLog(1,"ERROR, "+e.substring(t+6))}if(e=e.toLowerCase(),t=e.indexOf("ok:"),e.indexOf("error:")>0)e.indexOf("higlhoad")>0&&(ebphone_api.global.lastconftargetstate=5);else if(t>=0){webphone_api.global.lastconfroom=e;var n=e.substring(t+3);t=n.indexOf(":"),t>=0&&(n=n.substring(t+1)),n.indexOf(" usr: notexists")>0?webphone_api.global.lastconftargetstate=1:n.indexOf(" usr: registered")>0?webphone_api.global.lastconftargetstate=4:n.indexOf(" usr: push")>0?webphone_api.global.lastconftargetstate=3:n.indexOf(" usr: exists")>0?webphone_api.global.lastconftargetstate=2:webphone_api.global.lastconftargetstate=0,t=n.indexOf(" usr: "),t>0&&(n=n.substring(0,t)),n=Trim(n),PutToDebugLog(2,"EVENT, Received conference room: "+n),webphone_api.global.confanswer_received=!0;var o=GetParameter("received_confrooms");isNull(o)&&(o="");for(var i=o.split(","),a=!1,r=0;r<i.length;r++)if(i[r]===n){a=!0;break}if(i.length>10)for(;i.length>10;)i.shift();!1===a&&i.push(n),o="";for(var r=0;r<i.length;r++)isNull(i[r])||(o.length>0&&(o+=","),o+=i[r]);SaveParameter("received_confrooms",o),currconfroom=n;var s=!1;if(!1===IsSDK()&&!0===webphone_api.global.isDialpadStarted&&(InitiateConference(""),s=!0),!s&&webphone_api.global.confcanfailover&&(3==webphone_api.global.lastconftargetstate||4==webphone_api.global.lastconftargetstate)&&webphone_api.global.lastcontarget.length>0&&(PutToDebugLog(2,"EVENT, Conference failover to DTMF: "+webphone_api.global.lastcontarget),webphone_api.dtmf("*1*"+webphone_api.global.lastcontarget+"#"),s=!0),!s){var l=GetParameterInt("conferencerooms",-1),p=GetParameterInt("conferencetype",-1);p<0&&(p=1==l?5:2==l?6:3==l?7:1);var c="",u=!1;if(GetNrOfActiveCalls()>0){if(c=GetPeerUsername(),(1==p||5==p)&&c.length>0){PutToDebugLog(2,"EVENT, ConferenceRoom transfer call ("+c+") to conf room number: "+n);var h=GetCallSession(17,!1,webphone_api.global.aline,c);h&&0!=h.transfer(n)&&(u=!0)}
PutToDebugLog(2,"EVENT, ConferenceRoom hangup active call ("+c+") and call conf room number: "+n),webphone_api.hangup()}if(PutToDebugLog(2,"EVENT, mlogic API_Call ConferenceRoomReceived"),webphone_api.call(n),!isNull(webphone_api.global.waiting_conf_numbers)&&webphone_api.global.waiting_conf_numbers.length>0){var g=webphone_api.global.waiting_conf_numbers.split(",");if(!isNull(g)&&g.length>0)for(var r=0;r<g.length;r++)isNull(g[r])||Trim(g[r]).length<1||(c.length>0&&c==g[r]&&(c=""),SendConferenceInvites(g[r],n));c.length>0&&!u&&SendConferenceInvites(c,n)}}}else PutToDebugLog(1,"ERROR, No conference room received: "+e)}catch(m){PutToDebugLogException(2,"common: ConferenceRoomReceived",m)}}function InitiateConference(e){try{!isNull(e)&&e.length>0&&(conf_ct.length>0&&(conf_ct+=","),conf_ct+=e);var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,t>400?t=400:t<120&&(t=120);var n=webphone_api.stringres.get("confroom_msg1")+": "+currconfroom+"<br /><br />"+webphone_api.stringres.get("confroom_msg2")+":",o='<div id="conferenceroom_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("menu_confrooms")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+n+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="conferenceroom_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+GetElementSource()+'images/btn_add_contact_txt.png"></button></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(o).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click"),webphone_api.$("#btn_pickct").off("click")}});var i=document.getElementById("conferenceroom_input");!isNull(conf_ct)&&conf_ct.length>1&&(i.value=Trim(conf_ct)),isNull(i)||i.focus(),setTimeout(function(){isNull(i)||i.focus()},150),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, call Conferenceroom ok onclick");var t=Trim(i.value);webphone_api.$("#conferenceroom_popup").on("popupafterclose",function(e){!isNull(t)&&t.length>0?(conf_ct="",SendConferenceInvites(t,currconfroom),7!==GetParameterInt("conferencetype",1)&&(PutToDebugLog(2,"EVENT, mlogic API_Call InitiateConference"),webphone_api.call(currconfroom))):(ShowToast(webphone_api.stringres.get("err_msg_4")),webphone_api.$.mobile.back())})}),webphone_api.$("#adialog_negative").on("click",function(e){}),webphone_api.$("#btn_pickct").on("click",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.$("#conferenceroom_popup").on("popupafterclose",function(e){webphone_api.$("#conferenceroom_popup").off("popupafterclose"),PickContact(InitiateConference)})})}catch(a){PutToDebugLogException(2,"common: InitiateConference",a)}}function SendConferenceInvites(e,t){function n(){try{var e=GetParameter2("webrtcgwsipaddress");if(!isNull(e)&&e.length>2)return e;if((!0===webphone_api.global.decideusuk_finished||isNull(apikey)||apikey.length<1)&&webphone_api.global.usuk.length>0){if("uk"===webphone_api.global.usuk)return"rtc.mizu-voip.com";if("us"===webphone_api.global.usuk)return"usrtcx.webvoipphone.com"}var t=GetParameter2("serveraddress_user");if((isNull(t)||t.length<2)&&(t=GetParameter2("serveraddress")),isNull(t)||t.length<2)return"";var n=GetWebrtcSrvAddr();if(isNull(n)||n.length<2)return"";var o=n.indexOf("//");o>0&&(n=n.substr(o+2));var o=n.indexOf("/");if(o>0&&(n=n.substr(0,o)),isNull(n)||n.length<2)return"";if(t.indexOf(n)>=0)return t}catch(i){PutToDebugLogException(2,"common: GetWebRTCServerSIPAddress",i)}return""}try{var o=GetParameterInt("conferencerooms",-1),i=GetParameterInt("conferencetype",-1);i<0&&(i=1==o?5:2==o?6:3==o?7:1);var a=GetSipHeaderInternal("X-UT");isNull(a)&&(a=""),a=Trim(a),t.indexOf("@")<0&&"g"===a&&n().length>0&&(t=t+"@"+n());var r="[DONT_START_CHAT_WINDOW][CONFERENCE] You are invited to conference by: "+GetSipusername()+". Call this number to join the conference: "+t,s=e.split(",");if(isNull(s)||s.length<1)return;for(var l=0;l<s.length;)isNull(s[l])||s[l].length<1?s.splice(l,1):l++;var p=Trim(s[0]);i<6?(PutToDebugLog(2,"EVENT, mlogic API_SendCaht SendConferenceInvites"),webphone_api.sendchat(p,r)):6===i?(PutToDebugLog(2,"EVENT, mlogic API_SendChat SendConferenceInvites 2"),webphone_api.sendchat(p,r)):7===i&&function(){function e(){isNull(cftimer)||clearInterval(cftimer),cftimer=null}try{if(null===cftimer){var n=0,o=0;cftimer=setInterval(function(){if(++cfmaxloop>90)return void e();n<1?(n=1,!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, ConfRoom: hangup active call"),PutToDebugLog(2,"EVENT, mlogic API_Hangup HanleConfTransfer"),webphone_api.hangup())):cfmaxloop>2&&1===n?(PutToDebugLog(2,"EVENT, ConfRoom: call destination: "+p),PutToDebugLog(2,"EVENT, mlogic API_Call HanleConfTransfer: "+p),webphone_api.call(p),n=2):2===n?!0===webphone_api.global.checkIfCallActive&&(PutToDebugLog(2,"EVENT, ConfRoom: destination accepted the call"),n=3,cfmaxloop>40&&(cfmaxloop=10)):3===n?(PutToDebugLog(2,"EVENT, ConfRoom: transfer call: "+t),PutToDebugLog(2,"EVENT, mlogic API_Transfer HanleConfTransfer: "+t),webphone_api.transfer(t),n=5,o=cfmaxloop+5):5===n&&o<cfmaxloop&&(PutToDebugLog(2,"EVENT, ConfRoom: call conf room: "+t),PutToDebugLog(2,"EVENT, mlogic API_Call HanleConfTransfer 2: "+t),webphone_api.call(t),e())},330)}}catch(i){PutToDebugLogException(2,"common: HanleConfTransfer",i)}}()}catch(c){PutToDebugLogException(2,"common: SendConferenceInvites",c)}}function ReceivedConferenceInvite(e,t){try{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220;var o=t.lastIndexOf(":");o>0&&(t=t.substring(o+1));var i=Trim(t);t=webphone_api.stringres.get("confroom_inv_msg")+": "+e;var a='<div id="conferenceinvite_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("confroom_inv_title")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+t+'</span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_accept")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_reject")+"</a></div></div>";Beep("1"),webphone_api.$.mobile.activePage.append(a).trigger("create"),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition")}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_positive").off("click"),webphone_api.$("#adialog_negative").off("click")}}),PutToDebugLog(2,"EVENT, mlogic API_SendChat ReceivedConferenceInvite"),webphone_api.sendchat(e,"[DONT_START_CHAT_WINDOW][CONFERENCE_ANSWER]"),webphone_api.$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, ReceivedConferenceInvite ok onclick"),webphone_api.$("#conferenceinvite_popup").on("popupafterclose",function(e){webphone_api.global.isconfcall=!0,PutToDebugLog(2,"EVENT, mlogic API_Call ReceivedConferenceInvite: "+i),webphone_api.call(i)})}),webphone_api.$("#adialog_negative").on("click",function(e){})}catch(r){PutToDebugLogException(2,"common: ReceivedConferenceInvite",r)}}function IsServiceUpToDate(){try{if(webphone_api.global.nsupdatepending)return;var e=GetParameterInt("autosrvupgrade",1),t=GetParameterInt("nsupgrademode",1);if((e<1||!0===serviceupdatechecked||0===t)&&t<2)return;WinAPI("extcmd_version",function(n){if(isNull(n)||n.indexOf("ERROR:")>=0)return void PutToDebugLog(2,"ERROR, IsServiceUpToDate: "+n);var o=GetMinServiceVersion(),i=0,a=n,r=a.indexOf("version:");if(r>0&&(a=a.substring(r+8)),r=a.indexOf("eov"),r>0&&(a=a.substring(0,r)),a=Trim(a),!isNull(a)&&IsNumber(a))(i=StrToInt(a))>0&&SaveParameter("srvupgrade_currversion",i);else if(PutToDebugLog(2,"ERROR, IsServiceUpToDate, received data is ivalid: "+a),t<2)return;var s=GetConfig("confighash");isNull(s)&&(s="");var l="";WinAPI("API_GetConfigHash",function(n){if(isNull(n)&&(n=""),l=Trim(n),serviceupdatechecked=!0,o>i||32===s.length&&32===l.length&&s!==l){var a=!0;if(1===e){var r=GetParameterInt("srvupgrade_count",0);r<3?(a=!1,PutToDebugLog(2,"EVENT, native service upgrade skipped because count: "+r.toString()),r++):r=0,SaveParameter("srvupgrade_count",r)}var p=GetParameter("srvupgrade_version"),c=i.toString()+"_"+o.toString();p===c&&(a=!1),2===t&&(a=!0),PutToDebugLog(2,"EVENT, native service upgrade sv: "+p+" : "+c),!0===a&&(SaveParameter("srvupgrade_version",c),EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0)}})})}catch(n){PutToDebugLogException(2,"common: IsServiceUpToDate",n)}}function GetMinServiceVersion(){try{var e=webphone_api.global.minimumserviceversion,t=webphone_api.parameters.minserviceversion;return!isNull(t)&&IsNumber(t)&&(e=StrToInt(t)),t=GetConfig("minserviceversion"),!isNull(t)&&IsNumber(t)&&StrToInt(t)>e&&(e=StrToInt(t)),e}catch(n){PutToDebugLogException(2,"common: GetMinServiceVersion",n)}return 0}function GetAudioBandwidth(){try{var e=64,t=GetParameter2("audio_bandwidth");if(!isNull(t)&&IsNumber(t)){var n=StrToInt(t);n>=0&&n<2049&&(e=n)}return e}catch(o){PutToDebugLogException(2,"common: GetAudioBandwidth",o)}return 0}function GetVideoBandwidth(){try{var e=256,t=GetParameter2("video_bandwidth");if(!isNull(t)&&IsNumber(t)){var n=StrToInt(t);n>=0&&n<4e3&&(e=n)}return e}catch(o){PutToDebugLogException(2,"common: GetVideoBandwidth",o)}return 0}function GetVideoWidth(){try{var e=320,t=GetParameter2("video_width");if(!isNull(t)&&IsNumber(t)){var n=StrToInt(t);n>0&&n<4e3&&(e=n)}return e}catch(o){PutToDebugLogException(2,"common: GetVideoWidth",o)}return 0}function GetVideoHeight(){try{var e=240,t=GetParameter2("video_height");if(!isNull(t)&&IsNumber(t)){var n=StrToInt(t);n>0&&n<4e3&&(e=n)}return e}catch(o){PutToDebugLogException(2,"common: GetVideoHeight",o)}return 0}function EngineSwitchConference(e,t,n,o){try{SaveParameter("conf_engineswitcheoffered","true"),PutToDebugLog(2,"EVENT, EngineSwitchConference called");var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220;var a="Conferencing is not available for WebRTC. If this functionality is important for you, we recommend to use "+GetEngineDisplayName(e)+" engine.<br /><br />Would you like to switch to "+GetEngineDisplayName(e)+" engine ?",r='<div data-role="popup" id="conf_switch_popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("switch_engine")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+a+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";o=o||function(){},webphone_api.$.mobile.activePage.append(r).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e+100&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),o()}}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, EngineSwitchConference cancel click"),n(t)}),webphone_api.$("#adialog_positive").on("click",function(t){PutToDebugLog(5,"EVENT, EngineSwitchConference ok click, engine: "+e),webphone_api.$("#conf_switch_popup").on("popupafterclose",function(t){if(PutToDebugLog(2,"EVENT, EngineSwitchConference hangup active call"),!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, mlogic API_Hangup EngineSwitchConference"),webphone_api.hangup()),"java"===e){webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var n=GetEngine("java");n.clicked=2,SetEngine("java",n),OpenSettings(!0,6),setTimeout(function(){InstallJavaPopup(!1)},400)}else{SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var n=GetEngine("ns");n.clicked=2,SetEngine("ns",n),EngineSelect(1,24),EngineForcedInstall("ns","",function(){webphone_api.startInner()})}})})}catch(s){PutToDebugLogException(2,"common: EngineSwitchConference",s)}}function EngineSwitchTransfer(e,t,n,o){try{SaveParameter("transf_engineswitcheoffered","true"),PutToDebugLog(2,"EVENT, EngineSwitchTransfer called");var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220;var a="Transfer with WebRTC works only between WebRTC endpoints. If this functionality is important for you, we recommend to use "+GetEngineDisplayName(e)+" engine.<br /><br />Would you like to switch to "+GetEngineDisplayName(e)+" engine ?",r='<div data-role="popup" id="transf_switch_popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("switch_engine")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+a+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";o=o||function(){},webphone_api.$.mobile.activePage.append(r).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());webphone_api.$(this).height()>e+100&&webphone_api.$(".messagePopup .ui-content").height(e)}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),o()}}),webphone_api.$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, EngineSwitchTransfer cancel click"),n(t)}),webphone_api.$("#adialog_positive").on("click",function(t){PutToDebugLog(5,"EVENT, EngineSwitchTransfer ok click, engie: "+e),webphone_api.$("#transf_switch_popup").on("popupafterclose",function(t){if(PutToDebugLog(2,"EVENT, EngineSwitchTransfer hangup active call"),!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, mlogic API_Hangup EngineSwitchTransfer"),webphone_api.hangup()),"java"===e){webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var n=GetEngine("java");n.clicked=2,SetEngine("java",n),OpenSettings(!0,7),setTimeout(function(){InstallJavaPopup(!1)},400)}else{webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var n=GetEngine("ns");n.clicked=2,SetEngine("ns",n),setTimeout(function(){NPDownloadAndInstall()},400);var o=GetNPLocation();!isNull(o)&&o.length>0&&window.open(o)}})})}catch(s){PutToDebugLogException(2,"common: EngineSwitchTransfer",s)}}function HideSettings(e,t,n,o){try{if(isNull(enableoptions)){enableoptions=[];var i="";!isNull(webphone_api.parameters.enableoptions)&&webphone_api.parameters.enableoptions.length>0&&(i=webphone_api.parameters.enableoptions),(isNull(i)||i.length<2)&&(i=GetConfig("enableoptions")),!isNull(i)&&i.length>0&&(i=Trim(i),enableoptions=i.split(",")),isNull(enableoptions)&&(enableoptions=[])}if(isNull(disableoptions)){disableoptions=[];var i="";!isNull(webphone_api.parameters.disableoptions)&&webphone_api.parameters.disableoptions.length>0&&(i=webphone_api.parameters.disableoptions),(isNull(i)||i.length<2)&&(i=GetConfig("disableoptions")),!isNull(i)&&i.length>0&&(i=Trim(i),disableoptions=i.split(",")),isNull(disableoptions)&&(disableoptions=[])}if(isNull(e)&&(e=""),isNull(t)&&(t=""),isNull(n)&&(n=""),isNull(o)&&(o=!1),enableoptions.length>0&&(e.length>0||t.length>0||n.length>0)){e=e.toLowerCase(),t=t.toLowerCase(),n=n.toLowerCase();for(var a=0;a<enableoptions.length;a++){var r=enableoptions[a];if(!(isNull(r)||r.length<1)&&(r=r.toLowerCase(),e.indexOf(r)>=0||r===t||r===n))return!1}return!0}if(disableoptions.length>0&&(e.length>0||t.length>0||n.length>0)){e=e.toLowerCase(),t=t.toLowerCase(),n=n.toLowerCase();for(var a=0;a<disableoptions.length;a++){var r=disableoptions[a];if(!(isNull(r)||r.length<1)&&(r=r.toLowerCase(),e.indexOf(r)>=0||r===t||r===n))return!0!==o||!!StrIsUpperCase(disableoptions[a])}}}catch(s){PutToDebugLogException(2,"common: HideSettings",s)}return!1}function ShowRatingWhyleType(e){try{if(webphone_api.global.showratewhiletype_cache<1||isNull(e)||e.length<1)return;webphone_api.$("#disprate_container").html(e)}catch(t){PutToDebugLogException(2,"common: ShowRatingWhyleType",t)}}function SetLanguage(){try{var e=webphone_api.parameters.language;if((isNull(e)||2!==e.length)&&(e=GetConfig("language")),(isNull(e)||2!==e.length)&&(e=GetParameter("language")),isNull(e))return void PutToDebugLog(2,"EVENT, common: SetLanguage invalid language: "+e);2===e.length&&(webphone_api.stringres.setlang(e),CanLog(3)&&PutToDebugLog(3,"EVENT, language set to: "+e))}catch(t){PutToDebugLogException(2,"common: SetLanguage",t)}}function SetNotCounter(e,t){try{if(isNull(e)||e.length<1)return;var n=document.getElementById(e);if(isNull(n))return;!isNull(t)&&t.length>0&&IsNumber(t)&&"0"!=t?(n.innerHTML=t,n.style.display="block"):(n.innerHTML="",n.style.display="none")}catch(o){PutToDebugLogException(2,"common: SetNotCounter",o)}}function WebContactGet(e,t){try{if(isNull(webct_url)&&(webct_url=GetParameter2("webcontact_url"),(isNull(webct_url)||webct_url.length<3)&&(webct_url=GetConfig("webcontact_url")),isNull(webct_url)&&(webct_url="")),webct_url.length<3)return;if(isNull(e)||e.length<1)return void PutToDebugLog(3,"WARNING, common WebContactGet invalid number: "+e);if(!t||"function"!=typeof t)return void PutToDebugLog(3,"ERROR, common WebContactGet callback is NULL");var n=webct_url.replace("CALLEDNUMBER",e);webct_cb.push(t),UriParser(n,"","","","","webcontactsearch")}catch(o){PutToDebugLogException(2,"common: WebContactGet",o)}}function WebContactReceived(e){try{if(isNull(webct_cb)||webct_cb.length<1)return void PutToDebugLog(3,"ERROR, common WebContactReceived no callback specified");var t=webct_cb.shift();if(isNull(t)||!t||"function"!=typeof t)return void PutToDebugLog(3,"ERROR, common WebContactReceived invalid callback");if(isNull(e)||e.length<2)return void PutToDebugLog(3,"WARNING, common WebContactReceived invalid data: "+e);var n=[];if(webct_url.toLowerCase().indexOf("tel.search.ch")>=0){var o=e.split("</entry>");if(!isNull(o)&&o.length>0)for(var i=0,a=0;a<o.length;a++)if(!((i=o[a].indexOf("<entry>"))<0)){var r=o[a].substring(i),s="",l="",i=r.indexOf("<tel:name>");i>0&&(s=r.substring(i+10),i=s.indexOf("</tel:name>"),i>0&&(s=s.substring(0,i)),isNull(s)&&(s=""),s=Trim(s)),i=r.indexOf("<tel:phone>"),i>0&&(l=r.substring(i+11),i=l.indexOf("</tel:phone>"),i>0&&(l=l.substring(0,i)),isNull(l)&&(l=""),l=Trim(l)),n.push(s+","+l)}}n.length<1&&n.push(e),t(n)}catch(p){PutToDebugLogException(2,"common: WebContactReceived",p)}}function IsXML(e){try{webphone_api.$.parseXML(e);return!0}catch(t){}return!1}function GetLastRecInvite(){return isNull(saved_lastrecinvite)&&(saved_lastrecinvite=""),saved_lastrecinvite}function GetLastSentInvite(){return isNull(saved_lastsentinvite)&&(saved_lastsentinvite=""),saved_lastsentinvite}function GetSIPHeaderTxt(e){if(isNull(e))return"NULL";if(e.length<1)return"EMPTY";for(var t="",n=0;n<e.length;n++)t=t+e[n].name+":"+e[n].value+", ";return t}function GetEpIdxFromLine(e){for(var t=0;t<webphone_api.global.ep.length;t++)if(!(isNull(webphone_api.global.ep[t])||webphone_api.global.ep[t].length<5)){var n=webphone_api.global.ep[t][EP_LINE];if(!isNull(n)&&!1!==IsNumber(n)&&e===n)return t}return-1}function SaveCallSession(e,t,n,o,i,a,r,s,l,p,c,u,h,g,m,d,b){try{var _=-1;IsNumber(t)||(t=-1),isNull(o)&&(o=""),o=Trim(o),IsNumber(i)||(i=-1),IsNumber(a)||(a=-1),IsNumber(r)||(r=-1),IsNumber(s)||(s=-1),(isNull(l)||l.length<1)&&(l=""),l=Trim(l),(isNull(p)||p.length<1)&&(p=""),p=Trim(p),p.length>0&&"["==p[0]&&(p=p.substring(1)),p.length>0&&"]"==p[p.length-1]&&(p=p.substring(0,p.length-1)),!isNull(b)&&IsNumber(b)||(b=-1),(isNull(c)||c.length<1)&&(c=""),(isNull(u)||u.length<1)&&(u=""),(isNull(g)||"true"!==g&&"false"!==g)&&(g=""),(isNull(m)||"true"!==m&&"false"!==m)&&(m=""),(isNull(d)||d.length<10)&&(d=""),!isNull(h)&&h.length<1&&(h=null),d.length>10&&(1==i?saved_lastsentinvite=d:2==i&&(saved_lastrecinvite=d));for(var f=0;f<webphone_api.global.ep.length;f++)(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)&&(PutToDebugLog(2,"ERROR, common: SaveCallSession remove invalid endpoint: "+LineToString(f)),LogLines(),webphone_api.global.ep.splice(f,1),f--);var w="";if(b>0)for(var f=0;f<webphone_api.global.ep.length;f++)if(!(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)){var v=webphone_api.global.ep[f][EP_SESSID];if(v===b){w="webrtcid",_=f;break}}if(_<0&&p.length>0)for(var f=0;f<webphone_api.global.ep.length;f++)if(!(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)){var v=webphone_api.global.ep[f][EP_CALLID];if(!(isNull(v)||v.length<1)&&p.toLowerCase()===v.toLowerCase()){w="callid",_=f;break}}if(_<0&&t>0){if(IsNumber(i))for(var f=0;f<webphone_api.global.ep.length;f++)if(!(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)){var P=webphone_api.global.ep[f][EP_LINE];if(!isNull(P)&&!1!==IsNumber(P)&&t===P){var E=webphone_api.global.ep[f][EP_INCOMING];if(IsNumber(E)&&i===E&&"true"!==webphone_api.global.ep[f][EP_FLAGDEL]){w="line1",_=f;break}}}if(_<0)for(var f=0;f<webphone_api.global.ep.length;f++)if(!(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)){var P=webphone_api.global.ep[f][EP_LINE];if(!isNull(P)&&!1!==IsNumber(P)&&"true"!==webphone_api.global.ep[f][EP_FLAGDEL]&&t===P){w="line2",_=f;break}}if(_<0)for(var f=0;f<webphone_api.global.ep.length;f++)if(!(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)){var P=webphone_api.global.ep[f][EP_LINE];if(!isNull(P)&&!1!==IsNumber(P)&&t===P){w="line3",_=f;break}}}if(_<0&&o.length>0){if(IsNumber(i))for(var f=0;f<webphone_api.global.ep.length;f++)if(!(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)){var T=webphone_api.global.ep[f][EP_DESTNR];if(!isNull(T)&&T.toLowerCase()==o){var E=webphone_api.global.ep[f][EP_INCOMING];if(IsNumber(E)&&i===E&&"true"!==webphone_api.global.ep[f][EP_FLAGDEL]){w="destnum1",_=f;break}}}if(_<0)for(var f=0;f<webphone_api.global.ep.length;f++)if(!(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)){var T=webphone_api.global.ep[f][EP_DESTNR];if(!isNull(T)&&T.toLowerCase()==o&&"true"!==webphone_api.global.ep[f][EP_FLAGDEL]){w="destnum2",_=f;break}}if(_<0)for(var f=0;f<webphone_api.global.ep.length;f++)if(!(isNull(webphone_api.global.ep[f])||webphone_api.global.ep[f].length<5)){var T=webphone_api.global.ep[f][EP_DESTNR];if(!isNull(T)&&T.toLowerCase()==o){w="destnum3",_=f;break}}}if(_>-1){var N=webphone_api.global.ep[_][EP_LINE];(isNull(N)||!1===IsNumber(N))&&(N=-1),t>0?(N>0&&t!==N&&PutToDebugLog(4,"WARNING, common: SaveCallSession change line from "+N+" to "+t),LogLines(),webphone_api.global.ep[_][EP_LINE]=t):(t=webphone_api.global.ep[_][EP_LINE],(isNull(t)||!1===IsNumber(t))&&(t=-5)),isNull(n)||(webphone_api.global.ep[_][EP_SESSION]=n),o.length>0&&(webphone_api.global.ep[_][EP_DESTNR]=o),i>0&&(webphone_api.global.ep[_][EP_INCOMING]=i),a>0&&(webphone_api.global.ep[_][EP_SETUPTIME]=a),(r>0||r<-2)&&(webphone_api.global.ep[_][EP_CONNECTTIME]=r),(s>0||s<-2)&&(webphone_api.global.ep[_][EP_DISCONNECTTIME]=s),(l.length>0||s<-2)&&(webphone_api.global.ep[_][EP_REASON]=l),p.length>0&&(!isNull(webphone_api.global.ep[_][EP_CALLID])&&webphone_api.global.ep[_][EP_CALLID].length>0&&webphone_api.global.ep[_][EP_CALLID].toLowerCase()!=p.toLowerCase()&&(PutToDebugLog(4,"WARNING, common: SaveCallSession change callid from "+webphone_api.global.ep[_][EP_CALLID]+" to "+p),LogLines()),webphone_api.global.ep[_][EP_CALLID]=p),c.length>0&&(webphone_api.global.ep[_][EP_SETUPSENT]=c),u.length>0&&(webphone_api.global.ep[_][EP_FINISHEDSENT]=u),isNull(h)||(webphone_api.global.ep[_][EP_SIPHEADERS]=h.slice()),"true"!==g&&"false"!==g||(webphone_api.global.ep[_][EP_MUTESTATE]=g),"true"!==m&&"false"!==m||(webphone_api.global.ep[_][EP_HOLDSTATE]=m),d.length>10&&(webphone_api.global.ep[_][EP_SIPINVITE]=d);try{b>0?(!isNull(webphone_api.global.ep[_][EP_SESSID])&&IsNumber(webphone_api.global.ep[_][EP_SESSID])&&webphone_api.global.ep[_][EP_SESSID]!=b&&(PutToDebugLog(4,"WARNING, common: SaveCallSession change sessionid from "+webphone_api.global.ep[_][EP_SESSID]+" to "+b),LogLines()),webphone_api.global.ep[_][EP_SESSID]=b):("undefined"==typeof webphone_api.global.ep[_][EP_SESSID]||null===webphone_api.global.ep[_][EP_SESSID]||webphone_api.global.ep[_][EP_SESSID]<1)&&(void 0!==n&&null!==n&&"undefined"!=typeof n.o_session&&null!==n.o_session&&"undefined"!=typeof n.o_session.__i_session_id&&null!==n.o_session.__i_session_id&&(b=n.o_session.__i_session_id),b>0&&(webphone_api.global.ep[_][EP_SESSID]=b))}catch(C){PutToDebugLogException(2,"common: SaveCallSession inner sessionID 1",C)}webphone_api.global.ep[_][EP_FLAGDEL]="false";var S=d;S.length>50&&(S=S.substring(0,50)),!isNull(webphone_api.global.ep[_][EP_SESSION])&&webphone_api.global.ep[_][EP_LINE]>0&&webphone_api.global.ep[_][EP_LINE]!==webphone_api.global.ep[_][EP_SESSION].getLine()&&(webphone_api.global.ep[_][EP_SESSION].getLine()>0&&PutToDebugLog(4,"EVENT, (warn) change session line to "+webphone_api.global.ep[_][EP_LINE]+" for session "+webphone_api.webrtcapi.SessionToString(webphone_api.global.ep[_][EP_SESSION])),webphone_api.global.ep[_][EP_SESSION].setLine(webphone_api.global.ep[_][EP_LINE]),LogLines()),PutToDebugLog(4,"EVENT, common: SaveCallSession endpoint updated, fromc: "+e+", line: "+webphone_api.global.ep[_][EP_LINE]+"; destnr: "+o+"; isincoming: "+i+"; callid: "+p+"; setuptime: "+a+"; connecttime: "+r+"; disctime: "+s+"; setupsent: "+c+"; finishedsent: "+u+"; mutestate: "+g+"; holdstate: "+m+"; sipinvite: "+S+"; webrtcid: "+b+"; foundby: "+w+"; session: "+webphone_api.webrtcapi.SessionToString(n))}else{if(t<1&&(t=webphone_api.global.aline,t>0&&GetEpIdxFromLine(t)>=0&&(t=0),t<1&&(t=GetFreeLine())),"true"!==g&&"false"!==g&&(g="false"),"true"!==m&&"false"!==m&&(m="false"),b<1)try{void 0!==n&&null!==n&&"undefined"!=typeof n.o_session&&null!==n.o_session&&"undefined"!=typeof n.o_session.__i_session_id&&null!==n.o_session.__i_session_id&&(b=n.o_session.__i_session_id)}catch(C){PutToDebugLogException(2,"common: SaveCallSession inner sessionID 2",C)}!isNull(n)&&t>0&&n.setLine(t);var I=[t,n,o,i,a,r,s,l,p,"false",c,u,h,g,m,d,b];isNull(webphone_api.global.ep)&&(webphone_api.global.ep=[]),webphone_api.global.ep.push(I);var S=d;S.length>50&&(S=S.substring(0,50)),PutToDebugLog(4,"EVENT, common: SaveCallSession new endpoint added, fromc: "+e+", line: "+t+"; destnr: "+o+"; isincoming: "+i+"; callid: "+p+"; setuptime: "+a+"; connecttime: "+r+"; disctime: "+s+"; setupsent: "+c+"; finishedsent: "+u+"; mutestate: "+g+"; holdstate: "+m+"; sipinvite: "+S+"; webrtcid: "+b+"; session: "+webphone_api.webrtcapi.SessionToString(n))}!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),LogLines()}catch(R){PutToDebugLogException(2,"common: SaveCallSession",R)}return t}function GetLineForJavaAPI(e,t){if(!isNull(e)&&IsNumber(e)){var n=StrToInt(e);if(!isNull(n)&&(-3===n&&(n=-1),n>=-2))return n}if(webphone_api.global.lastalinesetreal>=-2&&webphone_api.global.lastalinesetreal===webphone_api.global.aline)return webphone_api.global.lastalinesetreal;if(webphone_api.global.lastalinesetreal>=-2&&0!=webphone_api.global.lastalinesetrealtick&&GetTickCount()-webphone_api.global.lastalinesetrealtick<300&&GetTickCount()-webphone_api.global.lastalinesetrealtick>=0)return webphone_api.global.lastalinesetreal;if(webphone_api.global.lastalineset>=-2&&0!=webphone_api.global.lastalinesettick&&GetTickCount()-webphone_api.global.lastalinesettick<5e3&&GetTickCount()-webphone_api.global.lastalinesettick>=0)return webphone_api.global.lastalineset;if(webphone_api.global.lastalinesetreal>=-2&&0!=webphone_api.global.lastalinesetrealtick&&GetTickCount()-webphone_api.global.lastalinesetrealtick<600&&GetTickCount()-webphone_api.global.lastalinesetrealtick>=0)return webphone_api.global.lastalinesetreal;if(webphone_api.global.lastalineset>=-2&&webphone_api.global.lastalineset===webphone_api.global.aline&&0!=webphone_api.global.lastalinesettick&&GetTickCount()-webphone_api.global.lastalinesettick<4e4&&GetTickCount()-webphone_api.global.lastalinesettick>=0)return webphone_api.global.lastalineset;if(isNull(t)||-3===t){if((-1===webphone_api.global.lastalineset||-2===webphone_api.global.lastalineset)&&GetTickCount()-webphone_api.global.lastalinesettick<1e4&&GetTickCount()-webphone_api.global.lastalinesettick>=0)return webphone_api.global.lastalineset;if(-1===webphone_api.global.lastalinesetreal||-2===webphone_api.global.lastalinesetreal)return webphone_api.global.lastalinesetreal;if(-1===webphone_api.global.lastalineset||-2===webphone_api.global.lastalineset)return webphone_api.global.lastalineset
;if(webphone_api.global.lastalineset>=-2&&0!=webphone_api.global.lastalinesettick&&GetTickCount()-webphone_api.global.lastalinesettick<1e4&&GetTickCount()-webphone_api.global.lastalinesettick>=0)return webphone_api.global.lastalineset}return-2===t||-1===t?t:webphone_api.global.aline}function GetCallSession(e,t,n,o,i,a,r,s){var l=GetCallEpIdx(e,t,n,o,i,a,r,s);if(l>=0){var p=webphone_api.global.ep[l][EP_SESSION];return isNull(p)||p===s?a:p}return a}function GetCallEpIdx(e,t,n,o,i,a,r,s){try{var l=GetEndpoint(e,n,o,i,"",t,!1,r,s,!0);if(l)for(var p=0;p<webphone_api.global.ep.length;p++)if(l===webphone_api.global.ep[p])return!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),p;if(webphone_api.global.ep.length<1)return PutToDebugLog(2,"EVENT, common: GetCallSession no global session found a fromcode "+e),-1;if(webphone_api.global.loglevel>0&&getuseengine()===webphone_api.global.ENGINE_WEBRTC){if(isNull(webphone_api.global.ep[0][EP_SESSION]))return PutToDebugLog(2,"WARNING, common: GetCallSession no global session found for webrtc. fromcode: "+e+", remove: "+t+",line: "+n+",destnr: "+o+",callid: "+i+",session: "+a+",isincoming: "+r+", ret: "+LineToString(0)),0}return PutToDebugLog(2,"EVENT, common: GetCallSession returning guessed session. fromcode: "+e+", remove: "+t+",line: "+n+",destnr: "+o+",callid: "+i+",session: "+a+",isincoming: "+r+", ret: "+LineToString(0)),LogLines(),0}catch(c){PutToDebugLogException(2,"common: GetCallSession",c)}try{if(webphone_api.global.ep.length>0)return 0}catch(c){}return-1}function FixSessionId(e,t){return e}function GetEndpoint(e,t,n,o,i,a,r,s,l,p){var c=null,u=0;try{if(u=1,isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return u=2,!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),SetALineInternal(1,4),null;u=3,(isNull(t)||!1===IsNumber(t))&&(u=4,t=webphone_api.global.aline,(isNull(t)||!1===IsNumber(t))&&(t=-1)),u=5,isNull(n)&&(n=""),n=Trim(n),n=n.toLowerCase(),(isNull(o)||o.length<1)&&(o=""),o=Trim(o),o=o.toLowerCase(),o.length>0&&"["==o[0]&&(o=o.substring(1)),o.length>0&&"]"==o[o.length-1]&&(o=o.substring(0,o.length-1)),!isNull(i)&&IsNumber(i)||(i=-1),u=6;for(var h=0;h<webphone_api.global.ep.length;h++)(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)&&(PutToDebugLog(2,"ERROR, common: GetEndpoint remove invalid endpoint fromcode "+e+": "+LineToString(h)),webphone_api.global.ep.splice(h,1),h--);if(u=30,isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return u=31,SetALineInternal(1,4),!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons(),null;u=7;var g="";if(i>0){u=8,g+="a";for(var h=0;h<webphone_api.global.ep.length;h++)if(!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){var m=webphone_api.global.ep[h][EP_SESSID];if(m===i&&(isNull(l)||webphone_api.global.ep[h][EP_SESSION]!==l)){c=webphone_api.global.ep[h];break}}}if(u=9,!c&&o.length>0){u=10,g+="b";for(var h=0;h<webphone_api.global.ep.length;h++)if(!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){var m=webphone_api.global.ep[h][EP_CALLID];if(!(isNull(m)||m.length<1)&&o===m.toLowerCase()&&(isNull(l)||webphone_api.global.ep[h][EP_SESSION]!==l)){c=webphone_api.global.ep[h];break}}}if(u=12,!c&&t>0&&(!a||o.length<1)&&(!0!==r||i<1&&o.length<1&&n.length<1)){if(u=13,g+="c",IsNumber(s)){u=14,g+="d";for(var h=0;h<webphone_api.global.ep.length;h++)if(!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){var d=webphone_api.global.ep[h][EP_LINE];if(!isNull(d)&&!1!==IsNumber(d)&&t===d){var b=webphone_api.global.ep[h][EP_INCOMING];if(IsNumber(b)&&s===b&&"true"!==webphone_api.global.ep[h][EP_FLAGDEL]){c=webphone_api.global.ep[h];break}}}}if(!c){u=15,g+="e";for(var h=0;h<webphone_api.global.ep.length;h++)if(!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){var d=webphone_api.global.ep[h][EP_LINE];if(!isNull(d)&&!1!==IsNumber(d)&&t===d&&(isNull(l)||webphone_api.global.ep[h][EP_SESSION]!==l)&&"true"!==webphone_api.global.ep[h][EP_FLAGDEL]){c=webphone_api.global.ep[h];break}}}if(!c){u=16,g+="f";for(var h=0;h<webphone_api.global.ep.length;h++)if(!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){var d=webphone_api.global.ep[h][EP_LINE];if(!isNull(d)&&!1!==IsNumber(d)&&t===d&&(isNull(l)||webphone_api.global.ep[h][EP_SESSION]!==l)){c=webphone_api.global.ep[h];break}}}}if(u=17,!c&&n.length>0&&(!a||o.length<1)){if(u=18,g+="g",IsNumber(s)){u=19,g+="h";for(var h=0;h<webphone_api.global.ep.length;h++)if(!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){var _=webphone_api.global.ep[h][EP_DESTNR];if(!isNull(_)&&_.toLowerCase()==n){var b=webphone_api.global.ep[h][EP_INCOMING];if(IsNumber(b)&&s===b&&(isNull(l)||webphone_api.global.ep[h][EP_SESSION]!==l)&&"true"!==webphone_api.global.ep[h][EP_FLAGDEL]){c=webphone_api.global.ep[h];break}}}}if(!c){u=20,g+="i";for(var h=0;h<webphone_api.global.ep.length;h++)if(!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){var _=webphone_api.global.ep[h][EP_DESTNR];if(!isNull(_)&&_.toLowerCase()==n&&(isNull(l)||webphone_api.global.ep[h][EP_SESSION]!==l)&&"true"!==webphone_api.global.ep[h][EP_FLAGDEL]){c=webphone_api.global.ep[h];break}}}if(!c){u=21,g+="j";for(var h=0;h<webphone_api.global.ep.length;h++)if(!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){var _=webphone_api.global.ep[h][EP_DESTNR];if(!isNull(_)&&_.toLowerCase()==n&&(isNull(l)||webphone_api.global.ep[h][EP_SESSION]!==l)){c=webphone_api.global.ep[h];break}}}}if(c){if(!0===a){u=22;for(var h=0;h<webphone_api.global.ep.length;h++)if(c===webphone_api.global.ep[h]&&!(isNull(webphone_api.global.ep[h])||webphone_api.global.ep[h].length<5)){if(webphone_api.global.ep.length<2&&webphone_api.global.ep[h][EP_DISCONNECTTIME].toString().length<4)break;LogLines(),c[EP_FLAGDEL]="true",!0===p?PutToDebugLog(3,"EVENT, common: GetEndpoint flagged to remove OLD endpoint_1 fromcode "+e+": "+LineToString(h)):(PutToDebugLog(2,"EVENT, common: GetEndpoint remove OLD endpoint_1 fromcode "+e+": "+LineToString(h)),webphone_api.global.ep.splice(h,1),(isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)&&SetALineInternal(1,5),LogLines());break}}return u=23,IsNumber(s)&&2==s&&(c[EP_INCOMING]=s),u=24,!1!==IsSDK()||!0!==webphone_api.global.isCallStarted||isNull(webphone_api._call)||(u=25,webphone_api._call.UpdateLineButtons()),c}!0===a&&PutToDebugLog(2,"EVENT, common: GetEndpoint no ep to remove fromcode "+e+" / "+t+" / "+n+" / "+o+" / "+g)}catch(f){PutToDebugLogException(2,"common: GetEndpoint "+u.toString(),f)}return c}function LogLines(){if(CanLog(5)){PutToDebugLog(5,"EVENT, lines (total: "+webphone_api.global.ep.length+", active: "+webphone_api.global.aline+"): ");for(var e=0;e<webphone_api.global.ep.length;e++)isNull(webphone_api.global.ep[e])||PutToDebugLog(5,"EVENT, "+LineToString(e))}}function LineToString(e){return isNull(webphone_api.global.ep)||e>=webphone_api.global.ep.length||isNull(webphone_api.global.ep[e])?"NULL":"ep"+e+": line: "+webphone_api.global.ep[e][EP_LINE]+",destnr: "+webphone_api.global.ep[e][EP_DESTNR]+",incoming: "+webphone_api.global.ep[e][EP_INCOMING]+",setup: "+webphone_api.global.ep[e][EP_SETUPTIME]+",connect: "+webphone_api.global.ep[e][EP_CONNECTTIME]+",disc: "+webphone_api.global.ep[e][EP_DISCONNECTTIME]+",callid: "+webphone_api.global.ep[e][EP_CALLID]+",sess: "+webphone_api.global.ep[e][EP_SESSID]+",del: "+webphone_api.global.ep[e][EP_FLAGDEL]}function GetFreeLine(){try{for(var e=[],t=[],n=0;n<webphone_api.global.ep.length;n++){var o=webphone_api.global.ep[n][EP_LINE];if(!isNull(o)&&!1!==IsNumber(o)){var i=StrToInt(o);i>0&&(e.push(i),t.push(StrToInt(webphone_api.global.ep[n][EP_SETUPTIME])))}}for(var n=0;n<e.length;n++)for(var a=n+1;a<e.length;a++)if(e[n]>e[a]){var r=e[n];e[n]=e[a],e[a]=r,r=t[n],t[n]=t[a],t[a]=r}for(var s=GetTickCount(),l=1,n=0;n<e.length;n++)e[n]===l&&t[n]>0&&s-t[n]>1500&&l++;return PutToDebugLog(2,"EVENT, GetFreeLine returned: "+l.toString()),l}catch(p){PutToDebugLogException(2,"common: GetFreeLine",p)}return webphone_api.global.aline+1}function IsLineFree(e){try{if(e<1)return!1;for(var t=0;t<webphone_api.global.ep.length;t++){var n=webphone_api.global.ep[t][EP_LINE];if(!isNull(n)&&!1!==IsNumber(n)){var o=StrToInt(n);if(n=n.toString(),e=e.toString(),o>0&&n===e)return!1}}}catch(i){PutToDebugLogException(2,"common: GetFreeLine",i)}return!0}function GetBestLine(){var e=1;try{e=webphone_api.global.aline;for(var t=-10,n=0,o=-10,i=GetLineForJavaAPI(),a=webphone_api.global.ep.length-1;a>=0;a--){var r=webphone_api.global.ep[a];if(!(isNull(r)||r.length<5)&&("false"===r[EP_FLAGDEL]&&"true"!==r[EP_FINISHEDSENT]&&r[EP_DISCONNECTTIME].toString().length<4)){var s=StrToInt(r[EP_LINE]);if(IsNumber(r[EP_SETUPTIME])&&(n=StrToInt(r[EP_SETUPTIME])),s>0){if(s===i){o=s;break}if(i<1&&s===webphone_api.global.aline){o=s;break}t>0?0>=n&&(t=s,n=0):(t=s,n=0)}}}return o>0?o:t>0?t:webphone_api.global.aline<2?webphone_api.global.aline:1}catch(l){PutToDebugLogException(2,"common: GetBestLine",l)}return e}function GetLastCallEPIdx(){try{for(var e=-10,t=0,n=webphone_api.global.ep.length-1;n>=0;n--){var o=webphone_api.global.ep[n];if(!(isNull(o)||o.length<5)&&("false"===o[EP_FLAGDEL]&&"true"!==o[EP_FINISHEDSENT]&&o[EP_DISCONNECTTIME].toString().length<4)){IsNumber(o[EP_SETUPTIME])&&(t=StrToInt(o[EP_SETUPTIME])),e>0?0>=t&&(e=n,t=0):(e=n,t=0)}}return e}catch(i){PutToDebugLogException(2,"common: GetLastCallEPIdx",i)}return-1}function GetNrOfActiveCalls(){try{for(var e=0,t=0;t<webphone_api.global.ep.length;t++){var n=webphone_api.global.ep[t][EP_DISCONNECTTIME];isNull(n)||(n=n.toString(),n.length<3&&e++)}return e}catch(o){PutToDebugLogException(2,"common: GetNrOfActiveCalls",o)}return webphone_api.global.acallcount}function GetPeerUsername(){try{for(var e=0;e<webphone_api.global.ep.length;e++){var t=webphone_api.global.ep[e][EP_DISCONNECTTIME];if(!isNull(t)){t=t.toString();var n=webphone_api.global.ep[e][EP_DESTNR];if(!isNull(n)&&(n=n.toString(),t.length<3&&n.length>0))return n}}}catch(o){PutToDebugLogException(2,"common: GetPeerUsername",o)}return""}function RefreshInfo(){try{if(!0===IsSDK()||!1===webphone_api.global.isCallStarted)return;var e=GetEndpoint(1016,webphone_api.global.aline,"","","",!1);if(isNull(e)||e.length<5)return;var t=e[EP_DESTNR],n="";!isNull(t)&&t.length>0&&(n=GetContactNameFromNumber(t),isNull(n)&&(n="")),n===t&&(n=""),n.length>0?(webphone_api.$("#calledcaller").html(n+"&nbsp;("+t+")&nbsp;"),(webphone_api.$("#page_call_peer_details").html().indexOf(t)<0||webphone_api.$("#page_call_peer_details").html().indexOf(n)<0)&&webphone_api.$("#page_call_peer_details").html(n+"<br>"+t)):(webphone_api.$("#calledcaller").html(t),webphone_api.$("#page_call_peer_details").html().indexOf(t)<0&&webphone_api.$("#page_call_peer_details").html(t));var o=e[EP_SETUPTIME],i=e[EP_CONNECTTIME];"undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications?isNull(i)||i.length<3?!isNull(o)&&o.toString().length>2&&IsNumber(o)&&webphone_api.notifications.SetCallStartTime(StrToInt(o)):i.toString().length>2&&IsNumber(i)&&webphone_api.notifications.SetCallStartTime(StrToInt(i)):console&&console.log&&console.log("ERROR, common RefreshInfo webphone_api.notifications is not defined");var a=document.getElementById("mute_status"),r=document.getElementById("hold_status");if(isNull(a)||(!0===GetMuteState(StrToInt(e[EP_LINE]))?webphone_api.$(a).hasClass("callfunc_status_on")||webphone_api.$(a).addClass("callfunc_status_on"):webphone_api.$(a).hasClass("callfunc_status_on")&&webphone_api.$(a).removeClass("callfunc_status_on")),isNull(r)||(!0===GetHoldState(StrToInt(e[EP_LINE]))?webphone_api.$(r).hasClass("callfunc_status_on")||webphone_api.$(r).addClass("callfunc_status_on"):webphone_api.$(r).hasClass("callfunc_status_on")&&webphone_api.$(r).removeClass("callfunc_status_on")),!isNull(e)&&e.length>4){var s=!0;i.toString().length>2&&IsNumber(i)&&(s=!1);var l=!1;"2"!=e[EP_INCOMING]&&2!=e[EP_INCOMING]||(l=!0);var p=!1;"true"!=e[EP_FINISHEDSENT]&&1!=e[EP_FINISHEDSENT]||(p=!0),!0===l&&!0===s&&!1===p?(webphone_api.$("#hangup_layout").hide(),webphone_api.$("#callfunctions_layout").hide(),webphone_api.global.ep.length>1?(webphone_api.$("#acceptreject_layout").hide(),webphone_api.$("#mline_layout").show()):(webphone_api.$("#mline_layout").hide(),webphone_api.$("#acceptreject_layout").show())):(webphone_api.$("#acceptreject_layout").hide(),webphone_api.$("#mline_layout").hide(),webphone_api.$("#hangup_layout").show(),webphone_api.$("#callfunctions_layout").show())}}catch(c){PutToDebugLogException(2,"common: RefreshInfo",c)}}function GetRequestId(){try{return reqid_cached>0?(reqid_cached+=1,reqid_cached.toString()):(reqid_cached=RandomInt(5e3,9999999),reqid_cached.toString())}catch(e){PutToDebugLogException(2,"common: GetRequestId",e)}return GetTickCount().toString()}function IsMultiline(){try{var e=GetParameter2("multilinegui");if(isNull(e)||e.length<1)return-1;if(IsNumber(e))return StrToInt(e);if("true"===e.toLowerCase()||"1"==e)return 1;if("false"===e.toLowerCase()||"0"==e)return 0}catch(t){PutToDebugLogException(2,"common: GetRequestId",t)}return-1}function GetTelsearchName(e,t){try{var n=GetParameter2("telsearchurl");if((isNull(n)||n.length<3)&&(n=webphone_api.parameters.telsearchurl),isNull(n)||n.length<3)return PutToDebugLog(2,"ERROR, GetTelsearchName invalid search url: "+n),void t("invalid search url: "+n);var o=NormalizeNumber(e);o=encodeURIComponent(o),n=n.replace("DESTINATION",o),telshearchcb.push(t),UriParser(n,"","","","","telsearchname")}catch(i){PutToDebugLogException(2,"common: GetTelsearchName",i)}}function TelSearchNameReceived(e){try{if(isNull(e)||e.length<10)return void PutToDebugLog(2,"ERROR, TelSearchNameReceived invalid data: "+e);PutToDebugLog(5,"EVENT,TelSearchNameReceived: "+e);var t=e.indexOf("<tel:name>");if(t>0){e=e.substring(t+10),t=e.indexOf("</tel:name>"),t>0&&(e=e.substring(0,t)),isNull(e)&&(e=""),e=Trim(e);var n=telshearchcb.shift();isNull(n)||"function"!=typeof n||(PutToDebugLog(2,"EVENT, TelSearchNameReceived name found: "+e),n(e))}}catch(o){PutToDebugLogException(2,"common: TelSearchNameReceived",o)}}function GetIceTimeout(){try{var e=GetParameter("icetimeout");if(isNull(webphone_api.parameters.icetimeout)||(e=webphone_api.parameters.icetimeout),!isNull(e)&&IsNumber(e)){var t=StrToInt(e);if(!isNull(t)&&t>0)return t<30&&(t*=1e3),t}}catch(n){PutToDebugLogException(2,"common: GetIceTimeout",n)}return 2e3}function ResetIce(){try{webphone_api.global.ice_callaccepted=!1,webphone_api.global.icecompleted=!1,isNull(webphone_api.global.ice_timer)||clearInterval(webphone_api.global.ice_timer),webphone_api.global.ice_timer=null}catch(e){PutToDebugLogException(2,"common: ResetIce",e)}}function GetNativeDialerUrl(e){var t="";try{return isNull(e)||e.length<1?(PutToDebugLog(2,"ERROR, GetNativeDialerUrl invalid OS"),""):("iOS"===e?(t=GetParameter2("ios_nativedialerurl"),(isNull(t)||t.length<3)&&(t="https://itunes.apple.com/us/app/mizuphone/id483685573")):(t=GetParameter2("android_nativedialerurl"),(isNull(t)||t.length<3)&&(t="https://play.google.com/store/apps/details?id=com.mizuvoip.mizudroid.app")),t)}catch(n){PutToDebugLogException(2,"common: ResetIce",n)}return""}function GetSessionId(){try{return isNull(sessionid_cache)?(sessionid_cache=RandomInt(1e3,9999999).toString(),sessionid_cache+=GetTickCount().toString()):sessionid_cache}catch(e){PutToDebugLogException(2,"common: GetSessionId",e)}return"1122334455"}function SetElementsSrc(){try{if(!0===IsSDK())return;var e=document.getElementById("phone_app_main_container");if(isNull(e))return void PutToDebugLog(2,"ERROR, common: SetElementsSrc app container is NULL");var t=webphone_api.getbasedir2();if(isNull(t))return void PutToDebugLog(2,"ERROR, common: SetElementsSrc base dir is NULL");var n=e.getElementsByTagName("img");if(isNull(n)||n.length<1)return void PutToDebugLog(2,"ERROR, common: SetElementsSrc image list is NULL");for(var o=0,i=n.length,a=0;a<i;a++)if(!isNull(n[a])){var r=n[a].src;isNull(r)||r.indexOf("images/")<0||(r=r.substring(r.indexOf("images/")),n[a].src=t+r,o++)}CanLog(2)&&PutToDebugLog(2,"EVENT, common: SetElementsSrc for: "+o.toString()+" images");var s=document.getElementById("android_frame");isNull(s)||isNull(s.style.background)||(s.style.background="url("+t+"images/android_frame.png) no-repeat #ffffff")}catch(l){PutToDebugLogException(2,"common: SetElementsSrc",l)}}function GetElementSource(){try{return isNull(elem_basedir)?(elem_basedir=webphone_api.getbasedir2(),isNull(elem_basedir)&&(elem_basedir=""),elem_basedir):elem_basedir}catch(e){PutToDebugLogException(2,"common: GetElementSource",e)}return""}function PlayDtmfSound(e){var t=0;try{if(isNull(e))return;if(playdtmfsound<0&&(playdtmfsound=GetParameterInt("playdtmfsound",1)),playdtmfsound<1)return;e=Trim(e);var n=IsWebphoneInIframe();if(!0===n&&"Edge"===GetBrowser())return;if(e.length>1&&playdtmfsound<2)return;if(!window.HTMLAudioElement)return void PutToDebugLog(2,"WARNING, PlayDtmfSound audio html element not supported in this browser: "+GetBrowser());if("*"===e?e="x":"#"===e&&(e="y"),!0===n){if(isNull(document.getElementById("dtmfsound"+e))){var o=webphone_api.getbasedir2(),i=e;"y"===i&&(i="diez");var a='<audio id="dtmfsound'+e+'"><source src="'+o+"sound/DTMF"+i+'.ogg" type="audio/ogg"><source src="'+o+"sound/DTMF"+i+'.mp3" type="audio/mpeg"></audio>';webphone_api.$("body").append(a)}}else if(isNull(document.getElementById("dtmfsound0"))){var o=webphone_api.getbasedir2(),r='<audio id="dtmfsound0"><source src="'+o+'sound/DTMF0.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF0.mp3" type="audio/mpeg"></audio><audio id="dtmfsound1"><source src="'+o+'sound/DTMF1.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF1.mp3" type="audio/mpeg"></audio><audio id="dtmfsound2"><source src="'+o+'sound/DTMF2.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF2.mp3" type="audio/mpeg"></audio><audio id="dtmfsound3"><source src="'+o+'sound/DTMF3.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF3.mp3" type="audio/mpeg"></audio><audio id="dtmfsound4"><source src="'+o+'sound/DTMF4.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF4.mp3" type="audio/mpeg"></audio><audio id="dtmfsound5"><source src="'+o+'sound/DTMF5.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF5.mp3" type="audio/mpeg"></audio><audio id="dtmfsound6"><source src="'+o+'sound/DTMF6.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF6.mp3" type="audio/mpeg"></audio><audio id="dtmfsound7"><source src="'+o+'sound/DTMF7.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF7.mp3" type="audio/mpeg"></audio><audio id="dtmfsound8"><source src="'+o+'sound/DTMF8.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF8.mp3" type="audio/mpeg"></audio><audio id="dtmfsound9"><source src="'+o+'sound/DTMF9.ogg" type="audio/ogg"><source src="'+o+'sound/DTMF9.mp3" type="audio/mpeg"></audio><audio id="dtmfsoundy"><source src="'+o+'sound/DTMFdiez.ogg" type="audio/ogg"><source src="'+o+'sound/DTMFdiez.mp3" type="audio/mpeg"></audio><audio id="dtmfsoundx"><source src="'+o+'sound/DTMFx.ogg" type="audio/ogg"><source src="'+o+'sound/DTMFx.mp3" type="audio/mpeg"></audio>';webphone_api.$("body").append(r)}t=5,e=ReplaceAll(e," ","");var s=e.split("");t=6,isNull(playtimer)||clearInterval(playtimer),playtimer=null;var l=0;t=7,playtimer=setInterval(function(){try{if(t=8,l>=s.length)return t=9,isNull(playtimer)||clearInterval(playtimer),void(playtimer=null);if(e=s[l],l++,t=10,isNull(audioElem)){if(t=11,audioElem=document.getElementById("dtmfsound"+e),t=12,isNull(audioElem))return t=13,void PutToDebugLog(2,"ERROR, PlayDtmfSound cannot get reference to audio element a");t=14,audioElem.load(),t=15,audioElem.play(),t=16}else{if(t=20,audioElem.pause(),t=21,"undefined"!=typeof audioElem.currentTime&&null!==audioElem.currentTime&&(audioElem.currentTime=0),t=22,audioElem=document.getElementById("dtmfsound"+e),t=23,isNull(audioElem))return t=24,void PutToDebugLog(2,"ERROR, PlayDtmfSound cannot get reference to audio element b");t=25,audioElem.load(),t=26;try{"undefined"!=typeof audioElem.currentTime&&null!==audioElem.currentTime&&(audioElem.currentTime=0)}catch(n){}t=27,audioElem.play(),t=28}}catch(o){PutToDebugLogException(2,"common: PlayDtmfSound inner Timer ("+t.toString()+")",o)}},300)}catch(p){PutToDebugLogException(2,"common: PlayDtmfSound",p)}}function GetLogLevel(){var e=1;try{var t=GetParameter("loglevel"),n=webphone_api.parameters.loglevel;return!isNull(t)&&1===t.length&&IsNumber(t)||(t="1"),!isNull(n)&&1===n.toString().length&&IsNumber(n)||(n="1"),StrToInt(t)>e&&(e=StrToInt(t)),(StrToInt(n)>e||0===StrToInt(n))&&(e=StrToInt(n)),e}catch(o){PutToDebugLogException(2,"common: GetLogLevel",o)}return 1}function GetHoldState(e){try{e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e);for(var t=0;t<webphone_api.global.ep.length;t++){if(StrToInt(webphone_api.global.ep[t][EP_LINE])===e){var n=webphone_api.global.ep[t][EP_HOLDSTATE];return"true"!=n&&"false"!=n&&PutToDebugLog(2,"ERROR, GetHoldState invalid state: "+n.toString()),"true"==n}}}catch(o){PutToDebugLogException(2,"common: GetHoldState",o)}return!1}function GetMuteState(e){try{e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e);for(var t=0;t<webphone_api.global.ep.length;t++){if(StrToInt(webphone_api.global.ep[t][EP_LINE])===e){var n=webphone_api.global.ep[t][EP_MUTESTATE];return"true"!=n&&"false"!=n&&PutToDebugLog(2,"ERROR, GetMuteState invalid state: "+n.toString()),"true"==n}}}catch(o){PutToDebugLogException(2,"common: GetMuteState",o)}return!1}function SetHoldState(e,t){try{if(e<1&&(e=GetBestLine()),e=StrToInt(e),isNull(t)&&(t=""),"true"!==(t=t.toString())&&"false"!==t)return PutToDebugLog(2,"ERROR, SetHoldState invalid state value: "+t),!1;for(var n=!1,o=0;o<webphone_api.global.ep.length;o++){StrToInt(webphone_api.global.ep[o][EP_LINE])===e&&(n=!0,webphone_api.global.ep[o][EP_HOLDSTATE]=t)}if(!1===n)return PutToDebugLog(2,"ERROR, SetHoldState cannot find endpoint for line: "+e.toString()),LogLines(),!1}catch(i){PutToDebugLogException(2,"common: SetHoldState",i)}return!0}function SetMuteState(e,t){try{if(e<1&&(e=GetBestLine()),e=StrToInt(e),isNull(t)&&(t=""),"true"!==(t=t.toString())&&"false"!==t)return PutToDebugLog(2,"ERROR, SetMuteState invalid state value: "+t),!1;for(var n=!1,o=0;o<webphone_api.global.ep.length;o++){StrToInt(webphone_api.global.ep[o][EP_LINE])===e&&(n=!0,webphone_api.global.ep[o][EP_MUTESTATE]=t)}if(!1===n)return PutToDebugLog(2,"ERROR, SetMuteState cannot find endpoint for line: "+e.toString()),LogLines(),!1}catch(i){PutToDebugLogException(2,"common: SetMuteState",i)}return!0}function IsIncomingCall(e){try{if(e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e),1===webphone_api.global.ep.length&&!isNull(webphone_api.global.ep[0])){var t=webphone_api.global.ep[0][EP_INCOMING];if(1==t)return!1;if(2==t)return!0}for(var n=0;n<webphone_api.global.ep.length;n++){var o=webphone_api.global.ep[n];if(!(isNull(o)||o.length<5)){if(StrToInt(o[EP_LINE])===e){var t=o[EP_INCOMING];if(1==t)return!1;if(2==t)return!0}}}for(var n=0;n<webphone_api.global.ep.length;n++){var o=webphone_api.global.ep[n];if(!(isNull(o)||o.length<5)&&("false"===o[EP_FLAGDEL]&&"true"!==o[EP_FINISHEDSENT]&&o[EP_DISCONNECTTIME].toString().length<4)){var t=o[EP_INCOMING];if("1"==t)return!1;if("2"==t)return!0}}}catch(i){PutToDebugLogException(2,"common: IsIncomingCall",i)}return webphone_api.global.incommingCall}function GetDiscReasonFromSignaling(e){function t(e){try{if(isNull(e))return"";var t=e.indexOf("text=");if(t>=0)return e=Trim(e.substring(t+5,e.length)),t=e.indexOf('"'),t<3&&(e=e.substring(t+1,e.length)),t=e.indexOf('"'),t>0&&(e=e.substring(0,t)),e=Trim(e);if((t=e.indexOf('"'))>=0&&(e=e.substring(t+1,e.length),(t=e.indexOf('"'))!==e.lastIndexOf('"')))return e=e.substring(t+1,e.length),t=e.indexOf('"'),t>0&&(e=e.substring(0,t)),isNull(e)&&(e=""),Trim(e)}catch(n){PutToDebugLogException(2,"notifications: GetText",n)}return""}try{if(webphone_api.global.onunload_flag)return;CanLog(2)&&PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 1"),webphone_api.getsipheader("X-reason",function(n){var o=t(n);if(o.length>0)return void e(o);CanLog(2)&&PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 2"),webphone_api.getsipheader("Reason",function(n){var o=t(n);if(o.length>0)return void e(o);CanLog(2)&&PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 3"),webphone_api.getsipheader("Warning",function(n){var o=t(n);e(o)})})})}catch(n){PutToDebugLogException(2,"common: GetDiscReasonFromSignaling",n),e("")}}function onc(){try{if(!LcAc(!1,!0))return!1;if(Te()){var e=[];e.push("T"),e.push("r"),e.push("i"),e.push("a"),e.push("l"),e.push(" "),e.push("e"),e.push("x"),e.push("p"),e.push("i"),e.push("r"),e.push("e"),e.push("d");var t=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},1050),setTimeout(function(){PutToDebugLog(1,"ERROR, "+t),ShowToast("ERROR, "+t,15e3)},2050),!1}if(GtUct()<1&&GtUc().length>0){var e=[];e.push("T"),e.push("r"),e.push("i"),e.push("a"),e.push("l"),e.push(" "),e.push("e"),e.push("x"),e.push("p"),e.push("i"),e.push("r"),e.push("e"),e.push("d"),e.push("_"),e.push("8");var t=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},1010),!1}return!0}catch(n){PutToDebugLogException(2,"common: onc",n)}return!1}function HandleScurlSetparameters(){try{if(!0===scurlsp_called)return;if(scurlsp_called=!0,!isNull(webphone_api)&&!isNull(webphone_api.parameters))var e=webphone_api.parameters.scurl_setparameters;!isNull(e)&&e.length>3&&(CallScriptingUrl(webphone_api.parameters.scurl_setparameters,"setParameters","","","","","waitforparameters"),setTimeout(function(){!1===webphone_api.global.startendelayed_wascalled&&(PutToDebugLog(2,"WARNING, StartEngine: waiting for parameters timeout, start engine anyway"),PutToDebugLog(2,"EVENT, mlogic API_Start HandleScurlSetparameters"),webphone_api.start())},10500))}catch(t){PutToDebugLogException(2,"common: HandleScurlSetparameters",t)}}function ParseSipAccounts(){try{webphone_api.global.sipaccounts=[];var e=GetParameter("extraregisteraccounts"),t=e,n=GetExtraRegAccFromAPIparam();if(isNull(n)&&(n=""),isNull(t)||t.length<3)return;var o=null;if(t.indexOf("#")>=0?(n.length>0&&(n="#"+n),t+=n,o=t.split("#")):(n.length>0&&(n=";"+n),t+=n,o=t.split(";")),!isNull(o)&&o.length>0){for(var i=0;i<o.length;i++)o[i].length<1&&(o.splice(i,1),i--);if(isNull(o)||o.length<1)return;if(1===o.length){var a=o[0].split(",");if(!isNull(a)&&a.length>3){var r=GetParameter("serveraddress_user");(isNull(r)||r.length<1)&&(r=GetParameter("serveraddress"));var s=GetSipusername(),l=GetParameter("password"),p=!1;if(!isNull(r)&&r.length>0&&!isNull(a[ACC_SERVER])&&a[ACC_SERVER].length>0&&r!==a[ACC_SERVER]&&"[MAIN]"+r!==a[ACC_SERVER]&&(a[ACC_SERVER]=r,p=!0),!isNull(s)&&s.length>0&&!isNull(a[ACC_USER])&&a[ACC_USER].length>0&&s!==a[ACC_USER]&&(a[ACC_USER]=s,p=!0),!isNull(l)&&l.length>0&&!isNull(a[ACC_PASSWORD])&&a[ACC_PASSWORD].length>0&&l!==a[ACC_PASSWORD]&&(a[ACC_PASSWORD]=l,p=!0),!0===p)return PutToDebugLog(2,"EVENT, ParseSipAccounts handling special case"),t=a.join(","),void SaveParameter("extraregisteraccounts",t)}}CanLog(2)&&PutToDebugLog(2,"EVENT, ParseSipAccounts extraregisteraccounts: "+t);for(var c=!0,u=0;u<o.length;u++)if(!(isNull(o[u])||o[u].length<4)){var h=o[u].split(",");if(!(isNull(h)||h.length<4)){var g=h[ACC_SERVER],m="",d="",b="",_="";if(h.length>ACC_CALLERID-2&&(m=h[ACC_CALLERID-2]),h.length>ACC_DISPLAYNAME-2&&(d=h[ACC_DISPLAYNAME-2]),h.length>ACC_PROXY-2&&(b=h[ACC_PROXY-2]),h.length>ACC_REALM-2&&(_=h[ACC_REALM-2]),isNull(m)&&(m=""),isNull(d)&&(d=""),isNull(b)&&(b=""),isNull(_)&&(_=""),!isNull(g)&&g.indexOf("[MAIN]")>=0){g=g.replace("[MAIN]",""),c=!0,SaveParameter("serveraddress_user",g);var m=GetParameter("username");GetParameter("sipusername");GetParameter("username").length>0&&GetParameter("sipusername").length<1?SaveParameter("username",h[ACC_USER]):SaveParameter("sipusername",h[ACC_USER]),SaveParameter("password",h[ACC_PASSWORD]);for(var i=0;i<webphone_api.global.sipaccounts.length;i++)webphone_api.global.sipaccounts[i].ismain=!1}var f=new ClassSipAccounts,w=!0;!isNull(g)&&g.indexOf("[DISABLED]")>=0?(g=g.replace("[DISABLED]",""),w=!1):h.length>=ACC_ENABLED&&"false"===h[ACC_ENABLED]&&(w=!1),f.enabled=w,f.serveraddress=g,f.username=h[ACC_USER],f.password=h[ACC_PASSWORD];var v=3600;h.length>=ACC_IVAL&&!isNull(h[ACC_IVAL])&&IsNumber(h[ACC_IVAL])&&(v=h[ACC_IVAL]),f.ival=StrToInt(v),f.ismain=!0===c,c=!1,f.callerid=m,f.displayname=d,f.proxyaddress=b,f.realm=_,webphone_api.global.sipaccounts.push(f)}}}return}catch(P){PutToDebugLogException(2,"common: ParseSipAccounts",P)}webphone_api.global.sipaccounts=[]}function SaveSipAccounts(){try{if(isNull(webphone_api.global.sipaccounts)||webphone_api.global.sipaccounts.length<1)return void SaveParameter("extraregisteraccounts","");var e=GetExtraRegAccFromAPIparam();isNull(e)&&(e="");var t=[];t=e.indexOf("#")>=0?e.split("#"):e.split(";"),isNull(t)&&(t=[]);for(var n=0;n<t.length;n++)(isNull(t[n])||t[n].length<5)&&(t.splice(n,1),n--);for(var o="",n=0;n<webphone_api.global.sipaccounts.length;n++){var i=webphone_api.global.sipaccounts[n];if(!(isNull(i)||i.length<4)){o.length>0&&(o+="#");var a=!1;if(t.length>0)for(var r=0;r<t.length;r++){var s=t[r];if(i.username===s.username&&i.password===s.password&&i.ival===s.ival&&i.serveraddress===s.serveraddress){a=!0;break}}if(!0!==a){if(!0===i.ismain&&(o+="[MAIN]"),!1===i.enabled&&(o+="[DISABLED]"),!0===i.ismain){var l=i.serveraddress,p=i.username,c=i.password,u=i.ival,h=i.callerid,g=i.displayname,m=i.proxyaddress,d=i.realm;if(isNull(l)&&(l=""),isNull(p)&&(p=""),isNull(c)&&(c=""),isNull(u)&&(u=""),isNull(h)&&(h=""),isNull(g)&&(g=""),isNull(m)&&(m=""),isNull(d)&&(d=""),l.length>0&&SaveParameter("serveraddress_user",l),c.length>0&&SaveParameter("password",c),u.length>0&&IsNumber(u)&&SaveParameter("registerinterval",u),g.length>0&&SaveParameter("displayname",g),m.length>0&&SaveParameter("proxyaddress",m),d.length>0&&SaveParameter("realm",d),p.length>0){var b=!1;GetParameter("sipusername").length>0&&(SaveParameter("sipusername",p),b=!0),GetParameter("username").length>0&&!isNull(h)&&h.length>0&&(SaveParameter("username",h),b=!0),b||SaveParameter("username",p),h.length>0&&GetParameter("sipusername").length>0&&GetParameter("username").length>0&&SaveParameter("username",h)}}o=o+i.serveraddress+","+i.username+","+i.password+","+i.ival+","+i.callerid+","+i.displayname+","+i.proxyaddress+i.realm}}}SaveParameter("extraregisteraccounts",o)}catch(_){PutToDebugLogException(2,"common: SaveSipAccounts",_)}}function GetExtraRegAccFromAPIparam(){try{if("undefined"!=typeof webphone_api.parameters.extraregisteraccounts&&null!==webphone_api.parameters.extraregisteraccounts&&webphone_api.parameters.extraregisteraccounts.length>5){var e=webphone_api.parameters.extraregisteraccounts;if(e=ReplaceAll(e," ",""),!isNull(e)||e.length>5)return e}}catch(t){PutToDebugLogException(2,"common: GetExtraRegAccFromAPIparam",t)}return""}function AddOneAcc(e,t,n,o,i,a,r,s,l,p,c){try{if(isNull(webphone_api.global.sipaccounts)&&(webphone_api.global.sipaccounts=[]),isNull(t)||t.length<1||isNull(n)||n.length<1)return void PutToDebugLog(2,"ERROR, AddOneAcc invalid username: "+t+"; or password: "+n);if((isNull(o)||!1===IsNumber(o))&&(o="3600"),isNull(s)&&(s=""),isNull(l)&&(l=""),isNull(p)&&(p=""),isNull(c)&&(c=""),s=Trim(s),s.length<1&&(s=t),!0===r&&1===webphone_api.global.sipaccounts.length){webphone_api.global.sipaccounts=[];var u=new ClassSipAccounts;return u.serveraddress=e,u.username=t,u.password=n,u.ival=StrToInt(o),u.enabled=i,u.ismain=!0,u.callerid=s,u.displayname=l,u.proxyaddress=p,u.realm=c,webphone_api.global.sipaccounts.push(u),void SaveSipAccounts()}
for(var h=!1,g=0;g<webphone_api.global.sipaccounts.length;g++)if(!isNull(webphone_api.global.sipaccounts[g])&&webphone_api.global.sipaccounts[g].username===t&&webphone_api.global.sipaccounts[g].password===n){var m=webphone_api.global.sipaccounts[g].serveraddress;if(isNull(m)&&(m=""),isNull(e)&&(e=""),m===e){webphone_api.global.sipaccounts[g].serveraddress=e,webphone_api.global.sipaccounts[g].ival=o,webphone_api.global.sipaccounts[g].enabled=i,webphone_api.global.sipaccounts[g].ismain=a,webphone_api.global.sipaccounts[g].callerid=s,webphone_api.global.sipaccounts[g].displayname=l,webphone_api.global.sipaccounts[g].proxyaddress=p,webphone_api.global.sipaccounts[g].realm=c,h=!0;break}}if(!0===h){if(!0===a)for(var g=0;g<webphone_api.global.sipaccounts.length;g++)isNull(webphone_api.global.sipaccounts[g])||webphone_api.global.sipaccounts[g].username===t&&webphone_api.global.sipaccounts[g].password===n||(webphone_api.global.sipaccounts[g].ismain=!1)}else{var u=new ClassSipAccounts;u.serveraddress=e,u.username=t,u.password=n,u.ival=StrToInt(o),u.enabled="true"===i||!0===i,u.ismain="true"===a||!0===a,u.callerid=s,u.displayname=l,u.proxyaddress=p,u.realm=c,webphone_api.global.sipaccounts.push(u),PutToDebugLog(2,"EVENT, AddOneAcc: serveraddress:"+e+" username: "+t+" password: "+n+" regival: "+o+" enabled: "+i+" ismain: "+a)}SaveSipAccounts()}catch(d){PutToDebugLogException(2,"common: AddOneAcc",d)}}function GetOtherPartyName(e,t){e>1||(CanLog(2)&&PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetOtherPartyName"),webphone_api.getsipheader("Contact",function(e){try{if(isNull(e)||e.length<1)return;var n=e.indexOf("<");n>0&&(e=e.substring(0,n),e=ReplaceAll(e,'"',""),e=Trim(e),e.length>0&&e!==t&&e!==GetParameter("displayname")&&(webphone_api.global.callName=e))}catch(o){PutToDebugLogException(2,"common: GetOtherPartyName",o)}}))}function GetMaxLogLevel(){try{if(!isNull(webphone_api.parameters.maxloglevel)&&IsNumber(webphone_api.parameters.maxloglevel)){var e=StrToInt(webphone_api.parameters.maxloglevel);return e>1e3&&(e=1e3),e<1&&(e=1),e}}catch(t){PutToDebugLogException(2,"common: GetMaxLogLevel",t)}return 1e3}function HandleOfflineMessages(e){try{if(isNull(e)||e.indexOf("XOFFMESSAGE:")<0)return;var t=e.indexOf("XOFFMESSAGE:");e=e.substring(t+12);var n=e.split("XOFFMESSAGE:");if(!isNull(n)&&n.length>0)for(var o=0;o<n.length;o++)if(!(isNull(n[o])||(t=n[o].indexOf(":"))<0)){var i=Trim(n[o].substring(0,t)),a=Trim(n[o].substring(t+1));"undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications?webphone_api.notifications.OnMessageReceived(i,a,-1):console&&console.log&&console.log("ERROR, common HandleOfflineMessages webphone_api.notifications is not defined")}}catch(r){PutToDebugLogException(2,"common: HandleOfflineMessages",r)}}function RequestBrowserNotificationPermission(e,t,n,o){try{if(!window.Notification||!Notification.permission)return void PutToDebugLog(2,"WARNING,RequestBrowserNotificationPermission: Notification not supported in this environment, browser: "+GetBrowser()+"; os: "+GetOs());"granted"!==Notification.permission?Notification.requestPermission(function(i){"granted"===i||"default"===i?(PutToDebugLog(2,"EVENT,RequestBrowserNotificationPermission: granted"),e(t,n,o)):"denied"===i?PutToDebugLog(2,"EVENT,RequestBrowserNotificationPermission: denied"):(PutToDebugLog(2,"WARNING,RequestBrowserNotificationPermission: "+Notification.permission),e(t,n,o))}):e(t,n,o)}catch(i){PutToDebugLogException(2,"common: RequestBrowserNotificationPermission",i)}}function CanUseIncomingCallNot(){try{if(!0===IsWindowsSoftphone())return!1;var e=GetParameterInt("incomingcallpopup",0);if(e<1)return!1;if(1===e){var t=!1,n=GetParameterInt("enableautoaccept",1);if(0===n?t=!1:3===n&&(t=!0),!0===(t=GetParameterBool("autoaccept",t)))return!1;if(getuseengine()!==webphone_api.global.ENGINE_JAVA&&!1===BrowserWindowIsActive())return!0}else{if(2!==e)return 3===e||(PutToDebugLog(2,"ERROR, incomingcallpopup invalid value: "+e),!1);if(getuseengine()!==webphone_api.global.ENGINE_JAVA)return!0}}catch(o){PutToDebugLogException(2,"common: CanUseIncomingCallNot",o)}return!1}function ShowIncomingCallNotification(e,t,n,o,i){try{if(!0===o)return isNull(callnotification)||callnotification.close(),void(callnotification=null);if(!CanUseIncomingCallNot())return;RequestBrowserNotificationPermission(function(e,t,n){window.Notification&&Notification.permission&&"granted"===Notification.permission&&(isNull(e)&&(e=""),isNull(t)&&(t=""),isNull(n)&&(n=""),isNull(i)&&(i=""),isNull(callnotification)||callnotification.close(),callnotification=null,callnotification=new Notification(e,{icon:n,body:t,image:i}),callnotification.onclick=function(){window.focus(),isNull(callnotification)||callnotification.close(),callnotification=null})},e,t,n)}catch(a){PutToDebugLogException(2,"common: ShowIncomingCallNotification",a)}}function WebphoneIsLoaded(){try{HandleBrowserWindowActive(),GetContacts(function(e){PutToDebugLog(4,"EVENT, common: WebphoneIsLoaded GetContacts: "+e)}),webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.wnotstartedsession=!1}catch(e){PutToDebugLogException(2,"common: WebphoneIsLoaded",e)}}function BrowserWindowIsActive(){return!1!==browserWindowActive}function HandleBrowserWindowActive(){try{webphone_api.$(window).focus(function(){browserWindowActive=!0}).blur(function(){browserWindowActive=!1})}catch(e){PutToDebugLogException(2,"common: HandleBrowserWindowActive",e)}}function DownloadContacts(){try{ShowToast(webphone_api.stringres.get("sync_message"),5e3);var e=GetParameter("contactimport_url");if(isNull(e)||e.length<3){var t=GetSipusername(),n=GetParameter("serveraddress_user");!isNull(n)&&n.length>0&&(t=t+"_"+n),t+=".dat",e="https://www.mizu-voip.com/G/srvct/"+encodeURIComponent(t)}else e.lastIndexOf("/")<e.length-1&&(e+="/"),e+=encodeURIComponent(t);PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("sync_contacts_started")),UriParser(e,"","","","","downloadcontacts"),setTimeout(function(){cleartimer=!0},6e4),reloadtimer=setInterval(function(){!0===cleartimer&&(clearInterval(reloadtimer),reloadtimer=null),!0===webphone_api.global.reloadcontactsaftersync&&(clearInterval(reloadtimer),reloadtimer=null,webphone_api.global.reloadcontactsaftersync=!1,!0===webphone_api.global.isContactslistStarted&&webphone_api._contactslist.PopulateList(!1))})}catch(o){PutToDebugLogException(2,"common: DownloadContacts",o)}}function ArrayBufferToString(e){try{if(isNull(e))return"null";if("string"===typeof e)return e.toString();var t="",n=new Uint8Array(e);if(isNull(n))return"null";for(var o=n.byteLength,i=0;i<o;i++)t+=String.fromCharCode(n[i]);return isNull(t)?"null":t}catch(a){PutToDebugLogException(2,"common: ArrayBufferToString",a)}return"null"}function Translate(e){try{if(isNull(e)||e.lenght<1)return"";if(isNull(t)){var t=webphone_api.parameters.language;(isNull(t)||2!==t.length)&&(t=GetConfig("language")),(isNull(t)||2!==t.length)&&(t=GetParameter("language")),(isNull(t)||2!==t.length)&&(t=""),t=t.toLowerCase()}if(t.length<1)return e;switch(t){case"ru":return webphone_api.translations.TranslateInnerRus(e);case"hu":return webphone_api.translations.TranslateInnerHun(e);case"ro":return webphone_api.translations.TranslateInnerRo(e);case"de":return webphone_api.translations.TranslateInnerDe(e);case"it":return webphone_api.translations.TranslateInnerItalian(e);case"es":return webphone_api.translations.TranslateInnerSpanish(e);case"tr":return webphone_api.translations.TranslateInnerTr(e);case"pr":case"pt":return webphone_api.translations.TranslateInnerPr(e);case"jp":return webphone_api.translations.TranslateInnerJp(e);case"fr":return webphone_api.translations.TranslateInnerFr(e)}}catch(n){PutToDebugLogException(2,"common: Translate",n)}return e}function GetAutostart(){try{var e=GetParameterInt("autostart",1);return!isNull(webphone_api.parameters.autostart)&&webphone_api.parameters.autostart.toString().length>0&&(e=webphone_api.parameters.autostart.toString(),e=Trim(e),"true"===e||"yes"===e?e=1:"false"!==e&&"no"!==e||(e=0)),e=StrToIntDef(e,1)}catch(t){PutToDebugLogException(2,"common: GetAutostart",t)}return 1}function CanIUseVideo(){try{if(!0===HideSettings("video",webphone_api.stringres.get("sett_display_name_video"),"video",!0))return!1;if(!1===Glvd())return!1;if("1"===GetParameter2("video")||"2"===GetParameter2("video")||"-1"===GetParameter2("video")&&(getuseengine()===webphone_api.global.ENGINE_WEBRTC||!0===CanIUseWebRTC()||!0===IsWindowsSoftphone()))return!0}catch(e){PutToDebugLogException(2,"common: CanIUseVideo",e)}return!1}function CanIUseScreensharing(){try{if(!0===HideSettings("screensharing","","screensharing",!0))return!1;if(!1===Glss())return!1;if("Android"===GetOs()||"iOS"===GetOs())return!1;if(!(navigator.getDisplayMedia||navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia))return!1;var e=GetParameter2("screensharing");if("2"===e||"1"===e&&(getuseengine()===webphone_api.global.ENGINE_WEBRTC||!0===CanIUseWebRTC()||!0===IsWindowsSoftphone()))return!0}catch(t){PutToDebugLogException(2,"common: CanIUseScreensharing",t)}return!1}function SwitchToEngine(e){try{PutToDebugLog(2,"EVENT, common: SwitchToEngine: "+e+"; reset useengine"),webphone_api.global.useengine="";var t=GetEngine(e);isNull(t)||(t.clicked=2,SetEngine(e,t),ChooseEngineLogic2(e),EngineSelect(1,25)),PutToDebugLog(2,"EVENT, mlogic API_Start SwitchToEngine"),webphone_api.start()}catch(n){PutToDebugLogException(2,"common: SwitchToEngine",n)}}function ExitVideoMode(e){try{if(!1===IsWindowsSoftphone())return;PutToDebugLog(2,"EVENT, ExitVideoMode: "+e),SwitchToEngine(webphone_api.global.ENGINE_SERVICE);1===GetParameterInt("videomode",0)&&SaveParameter("videomode","2");WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_exitvideo","GET","","",function(e){PutToDebugLog(2,"EVENT, common: Exit response: "+e)})}catch(t){PutToDebugLogException(2,"common: ExitVideoMode",t)}}function ClassCustomMenus(){this.label,this.action,this.data}function GetCustomMenus(){try{var e=GetParameter("menu_url");if(isNull(e)||e.length<3)return;var t=GetSipusername(),n=GetParameter("password");e=e.replace("[USERNAME]",t),e=e.replace("USERNAME",t),e=e.replace("[PASSWORD]",n),e=e.replace("PASSWORD",n),e=e.replace("PWD",n),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("BRANDNAME",encodeURIComponent(GetBrandName()));var o="http://";IsHttps()&&(o="https://");var i="rtc.mizu-voip.com";"us"===webphone_api.global.usuk&&(i="usrtcx.webvoipphone.com");var a=GetConfig("mainaport");!isNull(a)&&a.length>0&&(i.indexOf(":")>0&&(i=i.substring(0,i.indexOf(":"))),i+=a),PutToDebugLog(4,"EVENT, GetCustomMenus url: "+e);var r=decodeURIComponent(e);r=encodeURIComponent(r);var s=o+i+"/mvapireq/jppget?url="+r+"&callback=cbf";PutToDebugLog(4,"EVENT, GetCustomMenus url JSONP: "+s),webphone_api.$.getJSON(s,function(e){var t="";isNull(e)?PutToDebugLog(2,"ERROR, HttpRequest GetCustomMenus response is NULL"):t=e.contents,HttpResponseHandler(t,"get_custom_menu")})}catch(l){PutToDebugLogException(2,"common: GetCustomMenus",l)}}function ProcessCustomMenu(e){try{if(webphone_api.global.custmenusL=null,webphone_api.global.custmenusL=[],isNull(e)||e.length<5)return;var t=-1,n=e;if(t=n.indexOf("<ERROR>"),t<0&&(t=n.indexOf("<Error>")),n.toLowerCase().indexOf("disabled")>0&&t>0&&(n=n.substring(t+7),t=n.indexOf("</ERROR>"),t>0&&(n=n.substring(0,t)),isNull(n)&&(n=""),n=Trim(n),n.length>0))return PutToDebugLog(2,"ERROR, ProcessCustomMenu returned error: "+n),PutToDebugLog(1,"ERROR, "+n),void AlertDialog("ERROR",n);if((t=e.indexOf("<PROTOCOL>"))>0){var o=e.substring(t+12);t=o.indexOf("</PROTOCOL>"),t>0&&(o=o.substring(0,t),isNull(o)&&(o=""),o=Trim(o),o.length>0&&(PutToDebugLog(2,"EVENT, ProcessCustomMenu set custom received transport protocol: "+o),"udp"===o.toLowerCase()?SaveParameter("transport","0"):"tcp"===o.toLowerCase()?SaveParameter("transport","1"):"tls"===o.toLowerCase()&&SaveParameter("transport","2")))}if((t=e.indexOf("<SIP_SERVER>"))>0){var i=e.substring(t+12);t=i.indexOf("</SIP_SERVER>"),t>0&&(i=i.substring(0,t),isNull(i)&&(i=""),i=Trim(i),i.length>0&&(PutToDebugLog(2,"EVENT, ProcessCustomMenu set custom received serveraddress: "+i),SaveParameter("serveraddress_user",i)))}if((t=n.indexOf("<BUTTONS>"))<0)return;if(n=n.substring(t+9),(t=n.indexOf("</BUTTONS>"))<1)return;n=n.substring(0,t),n=Trim(n);var a=n.split("<BUTTON");if(isNull(a)||a.length<1)return;for(var r=0;r<a.length;r++)if(null!=a[r]){var s=a[r].toString();if(!(s.length<5)){s=ReplaceAll(s,'="',"=");var l="",p="",c="";t=s.indexOf("label="),t>=0&&(l=s.substring(t+6),l=Trim(l),t=l.indexOf('"'),t<0&&(t=l.indexOf(" ")),l=t>0?Trim(l.substring(0,t)):"");var u=!1;if(t=s.indexOf("action="),t>=0&&(p=s.substring(t+7),p=Trim(p),t=p.indexOf('"'),t<0&&(t=p.indexOf(" ")),t>0?(p=Trim(p.substring(0,t)),u=!0):p=""),t=s.indexOf("data="),t>=0&&(c=s.substring(t+5),c=Trim(c),t=c.indexOf('"'),t<0&&(t=c.indexOf(" ")),t>0?(c=Trim(c.substring(0,t)),u||(0===c.toLowerCase().indexOf("http:")||0===c.toLowerCase().indexOf("https:")?p="link":0==c.indexOf("chat:")?(c=Trim(c.substring(c.indexOf("chat:"))),p="chat"):0==c.indexOf("call:")?(c=Trim(c.substring(c.indexOf("call:"))),p="call"):c.length>0&&(p="call"))):c=""),!isNull(l)&&l.length>0&&!isNull(p)&&p.length>0&&!isNull(c)&&c.length>0){var h=new ClassCustomMenus;h.label=l,h.action=p,h.data=c,webphone_api.global.custmenusL.push(h)}}}}catch(g){PutToDebugLogException(2,"common: ProcessCustomMenu",g)}}function GetTextLengthThatFits(e,t,n,o,i,a){if(isNull(t)||t.length<1)return 0;var r=t.length;try{a===undefined&&(a="normal");var s=webphone_api.$("<div>").addClass("auxdiv").css({position:"absolute",height:"auto",marginLeft:"-1000px",marginTop:"-1000px",fontWeight:a,width:"auto"}).appendTo(webphone_api.$("#"+e)).html(t),l=s.width()+1,p=t;if(l>n){for(var c=1,u=1,h=t.length,g=0;u<=h;)c=u+h>>1,p=t.slice(0,c),s.html(p),l=s.width()+1,l<=n?(g=c,u=c+1):h=c-1;p=t.slice(0,g)}return webphone_api.$(".auxdiv").remove(),s.remove(),p.length}catch(m){PutToDebugLogException(2,"common: GetTextLengthThatFits",m)}return r}function HostToIPQuick(e){var t="";return e=NormalizeInput(GetDomainPart(e)),isNull(dtisrvcache)||isNull(dtisrvcache[e.toLowerCase()])||(t=dtisrvcache[e.toLowerCase()],!IsIPAddrress(t))?e===GetConfig("knowndomain")&&!isNull(GetConfig("knownip"))&&(t=GetConfig("knownip"),IsIPAddrress(t))?t:e!==GetConfig("serveraddress_user")&&e!==GetConfig("serverdomain")&&e!==GetConfig("serveraddress")||isNull(GetConfig("serverip"))||(t=NormalizeInput(GetDomainPart(GetConfig("serverip"))),!IsIPAddrress(t))?"":t:t}function DomainToIpServer(e,t){function n(e,n){if(!isNull(dreqsrvcache[e])){try{for(var o=dreqsrvcache[e];o.length>0;)isNull(o[0])||"function"!=typeof o[0]||o[0](n),o.splice(0,1)}catch(i){PutToDebugLogException(2,"common: domaintoipServer HanleCallback",i);try{t("")}catch(a){}}delete dreqsrvcache[e]}}try{if(isNull(e)||e.length<3)return t(""),"";if(e=NormalizeInput(GetDomainPart(e)),!0===IsIPAddrress(e))return t(e),e;var o=e.lastIndexOf(":");o>0&&(e=e.substring(0,o)),o=e.indexOf("?"),o>0&&(e=e.substring(0,o)),o=e.indexOf("://"),o>0&&(e=e.substring(o+3,e.length)),o=e.indexOf("//"),o>0&&(e=e.substring(o+2,e.length)),o=e.indexOf("/"),o>0&&(e=e.substring(0,o));var i="";if(i=HostToIPQuick(e),i.length>0)return t(i),i;if(!0===IsLocalUpperServer())return t(e),e;if(isNull(dtisrvcache)){dtisrvcache={};var a=null;if((isNull(dtistrSrv)||dtistrSrv.indexOf("mnt.mizu-voip.com")<0)&&(!isNull(dtistrSrv)&&dtistrSrv.length>0&&(dtistrSrv+="##"),dtistrSrv+="www.mizu-voip.com,148.251.28.178##www.webvoipphone.com,159.69.64.139##mnt.mizu-voip.com,148.251.28.180##rtc.mizu-voip.com,148.251.28.181##usrtcx.webvoipphone.com,107.175.156.227##usrtc.webvoipphone.com,107.175.156.227"),!isNull(dtistrSrv)&&dtistrSrv.length>0&&(a=dtistrSrv.split("##")),!isNull(a)&&a.length>0)for(var r=0;r<a.length;r++)if(!(isNull(a[r])||a[r].indexOf(",")<0)){var s=a[r].substring(0,a[r].indexOf(",")),l=a[r].substring(a[r].indexOf(",")+1);!isNull(s)&&s.length>0&&!isNull(l)&&l.length>0&&isNull(dtisrvcache[s.toLowerCase()])&&(dtisrvcache[s.toLowerCase()]=l)}}if(i="",!isNull(dtisrvcache[e.toLowerCase()]))return i=dtisrvcache[e.toLowerCase()],t(i),i;if(e===GetConfig("knowndomain")&&!isNull(GetConfig("knownip"))&&IsIPAddrress(GetConfig("knownip")))return i=GetConfig("knownip"),t(i),i;if(!isNull(dreqsrvcache[e])){var p=dreqsrvcache[e];return p.push(t),dreqsrvcache[e]=p,""}var p=[];if(p.push(t),dreqsrvcache[e]=p,0===GetParameterInt("altexternpublicip",1))return"";var c="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xhosttoip/?host=DOMAIN&now=1";!0===IsHttps()&&(c=c.replace("http:","https:")),c=c.replace("DOMAIN",encodeURIComponent(e)),CanLog(4)&&PutToDebugLog(4,"EVENT, domaintoipServer url: "+c);var u=new XMLHttpRequest;if("withCredentials"in u)u.open("GET",c,!0);else{if("undefined"==typeof XDomainRequest)return u=null,PutToDebugLog(2,"ERROR, common: domaintoipServer, CORS not supported"),void t("");u=new XDomainRequest,u.open("GET",c)}u.onload=function(){try{if(!1===webphone_api.global.httpheaderslogged&&u.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;var o=u.getAllResponseHeaders();CanLog(5)&&PutToDebugLog(5,"EVENT, domaintoipServer HTTP request answer headers 4: "+o)}if(isNull(u)||isNull(u.responseText)||u.responseText.length<1)return PutToDebugLog(2,"ERROR, domaintoipServer response is NULL"),void t("");var i=u.responseText;if(i.indexOf("OK:")>=0){i=i.replace("OK:","");var a=i.indexOf(":");a>0&&(i=i.substring(a+1)),isNull(i)&&(i=""),i=Trim(i),CanLog(4)&&PutToDebugLog(4,"EVENT, domaintoipServer response is: "+i),dtisrvcache[e.toLowerCase()]=i,n(e,i);var r="";for(var s in dtisrvcache)!isNull(s)&&s.length>0&&!isNull(dtisrvcache[s.toLowerCase()])&&dtisrvcache[s.toLowerCase()].length>0&&(r.length>0&&(r+="##"),r=r+s+","+dtisrvcache[s.toLowerCase()])}else PutToDebugLog(2,"ERROR, domaintoipServer response is: "+i),dtisrvcache[e.toLowerCase()]=i,n(e,"ERROR: "+i)}catch(l){PutToDebugLogException(2,"common: domaintoipServer.onload inner",l),t("")}},u.onerror=function(t){var o="";isNull(t)||(o=t.toString(),isNull(t.target)||(o=isNull(t.target.status)?o+" "+t.target.toString():o+" "+t.target.status.toString())),PutToDebugLog(2,"ERROR, domaintoipServer request failed: "+o),n(e,"ERROR, domaintoipServer request failed: "+o)},u.timeout=2e3,u.ontimeout=function(t){PutToDebugLog(2,"ERROR, domaintoipServer: Timeout"),n(e,"ERROR, domaintoipServer: Timeout")},u.send()}catch(h){PutToDebugLogException(2,"common: domaintoipServer",h),t("ERROR, domaintoipServer failed")}}function DomainToIp(e,t){function n(e,t){if(!isNull(dreqcache[e])){var n=dreqcache[e],o=t;for(t.indexOf("ERROR")<0&&(o="");n.length>0;)isNull(n[0])||"function"!=typeof n[0]||n[0](o),n.splice(0,1);delete dreqcache[e]}}try{if(isNull(e))return t(""),"";if(e.length<3)return t(e),"";if(0==e.toLowerCase().indexOf("error"))return t(""),"";if(e.indexOf(".")<0)return t(e),"";if(e=NormalizeInput(GetDomainPart(e)),!0===IsIPAddrress(e))return t(e),e;var o=e.lastIndexOf(":");o>0&&(e=e.substring(0,o)),o=e.indexOf("?"),o>0&&(e=e.substring(0,o)),o=e.indexOf("://"),o>0&&(e=e.substring(o+3,e.length)),o=e.indexOf("//"),o>0&&(e=e.substring(o+2,e.length)),o=e.indexOf("/"),o>0&&(e=e.substring(0,o));var i="";if(i=HostToIPQuick(e),i.length>0)return t(i),i;if(!0===IsLocalUpperServer())return t(e),e;if(isNull(dticache)){dticache={};var a=GetParameter("domaintoip_cache"),r=null;if((isNull(a)||a.indexOf("mnt.mizu-voip.com")<0)&&(!isNull(a)&&a.length>0&&(a+="##"),a+="www.mizu-voip.com,148.251.28.178##www.webvoipphone.com,178.63.153.107##mnt.mizu-voip.com,148.251.28.180##rtc.mizu-voip.com,148.251.28.181##usrtcx.webvoipphone.com,107.175.156.227##usrtc.webvoipphone.com,204.12.197.98##voip.mizu-voip.com,159.69.64.138##fcm.webvoipphone.com,148.251.28.182"),!isNull(a)&&a.length>0&&(r=a.split("##")),!isNull(r)&&r.length>0)for(var s=0;s<r.length;s++)if(!(isNull(r[s])||r[s].indexOf(",")<0)){var l=r[s].substring(0,r[s].indexOf(",")),p=r[s].substring(r[s].indexOf(",")+1);!isNull(l)&&l.length>0&&!isNull(p)&&p.length>0&&isNull(dticache[l])&&(dticache[l]=p)}}if(i=dticache[e],!isNull(i))return t(i),n(e,i),i;if(!isNull(dreqcache[e])){var c=dreqcache[e];return c.push(t),dreqcache[e]=c,""}var c=[];if(c.push(t),dreqcache[e]=c,0===GetParameterInt("altexternpublicip",1))return"";var u="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xhosttoip/?host=DOMAIN&now=1";!0===IsHttps()&&(u=u.replace("http:","https:")),u=u.replace("DOMAIN",encodeURIComponent(e));var h=new XMLHttpRequest;if("withCredentials"in h)h.open("GET",u,!0);else{if("undefined"==typeof XDomainRequest)return h=null,PutToDebugLog(2,"ERROR, common: domaintoip, CORS not supported"),void t("");h=new XDomainRequest,h.open("GET",u)}h.onload=function(){try{if(!1===webphone_api.global.httpheaderslogged&&h.getAllResponseHeaders&&CanLog(5)){webphone_api.global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 4: "+h.getAllResponseHeaders())}if(isNull(h)||isNull(h.responseText)||h.responseText.length<1)return PutToDebugLog(2,"ERROR, domaintoip response is NULL for "+e),void t("");var o=h.responseText;if(o.indexOf("OK:")>=0){o=o.replace("OK:","");var i=o.indexOf(":");i>0&&(o=o.substring(i+1)),isNull(o)&&(o=""),o=Trim(o),PutToDebugLog(4,"EVENT, domaintoip response is: "+NormalizeInput2(o,3)+" for "+e),dticache[e]=o,t(o),n(e,o);var a="";for(var r in dticache)!isNull(r)&&r.length>0&&!isNull(dticache[r])&&dticache[r].length>0&&(a.length>0&&(a+="##"),a=a+r+","+dticache[r]);SaveParameter("domaintoip_cache",a)}else if((isNull(dticache[e])||dticache[e].length<1)&&(dticache[e]=e),o.indexOf("cannotresolve")>=0?PutToDebugLog(2,"EVENT, domaintoip response is: cannotresolve for "+e):PutToDebugLog(2,"WARNING, domaintoip response is: "+NormalizeInput2(o,3)+" for "+e),t(""),n(e,"ERROR: "+o),o.indexOf("cannotresolve")>=0){var a="";for(var r in dticache)!isNull(r)&&r.length>0&&!isNull(dticache[r])&&dticache[r].length>0&&(a.length>0&&(a+="##"),a=a+r+","+dticache[r]);SaveParameter("domaintoip_cache",a)}}catch(s){PutToDebugLogException(2,"common: domaintoip.onload inner",s),t("")}},h.onerror=function(o){var i="";isNull(o)||(i=o.toString(),isNull(o.target)||(i=isNull(o.target.status)?i+" "+o.target.toString():i+" "+o.target.status.toString())),PutToDebugLog(2,"ERROR, domaintoip request failed: "+i+" for "+e),t(""),n(e,"ERROR, domaintoip request failed: "+i)},h.timeout=4e3,h.ontimeout=function(o){PutToDebugLog(2,"ERROR, domaintoip: Timeout"),t(""),n(e,"ERROR, domaintoip: Timeout")},h.send()}catch(g){PutToDebugLogException(2,"common: domaintoip",g),t("domaintoip failed")}}function HandleSipProtocol(e){try{if(isNull(e)||e.length<1)return e;if(0!==e.indexOf("REGISTER sip:")&&0!==e.indexOf("INVITE sip"))return e;var t=GetParameterInt("sipprotocol",0);if(0===t)return e;var n=e;if(1===t)return n=ReplaceAll(n,"sips:","sip:"),n=ReplaceAll(n,"WSS","WS"),n=ReplaceAll(n,"wss","ws");if(2===t)return n=ReplaceAll(n,"sip:","sips:"),n=ReplaceAll(n,"WS","WSS"),n=ReplaceAll(n,"ws","wss")}catch(o){PutToDebugLogException(2,"common: HandleSipProtocol",o)}return e}function HandleOptions(e){try{if(isNull(e)||e.length<1||e.indexOf("OPTIONS sip")<0)return!1;var t=e,n=GetSipHeaderFromMsg(t,"accept");isNull(n)&&(n=""),n=n.toLowerCase();var o="\r\n";t.indexOf("\r\n")<0&&t.indexOf("\n")>=0&&(o="\n"),t=t.substring(t.indexOf(o)+o.length);var i="SIP/2.0 200 OK"+o+t;i=Trim(i)+o;var a="<sip:"+GetSipusername()+"@"+GetUDPServerAddress()+">";if(i=i.indexOf("Contact:")>0?RewriteSipHeaderInMsg(i,"Contact",a):i+"Contact: "+a+o,i=i.indexOf("User-Agent:")>0?RewriteSipHeaderInMsg(i,"User-Agent","MWWRTC "+webphone_api.global.versionstr):i+"User-Agent: MWWRTC "+webphone_api.global.versionstr+o,n.indexOf("application")>=0&&n.indexOf("sdp")>=0){i.indexOf("Content-Length:")<0&&(i=i+"Content-Length: 0"+o);var r="",s=GetParameter("codec");if(isNull(s)||s.length<1||"-1"==s)r="v=0"+o+"m=audio 80 UDP/TLS/RTP/SAVPF 111 103 104 9 0 8 106 105 13 126"+o+"a=mid:0"+o+"a=sendrecv"+o+"a=rtcp-mux"+o+"a=rtpmap:111 opus/48000/2"+o+"a=rtcp-fb:111 transport-cc"+o+"a=fmtp:111 minptime=10;useinband"+o+"a=rtpmap:103 ISAC/16000"+o+"a=rtpmap:104 ISAC/32000"+o+"a=rtpmap:9 G722/8000"+o+"a=rtpmap:0 PCMU/8000"+o+"a=rtpmap:8 PCMA/8000"+o+"a=rtpmap:106 CN/32000"+o+"a=rtpmap:105 CN/16000"+o+"a=rtpmap:13 CN/8000"+o+"a=rtpmap:126 telephone-event/8000"+o;else{var l="m=audio 80 UDP/TLS/RTP/SAVPF";r="a=mid:0"+o+"a=sendrecv"+o+"a=rtcp-mux"+o;var p=s.split(",");(p.indexOf("10")>=0||p.indexOf("11")>=0||p.indexOf("13")>=0)&&(l+=" 111",r=r+"a=rtpmap:111 opus/48000/2"+o+"a=rtcp-fb:111 transport-cc"+o+"a=fmtp:111 minptime=10;useinband"+o),l+=" 103 104 9",r=r+"a=rtpmap:103 ISAC/16000"+o+"a=rtpmap:104 ISAC/32000"+o+"a=rtpmap:9 G722/8000"+o,p.indexOf("1")>=0&&(l+=" 0",r=r+"a=rtpmap:0 PCMU/8000"+o),p.indexOf("2")>=0&&(l+=" 8",r=r+"a=rtpmap:8 PCMA/8000"+o),l+=" 106 105 13 126",r=r+"a=rtpmap:106 CN/32000"+o+"a=rtpmap:105 CN/16000"+o+"a=rtpmap:13 CN/8000"+o+"a=rtpmap:126 telephone-event/8000"+o,r="v=0"+o+l+o+r}i=i+o+r,i=RewriteSipHeaderInMsg(i,"Content-Length",r.length)}else i=i.indexOf("Accept:")>0?RewriteSipHeaderInMsg(i,"Accept","application/sdp,application/dtmf-relay,text/plain"):i+"Accept: application/sdp,application/dtmf-relay,text/plain"+o,i=i.indexOf("Content-Length:")>0?RewriteSipHeaderInMsg(i,"Content-Length","0"):i+"Content-Length: 0"+o,i+=o;return PutToDebugLog(3,"EVENT, HandleOptions OPTIONS sip handled manually: EVENT, SEND: \r\n"+i),webphone_api.webrtc_socket.send(i),!0}catch(c){PutToDebugLogException(2,"common: HandleOptions",c)}return!1}function HandleEdgeSdpIP(e){try{if(isNull(e)||e.length<1)return e;if("Edge"!==GetBrowser())return e;if(0!==e.indexOf("INVITE sip"))return e;var t=e,n=t.indexOf("a=candidate:");if(n<0)return e;var o=t.substring(n+12);if(o=o.substring(0,o.indexOf("\r\n")),isNull(o)||o.length<1)return e;var i="";if(n=o.lastIndexOf("."),n>0&&(i=o.substring(n),o=o.substring(0,n+4),n=o.lastIndexOf(" "),n>o.length-6&&(o=o.substring(0,n)),o=Trim(o),n=o.lastIndexOf(" "),n>0&&(o=o.substring(n+1)),isNull(i)&&(i=""),i=Trim(i),n=i.indexOf(" "),n>0&&(i=i.substring(n+1)),n=i.indexOf(" "),n>0&&(i=i.substring(0,n),!isNull(i)&&IsNumber(i)||(i="")),o=Trim(o),i=Trim(i)),isNull(o)||o.length<1||!IsIPAddrress(o))return e;if((n=t.indexOf("c="))<1)return e;var a=t.substring(0,n);t=t.substring(n),n=t.indexOf("\r\n");var r=t.substring(0,n+2);t=t.substring(n+2);var s=r.replace("127.0.0.1",o);if(s=s.replace("127.0.0.0",o),t=a+s+t,r=r.replace("\r\n",""),s=s.replace("\r\n",""),PutToDebugLog(2,"EVENT, HandleEdgeSdpIP IP addres rewritten in SDP, orig header: "+r+"; rewritten to: "+s),isNull(i)||i.length<1||!IsNumber(i))return t;if((n=t.indexOf("m=audio"))<1)return t;e=t,a=t.substring(0,n+7),t=t.substring(n+7),t=Trim(t),n=t.indexOf(" ");var l=t.substring(0,n);return t=t.substring(n),(isNull(l)&&(l=""),l=Trim(l),l.length<1||!IsNumber(l))?e:t=a+" "+i+t}catch(p){PutToDebugLogException(2,"common: HandleEdgeSdpIP",p)}return e}function HandleIncomingSIPSignaling(e){try{if(isNull(e)||e.length<1)return e;var t=HandleAmidHeader(e);return t=HandleSpecialCharsInHeaders(t)}catch(n){PutToDebugLogException(2,"common: HandleIncomingSIPSignaling",n)}return e}function HandleSpecialCharsInHeaders(e){try{var t=e,n=t.indexOf("\r\n\r\n"),o=-1,i="";n>0&&(i=t.substring(n),t=t.substring(0,n)),isNull(i)&&(i="");var a=t.split("\r\n");if(isNull(a)||a.length<1)return e;t="";for(var r=0;r<a.length;r++){if(isNull(a[r])&&(a[r]=""),n=a[r].indexOf('"'),o=a[r].lastIndexOf('"'),n>=0&&o>0&&n<o){var s=a[r].substring(n+1,o),l=RemoveSpecialCharaters(s);s!==l&&(PutToDebugLog(2,"EVENT, HandleSpecialCharsInHeaders, rewrite special charaters in header: "+a[r]+"; to: "+l+" because containes invalid charaters"),a[r]=a[r].replace(s,l),(a[r].indexOf("From:")>=0||a[r].indexOf("Contact:")>=0)&&(webphone_api.global.sipunicoderewritefrom=s,webphone_api.global.sipunicoderewriteto=l))}t.length>0&&(t+="\r\n"),t+=a[r]}if(!isNull(t)&&t.length>10)return t+i}catch(p){PutToDebugLogException(2,"common: HandleSpecialCharsInHeaders",p)}return e}function RemoveSpecialCharaters(e){try{if(isNull(e)||e.length<1)return e;for(var t="",n=0;n<e.length;n++)e.charCodeAt(n)>31&&e.charCodeAt(n)<255&&(t+=e.charAt(n));return t}catch(o){PutToDebugLogException(2,"common: RemoveSpecialCharaters",o)}return e}function HandleAmidHeader(e,t){try{if("Firefox"!==GetBrowser())return e;var n=e,o=n.indexOf("INVITE sip");if((o>=0&&o<20||!1===t)&&(o=n.indexOf("a=mid:"))<1)if(PutToDebugLog(5,"EVENT, add a mid for FF"),(o=n.indexOf("m=audio"))>0){var i=n.substring(0,o);n=n.substring(o),o=n.indexOf("\r\n");n=i+n.substring(0,o+2)+"a=mid:1\r\n"+n.substring(o+2),n=RecalculateContentLength(n)}else if((o=n.indexOf("m=video"))>0){var i=n.substring(0,o);n=n.substring(o),o=n.indexOf("\r\n"),n=i+n.substring(0,o+2)+"a=mid:2\r\n"+n.substring(o+2),n=RecalculateContentLength(n)}return n}catch(a){PutToDebugLogException(2,"common: HandleAmidHeader",a)}return e}function AddSIPLine(e,t){if(isNull(e)||e.length<1)return e;if(isNull(t)||t.length<1)return e;var n=e.indexOf("\r\nCSeq:");return n>0?e=e.replace("\r\nCSeq:","\r\n"+t+"\r\nCSeq:"):(n=e.indexOf("\r\n\r\n"))>0&&(e=e.substring(0,n)+"\r\n"+t+e.substring(n)),e}function FixContentLength(e){try{if(isNull(e)||e.length<1)return e;var t=e,n=0;if(t.indexOf("\nUser-Agent")<0){var o=GetUA();GetParameter("useragent").length>0&&!1===IsMizuPublicWebRTCGateway()&&(o=GetParameter("useragent")),o.length>0&&(t=AddSIPLine(t,"User-Agent: "+o))}var i=IsMizuServerOrGateway();if(i&&t.indexOf("REGISTER sip")<0){var n=t.indexOf("Call-ID:");if(n>0){var a=Trim(t.substring(n+8));a.indexOf("\r\n")>0&&(a=a.substring(0,a.indexOf("\r\n")),!isNull(a)&&a.length>0&&(t=t.substring(0,n)+"X-C-Call-ID: "+a+"\r\n"+t.substring(n)))}}if(webphone_api.global.fcmIsEnabled>0&&0==(n=t.indexOf("REGISTER sip"))&&!isNull(webphone_api.global.fcmtoken)&&webphone_api.global.fcmtoken.length>3){if(t.indexOf("X-MPUSH:")<1){PutToDebugLog(3,"EVENT, (warn) mpush added at register send");t=AddSIPLine(t,"X-MPUSH: "+("w:"+GetFCMPackageName()+":"+fcmclientid))}if(t.indexOf("X-PIID:")<1){PutToDebugLog(3,"EVENT, (warn) X-PIID added at register send");t=AddSIPLine(t,"X-PIID: "+Md5Hash(GetSipusername()+":"+webphone_api.global.mRealm+":"+GetParameter("password")))}}if(0==(n=t.indexOf("INVITE sip"))){if(i&&(t.indexOf("\nX-Webdomain")<0&&GetWebdomain().length>0&&(PutToDebugLog(3,"EVENT, (warn) add webdomain to sip msg"),t=AddSIPLine(t,"X-Webdomain: "+GetWebdomain())),t.indexOf("\nX-UT")<0&&(PutToDebugLog(3,"EVENT, (warn) add x-ut to sip msg"),t=AddSIPLine(t,"X-UT: r"))),!0===webphone_api.global.add_recall_header&&t.indexOf("X-Autorecall:")<1&&(t=AddSIPLine(t,"X-Autorecall: yes")),!0===webphone_api.global.addauser_header&&t.indexOf("X-AUSR:")<1&&(PutToDebugLog(3,"EVENT, Sipusername added at invite send"),t=AddSIPLine(t,"X-AUSR: "+GetSipusername())),t.indexOf("X-Sy.Upperproxy:")<1){var r=GetUpperProxyHeaderForSignaling();!isNull(r)&&r.length>0&&(PutToDebugLog(3,"EVENT, Proxyaddress added at invite send"),t=AddSIPLine(t,"X-Sy.Upperproxy: "+r))}if(CatchWebrtcSignaling(t,SIP_UNKNOWN),t=t.replace("X-Sy.Uppersrv: rtc.mizu-voip.com:6060\r\n",""),t=t.replace("X-Sy.Uppersrvd: rtc.mizu-voip.com:6060\r\n",""),t.indexOf("X-Sy.Uppersrv:")<1){var s=GetWebrtcSyUpperHeader("invite send");!isNull(s)&&s.length>0&&(PutToDebugLog(3,"EVENT, (warn) Upperserver added at invite send"),t=AddSIPLine(t,"X-Sy.Uppersrv: "+s))}if(t.indexOf("X-Sy.Uppersrvd:")<1){var l=GetWebrtcSyUpperDomainHeader("invite send");!isNull(l)&&l.length>0&&t.indexOf("X-Sy.Uppersrvd:")<1&&(PutToDebugLog(3,"EVENT, (warn) Upperserver domain added at invite send"),t=AddSIPLine(t,"X-Sy.Uppersrvd: "+l))}if(i){4==GetParameterInt("dtmfmode",2)&&t.indexOf("X-MFlag:2")<0&&(PutToDebugLog(3,"EVENT, rfc2833 added at invite send"),t=AddSIPLine(t,"X-MFlag:2"))}
0!=webphone_api.global.isresume&&webphone_api.common.GetTickCount()-webphone_api.global.isresume<2e3&&webphone_api.common.GetTickCount()-webphone_api.global.isresume>=0&&(t=t.replace("\na=sendonly\r","\na=sendrecv\r"),t=t.replace("\na=recvonly\r","\na=sendrecv\r"),t=t.replace("\na=inactive\r","\na=sendrecv\r"))}return t=RecalculateContentLength(t)}catch(p){PutToDebugLogException(2,"common: FixContentLength",p)}return e}function StrGetUntill(e,t){if(!e||!t||e.length<1||t.length<1)return"";var n=e.indexOf(t);return n<0&&(n=e.toLowerCase().indexOf(t.toLowerCase())),n<0?"":e.substring(0,n)}function StrGetAfter(e,t){if(!e||!t||e.length<1||t.length<1)return"";var n=e.indexOf(t);return n<0&&(n=e.toLowerCase().indexOf(t.toLowerCase())),n<0?"":e.substring(n+t.length)}function StrGetBetween(e,t,n){if(!e||!t||e.length<1||t.length<1)return"";var o=e.indexOf(t);if(o<0&&(o=e.toLowerCase().indexOf(t.toLowerCase())),o<0)return"";if(e=e.substring(o+t.length),!n||e.length<1||n.length<1)return e;var i=e.indexOf(n);return i<0&&(i=e.toLowerCase().indexOf(n.toLowerCase())),i<0?"":e.substring(0,i)}function StrReplaceBetween(e,t,n,o){if(!e||e.length<1)return"";var i=StrGetAfter(e,t);if(i.length<1)return e;if(i.indexOf(n)<0&&i.toLowerCase().indexOf(n.toLowerCase())<0){if("\r"!==n&&"\r\n"!==n)return e}else i=StrGetAfter(i,n);return StrGetUntill(e,t)+t+o+n+i}function GetDomainPart(e,t){if(void 0!==t&&null!==t||void 0!==(t=e)&&null!==t||(t=""),t=Trim(t),null==e||e.length<1)return t;var n=Trim(e);return n.indexOf(",")>=0&&(","==n.charAt(0)?(n=n.substring(1),n.indexOf(",")>0&&(n=Trim(n.substring(0,n.indexOf(","))))):n=Trim(n.substring(0,n.indexOf(",")))),n.indexOf("<")>0&&(n=Trim(n.substring(n.indexOf("<")+1))),0!=n.indexOf('"')&&0!=n.indexOf("'")||(n=Trim(n.substring(1))),n.indexOf(">")>0&&(n=Trim(n.substring(0,n.indexOf(">")))),n.indexOf("\\")>0&&(n=Trim(n.substring(0,n.indexOf("\\")))),n.indexOf("/")>0&&(n=Trim(n.substring(0,n.indexOf("/")))),n.indexOf("sip:")>=0?n=n.substring(n.indexOf("sip:")+4):n.indexOf("tel:")>=0?n=n.substring(n.indexOf("tel:")+4):n.indexOf("sips:")>=0&&(n=n.substring(n.indexOf("sips:")+5)),n.indexOf("@")>0&&(n=Trim(n.substring(n.indexOf("@")+1))),n.indexOf(":")>0&&(n=Trim(n.substring(0,n.indexOf(":")))),n.indexOf('"')>0&&(n=Trim(n.substring(0,n.indexOf('"')))),n.indexOf("'")>0&&(n=Trim(n.substring(0,n.indexOf("'")))),n.length<1?t:n}function RecalculateContentLength(e){try{var t="\nContent-Length:",n=StrGetBetween(e,t,"\r");if(n.length<1&&(t="\nl:",n=StrGetBetween(e,t,"\r")),n.length<1)return e;var o=StrToIntDef(n,0);if(o<1)return e;var i=e.indexOf("\r\n\r\n");if(i<1)return e;var a=e.length-i-4;return a==o?e:(PutToDebugLog(5,"EVENT, FixContentLength overwrite from: "+o.toString()+" to: "+a.toString()),StrReplaceBetween(e,t,"\r",a.toString()))}catch(r){PutToDebugLogException(2,"common: RecalculateContentLength",r)}return e}function RemoveDuplicateHeaders(e){try{if(isNull(e)||e.length<1)return e;var t=e,n=t.indexOf("REGISTER sip");if(n>=0&&n<20){for(var o=[],i=t.split("\r\n"),a=0;a<i.length;a++)"undefined"!=typeof i[a]&&null!==i[a]&&(i[a].indexOf(":")<0?o.push(i[a]):o.indexOf(i[a])<0&&o.push(i[a]));if(!isNull(o)&&o.length>0){for(var r="",a=0;a<o.length;a++)a>0?r=r+"\r\n"+o[a]:r+=o[a];return r}}}catch(s){PutToDebugLogException(2,"common: RemoveDuplicateHeaders",s)}return e}function AddDtmfConfHeader(e){try{if(!0!==webphone_api.global.isconfdtmf)return e;if(isNull(e)||e.length<1)return e;if(e.indexOf("INFO sip:")<0&&e.indexOf("INFO sips:")<0)return e;var t=e;t.indexOf("Signal=#")>=0&&(webphone_api.global.isconfdtmf=!1);var n=t.indexOf("\r\nCall-ID:");if(n>=0&&t.indexOf("X-MDTFM:")<0){var t=t.substring(0,n)+"\r\nX-MDTFM: y"+t.substring(n);return t}}catch(o){PutToDebugLogException(2,"common: AddDtmfConfHeader",o)}return e}function GetViaRandomAddress(){try{return!isNull(viarandaddr)&&viarandaddr.length>0?viarandaddr:viarandaddr=RandomStr(12,!1,!0)+".invalid"}catch(e){PutToDebugLogException(2,"common: FixContentLength",e)}return"abcdefg12345.invalid"}function GetPushnotVal(e){var t=GetParameterInt("enablepush",e),n=GetParameterInt("callreceiver",e),o=n;return 1!==n&&-1!==n||(o=0),t>=0&&(o=t),o}function EnableFCM(){try{var e=GetPushnotVal(-1);if(isNull(e)||e<-1)return!1;if(0===e)return!1;if(!1===IsHttps()&&window.location.href.toLowerCase().indexOf("://localhost")<0&&window.location.href.toLowerCase().indexOf("://127.0.0.1")<0)return!1;if(!1 in navigator||!1 in window)return!1;if(!0===HideSettings("enablepush",webphone_api.stringres.get("sett_display_name_enablepush"),"enablepush",!0))return!1;if(!0===IsLocalServer(!0)||!0===IsLocalUpperServer())return!1;if(1===e||2===e||3===e)return!0;if(-1===e){if(-1==webphone_api.global.recwsload&&(webphone_api.global.recwsload=GetParameter("lastrecwsload",-2)),webphone_api.global.recwsload>1)return PutToDebugLog(2,"WARNING, EnableFCM returned false, because wsload server load is to high: "+webphone_api.global.recwsload),!1;var t=GetParameterInt("lastincalltime",0),n=GetParameterInt("appinstalltime",0);n<1&&SaveParameter("appinstalltime",GetTickCount().toString());var o=GetTickCount(),i=!1;n>0&&o-n<7776e6&&(i=!0);var a=!1;if(t>0&&o-t<7776e6&&(a=!0),"undefined"!=typeof webphone_api.config&&null!==webphone_api.config&&"undefined"!=typeof webphone_api.config.apiKey&&null!==webphone_api.config.apiKey&&webphone_api.config.apiKey.length>3&&(!0===i||!0===a))return!0}}catch(r){PutToDebugLogException(2,"common EnableFCM",r)}return!1}function RegisterServiceWorker(){return navigator.serviceWorker.register("firebase-messaging-sw.js").then(function(e){return PutToDebugLog(2,"WARNING,FCM RegisterServiceWorker successfully registered"),FCMRequestNotidicationPeremission(),e})["catch"](function(e){PutToDebugLogException(2,"FCM, RegisterServiceWorker: Unable to register")})}function FCMRequestNotidicationPeremission(){try{if(!window.Notification||!Notification.permission)return void PutToDebugLog(2,"WARNING,FCMRequestNotidicationPeremission: Notification not supported in this environment, browser: "+GetBrowser()+"; os: "+GetOs())}catch(e){PutToDebugLogException(2,"common FCMRequestNotidicationPeremission",e)}}function StartFCM(e){try{if(!1===EnableFCM())return;return void PutToDebugLog(4,"EVENT, exec StartFCM ("+e+")")}catch(t){PutToDebugLogException(2,"common StartFCM",t)}}function FCMSetToken(){try{var e=GetParameterInt("enablefcm",-1);if(e<1&&(e=1),getuseengine()===webphone_api.global.ENGINE_WEBRTC)webphone_api.global.fcmIsEnabled=1,webphone_api.webrtcapi.SetPushNotifications(e,webphone_api.global.fcmtoken,"","");else if(!0===IsWindowsSoftphone()||getuseengine()===webphone_api.global.ENGINE_SERVICE)webphone_api.global.fcmIsEnabled=1,WinAPI("API_SetPushNotifications",null,e,webphone_api.global.fcmtoken,"","");else{if(getuseengine()!==webphone_api.global.ENGINE_JAVA)return void PutToDebugLog(2,"WARNING, FCM FCMSetToken push notifications are not supported by engine: "+getuseengine());webphone_api.global.fcmIsEnabled=1,webphone_api.webphone.SetPushNotifications(e,webphone_api.global.fcmtoken,"","")}PutToDebugLog(2,"EVENT, FCM FCMSetToken push notifications are ENABLED: "+getuseengine())}catch(t){PutToDebugLogException(2,"common FCMSetToken",t)}}function UserExists(e){try{if(isNull(e))return!0;if(e=e.toLowerCase(),e=Trim(e),e.length<1)return!0;if(e===GetSipusername().toLowerCase())return!0;if(!isNull(webphone_api.global.sipaccounts))for(var t=0;t<webphone_api.global.sipaccounts.length;t++)if(!isNull(webphone_api.global.sipaccounts[t].username)&&webphone_api.global.sipaccounts[t].username.toLowerCase()===e)return!0;return!1}catch(n){PutToDebugLogException(2,"common UserExists",n)}return!0}function GetSipusername(){var e="";try{e=GetParameter("sipusername"),(isNull(e)||e.length<1)&&(e=GetParameter("username")),isNull(e)&&(e=""),e.indexOf("@")>0&&(e=e.substring(0,e.indexOf("@")))}catch(t){PutToDebugLogException(2,"common GetSipusername",t)}return e}function GetCallerid(){var e="";try{e=GetParameter("username"),(isNull(e)||e.length<1)&&(e=GetParameter("sipusername")),e.indexOf("@")>0&&(e=e.substring(0,e.indexOf("@")))}catch(t){PutToDebugLogException(2,"common GetCallerid",t)}return e}function HandleCallerID(){try{var e=GetParameter("previous_sipusername"),t=GetParameter("previous_username");!isNull(e)&&e.length>0&&e!==GetParameter("sipusername")&&!isNull(t)&&t.length>0&&t===GetParameter("username")&&GetParameter("username")!==GetParameter("sipusername")&&(PutToDebugLog(2,"EVENT, HandleCallerID: callerID is reset; old callerid: "+t),SaveParameter("username","")),SaveParameter("previous_username",GetParameter("username")),SaveParameter("previous_sipusername",GetParameter("sipusername"))}catch(n){PutToDebugLogException(2,"common: HandleCallerID",n)}}function GetFCMPackageName(){try{var e=GetParameter("packagename");if(!isNull(e)&&Trim(e).length>0)return e}catch(t){PutToDebugLogException(2,"common GetFCMPackageName",t)}return"com.mizuvoip.mizudroid.app"}function UniqueArray(e){try{if(isNull(e)||e.length<1)return e;for(var t=e,n=0,o=t.length+10,i=0;n<t.length;){if(++i>o)return e;var a=t.indexOf(t[n]);a>=0&&a<n?t.splice(n,1):n++}return t}catch(r){PutToDebugLogException(2,"common UniqueArray",r)}return e}function IsWebphoneInIframe(){try{return window.self!==window.top}catch(e){return!0}}function GetParentIframeUrl(){var e="";try{if(!1===IsWebphoneInIframe())return"";e=document.referrer}catch(t){try{e=window.parent.location}catch(n){e="ERROR, cannot get iframe parent location"}}return isNull(e)&&(e=""),e}function IsCExt(){try{if(iscallerextension>=0)return iscallerextension;var e=window.location.href;void 0!==e&&null!==e||(e=""),e=e.toLowerCase();var t=[];t.push("c"),t.push("a"),t.push("l"),t.push("l"),t.push("e"),t.push("r"),t.push("e"),t.push("x"),t.push("t"),t.push("e"),t.push("n"),t.push("s"),t.push("i"),t.push("o"),t.push("n"),t.push("="),t.push("3"),t.push("4"),t.push("5");var n=t.join("");return e.indexOf(n)>0?(PutToDebugLog(2,"EVENT, IsCExt: 1; "+e),iscallerextension=1):iscallerextension=0,iscallerextension}catch(o){PutToDebugLogException(2,"common IsCExt",o)}return 0}function GetUA(){try{return"MWWRTC "+webphone_api.global.versionstr}catch(e){PutToDebugLogException(2,"common GetUA",e)}return"MWWRTC 1.0"}function StripXML(e){try{if(isNull(e)||e.length<1)return"";var t=Trim(e),n=t.indexOf("<"),o=t.indexOf(">");if(n>=0&&o>=0&&n<o)for(var i=0;n>=0&&o>=0&&n<o&&i<100;)i++,t=t.substring(0,n)+t.substring(o+1),n=t.indexOf("<"),o=t.indexOf(">");return t}catch(a){PutToDebugLogException(2,"common GetUA",a)}return e}function DisplayStartPage(e){try{var t=GetParameter("startpage_url");isNull(t)&&(t="");var n=GetParameter("startpage_text");if(isNull(n)&&(n=""),t.length<2&&n.length<5)return;var o=GetParameter("startpage_title");isNull(o)&&(o="");var i=GetParameterInt("startpage_type",0);if(t.length>0){var a=t.indexOf("stitle=");if(a>0){var r=t.substring(a+7);a=r.indexOf("&"),a>0&&(r=r.substring(0,a)),!isNull(r)&&r.length>0&&(o=r)}if((a=t.indexOf("stype="))>0){var s=t.substring(a+6);a=s.indexOf("&"),a>0&&(s=s.substring(0,a)),!isNull(s)&&s.length>0&&IsNumber(s)&&(i=StrToIntDef(s,0))}}var l=GetParameterInt("startpage_disp_count",0);if(i<2&&l>0)return;if(2==i&&l>0&&"Settings"===e)return;webphone_api.global.intentstartpage[0]="url="+t,webphone_api.global.intentstartpage[1]="lastpage="+webphone_api.$.mobile.activePage.attr("id"),webphone_api.global.intentstartpage[2]="title="+o,webphone_api.global.intentstartpage[3]="text="+n,webphone_api.global.intentstartpage[4]="type="+i.toString(),webphone_api.$.mobile.changePage("#page_startpage",{transition:"pop",role:"page"})}catch(p){PutToDebugLogException(2,"common DisplayStartPage",p)}}function ParseQRcode(e){try{if(isNull(e)||Trim(e).lenght<1||e.indexOf(":")<1)return void PutToDebugLog(2,"ERROR, ParseQRcode invalid QRcode: "+e);if(e=ReplaceAll(e,"{",""),e=ReplaceAll(e,"}",""),e=ReplaceAll(e,'"',""),e.indexOf("ERROR")>=0)return e=e.replace("ERROR,",""),e=e.replace("ERROR",""),PutToDebugLog(2,"ERROR, ParseQRcode returned error (show toast untill user): "+e),void ShowToast(e);for(var t=e.split(","),n=0;n<t.length;n++)if(!isNull(t[n])){var o=t[n].indexOf(":");if(!(o<1)){var i=t[n].substring(0,o),a=t[n].substring(o+1);if(!(isNull(i)||Trim(i).length<1||isNull(a))){i=Trim(i),a=Trim(a),SaveParameter("QRCODE_"+i,a);var r="";switch(i){case"user":r="sipusername";break;case"server":r="serveraddress_user";break;case"proxy":r="proxyaddress";break;default:r=i}!isNull(r)&&r.length>0&&(PutToDebugLog(5,"ParseQRcode SaveParameter: "+r+"="+a),SaveParameter(r,a)),r=""}}}ShowToast(webphone_api.stringres.get("barcode_success")),setTimeout(function(){try{GetSipusername().length>0&&GetParameter("password").length>0&&"page_settings"!==webphone_api.$.mobile.activePage.attr("id")&&(PutToDebugLog(5,"ParseQRcode autologin because we have received login details"),webphone_api.plhandler.LoginSkin())}catch(e){PutToDebugLogException(2,"ParseQRcode timer inner run",e)}},3e3)}catch(s){PutToDebugLogException(2,"common ParseQRcode",s)}}function GetSrvVersions(){try{if(!0===IsMacLin()||IsWinMacLinNsTest())return;var e=GetTickCount();if(srvVersionMaxLoop>1&&e-srvVersionLastExec<5e3)return;srvVersionMaxLoop++,srvVersionLastExec=e,WinAPI("API_GetExeVersion",function(e){!isNull(e)&&e.length>0&&e.toLowerCase().indexOf("error")<0&&(e=e.replace("OK:",""),e=Trim(e),SaveParameter("srv_exe_version",e))}),setTimeout(function(){WinAPI("API_GetVersion",function(e){!isNull(e)&&e.length>0&&e.toLowerCase().indexOf("error")<0&&(e=e.replace("OK:"),e=Trim(e),SaveParameter("srv_java_version",e))})},500)}catch(t){PutToDebugLogException(2,"common GetSrvVersions",t)}}function IsWinMacLinNsTest(){try{if("undefined"!=typeof webphone_api.parameters.winlinmacnsengine){if(!0===webphone_api.parameters.winlinmacnsengine||"true"===webphone_api.parameters.winlinmacnsengine)return!0;if(!1===webphone_api.parameters.winlinmacnsengine||"false"===webphone_api.parameters.winlinmacnsengine)return!1}}catch(e){PutToDebugLogException(2,"common IsWinMacLinNsTest",e)}return webphone_api.global.winlinmacnsengine}function IsMacLin(){try{return isNull(ismaclin_cached)?ismaclin_cached="Mac"===GetOs()||"Linux"===GetOs():ismaclin_cached}catch(e){PutToDebugLogException(2,"common IsMacLin",e)}return!1}function NSMacLinEnabled(){try{if(!isNull(maclinenabled_cached))return maclinenabled_cached;if("undefined"==typeof webphone_api.parameters.linnsengine||!0!==webphone_api.parameters.linnsengine&&!1!==webphone_api.parameters.linnsengine||(webphone_api.global.linnsengine=webphone_api.parameters.linnsengine),"undefined"==typeof webphone_api.parameters.macnsengine||!0!==webphone_api.parameters.macnsengine&&!1!==webphone_api.parameters.macnsengine||(webphone_api.global.macnsengine=webphone_api.parameters.macnsengine),!0===webphone_api.global.linnsengine&&"Linux"===GetOs())return maclinenabled_cached=!0;if(!0===webphone_api.global.macnsengine&&"Mac"===GetOs())return maclinenabled_cached=!0;if(!0===IsWinMacLinNsTest()&&(!0===IsMacLin()||"Windows"===GetOs()))return maclinenabled_cached=!0}catch(e){PutToDebugLogException(2,"common NSMacLinEnabled",e)}return!1}function TestNSPolling(){try{return null!==flag_testnspolling_cached?flag_testnspolling_cached:flag_testnspolling_cached="undefined"!=typeof webphone_api.parameters.flag_testnspolling&&!0===webphone_api.parameters.flag_testnspolling}catch(e){PutToDebugLogException(2,"common TestNSPolling",e)}return!1}function GetAudioRecList(){return!isNull(webphone_api.global.audio_rec_device_list)&&webphone_api.global.audio_rec_device_list.length>0?webphone_api.global.audio_rec_device_list:GetParameter("cache_audio_rec_device_list")}function GetAudioPlayList(){return!isNull(webphone_api.global.audio_play_device_list)&&webphone_api.global.audio_play_device_list.length>0?webphone_api.global.audio_play_device_list:GetParameter("cache_audio_play_device_list")}function GetAudioRingList(){return!isNull(webphone_api.global.audio_ring_device_list)&&webphone_api.global.audio_ring_device_list.length>0?webphone_api.global.audio_ring_device_list:GetParameter("cache_audio_ring_device_list")}function GetVideoRecList(){return!isNull(webphone_api.global.video_rec_device_list)&&webphone_api.global.video_rec_device_list.length>0?webphone_api.global.video_rec_device_list:GetParameter("cache_video_rec_device_list")}function GetAudioRecDev(){return!isNull(webphone_api.global.audio_rec_curr_device)&&webphone_api.global.audio_rec_curr_device.length>0?webphone_api.global.audio_rec_curr_device:GetParameter("cache_audio_rec_curr_device")}function GetAudioPlayDev(){return!isNull(webphone_api.global.audio_play_curr_device)&&webphone_api.global.audio_play_curr_device.length>0?webphone_api.global.audio_play_curr_device:GetParameter("cache_audio_play_curr_device")}function GetAudioRingDev(){return!isNull(webphone_api.global.audio_ring_curr_device)&&webphone_api.global.audio_ring_curr_device.length>0?webphone_api.global.audio_ring_curr_device:GetParameter("cache_audio_ring_curr_device")}function GetVideoRecDev(){return!isNull(webphone_api.global.video_rec_curr_device)&&webphone_api.global.video_rec_curr_device.length>0?webphone_api.global.video_rec_curr_device:GetParameter("cache_video_rec_curr_device")}function NuIsWebPage(){try{if(!isNull(webphone_api.global.nuiswebpage))return webphone_api.global.nuiswebpage;var e=GetParameter("newuser");return isNull(e)&&(e=""),e=Trim(e),0===e.indexOf("*")?webphone_api.global.nuiswebpage=!1:webphone_api.global.nuiswebpage=!0,webphone_api.global.nuiswebpage}catch(t){PutToDebugLogException(2,"common: NuIsWebPage",t)}return!1}function GetMinSrvBuildValue(){try{var e=GetParameterInt("minimumservicebuild",-1);if(e>webphone_api.global.minimumservicebuild)return e}catch(t){PutToDebugLogException(2,"common: GetMinSrvBuildValue",t)}return webphone_api.global.minimumservicebuild}function HandleServiceBuildUpgrade(){GetMinSrvBuildValue()<1||webphone_api.global.nsupdatepending||WinAPI("API_GetBuildNumber",function(e){try{if(!isNull(e)&&IsNumber(e)){var t=StrToIntDef(e,0),n=GetMinSrvBuildValue();if(n>0&&t<n){GetParameterInt("cancelonnsdownload",0)<e&&(HasUsableEngineFromEngines(GetEngine("ns"),["java","ns","webrtc"])?(EngineForcedInstall("ns",webphone_api.stringres.get("service_update"),!0,function(e){isNull(e)||"cancel"!==e||SaveParameter("cancelonnsdownload",GetMinSrvBuildValue())}),webphone_api.global.nsupdatepending=!0):(EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0))}}}catch(o){PutToDebugLogException(2,"common: HandleServiceBuildUpgrade()",o)}})}function ExecFunction(e){try{if(isNull(e)||e.length<1)return;var t=e,n="",o=t.indexOf("(");o>0&&(n=t.substring(o+1),t=Trim(t.substring(0,o))),isNull(n)&&(n=""),n=n.replace(")",""),n=Trim(n),t=t.replace("webphone_api.",""),t=Trim(t);var a=[];if(n.length>0){a=n.split(","),isNull(a)&&(a=[]);for(var r=0,s=0;r<a.length&&s<200;)isNull(a[r])?a.splice(i,1):r++,s++}isNull(a)&&(a=[]),PutToDebugLog(3,"EVENT, ExecFunction: "+t+"("+n+")");var e=window.webphone_api[t];if("function"!=typeof e)return void PutToDebugLog(3,"ERROR, ExecFunction fn is NOT a function");e.apply(window,a)}catch(l){PutToDebugLogException(2,"common: ExecFunction: "+e,l)}}function GetUrlParamVal(e,t){try{if(isNull(t)||Trim(t).length<1||isNull(e)||e.indexOf(t)<0)return"";t=Trim(t),t.indexOf("=")<1&&(t+="=");var n=e.indexOf(t);if(n>=0)return e=e.substring(n+t.length),n=e.indexOf("&"),n>0&&(e=e.substring(0,n)),n=e.indexOf("#"),n>0&&(e=e.substring(0,n)),isNull(e)?"":Trim(e)}catch(o){PutToDebugLogException(2,"common: GetUrlParamVal",o)}return""}function GetJsonParamVal(e,t){try{if(isNull(e)||e.length<1||isNull(t)||t.length<1)return"";t=Trim(t),t=t.toLowerCase(),t.indexOf(":")<1&&(t+=":"),e=ReplaceAll(e,'"',"");var n="",o=e.toLowerCase().indexOf(t);if(o>=0&&(n=e.substring(o+t.length),o=n.indexOf(","),o>0&&(n=n.substring(0,o)),o=n.indexOf("}"),o>0&&(n=n.substring(0,o)),o=n.indexOf("\n"),o>0&&(n=n.substring(0,o)),!isNull(n)))return Trim(n)}catch(i){PutToDebugLogException(2,"common: GetJsonParamVal",i)}return""}function HandleNewUserResult(e,t){try{if(!NuIsWebPage())return;if(void 0!==t&&null!==t&&t.getElementsByTagName){var n=t.getElementsByTagName("INPUT");if(!isNull(n)&&n.length>0){var o=[];o.push("s"),o.push("e"),o.push("r"),o.push("v"),o.push("e"),o.push("r"),o.push("a"),o.push("d"),o.push("d"),o.push("r"),o.push("e"),o.push("s"),o.push("s");for(var i=o.join(""),a=0;a<n.length;a++)if(!isNull(n[a])&&"hidden"===n[a].type){var r=n[a].id;if(!isNull(r)&&0===r.indexOf("wp_")){r=r.substring(3);var s=n[a].value;isNull(s)||r!==i&&0!==Trim(r).indexOf(i)&&(PutToDebugLog(2,"_settings: Newuser found input setting parameter: "+r+" = "+s),SaveParameter(r,s))}}}}if(isNull(e)||e.indexOf("wp_")<2)return;var l=e.split("\n");if(isNull(l)||l.length<1)return;for(var p=0,c=!1,a=0;a<l.length;a++)if(!isNull(l[a])&&(l[a].toLowerCase().indexOf("<script")>=0&&(c=!0),l[a].toLowerCase().indexOf("</script")>=0&&(c=!1),!0!==c&&!(l[a].indexOf("wp_")<0||l[a].toLowerCase().indexOf("<input")>=0)))for(;l[a].indexOf("wp_")>=0&&(p=l[a].lastIndexOf("wp_"))>=0;){var u=l[a].substring(p+3);if(l[a]=l[a].substring(0,p),isNull(u)||u.length<1)break;NUFindSingleParam(u)}}catch(h){PutToDebugLogException(2,"_settings: HandleNewUserResult",h)}}function NUFindSingleParam(e){try{if(isNull(e)||e.length<3)return;var t="",n="",o=e.indexOf(":");if(o>0)t=e.substring(0,o),n=e.substring(o+1),(o=t.indexOf("="))>0&&(n=t.substring(o+1),t=t.substring(0,o));else{var o=e.indexOf("=");o>0&&(t=e.substring(0,o-1),n=e.substring(0))}isNull(t)&&(t=""),isNull(n)&&(n=""),t=t.toLowerCase(),t=Trim(t),n=Trim(n);var i=[];i.push("s"),i.push("e"),i.push("r"),i.push("v"),i.push("e"),i.push("r"),i.push("a"),i.push("d"),i.push("d"),i.push("r"),i.push("e"),i.push("s"),i.push("s");var a=i.join("");if(t===a||0===Trim(t).indexOf(a))return;o=n.indexOf("}"),o>0&&(n=n.substring(0,o)),o=n.indexOf("]"),o>0&&(n=n.substring(0,o)),o=n.indexOf(";"),o>0&&(n=n.substring(0,o)),o=n.indexOf(","),o>0&&(n=n.substring(0,o)),n=ReplaceAll(n,"'",""),n=ReplaceAll(n,'"',""),t.length>0&&(PutToDebugLog(2,"_settings: Newuser found setting parameter: "+t+" = "+n),"username"===t&&(t="sipusername"),SaveParameter(t,n),"signup_display"===t&&n.length>0&&(PutToDebugLog(2,"EVENT, NewUserSignup display message: "+n),ShowToast(n)))}catch(r){PutToDebugLogException(2,"common: NUFindSingleParam",r)}}function GetPreferredStorage(){try{return null!==prefstorage_cached?prefstorage_cached:prefstorage_cached="undefined"!=typeof webphone_api&&null!==webphone_api&&"undefined"!=typeof webphone_api.parameters&&null!==webphone_api.parameters&&"undefined"!=typeof webphone_api.parameters.preferred_storage&&null!==webphone_api.parameters.preferred_storage&&IsNumber(webphone_api.parameters.preferred_storage)?StrToIntDef(webphone_api.parameters.preferred_storage,-1):!isNull(GetConfig("preferred_storage"))&&GetConfig("preferred_storage").length>0?GetConfigInt("preferred_storage",-1):-1}catch(e){PutToDebugLogException(2,"common: GetPreferredStorage",e)}return-1}function GetSafariCookie(){try{if("Safari"!==GetBrowser())return 0;if(0===GetPreferredStorage())return 0;return GetParameterInt("safaricookie",1)}catch(e){PutToDebugLogException(2,"common: GetSafariCookie",e)}return 0}function GetApibehaviour(){return behaviour_cached<-5&&(behaviour_cached=GetConfigInt("apibehaviour",-1)),behaviour_cached}function GetFiletrasnferFormActionUrl(){var e="";try{var t="",n="",o=-1,i=GetParameter("filetransferurl");if((isNull(i)||i.length<1)&&(i=GetParameter("filetransfer_web")),!isNull(i)&&i.length>2)return i=Trim(i),i=i.toLowerCase(),i.indexOf("http:")<0&&i.indexOf("https:")<0&&(i="http://"+i),IsHttps()&&(i=i.replace("http:","https:")),i;var a=GetWebrtcSrvAddr(),r=GetParameter("creditrequest"),s=GetWpS("uk");return!isNull(a)&&a.length>3&&a.toLowerCase().indexOf("mfstwebsock")>0?(t=a.toLowerCase(),n="http://",t.indexOf("wss:")>=0&&(n="https://"),t=NormalizeInput(t,0),o=t.indexOf("/"),o>0&&(t=t.substring(0,o)),t=Trim(t),e=n+t,n=""):!isNull(r)&&r.indexOf("mvapireq")>0?(t=r.toLowerCase(),o=t.indexOf("://"),o>0?(n=t.substring(0,o+3),t=t.substring(o+3)):(n="http://",!0===IsHttps()&&(n="https://")),o=t.indexOf("/"),o>0&&(t=t.substring(0,o)),t=Trim(t),e=n+t,n=""):!isNull(s)&&s.length>3&&(t=s.toLowerCase(),n="http://",t.indexOf("wss:")>=0&&(n="https://"),t=NormalizeInput(t,0),o=t.indexOf("/"),o>0&&(t=t.substring(0,o)),t=Trim(t),e=n+t,n=""),e.length<1?(PutToDebugLog(3,"ERROR, filetransfer invalid URL"),""):(e=e.replace("*",""),e+="/mvweb/")}catch(l){PutToDebugLogException(2,"_filetransfer: GetFiletrasnferFormActionUrl",l)}return""}function NormalizeFilename(e){try{var t=e,n=e.split("");if(isNull(n)||n.length<1)return t;for(var o=0;o<n.length;o++)n[o]>="0"&&n[o]<="9"||n[o]>="A"&&n[o]<="Z"||n[o]>="a"&&n[o]<="z"||"_"===n[o]||"."===n[o]||"-"===n[o]||(n[o]="_");return n.join("")}catch(i){PutToDebugLogException(2,"common:  NormalizeFilename",i)}return t}function GetNsPluginWsUrl(){try{var e=[],t=new Date,n=new Date(webphone_api.global.NPUSECURE1_YEAR,webphone_api.global.NPUSECURE1_MONTH,0,0,0,0,0),o=new Date(webphone_api.global.NPUSECURE2_YEAR,webphone_api.global.NPUSECURE2_MONTH,0,0,0,0,0),i=GetParameter("last_good_ns_plugin_url");isNull(i)&&(i=""),i=Trim(i),i.length>5&&e.push(i);var a=!1;"Windows"!==GetOs()&&"Mac"!==GetOs()&&"Linux"!==GetOs()||(a=!0),(PreferWss()||"MSIE"===GetBrowser())&&(a=!1);var r="";!0===a&&(r=FormatURL(webphone_api.global.NATIVE_PLUGIN_URL),e.indexOf(r)<0&&e.push(r));var s=GetParameter("nsdomain",webphone_api.global.NATIVE_PLUGIN_URL_SECURE),l=GetParameter("nsdomain2",webphone_api.global.NATIVE_PLUGIN_URL_SECURE2);(isNull(s)||Trim(s).length<5)&&(s=webphone_api.global.NATIVE_PLUGIN_URL_SECURE),(isNull(l)||Trim(l).length<5)&&(l=webphone_api.global.NATIVE_PLUGIN_URL_SECURE2);var p="",c="";void 0!==s&&null!==s&&Trim(s).length>4&&(p=Trim(s)),void 0!==l&&null!==l&&Trim(l).length>4&&(c=Trim(l)),p.length>4&&c.length>4&&(o>n?(r=FormatURL(t>o?c:t>n?p:p),e.indexOf(r)<0&&e.push(r)):(r=FormatURL(t>n?p:t>o?c:c),e.indexOf(r)<0&&e.push(r))),p.length>4&&e.indexOf(FormatURL(p))<0&&e.push(FormatURL(p)),c.length>4&&e.indexOf(FormatURL(c))<0&&e.push(FormatURL(c));for(var u=0;u<e.length;u++)(isNull(e[u])||Trim(e[u]).length<5)&&e.splice(u,1);return e}catch(h){PutToDebugLogException(2,"common: GetNsPluginWsUrl",h)}return[FormatURL(webphone_api.global.NATIVE_PLUGIN_URL_SECURE)]}function FormatURL(e){try{if(isNull(e)||Trim(e).length<1)return"";var t=e;return t=t.toLowerCase(),t.indexOf("127.0.0.1")>=0?t.indexOf("ws:")<0&&(t="ws://"+ret):t.indexOf("wss:")<0&&(t="wss://"+ret),0!=t.indexOf("ws")&&(t="wss://"+t),t.indexOf(":")===t.lastIndexOf(":")&&(t.indexOf("127.0.0.1")>=0||t.indexOf("localhost")>=0?(t="Windows"!==GetOs()||webphone_api.global.winlinmacnsengine?t+":"+webphone_api.global.NATIVE_PLUGIN_URL_LINMAC_PORT:t+":"+webphone_api.global.NATIVE_PLUGIN_URL_WIN_PORT,t=t.replace("wss://","ws://")):(t="Windows"!==GetOs()||webphone_api.global.winlinmacnsengine?t+":"+webphone_api.global.NATIVE_PLUGIN_URL_LINMAC_SSL_PORT:t+":"+webphone_api.global.NATIVE_PLUGIN_URL_WIN_SSL_PORT,t=t.replace("ws://","wss://"))),"Windows"===GetOs()&&t.indexOf("/msstwebsock")<0&&(t+="/msstwebsock"),t}catch(n){PutToDebugLogException(2,"common: GetNsPluginWsUrl",n)}return e}function AttendedPopup(e){try{if(1==IsSDK())return void AttendedPopupSDK(e);var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220;var n='<div id="attended_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+"px; width: "+t+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+webphone_api.stringres.get("attended_transfer_title")+'</h1></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_attended_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_transfer")+'</a><a href="javascript:;" id="adialog_attended_revert" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_revert")+'</a><a href="javascript:;" id="adialog_attended_hangup" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back">'+webphone_api.stringres.get("btn_hangup")+"</a></div></div>";webphone_api.$.mobile.activePage.append(n).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){webphone_api.$(".ui-popup-screen").off(),webphone_api.$(this).unbind("popupbeforeposition")}}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_attended_transfer").off("click"),webphone_api.$("#adialog_attended_revert").off("click"),webphone_api.$("#adialog_attended_hangup").off("click")}}),webphone_api.$("#adialog_attended_transfer").on("click",function(t){webphone_api.$("#attended_popup").on("popupafterclose",function(t){webphone_api.$("#attended_popup").off("popupafterclose"),PutToDebugLog(5,"EVENT, common AttendedPopup: transfer onclick: "+e),webphone_api.transfer(e,2)})}),webphone_api.$("#adialog_attended_hangup").on("click",function(e){PutToDebugLog(5,"EVENT, common AttendedPopup: hangup onclick"),webphone_api.hangup()}),webphone_api.$("#adialog_attended_revert").on("click",function(e){PutToDebugLog(5,"EVENT, common AttendedPopup: revert onclick")})}catch(o){PutToDebugLogException(2,"common: AttendedPopup",o)}}function AttendedPopupSDK(e){try{if(PutToDebugLog(4,"EVENT, AttendedPopupSDK popup displayed"),!isNull(aptmodal))return void aptmodal.show();aptmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("attended_transfer_title")+'</div><div id="ce_modal_footer" class="pmodal_footer_3btn"><button id="adialog_attended_transfer">'+webphone_api.stringres.get("btn_transfer")+'</button><button id="adialog_attended_revert">'+webphone_api.stringres.get("btn_revert")+'</button><button id="adialog_attended_hangup">'+webphone_api.stringres.get("btn_hangup")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),aptmodal=null,PutToDebugLog(4,"EVENT, AttendedPopupSDK popup closed")}),aptmodal.show(),webphone_api.$("#adialog_attended_transfer").on("click",function(){aptmodal.close(),PutToDebugLog(5,"EVENT, common AttendedPopupSDK: transfer onclick: "+e),webphone_api.transfer(e,2)}),webphone_api.$("#adialog_attended_revert").on("click",function(){aptmodal.close(),PutToDebugLog(5,"EVENT, settings AttendedPopupSDK onclick cancel")}),webphone_api.$("#adialog_attended_hangup").on("click",function(){aptmodal.close(),PutToDebugLog(5,"EVENT, common AttendedPopupSDK: hangup onclick"),webphone_api.hangup()})}catch(t){PutToDebugLogException(2,"common: AttendedPopupSDK",t)}}function Transfer(e){try{if(1==IsSDK())return void TransferSDK(e);PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("initiate_call_transfer"));var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.1):220;var n=""
;GetNrOfActiveCalls()>1&&(getuseengine()===webphone_api.global.ENGINE_SERVICE||getuseengine()===webphone_api.global.ENGINE_JAVA||!0===IsWindowsSoftphone())&&(n='<br /><button id="btn_interconnect_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" style="font-size: .9em">'+webphone_api.stringres.get("interconnect")+"</button>");var o=GetParameterInt("transfertype",-1),i='<a href="javascript:;" id="adialog_attended_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_attendedtransf")+"</a>";-1!==o&&1!==o&&6!==o&&7!==o&&8!==o||(i='<a href="javascript:;" id="adialog_quick_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+webphone_api.stringres.get("btn_transfer")+"</a>");var a='<div id="transfer_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+webphone_api.stringres.get("transfer_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+webphone_api.stringres.get("phone_nr")+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="transfer_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+GetElementSource()+'images/btn_add_contact_txt.png"></button>'+n+'</div><div data-role="footer" data-theme="b" class="adialog_footer">'+i+'<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+webphone_api.stringres.get("btn_cancel")+"</a></div></div>";webphone_api.$.mobile.activePage.append(a).trigger("create"),webphone_api.$.mobile.activePage.find(".closePopup").bind("tap",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")}),webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),webphone_api.$("#adialog_quick_transfer").off("click"),webphone_api.$("#adialog_attended_transfer").off("click"),webphone_api.$("#adialog_negative").off("click"),webphone_api.$("#btn_pickct").off("click"),webphone_api.$("#btn_interconnect_transfer").off("click")}});var r=document.getElementById("transfer_input"),s=GetParameter("last_transfer_number");!isNull(s)&&s.length>1&&(r.value=Trim(s)),!isNull(e)&&e.length>0&&(r.value=e),isNull(r)||r.focus(),webphone_api.$("#adialog_quick_transfer").on("click",function(e){PutToDebugLog(5,"EVENT, call Transfer unattended(quick) ok onclick");var t=Trim(r.value);!isNull(t)&&t.length>0?(webphone_api.transfer(t,2),SaveParameter("last_transfer_number",t)):ShowToast(webphone_api.stringres.get("err_msg_4"))}),webphone_api.$("#adialog_attended_transfer").on("click",function(e){webphone_api.$("#transfer_popup").on("popupafterclose",function(e){PutToDebugLog(5,"EVENT, call Transfer attended ok onclick");var t=Trim(r.value);!isNull(t)&&t.length>0?(webphone_api.call(t),RefreshInfo(),SaveParameter("last_transfer_number",t),setTimeout(function(){AttendedPopup(t)},2e3)):ShowToast(webphone_api.stringres.get("err_msg_4"))})}),webphone_api.$("#adialog_negative").on("click",function(e){}),webphone_api.$("#btn_pickct").on("click",function(e){webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.$("#transfer_popup").on("popupafterclose",function(e){webphone_api.$("#transfer_popup").off("popupafterclose"),PickContact(Transfer)})}),webphone_api.$("#btn_interconnect_transfer").on("click",function(e){PutToDebugLog(2,"EVENT, transfer interconnect on click"),webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.transfer("")}),webphone_api._call.CFUsageClickCount(1)}catch(l){PutToDebugLogException(2,"common: Transfer",l)}}function TransferSDK(e){try{if(!isNull(transfmodal))return void transfmodal.show();var t=(GetParameterInt("transfertype",-1),'<button id="adialog_attended_transfer">'+webphone_api.stringres.get("btn_attendedtransf_short")+"</button>"),n="";GetNrOfActiveCalls()>1&&(getuseengine()===webphone_api.global.ENGINE_SERVICE||getuseengine()===webphone_api.global.ENGINE_JAVA||!0===IsWindowsSoftphone())&&(n='<br /><br /><button id="btn_interconnect_transfer">'+webphone_api.stringres.get("interconnect")+"</button>"),transfmodal=webphone_api.picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+webphone_api.stringres.get("transfer_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner"><span>'+webphone_api.stringres.get("phone_nr")+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="transfer_input" autocapitalize="off"/>'+n+'</div></div><div id="ce_modal_footer" class="pmodal_footer">'+t+'<button id="adialog_transfer_cancel">'+webphone_api.stringres.get("btn_cancel")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(t){var n=document.getElementById("transfer_input"),o=GetParameter("last_transfer_number");!isNull(o)&&o.length>1&&(n.value=Trim(o)),!isNull(e)&&e.length>0&&(n.value=e),isNull(n)||n.focus()}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),transfmodal=null,PutToDebugLog(4,"EVENT, TransferSDK popup closed")}),transfmodal.show(),webphone_api.$("#adialog_quick_transfer").on("click",function(){transfmodal.close(),PutToDebugLog(5,"EVENT, common TransferSDK: quick transfer onclick");var e=document.getElementById("transfer_input"),t=Trim(e.value);!isNull(t)&&t.length>0?(webphone_api.transfer(t,2),SaveParameter("last_transfer_number",t)):ShowToast(webphone_api.stringres.get("err_msg_4"))}),webphone_api.$("#adialog_attended_transfer").on("click",function(){transfmodal.close();var e=document.getElementById("transfer_input"),t=Trim(e.value);!isNull(t)&&t.length>0?(webphone_api.call(t),SaveParameter("last_transfer_number",t),setTimeout(function(){AttendedPopup(t)},2e3)):ShowToast(webphone_api.stringres.get("err_msg_4"))}),webphone_api.$("#adialog_transfer_cancel").on("click",function(){transfmodal.close(),PutToDebugLog(5,"EVENT, settings TransferSDK onclick cancel")}),webphone_api.$("#btn_interconnect_transfer").on("click",function(){transfmodal.close(),PutToDebugLog(2,"EVENT, TransferSDK interconnect on click"),webphone_api.transfer("")})}catch(o){PutToDebugLogException(2,"common: TransferSDK",o)}}function PrintCallSessions(){if(isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return void PutToDebugLog(2,"ERROR,no callsessions to print");for(var e=0;e<webphone_api.global.ep.length;e++){var t=webphone_api.global.ep[e];PutToDebugLog(4,"EVENT, common: PSaveCallSession endpoint updated, line: "+t[EP_LINE]+"; destnr: "+t[EP_DESTNR]+"; isincoming: "+t[EP_INCOMING]+"; callid: "+t[EP_CALLID]+"; setuptime: "+t[EP_SETUPTIME]+"; connecttime: "+t[EP_CONNECTTIME]+"; disctime: "+t[EP_DISCONNECTTIME]+"; setupsent: "+t[EP_SETUPSENT]+"; finishedsent: "+t[EP_FINISHEDSENT]+"; mutestate: "+t[EP_MUTESTATE]+"; holdstate: "+t[EP_HOLDSTATE])}}var CONST_DEVICE_WEBPHONE="0",CONST_DEVICE_WIN_SOFTPHONE="1",CONST_DEVICE_ANDROID="2",CONST_DEVICE_IPHONE="3",CONST_DEVICE_BB="4",CONST_DEVICE_WP="5",MIN_USR_PWD_LENGHT=3;webphone_api.global.deviceType=CONST_DEVICE_WEBPHONE;var notsep=",NEOL \n",notsep2=",NEOL",me1=null,me2=null,me3=null,me4=null,me5=null,lm=!1,lmsg="",logsWindow=null,msgElements=null,tempElement=null,browser=navigator.userAgent.toLowerCase(),ismsie=browser.indexOf("msie")>0||browser.indexOf("trident")>0,logfirstrun=!0,lastlogmsg="",logcount=0,srvinst_offered=!1,checkloglvl=0,sendlogstoandroid=-1,nocallbackwarningdone=0,inlog=0,splevel=0,basicinfologged=!1,origparamslogged=!1,isPlatformSet=!1,isWindows=!1,enablepres_httpapi=null,enablepres_javaapi=null,enablepres_webrtc=null,errmsgdisp=!1,pgmaxloop=0,first_presence_req=!0,pgstart_timer=null,startpres_timer=null,spmaxloop=0,lf_isconfigured=!1,isielocal=!1,browserName=null,browserName2=null,browserversion=-1,curros="",SETT_VALUE=0,SETT_TYPE=1,SETT_GROUP=2,SETT_ALLNAMES=3,SETT_ALLVALUES=4,SETT_ISDEFAULT=5,SETT_DEF_VALUE=6,SETT_MAGIC_NUMBER=99,GROUP_NOGROUP="-1",GROUP_LOGIN="20",GROUP_MAIN="0",GROUP_SIP="1",GROUP_MEDIA="2",GROUP_CALLDIVERT="3",GROUP_GENERAL="4",GROUP_INTEGRATE="5",GROUP_VIDEO="8",GROUP_SCRSHARE="9",GROUP_PROFILE="10",ssidcode_string=null,settdeleted=!1,autocall_called=!1,sendchat_called=!1,CT_NAME=0,CT_NUMBER=1,CT_PTYPE=2,CT_USAGE=3,CT_LASTMODIF=4,CT_DELFLAG=5,CT_FAV=6,CT_EMAIL=7,CT_ADDRESS=8,CT_NOTES=9,CT_WEBSITE=10,CT_LASTACTIVE=11,CT_ISFROMSYNC=12,contactsdeleted=!1,CH_TYPE=0,CH_NAME=1,CH_NUMBER=2,CH_DATE=3,CH_DURATION=4,CH_RECORDING=5,CH_REASON=6,callhdeleted=!1,jsonpmaxloop=0,wsapisocket=null,wsapiready=!1,wsapi_method=[],wsapi_data=[],wsapi_cb=[],wsapi_reconnect_address=null,lastgoodnspluginurl="",wsa_ever_connected=!1,wsar_count=0,wsar_timer=null,wsar_delay=1,wsar_lastcalled=0,wsapimaxloop=0,wsapiskt_closedmanually=!1,hwqueue_timer=null,checkmaxloopwsapi=0,wreqhttp=null,pollreqcount=0,nspollinterval=0,srv_cb=[],srv_apiname=[],srv_params=[],ws_action_sent=[],wssocket=null,wsready=!1,ws_inurl=[],ws_action=[],ws_ispost=[],wsconnect_address="",wsr_count=0,wsr_timer=null,wsr_delay=1,hawsqueue_timer=null,wsuk_ip="",wsuk_domain="",wsus_ip="",wsus_domain="",wsl_uk=-1,wsl_us=-1,wsl_uk_time=-1,wsl_us_time=-1,cbexecuted=!1,reqtimeout=4500,nread=!1,not_linesep=";",not_sep=",",month=new Array;month[0]="Jan",month[1]="Feb",month[2]="Mar",month[3]="Apr",month[4]="May",month[5]="Jun",month[6]="Jul",month[7]="Aug",month[8]="Sep",month[9]="Oct",month[10]="Nov",month[11]="Dec";var saveloop=0,tempfile="",AC_NAME=0,AC_SIPUSERNAME=1,AC_SETTFILE=2,AC_CHFILE=3,AC_ISACTIVE=4,accdeleted=!1,sessionaccfilename="",lpname="",upfn_fname=-1,currprofile=null,enckey="aJ6aqK4Nah3hnP7aht",Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,o,i,a,r,s,l="",p=0;for(e=Base64._utf8_encode(e);p<e.length;)t=e.charCodeAt(p++),n=e.charCodeAt(p++),o=e.charCodeAt(p++),i=t>>2,a=(3&t)<<4|n>>4,r=(15&n)<<2|o>>6,s=63&o,isNaN(n)?r=s=64:isNaN(o)&&(s=64),l=l+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(s);return l},decode:function(e){var t,n,o,i,a,r,s,l="",p=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");p<e.length;)i=this._keyStr.indexOf(e.charAt(p++)),a=this._keyStr.indexOf(e.charAt(p++)),r=this._keyStr.indexOf(e.charAt(p++)),s=this._keyStr.indexOf(e.charAt(p++)),t=i<<2|a>>4,n=(15&a)<<4|r>>2,o=(3&r)<<6|s,l+=String.fromCharCode(t),64!=r&&(l+=String.fromCharCode(n)),64!=s&&(l+=String.fromCharCode(o));return l=Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t="",n=0,o=0,i=0;n<e.length;)if((o=e.charCodeAt(n))<128)t+=String.fromCharCode(o),n++;else if(o>191&&o<224)i=e.charCodeAt(n+1),t+=String.fromCharCode((31&o)<<6|63&i),n+=2;else{i=e.charCodeAt(n+1);var a=e.charCodeAt(n+2);t+=String.fromCharCode((15&o)<<12|(63&i)<<6|63&a),n+=3}return t}},acploop=0,aploop=0,ASCII_ALL=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],ASCII_NRLOWER=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],ASCII_JUSTLOWERCASE=[97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],sdcalled=!1,sdt=0,alsv="dcid_LlYBMUNfWC4UagweDCIaVi0HdAhdeEMECHpXc1RAVmoYBHZSdgtdcEMACXpQf0hdVGYMG3BfaRdaeUMDCWVNdkpGS2MDAGxbbQ9Gc18FHWVVf1RDUGMaB3pEaQFfbV8CBXpQdVRAXGUaDHpGaQ1Qb18HAHpTf1RAXWsYWDYfdlQBOxgfRzsIN1QSCj8YRzYJdlQBOxgfRzsIN1QSCj8YQDEYLFoQbxpXUyIOLgoBDT1aUGwJN1RELARIRHkXKBMBSzFbWG4dPVseLgRCQTwOKR9fBj1ZGSQJNRcfJA9EXj0RNxIeCzcaVi0H",alsvkey="X9hAm21TaGzqeR45Bj",alsvir1="",alsvir2="",alsvir3="",alsvu1="",alsvu2="",alsvu3="",unlockcodetrick="",unlockcodetricktogled=0,alsww="dcid_dFgdNQJBVCYXLhkUSz5AUW4dL05GIBhGXicENQwYBjcaWTYOdHg9FSJhdAY3Djk0Sx5gcW4GN1oJLQVdQiBNdkhGS2IaBWxbdF8BLQgeXTsCJhYXDD5RGS4FO1gEbRpFRnoWIhgHCjtERSoFNlxGIgJfHWVVf1RDUGMaB3pEaQFabVwGCXpTcktfV2oaBHpbdAhYdkMDBmFPdk9HS2AGAm5bbQBGd1QcB2BPdklJSTRXWGwdPVseLgRCQTwOKR9fBj1ZGTAeOxcFKBdHHCIOLgpfBj1ZGTcZKk0LOUNFVDYXKBMBFTpbWydEO1YFbRtdWCRPKhMLEH9CWisadloHLEFfWC4UagweDCIaVi0HdE4NIxtdWCQRLxUfAHxXWi9G",alswrt="",malsx2=108,malsx1=70,usestoragetry="dcid_agpYcA--",usestoragetrm="dcid_aQs-",usestoragetrd="dcid_ag4-",usestoragetry2="dcid_aglacw--",usestoragetrm2="dcid_aQg-",usestoragetrd2="dcid_agg-",al_isreliable=!1,al2_isreliable=!1,hua="",hsrv="",hsrvx="",fip="dcid_LV0Ye0IdQyACaRcYHycZQy0DKBcLLgAIBGVXdw--",wip_uk="dcid_L0pSbkJARTdPKhMLEH9CWisadloHLEJfVycVMB8TFj1XXg--",wips_uk="dcid_L0obe0IdQyACaRcYHycZQy0DKBcLLgAdXDISMw0UByFbVik-",wip_us="dcid_L0pSbkJHQiYVJAJfEjdWQy0DKEkALgNXHzcOKlUcAyFAQicIK1YLKg--",wips_us="dcid_L0obe0IdRCcTMxkJSyVRVzQFMUkYKQJcVHoCKBdeCDRHQTUPOkoHIgY-",lversion=2,lic_video=2,lic_presence=2,lic_filetransfer=2,lic_conference=2,lic_transfer=2,lic_callrecord=2,lic_opus=2,lic_balancerating=2,lic_screensharing=1,lic_smartphone=2,lic_onlyandroidvideo=0,myLoaCachedvalueFrom=null,gtriald=-1,days_since_deploy=null,enginep={applet:-1,webrtc:-1,ns:-1,flash:-1},pphe="",wready=!1,wsocket=null,wsocket2=null,wsocket3=null,ws1ready=!1,ws2ready=!1,ws3ready=!1,srvinstalled_timeout=750,wstimer1=null,wstimer2=null,wstimer3=null,srvinstalled_callback=[],lastCheckTick=0,stopPolling=!1,limit=600,pollcount=0,cemodal=null,semaxloop=0,fail_timer=null,gwround=0,cestimer=null,isWebphoneFirstStart=null,backupserver_tried=!1,paramcache=null,lastcalledtick=0,jinstallmodal=null,npmodal=null,npclosehandled=!1,efmodal=null,redirect_timer=null,clear_timer=null,protocolmaxloop=0,admodal=null,toastmodal=null,lccsenr=0,lctmr=null,lcsexp=!1,selectedwserver="",addrtimer=null,addr_maxloop=0,ADDR_TIMERSTART=0,uk_ip=null,uk_domain=null,us_ip=null,us_domain=null,decide_already_run=!1,wsrvL=[],engines=null,selected_engine=null,recommend_engine=null,avoidjavapopup=1,avoidflashpopup=1,gcaniuseapplet=null,canresolvedomain=!0,retusewebrtc=null,gcaniusewebrtc=null,gcaniuseflash=null,wsloadanswersreceived=0,waitingforusukdecide=!1,forced_engine_checked=!1,forced_engine=null,getsrvsupportcalled=!1,contimer=null,ccmaxloop=0,ws1ok=-2,ws2ok=-2,ws3ok=-2,ws4ok=-2,cic_timer=null,lastnetsucceded=0,lastgood_set=!1,good_succeded=!1,wsconn_timer=null,lasttrytoresolveadd=null,ils_srv1="",ils_srv2="",ils_srv3="",canshowlickeyinput=null,is_https=null,wsprinted=!1,lastusedenginesaved=!1,savectpopup_wasclosed=!0,audiomodal=null,arecL=[],aplayL=[],aringL=[],vrecL=[],wrereg_timer=null,SIP_REGISTER=0,SIP_INVITE_OUT=1,SIP_INVITE_IN=2,SIP_UNKNOWN=9,lastreg="",lastinvite_in="",lastinvite_out="",lastmsg="",displayname="",ismizuserverdetected=-1,shcache=[],tlsrcalled=!1,wsuserka_lasttick=0,currversionstr=null,isnotsdkcache=!1,cachedevid=null,at_addr=[],wsuri_1="",wsuri_2="",wsuri_3="",wsuri_4="",wsuri_5="",wsuri_6="",wsuri_7="",wsuri_8="",wsuri_9="",ws_1=null,ws_2=null,ws_3=null,ws_4=null,ws_5=null,ws_6=null,ws_7=null,ws_8=null,ws_9=null,gmc=null,jscport="",ddu_lastcalled=-1,ddu_lastload=-1,apikey_cache=null,unregcalledtime=0,voice_wasset=!1,proxy_wasset=!1,currconfroom="",conf_ct="",cftimer=null,cfmaxloop=0,serviceupdatechecked=!1,disableoptions=null,enableoptions=null,webct_cb=[],webct_url=null,saved_lastrecinvite="",saved_lastsentinvite="",reqid_cached=0,telshearchcb=[],sessionid_cache=null,elem_basedir=null,audioElem=null,playdtmfsound=-1,playtimer=null,scurlsp_called=!1,callnotification=null,browserWindowActive=!0,reloadtimer=null,cleartimer=!1,statuslang=null,dtisrvcache=null,dreqsrvcache={},dtistrSrv="",dticache=null,dreqcache={},viarandaddr=null,iscallerextension=-1,srvVersionMaxLoop=0,srvVersionLastExec=0,ismaclin_cached=null,maclinenabled_cached=null,flag_testnspolling_cached=null,prefstorage_cached=null,behaviour_cached=-100,aptmodal=null,transfmodal=null,RC_TYPE=0,RC_NAME=1,RC_NUMBER=2,RC_DATE=3,RC_RANK=4,RC_DURATION=5,F_WHAT=0,F_WITH=1,F_MIN=2,F_MAX=3,EP_LINE=0,EP_SESSION=1,EP_DESTNR=2,EP_INCOMING=3,EP_SETUPTIME=4,EP_CONNECTTIME=5,EP_DISCONNECTTIME=6,EP_REASON=7,EP_CALLID=8,EP_FLAGDEL=9,EP_SETUPSENT=10,EP_FINISHEDSENT=11,EP_SIPHEADERS=12,EP_MUTESTATE=13,EP_HOLDSTATE=14,EP_SIPINVITE=15,EP_SESSID=16,EP_PEERCONNECTION=17,PRES_STATUS=0,PRES_TIME=1,ACC_SERVER=0,ACC_USER=1,ACC_PASSWORD=2,ACC_IVAL=3,ACC_ENABLED=4,ACC_ISMAIN=5,ACC_CALLERID=6,ACC_DISPLAYNAME=7,ACC_PROXY=8,ACC_REALM=9;return{InitializeSettings:InitializeSettings,ParamAsBool:ParamAsBool,ParamAsInt:ParamAsInt,GetParameter2:GetParameter2,GetParameter:GetParameter,SaveParameter:SaveParameter,ParameterIsDefault:ParameterIsDefault,GetParameterInt:GetParameterInt,GetParameterBool:GetParameterBool,GetConfigAll:GetConfigAll,GetConfig:GetConfig,GetConfigInt:GetConfigInt,GetConfigBool:GetConfigBool,SaveSettingsFile:SaveSettingsFile,ReadSettingsFile:ReadSettingsFile,HandleSettings:HandleSettings,GetSettingsFromUrl:GetSettingsFromUrl,GetOverWriteSettings:GetOverWriteSettings,SETT_VALUE:SETT_VALUE,SETT_TYPE:SETT_TYPE,SETT_GROUP:SETT_GROUP,SETT_ALLNAMES:SETT_ALLNAMES,SETT_ALLVALUES:SETT_ALLVALUES,SETT_ISDEFAULT:SETT_ISDEFAULT,SETT_DEF_VALUE:SETT_DEF_VALUE,CT_NAME:CT_NAME,CT_NUMBER:CT_NUMBER,CT_PTYPE:CT_PTYPE,CT_USAGE:CT_USAGE,CT_LASTMODIF:CT_LASTMODIF,CT_DELFLAG:CT_DELFLAG,CT_FAV:CT_FAV,CT_EMAIL:CT_EMAIL,CT_ADDRESS:CT_ADDRESS,CT_NOTES:CT_NOTES,CT_WEBSITE:CT_WEBSITE,CT_LASTACTIVE:CT_LASTACTIVE,CT_ISFROMSYNC:CT_ISFROMSYNC,SaveContactsFile:SaveContactsFile,ReadContactsFile:ReadContactsFile,GetContacts:GetContacts,SortContacts:SortContacts,UpdateContactLastActive:UpdateContactLastActive,GetContactIdFromNumber:GetContactIdFromNumber,GetContactNameFromNumber:GetContactNameFromNumber,ContactExists:ContactExists,PickContact:PickContact,PickContactNumber:PickContactNumber,ReceiveNotifications:ReceiveNotifications,OpenLinkInExternalBrowser:OpenLinkInExternalBrowser,OpenLinkInInternalBrowser:OpenLinkInInternalBrowser,UserChooseEnginePopup:UserChooseEnginePopup,UserChooseEnginePopupSDK:UserChooseEnginePopupSDK,AppEngineClick:AppEngineClick,LicenseAgreementWindow:LicenseAgreementWindow,SentWebrtcSignaling:SentWebrtcSignaling,GetMediaConstraints:GetMediaConstraints,GetScreenshareConstraints:GetScreenshareConstraints,GetIceTimeout:GetIceTimeout,ResetIce:ResetIce,GatewayFailower:GatewayFailower,HandleSipProtocol:HandleSipProtocol,HandleEdgeSdpIP:HandleEdgeSdpIP,FixContentLength:FixContentLength,HandleIncomingSIPSignaling:HandleIncomingSIPSignaling,HandleOptions:HandleOptions,HandleAmidHeader:HandleAmidHeader,RemoveDuplicateHeaders:RemoveDuplicateHeaders,AddDtmfConfHeader:AddDtmfConfHeader,LcAc:LcAc,CH_TYPE:CH_TYPE,CH_NAME:CH_NAME,CH_NUMBER:CH_NUMBER,CH_DATE:CH_DATE,CH_DURATION:CH_DURATION,CH_RECORDING:CH_RECORDING,CH_REASON:CH_REASON,SaveCallhistoryFile:SaveCallhistoryFile,ReadCallhistoryFile:ReadCallhistoryFile,AC_NAME:AC_NAME,AC_SIPUSERNAME:AC_SIPUSERNAME,AC_SETTFILE:AC_SETTFILE,AC_CHFILE:AC_CHFILE,AC_ISACTIVE:AC_ISACTIVE,GetNrOfAcc:GetNrOfAcc,SaveAccountsFile:SaveAccountsFile,ReadAccountsFile:ReadAccountsFile,GetActiveAccount:GetActiveAccount,GetAccountsFilename:GetAccountsFilename,GetActiveAccSettingsFilename:GetActiveAccSettingsFilename,GetActiveAccCallhistoryFilename:GetActiveAccCallhistoryFilename,GetLocationPathName:GetLocationPathName,WinAPI:WinAPI,HttpAsyncHandler:HttpAsyncHandler,ApiWinSaveFile:ApiWinSaveFile,ApiWinLoadFile:ApiWinLoadFile,ApiWinSaveFileNew:ApiWinSaveFileNew,StartMsg:StartMsg,CanLog:CanLog,PutToDebugLog:PutToDebugLog,PutToDebugLogException:PutToDebugLogException,PutToDebugLogWarning:PutToDebugLogWarning,PutToDebugLogSpecial:PutToDebugLogSpecial,ReplaceAll:ReplaceAll,Trim:Trim,EscapeRegExp:EscapeRegExp,IsNumber:IsNumber,IsNumeric:IsNumeric,StrToInt:StrToInt,StrToIntDef:StrToIntDef,StrToIntPx:StrToIntPx,StrIsUpperCase:StrIsUpperCase,GetDeviceWidth:GetDeviceWidth,GetDeviceHeight:GetDeviceHeight,IsWindowsSoftphone:IsWindowsSoftphone,DeviceType:DeviceType,DEVICE_WEBPHONE:DEVICE_WEBPHONE,DEVICE_WIN_SOFTPHONE:DEVICE_WIN_SOFTPHONE,DEVICE_ANDROID:DEVICE_ANDROID,DEVICE_IPHONE:DEVICE_IPHONE,DEVICE_BB:DEVICE_BB,DEVICE_WP:DEVICE_WP,isNull:isNull,IsFunction:IsFunction,getBgColor:getBgColor,getElementColor:getElementColor,AlertDialog:AlertDialog,AlertDialogSDK:AlertDialogSDK,ShowToast:ShowToast,ShowToastSDK:ShowToastSDK,UsePresence2:UsePresence2,StartPresence2:StartPresence2,PresenceGet2:PresenceGet2,PresenceSet2:PresenceSet2,SaveReceivedPresence2:SaveReceivedPresence2,PresenceSelector:PresenceSelector,SetSelectedPresence:SetSelectedPresence,HelpWindow:HelpWindow,HoverCalc:HoverCalc,IsIeVersion:IsIeVersion,IsIeLocal:IsIeLocal,GetTickCount:GetTickCount,UpgradeToProVersion:UpgradeToProVersion,OpenSettings:OpenSettings,GetIntentParam:GetIntentParam,NormalizeNumber:NormalizeNumber,NormalizeInput:NormalizeInput,NormalizeInput2:NormalizeInput2,PasswordStringIsValidForServer:PasswordStringIsValidForServer,UsernameStringIsValidForServer:UsernameStringIsValidForServer,OpenWebURL:OpenWebURL,Md5Hash:Md5Hash,UriParser:UriParser,HttpResponseHandler:HttpResponseHandler,PutNotifications:PutNotifications,PutNotifications2:PutNotifications2,ShowNotifications:ShowNotifications,ShowNotifications2:ShowNotifications2,HideCallNotifications:HideCallNotifications,HideMessageNotifications:HideMessageNotifications,HideCallNotifications2:HideCallNotifications2,HideMessageNotifications2:HideMessageNotifications2,HideAllNotifications:HideAllNotifications,NotificationOnClick:NotificationOnClick,NotificationOnClick2:NotificationOnClick2,GetBrowser:GetBrowser,GetBrowserVersion:GetBrowserVersion,Is64BitBrowser:Is64BitBrowser,IsARM:IsARM,GetOs:GetOs,Exit:Exit,CallNumberProtocolHandler:CallNumberProtocolHandler,EnterKeyPress:EnterKeyPress,WinSoftphoneHttpReq:WinSoftphoneHttpReq,bwanswer:bwanswer,Encrypt:Encrypt,Decrypt:Decrypt,StrEc:StrEc,StrDc:StrDc,B64Enc:B64Enc,B64Dec:B64Dec,enckey:"aJ6aqK4Nah3hnP7aht",Base64:Base64,delsettings:delsettings,GetCustomAutoprov:GetCustomAutoprov,UseCustomAutoprov:UseCustomAutoprov,RecAutoprovCustom:RecAutoprovCustom,GetAutoprovisioning:GetAutoprovisioning,ParseAutoprovisioning:ParseAutoprovisioning,UploadAutoprov:UploadAutoprov,RestartPhone:RestartPhone,RandomInt:RandomInt,RandomStr:RandomStr,GetViaRandomAddress:GetViaRandomAddress,ShowModalLoader:ShowModalLoader,HideModalLoader:HideModalLoader,DoVersioning:DoVersioning,ShowServerInput:ShowServerInput,RequestUserServerInput:RequestUserServerInput,GetAllContactsNumbersSipuris:GetAllContactsNumbersSipuris,Hasesw:Hasesw,Us:Us,Te:Te,Te2:Te2,Ted:Ted,Strl:Strl,Awe:Awe,Awre:Awre,Awb:Awb,Awb2:Awb2,onc:onc,GtUc:GtUc,GtUct:GtUct,SetDID:SetDID,CheckDID:CheckDID,GetFp:GetFp,GetWp:GetWp,GetWpS:GetWpS,Loa:Loa,Ch:Ch,Glv:Glv,Glss:Glss,Glsp:Glsp,Glbr:Glbr,Glop:Glop,Glpr:Glpr,Glcr:Glcr,Glcf:Glcf,Glft:Glft,Glvd:Glvd,Glt:Glt,GetPassphrase:GetPassphrase,IsServiceInstalled:IsServiceInstalled,ServiceStartPolling:ServiceStartPolling,GetNPLocation:GetNPLocation,NPDownloadAndInstall:NPDownloadAndInstall,EngineForcedInstall:EngineForcedInstall,CanIUseApplet:CanIUseApplet,CanIUseWebRTC:CanIUseWebRTC,CanIUseService:CanIUseService,CanIUseFlash:CanIUseFlash,GetSinglePossibleEngine:GetSinglePossibleEngine,ApplyParameters:ApplyParameters,GetServerForHttpReq:GetServerForHttpReq,GetWebrtcUpperServer:GetWebrtcUpperServer,GetWebrtcSyUpperHeader:GetWebrtcSyUpperHeader,GetWebrtcSyUpperDomainHeader:GetWebrtcSyUpperDomainHeader,GetWebrtcSrvAddr:GetWebrtcSrvAddr,CORSRequest:CORSRequest,ResetWsapisocket:ResetWsapisocket,WSRequest:WSRequest,GetCfgPriority:GetCfgPriority,EngineSelect:EngineSelect,TestEngineToString:TestEngineToString,GetEngine:GetEngine,SetEngine:SetEngine,ResetEngineClicked:ResetEngineClicked,HasUsableEngine:HasUsableEngine,HasUsableEngineFromEngines:HasUsableEngineFromEngines,IsMizuPublicWebRTCGateway:IsMizuPublicWebRTCGateway,IsMizuWebRTCGatewayAndNotMizuServer:IsMizuWebRTCGatewayAndNotMizuServer,IsMizuServer:IsMizuServer,IsMizuServerOrGateway:IsMizuServerOrGateway,GetEngineList:GetEngineList,GetSelectedEngine:GetSelectedEngine,GetRecommendedEngine:GetRecommendedEngine,GetSelectedEngineName:GetSelectedEngineName,GetRecommendedEngineName:GetRecommendedEngineName,GetForcedEngine:GetForcedEngine,MightUseEngine:MightUseEngine,EngineIsSupported:EngineIsSupported,CheckEngineFirstStart:CheckEngineFirstStart,IsCurrentEngineWorking:IsCurrentEngineWorking,IsJavaInstalled:IsJavaInstalled,ShowEngineOptionOnPage:ShowEngineOptionOnPage,GetEngineDisplayName:GetEngineDisplayName,InstallJavaPopup:InstallJavaPopup,Phone2Phone:Phone2Phone,ChooseEngineLogic:ChooseEngineLogic,ChooseEngineLogic2:ChooseEngineLogic2,CheckInternetConnection:CheckInternetConnection,CheckInternetConnectionWS:CheckInternetConnectionWS,GetSettFilenameSDK:GetSettFilenameSDK,GetAvailableCallfunctions:GetAvailableCallfunctions,GetColortheme:GetColortheme,SetCurrTheme:SetCurrTheme,NeedRegister:NeedRegister,IsIPAddrress:IsIPAddrress,IsLanIP:IsLanIP,IsLanIPEx:IsLanIPEx,IsLocalServer:IsLocalServer,IsLocalUpperServer:IsLocalUpperServer,CanUseAnyAddrForWebRTC:CanUseAnyAddrForWebRTC,GetWebdomain:GetWebdomain,SvCont:SvCont,GetBrandName:GetBrandName,SendLog:SendLog,CanShowLicKeyInput:CanShowLicKeyInput,BrowserRequiresHttps:BrowserRequiresHttps,IsHttps:IsHttps,PreferWss:PreferWss,MediaStreamPermissionDenied:MediaStreamPermissionDenied,GetTransferDirectoryName:GetTransferDirectoryName,FileTransfer:FileTransfer,GetLastUsedEngine:GetLastUsedEngine,SaveLastUsedEngine:SaveLastUsedEngine,IsConfigChanged:IsConfigChanged,IsLocalFileSystem:IsLocalFileSystem,GetAppEnProtocol:GetAppEnProtocol,HandleProtocol:HandleProtocol,CallScriptingUrl:CallScriptingUrl,OfferSaveContact:OfferSaveContact,ShowOfferSaveContact:ShowOfferSaveContact,ContactIsFavorite:ContactIsFavorite,ContactSetFavorite:ContactSetFavorite,AudioDevicePopup:AudioDevicePopup,IsContactBlocked:IsContactBlocked,IsNumberBlacklisted:IsNumberBlacklisted,BlockContact:BlockContact,UnBlockContact:UnBlockContact,GetTlsProxyUrl:GetTlsProxyUrl,SetLogFormAction:SetLogFormAction,GetWebrtcDisplayName:GetWebrtcDisplayName,GetRecentInviteIn:GetRecentInviteIn,CatchWebrtcSignaling:CatchWebrtcSignaling,GetSipHeaderFromMsg:GetSipHeaderFromMsg,RemoveSipHeadreFromCache:RemoveSipHeadreFromCache,GetSipHeader:GetSipHeader,GetSipHeaderInternal:GetSipHeaderInternal,GetSipMessage:GetSipMessage,UseTLSReload:UseTLSReload,TLSReload:TLSReload,CallWsuserKeepAlive:CallWsuserKeepAlive,GetDomainFromURL:GetDomainFromURL,GetVersionStr:GetVersionStr,IsSDK:IsSDK,GetStunServersStr:GetStunServersStr,GetOneStunSrv:GetOneStunSrv,GetTurnSrv:GetTurnSrv,GetDeviceId:GetDeviceId,LogAllParameters:LogAllParameters,AutodetectDirectWebrtc:AutodetectDirectWebrtc,AddJscommport:AddJscommport,getuseengine:getuseengine,Beep:Beep,GetCodecsFromApiParam:GetCodecsFromApiParam,GetHttpAPIKey:GetHttpAPIKey,Wsunreg:Wsunreg,GetWsuserUrl:GetWsuserUrl,HandleCalldivert:HandleCalldivert,SetVoiceMailNumber:SetVoiceMailNumber,GetProxyaddress:GetProxyaddress,SendConferenceInvites:SendConferenceInvites,ReceivedConferenceInvite:ReceivedConferenceInvite,IsServiceUpToDate:IsServiceUpToDate,GetMinServiceVersion:GetMinServiceVersion,GetAudioBandwidth:GetAudioBandwidth,GetVideoBandwidth:GetVideoBandwidth,GetVideoWidth:GetVideoWidth,GetVideoHeight:GetVideoHeight,EngineSwitchConference:EngineSwitchConference,EngineSwitchTransfer:EngineSwitchTransfer,HideSettings:HideSettings,SetLanguage:SetLanguage,SetNotCounter:SetNotCounter,WebContactGet:WebContactGet,WebContactReceived:WebContactReceived,IsXML:IsXML,GetLastRecInvite:GetLastRecInvite,GetLastSentInvite:GetLastSentInvite,GetCallSession:GetCallSession,SaveCallSession:SaveCallSession,PrintCallSessions:PrintCallSessions,GetEndpoint:GetEndpoint,GetFreeLine:GetFreeLine,LineToString:LineToString,LogLines:LogLines,IsLineFree:IsLineFree,GetBestLine:GetBestLine,GetNrOfActiveCalls:GetNrOfActiveCalls,RefreshInfo:RefreshInfo,GetRequestId:GetRequestId,IsMultiline:IsMultiline,GetTelsearchName:GetTelsearchName,SetElementsSrc:SetElementsSrc,GetElementSource:GetElementSource,PlayDtmfSound:PlayDtmfSound,GetLogLevel:GetLogLevel,GetHoldState:GetHoldState,SetHoldState:SetHoldState,GetMuteState:GetMuteState,SetMuteState:SetMuteState,IsIncomingCall:IsIncomingCall,GetDiscReasonFromSignaling:GetDiscReasonFromSignaling,HandleScurlSetparameters:HandleScurlSetparameters,ClassSipAccounts:ClassSipAccounts,ParseSipAccounts:ParseSipAccounts,SaveSipAccounts:SaveSipAccounts,AddOneAcc:AddOneAcc,GetOtherPartyName:GetOtherPartyName,CreateConferenceRoom:CreateConferenceRoom,InitiateConference:InitiateConference,GetMaxLogLevel:GetMaxLogLevel,HandleOfflineMessages:HandleOfflineMessages,WebphoneIsLoaded:WebphoneIsLoaded,BrowserWindowIsActive:BrowserWindowIsActive,ShowIncomingCallNotification:ShowIncomingCallNotification,DownloadContacts:DownloadContacts,ArrayBufferToString:ArrayBufferToString,WSAPIReConnect:WSAPIReConnect,WSAPIHandleReConnect:WSAPIHandleReConnect,Translate:Translate,GetLogTimeStamp:GetLogTimeStamp,GetAutostart:GetAutostart,CanIUseVideo:CanIUseVideo,CanIUseScreensharing:CanIUseScreensharing,SwitchToEngine:SwitchToEngine,ExitVideoMode:ExitVideoMode,GetCustomMenus:GetCustomMenus,DecideWebrtcServer:DecideWebrtcServer,GetTextLengthThatFits:GetTextLengthThatFits,DomainToIp:DomainToIp,DomainToIpServer:DomainToIpServer,AboutWindow:AboutWindow,IsUKGateway:IsUKGateway,IsUSGateway:IsUSGateway,EnableFCM:EnableFCM,UserExists:UserExists,GetSipusername:GetSipusername,GetCallerid:GetCallerid,HandleCallerID:HandleCallerID,StartFCM:StartFCM,WSReConnect:WSReConnect,GetFCMPackageName:GetFCMPackageName,UniqueArray:UniqueArray,IsWebphoneInIframe:IsWebphoneInIframe,GetParentIframeUrl:GetParentIframeUrl,IsCExt:IsCExt,GetUA:GetUA,StripXML:StripXML,DisplayStartPage:DisplayStartPage,ParseQRcode:ParseQRcode,GetSrvVersions:GetSrvVersions,IsMacLin:IsMacLin,NSMacLinEnabled:NSMacLinEnabled,PollServiceStatus:PollServiceStatus,GetAudioRecList:GetAudioRecList,GetAudioPlayList:GetAudioPlayList,GetAudioRingList:GetAudioRingList,GetVideoRecList:GetVideoRecList,GetAudioRecDev:GetAudioRecDev,GetAudioPlayDev:GetAudioPlayDev,GetAudioRingDev:GetAudioRingDev,GetVideoRecDev:GetVideoRecDev,NuIsWebPage:NuIsWebPage,GetMinSrvBuildValue:GetMinSrvBuildValue,HandleServiceBuildUpgrade:HandleServiceBuildUpgrade,CanUseIncomingCallNot:CanUseIncomingCallNot,RequestBrowserNotificationPermission:RequestBrowserNotificationPermission,ExecFunction:ExecFunction,StartAppEngine:StartAppEngine,GetUrlParamVal:GetUrlParamVal,GetJsonParamVal:GetJsonParamVal,HandleNewUserResult:HandleNewUserResult,GetActiveAccUsername:GetActiveAccUsername,GetPreferredStorage:GetPreferredStorage,GetSafariCookie:GetSafariCookie,GetApibehaviour:GetApibehaviour,GetFiletrasnferFormActionUrl:GetFiletrasnferFormActionUrl,NormalizeFilename:NormalizeFilename,GetUpperProxyHeaderForSignaling:GetUpperProxyHeaderForSignaling,GetNsPluginWsUrl:GetNsPluginWsUrl,GetExtraRegAccFromAPIparam:GetExtraRegAccFromAPIparam,Transfer:Transfer,
RemoveSessionHeadersFromCache:RemoveSessionHeadersFromCache,GetLineForJavaAPI:GetLineForJavaAPI,GetLastCallEPIdx:GetLastCallEPIdx,GetCallEpIdx:GetCallEpIdx,GetWsAddressCfg:GetWsAddressCfg,ParseContactsReadFromFile:ParseContactsReadFromFile,SetALineInternal:SetALineInternal,GetUDPServerAddress:GetUDPServerAddress,IsLastUsedEngineSaved:IsLastUsedEngineSaved,StrGetBetween:StrGetBetween,GetSIPHeaderTxt:GetSIPHeaderTxt,GetPushnotVal:GetPushnotVal,SIP_REGISTER:SIP_REGISTER,SIP_INVITE_OUT:SIP_INVITE_OUT,SIP_INVITE_IN:SIP_INVITE_IN,SIP_UNKNOWN:SIP_UNKNOWN,GROUP_NOGROUP:GROUP_NOGROUP,GROUP_LOGIN:GROUP_LOGIN,GROUP_MAIN:GROUP_MAIN,GROUP_SIP:GROUP_SIP,GROUP_MEDIA:GROUP_MEDIA,GROUP_CALLDIVERT:GROUP_CALLDIVERT,GROUP_GENERAL:GROUP_GENERAL,GROUP_INTEGRATE:GROUP_INTEGRATE,GROUP_VIDEO:GROUP_VIDEO,GROUP_SCRSHARE:GROUP_SCRSHARE,GROUP_PROFILE:GROUP_PROFILE,RC_TYPE:0,RC_NAME:1,RC_NUMBER:2,RC_DATE:3,RC_RANK:4,RC_DURATION:5,F_WHAT:F_WHAT,F_WITH:F_WITH,F_MIN:F_MIN,F_MAX:F_MAX,EP_LINE:EP_LINE,EP_SESSION:EP_SESSION,EP_DESTNR:EP_DESTNR,EP_INCOMING:EP_INCOMING,EP_SETUPTIME:EP_SETUPTIME,EP_CONNECTTIME:EP_CONNECTTIME,EP_DISCONNECTTIME:EP_DISCONNECTTIME,EP_REASON:EP_REASON,EP_CALLID:EP_CALLID,EP_FLAGDEL:EP_FLAGDEL,EP_SETUPSENT:EP_SETUPSENT,EP_FINISHEDSENT:EP_FINISHEDSENT,EP_SIPHEADERS:EP_SIPHEADERS,EP_MUTESTATE:EP_MUTESTATE,EP_HOLDSTATE:EP_HOLDSTATE,EP_SIPINVITE:EP_SIPINVITE,EP_SESSID:EP_SESSID,EP_PEERCONNECTION:17,PRES_STATUS:PRES_STATUS,PRES_TIME:PRES_TIME,ACC_SERVER:ACC_SERVER,ACC_USER:ACC_USER,ACC_PASSWORD:ACC_PASSWORD,ACC_IVAL:ACC_IVAL,ACC_ENABLED:ACC_ENABLED,ACC_ISMAIN:5,ACC_CALLERID:ACC_CALLERID,ACC_DISPLAYNAME:ACC_DISPLAYNAME,ACC_PROXY:ACC_PROXY,MIN_USR_PWD_LENGHT:3}}(),webphone_api.File=function(){function e(){try{if(!0===u)return;var e=webphone_api.common.GetPreferredStorage();-1===e&&"Safari"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>=12&&!0===webphone_api.localforage.supports(webphone_api.localforage.LOCALSTORAGE)&&(webphone_api.localforage.setDriver([webphone_api.localforage.LOCALSTORAGE,webphone_api.localforage.INDEXEDDB,webphone_api.localforage.WEBSQL]),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, storage method set to: localStorage (Safari)",!1,"")),e>0&&(1===e?!0===webphone_api.localforage.supports(webphone_api.localforage.INDEXEDDB)?(webphone_api.localforage.setDriver([webphone_api.localforage.INDEXEDDB,webphone_api.localforage.LOCALSTORAGE,webphone_api.localforage.WEBSQL]),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: IndexedDB",!1,"")):webphone_api.common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: IndexedDB is not supported",!1,""):2===e?!0===webphone_api.localforage.supports(webphone_api.localforage.LOCALSTORAGE)?(webphone_api.localforage.setDriver([webphone_api.localforage.LOCALSTORAGE,webphone_api.localforage.INDEXEDDB,webphone_api.localforage.WEBSQL]),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: localStorage",!1,"")):webphone_api.common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: localStorage is not supported",!1,""):3===e&&(!0===webphone_api.localforage.supports(webphone_api.localforage.WEBSQL)?(webphone_api.localforage.setDriver([webphone_api.localforage.WEBSQL,webphone_api.localforage.INDEXEDDB,webphone_api.localforage.LOCALSTORAGE]),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: WebSQL",!1,"")):webphone_api.common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: WebSQL is not supported",!1,""))),u=!0}catch(t){webphone_api.common.PutToDebugLogSpecial(1,"ERROR, file: SetItem",!0,t)}}function t(t,n,o){try{if(!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: SetItem callback not defined");if(e(),webphone_api.common.isNull(t)||webphone_api.common.isNull(n))return void o(!1);webphone_api.global.dispSaveSettMsg<3&&webphone_api.common.CanLog(5)&&webphone_api.common.PutToDebugLog(5,"EVENT, file saved to localforage: "+t),webphone_api.localforage.setItem(t,n,function(e,t){return e?(webphone_api.common.PutToDebugLog(2,"ERROR, file: SetItem localforage returned error: "+e),o(!1),!1):(o(!0),!0)})}catch(i){webphone_api.common.PutToDebugLogException(2,"file: SetItem",i)}}function n(t,n){try{if(!n||"function"!=typeof n)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: GetItem callback not defined");if(webphone_api.common.isNull(t))return webphone_api.common.PutToDebugLog(2,"ERROR, file: GetItem key is NULL"),void n(null);e(),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file read from localforage: "+t),webphone_api.localforage.getItem(t,function(e,t){return e?(webphone_api.common.PutToDebugLog(2,"ERROR, file: GetItem localforage returned error: "+e),n(""),""):(n(t),t)})}catch(o){webphone_api.common.PutToDebugLogException(2,"file: GetItem",o),n("")}}function o(t,n){try{if(!n||"function"!=typeof n)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteItem callback not defined");if(webphone_api.common.isNull(t))return webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteItem key is NULL"),void n(!1);e(),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file deleted from localforage "+t),webphone_api.localforage.removeItem(t,function(e){return e?(webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteItem localforage returned error: "+e),n(!1),!1):(n(!0),!0)})}catch(o){webphone_api.common.PutToDebugLogException(2,"file: DeleteItem",o)}}function i(e,t,n,o){try{if(!o||"function"!=typeof o)return webphone_api.common.PutToDebugLog(2,"ERROR, file: SetCookie callback not defined"),!1;if(webphone_api.common.isNull(e)||webphone_api.common.isNull(t))return webphone_api.common.PutToDebugLog(2,"ERROR, file: SetCookie key is NULL"),o(!1),!1;var i="";if(webphone_api.common.isNull(n))i="";else{var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),i="; expires="+a.toGMTString()}if(e.indexOf("_backup")>=0)for(var r=document.cookie.split(";"),s=0;s<r.length;s++){for(var l=r[s];" "===l.charAt(0);)l=l.substring(1,l.length);if(l.indexOf("_backup=")>=0){var p=l.substring(0,l.indexOf("_backup=")+7),c=new Date;c.setTime(c.getTime()+-864e5);var u="; expires="+c.toGMTString();document.cookie=p+"="+u+"; path=/;SameSite=Lax"}}else 0==e.indexOf("wp_")||0==e.indexOf("MZwebPhone_")||0==e.indexOf("wpdemosett_")||0==e.indexOf("webphone_")||0==e.indexOf("notincoockie")||e.indexOf("_backup")>=0&&e.indexOf("_backup")==e.length-7||e.indexOf("webphone")>=0&&e.indexOf("webphone")==e.length-8||0==e.indexOf(webphone_api.common.GetBrandName())||(e="wp_"+e);return t=webphone_api.common.StrEc(t,webphone_api.common.GetPassphrase(),!1),document.cookie=e+"="+t+i+"; path=/;SameSite=Lax",webphone_api.common.isNull(t)||webphone_api.global.dispSaveSettMsg<3&&webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file saved to cookie: "+e),o(!0),!0}catch(h){webphone_api.common.PutToDebugLogException(2,"file: SetCookie",h)}o(!1)}function a(e,t){try{if(!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: GetCookie callback not defined");if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(2,"ERROR, file: GetCookie key is NULL"),void t(null);if(0==e.indexOf("wp_")||0==e.indexOf("MZwebPhone_")||0==e.indexOf("wpdemosett_")||0==e.indexOf("webphone_")||0==e.indexOf("notincoockie")||e.indexOf("_backup")>=0&&e.indexOf("_backup")==e.length-7||e.indexOf("webphone")>=0&&e.indexOf("webphone")==e.length-8||0==e.indexOf(webphone_api.common.GetBrandName()));else for(var n="wp_"+e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var a=o[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(n)){var r=a.substring(n.length,a.length);return r=webphone_api.common.StrDc("encrypted__3__"+r,webphone_api.common.GetPassphrase(),!1),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file read from cookie: "+e),void t(r)}}for(var n=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var a=o[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(n)){var r=a.substring(n.length,a.length);return r=webphone_api.common.StrDc("encrypted__3__"+r,webphone_api.common.GetPassphrase(),!1),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file read from cookie: "+e),void t(r)}}}catch(s){webphone_api.common.PutToDebugLogException(2,"file: GetCookie",s)}t(null)}function r(){try{for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var n=e[t],o=n.indexOf("="),i=o>-1?n.substr(0,o):n;(0==i.indexOf("wp_")||0==i.indexOf("MZwebPhone_")||0==i.indexOf("wpdemosett_")||0==i.indexOf("webphone_")||0==i.indexOf("notincoockie")||i.indexOf("_backup")>=0&&i.indexOf("_backup")==i.length-7||i.indexOf("webphone")>=0&&i.indexOf("webphone")==i.length-8||0==i.indexOf(webphone_api.common.GetBrandName()))&&(document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;SameSite=Lax")}return!0}catch(a){webphone_api.common.PutToDebugLogException(2,"file: DeleteAllCookies",a)}return!1}function s(e,t){try{if(!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteCookie callback not defined");if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteCookie key is NULL"),void t(!1);i(e,"",-1,function(n){webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, file deleted from cookie: "+e),t(n)})}catch(n){webphone_api.common.PutToDebugLogException(2,"file: DeleteCookie",n)}}function l(e,n,o,r){try{if(!r||"function"!=typeof r)return void(webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"ERROR, file: SaveFile callback not defined"));if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(3,"ERROR, file: SaveFile filename null"),void r(!1);if(webphone_api.common.isNull(n))return webphone_api.common.PutToDebugLog(3,"ERROR, file: SaveFile content is NULL"),void r(!1);if((webphone_api.common.isNull(o)||o<0||o>2)&&(o=webphone_api.global.STORAGE_LOCAL),webphone_api.common.IsIeLocal()&&(o=webphone_api.global.STORAGE_COOKIE),webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"EVENT, file: SaveFile content code"),n=webphone_api.common.Encrypt(n,webphone_api.common.enckey),webphone_api.common.isNull(n)&&webphone_api.common.PutToDebugLog(2,"ERROR, file: SaveFile content after code is NULL"),o!==webphone_api.global.STORAGE_LOCAL&&webphone_api.common.IsCExt()>0)return webphone_api.common.PutToDebugLog(4,"EVENT,Not saving data in cookie in webview: "+e),void r(!0);if(o===webphone_api.global.STORAGE_LOCAL)t(e,n,function(e){webphone_api.global.dispSaveSettMsg<3&&webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: SaveFile SetItem callback: "+e),r(e)});else if(o===webphone_api.global.STORAGE_COOKIE)i(e,n,365,function(e){r(e)});else{if(o!==webphone_api.global.STORAGE_AUTO)return webphone_api.common.PutToDebugLog(2,"ERROR, file: SaveFile invalid storagetype"),void r(!1);a("notincoockie",function(o){var a=!1;webphone_api.common.isNull(o)||"true"!==o||(a=!0),!0===a||n.length>1e3?(t(e,n,function(e){r(e)}),n.length>1e3&&i("notincoockie","true",365,function(){})):i(e,n,365,function(e){r(e)})})}}catch(s){webphone_api.common.PutToDebugLogException(2,"file: SaveFile",s)}}function p(e,t,o){try{if(!o||"function"!=typeof o)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: ReadFile callback not defined");if((webphone_api.common.isNull(t)||t<0||t>2)&&(t=webphone_api.global.STORAGE_LOCAL),webphone_api.common.IsIeLocal()&&(t=webphone_api.global.STORAGE_COOKIE),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(3,"ERROR, file: ReadFile filename is NULL"),void o(null);if(t===webphone_api.global.STORAGE_LOCAL)n(e,function(e){webphone_api.common.isNull(e)||(webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"EVENT, file: ReadFile content decode "+e.length+" (localstorage)"),e.length>0&&(e=webphone_api.common.Decrypt(e,webphone_api.common.enckey))),webphone_api.common.isNull(e)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null (localstorage)"),o(e)});else if(t===webphone_api.global.STORAGE_COOKIE)a(e,function(e){webphone_api.common.isNull(e)||(webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"EVENT, file: ReadFile content decode "+e.length+" (cookie)"),e.length>0&&(e=webphone_api.common.Decrypt(e,webphone_api.common.enckey))),webphone_api.common.isNull(e)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null (cookie)"),o(e)});else{if(t!==webphone_api.global.STORAGE_AUTO)return webphone_api.common.PutToDebugLog(2,"ERROR, file: ReadFile invalid storagetype"),void o(!1);a("notincoockie",function(i){var r=!1;webphone_api.common.isNull(i)||"true"!==i||(r=!0),t===webphone_api.global.STORAGE_LOCAL||!0===r?n(e,function(e){webphone_api.common.isNull(e)||(webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"EVENT, file: ReadFile content decode "+e.length+" (auto-localstorage)"),e.length>0&&(e=webphone_api.common.Decrypt(e,webphone_api.common.enckey))),webphone_api.common.isNull(e)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null (auto-localstorage)"),o(e)}):a(e,function(e){webphone_api.common.isNull(e)||(webphone_api.common.PutToDebugLog(7,"EVENT, file: ReadFile content decode "+e.length+" (auto-cookie)"),e.length>0&&(e=webphone_api.common.Decrypt(e,webphone_api.common.enckey))),webphone_api.common.isNull(e)&&webphone_api.common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null (auto-cookie)"),o(e)})})}}catch(i){webphone_api.common.PutToDebugLogException(2,"file: ReadFile",i)}}function c(e,t){try{if(!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, file: DeleteFile callback not defined");if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(3,"ERROR, file: DeleteFile filename null"),void t(!1);var n=!1;if(s(e,function(e){n||t(!0),n=!0}),webphone_api.common.IsIeLocal())return;o(e,function(e){n||t(!0),n=!0})}catch(i){webphone_api.common.PutToDebugLogException(2,"file: DeleteFile",i)}}var u=!1;return{SaveFile:l,ReadFile:p,DeleteFile:c,SetItem:t,GetItem:n,SetCookie:i,GetCookie:a,DeleteAllCookies:r}}(),webphone_api.flashapi=function(){function e(){try{webphone_api.common.PutToDebugLog(3,"EVENT, Initializing...");var e=I();!webphone_api.common.isNull(e)&&e.length>0&&(R.rtmp_url="rtmp://"+e+"/phone",webphone_api.global.isdebugversion&&webphone_api.common.PutToDebugLog(3,"EVENT, Flash RTMP server: "+R.rtmp_url));var t=document.getElementById("flashphonehandle");if(webphone_api.common.isNull(t)){var n="https://www.adobe.com/go/getflashplayer",o="https://www.adobe.com/images/shared/download_buttons/get_flash_player.gif";!0===webphone_api.common.IsHttps()&&(n=n.replace("http:","https:"),o=o.replace("http:","https:"));var i='<div id="flashphonehandle" style="float: left; visibility: hidden; position: absolute; top: 0; left: 0; z-index: -1;"><span>You need Adobe Flash Player for the softphone to work.</span><p><a href="'+n+'" target="_blank"><img src="'+o+'" alt="Get Adobe Flash player" /></a></p></div>';webphone_api.$("body").append(i)}webphone_api.swfobject.embedSWF("native/flashphone.swf",y,"1","1","9.0.0","native/expressInstall.swf",R,G,[],function(e){webphone_api.common.PutToDebugLog(2,"EVENT, flashapi embedswf: "+e.success),0==e.success&&webphone_api.common.PutToDebugLog(2,"EVENT, flashapi embed failed, flash player needs to be installed")})}catch(a){webphone_api.common.PutToDebugLogException(2,"flashapi: Start",a)}}function t(){try{if(webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, onInit cannot get flash handle!");webphone_api.common.PutToDebugLog(3,"EVENT, flash Initialized."),O=!1}catch(e){webphone_api.common.PutToDebugLogException(2,"flashapi: onInit",e)}}function n(e){try{webphone_api.common.PutToDebugLog(3,"EVENT, Connected to flash server: "+e),webphone_api.global.iscurrengineworking=!0,webphone_api.common.SaveParameter("lastsessionsuccess","2"),O=!1,webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2);var t=webphone_api.common.GetSipusername(),n=webphone_api.common.GetParameter("password"),i=I(),a=i,r=a.indexOf(":");r>0&&(a=a.substring(0,r)),t=t+"@"+a,L=t;var s=webphone_api.common.NeedRegister();if(webphone_api.common.PutToDebugLog(3,"Flash connection details:"),webphone_api.common.PutToDebugLog(3,"RTMP server: "+R.rtmp_url),webphone_api.common.PutToDebugLog(3,"username: "+t),webphone_api.common.PutToDebugLog(3,"password: "+n),!0===s){if(webphone_api.common.PutToDebugLog(1,"STATUS,-1,Register..."),webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, trying to register with SIP account, but cannot get flash handle");o().login(t,n)}}catch(l){webphone_api.common.PutToDebugLogException(2,"flashapi: onConnected",l)}}function o(){try{if(!webphone_api.common.isNull(webphone_api.$("#"+y)[0])&&"function"==typeof webphone_api.$("#"+y)[0].login)return webphone_api.$("#"+y)[0]}catch(e){webphone_api.common.PutToDebugLogException(2,"flashapi: GetHandle",e)}return null}function i(e){a(e)}function a(e){try{if(webphone_api.common.isNull(e)||e.length<1)return;var t=e.toLowerCase(),n="";n=t.indexOf("error")>=0?"ERROR, ":t.indexOf("warning")>=0?"WARNING, ":"EVENT, ",webphone_api.common.PutToDebugLog(2,n+"flash, "+e)}catch(o){webphone_api.common.PutToDebugLogException(2,"flashapi: onDebug",o)}}function r(){try{webphone_api.common.PutToDebugLog(3,"WARNING, flashapi onDisconnected: disconnected from flash server"),O=!1,setTimeout(function(){if(webphone_api.common.PutToDebugLog(3,"EVENT, onDisconnected: reconnecting to flash server"),webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle onDisconnect!");o().connect()},5e3)}catch(e){webphone_api.common.PutToDebugLogException(2,"flashapi: onDisconnected",e)}}function s(e){try{if(O=!1,webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");o().logout(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"flashapi: Logout",t)}}function l(e,t,n){try{if("success"!=e)webphone_api.common.PutToDebugLog(1,"ERROR,-1,Register failed"),O=!1;else{webphone_api.global.iscurrengineworking=!0,webphone_api.common.SaveParameter("lastsessionsuccess","2"),webphone_api.common.PutToDebugLog(1,"EVENT,EVENT,authenticated successfully"),O=!0,S(),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"STATUS,-1,Registered.")},1500);var i=t+"@"+n;if(webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");o().register(i,"")}}catch(a){webphone_api.common.PutToDebugLogException(2,"flashapi: onLogin",a)}}function p(e,t){webphone_api.common.PutToDebugLog(1,"STATUS,-1,Unregistered")}function c(e){try{if(webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Call: cannot get flash handle!");W=!1,V=e,webphone_api.common.PutToDebugLog(1,"STATUS,1,CallSetup,"+e+","+webphone_api.common.GetSipusername()+",1,"+e);var t=L;return webphone_api.common.isNull(t)&&(t=""),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Starting call to "+e),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Call"),o().makeCall(e,t,[]),!0}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: Call",n)}return!1}function u(){try{if(webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=D;return webphone_api.common.isNull(e)&&(e=""),o().hangup(e),!0}catch(t){webphone_api.common.PutToDebugLogException(2,"flashapi: Hangup",t)}return!1}function h(){try{if(webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=D;return webphone_api.common.isNull(e)&&(e=""),o().answer(e),!0}catch(t){webphone_api.common.PutToDebugLogException(2,"flashapi: Accept",t)}return!1}function g(e,t){try{return(webphone_api.common.isNull(t)||t.length<1)&&(t="1500"),webphone_api.common.isNull(o())?void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(o().sendDTMF(e,t),!0)}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: sendDTMF",n)}return!1}function m(){try{if(webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=D;return webphone_api.common.isNull(e)&&(e=""),o().attach(e),!0}catch(t){webphone_api.common.PutToDebugLogException(2,"flashapi: Attach",t)}return!1}function d(e){try{if(webphone_api.common.isNull(o()))return void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var t=D;return webphone_api.common.isNull(t)&&(t=""),o().transfer(t,e),!0}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: Transfer",n)}return!1}function b(e,t){try{return webphone_api.common.isNull(o())?void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(o().three_way(e,t),!0)}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: ThreeWay",n)}return!1}function _(e,t){try{return webphone_api.common.isNull(o())?void webphone_api.common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(o().join(e,t),!0)}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: Join",n)}return!1}function f(e,t){try{if(webphone_api.common.isNull(t)||t.length<1)return;D=e;var n=!1;switch(t){case"RINGING":n=!0,webphone_api.common.PutToDebugLog(1,"STATUS,-1,Ringing...");var o="1";W&&(o="2"),webphone_api.common.PutToDebugLog(1,"STATUS,1,Ringing,"+V+","+webphone_api.common.GetSipusername()+","+o+","+V),A=webphone_api.common.GetTickCount();break;case"ACTIVE":n=!0;var o="1";W&&(o="2"),webphone_api.common.PutToDebugLog(1,"STATUS,1,CallConnect,"+V+","+webphone_api.common.GetSipusername()+","+o+","+V),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"STATUS,-1,InCall"),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Speaking")},1300),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Speaking"),k=webphone_api.common.GetTickCount();break;case"HANGUP":if(webphone_api.common.GetTickCount()-x<110)break;n=!0;var o="1";W&&(o="2"),webphone_api.common.PutToDebugLog(1,"STATUS,1,CallDisconnect,"+V+","+webphone_api.common.GetSipusername()+","+o+","+V),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Call Finished"),webphone_api.common.PutToDebugLog(1,"STATUS,1,Finished"),x=webphone_api.common.GetTickCount()}!0!==n&&webphone_api.common.PutToDebugLog(3,"EVENT, onCallState: "+t+";  uuid: "+e)}catch(i){webphone_api.common.PutToDebugLogException(2,"flashapi: onCallState",i)}}function w(e,t,n,o,i){try{D=e,W=!0,V=n,webphone_api.common.PutToDebugLog(1,"STATUS,1,CallSetup,"+n+","+webphone_api.common.GetSipusername()+",2,"+n),webphone_api.common.PutToDebugLog(1,"STATUS,-1,Incoming...");var a=webphone_api.common.GetParameter2("autoignore");(webphone_api.common.isNull(a)||1!==a.length)&&(a="0");var r=webphone_api.common.StrToInt(a);r>1?(webphone_api.common.PutToDebugLog(3,"EVENT, autoignore Flash hangup(reject)"),Reject()):1===r&&(webphone_api.common.PutToDebugLog(3,"EVENT, autoignore Flash silent ignore"),Reject()),!0!==webphone_api.common.GetParameterBool("autoaccept",!1)&&3!==webphone_api.common.GetParameterInt("enableautoaccept",1)||(webphone_api.common.PutToDebugLog(3,"EVENT, autoaccept Flash accept"),h());var s=webphone_api.common.GetParameter2("calltransferalways");!webphone_api.common.isNull(s)&&s.length>1&&(webphone_api.common.PutToDebugLog(3,"EVENT, call transfer Flash calltransferalways: "+s),d(s));var l=webphone_api.common.GetParameter2("callforwardonbusy");!webphone_api.common.isNull(l)&&l.length>1&&webphone_api.common.PutToDebugLog(3,"EVENT, call foward Flash callforwardonbusy: NOT IMPLEMENTED YET");var p=webphone_api.common.GetParameter2("callforwardalways");!webphone_api.common.isNull(p)&&p.length>1&&webphone_api.common.PutToDebugLog(3,"EVENT, call foward Flash callforwardalways: NOT IMPLEMENTED YET")}catch(c){webphone_api.common.PutToDebugLogException(2,"flashapi: onIncomingCall",c)}}function v(e,t){try{webphone_api.common.PutToDebugLog(1,"STATUS,-1,Hangup"),webphone_api.common.PutToDebugLog(3,"EVENT, onHangup reason: "+t+";  "+e),N(),setTimeout(function(){S()},1500)}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: onHangup",n)}}function P(e,t,n){try{webphone_api.common.PutToDebugLog(1,"EVENT, flashapi onDisplayUpdate, name: "+t+", number: "+n+", "+e)}catch(o){webphone_api.common.PutToDebugLogException(2,"flashapi: onDisplayUpdate",o)}}function E(e,t,n){webphone_api.common.PutToDebugLog(4,"EVENT, flashapi onMakeCall: "+t)}function T(e){webphone_api.common.PutToDebugLog(4,"EVENT, flashapi onAttach: "+e)}function N(){try{U=webphone_api.common.GetTickCount();var e=0;!webphone_api.common.isNull(k)&&k>0&&!webphone_api.common.isNull(U)&&U>0&&(e=U-k),V=webphone_api.common.isNull(V)?"":webphone_api.common.Trim(V),webphone_api.common.isNull(k)&&(k=0);var t="",n="",o="NA";!webphone_api.common.isNull(k)&&webphone_api.common.IsNumber(k)&&!webphone_api.common.isNull(A)&&webphone_api.common.IsNumber(A)&&(o=(k-A).toString());W?(t=V,n=webphone_api.common.GetSipusername()):(t=webphone_api.common.GetSipusername(),n=V);var i="1";!0===W&&(i="2");var a="CDR,1,"+V+","+t+","+n+",NA,"+o+","+e.toString()+",NA,,"+i;webphone_api.global.lastcallcdr=a,setTimeout(function(){webphone_api.common.PutToDebugLog(1,a)},500),setTimeout(function(){S()},1500),A=0,k=0,U=0,V="",W=!1}catch(r){webphone_api.common.PutToDebugLogException(2,"flashapi: BuildCDR",r)}}function S(){O&&webphone_api.common.PutToDebugLog(1,"STATUS,-1,Registered.")}function I(){var e="";try{if(e=webphone_api.common.GetParameter("rtmpserveraddress"),webphone_api.common.isNull(e)||e.length<2){if(e=webphone_api.common.GetWpS(),webphone_api.common.IsLocalServer())return webphone_api.common.PutToDebugLog(1,"ERROR, Cannot use flash server to connect to local network VoIP server"),alert("ERROR, Cannot use flash server to connect to local network VoIP server"),"";e=e.toLowerCase(),e=webphone_api.common.NormalizeInput(e,0);var t=e.indexOf("/");t>0&&(e=e.substring(0,t)),t=e.indexOf(":"),t>0&&(e=e.substring(0,t)),e+=":1939"}return e}catch(n){webphone_api.common.PutToDebugLogException(2,"flashapi: GetFlashServerAddress",n)}return""}function C(e,t){}var R={rtmp_url:""},G={allowScriptAccess:"always"},y="flashphonehandle",L="",O=!1,D="",x=0,A=0,k=0,U=0,V="",W=!1;return{Start:e,Call:c,Logout:s,Hangup:u,Accept:h,SendDTMF:g,Attach:m,Transfer:d,ThreeWay:b,Join:_,ShowPermissionRequest:C,onInit:t,onEvent:i,onDebug:a,onConnected:n,onDisconnected:r,onLogin:l,onLogout:p,onCallState:f,onIncomingCall:w,onHangup:v,onDisplayUpdate:P,onMakeCall:E,onAttach:T}}(),webphone_api.init=function(){function e(){webphone_api.$("#loading_bg_txt").hide();var e=window.location.href;e.indexOf("#page_call")>0&&(console&&console.log&&console.log("WARNING, page Call was last started and after browser window reload, go to Settings page"),webphone_api.common.PutToDebugLog(3,"EVENT, page Call was last started and after browser window reload, go to Settings page"),e=e.replace("#page_call",""),window.location.href=e)}function t(){if(!0!==a){if(a=!0,webphone_api.common.SetElementsSrc(),webphone_api.global.domloaded_tick=webphone_api.common.GetTickCount(),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, init: initialize start"),webphone_api.common.Glv()<1)return void(webphone_api.global.webrtcavailable=0);if(!webphone_api.common.IsWindowsSoftphone()){webphone_api.loadwebrtc_timestamp=webphone_api.common.GetTickCount();var e=webphone_api.common.GetForcedEngine();if(e&&"webrtc"!=e.name)return webphone_api.global.webrtcavailable=0,webphone_api.common.PutToDebugLog(2,"webrtc engine not needed"),void(!0===webphone_api.common.UseCustomAutoprov(!0)?webphone_api.common.GetCustomAutoprov(function(e){webphone_api.common.RecAutoprovCustom(e),n()}):n());webphone_api.webrtcapi.WebRtcIsSupported(function(e){if("Windows"===webphone_api.common.GetOs()&&("MSIE"===webphone_api.common.GetBrowser()?e=!1:"Edge"===webphone_api.common.GetBrowser()&&(webphone_api.common.GetBrowserVersion()<14?e=!1:!1===e&&webphone_api.common.PutToDebugLog(2,"ERROR,Init Edge webrtc is not supported, getusermedia: "+typeof navigator.getUserMedia+"; RTCPeerConnection: "+typeof window.RTCPeerConnection))),"iOS"===webphone_api.common.GetOs()?(("Safari"===webphone_api.common.GetBrowser()||"iPhone"===webphone_api.common.GetBrowser())&&webphone_api.common.GetBrowserVersion()<11&&(e=!1),"Firefox"!==webphone_api.common.GetBrowser()||navigator.mozGetUserMedia||navigator.GetUserMedia||(e=!1),"Chrome"!==webphone_api.common.GetBrowser()||navigator.webkitGetUserMedia||navigator.GetUserMedia||(e=!1)):"Windows"===webphone_api.common.GetOs()&&"Safari"===webphone_api.common.GetBrowser()&&(e=!1),webphone_api.common.isNull(e)&&(e=""),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, Webrtc engine available at init: "+e),!0===e){webphone_api.global.webrtcavailable=1;var t=webphone_api.common.GetEngine("webrtc"),o=webphone_api.common.GetParameter2("serveraddress_user");(webphone_api.common.isNull(o)||o.length<2)&&(o=webphone_api.common.GetParameter2("serveraddress")),(webphone_api.common.isNull(o)||o.length<2)&&(o=webphone_api.common.GetConfig("serveraddress")),webphone_api.common.isNull(o)&&(o="");var i=!1;webphone_api.common.CanUseAnyAddrForWebRTC()||(1==webphone_api.common.IsLanIPEx(webphone_api.common.GetWebrtcUpperServer())?i=!0:0==webphone_api.common.IsLanIPEx(webphone_api.common.GetWebrtcUpperServer())||1==webphone_api.common.IsLanIPEx(o)&&(i=!0)),i?webphone_api.common.isNull(t)||(t.issupported_cache=0,t.available=0):!0===webphone_api.common.BrowserRequiresHttps(!0)?webphone_api.common.isNull(t)||(t.issupported_cache=1,t.available=2):webphone_api.common.isNull(t)||(t.issupported_cache=2,t.available=3)}else!1===e&&(webphone_api.global.webrtcavailable=0,webphone_api.common.PutToDebugLog(2,"webrtc engine NOT available"));!0===webphone_api.common.UseCustomAutoprov(!0)?webphone_api.common.GetCustomAutoprov(function(e){webphone_api.common.RecAutoprovCustom(e),n()}):n()})}}}function n(){if(webphone_api.common.EngineSelect(0,31),webphone_api.common.SetLanguage(),webphone_api.plhandler.ConfigChanged(),!1===webphone_api.global.onloaded_called){webphone_api.global.wploaded=!0,webphone_api.common.PutToDebugLogSpecial(1,"EVENT, init webphone onLoaded",!1,"");try{webphone_api.onAppStateChangeCb("loaded")}catch(e){webphone_api.common.PutToDebugLogException(2,"init: There is an error in onAppStateChange(loaded) callback",e)}try{webphone_api.onLoadedCb()}catch(e){webphone_api.common.PutToDebugLogException(2,"init: There is an error in onLoaded() callback",e)}try{!0===webphone_api.common.IsWebphoneInIframe()&&webphone_api.WebphoneSendMessageToParent("wploadedandready_IFRAME")}catch(e){webphone_api.common.PutToDebugLogException(2,"init: send loaded state message to iframe parent page",e)}webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onload,"onLoad","","","",""),webphone_api.global.onloaded_called=!0,setTimeout(function(){webphone_api.global.onloaded_called=!1},5e3),webphone_api.webphone_loaded=!0,webphone_api.common.WebphoneIsLoaded()}}function o(){try{webphone_api.global.domloaded=!0,webphone_api.$.mobile.pageContainer=webphone_api.$("#android_frame"),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(3,"EVENT, init: mobileinit"),webphone_api.$("body").on("contextmenu",function(e){if(0==webphone_api.common.IsSDK())return i(e)})}catch(e){webphone_api.common.PutToDebugLogException(2,"init: mobileinit",e)}}function i(e){var t="";try{if(t=webphone_api.$.mobile.activePage.attr("id"),
webphone_api.common.isNull(t)||t.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, init: OpenMenu NO PAGE"),!1;t=t.replace("page_","");var n="#btn_"+t+"_menu";if("settings"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("dialpad"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("contactslist"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("contactdetails"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("callhistorylist"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("callhistorydetails"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("call"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("addeditcontact"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("messagelist"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("message"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("internalbrowser"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("newuser"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("filetransfer"===t)return webphone_api.$(n).click(),e.preventDefault(),!1;if("smscodeverify"===t)return webphone_api.$(n).click(),e.preventDefault(),!1}catch(o){webphone_api.common.PutToDebugLogException(2,"init: OpenMenu "+t,o)}}webphone_api.$(document).ready(function(){e()}),webphone_api.$(document).on("mobileinit",function(){o(),webphone_api.$.event.special.tap.emitTapOnTaphold=!1});var a=!1;webphone_api.$(".options_menu").on("popupbeforeposition",function(e,t){webphone_api.$(".all_app_pages").css("overflow","hidden")});var r=!1;return window.onunload=window.onbeforeunload=function(e){try{try{if("undefined"==typeof webphone_api||null===webphone_api)return;if(webphone_api.unregisteredcb=null,webphone_api.global.onunload_flag=!0,!0===r)return;r=!0,webphone_api.stop();webphone_api.global.useengine;if(webphone_api.global.useengine="","undefined"!=typeof webphone_api.common&&null!==webphone_api.common){if(webphone_api.common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh event detected. reset useengine"),webphone_api.global.wasSettModified){var t=webphone_api.common.GetActiveAccSettingsFilename();!webphone_api.common.isNull(t)&&t.length>0&&webphone_api.common.SaveSettingsFile(6,t,function(e){webphone_api.common.CanLog(2)&&(e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveSettingsFile on exit Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveSettingsFile on exit Failed"))})}webphone_api.global.wasCtModified&&webphone_api.common.SaveContactsFile(function(e){e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveContactsFile on exit Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveContactsFile on exit Failed")}),webphone_api.global.wasChModified&&webphone_api.common.SaveCallhistoryFile(function(e){e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveCallhistoryFile on exit Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveCallhistoryFile on exit Failed")})}}catch(n){webphone_api.common.PutToDebugLogException(2,"init: Window.OnUnload",n)}}catch(n){}},webphone_api.$(document).on("pagecontainershow",function(e,t){var n="";try{var o=webphone_api.$.mobile.pageContainer.pagecontainer("getActivePage");n=o[0].id,document.getElementById(n).style.minHeight="auto"}catch(i){webphone_api.common.PutToDebugLogException(2,"init: pagecontainershow "+n,i)}}),webphone_api.$(document).on("pageinit",'[data-role="page"]',function(e){var t="";try{if(t=webphone_api.$(this).attr("id"),webphone_api.common.isNull(t)||t.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, init: pageinit NO PAGE");if(t.indexOf("settings")>=0&&!webphone_api.common.isNull(webphone_api._settings))return void webphone_api._settings.onCreate(e);if(t.indexOf("dialpad")>=0&&!webphone_api.common.isNull(webphone_api._dialpad))return void webphone_api._dialpad.onCreate(e);if(t.indexOf("contactslist")>=0&&!webphone_api.common.isNull(webphone_api._contactslist))return void webphone_api._contactslist.onCreate(e);if(t.indexOf("contactdetails")>=0&&!webphone_api.common.isNull(webphone_api._contactdetails))return void webphone_api._contactdetails.onCreate(e);if(t.indexOf("callhistorylist")>=0&&!webphone_api.common.isNull(webphone_api._callhistorylist))return void webphone_api._callhistorylist.onCreate(e);if(t.indexOf("callhistorydetails")>=0&&!webphone_api.common.isNull(webphone_api._callhistorydetails))return void webphone_api._callhistorydetails.onCreate(e);if(t.indexOf("call")>=0&&!webphone_api.common.isNull(webphone_api._call))return void webphone_api._call.onCreate(e);if(t.indexOf("addeditcontact")>=0&&!webphone_api.common.isNull(webphone_api._addeditcontact))return void webphone_api._addeditcontact.onCreate(e);if(t.indexOf("messagelist")>=0&&!webphone_api.common.isNull(webphone_api.webphone_api))return void webphone_api._messagelist.onCreate(e);if(t.indexOf("message")>=0&&!webphone_api.common.isNull(webphone_api._message))return void webphone_api._message.onCreate(e);if(t.indexOf("internalbrowser")>=0&&!webphone_api.common.isNull(webphone_api._internalbrowser))return void webphone_api._internalbrowser.onCreate(e);if(t.indexOf("startpage")>=0&&!webphone_api.common.isNull(webphone_api._startpage))return void webphone_api._startpage.onCreate(e);if(t.indexOf("logview")>=0&&!webphone_api.common.isNull(webphone_api._logview))return void webphone_api._logview.onCreate(e);if(t.indexOf("newuser")>=0&&!webphone_api.common.isNull(webphone_api._newuser))return void webphone_api._newuser.onCreate(e);if(t.indexOf("filetransfer")>=0&&!webphone_api.common.isNull(webphone_api._filetransfer))return void webphone_api._filetransfer.onCreate(e);if(t.indexOf("filters")>=0&&!webphone_api.common.isNull(webphone_api._filters))return void webphone_api._filters.onCreate(e);if(t.indexOf("accounts")>=0&&!webphone_api.common.isNull(webphone_api._accounts))return void webphone_api._accounts.onCreate(e);if(t.indexOf("smscodeverify")>=0&&!webphone_api.common.isNull(webphone_api._smscodeverify))return void webphone_api._smscodeverify.onCreate(e);if(t.indexOf("extra1")>=0)return void(webphone_api._extra1&&webphone_api._extra1.onCreate&&(webphone_api._extra1.onCreate(e),webphone_api.global.isExtra1Started=!0));if(t.indexOf("extra2")>=0)return void(webphone_api._extra2&&webphone_api._extra2.onCreate&&(webphone_api._extra2.onCreate(e),webphone_api.global.isExtra2Started=!0));if(t.indexOf("extra3")>=0)return void(webphone_api._extra3&&webphone_api._extra3.onCreate&&(webphone_api._extra3.onCreate(e),webphone_api.global.isExtra3Started=!0));if(t.indexOf("extra4")>=0)return void(webphone_api._extra4&&webphone_api._extra4.onCreate&&(webphone_api._extra4.onCreate(e),webphone_api.global.isExtra4Started=!0));if(t.indexOf("extra5")>=0)return void(webphone_api._extra5&&webphone_api._extra5.onCreate&&(webphone_api._extra5.onCreate(e),webphone_api.global.isExtra5Started=!0))}catch(n){webphone_api.common.isNull(t)&&(t=""),webphone_api.common.PutToDebugLogException(2,"init: pageinit "+t,n)}}),webphone_api.$(document).on("pageshow",'[data-role="page"]',function(e){var t="";try{if(t=webphone_api.$(this).attr("id"),webphone_api.common.isNull(t)||t.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, init: pageshow NO PAGE");var n="#"+t.substring(t.indexOf("_")+1,t.length)+"_header";if(document.getElementById(t).style.background=webphone_api.common.getBgColor(n),t.indexOf("settings")>=0&&!webphone_api.common.isNull(webphone_api._settings))return void webphone_api._settings.onStart(e);if(t.indexOf("dialpad")>=0&&!webphone_api.common.isNull(webphone_api._dialpad))return void webphone_api._dialpad.onStart(e);if(t.indexOf("contactslist")>=0&&!webphone_api.common.isNull(webphone_api._contactslist))return void webphone_api._contactslist.onStart(e);if(t.indexOf("contactdetails")>=0&&!webphone_api.common.isNull(webphone_api._contactdetails))return void webphone_api._contactdetails.onStart(e);if(t.indexOf("callhistorylist")>=0&&!webphone_api.common.isNull(webphone_api._callhistorylist))return void webphone_api._callhistorylist.onStart(e);if(t.indexOf("callhistorydetails")>=0&&!webphone_api.common.isNull(webphone_api._callhistorydetails))return void webphone_api._callhistorydetails.onStart(e);if(t.indexOf("call")>=0&&!webphone_api.common.isNull(webphone_api._call))return void webphone_api._call.onStart(e);if(t.indexOf("addeditcontact")>=0&&!webphone_api.common.isNull(webphone_api._addeditcontact))return void webphone_api._addeditcontact.onStart(e);if(t.indexOf("messagelist")>=0&&!webphone_api.common.isNull(webphone_api._messagelist))return void webphone_api._messagelist.onStart(e);if(t.indexOf("message")>=0&&!webphone_api.common.isNull(webphone_api._message))return void webphone_api._message.onStart(e);if(t.indexOf("internalbrowser")>=0&&!webphone_api.common.isNull(webphone_api._internalbrowser))return void webphone_api._internalbrowser.onStart(e);if(t.indexOf("startpage")>=0&&!webphone_api.common.isNull(webphone_api._startpage))return void webphone_api._startpage.onStart(e);if(t.indexOf("logview")>=0&&!webphone_api.common.isNull(webphone_api._logview))return void webphone_api._logview.onStart(e);if(t.indexOf("newuser")>=0&&!webphone_api.common.isNull(webphone_api._newuser))return void webphone_api._newuser.onStart(e);if(t.indexOf("filetransfer")>=0&&!webphone_api.common.isNull(webphone_api._filetransfer))return void webphone_api._filetransfer.onStart(e);if(t.indexOf("filters")>=0&&!webphone_api.common.isNull(webphone_api._filters))return void webphone_api._filters.onStart(e);if(t.indexOf("accounts")>=0&&!webphone_api.common.isNull(webphone_api._accounts))return void webphone_api._accounts.onStart(e);if(t.indexOf("smscodeverify")>=0&&!webphone_api.common.isNull(webphone_api._smscodeverify))return void webphone_api._smscodeverify.onStart(e);if(t.indexOf("extra1")>=0)return void(webphone_api._extra1&&webphone_api._extra1.onStart&&(webphone_api._extra1.onStart(e),webphone_api.global.isExtra1Started=!0));if(t.indexOf("extra2")>=0)return void(webphone_api._extra2&&webphone_api._extra2.onStart&&(webphone_api._extra2.onStart(e),webphone_api.global.isExtra2Started=!0));if(t.indexOf("extra3")>=0)return void(webphone_api._extra3&&webphone_api._extra3.onStart&&(webphone_api._extra3.onStart(e),webphone_api.global.isExtra3Started=!0));if(t.indexOf("extra4")>=0)return void(webphone_api._extra4&&webphone_api._extra4.onStart&&(webphone_api._extra4.onStart(e),webphone_api.global.isExtra4Started=!0));if(t.indexOf("extra5")>=0)return void(webphone_api._extra5&&webphone_api._extra5.onStart&&(webphone_api._extra5.onStart(e),webphone_api.global.isExtra5Started=!0))}catch(o){webphone_api.common.isNull(t)&&(t=""),webphone_api.common.PutToDebugLogException(2,"init: pageshow "+t,o)}}),webphone_api.$(document).on("pagebeforehide",'[data-role="page"]',function(e){var t="";try{if(t=webphone_api.$(this).attr("id"),webphone_api.common.isNull(t)||t.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, init: pagebeforehide NO PAGE");if(t.indexOf("settings")>=0&&!webphone_api.common.isNull(webphone_api._settings))return void webphone_api._settings.onStop(e);if(t.indexOf("dialpad")>=0&&!webphone_api.common.isNull(webphone_api._dialpad))return void webphone_api._dialpad.onStop(e);if(t.indexOf("contactslist")>=0&&!webphone_api.common.isNull(webphone_api._contactslist))return void webphone_api._contactslist.onStop(e);if(t.indexOf("contactdetails")>=0&&!webphone_api.common.isNull(webphone_api._contactdetails))return void webphone_api._contactdetails.onStop(e);if(t.indexOf("callhistorylist")>=0&&!webphone_api.common.isNull(webphone_api._callhistorylist))return void webphone_api._callhistorylist.onStop(e);if(t.indexOf("callhistorydetails")>=0&&!webphone_api.common.isNull(webphone_api._callhistorydetails))return void webphone_api._callhistorydetails.onStop(e);if(t.indexOf("call")>=0&&!webphone_api.common.isNull(webphone_api._call))return void webphone_api._call.onStop(e);if(t.indexOf("addeditcontact")>=0&&!webphone_api.common.isNull(webphone_api._addeditcontact))return void webphone_api._addeditcontact.onStop(e);if(t.indexOf("messagelist")>=0&&!webphone_api.common.isNull(webphone_api._messagelist))return void webphone_api._messagelist.onStop(e);if(t.indexOf("message")>=0&&!webphone_api.common.isNull(webphone_api._message))return void webphone_api._message.onStop(e);if(t.indexOf("internalbrowser")>=0&&!webphone_api.common.isNull(webphone_api._internalbrowser))return void webphone_api._internalbrowser.onStop(e);if(t.indexOf("startpage")>=0&&!webphone_api.common.isNull(webphone_api._startpage))return void webphone_api._startpage.onStop(e);if(t.indexOf("logview")>=0&&!webphone_api.common.isNull(webphone_api._logview))return void webphone_api._logview.onStop(e);if(t.indexOf("newuser")>=0&&!webphone_api.common.isNull(webphone_api._newuser))return void webphone_api._newuser.onStop(e);if(t.indexOf("filetransfer")>=0&&!webphone_api.common.isNull(webphone_api._filetransfer))return void webphone_api._filetransfer.onStop(e);if(t.indexOf("filters")>=0&&!webphone_api.common.isNull(webphone_api._filters))return void webphone_api._filters.onStop(e);if(t.indexOf("accounts")>=0&&!webphone_api.common.isNull(webphone_api._accounts))return void webphone_api._accounts.onStop(e);if(t.indexOf("smscodeverify")>=0&&!webphone_api.common.isNull(webphone_api._smscodeverify))return void webphone_api._smscodeverify.onStop(e);if(t.indexOf("extra1")>=0)return void(webphone_api._extra1&&webphone_api._extra1.onStop&&(webphone_api._extra1.onStop(e),webphone_api.global.isExtra1Started=!1));if(t.indexOf("extra2")>=0)return void(webphone_api._extra2&&webphone_api._extra2.onStop&&(webphone_api._extra2.onStop(e),webphone_api.global.isExtra2Started=!1));if(t.indexOf("extra3")>=0)return void(webphone_api._extra3&&webphone_api._extra3.onStop&&(webphone_api._extra3.onStop(e),webphone_api.global.isExtra3Started=!1));if(t.indexOf("extra4")>=0)return void(webphone_api._extra4&&webphone_api._extra4.onStop&&(webphone_api._extra4.onStop(e),webphone_api.global.isExtra4Started=!1));if(t.indexOf("extra5")>=0)return void(webphone_api._extra5&&webphone_api._extra5.onStop&&(webphone_api._extra5.onStop(e),webphone_api.global.isExtra5Started=!1))}catch(n){webphone_api.common.isNull(t)&&(t=""),webphone_api.common.PutToDebugLogException(2,"init: pagebeforehide "+t,n)}}),webphone_api.$(document).on("pagehide",'[data-role="page"]',function(e){var t="";try{if(t=webphone_api.$(this).attr("id"),webphone_api.common.isNull(t)||t.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, init: pagehide NO PAGE");if(t.indexOf("settings")>=0&&!webphone_api.common.isNull(webphone_api._settings)&&webphone_api._settings.onDestroy)return void webphone_api._settings.onDestroy(e);if(t.indexOf("dialpad")>=0&&!webphone_api.common.isNull(webphone_api._dialpad)&&webphone_api._dialpad.onDestroy)return void webphone_api._dialpad.onDestroy(e);if(t.indexOf("contactslist")>=0&&!webphone_api.common.isNull(webphone_api._contactslist)&&webphone_api._contactslist.onDestroy)return void webphone_api._contactslist.onDestroy(e);if(t.indexOf("contactdetails")>=0&&!webphone_api.common.isNull(webphone_api._contactdetails)&&webphone_api._contactdetails.onDestroy)return void webphone_api._contactdetails.onDestroy(e);if(t.indexOf("callhistorylist")>=0&&!webphone_api.common.isNull(webphone_api._callhistorylist)&&webphone_api._callhistorylist.onDestroy)return void webphone_api._callhistorylist.onDestroy(e);if(t.indexOf("callhistorydetails")>=0&&!webphone_api.common.isNull(webphone_api._callhistorydetails)&&webphone_api._callhistorydetails.onDestroy)return void webphone_api._callhistorydetails.onDestroy(e);if(t.indexOf("call")>=0&&!webphone_api.common.isNull(webphone_api._call)&&webphone_api._call.onDestroy)return void webphone_api._call.onDestroy(e);if(t.indexOf("addeditcontact")>=0&&!webphone_api.common.isNull(webphone_api._addeditcontact)&&webphone_api._addeditcontact.onDestroy)return void webphone_api._addeditcontact.onDestroy(e);if(t.indexOf("messagelist")>=0&&!webphone_api.common.isNull(webphone_api._messagelist)&&webphone_api._messagelist.onDestroy)return void webphone_api._messagelist.onDestroy(e);if(t.indexOf("message")>=0&&!webphone_api.common.isNull(webphone_api._message)&&webphone_api._message.onDestroy)return void webphone_api._message.onDestroy(e);if(t.indexOf("internalbrowser")>=0&&!webphone_api.common.isNull(webphone_api._internalbrowser)&&webphone_api._internalbrowser.onDestroy)return void webphone_api._internalbrowser.onDestroy(e);if(t.indexOf("startpage")>=0&&!webphone_api.common.isNull(webphone_api._startpage)&&webphone_api._startpage.onDestroy)return void webphone_api._startpage.onDestroy(e);if(t.indexOf("logview")>=0&&!webphone_api.common.isNull(webphone_api._logview)&&webphone_api._logview.onDestroy)return void webphone_api._logview.onDestroy(e);if(t.indexOf("newuser")>=0&&!webphone_api.common.isNull(webphone_api._newuser)&&webphone_api._newuser.onDestroy)return void webphone_api._newuser.onDestroy(e);if(t.indexOf("filetransfer")>=0&&!webphone_api.common.isNull(webphone_api._filters)&&webphone_api._filters.onDestroy)return void webphone_api._filetransfer.onDestroy(e);if(t.indexOf("filters")>=0&&!webphone_api.common.isNull(webphone_api._filters)&&webphone_api._filters.onDestroy)return void webphone_api._filters.onDestroy(e);if(t.indexOf("accounts")>=0&&!webphone_api.common.isNull(webphone_api._accounts)&&webphone_api._accounts.onDestroy)return void webphone_api._accounts.onDestroy(e);if(t.indexOf("smscodeverify")>=0&&!webphone_api.common.isNull(webphone_api._smscodeverify)&&webphone_api._smscodeverify.onDestroy)return void webphone_api._smscodeverify.onDestroy(e)}catch(n){webphone_api.common.isNull(t)&&(t=""),webphone_api.common.PutToDebugLogException(2,"init: pagehide "+t,n)}}),{initialize:e,mobileinit:o,SkinLoaded:t}}(),function(e,t,n){1!=webphone_api.parameters.issdk&&"true"!=webphone_api.parameters.issdk&&("function"==typeof define&&define.amd?define(["jquery"],function(o){return n(o,e,t),o.mobile}):n(e.webphone_api.$,e,t))}(this,document,function(e,t,n){!function(e){e.mobile={}}(e),function(e){e.extend(e.mobile,{version:"1.4.2",subPageUrlKey:"ui-page",hideUrlBar:!0,keepNative:":jqmData(role='none'), :jqmData(role='nojs')",activePageClass:"ui-page-active",activeBtnClass:"ui-btn-active",focusClass:"ui-focus",ajaxEnabled:!0,hashListeningEnabled:!0,linkBindingEnabled:!0,defaultPageTransition:"fade",maxTransitionWidth:!1,minScrollBack:0,defaultDialogTransition:"pop",pageLoadErrorMessage:"Error Loading Page",pageLoadErrorMessageTheme:"a",phonegapNavigationEnabled:!1,autoInitializePage:!0,pushStateEnabled:!0,ignoreContentEnabled:!1,buttonMarkup:{hoverDelay:200},dynamicBaseEnabled:!0,pageContainer:e(),allowCrossDomainPages:!1,dialogHashKey:"&ui-state=dialog"})}(e),function(e,t,n){var o={},i=e.find,a=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;e.extend(e.mobile,{ns:"",getAttribute:function(t,n){var o;(t=t.jquery?t[0]:t)&&t.getAttribute&&(o=t.getAttribute("data-"+e.mobile.ns+n));try{o="true"===o||"false"!==o&&("null"===o?null:+o+""===o?+o:a.test(o)?JSON.parse(o):o)}catch(i){}return o},nsNormalizeDict:o,nsNormalize:function(t){return o[t]||(o[t]=e.camelCase(e.mobile.ns+t))},closestPageData:function(e){return e.closest(":jqmData(role='page'), :jqmData(role='dialog')").data("mobile-page")}}),e.fn.jqmData=function(t,n){var o;return void 0!==t&&(t&&(t=e.mobile.nsNormalize(t)),o=arguments.length<2||void 0===n?this.data(t):this.data(t,n)),o},e.jqmData=function(t,n,o){var i;return void 0!==n&&(i=e.data(t,n?e.mobile.nsNormalize(n):n,o)),i},e.fn.jqmRemoveData=function(t){return this.removeData(e.mobile.nsNormalize(t))},e.jqmRemoveData=function(t,n){return e.removeData(t,e.mobile.nsNormalize(n))},e.find=function(t,n,o,a){return t.indexOf(":jqmData")>-1&&(t=t.replace(/:jqmData\(([^)]*)\)/g,"[data-"+(e.mobile.ns||"")+"$1]")),i.call(this,t,n,o,a)},e.extend(e.find,i)}(e),function(e,t){function o(t,n){var o,a,r,s=t.nodeName.toLowerCase();return"area"===s?(o=t.parentNode,a=o.name,!(!t.href||!a||"map"!==o.nodeName.toLowerCase())&&(!!(r=e("img[usemap=#"+a+"]")[0])&&i(r))):(/input|select|textarea|button|object/.test(s)?!t.disabled:"a"===s?t.href||n:n)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var a=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"c0ab71056b936627e8a7821f03c044aec6280a40",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,o){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),o&&o.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(this[0].ownerDocument||n):t},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,o){return!!e.data(t,o[3])},focusable:function(t){return o(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),i=isNaN(n);return(i||n>=0)&&o(t,!i)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,o){function i(t,n,o,i){return e.each(a,function(){n-=parseFloat(e.css(t,"padding"+this))||0,o&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var a="Width"===o?["Left","Right"]:["Top","Bottom"],r=o.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+o]=function(n){return n===t?s["inner"+o].call(this):this.each(function(){e(this).css(r,i(this,n)+"px")})},e.fn["outer"+o]=function(t,n){return"number"!=typeof t?s["outer"+o].call(this,t):this.each(function(){e(this).css(r,i(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in n.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(o){if(o!==t)return this.css("zIndex",o);if(this.length)for(var i,a,r=e(this[0]);r.length&&r[0]!==n;){if(("absolute"===(i=r.css("position"))||"relative"===i||"fixed"===i)&&(a=parseInt(r.css("zIndex"),10),!isNaN(a)&&0!==a))return a;r=r.parent()}return 0}}),e.ui.plugin={add:function(t,n,o){var i,a=e.ui[t].prototype;for(i in o)a.plugins[i]=a.plugins[i]||[],a.plugins[i].push([n,o[i]])},call:function(e,t,n,o){var i,a=e.plugins[t];if(a&&(o||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(i=0;i<a.length;i++)e.options[a[i][0]]&&a[i][1].apply(e.element,n)}}}(e),function(e,t){var o=function(t,n){var o=t.parent(),i=[],a=o.children(":jqmData(role='header')"),r=t.children(":jqmData(role='header')"),s=o.children(":jqmData(role='footer')"),l=t.children(":jqmData(role='footer')");return 0===r.length&&a.length>0&&(i=i.concat(a.toArray())),0===l.length&&s.length>0&&(i=i.concat(s.toArray())),e.each(i,function(t,o){n-=e(o).outerHeight()}),Math.max(0,n)};e.extend(e.mobile,{window:e(t),document:e(n),keyCode:e.ui.keyCode,behaviors:{},silentScroll:function(n){"number"!==e.type(n)&&(n=e.mobile.defaultHomeScroll),e.event.special.scrollstart.enabled=!1,setTimeout(function(){t.scrollTo(0,n),e.mobile.document.trigger("silentscroll",{x:0,y:n})},20),setTimeout(function(){e.event.special.scrollstart.enabled=!0},150)},getClosestBaseUrl:function(t){var n=e(t).closest(".ui-page").jqmData("url"),o=e.mobile.path.documentBase.hrefNoHash;return e.mobile.dynamicBaseEnabled&&n&&e.mobile.path.isPath(n)||(n=o),e.mobile.path.makeUrlAbsolute(n,o)},removeActiveLinkClass:function(t){!e.mobile.activeClickedLink||e.mobile.activeClickedLink.closest("."+e.mobile.activePageClass).length&&!t||e.mobile.activeClickedLink.removeClass(e.mobile.activeBtnClass),e.mobile.activeClickedLink=null},getInheritedTheme:function(e,t){for(var n,o,i=e[0],a="",r=/ui-(bar|body|overlay)-([a-z])\b/;i&&!((n=i.className||"")&&(o=r.exec(n))&&(a=o[2]));)i=i.parentNode;return a||t||"a"},enhanceable:function(e){return this.haveParents(e,"enhance")},hijackable:function(e){return this.haveParents(e,"ajax")},haveParents:function(t,n){if(!e.mobile.ignoreContentEnabled)return t;var o,i,a,r,s=t.length,l=e();for(r=0;s>r;r++){for(i=t.eq(r),a=!1,o=t[r];o;){if("false"===(o.getAttribute?o.getAttribute("data-"+e.mobile.ns+n):"")){a=!0;break}o=o.parentNode}a||(l=l.add(i))}return l},getScreenHeight:function(){return t.innerHeight||e.mobile.window.height()},resetActivePageHeight:function(t){var n=e("."+e.mobile.activePageClass),i=n.height(),a=n.outerHeight(!0);t=o(n,"number"==typeof t?t:e.mobile.getScreenHeight()),n.css("min-height",t-(a-i))},loading:function(){var t=this.loading._widget||e(e.mobile.loader.prototype.defaultHtml).loader(),n=t.loader.apply(t,arguments);return this.loading._widget=t,n}}),e.addDependents=function(t,n){var o=e(t),i=o.jqmData("dependents")||e();o.jqmData("dependents",e(i).add(n))},e.fn.extend({removeWithDependents:function(){e.removeWithDependents(this)},enhanceWithin:function(){var t,n={},o=e.mobile.page.prototype.keepNativeSelector(),i=this;e.mobile.nojs&&e.mobile.nojs(this),e.mobile.links&&e.mobile.links(this),e.mobile.degradeInputsWithin&&e.mobile.degradeInputsWithin(this),e.fn.buttonMarkup&&this.find(e.fn.buttonMarkup.initSelector).not(o).jqmEnhanceable().buttonMarkup(),e.fn.fieldcontain&&this.find(":jqmData(role='fieldcontain')").not(o).jqmEnhanceable().fieldcontain(),e.each(e.mobile.widgets,function(t,a){if(a.initSelector){var r=e.mobile.enhanceable(i.find(a.initSelector));r.length>0&&(r=r.not(o)),r.length>0&&(n[a.prototype.widgetName]=r)}});for(t in n)n[t][t]();return this},addDependents:function(t){e.addDependents(this,t)},getEncodedText:function(){return e("<a>").text(this.text()).html()},jqmEnhanceable:function(){return e.mobile.enhanceable(this)},jqmHijackable:function(){return e.mobile.hijackable(this)}}),e.removeWithDependents=function(t){var n=e(t);(n.jqmData("dependents")||e()).remove(),n.remove()},e.addDependents=function(t,n){var o=e(t),i=o.jqmData("dependents")||e();o.jqmData("dependents",e(i).add(n))},e.find.matches=function(t,n){return e.find(t,null,null,n)},e.find.matchesSelector=function(t,n){return e.find(n,null,null,[t]).length>0}}(e,this),function(e,t){var n=0,o=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n,o=0;null!=(n=t[o]);o++)try{e(n).triggerHandler("remove")}catch(a){}i(t)},e.widget=function(t,n,o){var i,a,r,s,l={},p=t.split(".")[0];return t=t.split(".")[1],i=p+"-"+t,o||(o=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[p]=e[p]||{},a=e[p][t],r=e[p][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new r(e,t)},e.extend(r,a,{version:o.version,_proto:e.extend({},o),_childConstructors:[]}),s=new n,s.options=e.widget.extend({},s.options),e.each(o,function(t,o){return e.isFunction(o)?void(l[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,a=this._superApply;return this._super=e,this._superApply=i,t=o.apply(this,arguments),this._super=n,this._superApply=a,t}}()):void(l[t]=o)}),r.prototype=e.widget.extend(s,{widgetEventPrefix:a?s.widgetEventPrefix||t:t},l,{constructor:r,namespace:p,widgetName:t,widgetFullName:i}),a?(e.each(a._childConstructors,function(t,n){var o=n.prototype;e.widget(o.namespace+"."+o.widgetName,r,n._proto)}),delete a._childConstructors):n._childConstructors.push(r),e.widget.bridge(t,r),r},e.widget.extend=function(n){for(var i,a,r=o.call(arguments,1),s=0,l=r.length;l>s;s++)for(i in r[s])a=r[s][i],r[s].hasOwnProperty(i)&&a!==t&&(n[i]=e.isPlainObject(a)?e.isPlainObject(n[i])?e.widget.extend({},n[i],a):e.widget.extend({},a):a);return n},e.widget.bridge=function(n,i){var a=i.prototype.widgetFullName||n;e.fn[n]=function(r){var s="string"==typeof r,l=o.call(arguments,1),p=this;return r=!s&&l.length?e.widget.extend.apply(null,[r].concat(l)):r,this.each(s?function(){var o,i=e.data(this,a);return"instance"===r?(p=i,!1):i?e.isFunction(i[r])&&"_"!==r.charAt(0)?(o=i[r].apply(i,l),o!==i&&o!==t?(p=o&&o.jquery?p.pushStack(o.get()):o,!1):void 0):e.error("no such method '"+r+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+r+"'")}:function(){var t=e.data(this,a);t?t.option(r||{})._init():e.data(this,a,new i(r,this))}),p}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,o){o=e(o||this.defaultElement||this)[0],this.element=e(o),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),o!==this&&(e.data(o,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===o&&this.destroy()}}),this.document=e(o.style?o.ownerDocument:o.document||o),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,o){var i,a,r,s=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(s={},i=n.split("."),n=i.shift(),i.length){for(a=s[n]=e.widget.extend({},this.options[n]),r=0;r<i.length-1;r++)a[i[r]]=a[i[r]]||{},a=a[i[r]];if(n=i.pop(),o===t)return a[n]===t?null:a[n];a[n]=o}else{if(o===t)return this.options[n]===t?null:this.options[n];s[n]=o}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,n,o){var i,a=this;"boolean"!=typeof t&&(o=n,n=t,t=!1),o?(n=i=e(n),this.bindings=this.bindings.add(n)):(o=n,n=this.element,i=this.widget()),
e.each(o,function(o,r){function s(){return t||!0!==a.options.disabled&&!e(this).hasClass("ui-state-disabled")?("string"==typeof r?a[r]:r).apply(a,arguments):void 0}"string"!=typeof r&&(s.guid=r.guid=r.guid||s.guid||e.guid++);var l=o.match(/^(\w+)\s*(.*)$/),p=l[1]+a.eventNamespace,c=l[2];c?i.delegate(c,p,s):n.bind(p,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?o[e]:e).apply(o,arguments)}var o=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,o){var i,a,r=this.options[t];if(o=o||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],a=n.originalEvent)for(i in a)i in n||(n[i]=a[i]);return this.element.trigger(n,o),!(e.isFunction(r)&&!1===r.apply(this.element[0],[n].concat(o))||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(o,i,a){"string"==typeof i&&(i={effect:i});var r,s=i?!0===i||"number"==typeof i?n:i.effect||n:t;i=i||{},"number"==typeof i&&(i={duration:i}),r=!e.isEmptyObject(i),i.complete=a,i.delay&&o.delay(i.delay),r&&e.effects&&e.effects.effect[s]?o[t](i):s!==t&&o[s]?o[s](i.duration,i.easing,a):o.queue(function(n){e(this)[t](),a&&a.call(o[0]),n()})}})}(e),function(e){var t=function(e){return"-"+e.toLowerCase()};e.extend(e.Widget.prototype,{_getCreateOptions:function(){var n,o,i=this.element[0],a={};if(!e.mobile.getAttribute(i,"defaults"))for(n in this.options)null!=(o=e.mobile.getAttribute(i,n.replace(/[A-Z]/g,t)))&&(a[n]=o);return a}}),e.mobile.widget=e.Widget}(e),function(e){var t="ui-loader",n=e("html");e.widget("mobile.loader",{options:{theme:"a",textVisible:!1,html:"",text:"loading"},defaultHtml:"<div class='"+t+"'><span class='ui-icon-loading'></span><h1></h1></div>",fakeFixLoader:function(){var t=e("."+e.mobile.activeBtnClass).first();this.element.css({top:e.support.scrollTop&&this.window.scrollTop()+this.window.height()/2||t.length&&t.offset().top||100})},checkLoaderPosition:function(){var t=this.element.offset(),n=this.window.scrollTop(),o=e.mobile.getScreenHeight();(t.top<n||t.top-n>o)&&(this.element.addClass("ui-loader-fakefix"),this.fakeFixLoader(),this.window.unbind("scroll",this.checkLoaderPosition).bind("scroll",e.proxy(this.fakeFixLoader,this)))},resetHtml:function(){this.element.html(e(this.defaultHtml).html())},show:function(o,i,a){var r,s,l;this.resetHtml(),"object"===e.type(o)?(l=e.extend({},this.options,o),o=l.theme):(l=this.options,o=o||l.theme),s=i||(!1===l.text?"":l.text),n.addClass("ui-loading"),r=l.textVisible,this.element.attr("class",t+" ui-corner-all ui-body-"+o+" ui-loader-"+(r||i||o.text?"verbose":"default")+(l.textonly||a?" ui-loader-textonly":"")),l.html?this.element.html(l.html):this.element.find("h1").text(s),this.element.appendTo(e.mobile.pageContainer),this.checkLoaderPosition(),this.window.bind("scroll",e.proxy(this.checkLoaderPosition,this))},hide:function(){n.removeClass("ui-loading"),this.options.text&&this.element.removeClass("ui-loader-fakefix"),e.mobile.window.unbind("scroll",this.fakeFixLoader),e.mobile.window.unbind("scroll",this.checkLoaderPosition)}})}(e),function(e,t,o){"$:nomunge";function i(e){return e=e||location.href,"#"+e.replace(/^[^#]*#?(.*)$/,"$1")}var a,r="hashchange",s=n,l=e.event.special,p=s.documentMode,c="on"+r in t&&(p===o||p>7);e.fn[r]=function(e){return e?this.bind(r,e):this.trigger(r)},e.fn[r].delay=50,l[r]=e.extend(l[r],{setup:function(){return!c&&void e(a.start)},teardown:function(){return!c&&void e(a.stop)}}),a=function(){function n(){var o=i(),s=g(p);o!==p?(h(p=o,s),e(t).trigger(r)):s!==p&&(location.href=location.href.replace(/#.*/,"")+s),a=setTimeout(n,e.fn[r].delay)}var a,l={},p=i(),u=function(e){return e},h=u,g=u;return l.start=function(){a||n()},l.stop=function(){a&&clearTimeout(a),a=o},t.attachEvent&&!t.addEventListener&&!c&&function(){var t,o;l.start=function(){t||(o=e.fn[r].src,o=o&&o+i(),t=e('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){o||h(i()),n()}).attr("src",o||"javascript:0").insertAfter("body")[0].contentWindow,s.onpropertychange=function(){try{"title"===event.propertyName&&(t.document.title=s.title)}catch(e){}})},l.stop=u,g=function(){return i(t.location.href)},h=function(n,o){var i=t.document,a=e.fn[r].domain;n!==o&&(i.title=s.title,i.open(),a&&i.write('<script>document.domain="'+a+'"<\/script>'),i.close(),t.location.hash=n)}}(),l}()}(e,this),function(e){t.matchMedia=t.matchMedia||function(e){var t,n=e.documentElement,o=n.firstElementChild||n.firstChild,i=e.createElement("body"),a=e.createElement("div");return a.id="mq-test-1",a.style.cssText="position:absolute;top:-100em",i.style.background="none",i.appendChild(a),function(e){return a.innerHTML='&shy;<style media="'+e+'"> #mq-test-1 { width: 42px; }</style>',n.insertBefore(i,o),t=42===a.offsetWidth,n.removeChild(i),{matches:t,media:e}}}(n),e.mobile.media=function(e){return t.matchMedia(e).matches}}(e),function(e){var t={touch:"ontouchend"in n};e.mobile.support=e.mobile.support||{},e.extend(e.support,t),e.extend(e.mobile.support,t)}(e),function(e){e.extend(e.support,{orientation:"orientation"in t&&"onorientationchange"in t})}(e),function(e,o){function i(e){var t,n=e.charAt(0).toUpperCase()+e.substr(1),i=(e+" "+p.join(n+" ")+n).split(" ");for(t in i)if(l[i[t]]!==o)return!0}function a(){var n=t,o=!(!n.document.createElementNS||!n.document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||n.opera&&-1===navigator.userAgent.indexOf("Chrome")),i=function(t){t&&o||e("html").addClass("ui-nosvg")},a=new n.Image;a.onerror=function(){i(!1)},a.onload=function(){i(1===a.width&&1===a.height)},a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}var r,s=e("<body>").prependTo("html"),l=s[0].style,p=["Webkit","Moz","O"],c="palmGetResource"in t,u=t.operamini&&"[object OperaMini]"==={}.toString.call(t.operamini),h=t.blackberry&&!i("-webkit-transform");e.extend(e.mobile,{browser:{}}),e.mobile.browser.oldIE=function(){var e=3,t=n.createElement("div"),o=t.all||[];do{t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><br><![endif]--\x3e"}while(o[0]);return e>4?e:!e}(),e.extend(e.support,{pushState:"pushState"in history&&"replaceState"in history&&!(t.navigator.userAgent.indexOf("Firefox")>=0&&t.top!==t)&&-1===t.navigator.userAgent.search(/CriOS/),mediaquery:e.mobile.media("only all"),cssPseudoElement:!!i("content"),touchOverflow:!!i("overflowScrolling"),cssTransform3d:function(){var i,a,r,l="transform-3d",c=e.mobile.media("(-"+p.join("-"+l+"),(-")+"-"+l+"),("+l+")");if(c)return!!c;i=n.createElement("div"),a={MozTransform:"-moz-transform",transform:"transform"},s.append(i);for(r in a)i.style[r]!==o&&(i.style[r]="translate3d( 100px, 1px, 1px )",c=t.getComputedStyle(i).getPropertyValue(a[r]));return!!c&&"none"!==c}(),boxShadow:!!i("boxShadow")&&!h,fixedPosition:function(){var e=t,n=navigator.userAgent,o=navigator.platform,i=n.match(/AppleWebKit\/([0-9]+)/),a=!!i&&i[1],r=n.match(/Fennec\/([0-9]+)/),s=!!r&&r[1],l=n.match(/Opera Mobi\/([0-9]+)/),p=!!l&&l[1];return!((o.indexOf("iPhone")>-1||o.indexOf("iPad")>-1||o.indexOf("iPod")>-1)&&a&&534>a||e.operamini&&"[object OperaMini]"==={}.toString.call(e.operamini)||l&&7458>p||n.indexOf("Android")>-1&&a&&533>a||s&&6>s||"palmGetResource"in t&&a&&534>a||n.indexOf("MeeGo")>-1&&n.indexOf("NokiaBrowser/8.5.0")>-1)}(),scrollTop:("pageXOffset"in t||"scrollTop"in n.documentElement||"scrollTop"in s[0])&&!c&&!u,dynamicBaseTag:function(){var t,n,o=location.protocol+"//"+location.host+location.pathname+"ui-dir/",i=e("head base"),a=null,r="";return i.length?r=i.attr("href"):i=a=e("<base>",{href:o}).appendTo("head"),t=e("<a href='testurl' />").prependTo(s),n=t[0].href,i[0].href=r||location.pathname,a&&a.remove(),0===n.indexOf(o)}(),cssPointerEvents:function(){var e,o=n.createElement("x"),i=n.documentElement,a=t.getComputedStyle;return"pointerEvents"in o.style&&(o.style.pointerEvents="auto",o.style.pointerEvents="x",i.appendChild(o),e=a&&"auto"===a(o,"").pointerEvents,i.removeChild(o),!!e)}(),boundingRect:function(){return"undefined"!=typeof n.createElement("div").getBoundingClientRect}(),inlineSVG:a}),s.remove(),r=function(){var e=t.navigator.userAgent;return e.indexOf("Nokia")>-1&&(e.indexOf("Symbian/3")>-1||e.indexOf("Series60/5")>-1)&&e.indexOf("AppleWebKit")>-1&&e.match(/(BrowserNG|NokiaBrowser)\/7\.[0-3]/)}(),e.mobile.gradeA=function(){return(e.support.mediaquery&&e.support.cssPseudoElement||e.mobile.browser.oldIE&&e.mobile.browser.oldIE>=8)&&(e.support.boundingRect||null!==e.fn.jquery.match(/1\.[0-7+]\.[0-9+]?/))},e.mobile.ajaxBlacklist=t.blackberry&&!t.WebKitPoint||u||r,r&&e(function(){e("head link[rel='stylesheet']").attr("rel","alternate stylesheet").attr("rel","stylesheet")}),e.support.boxShadow||e("html").addClass("ui-noboxshadow")}(e),function(e,t){var n,o=e.mobile.window,i=function(){};e.event.special.beforenavigate={setup:function(){o.on("navigate",i)},teardown:function(){o.off("navigate",i)}},e.event.special.navigate=n={bound:!1,pushStateEnabled:!0,originalEventName:void 0,isPushStateEnabled:function(){return e.support.pushState&&!0===e.mobile.pushStateEnabled&&this.isHashChangeEnabled()},isHashChangeEnabled:function(){return!0===e.mobile.hashListeningEnabled},popstate:function(t){var n=new e.Event("navigate"),i=new e.Event("beforenavigate"),a=t.originalEvent.state||{};i.originalEvent=t,o.trigger(i),i.isDefaultPrevented()||(t.historyState&&e.extend(a,t.historyState),n.originalEvent=t,setTimeout(function(){o.trigger(n,{state:a})},0))},hashchange:function(t){var n=new e.Event("navigate"),i=new e.Event("beforenavigate");i.originalEvent=t,o.trigger(i),i.isDefaultPrevented()||(n.originalEvent=t,o.trigger(n,{state:t.hashchangeState||{}}))},setup:function(){n.bound||(n.bound=!0,n.isPushStateEnabled()?(n.originalEventName="popstate",o.bind("popstate.navigate",n.popstate)):n.isHashChangeEnabled()&&(n.originalEventName="hashchange",o.bind("hashchange.navigate",n.hashchange)))}}}(e),function(e,n){var o,i,a="&ui-state=dialog";e.mobile.path=o={uiStateKey:"&ui-state",urlParseRE:/^\s*(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,getLocation:function(e){var t=e?this.parseUrl(e):location,n=this.parseUrl(e||location.href).hash;return n="#"===n?"":n,t.protocol+"//"+t.host+t.pathname+t.search+n},getDocumentUrl:function(t){return t?e.extend({},o.documentUrl):o.documentUrl.href},parseLocation:function(){return this.parseUrl(this.getLocation())},parseUrl:function(t){if("object"===e.type(t))return t;var n=o.urlParseRE.exec(t||"")||[];return{href:n[0]||"",hrefNoHash:n[1]||"",hrefNoSearch:n[2]||"",domain:n[3]||"",protocol:n[4]||"",doubleSlash:n[5]||"",authority:n[6]||"",username:n[8]||"",password:n[9]||"",host:n[10]||"",hostname:n[11]||"",port:n[12]||"",pathname:n[13]||"",directory:n[14]||"",filename:n[15]||"",search:n[16]||"",hash:n[17]||""}},makePathAbsolute:function(e,t){var n,o,i,a;if(e&&"/"===e.charAt(0))return e;for(e=e||"",t=t?t.replace(/^\/|(\/[^\/]*|[^\/]+)$/g,""):"",n=t?t.split("/"):[],o=e.split("/"),i=0;i<o.length;i++)switch(a=o[i]){case".":break;case"..":n.length&&n.pop();break;default:n.push(a)}return"/"+n.join("/")},isSameDomain:function(e,t){return o.parseUrl(e).domain===o.parseUrl(t).domain},isRelativeUrl:function(e){return""===o.parseUrl(e).protocol},isAbsoluteUrl:function(e){return""!==o.parseUrl(e).protocol},makeUrlAbsolute:function(e,t){if(!o.isRelativeUrl(e))return e;t===n&&(t=this.documentBase);var i=o.parseUrl(e),a=o.parseUrl(t),r=i.protocol||a.protocol,s=i.protocol?i.doubleSlash:i.doubleSlash||a.doubleSlash,l=i.authority||a.authority,p=""!==i.pathname;return r+s+l+o.makePathAbsolute(i.pathname||a.filename,a.pathname)+(i.search||!p&&a.search||"")+i.hash},addSearchParams:function(t,n){var i=o.parseUrl(t),a="object"==typeof n?e.param(n):n,r=i.search||"?";return i.hrefNoSearch+r+("?"!==r.charAt(r.length-1)?"&":"")+a+(i.hash||"")},convertUrlToDataUrl:function(e){var n=o.parseUrl(e);return o.isEmbeddedPage(n)?n.hash.split(a)[0].replace(/^#/,"").replace(/\?.*$/,""):o.isSameDomain(n,this.documentBase)?n.hrefNoHash.replace(this.documentBase.domain,"").split(a)[0]:t.decodeURIComponent(e)},get:function(e){return e===n&&(e=o.parseLocation().hash),o.stripHash(e).replace(/[^\/]*\.[^\/*]+$/,"")},set:function(e){location.hash=e},isPath:function(e){return/\//.test(e)},clean:function(e){return e.replace(this.documentBase.domain,"")},stripHash:function(e){return e.replace(/^#/,"")},stripQueryParams:function(e){return e.replace(/\?.*$/,"")},cleanHash:function(e){return o.stripHash(e.replace(/\?.*$/,"").replace(a,""))},isHashValid:function(e){return/^#[^#]+$/.test(e)},isExternal:function(e){var t=o.parseUrl(e);return!(!t.protocol||t.domain===this.documentUrl.domain)},hasProtocol:function(e){return/^(:?\w+:)/.test(e)},isEmbeddedPage:function(e){var t=o.parseUrl(e);return""!==t.protocol?!this.isPath(t.hash)&&t.hash&&(t.hrefNoHash===this.documentUrl.hrefNoHash||this.documentBaseDiffers&&t.hrefNoHash===this.documentBase.hrefNoHash):/^#/.test(t.href)},squash:function(e,t){var n,i,a,r,s=this.isPath(e),l=this.parseUrl(e),p=l.hash,c="";return t=t||(o.isPath(e)?o.getLocation():o.getDocumentUrl()),i=s?o.stripHash(e):e,i=o.isPath(l.hash)?o.stripHash(l.hash):i,r=i.indexOf(this.uiStateKey),r>-1&&(c=i.slice(r),i=i.slice(0,r)),n=o.makeUrlAbsolute(i,t),a=this.parseUrl(n).search,s?((o.isPath(p)||0===p.replace("#","").indexOf(this.uiStateKey))&&(p=""),c&&-1===p.indexOf(this.uiStateKey)&&(p+=c),-1===p.indexOf("#")&&""!==p&&(p="#"+p),n=o.parseUrl(n),n=n.protocol+"//"+n.host+n.pathname+a+p):n+=n.indexOf("#")>-1?c:"#"+c,n},isPreservableHash:function(e){return 0===e.replace("#","").indexOf(this.uiStateKey)},hashToSelector:function(e){var t="#"===e.substring(0,1);return t&&(e=e.substring(1)),(t?"#":"")+e.replace(/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g,"\\$1")},getFilePath:function(t){var n="&"+e.mobile.subPageUrlKey;return t&&t.split(n)[0].split(a)[0]},isFirstPageUrl:function(t){var i=o.parseUrl(o.makeUrlAbsolute(t,this.documentBase)),a=i.hrefNoHash===this.documentUrl.hrefNoHash||this.documentBaseDiffers&&i.hrefNoHash===this.documentBase.hrefNoHash,r=e.mobile.firstPage,s=r&&r[0]?r[0].id:n;return a&&(!i.hash||"#"===i.hash||s&&i.hash.replace(/^#/,"")===s)},isPermittedCrossDomainRequest:function(t,n){return e.mobile.allowCrossDomainPages&&("file:"===t.protocol||"content:"===t.protocol)&&-1!==n.search(/^https?:/)}},o.documentUrl=o.parseLocation(),i=e("head").find("base"),o.documentBase=i.length?o.parseUrl(o.makeUrlAbsolute(i.attr("href"),o.documentUrl.href)):o.documentUrl,o.documentBaseDiffers=o.documentUrl.hrefNoHash!==o.documentBase.hrefNoHash,o.getDocumentBase=function(t){return t?e.extend({},o.documentBase):o.documentBase.href},e.extend(e.mobile,{getDocumentUrl:o.getDocumentUrl,getDocumentBase:o.getDocumentBase})}(e),function(e,t){e.mobile.History=function(e,t){this.stack=e||[],this.activeIndex=t||0},e.extend(e.mobile.History.prototype,{getActive:function(){return this.stack[this.activeIndex]},getLast:function(){return this.stack[this.previousIndex]},getNext:function(){return this.stack[this.activeIndex+1]},getPrev:function(){return this.stack[this.activeIndex-1]},add:function(e,t){t=t||{},this.getNext()&&this.clearForward(),t.hash&&-1===t.hash.indexOf("#")&&(t.hash="#"+t.hash),t.url=e,this.stack.push(t),this.activeIndex=this.stack.length-1},clearForward:function(){this.stack=this.stack.slice(0,this.activeIndex+1)},find:function(e,t,n){t=t||this.stack;var o,i,a,r=t.length;for(i=0;r>i;i++)if(o=t[i],(decodeURIComponent(e)===decodeURIComponent(o.url)||decodeURIComponent(e)===decodeURIComponent(o.hash))&&(a=i,n))return a;return a},closest:function(e){var n,o=this.activeIndex;return n=this.find(e,this.stack.slice(0,o)),n===t&&(n=this.find(e,this.stack.slice(o),!0),n=n===t?n:n+o),n},direct:function(n){var o=this.closest(n.url),i=this.activeIndex;o!==t&&(this.activeIndex=o,this.previousIndex=i),i>o?(n.present||n.back||e.noop)(this.getActive(),"back"):o>i?(n.present||n.forward||e.noop)(this.getActive(),"forward"):o===t&&n.missing&&n.missing(this.getActive())}})}(e),function(e){var o=e.mobile.path,i=location.href;e.mobile.Navigator=function(t){this.history=t,this.ignoreInitialHashChange=!0,e.mobile.window.bind({"popstate.history":e.proxy(this.popstate,this),"hashchange.history":e.proxy(this.hashchange,this)})},e.extend(e.mobile.Navigator.prototype,{squash:function(i,a){var r,s,l=o.isPath(i)?o.stripHash(i):i;return s=o.squash(i),r=e.extend({hash:l,url:s},a),t.history.replaceState(r,r.title||n.title,s),r},hash:function(e,t){var n,i,a,r;return n=o.parseUrl(e),i=o.parseLocation(),i.pathname+i.search===n.pathname+n.search?a=n.hash?n.hash:n.pathname+n.search:o.isPath(e)?(r=o.parseUrl(t),a=r.pathname+r.search+(o.isPreservableHash(r.hash)?r.hash.replace("#",""):"")):a=e,a},go:function(i,a,r){var s,l,p,c,u=e.event.special.navigate.isPushStateEnabled();l=o.squash(i),p=this.hash(i,l),r&&p!==o.stripHash(o.parseLocation().hash)&&(this.preventNextHashChange=r),this.preventHashAssignPopState=!0,t.location.hash=p,this.preventHashAssignPopState=!1,s=e.extend({url:l,hash:p,title:n.title},a),u&&(c=new e.Event("popstate"),c.originalEvent={type:"popstate",state:null},this.squash(i,s),r||(this.ignorePopState=!0,e.mobile.window.trigger(c))),this.history.add(s.url,s)},popstate:function(t){var n,a;if(e.event.special.navigate.isPushStateEnabled())return this.preventHashAssignPopState?(this.preventHashAssignPopState=!1,void t.stopImmediatePropagation()):this.ignorePopState?void(this.ignorePopState=!1):!t.originalEvent.state&&1===this.history.stack.length&&this.ignoreInitialHashChange&&(this.ignoreInitialHashChange=!1,location.href===i)?void t.preventDefault():(n=o.parseLocation().hash,!t.originalEvent.state&&n?(a=this.squash(n),this.history.add(a.url,a),void(t.historyState=a)):void this.history.direct({url:(t.originalEvent.state||{}).url||n,present:function(n,o){t.historyState=e.extend({},n),t.historyState.direction=o}}))},hashchange:function(t){var i,a;if(e.event.special.navigate.isHashChangeEnabled()&&!e.event.special.navigate.isPushStateEnabled()){if(this.preventNextHashChange)return this.preventNextHashChange=!1,void t.stopImmediatePropagation();i=this.history,a=o.parseLocation().hash,this.history.direct({url:a,present:function(n,o){t.hashchangeState=e.extend({},n),t.hashchangeState.direction=o},missing:function(){i.add(a,{hash:a,title:n.title})}})}}})}(e),function(e){e.mobile.navigate=function(t,n,o){e.mobile.navigate.navigator.go(t,n,o)},e.mobile.navigate.history=new e.mobile.History,e.mobile.navigate.navigator=new e.mobile.Navigator(e.mobile.navigate.history);var t=e.mobile.path.parseLocation();e.mobile.navigate.history.add(t.href,{hash:t.hash})}(e),function(e,t){var o={animation:{},transition:{}},i=n.createElement("a"),a=["","webkit-","moz-","o-"];e.each(["animation","transition"],function(n,r){var s=0===n?r+"-name":r;e.each(a,function(n,a){return i.style[e.camelCase(a+s)]!==t?(o[r].prefix=a,!1):void 0}),o[r].duration=e.camelCase(o[r].prefix+r+"-duration"),o[r].event=e.camelCase(o[r].prefix+r+"-end"),""===o[r].prefix&&(o[r].event=o[r].event.toLowerCase())}),e.support.cssTransitions=o.transition.prefix!==t,e.support.cssAnimations=o.animation.prefix!==t,e(i).remove(),e.fn.animationComplete=function(i,a,r){var s,l,p=this,c=a&&"animation"!==a?"transition":"animation";return e.support.cssTransitions&&"transition"===c||e.support.cssAnimations&&"animation"===c?(r===t&&(e(this).context!==n&&(l=3e3*parseFloat(e(this).css(o[c].duration))),(0===l||l===t||isNaN(l))&&(l=e.fn.animationComplete.defaultDuration)),s=setTimeout(function(){e(p).off(o[c].event),i.apply(p)},l),e(this).one(o[c].event,function(){clearTimeout(s),i.call(this,arguments)})):(setTimeout(e.proxy(i,this),0),e(this))},e.fn.animationComplete.defaultDuration=1e3}(e),function(e,t,n,o){function i(e){for(;e&&"undefined"!=typeof e.originalEvent;)e=e.originalEvent;return e}function a(t,n){var a,r,s,l,p,c,u,h,g,m=t.type;if(t=e.Event(t),t.type=n,a=t.originalEvent,r=e.event.props,m.search(/^(mouse|click)/)>-1&&(r=G),a)for(u=r.length,l;u;)l=r[--u],t[l]=a[l];if(m.search(/mouse(down|up)|click/)>-1&&!t.which&&(t.which=1),-1!==m.search(/^touch/)&&(s=i(a),m=s.touches,p=s.changedTouches,c=m&&m.length?m[0]:p&&p.length?p[0]:o))for(h=0,g=C.length;g>h;h++)l=C[h],t[l]=c[l];return t}function r(t){for(var n,o,i={};t;){n=e.data(t,N);for(o in n)n[o]&&(i[o]=i.hasVirtualBinding=!0);t=t.parentNode}return i}function s(t,n){for(var o;t;){if((o=e.data(t,N))&&(!n||o[n]))return t;t=t.parentNode}return null}function l(){U=!1}function p(){U=!0}function c(){M=0,A.length=0,k=!1,p()}function u(){l()}function h(){g(),L=setTimeout(function(){L=0,c()},e.vmouse.resetTimerDuration)}function g(){L&&(clearTimeout(L),L=0)}function m(t,n,o){var i;return(o&&o[t]||!o&&s(n.target,t))&&(i=a(n,t),e(n.target).trigger(i)),i}function d(t){var n,o=e.data(t.target,S);k||M&&M===o||(n=m("v"+t.type,t))&&(n.isDefaultPrevented()&&t.preventDefault(),n.isPropagationStopped()&&t.stopPropagation(),n.isImmediatePropagationStopped()&&t.stopImmediatePropagation())}function b(t){var n,o,a,s=i(t).touches;s&&1===s.length&&(n=t.target,o=r(n),o.hasVirtualBinding&&(M=F++,e.data(n,S,M),g(),u(),x=!1,a=i(t).touches[0],O=a.pageX,D=a.pageY,m("vmouseover",t,o),m("vmousedown",t,o)))}function _(e){U||(x||m("vmousecancel",e,r(e.target)),x=!0,h())}function f(t){if(!U){var n=i(t).touches[0],o=x,a=e.vmouse.moveDistanceThreshold,s=r(t.target);x=x||Math.abs(n.pageX-O)>a||Math.abs(n.pageY-D)>a,x&&!o&&m("vmousecancel",t,s),m("vmousemove",t,s),h()}}function w(e){if(!U){p();var t,n,o=r(e.target);m("vmouseup",e,o),x||(t=m("vclick",e,o))&&t.isDefaultPrevented()&&(n=i(e).changedTouches[0],A.push({touchID:M,x:n.clientX,y:n.clientY}),k=!0),m("vmouseout",e,o),x=!1,h()}}function v(t){var n,o=e.data(t,N);if(o)for(n in o)if(o[n])return!0;return!1}function P(){}var E,T,N="virtualMouseBindings",S="virtualTouchID",I="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),C="clientX clientY pageX pageY screenX screenY".split(" "),R=e.event.mouseHooks?e.event.mouseHooks.props:[],G=e.event.props.concat(R),y={},L=0,O=0,D=0,x=!1,A=[],k=!1,U=!1,V="addEventListener"in n,W=e(n),F=1,M=0;for(e.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},T=0;T<I.length;T++)e.event.special[I[T]]=function(t){var n=t.substr(1);return{setup:function(){v(this)||e.data(this,N,{}),e.data(this,N)[t]=!0,y[t]=(y[t]||0)+1,1===y[t]&&W.bind(n,d),e(this).bind(n,P),V&&(y.touchstart=(y.touchstart||0)+1,1===y.touchstart&&W.bind("touchstart",b).bind("touchend",w).bind("touchmove",f).bind("scroll",_))},teardown:function(){--y[t],y[t]||W.unbind(n,d),V&&(--y.touchstart||W.unbind("touchstart",b).unbind("touchmove",f).unbind("touchend",w).unbind("scroll",_));var o=e(this),i=e.data(this,N);i&&(i[t]=!1),o.unbind(n,P),v(this)||o.removeData(N)}}}(I[T]);V&&n.addEventListener("click",function(t){var n,o,i,a,r,s=A.length,l=t.target;if(s)for(n=t.clientX,o=t.clientY,E=e.vmouse.clickDistanceThreshold,i=l;i;){for(a=0;s>a;a++)if(r=A[a],0,i===l&&Math.abs(r.x-n)<E&&Math.abs(r.y-o)<E||e.data(i,S)===r.touchID)return t.preventDefault(),void t.stopPropagation();i=i.parentNode}},!0)}(e,0,n),function(e,t,o){function i(t,n,i,a){var r=i.type;i.type=n,a?e.event.trigger(i,o,t):e.event.dispatch.call(t,i),i.type=r}var a=e(n),r=e.mobile.support.touch,s="touchmove scroll",l=r?"touchstart":"mousedown",p=r?"touchend":"mouseup",c=r?"touchmove":"mousemove";e.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(t,n){e.fn[n]=function(e){return e?this.bind(n,e):this.trigger(n)},e.attrFn&&(e.attrFn[n]=!0)}),e.event.special.scrollstart={enabled:!0,setup:function(){function t(e,t){n=t,i(a,n?"scrollstart":"scrollstop",e)}var n,o,a=this;e(a).bind(s,function(i){e.event.special.scrollstart.enabled&&(n||t(i,!0),clearTimeout(o),o=setTimeout(function(){t(i,!1)},50))})},teardown:function(){e(this).unbind(s)}},e.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var t=this,n=e(t),o=!1;n.bind("vmousedown",function(r){function s(){clearTimeout(c)}function l(){s(),n.unbind("vclick",p).unbind("vmouseup",s),a.unbind("vmousecancel",l)}function p(e){l(),o||u!==e.target?o&&e.stopPropagation():i(t,"tap",e)}if(o=!1,r.which&&1!==r.which)return!1;var c,u=r.target;n.bind("vmouseup",s).bind("vclick",p),a.bind("vmousecancel",l),c=setTimeout(function(){e.event.special.tap.emitTapOnTaphold||(o=!0),i(t,"taphold",e.Event("taphold",{target:u}))},e.event.special.tap.tapholdThreshold)})},teardown:function(){e(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),a.unbind("vmousecancel")}},e.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:30,verticalDistanceThreshold:30,getLocation:function(e){var n=t.pageXOffset,o=t.pageYOffset,i=e.clientX,a=e.clientY;return 0===e.pageY&&Math.floor(a)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(i)>Math.floor(e.pageX)?(i-=n,a-=o):(a<e.pageY-o||i<e.pageX-n)&&(i=e.pageX-n,a=e.pageY-o),{x:i,y:a}},start:function(t){var n=t.originalEvent.touches?t.originalEvent.touches[0]:t,o=e.event.special.swipe.getLocation(n);return{time:(new Date).getTime(),coords:[o.x,o.y],origin:e(t.target)}},stop:function(t){var n=t.originalEvent.touches?t.originalEvent.touches[0]:t,o=e.event.special.swipe.getLocation(n);return{time:(new Date).getTime(),coords:[o.x,o.y]}},handleSwipe:function(t,n,o,a){if(n.time-t.time<e.event.special.swipe.durationThreshold&&Math.abs(t.coords[0]-n.coords[0])>e.event.special.swipe.horizontalDistanceThreshold&&Math.abs(t.coords[1]-n.coords[1])<e.event.special.swipe.verticalDistanceThreshold){var r=t.coords[0]>n.coords[0]?"swipeleft":"swiperight";return i(o,"swipe",e.Event("swipe",{target:a,swipestart:t,swipestop:n}),!0),i(o,r,e.Event(r,{target:a,swipestart:t,swipestop:n}),!0),!0}return!1},eventInProgress:!1,setup:function(){var t,n=this,o=e(n),i={};t=e.data(this,"mobile-events"),t||(t={length:0},e.data(this,"mobile-events",t)),t.length++,t.swipe=i,i.start=function(t){if(!e.event.special.swipe.eventInProgress){e.event.special.swipe.eventInProgress=!0;var o,r=e.event.special.swipe.start(t),s=t.target,l=!1;i.move=function(t){r&&(o=e.event.special.swipe.stop(t),l||(l=e.event.special.swipe.handleSwipe(r,o,n,s))&&(e.event.special.swipe.eventInProgress=!1),Math.abs(r.coords[0]-o.coords[0])>e.event.special.swipe.scrollSupressionThreshold&&t.preventDefault())},i.stop=function(){l=!0,e.event.special.swipe.eventInProgress=!1,a.off(c,i.move),i.move=null},a.on(c,i.move).one(p,i.stop)}},o.on(l,i.start)},teardown:function(){var t,n;t=e.data(this,"mobile-events"),t&&(n=t.swipe,delete t.swipe,0===--t.length&&e.removeData(this,"mobile-events")),n&&(n.start&&e(this).off(l,n.start),n.move&&a.off(c,n.move),n.stop&&a.off(p,n.stop))}},e.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe",swiperight:"swipe"},function(t,n){e.event.special[t]={setup:function(){e(this).bind(n,e.noop)},teardown:function(){e(this).unbind(n)}}})}(e,this),function(e){e.event.special.throttledresize={setup:function(){e(this).bind("resize",i)},teardown:function(){e(this).unbind("resize",i)}};var t,n,o,i=function(){n=(new Date).getTime(),o=n-a,o>=250?(a=n,e(this).trigger("throttledresize")):(t&&clearTimeout(t),t=setTimeout(i,250-o))},a=0}(e),function(e,t){function o(){var e=i();e!==a&&(a=e,u.trigger(h))}var i,a,r,s,l,p,c,u=e(t),h="orientationchange",g={0:!0,180:!0};e.support.orientation&&(l=t.innerWidth||u.width(),p=t.innerHeight||u.height(),c=50,r=l>p&&l-p>c,s=g[t.orientation],(r&&s||!r&&!s)&&(g={"-90":!0,90:!0})),e.event.special.orientationchange=e.extend({},e.event.special.orientationchange,{setup:function(){return!(e.support.orientation&&!e.event.special.orientationchange.disabled)&&(a=i(),void u.bind("throttledresize",o))},teardown:function(){return!(e.support.orientation&&!e.event.special.orientationchange.disabled)&&void u.unbind("throttledresize",o)},add:function(e){var t=e.handler;e.handler=function(e){return e.orientation=i(),t.apply(this,arguments)}}}),e.event.special.orientationchange.orientation=i=function(){var o=!0,i=n.documentElement;return o=e.support.orientation?g[t.orientation]:i&&i.clientWidth/i.clientHeight<1.1,o?"portrait":"landscape"},e.fn[h]=function(e){return e?this.bind(h,e):this.trigger(h)},e.attrFn&&(e.attrFn[h]=!0)}(e,this),function(e){var t=e("head").children("base"),n={element:t.length?t:e("<base>",{href:e.mobile.path.documentBase.hrefNoHash}).prependTo(e("head")),linkSelector:"[src], link[href], a[rel='external'], :jqmData(ajax='false'), a[target]",set:function(t){e.mobile.dynamicBaseEnabled&&e.support.dynamicBaseTag&&n.element.attr("href",e.mobile.path.makeUrlAbsolute(t,e.mobile.path.documentBase))},rewrite:function(t,o){var i=e.mobile.path.get(t);o.find(n.linkSelector).each(function(t,n){var o=e(n).is("[href]")?"href":e(n).is("[src]")?"src":"action",a=e(n).attr(o);a=a.replace(location.protocol+"//"+location.host+location.pathname,""),/^(\w+:|#|\/)/.test(a)||e(n).attr(o,i+a)})},reset:function(){n.element.attr("href",e.mobile.path.documentBase.hrefNoSearch)}};e.mobile.base=n}(e),function(e,t){e.mobile.widgets={};var n=e.widget,o=e.mobile.keepNative;e.widget=function(n){return function(){var o=n.apply(this,arguments),i=o.prototype.widgetName;return o.initSelector=o.prototype.initSelector!==t?o.prototype.initSelector:":jqmData(role='"+i+"')",e.mobile.widgets[i]=o,o}}(e.widget),e.extend(e.widget,n),e.mobile.document.on("create",function(t){e(t.target).enhanceWithin()}),e.widget("mobile.page",{options:{theme:"a",domCache:!1,keepNativeDefault:e.mobile.keepNative,contentTheme:null,enhanced:!1},_createWidget:function(){e.Widget.prototype._createWidget.apply(this,arguments),this._trigger("init")},_create:function(){return!1!==this._trigger("beforecreate")&&(this.options.enhanced||this._enhance(),this._on(this.element,{pagebeforehide:"removeContainerBackground",pagebeforeshow:"_handlePageBeforeShow"}),this.element.enhanceWithin(),void("dialog"===e.mobile.getAttribute(this.element[0],"role")&&e.mobile.dialog&&this.element.dialog()))},_enhance:function(){var n="data-"+e.mobile.ns,o=this;this.options.role&&this.element.attr("data-"+e.mobile.ns+"role",this.options.role),this.element.attr("tabindex","0").addClass("ui-page ui-page-theme-"+this.options.theme),this.element.find("["+n+"role='content']").each(function(){var i=e(this),a=this.getAttribute(n+"theme")||t;o.options.contentTheme=a||o.options.contentTheme||o.options.dialog&&o.options.theme||"dialog"===o.element.jqmData("role")&&o.options.theme,i.addClass("ui-content"),o.options.contentTheme&&i.addClass("ui-body-"+o.options.contentTheme),i.attr("role","main").addClass("ui-content")})},bindRemove:function(t){var n=this.element;!n.data("mobile-page").options.domCache&&n.is(":jqmData(external-page='true')")&&n.bind("pagehide.remove",t||function(t,n){if(!n.samePage){var o=e(this),i=new e.Event("pageremove");o.trigger(i),i.isDefaultPrevented()||o.removeWithDependents()}})},_setOptions:function(n){n.theme!==t&&this.element.removeClass("ui-page-theme-"+this.options.theme).addClass("ui-page-theme-"+n.theme),n.contentTheme!==t&&this.element.find("[data-"+e.mobile.ns+"='content']").removeClass("ui-body-"+this.options.contentTheme).addClass("ui-body-"+n.contentTheme)},_handlePageBeforeShow:function(){this.setContainerBackground()},removeContainerBackground:function(){
this.element.closest(":mobile-pagecontainer").pagecontainer({theme:"none"})},setContainerBackground:function(e){this.element.parent().pagecontainer({theme:e||this.options.theme})},keepNativeSelector:function(){var t=this.options,n=e.trim(t.keepNative||""),i=e.trim(e.mobile.keepNative),a=e.trim(t.keepNativeDefault),r=o===i?"":i,s=""===r?a:"";return(n?[n]:[]).concat(r?[r]:[]).concat(s?[s]:[]).join(", ")}})}(e),function(e,o){e.widget("mobile.pagecontainer",{options:{theme:"a"},initSelector:!1,_create:function(){this.setLastScrollEnabled=!0,this._on(this.window,{navigate:"_disableRecordScroll",scrollstop:"_delayedRecordScroll"}),this._on(this.window,{navigate:"_filterNavigateEvents"}),this._on({pagechange:"_afterContentChange"}),this.window.one("navigate",e.proxy(function(){this.setLastScrollEnabled=!0},this))},_setOptions:function(e){e.theme!==o&&"none"!==e.theme?this.element.removeClass("ui-overlay-"+this.options.theme).addClass("ui-overlay-"+e.theme):e.theme!==o&&this.element.removeClass("ui-overlay-"+this.options.theme),this._super(e)},_disableRecordScroll:function(){this.setLastScrollEnabled=!1},_enableRecordScroll:function(){this.setLastScrollEnabled=!0},_afterContentChange:function(){this.setLastScrollEnabled=!0,this._off(this.window,"scrollstop"),this._on(this.window,{scrollstop:"_delayedRecordScroll"})},_recordScroll:function(){if(this.setLastScrollEnabled){var e,t,n,o=this._getActiveHistory();o&&(e=this._getScroll(),t=this._getMinScroll(),n=this._getDefaultScroll(),o.lastScroll=t>e?n:e)}},_delayedRecordScroll:function(){setTimeout(e.proxy(this,"_recordScroll"),100)},_getScroll:function(){return this.window.scrollTop()},_getMinScroll:function(){return e.mobile.minScrollBack},_getDefaultScroll:function(){return e.mobile.defaultHomeScroll},_filterNavigateEvents:function(t,n){var o;t.originalEvent&&t.originalEvent.isDefaultPrevented()||(o=t.originalEvent.type.indexOf("hashchange")>-1?n.state.hash:n.state.url,o||(o=this._getHash()),o&&"#"!==o&&0!==o.indexOf("#"+e.mobile.path.uiStateKey)||(o=location.href),this._handleNavigate(o,n.state))},_getHash:function(){return e.mobile.path.parseLocation().hash},getActivePage:function(){return this.activePage},_getInitialContent:function(){return e.mobile.firstPage},_getHistory:function(){return e.mobile.navigate.history},_getActiveHistory:function(){return e.mobile.navigate.history.getActive()},_getDocumentBase:function(){return e.mobile.path.documentBase},back:function(){this.go(-1)},forward:function(){this.go(1)},go:function(n){if(e.mobile.hashListeningEnabled)t.history.go(n);else{var o=e.mobile.navigate.history.activeIndex,i=o+parseInt(n,10),a=e.mobile.navigate.history.stack[i].url,r=n>=1?"forward":"back";e.mobile.navigate.history.activeIndex=i,e.mobile.navigate.history.previousIndex=o,this.change(a,{direction:r,changeHash:!1,fromHashChange:!0})}},_handleDestination:function(t){var n;return"string"===e.type(t)&&(t=e.mobile.path.stripHash(t)),t&&(n=this._getHistory(),(t=e.mobile.path.isPath(t)?t:e.mobile.path.makeUrlAbsolute("#"+t,this._getDocumentBase()))===e.mobile.path.makeUrlAbsolute("#"+n.initialDst,this._getDocumentBase())&&n.stack.length&&n.stack[0].url!==n.initialDst.replace(e.mobile.dialogHashKey,"")&&(t=this._getInitialContent())),t||this._getInitialContent()},_handleDialog:function(t,n){var o,i,a=this.getActivePage();return a&&!a.hasClass("ui-dialog")?("back"===n.direction?this.back():this.forward(),!1):(o=n.pageUrl,i=this._getActiveHistory(),e.extend(t,{role:i.role,transition:i.transition,reverse:"back"===n.direction}),o)},_handleNavigate:function(t,n){var i=e.mobile.path.stripHash(t),a=this._getHistory(),r=0===a.stack.length?"none":o,s={changeHash:!1,fromHashChange:!0,reverse:"back"===n.direction};e.extend(s,n,{transition:(a.getLast()||{}).transition||r}),a.activeIndex>0&&i.indexOf(e.mobile.dialogHashKey)>-1&&a.initialDst!==i&&!1===(i=this._handleDialog(s,n))||this._changeContent(this._handleDestination(i),s)},_changeContent:function(t,n){e.mobile.changePage(t,n)},_getBase:function(){return e.mobile.base},_getNs:function(){return e.mobile.ns},_enhance:function(e,t){return e.page({role:t})},_include:function(e,t){e.appendTo(this.element),this._enhance(e,t.role),e.page("bindRemove")},_find:function(t){var n,o=this._createFileUrl(t),i=this._createDataUrl(t),a=this._getInitialContent();return n=this.element.children("[data-"+this._getNs()+"url='"+i+"']"),0===n.length&&i&&!e.mobile.path.isPath(i)&&(n=this.element.children(e.mobile.path.hashToSelector("#"+i)).attr("data-"+this._getNs()+"url",i).jqmData("url",i)),0===n.length&&e.mobile.path.isFirstPageUrl(o)&&a&&a.parent().length&&(n=e(a)),n},_getLoader:function(){return e.mobile.loading()},_showLoading:function(t,n,o,i){this._loadMsg||(this._loadMsg=setTimeout(e.proxy(function(){this._getLoader().loader("show",n,o,i),this._loadMsg=0},this),t))},_hideLoading:function(){clearTimeout(this._loadMsg),this._loadMsg=0,this._getLoader().loader("hide")},_showError:function(){this._hideLoading(),this._showLoading(0,e.mobile.pageLoadErrorMessageTheme,e.mobile.pageLoadErrorMessage,!0),setTimeout(e.proxy(this,"_hideLoading"),1500)},_parse:function(t,n){var o,i=e("<div></div>");return i.get(0).innerHTML=t,o=i.find(":jqmData(role='page'), :jqmData(role='dialog')").first(),o.length||(o=e("<div data-"+this._getNs()+"role='page'>"+(t.split(/<\/?body[^>]*>/gim)[1]||"")+"</div>")),o.attr("data-"+this._getNs()+"url",e.mobile.path.convertUrlToDataUrl(n)).attr("data-"+this._getNs()+"external-page",!0),o},_setLoadedTitle:function(t,n){var o=n.match(/<title[^>]*>([^<]*)/)&&RegExp.$1;o&&!t.jqmData("title")&&(o=e("<div>"+o+"</div>").text(),t.jqmData("title",o))},_isRewritableBaseTag:function(){return e.mobile.dynamicBaseEnabled&&!e.support.dynamicBaseTag},_createDataUrl:function(t){return e.mobile.path.convertUrlToDataUrl(t)},_createFileUrl:function(t){return e.mobile.path.getFilePath(t)},_triggerWithDeprecated:function(t,n,o){var i=e.Event("page"+t),a=e.Event(this.widgetName+t);return(o||this.element).trigger(i,n),this.element.trigger(a,n),{deprecatedEvent:i,event:a}},_loadSuccess:function(t,n,i,a){var r=this._createFileUrl(t),s=this._createDataUrl(t);return e.proxy(function(l,p,c){var u,h=new RegExp("(<[^>]+\\bdata-"+this._getNs()+"role=[\"']?page[\"']?[^>]*>)"),g=new RegExp("\\bdata-"+this._getNs()+"url=[\"']?([^\"'>]*)[\"']?");h.test(l)&&RegExp.$1&&g.test(RegExp.$1)&&RegExp.$1&&(r=e.mobile.path.getFilePath(e("<div>"+RegExp.$1+"</div>").text())),i.prefetch===o&&this._getBase().set(r),u=this._parse(l,r),this._setLoadedTitle(u,l),n.xhr=c,n.textStatus=p,n.page=u,n.content=u,this._trigger("load",o,n)&&(this._isRewritableBaseTag()&&u&&this._getBase().rewrite(r,u),this._include(u,i),t.indexOf("&"+e.mobile.subPageUrlKey)>-1&&(u=this.element.children("[data-"+this._getNs()+"url='"+s+"']")),i.showLoadMsg&&this._hideLoading(),this.element.trigger("pageload"),a.resolve(t,i,u))},this)},_loadDefaults:{type:"get",data:o,reloadPage:!1,reload:!1,role:o,showLoadMsg:!1,loadMsgDelay:50},load:function(t,n){var i,a,r,s,l=n&&n.deferred||e.Deferred(),p=e.extend({},this._loadDefaults,n),c=null,u=e.mobile.path.makeUrlAbsolute(t,this._findBaseWithDefault());return p.reload=p.reloadPage,p.data&&"get"===p.type&&(u=e.mobile.path.addSearchParams(u,p.data),p.data=o),p.data&&"post"===p.type&&(p.reload=!0),i=this._createFileUrl(u),a=this._createDataUrl(u),c=this._find(u),0===c.length&&e.mobile.path.isEmbeddedPage(i)&&!e.mobile.path.isFirstPageUrl(i)?void l.reject(u,p):(this._getBase().reset(),c.length&&!p.reload?(this._enhance(c,p.role),l.resolve(u,p,c),void(p.prefetch||this._getBase().set(t))):(s={url:t,absUrl:u,dataUrl:a,deferred:l,options:p},r=this._triggerWithDeprecated("beforeload",s),r.deprecatedEvent.isDefaultPrevented()||r.event.isDefaultPrevented()?void 0:(p.showLoadMsg&&this._showLoading(p.loadMsgDelay),p.prefetch===o&&this._getBase().reset(),e.mobile.allowCrossDomainPages||e.mobile.path.isSameDomain(e.mobile.path.documentUrl,u)?void e.ajax({url:i,type:p.type,data:p.data,contentType:p.contentType,dataType:"html",success:this._loadSuccess(u,s,p,l),error:this._loadError(u,s,p,l)}):void l.reject(u,p))))},_loadError:function(t,n,o,i){return e.proxy(function(a,r,s){this._getBase().set(e.mobile.path.get()),n.xhr=a,n.textStatus=r,n.errorThrown=s;var l=this._triggerWithDeprecated("loadfailed",n);l.deprecatedEvent.isDefaultPrevented()||l.event.isDefaultPrevented()||(o.showLoadMsg&&this._showError(),i.reject(t,o))},this)},_getTransitionHandler:function(t){return t=e.mobile._maybeDegradeTransition(t),e.mobile.transitionHandlers[t]||e.mobile.defaultTransitionHandler},_triggerCssTransitionEvents:function(t,n,o){var i=!1;o=o||"",n&&(t[0]===n[0]&&(i=!0),this._triggerWithDeprecated(o+"hide",{nextPage:t,samePage:i},n)),this._triggerWithDeprecated(o+"show",{prevPage:n||e("")},t)},_cssTransition:function(t,n,o){var i,a,r=o.transition,s=o.reverse,l=o.deferred;this._triggerCssTransitionEvents(t,n,"before"),this._hideLoading(),i=this._getTransitionHandler(r),a=new i(r,s,t,n).transition(),a.done(function(){l.resolve.apply(l,arguments)}),a.done(e.proxy(function(){this._triggerCssTransitionEvents(t,n)},this))},_releaseTransitionLock:function(){a=!1,i.length>0&&e.mobile.changePage.apply(null,i.pop())},_removeActiveLinkClass:function(t){e.mobile.removeActiveLinkClass(t)},_loadUrl:function(t,n,o){o.target=t,o.deferred=e.Deferred(),this.load(t,o),o.deferred.done(e.proxy(function(e,t,o){a=!1,t.absUrl=n.absUrl,this.transition(o,n,t)},this)),o.deferred.fail(e.proxy(function(){this._removeActiveLinkClass(!0),this._releaseTransitionLock(),this._triggerWithDeprecated("changefailed",n)},this))},_triggerPageBeforeChange:function(t,n,o){var i=new e.Event("pagebeforechange");return e.extend(n,{toPage:t,options:o}),n.absUrl="string"===e.type(t)?e.mobile.path.makeUrlAbsolute(t,this._findBaseWithDefault()):o.absUrl,this.element.trigger(i,n),!i.isDefaultPrevented()},change:function(t,n){if(a)return void i.unshift(arguments);var o=e.extend({},e.mobile.changePage.defaults,n),r={};o.fromPage=o.fromPage||this.activePage,this._triggerPageBeforeChange(t,r,o)&&(t=r.toPage,"string"===e.type(t)?(a=!0,this._loadUrl(t,r,o)):this.transition(t,r,o))},transition:function(t,r,s){var l,p,c,u,h,g,m,d,b,_,f,w,v;if(a)return void i.unshift([t,s]);if(this._triggerPageBeforeChange(t,r,s)&&(v=this._triggerWithDeprecated("beforetransition",r),!v.deprecatedEvent.isDefaultPrevented()&&!v.event.isDefaultPrevented())){if(a=!0,t[0]!==e.mobile.firstPage[0]||s.dataUrl||(s.dataUrl=e.mobile.path.documentUrl.hrefNoHash),l=s.fromPage,p=s.dataUrl&&e.mobile.path.convertUrlToDataUrl(s.dataUrl)||t.jqmData("url"),c=p,e.mobile.path.getFilePath(p),u=e.mobile.navigate.history.getActive(),h=0===e.mobile.navigate.history.activeIndex,g=0,m=n.title,d=("dialog"===s.role||"dialog"===t.jqmData("role"))&&!0!==t.jqmData("dialog"),l&&l[0]===t[0]&&!s.allowSamePageTransition)return a=!1,this._triggerWithDeprecated("transition",r),this.element.trigger("pagechange",r),void(s.fromHashChange&&e.mobile.navigate.history.direct({url:p}));t.page({role:s.role}),s.fromHashChange&&(g="back"===s.direction?-1:1);try{n.activeElement&&"body"!==n.activeElement.nodeName.toLowerCase()?e(n.activeElement).blur():e("input:focus, textarea:focus, select:focus").blur()}catch(P){}b=!1,d&&u&&(u.url&&u.url.indexOf(e.mobile.dialogHashKey)>-1&&this.activePage&&!this.activePage.hasClass("ui-dialog")&&e.mobile.navigate.history.activeIndex>0&&(s.changeHash=!1,b=!0),p=u.url||"",p+=!b&&p.indexOf("#")>-1?e.mobile.dialogHashKey:"#"+e.mobile.dialogHashKey,0===e.mobile.navigate.history.activeIndex&&p===e.mobile.navigate.history.initialDst&&(p+=e.mobile.dialogHashKey)),_=u?t.jqmData("title")||t.children(":jqmData(role='header')").find(".ui-title").text():m,_&&m===n.title&&(m=_),t.jqmData("title")||t.jqmData("title",m),s.transition=s.transition||(g&&!h?u.transition:o)||(d?e.mobile.defaultDialogTransition:e.mobile.defaultPageTransition),!g&&b&&(e.mobile.navigate.history.getActive().pageUrl=c),p&&!s.fromHashChange&&(!e.mobile.path.isPath(p)&&p.indexOf("#")<0&&(p="#"+p),f={transition:s.transition,title:m,pageUrl:c,role:s.role},!1!==s.changeHash&&e.mobile.hashListeningEnabled?e.mobile.navigate(p,f,!0):t[0]!==e.mobile.firstPage[0]&&e.mobile.navigate.history.add(p,f)),n.title=m,e.mobile.activePage=t,this.activePage=t,s.reverse=s.reverse||0>g,w=e.Deferred(),this._cssTransition(t,l,{transition:s.transition,reverse:s.reverse,deferred:w}),w.done(e.proxy(function(n,o,i,a,l){e.mobile.removeActiveLinkClass(),s.duplicateCachedPage&&s.duplicateCachedPage.remove(),l||e.mobile.focusPage(t),this._releaseTransitionLock(),this.element.trigger("pagechange",r),this._triggerWithDeprecated("transition",r)},this))}},_findBaseWithDefault:function(){return this.activePage&&e.mobile.getClosestBaseUrl(this.activePage)||e.mobile.path.documentBase.hrefNoHash}}),e.mobile.navreadyDeferred=e.Deferred();var i=[],a=!1}(e),function(e,n){function o(e){for(;e&&("string"!=typeof e.nodeName||"a"!==e.nodeName.toLowerCase());)e=e.parentNode;return e}var i=e.Deferred(),a=e.Deferred(),r=e.mobile.path.documentUrl,s=null;e.mobile.loadPage=function(t,n){var o;return n=n||{},o=n.pageContainer||e.mobile.pageContainer,n.deferred=e.Deferred(),o.pagecontainer("load",t,n),n.deferred.promise()},e.mobile.back=function(){var n=t.navigator;this.phonegapNavigationEnabled&&n&&n.app&&n.app.backHistory?n.app.backHistory():e.mobile.pageContainer.pagecontainer("back")},e.mobile.focusPage=function(e){var t=e.find("[autofocus]"),n=e.find(".ui-title:eq(0)");return t.length?void t.focus():void(n.length?n.focus():e.focus())},e.mobile._maybeDegradeTransition=e.mobile._maybeDegradeTransition||function(e){return e},e.mobile.changePage=function(t,n){e.mobile.pageContainer.pagecontainer("change",t,n)},e.mobile.changePage.defaults={transition:n,reverse:!1,changeHash:!0,fromHashChange:!1,role:n,duplicateCachedPage:n,pageContainer:n,showLoadMsg:!0,dataUrl:n,fromPage:n,allowSamePageTransition:!1},e.mobile._registerInternalEvents=function(){var i=function(t,n){var o,i,a,l,p=!0;return!(!e.mobile.ajaxEnabled||t.is(":jqmData(ajax='false')")||!t.jqmHijackable().length||t.attr("target"))&&(o=s&&s.attr("formaction")||t.attr("action"),l=(t.attr("method")||"get").toLowerCase(),o||(o=e.mobile.getClosestBaseUrl(t),"get"===l&&(o=e.mobile.path.parseUrl(o).hrefNoSearch),o===e.mobile.path.documentBase.hrefNoHash&&(o=r.hrefNoSearch)),o=e.mobile.path.makeUrlAbsolute(o,e.mobile.getClosestBaseUrl(t)),!(e.mobile.path.isExternal(o)&&!e.mobile.path.isPermittedCrossDomainRequest(r,o))&&(n||(i=t.serializeArray(),s&&s[0].form===t[0]&&(a=s.attr("name"))&&(e.each(i,function(e,t){return t.name===a?(a="",!1):void 0}),a&&i.push({name:a,value:s.attr("value")})),p={url:o,options:{type:l,data:e.param(i),transition:t.jqmData("transition"),reverse:"reverse"===t.jqmData("direction"),reloadPage:!0}}),p))};e.mobile.document.delegate("form","submit",function(t){var n;t.isDefaultPrevented()||(n=i(e(this)))&&(e.mobile.changePage(n.url,n.options),t.preventDefault())}),e.mobile.document.bind("vclick",function(t){var n,a,r=t.target,l=!1;if(!(t.which>1)&&e.mobile.linkBindingEnabled){if(s=e(r),e.data(r,"mobile-button")){if(!i(e(r).closest("form"),!0))return;r.parentNode&&(r=r.parentNode)}else{if(!(r=o(r))||"#"===e.mobile.path.parseUrl(r.getAttribute("href")||"#").hash)return;if(!e(r).jqmHijackable().length)return}~r.className.indexOf("ui-link-inherit")?r.parentNode&&(a=e.data(r.parentNode,"buttonElements")):a=e.data(r,"buttonElements"),a?r=a.outer:l=!0,n=e(r),l&&(n=n.closest(".ui-btn")),n.length>0&&!n.hasClass("ui-state-disabled")&&(e.mobile.removeActiveLinkClass(!0),e.mobile.activeClickedLink=n,e.mobile.activeClickedLink.addClass(e.mobile.activeBtnClass))}}),e.mobile.document.bind("click",function(i){if(e.mobile.linkBindingEnabled&&!i.isDefaultPrevented()){var a,s,l,p,c,u,h=o(i.target),g=e(h),m=function(){t.setTimeout(function(){e.mobile.removeActiveLinkClass(!0)},200)};if(e.mobile.activeClickedLink&&e.mobile.activeClickedLink[0]===i.target.parentNode&&m(),h&&!(i.which>1)&&g.jqmHijackable().length){if(g.is(":jqmData(rel='back')"))return e.mobile.back(),!1;if(a=e.mobile.getClosestBaseUrl(g),s=e.mobile.path.makeUrlAbsolute(g.attr("href")||"#",a),!e.mobile.ajaxEnabled&&!e.mobile.path.isEmbeddedPage(s))return void m();if(-1!==s.search("#")){if(!(s=s.replace(/[^#]*#/,"")))return void i.preventDefault();s=e.mobile.path.isPath(s)?e.mobile.path.makeUrlAbsolute(s,a):e.mobile.path.makeUrlAbsolute("#"+s,r.hrefNoHash)}if(l=g.is("[rel='external']")||g.is(":jqmData(ajax='false')")||g.is("[target]"),l||e.mobile.path.isExternal(s)&&!e.mobile.path.isPermittedCrossDomainRequest(r,s))return void m();p=g.jqmData("transition"),c="reverse"===g.jqmData("direction")||g.jqmData("back"),u=g.attr("data-"+e.mobile.ns+"rel")||n,e.mobile.changePage(s,{transition:p,reverse:c,role:u,link:g}),i.preventDefault()}}}),e.mobile.document.delegate(".ui-page","pageshow.prefetch",function(){var t=[];e(this).find("a:jqmData(prefetch)").each(function(){var n=e(this),o=n.attr("href");o&&-1===e.inArray(o,t)&&(t.push(o),e.mobile.loadPage(o,{role:n.attr("data-"+e.mobile.ns+"rel"),prefetch:!0}))})}),e.mobile.pageContainer.pagecontainer(),e.mobile.document.bind("pageshow",function(){a?a.done(e.mobile.resetActivePageHeight):e.mobile.resetActivePageHeight()}),e.mobile.window.bind("throttledresize",e.mobile.resetActivePageHeight)},e(function(){i.resolve()}),e.mobile.window.load(function(){a.resolve(),a=null}),e.when(i,e.mobile.navreadyDeferred).done(function(){e.mobile._registerInternalEvents()})}(e),function(e,t){e.mobile.Transition=function(){this.init.apply(this,arguments)},e.extend(e.mobile.Transition.prototype,{toPreClass:" ui-page-pre-in",init:function(t,n,o,i){e.extend(this,{name:t,reverse:n,$to:o,$from:i,deferred:new e.Deferred})},cleanFrom:function(){this.$from.removeClass(e.mobile.activePageClass+" out in reverse "+this.name).height("")},beforeDoneIn:function(){},beforeDoneOut:function(){},beforeStartOut:function(){},doneIn:function(){this.beforeDoneIn(),this.$to.removeClass("out in reverse "+this.name).height(""),this.toggleViewportClass(),e.mobile.window.scrollTop()!==this.toScroll&&this.scrollPage(),this.sequential||this.$to.addClass(e.mobile.activePageClass),this.deferred.resolve(this.name,this.reverse,this.$to,this.$from,!0)},doneOut:function(e,t,n,o){this.beforeDoneOut(),this.startIn(e,t,n,o)},hideIn:function(e){this.$to.css("z-index",-10),e.call(this),this.$to.css("z-index","")},scrollPage:function(){e.event.special.scrollstart.enabled=!1,(e.mobile.hideUrlBar||this.toScroll!==e.mobile.defaultHomeScroll)&&t.scrollTo(0,this.toScroll),setTimeout(function(){e.event.special.scrollstart.enabled=!0},150)},startIn:function(t,n,o,i){this.hideIn(function(){this.$to.addClass(e.mobile.activePageClass+this.toPreClass),i||e.mobile.focusPage(this.$to),this.$to.height(t+this.toScroll),o||this.scrollPage()}),this.$to.removeClass(this.toPreClass).addClass(this.name+" in "+n),o?this.doneIn():this.$to.animationComplete(e.proxy(function(){this.doneIn()},this))},startOut:function(t,n,o){this.beforeStartOut(t,n,o),this.$from.height(t+e.mobile.window.scrollTop()).addClass(this.name+" out"+n)},toggleViewportClass:function(){e.mobile.pageContainer.toggleClass("ui-mobile-viewport-transitioning viewport-"+this.name)},transition:function(){var t,n=this.reverse?" reverse":"",o=e.mobile.getScreenHeight(),i=!1!==e.mobile.maxTransitionWidth&&e.mobile.window.width()>e.mobile.maxTransitionWidth;return this.toScroll=e.mobile.navigate.history.getActive().lastScroll||e.mobile.defaultHomeScroll,t=!e.support.cssTransitions||!e.support.cssAnimations||i||!this.name||"none"===this.name||Math.max(e.mobile.window.scrollTop(),this.toScroll)>e.mobile.getMaxScrollForTransition(),this.toggleViewportClass(),this.$from&&!t?this.startOut(o,n,t):this.doneOut(o,n,t,!0),this.deferred.promise()}})}(e,this),function(e){e.mobile.SerialTransition=function(){this.init.apply(this,arguments)},e.extend(e.mobile.SerialTransition.prototype,e.mobile.Transition.prototype,{sequential:!0,beforeDoneOut:function(){this.$from&&this.cleanFrom()},beforeStartOut:function(t,n,o){this.$from.animationComplete(e.proxy(function(){this.doneOut(t,n,o)},this))}})}(e),function(e){e.mobile.ConcurrentTransition=function(){this.init.apply(this,arguments)},e.extend(e.mobile.ConcurrentTransition.prototype,e.mobile.Transition.prototype,{sequential:!1,beforeDoneIn:function(){this.$from&&this.cleanFrom()},beforeStartOut:function(e,t,n){this.doneOut(e,t,n)}})}(e),function(e){var t=function(){return 3*e.mobile.getScreenHeight()};e.mobile.transitionHandlers={sequential:e.mobile.SerialTransition,simultaneous:e.mobile.ConcurrentTransition},e.mobile.defaultTransitionHandler=e.mobile.transitionHandlers.sequential,e.mobile.transitionFallbacks={},e.mobile._maybeDegradeTransition=function(t){return t&&!e.support.cssTransform3d&&e.mobile.transitionFallbacks[t]&&(t=e.mobile.transitionFallbacks[t]),t},e.mobile.getMaxScrollForTransition=e.mobile.getMaxScrollForTransition||t}(e),function(e){e.mobile.transitionFallbacks.flip="fade"}(e),function(e){e.mobile.transitionFallbacks.flow="fade"}(e),function(e){e.mobile.transitionFallbacks.pop="fade"}(e),function(e){e.mobile.transitionHandlers.slide=e.mobile.transitionHandlers.simultaneous,e.mobile.transitionFallbacks.slide="fade"}(e),function(e){e.mobile.transitionFallbacks.slidedown="fade"}(e),function(e){e.mobile.transitionFallbacks.slidefade="fade"}(e),function(e){e.mobile.transitionFallbacks.slideup="fade"}(e),function(e){e.mobile.transitionFallbacks.turn="fade"}(e),function(e){e.mobile.degradeInputs={color:!1,date:!1,datetime:!1,"datetime-local":!1,email:!1,month:!1,number:!1,range:"number",search:"text",tel:!1,time:!1,url:!1,week:!1},e.mobile.page.prototype.options.degradeInputs=e.mobile.degradeInputs,e.mobile.degradeInputsWithin=function(t){t=e(t),t.find("input").not(e.mobile.page.prototype.keepNativeSelector()).each(function(){var t,n,o,i,a=e(this),r=this.getAttribute("type"),s=e.mobile.degradeInputs[r]||"text";e.mobile.degradeInputs[r]&&(t=e("<div>").html(a.clone()).html(),n=t.indexOf(" type=")>-1,o=n?/\s+type=["']?\w+['"]?/:/\/?>/,i=' type="'+s+'" data-'+e.mobile.ns+'type="'+r+'"'+(n?"":">"),a.replaceWith(t.replace(o,i)))})}}(e),function(e,t,n){e.widget("mobile.page",e.mobile.page,{options:{closeBtn:"left",closeBtnText:"Close",overlayTheme:"a",corners:!0,dialog:!1},_create:function(){this._super(),this.options.dialog&&(e.extend(this,{_inner:this.element.children(),_headerCloseButton:null}),this.options.enhanced||this._setCloseBtn(this.options.closeBtn))},_enhance:function(){this._super(),this.options.dialog&&this.element.addClass("ui-dialog").wrapInner(e("<div/>",{role:"dialog","class":"ui-dialog-contain ui-overlay-shadow"+(this.options.corners?" ui-corner-all":"")}))},_setOptions:function(t){var o,i,a=this.options;t.corners!==n&&this._inner.toggleClass("ui-corner-all",!!t.corners),t.overlayTheme!==n&&e.mobile.activePage[0]===this.element[0]&&(a.overlayTheme=t.overlayTheme,this._handlePageBeforeShow()),t.closeBtnText!==n&&(o=a.closeBtn,i=t.closeBtnText),t.closeBtn!==n&&(o=t.closeBtn),o&&this._setCloseBtn(o,i),this._super(t)},_handlePageBeforeShow:function(){this.options.overlayTheme&&this.options.dialog?(this.removeContainerBackground(),this.setContainerBackground(this.options.overlayTheme)):this._super()},_setCloseBtn:function(t,n){var o,i=this._headerCloseButton;t="left"===t?"left":"right"===t?"right":"none","none"===t?i&&(i.remove(),i=null):i?(i.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-"+t),n&&i.text(n)):(o=this._inner.find(":jqmData(role='header')").first(),i=e("<a></a>",{href:"#","class":"ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-"+t}).attr("data-"+e.mobile.ns+"rel","back").text(n||this.options.closeBtnText||"").prependTo(o)),this._headerCloseButton=i}})}(e),function(e,t,n){e.widget("mobile.dialog",{options:{closeBtn:"left",closeBtnText:"Close",overlayTheme:"a",corners:!0},_handlePageBeforeShow:function(){this._isCloseable=!0,this.options.overlayTheme&&this.element.page("removeContainerBackground").page("setContainerBackground",this.options.overlayTheme)},_handlePageBeforeHide:function(){this._isCloseable=!1},_handleVClickSubmit:function(t){var n,o=e(t.target).closest("vclick"===t.type?"a":"form");o.length&&!o.jqmData("transition")&&(n={},n["data-"+e.mobile.ns+"transition"]=(e.mobile.navigate.history.getActive()||{}).transition||e.mobile.defaultDialogTransition,n["data-"+e.mobile.ns+"direction"]="reverse",o.attr(n))},_create:function(){var t=this.element,n=this.options;t.addClass("ui-dialog").wrapInner(e("<div/>",{role:"dialog","class":"ui-dialog-contain ui-overlay-shadow"+(n.corners?" ui-corner-all":"")})),e.extend(this,{_isCloseable:!1,_inner:t.children(),_headerCloseButton:null}),this._on(t,{vclick:"_handleVClickSubmit",submit:"_handleVClickSubmit",pagebeforeshow:"_handlePageBeforeShow",pagebeforehide:"_handlePageBeforeHide"}),this._setCloseBtn(n.closeBtn)},_setOptions:function(t){var o,i,a=this.options;t.corners!==n&&this._inner.toggleClass("ui-corner-all",!!t.corners),t.overlayTheme!==n&&e.mobile.activePage[0]===this.element[0]&&(a.overlayTheme=t.overlayTheme,this._handlePageBeforeShow()),t.closeBtnText!==n&&(o=a.closeBtn,i=t.closeBtnText),t.closeBtn!==n&&(o=t.closeBtn),o&&this._setCloseBtn(o,i),this._super(t)},_setCloseBtn:function(t,n){var o,i=this._headerCloseButton;t="left"===t?"left":"right"===t?"right":"none","none"===t?i&&(i.remove(),i=null):i?(i.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-"+t),n&&i.text(n)):(o=this._inner.find(":jqmData(role='header')").first(),i=e("<a></a>",{role:"button",href:"#","class":"ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-"+t}).text(n||this.options.closeBtnText||"").prependTo(o),this._on(i,{click:"close"})),this._headerCloseButton=i},close:function(){var t=e.mobile.navigate.history;this._isCloseable&&(this._isCloseable=!1,e.mobile.hashListeningEnabled&&t.activeIndex>0?e.mobile.back():e.mobile.pageContainer.pagecontainer("back"))}})}(e),function(e,t){var n=function(e){return"ui-btn-icon-"+(null===e?"left":e)};e.widget("mobile.collapsible",{options:{enhanced:!1,expandCueText:null,collapseCueText:null,collapsed:!0,heading:"h1,h2,h3,h4,h5,h6,legend",collapsedIcon:null,expandedIcon:null,iconpos:null,theme:null,contentTheme:null,inset:null,corners:null,mini:null},_create:function(){var t=this.element,n={accordion:t.closest(":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')"+(e.mobile.collapsibleset?", :mobile-collapsibleset":"")).addClass("ui-collapsible-set")};this._ui=n,this._renderedOptions=this._getOptions(this.options),this.options.enhanced?(n.heading=e(".ui-collapsible-heading",this.element[0]),n.content=n.heading.next(),n.anchor=e("a",n.heading[0]).first(),n.status=n.anchor.children(".ui-collapsible-heading-status")):this._enhance(t,n),this._on(n.heading,{tap:function(){n.heading.find("a").first().addClass(e.mobile.activeBtnClass)},click:function(e){this._handleExpandCollapse(!n.heading.hasClass("ui-collapsible-heading-collapsed")),e.preventDefault(),e.stopPropagation()}})},_getOptions:function(t){var n,o=this._ui.accordion,i=this._ui.accordionWidget;t=e.extend({},t),o.length&&!i&&(this._ui.accordionWidget=i=o.data("mobile-collapsibleset"));for(n in t)t[n]=null!=t[n]?t[n]:i?i.options[n]:o.length?e.mobile.getAttribute(o[0],n.replace(/([A-Z])/g,"-$1").toLowerCase()):null,null==t[n]&&(t[n]=e.mobile.collapsible.defaults[n]);return t},_themeClassFromOption:function(e,t){return t?"none"===t?"":e+t:""},_enhance:function(t,o){var i,a=this._renderedOptions,r=this._themeClassFromOption("ui-body-",a.contentTheme);return t.addClass("ui-collapsible "+(a.inset?"ui-collapsible-inset ":"")+(a.inset&&a.corners?"ui-corner-all ":"")+(r?"ui-collapsible-themed-content ":"")),o.originalHeading=t.children(this.options.heading).first(),o.content=t.wrapInner("<div class='ui-collapsible-content "+r+"'></div>").children(".ui-collapsible-content"),o.heading=o.originalHeading,o.heading.is("legend")&&(o.heading=e("<div role='heading'>"+o.heading.html()+"</div>"),o.placeholder=e("<div>\x3c!-- placeholder for legend --\x3e</div>").insertBefore(o.originalHeading),o.originalHeading.remove()),i=a.collapsed?a.collapsedIcon?"ui-icon-"+a.collapsedIcon:"":a.expandedIcon?"ui-icon-"+a.expandedIcon:"",o.status=e("<span class='ui-collapsible-heading-status'></span>"),o.anchor=o.heading.detach().addClass("ui-collapsible-heading").append(o.status).wrapInner("<a href='#' class='ui-collapsible-heading-toggle'></a>").find("a").first().addClass("ui-btn "+(i?i+" ":"")+(i?n(a.iconpos)+" ":"")+this._themeClassFromOption("ui-btn-",a.theme)+" "+(a.mini?"ui-mini ":"")),o.heading.insertBefore(o.content),this._handleExpandCollapse(this.options.collapsed),o},refresh:function(){this._applyOptions(this.options),this._renderedOptions=this._getOptions(this.options)},_applyOptions:function(e){var o,i,a,r,s,l=this.element,p=this._renderedOptions,c=this._ui,u=c.anchor,h=c.status,g=this._getOptions(e);e.collapsed!==t&&this._handleExpandCollapse(e.collapsed),o=l.hasClass("ui-collapsible-collapsed"),o?g.expandCueText!==t&&h.text(g.expandCueText):g.collapseCueText!==t&&h.text(g.collapseCueText),s=g.collapsedIcon!==t?!1!==g.collapsedIcon:!1!==p.collapsedIcon,(g.iconpos!==t||g.collapsedIcon!==t||g.expandedIcon!==t)&&(u.removeClass([n(p.iconpos)].concat(p.expandedIcon?["ui-icon-"+p.expandedIcon]:[]).concat(p.collapsedIcon?["ui-icon-"+p.collapsedIcon]:[]).join(" ")),s&&u.addClass([n(g.iconpos!==t?g.iconpos:p.iconpos)].concat(o?["ui-icon-"+(g.collapsedIcon!==t?g.collapsedIcon:p.collapsedIcon)]:["ui-icon-"+(g.expandedIcon!==t?g.expandedIcon:p.expandedIcon)]).join(" "))),g.theme!==t&&(a=this._themeClassFromOption("ui-btn-",p.theme),i=this._themeClassFromOption("ui-btn-",g.theme),u.removeClass(a).addClass(i)),g.contentTheme!==t&&(a=this._themeClassFromOption("ui-body-",p.contentTheme),i=this._themeClassFromOption("ui-body-",g.contentTheme),c.content.removeClass(a).addClass(i)),g.inset!==t&&(l.toggleClass("ui-collapsible-inset",g.inset),r=!(!g.inset||!g.corners&&!p.corners)),g.corners!==t&&(r=!(!g.corners||!g.inset&&!p.inset)),r!==t&&l.toggleClass("ui-corner-all",r),g.mini!==t&&u.toggleClass("ui-mini",g.mini)},_setOptions:function(e){this._applyOptions(e),this._super(e),this._renderedOptions=this._getOptions(this.options)},_handleExpandCollapse:function(t){var n=this._renderedOptions,o=this._ui;o.status.text(t?n.expandCueText:n.collapseCueText),o.heading.toggleClass("ui-collapsible-heading-collapsed",t).find("a").first().toggleClass("ui-icon-"+n.expandedIcon,!t).toggleClass("ui-icon-"+n.collapsedIcon,t||n.expandedIcon===n.collapsedIcon).removeClass(e.mobile.activeBtnClass),this.element.toggleClass("ui-collapsible-collapsed",t),o.content.toggleClass("ui-collapsible-content-collapsed",t).attr("aria-hidden",t).trigger("updatelayout"),this.options.collapsed=t,this._trigger(t?"collapse":"expand")},expand:function(){this._handleExpandCollapse(!1)},collapse:function(){this._handleExpandCollapse(!0)},_destroy:function(){var e=this._ui;this.options.enhanced||(e.placeholder?(e.originalHeading.insertBefore(e.placeholder),e.placeholder.remove(),e.heading.remove()):(e.status.remove(),e.heading.removeClass("ui-collapsible-heading ui-collapsible-heading-collapsed").children().contents().unwrap()),e.anchor.contents().unwrap(),e.content.contents().unwrap(),this.element.removeClass("ui-collapsible ui-collapsible-collapsed ui-collapsible-themed-content ui-collapsible-inset ui-corner-all"))}}),e.mobile.collapsible.defaults={expandCueText:" click to expand contents",collapseCueText:" click to collapse contents",collapsedIcon:"plus",contentTheme:"inherit",expandedIcon:"minus",iconpos:"left",inset:!0,corners:!0,theme:"inherit",mini:!1}}(e),function(e){e.mobile.behaviors.addFirstLastClasses={_getVisibles:function(e,t){var n;return t?n=e.not(".ui-screen-hidden"):(n=e.filter(":visible"),0===n.length&&(n=e.not(".ui-screen-hidden"))),n},_addFirstLastClasses:function(e,t,n){e.removeClass("ui-first-child ui-last-child"),
t.eq(0).addClass("ui-first-child").end().last().addClass("ui-last-child"),n||this.element.trigger("updatelayout")},_removeFirstLastClasses:function(e){e.removeClass("ui-first-child ui-last-child")}}}(e),function(e,t){var n=":mobile-collapsible, "+e.mobile.collapsible.initSelector;e.widget("mobile.collapsibleset",e.extend({initSelector:":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')",options:e.extend({enhanced:!1},e.mobile.collapsible.defaults),_handleCollapsibleExpand:function(t){var n=e(t.target).closest(".ui-collapsible");n.parent().is(":mobile-collapsibleset, :jqmData(role='collapsible-set')")&&n.siblings(".ui-collapsible:not(.ui-collapsible-collapsed)").collapsible("collapse")},_create:function(){var t=this.element,n=this.options;e.extend(this,{_classes:""}),n.enhanced||(t.addClass("ui-collapsible-set "+this._themeClassFromOption("ui-group-theme-",n.theme)+" "+(n.corners&&n.inset?"ui-corner-all ":"")),this.element.find(e.mobile.collapsible.initSelector).collapsible()),this._on(t,{collapsibleexpand:"_handleCollapsibleExpand"})},_themeClassFromOption:function(e,t){return t?"none"===t?"":e+t:""},_init:function(){this._refresh(!0),this.element.children(n).filter(":jqmData(collapsed='false')").collapsible("expand")},_setOptions:function(e){var n,o,i=this.element,a=this._themeClassFromOption("ui-group-theme-",e.theme);return a&&i.removeClass(this._themeClassFromOption("ui-group-theme-",this.options.theme)).addClass(a),e.inset!==t&&(o=!(!e.inset||!e.corners&&!this.options.corners)),e.corners!==t&&(o=!(!e.corners||!e.inset&&!this.options.inset)),o!==t&&i.toggleClass("ui-corner-all",o),n=this._super(e),this.element.children(":mobile-collapsible").collapsible("refresh"),n},_destroy:function(){var e=this.element;this._removeFirstLastClasses(e.children(n)),e.removeClass("ui-collapsible-set ui-corner-all "+this._themeClassFromOption("ui-group-theme-",this.options.theme)).children(":mobile-collapsible").collapsible("destroy")},_refresh:function(t){var o=this.element.children(n);this.element.find(e.mobile.collapsible.initSelector).not(".ui-collapsible").collapsible(),this._addFirstLastClasses(o,this._getVisibles(o,t),t)},refresh:function(){this._refresh(!1)}},e.mobile.behaviors.addFirstLastClasses))}(e),function(e){e.fn.fieldcontain=function(){return this.addClass("ui-field-contain")}}(e),function(e){e.fn.grid=function(t){return this.each(function(){var n,o,i=e(this),a=e.extend({grid:null},t),r=i.children(),s={solo:1,a:2,b:3,c:4,d:5},l=a.grid;if(!l)if(r.length<=5)for(o in s)s[o]===r.length&&(l=o);else l="a",i.addClass("ui-grid-duo");n=s[l],i.addClass("ui-grid-"+l),r.filter(":nth-child("+n+"n+1)").addClass("ui-block-a"),n>1&&r.filter(":nth-child("+n+"n+2)").addClass("ui-block-b"),n>2&&r.filter(":nth-child("+n+"n+3)").addClass("ui-block-c"),n>3&&r.filter(":nth-child("+n+"n+4)").addClass("ui-block-d"),n>4&&r.filter(":nth-child("+n+"n+5)").addClass("ui-block-e")})}}(e),function(e,t){e.widget("mobile.navbar",{options:{iconpos:"top",grid:null},_create:function(){var t=this.element,o=t.find("a"),i=o.filter(":jqmData(icon)").length?this.options.iconpos:void 0;t.addClass("ui-navbar").attr("role","navigation").find("ul").jqmEnhanceable().grid({grid:this.options.grid}),o.each(function(){var t=e.mobile.getAttribute(this,"icon"),n=e.mobile.getAttribute(this,"theme"),o="ui-btn";n&&(o+=" ui-btn-"+n),t&&(o+=" ui-icon-"+t+" ui-btn-icon-"+i),e(this).addClass(o)}),t.delegate("a","vclick",function(){var t=e(this);t.hasClass("ui-state-disabled")||t.hasClass("ui-disabled")||t.hasClass(e.mobile.activeBtnClass)||(o.removeClass(e.mobile.activeBtnClass),t.addClass(e.mobile.activeBtnClass),e(n).one("pagehide",function(){t.removeClass(e.mobile.activeBtnClass)}))}),t.closest(".ui-page").bind("pagebeforeshow",function(){o.filter(".ui-state-persist").addClass(e.mobile.activeBtnClass)})}})}(e),function(e){var t=e.mobile.getAttribute;e.widget("mobile.listview",e.extend({options:{theme:null,countTheme:null,dividerTheme:null,icon:"carat-r",splitIcon:"carat-r",splitTheme:null,corners:!0,shadow:!0,inset:!1},_create:function(){var e=this,t="";t+=e.options.inset?" ui-listview-inset":"",e.options.inset&&(t+=e.options.corners?" ui-corner-all":"",t+=e.options.shadow?" ui-shadow":""),e.element.addClass(" ui-listview"+t),e.refresh(!0)},_findFirstElementByTagName:function(e,t,n,o){var i={};for(i[n]=i[o]=!0;e;){if(i[e.nodeName])return e;e=e[t]}return null},_addThumbClasses:function(t){var n,o,i=t.length;for(n=0;i>n;n++)o=e(this._findFirstElementByTagName(t[n].firstChild,"nextSibling","img","IMG")),o.length&&e(this._findFirstElementByTagName(o[0].parentNode,"parentNode","li","LI")).addClass(o.hasClass("ui-li-icon")?"ui-li-has-icon":"ui-li-has-thumb")},_getChildrenByTagName:function(t,n,o){var i=[],a={};for(a[n]=a[o]=!0,t=t.firstChild;t;)a[t.nodeName]&&i.push(t),t=t.nextSibling;return e(i)},_beforeListviewRefresh:e.noop,_afterListviewRefresh:e.noop,refresh:function(n){var o,i,a,r,s,l,p,c,u,h,g,m,d,b,_,f,w,v,P,E,T=this.options,N=this.element,S=!!e.nodeName(N[0],"ol"),I=N.attr("start"),C={},R=N.find(".ui-li-count"),G=t(N[0],"counttheme")||this.options.countTheme,y=G?"ui-body-"+G:"ui-body-inherit";for(T.theme&&N.addClass("ui-group-theme-"+T.theme),S&&(I||0===I)&&(g=parseInt(I,10)-1,N.css("counter-reset","listnumbering "+g)),this._beforeListviewRefresh(),E=this._getChildrenByTagName(N[0],"li","LI"),i=0,a=E.length;a>i;i++)r=E.eq(i),s="",(n||r[0].className.search(/\bui-li-static\b|\bui-li-divider\b/)<0)&&(u=this._getChildrenByTagName(r[0],"a","A"),h="list-divider"===t(r[0],"role"),d=r.attr("value"),l=t(r[0],"theme"),u.length&&u[0].className.search(/\bui-btn\b/)<0&&!h?(p=t(r[0],"icon"),c=!1!==p&&(p||T.icon),u.removeClass("ui-link"),o="ui-btn",l&&(o+=" ui-btn-"+l),u.length>1?(s="ui-li-has-alt",b=u.last(),_=t(b[0],"theme")||T.splitTheme||t(r[0],"theme",!0),f=_?" ui-btn-"+_:"",w=t(b[0],"icon")||t(r[0],"icon")||T.splitIcon,v="ui-btn ui-btn-icon-notext ui-icon-"+w+f,b.attr("title",e.trim(b.getEncodedText())).addClass(v).empty()):c&&(o+=" ui-btn-icon-right ui-icon-"+c),u.first().addClass(o)):h?(P=t(r[0],"theme")||T.dividerTheme||T.theme,s="ui-li-divider ui-bar-"+(P||"inherit"),r.attr("role","heading")):u.length<=0&&(s="ui-li-static ui-body-"+(l||"inherit")),S&&d&&(m=parseInt(d,10)-1,r.css("counter-reset","listnumbering "+m))),C[s]||(C[s]=[]),C[s].push(r[0]);for(s in C)e(C[s]).addClass(s);R.each(function(){e(this).closest("li").addClass("ui-li-has-count")}),y&&R.addClass(y),this._addThumbClasses(E),this._addThumbClasses(E.find(".ui-btn")),this._afterListviewRefresh(),this._addFirstLastClasses(E,this._getVisibles(E,n),n)}},e.mobile.behaviors.addFirstLastClasses))}(e),function(e){function t(t){var n=e.trim(t.text())||null;return n?n=n.slice(0,1).toUpperCase():null}e.widget("mobile.listview",e.mobile.listview,{options:{autodividers:!1,autodividersSelector:t},_beforeListviewRefresh:function(){this.options.autodividers&&(this._replaceDividers(),this._superApply(arguments))},_replaceDividers:function(){var t,o,i,a,r,s=null,l=this.element;for(l.children("li:jqmData(role='list-divider')").remove(),o=l.children("li"),t=0;t<o.length;t++)i=o[t],a=this.options.autodividersSelector(e(i)),a&&s!==a&&(r=n.createElement("li"),r.appendChild(n.createTextNode(a)),r.setAttribute("data-"+e.mobile.ns+"role","list-divider"),i.parentNode.insertBefore(r,i)),s=a}})}(e),function(e){e.widget("mobile.listview",e.mobile.listview,{options:{hideDividers:!1},_afterListviewRefresh:function(){var e,t,n,o=!0;if(this._superApply(arguments),this.options.hideDividers)for(e=this._getChildrenByTagName(this.element[0],"li","LI"),t=e.length-1;t>-1;t--)n=e[t],n.className.match(/(^|\s)ui-li-divider($|\s)/)?(o&&(n.className=n.className+" ui-screen-hidden"),o=!0):n.className.match(/(^|\s)ui-screen-hidden($|\s)/)||(o=!1)}})}(e),function(e){e.mobile.nojs=function(t){e(":jqmData(role='nojs')",t).addClass("ui-nojs")}}(e),function(e){e.mobile.behaviors.formReset={_handleFormReset:function(){this._on(this.element.closest("form"),{reset:function(){this._delay("_reset")}})}}}(e),function(e,t){var n=e.mobile.path.hashToSelector;e.widget("mobile.checkboxradio",e.extend({initSelector:"input:not( :jqmData(role='flipswitch' ) )[type='checkbox'],input[type='radio']:not( :jqmData(role='flipswitch' ))",options:{theme:"inherit",mini:!1,wrapperClass:null,enhanced:!1,iconpos:"left"},_create:function(){var t=this.element,o=this.options,i=function(e,t){return e.jqmData(t)||e.closest("form, fieldset").jqmData(t)},a=t.closest("label"),r=a.length?a:t.closest("form, fieldset, :jqmData(role='page'), :jqmData(role='dialog')").find("label").filter("[for='"+n(t[0].id)+"']").first(),s=t[0].type,l="ui-"+s+"-on",p="ui-"+s+"-off";("checkbox"===s||"radio"===s)&&(this.element[0].disabled&&(this.options.disabled=!0),o.iconpos=i(t,"iconpos")||r.attr("data-"+e.mobile.ns+"iconpos")||o.iconpos,o.mini=i(t,"mini")||o.mini,e.extend(this,{input:t,label:r,parentLabel:a,inputtype:s,checkedClass:l,uncheckedClass:p}),this.options.enhanced||this._enhance(),this._on(r,{vmouseover:"_handleLabelVMouseOver",vclick:"_handleLabelVClick"}),this._on(t,{vmousedown:"_cacheVals",vclick:"_handleInputVClick",focus:"_handleInputFocus",blur:"_handleInputBlur"}),this._handleFormReset(),this.refresh())},_enhance:function(){this.label.addClass("ui-btn ui-corner-all"),this.parentLabel.length>0?this.input.add(this.label).wrapAll(this._wrapper()):(this.element.wrap(this._wrapper()),this.element.parent().prepend(this.label)),this._setOptions({theme:this.options.theme,iconpos:this.options.iconpos,mini:this.options.mini})},_wrapper:function(){return e("<div class='"+(this.options.wrapperClass?this.options.wrapperClass:"")+" ui-"+this.inputtype+(this.options.disabled?" ui-state-disabled":"")+"' ></div>")},_handleInputFocus:function(){this.label.addClass(e.mobile.focusClass)},_handleInputBlur:function(){this.label.removeClass(e.mobile.focusClass)},_handleInputVClick:function(){this.element.prop("checked",this.element.is(":checked")),this._getInputSet().not(this.element).prop("checked",!1),this._updateAll()},_handleLabelVMouseOver:function(e){this.label.parent().hasClass("ui-state-disabled")&&e.stopPropagation()},_handleLabelVClick:function(e){var t=this.element;return t.is(":disabled")?void e.preventDefault():(this._cacheVals(),t.prop("checked","radio"===this.inputtype&&!0||!t.prop("checked")),t.triggerHandler("click"),this._getInputSet().not(t).prop("checked",!1),this._updateAll(),!1)},_cacheVals:function(){this._getInputSet().each(function(){e(this).attr("data-"+e.mobile.ns+"cacheVal",this.checked)})},_getInputSet:function(){var t,o,i=this.element[0],a=i.name,r=i.form,s=this.element.parents().last().get(0),l=this.element;return a&&"radio"===this.inputtype&&s&&(t="input[type='radio'][name='"+n(a)+"']",r?(o=r.id,o&&(l=e(t+"[form='"+n(o)+"']",s)),l=e(r).find(t).filter(function(){return this.form===r}).add(l)):l=e(t,s).filter(function(){return!this.form})),l},_updateAll:function(){var t=this;this._getInputSet().each(function(){var n=e(this);(this.checked||"checkbox"===t.inputtype)&&n.trigger("change")}).checkboxradio("refresh")},_reset:function(){this.refresh()},_hasIcon:function(){var t,n,o=e.mobile.controlgroup;return!(o&&(t=this.element.closest(":mobile-controlgroup,"+o.prototype.initSelector),t.length>0))||(n=e.data(t[0],"mobile-controlgroup"),"horizontal"!==(n?n.options.type:t.attr("data-"+e.mobile.ns+"type")))},refresh:function(){var t=this._hasIcon(),n=this.element[0].checked,o=e.mobile.activeBtnClass,i="ui-btn-icon-"+this.options.iconpos,a=[],r=[];t?(r.push(o),a.push(i)):(r.push(i),(n?a:r).push(o)),n?(a.push(this.checkedClass),r.push(this.uncheckedClass)):(a.push(this.uncheckedClass),r.push(this.checkedClass)),this.label.addClass(a.join(" ")).removeClass(r.join(" "))},widget:function(){return this.label.parent()},_setOptions:function(e){var n=this.label,o=this.options,i=this.widget(),a=this._hasIcon();e.disabled!==t&&(this.input.prop("disabled",!!e.disabled),i.toggleClass("ui-state-disabled",!!e.disabled)),e.mini!==t&&i.toggleClass("ui-mini",!!e.mini),e.theme!==t&&n.removeClass("ui-btn-"+o.theme).addClass("ui-btn-"+e.theme),e.wrapperClass!==t&&i.removeClass(o.wrapperClass).addClass(e.wrapperClass),e.iconpos!==t&&a?n.removeClass("ui-btn-icon-"+o.iconpos).addClass("ui-btn-icon-"+e.iconpos):a||n.removeClass("ui-btn-icon-"+o.iconpos),this._super(e)}},e.mobile.behaviors.formReset))}(e),function(e,t){e.widget("mobile.button",{initSelector:"input[type='button'], input[type='submit'], input[type='reset']",options:{theme:null,icon:null,iconpos:"left",iconshadow:!1,corners:!0,shadow:!0,inline:null,mini:null,wrapperClass:null,enhanced:!1},_create:function(){this.element.is(":disabled")&&(this.options.disabled=!0),this.options.enhanced||this._enhance(),e.extend(this,{wrapper:this.element.parent()}),this._on({focus:function(){this.widget().addClass(e.mobile.focusClass)},blur:function(){this.widget().removeClass(e.mobile.focusClass)}}),this.refresh(!0)},_enhance:function(){this.element.wrap(this._button())},_button:function(){var t=this.options,n=this._getIconClasses(this.options);return e("<div class='ui-btn ui-input-btn"+(t.wrapperClass?" "+t.wrapperClass:"")+(t.theme?" ui-btn-"+t.theme:"")+(t.corners?" ui-corner-all":"")+(t.shadow?" ui-shadow":"")+(t.inline?" ui-btn-inline":"")+(t.mini?" ui-mini":"")+(t.disabled?" ui-state-disabled":"")+(n?" "+n:"")+"' >"+this.element.val()+"</div>")},widget:function(){return this.wrapper},_destroy:function(){this.element.insertBefore(this.button),this.button.remove()},_getIconClasses:function(e){return e.icon?"ui-icon-"+e.icon+(e.iconshadow?" ui-shadow-icon":"")+" ui-btn-icon-"+e.iconpos:""},_setOptions:function(n){var o=this.widget();n.theme!==t&&o.removeClass(this.options.theme).addClass("ui-btn-"+n.theme),n.corners!==t&&o.toggleClass("ui-corner-all",n.corners),n.shadow!==t&&o.toggleClass("ui-shadow",n.shadow),n.inline!==t&&o.toggleClass("ui-btn-inline",n.inline),n.mini!==t&&o.toggleClass("ui-mini",n.mini),n.disabled!==t&&(this.element.prop("disabled",n.disabled),o.toggleClass("ui-state-disabled",n.disabled)),(n.icon!==t||n.iconshadow!==t||n.iconpos!==t)&&o.removeClass(this._getIconClasses(this.options)).addClass(this._getIconClasses(e.extend({},this.options,n))),this._super(n)},refresh:function(t){var n,o=this.element.prop("disabled");this.options.icon&&"notext"===this.options.iconpos&&this.element.attr("title")&&this.element.attr("title",this.element.val()),t||(n=this.element.detach(),e(this.wrapper).text(this.element.val()).append(n)),this.options.disabled!==o&&this._setOptions({disabled:o})}})}(e),function(e){var t=e("meta[name=viewport]"),n=t.attr("content"),o=n+",maximum-scale=1, user-scalable=no",i=n+",maximum-scale=10, user-scalable=yes",a=/(user-scalable[\s]*=[\s]*no)|(maximum-scale[\s]*=[\s]*1)[$,\s]/.test(n);e.mobile.zoom=e.extend({},{enabled:!a,locked:!1,disable:function(n){a||e.mobile.zoom.locked||(t.attr("content",o),e.mobile.zoom.enabled=!1,e.mobile.zoom.locked=n||!1)},enable:function(n){a||e.mobile.zoom.locked&&!0!==n||(t.attr("content",i),e.mobile.zoom.enabled=!0,e.mobile.zoom.locked=!1)},restore:function(){a||(t.attr("content",n),e.mobile.zoom.enabled=!0)}})}(e),function(e,t){e.widget("mobile.textinput",{initSelector:"input[type='text'],input[type='search'],:jqmData(type='search'),input[type='number'],:jqmData(type='number'),input[type='password'],input[type='email'],input[type='url'],input[type='tel'],textarea,input[type='time'],input[type='date'],input[type='month'],input[type='week'],input[type='datetime'],input[type='datetime-local'],input[type='color'],input:not([type]),input[type='file']",options:{theme:null,corners:!0,mini:!1,preventFocusZoom:/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1,wrapperClass:"",enhanced:!1},_create:function(){var t=this.options,n=this.element.is("[type='search'], :jqmData(type='search')"),o="TEXTAREA"===this.element[0].tagName,i=this.element.is("[data-"+(e.mobile.ns||"")+"type='range']"),a=(this.element.is("input")||this.element.is("[data-"+(e.mobile.ns||"")+"type='search']"))&&!i;this.element.prop("disabled")&&(t.disabled=!0),e.extend(this,{classes:this._classesFromOptions(),isSearch:n,isTextarea:o,isRange:i,inputNeedsWrap:a}),this._autoCorrect(),t.enhanced||this._enhance(),this._on({focus:"_handleFocus",blur:"_handleBlur"})},refresh:function(){this.setOptions({disabled:this.element.is(":disabled")})},_enhance:function(){var e=[];this.isTextarea&&e.push("ui-input-text"),(this.isTextarea||this.isRange)&&e.push("ui-shadow-inset"),this.inputNeedsWrap?this.element.wrap(this._wrap()):e=e.concat(this.classes),this.element.addClass(e.join(" "))},widget:function(){return this.inputNeedsWrap?this.element.parent():this.element},_classesFromOptions:function(){var e=this.options,t=[];return t.push("ui-body-"+(null===e.theme?"inherit":e.theme)),e.corners&&t.push("ui-corner-all"),e.mini&&t.push("ui-mini"),e.disabled&&t.push("ui-state-disabled"),e.wrapperClass&&t.push(e.wrapperClass),t},_wrap:function(){return e("<div class='"+(this.isSearch?"ui-input-search ":"ui-input-text ")+this.classes.join(" ")+" ui-shadow-inset'></div>")},_autoCorrect:function(){"undefined"==typeof this.element[0].autocorrect||e.support.touchOverflow||(this.element[0].setAttribute("autocorrect","off"),this.element[0].setAttribute("autocomplete","off"))},_handleBlur:function(){this.widget().removeClass(e.mobile.focusClass),this.options.preventFocusZoom&&e.mobile.zoom.enable(!0)},_handleFocus:function(){this.options.preventFocusZoom&&e.mobile.zoom.disable(!0),this.widget().addClass(e.mobile.focusClass)},_setOptions:function(e){var n=this.widget();this._super(e),(e.disabled!==t||e.mini!==t||e.corners!==t||e.theme!==t||e.wrapperClass!==t)&&(n.removeClass(this.classes.join(" ")),this.classes=this._classesFromOptions(),n.addClass(this.classes.join(" "))),e.disabled!==t&&this.element.prop("disabled",!!e.disabled)},_destroy:function(){this.options.enhanced||(this.inputNeedsWrap&&this.element.unwrap(),this.element.removeClass("ui-input-text "+this.classes.join(" ")))}})}(e),function(e,o){e.widget("mobile.slider",e.extend({initSelector:"input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",widgetEventPrefix:"slide",options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!1},_create:function(){var i,a,r,s,l,p,c,u,h,g,m=this,d=this.element,b=this.options.trackTheme||e.mobile.getAttribute(d[0],"theme"),_=b?" ui-bar-"+b:" ui-bar-inherit",f=this.options.corners||d.jqmData("corners")?" ui-corner-all":"",w=this.options.mini||d.jqmData("mini")?" ui-mini":"",v=d[0].nodeName.toLowerCase(),P="select"===v,E=d.parent().is(":jqmData(role='rangeslider')"),T=P?"ui-slider-switch":"",N=d.attr("id"),S=e("[for='"+N+"']"),I=S.attr("id")||N+"-label",C=P?0:parseFloat(d.attr("min")),R=P?d.find("option").length-1:parseFloat(d.attr("max")),G=t.parseFloat(d.attr("step")||1),y=n.createElement("a"),L=e(y),O=n.createElement("div"),D=e(O),x=!(!this.options.highlight||P)&&function(){var t=n.createElement("div");return t.className="ui-slider-bg "+e.mobile.activeBtnClass,e(t).prependTo(D)}();if(S.attr("id",I),this.isToggleSwitch=P,y.setAttribute("href","#"),O.setAttribute("role","application"),O.className=[this.isToggleSwitch?"ui-slider ui-slider-track ui-shadow-inset ":"ui-slider-track ui-shadow-inset ",T,_,f,w].join(""),y.className="ui-slider-handle",O.appendChild(y),L.attr({role:"slider","aria-valuemin":C,"aria-valuemax":R,"aria-valuenow":this._value(),"aria-valuetext":this._value(),title:this._value(),"aria-labelledby":I}),e.extend(this,{slider:D,handle:L,control:d,type:v,step:G,max:R,min:C,valuebg:x,isRangeslider:E,dragging:!1,beforeStart:null,userModified:!1,mouseMoved:!1}),P){for(c=d.attr("tabindex"),c&&L.attr("tabindex",c),d.attr("tabindex","-1").focus(function(){e(this).blur(),L.focus()}),a=n.createElement("div"),a.className="ui-slider-inneroffset",r=0,s=O.childNodes.length;s>r;r++)a.appendChild(O.childNodes[r]);for(O.appendChild(a),L.addClass("ui-slider-handle-snapping"),i=d.find("option"),l=0,p=i.length;p>l;l++)u=l?"a":"b",h=l?" "+e.mobile.activeBtnClass:"",g=n.createElement("span"),g.className=["ui-slider-label ui-slider-label-",u,h].join(""),g.setAttribute("role","img"),g.appendChild(n.createTextNode(i[l].innerHTML)),e(g).prependTo(D);m._labels=e(".ui-slider-label",D)}d.addClass(P?"ui-slider-switch":"ui-slider-input"),this._on(d,{change:"_controlChange",keyup:"_controlKeyup",blur:"_controlBlur",vmouseup:"_controlVMouseUp"}),D.bind("vmousedown",e.proxy(this._sliderVMouseDown,this)).bind("vclick",!1),this._on(n,{vmousemove:"_preventDocumentDrag"}),this._on(D.add(n),{vmouseup:"_sliderVMouseUp"}),D.insertAfter(d),P||E||(a=this.options.mini?"<div class='ui-slider ui-mini'>":"<div class='ui-slider'>",d.add(D).wrapAll(a)),this._on(this.handle,{vmousedown:"_handleVMouseDown",keydown:"_handleKeydown",keyup:"_handleKeyup"}),this.handle.bind("vclick",!1),this._handleFormReset(),this.refresh(o,o,!0)},_setOptions:function(e){e.theme!==o&&this._setTheme(e.theme),e.trackTheme!==o&&this._setTrackTheme(e.trackTheme),e.corners!==o&&this._setCorners(e.corners),e.mini!==o&&this._setMini(e.mini),e.highlight!==o&&this._setHighlight(e.highlight),e.disabled!==o&&this._setDisabled(e.disabled),this._super(e)},_controlChange:function(e){return!1!==this._trigger("controlchange",e)&&void(this.mouseMoved||this.refresh(this._value(),!0))},_controlKeyup:function(){this.refresh(this._value(),!0,!0)},_controlBlur:function(){this.refresh(this._value(),!0)},_controlVMouseUp:function(){this._checkedRefresh()},_handleVMouseDown:function(){this.handle.focus()},_handleKeydown:function(t){var n=this._value();if(!this.options.disabled){switch(t.keyCode){case e.mobile.keyCode.HOME:case e.mobile.keyCode.END:case e.mobile.keyCode.PAGE_UP:case e.mobile.keyCode.PAGE_DOWN:case e.mobile.keyCode.UP:case e.mobile.keyCode.RIGHT:case e.mobile.keyCode.DOWN:case e.mobile.keyCode.LEFT:t.preventDefault(),this._keySliding||(this._keySliding=!0,this.handle.addClass("ui-state-active"))}switch(t.keyCode){case e.mobile.keyCode.HOME:this.refresh(this.min);break;case e.mobile.keyCode.END:this.refresh(this.max);break;case e.mobile.keyCode.PAGE_UP:case e.mobile.keyCode.UP:case e.mobile.keyCode.RIGHT:this.refresh(n+this.step);break;case e.mobile.keyCode.PAGE_DOWN:case e.mobile.keyCode.DOWN:case e.mobile.keyCode.LEFT:this.refresh(n-this.step)}}},_handleKeyup:function(){this._keySliding&&(this._keySliding=!1,this.handle.removeClass("ui-state-active"))},_sliderVMouseDown:function(e){return!(this.options.disabled||1!==e.which&&0!==e.which&&e.which!==o)&&(!1!==this._trigger("beforestart",e)&&(this.dragging=!0,this.userModified=!1,this.mouseMoved=!1,this.isToggleSwitch&&(this.beforeStart=this.element[0].selectedIndex),this.refresh(e),this._trigger("start"),!1))},_sliderVMouseUp:function(){return this.dragging?(this.dragging=!1,this.isToggleSwitch&&(this.handle.addClass("ui-slider-handle-snapping"),this.refresh(this.mouseMoved?this.userModified?0===this.beforeStart?1:0:this.beforeStart:0===this.beforeStart?1:0)),this.mouseMoved=!1,this._trigger("stop"),!1):void 0},_preventDocumentDrag:function(e){return!1!==this._trigger("drag",e)&&(this.dragging&&!this.options.disabled?(this.mouseMoved=!0,this.isToggleSwitch&&this.handle.removeClass("ui-slider-handle-snapping"),this.refresh(e),this.userModified=this.beforeStart!==this.element[0].selectedIndex,!1):void 0)},_checkedRefresh:function(){this.value!==this._value()&&this.refresh(this._value())},_value:function(){return this.isToggleSwitch?this.element[0].selectedIndex:parseFloat(this.element.val())},_reset:function(){this.refresh(o,!1,!0)},refresh:function(t,o,i){var a,r,s,l,p,c,u,h,g,m,d,b,_,f,w,v,P,E,T,N,S=this,I=e.mobile.getAttribute(this.element[0],"theme"),C=this.options.theme||I,R=C?" ui-btn-"+C:"",G=this.options.trackTheme||I,y=G?" ui-bar-"+G:" ui-bar-inherit",L=this.options.corners?" ui-corner-all":"",O=this.options.mini?" ui-mini":"";if(S.slider[0].className=[this.isToggleSwitch?"ui-slider ui-slider-switch ui-slider-track ui-shadow-inset":"ui-slider-track ui-shadow-inset",y,L,O].join(""),(this.options.disabled||this.element.prop("disabled"))&&this.disable(),this.value=this._value(),this.options.highlight&&!this.isToggleSwitch&&0===this.slider.find(".ui-slider-bg").length&&(this.valuebg=function(){var t=n.createElement("div");return t.className="ui-slider-bg "+e.mobile.activeBtnClass,e(t).prependTo(S.slider)}()),this.handle.addClass("ui-btn"+R+" ui-shadow"),u=this.element,h=!this.isToggleSwitch,g=h?[]:u.find("option"),m=h?parseFloat(u.attr("min")):0,d=h?parseFloat(u.attr("max")):g.length-1,b=h&&parseFloat(u.attr("step"))>0?parseFloat(u.attr("step")):1,"object"==typeof t){if(s=t,l=8,a=this.slider.offset().left,r=this.slider.width(),p=r/((d-m)/b),!this.dragging||s.pageX<a-l||s.pageX>a+r+l)return;c=p>1?(s.pageX-a)/r*100:Math.round((s.pageX-a)/r*100)}else null==t&&(t=h?parseFloat(u.val()||0):u[0].selectedIndex),c=(parseFloat(t)-m)/(d-m)*100;if(!isNaN(c)&&(_=c/100*(d-m)+m,f=(_-m)%b,w=_-f,2*Math.abs(f)>=b&&(w+=f>0?b:-b),v=100/((d-m)/b),_=parseFloat(w.toFixed(5)),void 0===p&&(p=r/((d-m)/b)),p>1&&h&&(c=(_-m)*v*(1/b)),0>c&&(c=0),c>100&&(c=100),m>_&&(_=m),_>d&&(_=d),this.handle.css("left",c+"%"),this.handle[0].setAttribute("aria-valuenow",h?_:g.eq(_).attr("value")),this.handle[0].setAttribute("aria-valuetext",h?_:g.eq(_).getEncodedText()),this.handle[0].setAttribute("title",h?_:g.eq(_).getEncodedText()),this.valuebg&&this.valuebg.css("width",c+"%"),this._labels&&(P=this.handle.width()/this.slider.width()*100,E=c&&P+(100-P)*c/100,T=100===c?0:Math.min(P+100-E,100),this._labels.each(function(){var t=e(this).hasClass("ui-slider-label-a");e(this).width((t?E:T)+"%")})),!i)){if(N=!1,h?(N=u.val()!==_,u.val(_)):(N=u[0].selectedIndex!==_,u[0].selectedIndex=_),!1===this._trigger("beforechange",t))return!1;!o&&N&&u.trigger("change")}},_setHighlight:function(e){e=!!e,e?(this.options.highlight=!!e,this.refresh()):this.valuebg&&(this.valuebg.remove(),this.valuebg=!1)},_setTheme:function(e){this.handle.removeClass("ui-btn-"+this.options.theme).addClass("ui-btn-"+e);var t=this.options.theme?this.options.theme:"inherit",n=e||"inherit";this.control.removeClass("ui-body-"+t).addClass("ui-body-"+n)},_setTrackTheme:function(e){var t=this.options.trackTheme?this.options.trackTheme:"inherit",n=e||"inherit";this.slider.removeClass("ui-body-"+t).addClass("ui-body-"+n)},_setMini:function(e){e=!!e,this.isToggleSwitch||this.isRangeslider||(this.slider.parent().toggleClass("ui-mini",e),this.element.toggleClass("ui-mini",e)),this.slider.toggleClass("ui-mini",e)},_setCorners:function(e){this.slider.toggleClass("ui-corner-all",e),this.isToggleSwitch||this.control.toggleClass("ui-corner-all",e)},_setDisabled:function(e){e=!!e,this.element.prop("disabled",e),this.slider.toggleClass("ui-state-disabled",e).attr("aria-disabled",e)}},e.mobile.behaviors.formReset))}(e),function(e){function t(){return n||(n=e("<div></div>",{"class":"ui-slider-popup ui-shadow ui-corner-all"})),n.clone()}var n;e.widget("mobile.slider",e.mobile.slider,{options:{popupEnabled:!1,showValue:!1},_create:function(){this._super(),e.extend(this,{_currentValue:null,_popup:null,_popupVisible:!1}),this._setOption("popupEnabled",this.options.popupEnabled),this._on(this.handle,{vmousedown:"_showPopup"}),this._on(this.slider.add(this.document),{vmouseup:"_hidePopup"}),this._refresh()},_positionPopup:function(){var e=this.handle.offset();this._popup.offset({left:e.left+(this.handle.width()-this._popup.width())/2,top:e.top-this._popup.outerHeight()-5})},_setOption:function(e,n){this._super(e,n),"showValue"===e?this.handle.html(n&&!this.options.mini?this._value():""):"popupEnabled"===e&&n&&!this._popup&&(this._popup=t().addClass("ui-body-"+(this.options.theme||"a")).hide().insertBefore(this.element))},refresh:function(){this._super.apply(this,arguments),this._refresh()},_refresh:function(){var e,t=this.options;t.popupEnabled&&this.handle.removeAttr("title"),(e=this._value())!==this._currentValue&&(this._currentValue=e,t.popupEnabled&&this._popup?(this._positionPopup(),this._popup.html(e)):t.showValue&&!this.options.mini&&this.handle.html(e))},_showPopup:function(){this.options.popupEnabled&&!this._popupVisible&&(this.handle.html(""),this._popup.show(),this._positionPopup(),this._popupVisible=!0)},_hidePopup:function(){var e=this.options;e.popupEnabled&&this._popupVisible&&(e.showValue&&!e.mini&&this.handle.html(this._value()),this._popup.hide(),this._popupVisible=!1)}})}(e),function(e,t){e.widget("mobile.flipswitch",e.extend({options:{onText:"On",offText:"Off",theme:null,enhanced:!1,wrapperClass:null,corners:!0,mini:!1},_create:function(){this.options.enhanced?e.extend(this,{flipswitch:this.element.parent(),on:this.element.find(".ui-flipswitch-on").eq(0),off:this.element.find(".ui-flipswitch-off").eq(0),type:this.element.get(0).tagName}):this._enhance(),this._handleFormReset(),this._originalTabIndex=this.element.attr("tabindex"),null!=this._originalTabIndex&&this.on.attr("tabindex",this._originalTabIndex),this.element.attr("tabindex","-1"),this._on({focus:"_handleInputFocus"}),this.element.is(":disabled")&&this._setOptions({disabled:!0}),this._on(this.flipswitch,{click:"_toggle",swipeleft:"_left",swiperight:"_right"}),this._on(this.on,{keydown:"_keydown"}),this._on({change:"refresh"})},_handleInputFocus:function(){this.on.focus()},widget:function(){return this.flipswitch},_left:function(){this.flipswitch.removeClass("ui-flipswitch-active"),"SELECT"===this.type?this.element.get(0).selectedIndex=0:this.element.prop("checked",!1),this.element.trigger("change")},_right:function(){this.flipswitch.addClass("ui-flipswitch-active"),"SELECT"===this.type?this.element.get(0).selectedIndex=1:this.element.prop("checked",!0),this.element.trigger("change")},_enhance:function(){var t=e("<div>"),n=this.options,o=this.element,i=n.theme?n.theme:"inherit",a=e("<a></a>",{href:"#"}),r=e("<span></span>"),s=o.get(0).tagName,l="INPUT"===s?n.onText:o.find("option").eq(1).text(),p="INPUT"===s?n.offText:o.find("option").eq(0).text();a.addClass("ui-flipswitch-on ui-btn ui-shadow ui-btn-inherit").text(l),r.addClass("ui-flipswitch-off").text(p),t.addClass("ui-flipswitch ui-shadow-inset ui-bar-"+i+" "+(n.wrapperClass?n.wrapperClass:"")+" "+(o.is(":checked")||o.find("option").eq(1).is(":selected")?"ui-flipswitch-active":"")+(o.is(":disabled")?" ui-state-disabled":"")+(n.corners?" ui-corner-all":"")+(n.mini?" ui-mini":"")).append(a,r),o.addClass("ui-flipswitch-input").after(t).appendTo(t),e.extend(this,{flipswitch:t,on:a,off:r,type:s})},_reset:function(){this.refresh()},refresh:function(){var e,t=this.flipswitch.hasClass("ui-flipswitch-active")?"_right":"_left";(e="SELECT"===this.type?this.element.get(0).selectedIndex>0?"_right":"_left":this.element.prop("checked")?"_right":"_left")!==t&&this[e]()},_toggle:function(){this[this.flipswitch.hasClass("ui-flipswitch-active")?"_left":"_right"]()},_keydown:function(t){t.which===e.mobile.keyCode.LEFT?this._left():t.which===e.mobile.keyCode.RIGHT?this._right():t.which===e.mobile.keyCode.SPACE&&(this._toggle(),t.preventDefault())},_setOptions:function(e){if(e.theme!==t){var n=e.theme?e.theme:"inherit",o=e.theme?e.theme:"inherit";this.widget().removeClass("ui-bar-"+n).addClass("ui-bar-"+o)}e.onText!==t&&this.on.text(e.onText),e.offText!==t&&this.off.text(e.offText),e.disabled!==t&&this.widget().toggleClass("ui-state-disabled",e.disabled),e.mini!==t&&this.widget().toggleClass("ui-mini",e.mini),e.corners!==t&&this.widget().toggleClass("ui-corner-all",e.corners),this._super(e)},_destroy:function(){this.options.enhanced||(null!=this._originalTabIndex?this.element.attr("tabindex",this._originalTabIndex):this.element.removeAttr("tabindex"),this.on.remove(),this.off.remove(),this.element.unwrap(),this.flipswitch.remove(),this.removeClass("ui-flipswitch-input"))}},e.mobile.behaviors.formReset))}(e),function(e,t){e.widget("mobile.rangeslider",e.extend({options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!0},_create:function(){
var t=this.element,n=this.options.mini?"ui-rangeslider ui-mini":"ui-rangeslider",o=t.find("input").first(),i=t.find("input").last(),a=t.find("label").first(),r=e.data(o.get(0),"mobile-slider")||e.data(o.slider().get(0),"mobile-slider"),s=e.data(i.get(0),"mobile-slider")||e.data(i.slider().get(0),"mobile-slider"),l=r.slider,p=s.slider,c=r.handle,u=e("<div class='ui-rangeslider-sliders' />").appendTo(t);o.addClass("ui-rangeslider-first"),i.addClass("ui-rangeslider-last"),t.addClass(n),l.appendTo(u),p.appendTo(u),a.insertBefore(t),c.prependTo(p),e.extend(this,{_inputFirst:o,_inputLast:i,_sliderFirst:l,_sliderLast:p,_label:a,_targetVal:null,_sliderTarget:!1,_sliders:u,_proxy:!1}),this.refresh(),this._on(this.element.find("input.ui-slider-input"),{slidebeforestart:"_slidebeforestart",slidestop:"_slidestop",slidedrag:"_slidedrag",slidebeforechange:"_change",blur:"_change",keyup:"_change"}),this._on({mousedown:"_change"}),this._on(this.element.closest("form"),{reset:"_handleReset"}),this._on(c,{vmousedown:"_dragFirstHandle"})},_handleReset:function(){var e=this;setTimeout(function(){e._updateHighlight()},0)},_dragFirstHandle:function(t){return e.data(this._inputFirst.get(0),"mobile-slider").dragging=!0,e.data(this._inputFirst.get(0),"mobile-slider").refresh(t),!1},_slidedrag:function(t){var n=e(t.target).is(this._inputFirst),o=n?this._inputLast:this._inputFirst;return this._sliderTarget=!1,"first"===this._proxy&&n||"last"===this._proxy&&!n?(e.data(o.get(0),"mobile-slider").dragging=!0,e.data(o.get(0),"mobile-slider").refresh(t),!1):void 0},_slidestop:function(t){var n=e(t.target).is(this._inputFirst);this._proxy=!1,this.element.find("input").trigger("vmouseup"),this._sliderFirst.css("z-index",n?1:"")},_slidebeforestart:function(t){this._sliderTarget=!1,e(t.originalEvent.target).hasClass("ui-slider-track")&&(this._sliderTarget=!0,this._targetVal=e(t.target).val())},_setOptions:function(e){e.theme!==t&&this._setTheme(e.theme),e.trackTheme!==t&&this._setTrackTheme(e.trackTheme),e.mini!==t&&this._setMini(e.mini),e.highlight!==t&&this._setHighlight(e.highlight),this._super(e),this.refresh()},refresh:function(){var e=this.element,t=this.options;(this._inputFirst.is(":disabled")||this._inputLast.is(":disabled"))&&(this.options.disabled=!0),e.find("input").slider({theme:t.theme,trackTheme:t.trackTheme,disabled:t.disabled,corners:t.corners,mini:t.mini,highlight:t.highlight}).slider("refresh"),this._updateHighlight()},_change:function(t){if("keyup"===t.type)return this._updateHighlight(),!1;var n=this,o=parseFloat(this._inputFirst.val(),10),i=parseFloat(this._inputLast.val(),10),a=e(t.target).hasClass("ui-rangeslider-first"),r=a?this._inputFirst:this._inputLast,s=a?this._inputLast:this._inputFirst;if(this._inputFirst.val()>this._inputLast.val()&&"mousedown"===t.type&&!e(t.target).hasClass("ui-slider-handle"))r.blur();else if("mousedown"===t.type)return;return o>i&&!this._sliderTarget?(r.val(a?i:o).slider("refresh"),this._trigger("normalize")):o>i&&(r.val(this._targetVal).slider("refresh"),setTimeout(function(){s.val(a?o:i).slider("refresh"),e.data(s.get(0),"mobile-slider").handle.focus(),n._sliderFirst.css("z-index",a?"":1),n._trigger("normalize")},0),this._proxy=a?"first":"last"),o===i?(e.data(r.get(0),"mobile-slider").handle.css("z-index",1),e.data(s.get(0),"mobile-slider").handle.css("z-index",0)):(e.data(s.get(0),"mobile-slider").handle.css("z-index",""),e.data(r.get(0),"mobile-slider").handle.css("z-index","")),this._updateHighlight(),!(o>=i)&&void 0},_updateHighlight:function(){var t=parseInt(e.data(this._inputFirst.get(0),"mobile-slider").handle.get(0).style.left,10),n=parseInt(e.data(this._inputLast.get(0),"mobile-slider").handle.get(0).style.left,10),o=n-t;this.element.find(".ui-slider-bg").css({"margin-left":t+"%",width:o+"%"})},_setTheme:function(e){this._inputFirst.slider("option","theme",e),this._inputLast.slider("option","theme",e)},_setTrackTheme:function(e){this._inputFirst.slider("option","trackTheme",e),this._inputLast.slider("option","trackTheme",e)},_setMini:function(e){this._inputFirst.slider("option","mini",e),this._inputLast.slider("option","mini",e),this.element.toggleClass("ui-mini",!!e)},_setHighlight:function(e){this._inputFirst.slider("option","highlight",e),this._inputLast.slider("option","highlight",e)},_destroy:function(){this._label.prependTo(this.element),this.element.removeClass("ui-rangeslider ui-mini"),this._inputFirst.after(this._sliderFirst),this._inputLast.after(this._sliderLast),this._sliders.remove(),this.element.find("input").removeClass("ui-rangeslider-first ui-rangeslider-last").slider("destroy")}},e.mobile.behaviors.formReset))}(e),function(e,t){e.widget("mobile.textinput",e.mobile.textinput,{options:{clearBtn:!1,clearBtnText:"Clear text"},_create:function(){this._super(),(this.options.clearBtn||this.isSearch)&&this._addClearBtn()},clearButton:function(){return e("<a href='#' class='ui-input-clear ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all' title='"+this.options.clearBtnText+"'>"+this.options.clearBtnText+"</a>")},_clearBtnClick:function(e){this.element.val("").focus().trigger("change"),this._clearBtn.addClass("ui-input-clear-hidden"),e.preventDefault()},_addClearBtn:function(){this.options.enhanced||this._enhanceClear(),e.extend(this,{_clearBtn:this.widget().find("a.ui-input-clear")}),this._bindClearEvents(),this._toggleClear()},_enhanceClear:function(){this.clearButton().appendTo(this.widget()),this.widget().addClass("ui-input-has-clear")},_bindClearEvents:function(){this._on(this._clearBtn,{click:"_clearBtnClick"}),this._on({keyup:"_toggleClear",change:"_toggleClear",input:"_toggleClear",focus:"_toggleClear",blur:"_toggleClear",cut:"_toggleClear",paste:"_toggleClear"})},_unbindClear:function(){this._off(this._clearBtn,"click"),this._off(this.element,"keyup change input focus blur cut paste")},_setOptions:function(e){this._super(e),e.clearBtn===t||this.element.is("textarea, :jqmData(type='range')")||(e.clearBtn?this._addClearBtn():this._destroyClear()),e.clearBtnText!==t&&this._clearBtn!==t&&this._clearBtn.text(e.clearBtnText).attr("title",e.clearBtnText)},_toggleClear:function(){this._delay("_toggleClearClass",0)},_toggleClearClass:function(){this._clearBtn.toggleClass("ui-input-clear-hidden",!this.element.val())},_destroyClear:function(){this.widget().removeClass("ui-input-has-clear"),this._unbindClear(),this._clearBtn.remove()},_destroy:function(){this._super(),this._destroyClear()}})}(e),function(e,t){e.widget("mobile.textinput",e.mobile.textinput,{options:{autogrow:!0,keyupTimeoutBuffer:100},_create:function(){this._super(),this.options.autogrow&&this.isTextarea&&this._autogrow()},_autogrow:function(){this.element.addClass("ui-textinput-autogrow"),this._on({keyup:"_timeout",change:"_timeout",input:"_timeout",paste:"_timeout"}),this._on(!0,this.document,{pageshow:"_handleShow",popupbeforeposition:"_handleShow",updatelayout:"_handleShow",panelopen:"_handleShow"})},_handleShow:function(t){e.contains(t.target,this.element[0])&&this.element.is(":visible")&&("popupbeforeposition"!==t.type&&this.element.addClass("ui-textinput-autogrow-resize").animationComplete(e.proxy(function(){this.element.removeClass("ui-textinput-autogrow-resize")},this),"transition"),this._timeout())},_unbindAutogrow:function(){this.element.removeClass("ui-textinput-autogrow"),this._off(this.element,"keyup change input paste"),this._off(this.document,"pageshow popupbeforeposition updatelayout panelopen")},keyupTimeout:null,_prepareHeightUpdate:function(e){this.keyupTimeout&&clearTimeout(this.keyupTimeout),e===t?this._updateHeight():this.keyupTimeout=this._delay("_updateHeight",e)},_timeout:function(){this._prepareHeightUpdate(this.options.keyupTimeoutBuffer)},_updateHeight:function(){var e,t,n,o,i,a,r,s,l,p=this.window.scrollTop();this.keyupTimeout=0,"onpage"in this.element[0]||this.element.css({height:0,"min-height":0,"max-height":0}),o=this.element[0].scrollHeight,i=this.element[0].clientHeight,a=parseFloat(this.element.css("border-top-width")),r=parseFloat(this.element.css("border-bottom-width")),s=a+r,l=o+s+15,0===i&&(e=parseFloat(this.element.css("padding-top")),t=parseFloat(this.element.css("padding-bottom")),n=e+t,l+=n),this.element.css({height:l,"min-height":"","max-height":""}),this.window.scrollTop(p)},refresh:function(){this.options.autogrow&&this.isTextarea&&this._updateHeight()},_setOptions:function(e){this._super(e),e.autogrow!==t&&this.isTextarea&&(e.autogrow?this._autogrow():this._unbindAutogrow())}})}(e),function(e){e.widget("mobile.selectmenu",e.extend({initSelector:"select:not( :jqmData(role='slider')):not( :jqmData(role='flipswitch') )",options:{theme:null,icon:"carat-d",iconpos:"right",inline:!1,corners:!0,shadow:!0,iconshadow:!1,overlayTheme:null,dividerTheme:null,hidePlaceholderMenuItems:!0,closeText:"Close",nativeMenu:!0,preventFocusZoom:/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1,mini:!1},_button:function(){return e("<div/>")},_setDisabled:function(e){return this.element.attr("disabled",e),this.button.attr("aria-disabled",e),this._setOption("disabled",e)},_focusButton:function(){var e=this;setTimeout(function(){e.button.focus()},40)},_selectOptions:function(){return this.select.find("option")},_preExtension:function(){var t=this.options.inline||this.element.jqmData("inline"),n=this.options.mini||this.element.jqmData("mini"),o="";~this.element[0].className.indexOf("ui-btn-left")&&(o=" ui-btn-left"),~this.element[0].className.indexOf("ui-btn-right")&&(o=" ui-btn-right"),t&&(o+=" ui-btn-inline"),n&&(o+=" ui-mini"),this.select=this.element.removeClass("ui-btn-left ui-btn-right").wrap("<div class='ui-select"+o+"'>"),this.selectId=this.select.attr("id")||"select-"+this.uuid,this.buttonId=this.selectId+"-button",this.label=e("label[for='"+this.selectId+"']"),this.isMultiple=this.select[0].multiple},_destroy:function(){var e=this.element.parents(".ui-select");e.length>0&&(e.is(".ui-btn-left, .ui-btn-right")&&this.element.addClass(e.hasClass("ui-btn-left")?"ui-btn-left":"ui-btn-right"),this.element.insertAfter(e),e.remove())},_create:function(){this._preExtension(),this.button=this._button();var n=this,o=this.options,i=!!o.icon&&(o.iconpos||this.select.jqmData("iconpos")),a=this.button.insertBefore(this.select).attr("id",this.buttonId).addClass("ui-btn"+(o.icon?" ui-icon-"+o.icon+" ui-btn-icon-"+i+(o.iconshadow?" ui-shadow-icon":""):"")+(o.theme?" ui-btn-"+o.theme:"")+(o.corners?" ui-corner-all":"")+(o.shadow?" ui-shadow":""));this.setButtonText(),o.nativeMenu&&t.opera&&t.opera.version&&a.addClass("ui-select-nativeonly"),this.isMultiple&&(this.buttonCount=e("<span>").addClass("ui-li-count ui-body-inherit").hide().appendTo(a.addClass("ui-li-has-count"))),(o.disabled||this.element.attr("disabled"))&&this.disable(),this.select.change(function(){n.refresh(),o.nativeMenu&&this.blur()}),this._handleFormReset(),this._on(this.button,{keydown:"_handleKeydown"}),this.build()},build:function(){var t=this;this.select.appendTo(t.button).bind("vmousedown",function(){t.button.addClass(e.mobile.activeBtnClass)}).bind("focus",function(){t.button.addClass(e.mobile.focusClass)}).bind("blur",function(){t.button.removeClass(e.mobile.focusClass)}).bind("focus vmouseover",function(){t.button.trigger("vmouseover")}).bind("vmousemove",function(){t.button.removeClass(e.mobile.activeBtnClass)}).bind("change blur vmouseout",function(){t.button.trigger("vmouseout").removeClass(e.mobile.activeBtnClass)}),t.button.bind("vmousedown",function(){t.options.preventFocusZoom&&e.mobile.zoom.disable(!0)}),t.label.bind("click focus",function(){t.options.preventFocusZoom&&e.mobile.zoom.disable(!0)}),t.select.bind("focus",function(){t.options.preventFocusZoom&&e.mobile.zoom.disable(!0)}),t.button.bind("mouseup",function(){t.options.preventFocusZoom&&setTimeout(function(){e.mobile.zoom.enable(!0)},0)}),t.select.bind("blur",function(){t.options.preventFocusZoom&&e.mobile.zoom.enable(!0)})},selected:function(){return this._selectOptions().filter(":selected")},selectedIndices:function(){var e=this;return this.selected().map(function(){return e._selectOptions().index(this)}).get()},setButtonText:function(){var t=this,o=this.selected(),i=this.placeholder,a=e(n.createElement("span"));this.button.children("span").not(".ui-li-count").remove().end().end().prepend(function(){return i=o.length?o.map(function(){return e(this).text()}).get().join(", "):t.placeholder,i?a.text(i):a.html("&#160;"),a.addClass(t.select.attr("class")).addClass(o.attr("class")).removeClass("ui-screen-hidden")}())},setButtonCount:function(){var e=this.selected();this.isMultiple&&this.buttonCount[e.length>1?"show":"hide"]().text(e.length)},_handleKeydown:function(){this._delay("_refreshButton")},_reset:function(){this.refresh()},_refreshButton:function(){this.setButtonText(),this.setButtonCount()},refresh:function(){this._refreshButton()},open:e.noop,close:e.noop,disable:function(){this._setDisabled(!0),this.button.addClass("ui-state-disabled")},enable:function(){this._setDisabled(!1),this.button.removeClass("ui-state-disabled")}},e.mobile.behaviors.formReset))}(e),function(e){e.mobile.links=function(t){e(t).find("a").jqmEnhanceable().filter(":jqmData(rel='popup')[href][href!='']").each(function(){var e=this,t=e.getAttribute("href").substring(1);t&&(e.setAttribute("aria-haspopup",!0),e.setAttribute("aria-owns",t),e.setAttribute("aria-expanded",!1))}).end().not(".ui-btn, :jqmData(role='none'), :jqmData(role='nojs')").addClass("ui-link")}}(e),function(e,n){function o(e,t,n,o){return t>e?n+(e-t)/2:Math.min(Math.max(n,o-t/2),n+e-t)}function i(e){return{x:e.scrollLeft(),y:e.scrollTop(),cx:e[0].innerWidth||e.width(),cy:e[0].innerHeight||e.height()}}e.widget("mobile.popup",{options:{wrapperClass:null,theme:null,overlayTheme:null,shadow:!0,corners:!0,transition:"none",positionTo:"origin",tolerance:null,closeLinkSelector:"a:jqmData(rel='back')",closeLinkEvents:"click.popup",navigateEvents:"navigate.popup",closeEvents:"navigate.popup pagebeforechange.popup",dismissible:!0,enhanced:!1,history:!e.mobile.browser.oldIE},_create:function(){var t=this.element,n=t.attr("id"),o=this.options;o.history=o.history&&e.mobile.ajaxEnabled&&e.mobile.hashListeningEnabled,e.extend(this,{_scrollTop:0,_page:t.closest(".ui-page"),_ui:null,_fallbackTransition:"",_currentTransition:!1,_prerequisites:null,_isOpen:!1,_tolerance:null,_resizeData:null,_ignoreResizeTo:0,_orientationchangeInProgress:!1}),0===this._page.length&&(this._page=e("body")),o.enhanced?this._ui={container:t.parent(),screen:t.parent().prev(),placeholder:e(this.document[0].getElementById(n+"-placeholder"))}:(this._ui=this._enhance(t,n),this._applyTransition(o.transition)),this._setTolerance(o.tolerance)._ui.focusElement=this._ui.container,this._on(this._ui.screen,{vclick:"_eatEventAndClose"}),this._on(this.window,{orientationchange:e.proxy(this,"_handleWindowOrientationchange"),resize:e.proxy(this,"_handleWindowResize"),keyup:e.proxy(this,"_handleWindowKeyUp")}),this._on(this.document,{focusin:"_handleDocumentFocusIn"})},_enhance:function(t,n){var o=this.options,i=o.wrapperClass,a={screen:e("<div class='ui-screen-hidden ui-popup-screen "+this._themeClassFromOption("ui-overlay-",o.overlayTheme)+"'></div>"),placeholder:e("<div style='display: none;'>\x3c!-- placeholder --\x3e</div>"),container:e("<div class='ui-popup-container ui-popup-hidden ui-popup-truncate"+(i?" "+i:"")+"'></div>")},r=this.document[0].createDocumentFragment();return r.appendChild(a.screen[0]),r.appendChild(a.container[0]),n&&(a.screen.attr("id",n+"-screen"),a.container.attr("id",n+"-popup"),a.placeholder.attr("id",n+"-placeholder").html("\x3c!-- placeholder for "+n+" --\x3e")),this._page[0].appendChild(r),a.placeholder.insertAfter(t),t.detach().addClass("ui-popup "+this._themeClassFromOption("ui-body-",o.theme)+" "+(o.shadow?"ui-overlay-shadow ":"")+(o.corners?"ui-corner-all ":"")).appendTo(a.container),a},_eatEventAndClose:function(e){return e.preventDefault(),e.stopImmediatePropagation(),this.options.dismissible&&this.close(),!1},_resizeScreen:function(){var e=this._ui.screen,t=this._ui.container.outerHeight(!0),n=e.removeAttr("style").height(),o=this.document.height()-1;o>n?e.height(o):t>n&&e.height(t)},_handleWindowKeyUp:function(t){return this._isOpen&&t.keyCode===e.mobile.keyCode.ESCAPE?this._eatEventAndClose(t):void 0},_expectResizeEvent:function(){var e=i(this.window);if(this._resizeData){if(e.x===this._resizeData.windowCoordinates.x&&e.y===this._resizeData.windowCoordinates.y&&e.cx===this._resizeData.windowCoordinates.cx&&e.cy===this._resizeData.windowCoordinates.cy)return!1;clearTimeout(this._resizeData.timeoutId)}return this._resizeData={timeoutId:this._delay("_resizeTimeout",200),windowCoordinates:e},!0},_resizeTimeout:function(){this._isOpen?this._expectResizeEvent()||(this._ui.container.hasClass("ui-popup-hidden")&&(this._ui.container.removeClass("ui-popup-hidden ui-popup-truncate"),this.reposition({positionTo:"window"}),this._ignoreResizeEvents()),this._resizeScreen(),this._resizeData=null,this._orientationchangeInProgress=!1):(this._resizeData=null,this._orientationchangeInProgress=!1)},_stopIgnoringResizeEvents:function(){this._ignoreResizeTo=0},_ignoreResizeEvents:function(){this._ignoreResizeTo&&clearTimeout(this._ignoreResizeTo),this._ignoreResizeTo=this._delay("_stopIgnoringResizeEvents",1e3)},_handleWindowResize:function(){this._isOpen&&0===this._ignoreResizeTo&&(!this._expectResizeEvent()&&!this._orientationchangeInProgress||this._ui.container.hasClass("ui-popup-hidden")||this._ui.container.addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style"))},_handleWindowOrientationchange:function(){!this._orientationchangeInProgress&&this._isOpen&&0===this._ignoreResizeTo&&(this._expectResizeEvent(),this._orientationchangeInProgress=!0)},_handleDocumentFocusIn:function(t){var n,o=t.target,i=this._ui;if(this._isOpen){if(o!==i.container[0]){if(n=e(o),0===n.parents().filter(i.container[0]).length)return e(this.document[0].activeElement).one("focus",function(){n.blur()}),i.focusElement.focus(),t.preventDefault(),t.stopImmediatePropagation(),!1;i.focusElement[0]===i.container[0]&&(i.focusElement=n)}this._ignoreResizeEvents()}},_themeClassFromOption:function(e,t){return t?"none"===t?"":e+t:e+"inherit"},_applyTransition:function(t){return t&&(this._ui.container.removeClass(this._fallbackTransition),"none"!==t&&(this._fallbackTransition=e.mobile._maybeDegradeTransition(t),"none"===this._fallbackTransition&&(this._fallbackTransition=""),this._ui.container.addClass(this._fallbackTransition))),this},_setOptions:function(e){var t=this.options,o=this.element,i=this._ui.screen;return e.wrapperClass!==n&&this._ui.container.removeClass(t.wrapperClass).addClass(e.wrapperClass),e.theme!==n&&o.removeClass(this._themeClassFromOption("ui-body-",t.theme)).addClass(this._themeClassFromOption("ui-body-",e.theme)),e.overlayTheme!==n&&(i.removeClass(this._themeClassFromOption("ui-overlay-",t.overlayTheme)).addClass(this._themeClassFromOption("ui-overlay-",e.overlayTheme)),this._isOpen&&i.addClass("in")),e.shadow!==n&&o.toggleClass("ui-overlay-shadow",e.shadow),e.corners!==n&&o.toggleClass("ui-corner-all",e.corners),e.transition!==n&&(this._currentTransition||this._applyTransition(e.transition)),e.tolerance!==n&&this._setTolerance(e.tolerance),e.disabled!==n&&e.disabled&&this.close(),this._super(e)},_setTolerance:function(t){var o,i={t:30,r:15,b:30,l:15};if(t!==n)switch(o=String(t).split(","),e.each(o,function(e,t){o[e]=parseInt(t,10)}),o.length){case 1:isNaN(o[0])||(i.t=i.r=i.b=i.l=o[0]);break;case 2:isNaN(o[0])||(i.t=i.b=o[0]),isNaN(o[1])||(i.l=i.r=o[1]);break;case 4:isNaN(o[0])||(i.t=o[0]),isNaN(o[1])||(i.r=o[1]),isNaN(o[2])||(i.b=o[2]),isNaN(o[3])||(i.l=o[3])}return this._tolerance=i,this},_clampPopupWidth:function(e){var t,n=i(this.window),o={x:this._tolerance.l,y:n.y+this._tolerance.t,cx:n.cx-this._tolerance.l-this._tolerance.r,cy:n.cy-this._tolerance.t-this._tolerance.b};return e||this._ui.container.css("max-width",o.cx),t={cx:this._ui.container.outerWidth(!0),cy:this._ui.container.outerHeight(!0)},{rc:o,menuSize:t}},_calculateFinalLocation:function(e,t){var n,i=t.rc,a=t.menuSize;return n={left:o(i.cx,a.cx,i.x,e.x),top:o(i.cy,a.cy,i.y,e.y)},n.top=Math.max(0,n.top),n.top-=Math.min(n.top,Math.max(0,n.top+a.cy-this.document.height())),n},_placementCoords:function(e){return this._calculateFinalLocation(e,this._clampPopupWidth())},_createPrerequisites:function(t,n,o){var i,a=this;i={screen:e.Deferred(),container:e.Deferred()},i.screen.then(function(){i===a._prerequisites&&t()}),i.container.then(function(){i===a._prerequisites&&n()}),e.when(i.screen,i.container).done(function(){i===a._prerequisites&&(a._prerequisites=null,o())}),a._prerequisites=i},_animate:function(t){return this._ui.screen.removeClass(t.classToRemove).addClass(t.screenClassToAdd),t.prerequisites.screen.resolve(),t.transition&&"none"!==t.transition&&(t.applyTransition&&this._applyTransition(t.transition),this._fallbackTransition)?void this._ui.container.addClass(t.containerClassToAdd).removeClass(t.classToRemove).animationComplete(e.proxy(t.prerequisites.container,"resolve")):(this._ui.container.removeClass(t.classToRemove),void t.prerequisites.container.resolve())},_desiredCoords:function(t){var n,o=null,a=i(this.window),r=t.x,s=t.y,l=t.positionTo;if(l&&"origin"!==l)if("window"===l)r=a.cx/2+a.x,s=a.cy/2+a.y;else{try{o=e(l)}catch(p){o=null}o&&(o.filter(":visible"),0===o.length&&(o=null))}return o&&(n=o.offset(),r=n.left+o.outerWidth()/2,s=n.top+o.outerHeight()/2),("number"!==e.type(r)||isNaN(r))&&(r=a.cx/2+a.x),("number"!==e.type(s)||isNaN(s))&&(s=a.cy/2+a.y),{x:r,y:s}},_reposition:function(e){e={x:e.x,y:e.y,positionTo:e.positionTo},this._trigger("beforeposition",n,e),this._ui.container.offset(this._placementCoords(this._desiredCoords(e)))},reposition:function(e){this._isOpen&&this._reposition(e)},_openPrerequisitesComplete:function(){var e=this.element.attr("id");this._ui.container.addClass("ui-popup-active"),this._isOpen=!0,this._resizeScreen(),this._ui.container.attr("tabindex","0").focus(),this._ignoreResizeEvents(),e&&this.document.find("[aria-haspopup='true'][aria-owns='"+e+"']").attr("aria-expanded",!0),this._trigger("afteropen")},_open:function(t){var n=e.extend({},this.options,t),o=function(){var e=navigator.userAgent,t=e.match(/AppleWebKit\/([0-9\.]+)/),n=!!t&&t[1],o=e.match(/Android (\d+(?:\.\d+))/),i=!!o&&o[1],a=e.indexOf("Chrome")>-1;return!(!(null!==o&&"4.0"===i&&n&&n>534.13)||a)}();this._createPrerequisites(e.noop,e.noop,e.proxy(this,"_openPrerequisitesComplete")),this._currentTransition=n.transition,this._applyTransition(n.transition),this._ui.screen.removeClass("ui-screen-hidden"),this._ui.container.removeClass("ui-popup-truncate"),this._reposition(n),this._ui.container.removeClass("ui-popup-hidden"),this.options.overlayTheme&&o&&this.element.closest(".ui-page").addClass("ui-popup-open"),this._animate({additionalCondition:!0,transition:n.transition,classToRemove:"",screenClassToAdd:"in",containerClassToAdd:"in",applyTransition:!1,prerequisites:this._prerequisites})},_closePrerequisiteScreen:function(){this._ui.screen.removeClass("out").addClass("ui-screen-hidden")},_closePrerequisiteContainer:function(){this._ui.container.removeClass("reverse out").addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style")},_closePrerequisitesDone:function(){var t=this._ui.container,o=this.element.attr("id");t.removeAttr("tabindex"),e.mobile.popup.active=n,e(":focus",t[0]).add(t[0]).blur(),o&&this.document.find("[aria-haspopup='true'][aria-owns='"+o+"']").attr("aria-expanded",!1),this._trigger("afterclose")},_close:function(t){this._ui.container.removeClass("ui-popup-active"),this._page.removeClass("ui-popup-open"),this._isOpen=!1,this._createPrerequisites(e.proxy(this,"_closePrerequisiteScreen"),e.proxy(this,"_closePrerequisiteContainer"),e.proxy(this,"_closePrerequisitesDone")),this._animate({additionalCondition:this._ui.screen.hasClass("in"),transition:t?"none":this._currentTransition,classToRemove:"in",screenClassToAdd:"out",containerClassToAdd:"reverse out",applyTransition:!0,prerequisites:this._prerequisites})},_unenhance:function(){this.options.enhanced||(this._setOptions({theme:e.mobile.popup.prototype.options.theme}),this.element.detach().insertAfter(this._ui.placeholder).removeClass("ui-popup ui-overlay-shadow ui-corner-all ui-body-inherit"),this._ui.screen.remove(),this._ui.container.remove(),this._ui.placeholder.remove())},_destroy:function(){return e.mobile.popup.active===this?(this.element.one("popupafterclose",e.proxy(this,"_unenhance")),this.close()):this._unenhance(),this},_closePopup:function(n,o){var i,a,r=this.options,s=!1;n&&n.isDefaultPrevented()||e.mobile.popup.active!==this||(t.scrollTo(0,this._scrollTop),n&&"pagebeforechange"===n.type&&o&&(i="string"==typeof o.toPage?o.toPage:o.toPage.jqmData("url"),i=e.mobile.path.parseUrl(i),a=i.pathname+i.search+i.hash,this._myUrl!==e.mobile.path.makeUrlAbsolute(a)?s=!0:n.preventDefault()),this.window.off(r.closeEvents),this.element.undelegate(r.closeLinkSelector,r.closeLinkEvents),this._close(s))},_bindContainerClose:function(){this.window.on(this.options.closeEvents,e.proxy(this,"_closePopup"))},widget:function(){return this._ui.container},open:function(t){var n,o,i,a,r,s=this,l=this.options;return e.mobile.popup.active||l.disabled?this:(e.mobile.popup.active=this,this._scrollTop=this.window.scrollTop(),l.history?(r=e.mobile.navigate.history,o=e.mobile.dialogHashKey,i=e.mobile.activePage,a=!!i&&i.hasClass("ui-dialog"),this._myUrl=n=r.getActive().url,n.indexOf(o)>-1&&!a&&r.activeIndex>0?(s._open(t),s._bindContainerClose(),this):(-1!==n.indexOf(o)||a?n=e.mobile.path.parseLocation().hash+o:n+=n.indexOf("#")>-1?o:"#"+o,0===r.activeIndex&&n===r.initialDst&&(n+=o),this.window.one("beforenavigate",function(e){e.preventDefault(),s._open(t),s._bindContainerClose()}),this.urlAltered=!0,e.mobile.navigate(n,{role:"dialog"}),this)):(s._open(t),s._bindContainerClose(),s.element.delegate(l.closeLinkSelector,l.closeLinkEvents,function(e){s.close(),e.preventDefault()}),this))},close:function(){return e.mobile.popup.active!==this?this:(this._scrollTop=this.window.scrollTop(),this.options.history&&this.urlAltered?(e.mobile.back(),this.urlAltered=!1):this._closePopup(),this)}}),e.mobile.popup.handleLink=function(t){var n,o=e.mobile.path,i=e(o.hashToSelector(o.parseUrl(t.attr("href")).hash)).first();i.length>0&&i.data("mobile-popup")&&(n=t.offset(),i.popup("open",{x:n.left+t.outerWidth()/2,y:n.top+t.outerHeight()/2,transition:t.jqmData("transition"),positionTo:t.jqmData("position-to")})),setTimeout(function(){t.removeClass(e.mobile.activeBtnClass)},300)},e.mobile.document.on("pagebeforechange",function(t,n){"popup"===n.options.role&&(e.mobile.popup.handleLink(n.options.link),t.preventDefault())})}(e),function(e,t){var o=".ui-disabled,.ui-state-disabled,.ui-li-divider,.ui-screen-hidden,:jqmData(role='placeholder')",i=function(e,t,n){var i=e[n+"All"]().not(o).first();i.length&&(t.blur().attr("tabindex","-1"),i.find("a").first().focus())};e.widget("mobile.selectmenu",e.mobile.selectmenu,{_create:function(){var e=this.options;return e.nativeMenu=e.nativeMenu||this.element.parents(":jqmData(role='popup'),:mobile-popup").length>0,this._super()},_handleSelectFocus:function(){this.element.blur(),this.button.focus()},_handleKeydown:function(e){this._super(e),this._handleButtonVclickKeydown(e)},_handleButtonVclickKeydown:function(t){this.options.disabled||this.isOpen||("vclick"===t.type||t.keyCode&&(t.keyCode===e.mobile.keyCode.ENTER||t.keyCode===e.mobile.keyCode.SPACE))&&(this._decideFormat(),"overlay"===this.menuType?this.button.attr("href","#"+this.popupId).attr("data-"+(e.mobile.ns||"")+"rel","popup"):this.button.attr("href","#"+this.dialogId).attr("data-"+(e.mobile.ns||"")+"rel","dialog"),this.isOpen=!0)},_handleListFocus:function(t){var n="focusin"===t.type?{tabindex:"0",event:"vmouseover"}:{tabindex:"-1",event:"vmouseout"};e(t.target).attr("tabindex",n.tabindex).trigger(n.event)},_handleListKeydown:function(t){var n=e(t.target),o=n.closest("li");switch(t.keyCode){case 38:return i(o,n,"prev"),!1;case 40:return i(o,n,"next"),!1;case 13:case 32:return n.trigger("click"),!1}},_handleMenuPageHide:function(){this.thisPage.page("bindRemove")},_handleHeaderCloseClick:function(){return"overlay"===this.menuType?(this.close(),!1):void 0},build:function(){var n,o,i,a,r,s,l,p,c,u,h,g,m,d,b,_,f,w,v=this.options;return v.nativeMenu?this._super():(w=this,n=this.selectId,o=n+"-listbox",i=n+"-dialog",a=this.label,r=this.element.closest(".ui-page"),s=this.element[0].multiple,l=n+"-menu",p=v.theme?" data-"+e.mobile.ns+"theme='"+v.theme+"'":"",c=v.overlayTheme||v.theme||null,u=c?" data-"+e.mobile.ns+"overlay-theme='"+c+"'":"",h=v.dividerTheme&&s?" data-"+e.mobile.ns+"divider-theme='"+v.dividerTheme+"'":"",g=e("<div data-"+e.mobile.ns+"role='dialog' class='ui-selectmenu' id='"+i+"'"+p+u+"><div data-"+e.mobile.ns+"role='header'><div class='ui-title'>"+a.getEncodedText()+"</div></div><div data-"+e.mobile.ns+"role='content'></div></div>"),m=e("<div id='"+o+"' class='ui-selectmenu'></div>").insertAfter(this.select).popup({theme:v.overlayTheme}),d=e("<ul class='ui-selectmenu-list' id='"+l+"' role='listbox' aria-labelledby='"+this.buttonId+"'"+p+h+"></ul>").appendTo(m),b=e("<div class='ui-header ui-bar-"+(v.theme?v.theme:"inherit")+"'></div>").prependTo(m),_=e("<h1 class='ui-title'></h1>").appendTo(b),this.isMultiple&&(f=e("<a>",{role:"button",text:v.closeText,href:"#","class":"ui-btn ui-corner-all ui-btn-left ui-btn-icon-notext ui-icon-delete"}).appendTo(b)),e.extend(this,{selectId:n,menuId:l,popupId:o,dialogId:i,thisPage:r,menuPage:g,label:a,isMultiple:s,theme:v.theme,listbox:m,list:d,header:b,headerTitle:_,headerClose:f,menuPageContent:void 0,menuPageClose:void 0,placeholder:""}),this.refresh(),this._origTabIndex===t&&(this._origTabIndex=null!==this.select[0].getAttribute("tabindex")&&this.select.attr("tabindex")),this.select.attr("tabindex","-1"),this._on(this.select,{focus:"_handleSelectFocus"}),this._on(this.button,{vclick:"_handleButtonVclickKeydown"}),this.list.attr("role","listbox"),this._on(this.list,{focusin:"_handleListFocus",focusout:"_handleListFocus",keydown:"_handleListKeydown"}),this.list.delegate("li:not(.ui-disabled,.ui-state-disabled,.ui-li-divider)","click",function(t){var n=w.select[0].selectedIndex,o=e.mobile.getAttribute(this,"option-index"),i=w._selectOptions().eq(o)[0];i.selected=!w.isMultiple||!i.selected,w.isMultiple&&e(this).find("a").toggleClass("ui-checkbox-on",i.selected).toggleClass("ui-checkbox-off",!i.selected),(w.isMultiple||n!==o)&&w.select.trigger("change"),w.isMultiple?w.list.find("li:not(.ui-li-divider)").eq(o).find("a").first().focus():w.close(),t.preventDefault()}),this._on(this.menuPage,{pagehide:"_handleMenuPageHide"}),this._on(this.listbox,{popupafterclose:"close"}),this.isMultiple&&this._on(this.headerClose,{click:"_handleHeaderCloseClick"}),this)},_isRebuildRequired:function(){var e=this.list.find("li");return this._selectOptions().not(".ui-screen-hidden").text()!==e.text()},selected:function(){return this._selectOptions().filter(":selected:not( :jqmData(placeholder='true') )")},refresh:function(t){var n,o;return this.options.nativeMenu?this._super(t):(n=this,(t||this._isRebuildRequired())&&n._buildList(),o=this.selectedIndices(),n.setButtonText(),n.setButtonCount(),void n.list.find("li:not(.ui-li-divider)").find("a").removeClass(e.mobile.activeBtnClass).end().attr("aria-selected",!1).each(function(t){if(e.inArray(t,o)>-1){var i=e(this);i.attr("aria-selected",!0),n.isMultiple?i.find("a").removeClass("ui-checkbox-off").addClass("ui-checkbox-on"):i.hasClass("ui-screen-hidden")?i.next().find("a").addClass(e.mobile.activeBtnClass):i.find("a").addClass(e.mobile.activeBtnClass)}}))},close:function(){if(!this.options.disabled&&this.isOpen){var e=this;"page"===e.menuType?(e.menuPage.dialog("close"),e.list.appendTo(e.listbox)):e.listbox.popup("close"),
e._focusButton(),e.isOpen=!1}},open:function(){this.button.click()},_focusMenuItem:function(){var t=this.list.find("a."+e.mobile.activeBtnClass);0===t.length&&(t=this.list.find("li:not("+o+") a.ui-btn")),t.first().focus()},_decideFormat:function(){var t=this,n=this.window,o=t.list.parent(),i=o.outerHeight(),a=n.scrollTop(),r=t.button.offset().top,s=n.height();i>s-80||!e.support.scrollTop?(t.menuPage.appendTo(e.mobile.pageContainer).page(),t.menuPageContent=t.menuPage.find(".ui-content"),t.menuPageClose=t.menuPage.find(".ui-header a"),t.thisPage.unbind("pagehide.remove"),0===a&&r>s&&t.thisPage.one("pagehide",function(){e(this).jqmData("lastScroll",r)}),t.menuPage.one({pageshow:e.proxy(this,"_focusMenuItem"),pagehide:e.proxy(this,"close")}),t.menuType="page",t.menuPageContent.append(t.list),t.menuPage.find("div .ui-title").text(t.label.text())):(t.menuType="overlay",t.listbox.one({popupafteropen:e.proxy(this,"_focusMenuItem")}))},_buildList:function(){var t,o,i,a,r,s,l,p,c,u,h,g,m,d,b=this,_=this.options,f=this.placeholder,w=!0,v="data-"+e.mobile.ns,P=v+"option-index",E=v+"icon",T=v+"role",N=v+"placeholder",S=n.createDocumentFragment(),I=!1;for(b.list.empty().filter(".ui-listview").listview("destroy"),t=this._selectOptions(),o=t.length,i=this.select[0],r=0;o>r;r++,I=!1)s=t[r],l=e(s),l.hasClass("ui-screen-hidden")||(p=s.parentNode,c=l.text(),u=n.createElement("a"),h=[],u.setAttribute("href","#"),u.appendChild(n.createTextNode(c)),p!==i&&"optgroup"===p.nodeName.toLowerCase()&&(g=p.getAttribute("label"))!==a&&(m=n.createElement("li"),m.setAttribute(T,"list-divider"),m.setAttribute("role","option"),m.setAttribute("tabindex","-1"),m.appendChild(n.createTextNode(g)),S.appendChild(m),a=g),!w||s.getAttribute("value")&&0!==c.length&&!l.jqmData("placeholder")||(w=!1,I=!0,null===s.getAttribute(N)&&(this._removePlaceholderAttr=!0),s.setAttribute(N,!0),_.hidePlaceholderMenuItems&&h.push("ui-screen-hidden"),f!==c&&(f=b.placeholder=c)),d=n.createElement("li"),s.disabled&&(h.push("ui-state-disabled"),d.setAttribute("aria-disabled",!0)),d.setAttribute(P,r),d.setAttribute(E,"false"),I&&d.setAttribute(N,!0),d.className=h.join(" "),d.setAttribute("role","option"),u.setAttribute("tabindex","-1"),this.isMultiple&&e(u).addClass("ui-btn ui-checkbox-off ui-btn-icon-right"),d.appendChild(u),S.appendChild(d));b.list[0].appendChild(S),this.isMultiple||f.length?this.headerTitle.text(this.placeholder):this.header.addClass("ui-screen-hidden"),b.list.listview()},_button:function(){return this.options.nativeMenu?this._super():e("<a>",{href:"#",role:"button",id:this.buttonId,"aria-haspopup":"true","aria-owns":this.menuId})},_destroy:function(){this.options.nativeMenu||(this.close(),this._origTabIndex!==t&&(!1!==this._origTabIndex?this.select.attr("tabindex",this._origTabIndex):this.select.removeAttr("tabindex")),this._removePlaceholderAttr&&this._selectOptions().removeAttr("data-"+e.mobile.ns+"placeholder"),this.listbox.remove(),this.menuPage.remove()),this._super()}})}(e),function(e,t){function n(e,t){var n=t||[];return n.push("ui-btn"),e.theme&&n.push("ui-btn-"+e.theme),e.icon&&(n=n.concat(["ui-icon-"+e.icon,"ui-btn-icon-"+e.iconpos]),e.iconshadow&&n.push("ui-shadow-icon")),e.inline&&n.push("ui-btn-inline"),e.shadow&&n.push("ui-shadow"),e.corners&&n.push("ui-corner-all"),e.mini&&n.push("ui-mini"),n}function o(e){var n,o,i,r=!1,s=!0,l={icon:"",inline:!1,shadow:!1,corners:!1,iconshadow:!1,mini:!1},p=[];for(e=e.split(" "),n=0;n<e.length;n++)i=!0,o=a[e[n]],o!==t?(i=!1,l[o]=!0):0===e[n].indexOf("ui-btn-icon-")?(i=!1,s=!1,l.iconpos=e[n].substring(12)):0===e[n].indexOf("ui-icon-")?(i=!1,l.icon=e[n].substring(8)):0===e[n].indexOf("ui-btn-")&&8===e[n].length?(i=!1,l.theme=e[n].substring(7)):"ui-btn"===e[n]&&(i=!1,r=!0),i&&p.push(e[n]);return s&&(l.icon=""),{options:l,unknownClasses:p,alreadyEnhanced:r}}function i(e){return"-"+e.toLowerCase()}var a={"ui-shadow":"shadow","ui-corner-all":"corners","ui-btn-inline":"inline","ui-shadow-icon":"iconshadow","ui-mini":"mini"},r=function(){var n=e.mobile.getAttribute.apply(this,arguments);return null==n?t:n};e.fn.buttonMarkup=function(a,s){var l,p,c,u,h,g=e.fn.buttonMarkup.defaults;for(l=0;l<this.length;l++){if(c=this[l],p=s?{alreadyEnhanced:!1,unknownClasses:[]}:o(c.className),u=e.extend({},p.alreadyEnhanced?p.options:{},a),!p.alreadyEnhanced)for(h in g)u[h]===t&&(u[h]=r(c,h.replace(/[A-Z]/g,i)));c.className=n(e.extend({},g,u),p.unknownClasses).join(" "),"button"!==c.tagName.toLowerCase()&&c.setAttribute("role","button")}return this},e.fn.buttonMarkup.defaults={icon:"",iconpos:"left",theme:null,inline:!1,shadow:!0,corners:!0,iconshadow:!1,mini:!1},e.extend(e.fn.buttonMarkup,{initSelector:"a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a, button"})}(e),function(e,t){e.widget("mobile.controlgroup",e.extend({options:{enhanced:!1,theme:null,shadow:!1,corners:!0,excludeInvisible:!0,type:"vertical",mini:!1},_create:function(){var t=this.element,n=this.options;e.fn.buttonMarkup&&this.element.find(e.fn.buttonMarkup.initSelector).buttonMarkup(),e.each(this._childWidgets,e.proxy(function(t,n){e.mobile[n]&&this.element.find(e.mobile[n].initSelector).not(e.mobile.page.prototype.keepNativeSelector())[n]()},this)),e.extend(this,{_ui:null,_initialRefresh:!0}),this._ui=n.enhanced?{groupLegend:t.children(".ui-controlgroup-label").children(),childWrapper:t.children(".ui-controlgroup-controls")}:this._enhance()},_childWidgets:["checkboxradio","selectmenu","button"],_themeClassFromOption:function(e){return e?"none"===e?"":"ui-group-theme-"+e:""},_enhance:function(){var t=this.element,n=this.options,o={groupLegend:t.children("legend"),childWrapper:t.addClass("ui-controlgroup ui-controlgroup-"+("horizontal"===n.type?"horizontal":"vertical")+" "+this._themeClassFromOption(n.theme)+" "+(n.corners?"ui-corner-all ":"")+(n.mini?"ui-mini ":"")).wrapInner("<div class='ui-controlgroup-controls "+(!0===n.shadow?"ui-shadow":"")+"'></div>").children()};return o.groupLegend.length>0&&e("<div role='heading' class='ui-controlgroup-label'></div>").append(o.groupLegend).prependTo(t),o},_init:function(){this.refresh()},_setOptions:function(e){var n,o,i=this.element;return e.type!==t&&(i.removeClass("ui-controlgroup-horizontal ui-controlgroup-vertical").addClass("ui-controlgroup-"+("horizontal"===e.type?"horizontal":"vertical")),n=!0),e.theme!==t&&i.removeClass(this._themeClassFromOption(this.options.theme)).addClass(this._themeClassFromOption(e.theme)),e.corners!==t&&i.toggleClass("ui-corner-all",e.corners),e.mini!==t&&i.toggleClass("ui-mini",e.mini),e.shadow!==t&&this._ui.childWrapper.toggleClass("ui-shadow",e.shadow),e.excludeInvisible!==t&&(this.options.excludeInvisible=e.excludeInvisible,n=!0),o=this._super(e),n&&this.refresh(),o},container:function(){return this._ui.childWrapper},refresh:function(){var t=this.container(),n=t.find(".ui-btn").not(".ui-slider-handle"),o=this._initialRefresh;e.mobile.checkboxradio&&t.find(":mobile-checkboxradio").checkboxradio("refresh"),this._addFirstLastClasses(n,this.options.excludeInvisible?this._getVisibles(n,o):n,o),this._initialRefresh=!1},_destroy:function(){var e,t,n=this.options;return n.enhanced?this:(e=this._ui,t=this.element.removeClass("ui-controlgroup ui-controlgroup-horizontal ui-controlgroup-vertical ui-corner-all ui-mini "+this._themeClassFromOption(n.theme)).find(".ui-btn").not(".ui-slider-handle"),this._removeFirstLastClasses(t),e.groupLegend.unwrap(),void e.childWrapper.children().unwrap())}},e.mobile.behaviors.addFirstLastClasses))}(e),function(e,t){e.widget("mobile.toolbar",{initSelector:":jqmData(role='footer'), :jqmData(role='header')",options:{theme:null,addBackBtn:!1,backBtnTheme:null,backBtnText:"Back"},_create:function(){var t=this.element.is(":jqmData(role='header')")?"header":"footer",n=this.element.closest(".ui-page");0===n.length&&(n=!1,this._on(this.document,{pageshow:"refresh"})),e.extend(this,{role:t,page:n,leftbtn:void 0,rightbtn:void 0}),this.element.attr("role","header"===t?"banner":"contentinfo").addClass("ui-"+t),this.refresh(),this._setOptions(this.options)},_setOptions:function(n){if(n.addBackBtn!==t&&(this.options.addBackBtn&&"header"===this.role&&e(".ui-page").length>1&&this.page[0].getAttribute("data-"+e.mobile.ns+"url")!==e.mobile.path.stripHash(location.hash)&&!this.leftbtn?this._addBackButton():this.element.find(".ui-toolbar-back-btn").remove()),null!=n.backBtnTheme&&this.element.find(".ui-toolbar-back-btn").addClass("ui-btn ui-btn-"+n.backBtnTheme),n.backBtnText!==t&&this.element.find(".ui-toolbar-back-btn .ui-btn-text").text(n.backBtnText),n.theme!==t){var o=this.options.theme?this.options.theme:"inherit",i=n.theme?n.theme:"inherit";this.element.removeClass("ui-bar-"+o).addClass("ui-bar-"+i)}this._super(n)},refresh:function(){"header"===this.role&&this._addHeaderButtonClasses(),this.page||(this._setRelative(),"footer"===this.role&&this.element.appendTo("body")),this._addHeadingClasses(),this._btnMarkup()},_setRelative:function(){e("[data-"+e.mobile.ns+"role='page']").css({position:"relative"})},_btnMarkup:function(){this.element.children("a").filter(":not([data-"+e.mobile.ns+"role='none'])").attr("data-"+e.mobile.ns+"role","button"),this.element.trigger("create")},_addHeaderButtonClasses:function(){var e=this.element.children("a, button");this.leftbtn=e.hasClass("ui-btn-left"),this.rightbtn=e.hasClass("ui-btn-right"),this.leftbtn=this.leftbtn||e.eq(0).not(".ui-btn-right").addClass("ui-btn-left").length,this.rightbtn=this.rightbtn||e.eq(1).addClass("ui-btn-right").length},_addBackButton:function(){var t=this.options,n=t.backBtnTheme||t.theme;e("<a role='button' href='javascript:void(0);' class='ui-btn ui-corner-all ui-shadow ui-btn-left "+(n?"ui-btn-"+n+" ":"")+"ui-toolbar-back-btn ui-icon-carat-l ui-btn-icon-left' data-"+e.mobile.ns+"rel='back'>"+t.backBtnText+"</a>").prependTo(this.element)},_addHeadingClasses:function(){this.element.children("h1, h2, h3, h4, h5, h6").addClass("ui-title").attr({role:"heading","aria-level":"1"})}})}(e),function(e,t){e.widget("mobile.toolbar",e.mobile.toolbar,{options:{position:null,visibleOnPageShow:!0,disablePageZoom:!0,transition:"slide",fullscreen:!1,tapToggle:!0,tapToggleBlacklist:"a, button, input, select, textarea, .ui-header-fixed, .ui-footer-fixed, .ui-flipswitch, .ui-popup, .ui-panel, .ui-panel-dismiss-open",hideDuringFocus:"input, textarea, select",updatePagePadding:!0,trackPersistentToolbars:!0,supportBlacklist:function(){return!e.support.fixedPosition}},_create:function(){this._super(),"fixed"!==this.options.position||this.options.supportBlacklist()||this._makeFixed()},_makeFixed:function(){this.element.addClass("ui-"+this.role+"-fixed"),this.updatePagePadding(),this._addTransitionClass(),this._bindPageEvents(),this._bindToggleHandlers()},_setOptions:function(n){if("fixed"===n.position&&"fixed"!==this.options.position&&this._makeFixed(),"fixed"===this.options.position&&!this.options.supportBlacklist()){var o=this.page?this.page:e(".ui-page-active").length>0?e(".ui-page-active"):e(".ui-page").eq(0);n.fullscreen!==t&&(n.fullscreen?(this.element.addClass("ui-"+this.role+"-fullscreen"),o.addClass("ui-page-"+this.role+"-fullscreen")):(this.element.removeClass("ui-"+this.role+"-fullscreen"),o.removeClass("ui-page-"+this.role+"-fullscreen").addClass("ui-page-"+this.role+"-fixed")))}this._super(n)},_addTransitionClass:function(){var e=this.options.transition;e&&"none"!==e&&("slide"===e&&(e=this.element.hasClass("ui-header")?"slidedown":"slideup"),this.element.addClass(e))},_bindPageEvents:function(){var e=this.page?this.element.closest(".ui-page"):this.document;this._on(e,{pagebeforeshow:"_handlePageBeforeShow",webkitAnimationStart:"_handleAnimationStart",animationstart:"_handleAnimationStart",updatelayout:"_handleAnimationStart",pageshow:"_handlePageShow",pagebeforehide:"_handlePageBeforeHide"})},_handlePageBeforeShow:function(){var t=this.options;t.disablePageZoom&&e.mobile.zoom.disable(!0),t.visibleOnPageShow||this.hide(!0)},_handleAnimationStart:function(){this.options.updatePagePadding&&this.updatePagePadding(this.page?this.page:".ui-page-active")},_handlePageShow:function(){this.updatePagePadding(this.page?this.page:".ui-page-active"),this.options.updatePagePadding&&this._on(this.window,{throttledresize:"updatePagePadding"})},_handlePageBeforeHide:function(t,n){var o,i,a,r,s=this.options;s.disablePageZoom&&e.mobile.zoom.enable(!0),s.updatePagePadding&&this._off(this.window,"throttledresize"),s.trackPersistentToolbars&&(o=e(".ui-footer-fixed:jqmData(id)",this.page),i=e(".ui-header-fixed:jqmData(id)",this.page),a=o.length&&n.nextPage&&e(".ui-footer-fixed:jqmData(id='"+o.jqmData("id")+"')",n.nextPage)||e(),r=i.length&&n.nextPage&&e(".ui-header-fixed:jqmData(id='"+i.jqmData("id")+"')",n.nextPage)||e(),(a.length||r.length)&&(a.add(r).appendTo(e.mobile.pageContainer),n.nextPage.one("pageshow",function(){r.prependTo(this),a.appendTo(this)})))},_visible:!0,updatePagePadding:function(n){var o=this.element,i="header"===this.role,a=parseFloat(o.css(i?"top":"bottom"));this.options.fullscreen||(n=n&&n.type===t&&n||this.page||o.closest(".ui-page"),n=this.page?this.page:".ui-page-active",e(n).css("padding-"+(i?"top":"bottom"),o.outerHeight()+a))},_useTransition:function(t){var n=this.window,o=this.element,i=n.scrollTop(),a=o.height(),r=this.page?o.closest(".ui-page").height():e(".ui-page-active").height(),s=e.mobile.getScreenHeight();return!t&&(this.options.transition&&"none"!==this.options.transition&&("header"===this.role&&!this.options.fullscreen&&i>a||"footer"===this.role&&!this.options.fullscreen&&r-a>i+s)||this.options.fullscreen)},show:function(e){var t="ui-fixed-hidden",n=this.element;this._useTransition(e)?n.removeClass("out "+t).addClass("in").animationComplete(function(){n.removeClass("in")}):n.removeClass(t),this._visible=!0},hide:function(e){var t="ui-fixed-hidden",n=this.element,o="out"+("slide"===this.options.transition?" reverse":"");this._useTransition(e)?n.addClass(o).removeClass("in").animationComplete(function(){n.addClass(t).removeClass(o)}):n.addClass(t).removeClass(o),this._visible=!1},toggle:function(){this[this._visible?"hide":"show"]()},_bindToggleHandlers:function(){var t,n,o=this,i=o.options,a=!0;(this.page?this.page:e(".ui-page")).bind("vclick",function(t){i.tapToggle&&!e(t.target).closest(i.tapToggleBlacklist).length&&o.toggle()}).bind("focusin focusout",function(r){screen.width<1025&&e(r.target).is(i.hideDuringFocus)&&!e(r.target).closest(".ui-header-fixed, .ui-footer-fixed").length&&("focusout"!==r.type||a?"focusin"===r.type&&a&&(clearTimeout(t),a=!1,n=setTimeout(function(){o.hide()},0)):(a=!0,clearTimeout(n),t=setTimeout(function(){o.show()},0)))})},_setRelative:function(){"fixed"!==this.options.position&&e("[data-"+e.mobile.ns+"role='page']").css({position:"relative"})},_destroy:function(){var e=this.element,t=e.hasClass("ui-header");e.closest(".ui-page").css("padding-"+(t?"top":"bottom"),""),e.removeClass("ui-header-fixed ui-footer-fixed ui-header-fullscreen ui-footer-fullscreen in out fade slidedown slideup ui-fixed-hidden"),e.closest(".ui-page").removeClass("ui-page-header-fixed ui-page-footer-fixed ui-page-header-fullscreen ui-page-footer-fullscreen")}})}(e),function(e){e.widget("mobile.toolbar",e.mobile.toolbar,{_makeFixed:function(){this._super(),this._workarounds()},_workarounds:function(){var e=navigator.userAgent,t=navigator.platform,n=e.match(/AppleWebKit\/([0-9]+)/),o=!!n&&n[1],i=null,a=this;if(t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1||t.indexOf("iPod")>-1)i="ios";else{if(!(e.indexOf("Android")>-1))return;i="android"}if("ios"===i)a._bindScrollWorkaround();else{if(!("android"===i&&o&&534>o))return;a._bindScrollWorkaround(),a._bindListThumbWorkaround()}},_viewportOffset:function(){var e=this.element,t=e.hasClass("ui-header"),n=Math.abs(e.offset().top-this.window.scrollTop());return t||(n=Math.round(n-this.window.height()+e.outerHeight())-60),n},_bindScrollWorkaround:function(){var e=this;this._on(this.window,{scrollstop:function(){e._viewportOffset()>2&&e._visible&&e._triggerRedraw()}})},_bindListThumbWorkaround:function(){this.element.closest(".ui-page").addClass("ui-android-2x-fixed")},_triggerRedraw:function(){var t=parseFloat(e(".ui-page-active").css("padding-bottom"));e(".ui-page-active").css("padding-bottom",t+1+"px"),setTimeout(function(){e(".ui-page-active").css("padding-bottom",t+"px")},0)},destroy:function(){this._super(),this.element.closest(".ui-page-active").removeClass("ui-android-2x-fix")}})}(e),function(e,t){function n(){var e=i.clone(),t=e.eq(0),n=e.eq(1),o=n.children();return{arEls:n.add(t),gd:t,ct:n,ar:o}}var o=e.mobile.browser.oldIE&&e.mobile.browser.oldIE<=8,i=e("<div class='ui-popup-arrow-guide'></div><div class='ui-popup-arrow-container"+(o?" ie":"")+"'><div class='ui-popup-arrow'></div></div>");e.widget("mobile.popup",e.mobile.popup,{options:{arrow:""},_create:function(){var e=this._super();return this.options.arrow&&(this._ui.arrow=this._addArrow()),e},_addArrow:function(){var e,t=this.options,o=n();return e=this._themeClassFromOption("ui-body-",t.theme),o.ar.addClass(e+(t.shadow?" ui-overlay-shadow":"")),o.arEls.hide().appendTo(this.element),o},_unenhance:function(){var e=this._ui.arrow;return e&&e.arEls.remove(),this._super()},_tryAnArrow:function(e,t,n,o,i){var a,r,s,l={},p={};return o.arFull[e.dimKey]>o.guideDims[e.dimKey]?i:(l[e.fst]=n[e.fst]+(o.arHalf[e.oDimKey]+o.menuHalf[e.oDimKey])*e.offsetFactor-o.contentBox[e.fst]+(o.clampInfo.menuSize[e.oDimKey]-o.contentBox[e.oDimKey])*e.arrowOffsetFactor,l[e.snd]=n[e.snd],a=o.result||this._calculateFinalLocation(l,o.clampInfo),r={x:a.left,y:a.top},p[e.fst]=r[e.fst]+o.contentBox[e.fst]+e.tipOffset,p[e.snd]=Math.max(a[e.prop]+o.guideOffset[e.prop]+o.arHalf[e.dimKey],Math.min(a[e.prop]+o.guideOffset[e.prop]+o.guideDims[e.dimKey]-o.arHalf[e.dimKey],n[e.snd])),s=Math.abs(n.x-p.x)+Math.abs(n.y-p.y),(!i||s<i.diff)&&(p[e.snd]-=o.arHalf[e.dimKey]+a[e.prop]+o.contentBox[e.snd],i={dir:t,diff:s,result:a,posProp:e.prop,posVal:p[e.snd]}),i)},_getPlacementState:function(e){var t,n,o=this._ui.arrow,i={clampInfo:this._clampPopupWidth(!e),arFull:{cx:o.ct.width(),cy:o.ct.height()},guideDims:{cx:o.gd.width(),cy:o.gd.height()},guideOffset:o.gd.offset()};return t=this.element.offset(),o.gd.css({left:0,top:0,right:0,bottom:0}),n=o.gd.offset(),i.contentBox={x:n.left-t.left,y:n.top-t.top,cx:o.gd.width(),cy:o.gd.height()},o.gd.removeAttr("style"),i.guideOffset={left:i.guideOffset.left-t.left,top:i.guideOffset.top-t.top},i.arHalf={cx:i.arFull.cx/2,cy:i.arFull.cy/2},i.menuHalf={cx:i.clampInfo.menuSize.cx/2,cy:i.clampInfo.menuSize.cy/2},i},_placementCoords:function(t){var n,i,a,r,s,l=this.options.arrow,p=this._ui.arrow;return p?(p.arEls.show(),s={},n=this._getPlacementState(!0),a={l:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:1,tipOffset:-n.arHalf.cx,arrowOffsetFactor:0},r:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:-1,tipOffset:n.arHalf.cx+n.contentBox.cx,arrowOffsetFactor:1},b:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:-1,tipOffset:n.arHalf.cy+n.contentBox.cy,arrowOffsetFactor:1},t:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:1,tipOffset:-n.arHalf.cy,arrowOffsetFactor:0}},e.each((!0===l?"l,t,r,b":l).split(","),e.proxy(function(e,o){i=this._tryAnArrow(a[o],o,t,n,i)},this)),i?(p.ct.removeClass("ui-popup-arrow-l ui-popup-arrow-t ui-popup-arrow-r ui-popup-arrow-b").addClass("ui-popup-arrow-"+i.dir).removeAttr("style").css(i.posProp,i.posVal).show(),o||(r=this.element.offset(),s[a[i.dir].fst]=p.ct.offset(),s[a[i.dir].snd]={left:r.left+n.contentBox.x,top:r.top+n.contentBox.y}),i.result):(p.arEls.hide(),this._super(t))):this._super(t)},_setOptions:function(e){var n,o=this.options.theme,i=this._ui.arrow,a=this._super(e);if(e.arrow!==t){if(!i&&e.arrow)return void(this._ui.arrow=this._addArrow());i&&!e.arrow&&(i.arEls.remove(),this._ui.arrow=null)}return i=this._ui.arrow,i&&(e.theme!==t&&(o=this._themeClassFromOption("ui-body-",o),n=this._themeClassFromOption("ui-body-",e.theme),i.ar.removeClass(o).addClass(n)),e.shadow!==t&&i.ar.toggleClass("ui-overlay-shadow",e.shadow)),a},_destroy:function(){var e=this._ui.arrow;return e&&e.arEls.remove(),this._super()}})}(e),function(e,n){e.widget("mobile.panel",{options:{classes:{panel:"ui-panel",panelOpen:"ui-panel-open",panelClosed:"ui-panel-closed",panelFixed:"ui-panel-fixed",panelInner:"ui-panel-inner",modal:"ui-panel-dismiss",modalOpen:"ui-panel-dismiss-open",pageContainer:"ui-panel-page-container",pageWrapper:"ui-panel-wrapper",pageFixedToolbar:"ui-panel-fixed-toolbar",pageContentPrefix:"ui-panel-page-content",animate:"ui-panel-animate"},animate:!0,theme:null,position:"left",dismissible:!0,display:"reveal",swipeClose:!0,positionFixed:!1},_closeLink:null,_parentPage:null,_page:null,_modal:null,_panelInner:null,_wrapper:null,_fixedToolbars:null,_create:function(){var t=this.element,n=t.closest(".ui-page, :jqmData(role='page')");e.extend(this,{_closeLink:t.find(":jqmData(rel='close')"),_parentPage:n.length>0&&n,_openedPage:null,_page:this._getPage,_panelInner:this._getPanelInner(),_fixedToolbars:this._getFixedToolbars}),"overlay"!==this.options.display&&this._getWrapper(),this._addPanelClasses(),e.support.cssTransform3d&&this.options.animate&&this.element.addClass(this.options.classes.animate),this._bindUpdateLayout(),this._bindCloseEvents(),this._bindLinkListeners(),this._bindPageEvents(),this.options.dismissible&&this._createModal(),this._bindSwipeEvents()},_getPanelInner:function(){var e=this.element.find("."+this.options.classes.panelInner);return 0===e.length&&(e=this.element.children().wrapAll("<div class='"+this.options.classes.panelInner+"' />").parent()),e},_createModal:function(){var t=this,n=t._parentPage?t._parentPage.parent():t.element.parent();t._modal=e("<div class='"+t.options.classes.modal+"'></div>").on("mousedown",function(){t.close()}).appendTo(n)},_getPage:function(){return this._openedPage||this._parentPage||e("."+e.mobile.activePageClass)},_getWrapper:function(){var e=this._page().find("."+this.options.classes.pageWrapper);0===e.length&&(e=this._page().children(".ui-header:not(.ui-header-fixed), .ui-content:not(.ui-popup), .ui-footer:not(.ui-footer-fixed)").wrapAll("<div class='"+this.options.classes.pageWrapper+"'></div>").parent()),this._wrapper=e},_getFixedToolbars:function(){var t=e("body").children(".ui-header-fixed, .ui-footer-fixed"),n=this._page().find(".ui-header-fixed, .ui-footer-fixed");return t.add(n).addClass(this.options.classes.pageFixedToolbar)},_getPosDisplayClasses:function(e){return e+"-position-"+this.options.position+" "+e+"-display-"+this.options.display},_getPanelClasses:function(){var e=this.options.classes.panel+" "+this._getPosDisplayClasses(this.options.classes.panel)+" "+this.options.classes.panelClosed+" ui-body-"+(this.options.theme?this.options.theme:"inherit");return this.options.positionFixed&&(e+=" "+this.options.classes.panelFixed),e},_addPanelClasses:function(){this.element.addClass(this._getPanelClasses())},_handleCloseClickAndEatEvent:function(e){return e.isDefaultPrevented()?void 0:(e.preventDefault(),this.close(),!1)},_handleCloseClick:function(e){e.isDefaultPrevented()||this.close()},_bindCloseEvents:function(){this._on(this._closeLink,{click:"_handleCloseClick"}),this._on({"click a:jqmData(ajax='false')":"_handleCloseClick"})},_positionPanel:function(t){var n=this,o=n._panelInner.outerHeight(),i=o>e.mobile.getScreenHeight();i||!n.options.positionFixed?(i&&(n._unfixPanel(),e.mobile.resetActivePageHeight(o)),t&&this.window[0].scrollTo(0,e.mobile.defaultHomeScroll)):n._fixPanel()},_bindFixListener:function(){this._on(e(t),{throttledresize:"_positionPanel"})},_unbindFixListener:function(){this._off(e(t),"throttledresize")},_unfixPanel:function(){this.options.positionFixed&&e.support.fixedPosition&&this.element.removeClass(this.options.classes.panelFixed)},_fixPanel:function(){this.options.positionFixed&&e.support.fixedPosition&&this.element.addClass(this.options.classes.panelFixed)},_bindUpdateLayout:function(){var e=this;e.element.on("updatelayout",function(){e._open&&e._positionPanel()})},_bindLinkListeners:function(){this._on("body",{"click a":"_handleClick"})},_handleClick:function(t){var n,o=this.element.attr("id");return t.currentTarget.href.split("#")[1]===o&&void 0!==o?(t.preventDefault(),n=e(t.target),n.hasClass("ui-btn")&&(n.addClass(e.mobile.activeBtnClass),this.element.one("panelopen panelclose",function(){n.removeClass(e.mobile.activeBtnClass)})),this.toggle(),!1):void 0},_bindSwipeEvents:function(){var e=this,t=e._modal?e.element.add(e._modal):e.element;e.options.swipeClose&&("left"===e.options.position?t.on("swipeleft.panel",function(){e.close()}):t.on("swiperight.panel",function(){e.close()}))},_bindPageEvents:function(){var e=this;this.document.on("panelbeforeopen",function(t){e._open&&t.target!==e.element[0]&&e.close()}).on("keyup.panel",function(t){27===t.keyCode&&e._open&&e.close()}),this._parentPage||"overlay"===this.options.display||this._on(this.document,{pageshow:"_getWrapper"}),e._parentPage?this.document.on("pagehide",":jqmData(role='page')",function(){e._open&&e.close(!0)}):this.document.on("pagebeforehide",function(){e._open&&e.close(!0)})},_open:!1,_pageContentOpenClasses:null,_modalOpenClasses:null,open:function(t){if(!this._open){var n=this,o=n.options,i=function(){n.document.off("panelclose"),n._page().jqmData("panel","open"),e.support.cssTransform3d&&o.animate&&"overlay"!==o.display&&(n._wrapper.addClass(o.classes.animate),n._fixedToolbars().addClass(o.classes.animate)),!t&&e.support.cssTransform3d&&o.animate?n.element.animationComplete(a,"transition"):setTimeout(a,0),o.theme&&"overlay"!==o.display&&n._page().parent().addClass(o.classes.pageContainer+"-themed "+o.classes.pageContainer+"-"+o.theme),n.element.removeClass(o.classes.panelClosed).addClass(o.classes.panelOpen),n._positionPanel(!0),n._pageContentOpenClasses=n._getPosDisplayClasses(o.classes.pageContentPrefix),"overlay"!==o.display&&(n._page().parent().addClass(o.classes.pageContainer),n._wrapper.addClass(n._pageContentOpenClasses),n._fixedToolbars().addClass(n._pageContentOpenClasses)),n._modalOpenClasses=n._getPosDisplayClasses(o.classes.modal)+" "+o.classes.modalOpen,n._modal&&n._modal.addClass(n._modalOpenClasses).height(Math.max(n._modal.height(),n.document.height()))},a=function(){"overlay"!==o.display&&(n._wrapper.addClass(o.classes.pageContentPrefix+"-open"),n._fixedToolbars().addClass(o.classes.pageContentPrefix+"-open")),n._bindFixListener(),n._trigger("open"),n._openedPage=n._page()};n._trigger("beforeopen"),"open"===n._page().jqmData("panel")?n.document.on("panelclose",function(){i()}):i(),n._open=!0}},close:function(t){if(this._open){var n=this,o=this.options,i=function(){o.theme&&"overlay"!==o.display&&n._page().parent().removeClass(o.classes.pageContainer+"-themed "+o.classes.pageContainer+"-"+o.theme),n.element.addClass(o.classes.panelClosed),"overlay"!==o.display&&(n._page().parent().removeClass(o.classes.pageContainer),n._wrapper.removeClass(o.classes.pageContentPrefix+"-open"),n._fixedToolbars().removeClass(o.classes.pageContentPrefix+"-open")),e.support.cssTransform3d&&o.animate&&"overlay"!==o.display&&(n._wrapper.removeClass(o.classes.animate),n._fixedToolbars().removeClass(o.classes.animate)),n._fixPanel(),n._unbindFixListener(),e.mobile.resetActivePageHeight(),n._page().jqmRemoveData("panel"),n._trigger("close"),n._openedPage=null};n._trigger("beforeclose"),function(){n.element.removeClass(o.classes.panelOpen),"overlay"!==o.display&&(n._wrapper.removeClass(n._pageContentOpenClasses),n._fixedToolbars().removeClass(n._pageContentOpenClasses)),!t&&e.support.cssTransform3d&&o.animate?n.element.animationComplete(i,"transition"):setTimeout(i,0),n._modal&&n._modal.removeClass(n._modalOpenClasses)}(),n._open=!1}},toggle:function(){this[this._open?"close":"open"]()},_destroy:function(){var t,n=this.options,o=e("body > :mobile-panel").length+e.mobile.activePage.find(":mobile-panel").length>1;"overlay"!==n.display&&(t=e("body > :mobile-panel").add(e.mobile.activePage.find(":mobile-panel")),0===t.not(".ui-panel-display-overlay").not(this.element).length&&this._wrapper.children().unwrap(),this._open&&(this._fixedToolbars().removeClass(n.classes.pageContentPrefix+"-open"),e.support.cssTransform3d&&n.animate&&this._fixedToolbars().removeClass(n.classes.animate),this._page().parent().removeClass(n.classes.pageContainer),n.theme&&this._page().parent().removeClass(n.classes.pageContainer+"-themed "+n.classes.pageContainer+"-"+n.theme))),o||this.document.off("panelopen panelclose"),this._open&&this._page().jqmRemoveData("panel"),this._panelInner.children().unwrap(),this.element.removeClass([this._getPanelClasses(),n.classes.panelOpen,n.classes.animate].join(" ")).off("swipeleft.panel swiperight.panel").off("panelbeforeopen").off("panelhide").off("keyup.panel").off("updatelayout"),this._modal&&this._modal.remove()}})}(e),function(e,t){e.widget("mobile.table",{options:{classes:{table:"ui-table"},enhanced:!1},_create:function(){this.options.enhanced||this.element.addClass(this.options.classes.table),e.extend(this,{headers:t,allHeaders:t}),this._refresh(!0)},_setHeaders:function(){var e=this.element.find("thead tr");this.headers=this.element.find("tr:eq(0)").children(),this.allHeaders=this.headers.add(e.children())},refresh:function(){this._refresh()},rebuild:e.noop,_refresh:function(){var t=this.element,n=t.find("thead tr");this._setHeaders(),n.each(function(){var o=0;e(this).children().each(function(){var i,a=parseInt(this.getAttribute("colspan"),10),r=":nth-child("+(o+1)+")";if(this.setAttribute("data-"+e.mobile.ns+"colstart",o+1),a)for(i=0;a-1>i;i++)o++,r+=", :nth-child("+(o+1)+")";e(this).jqmData("cells",t.find("tr").not(n.eq(0)).not(this).children(r)),o++})})}})}(e),function(e){e.widget("mobile.table",e.mobile.table,{options:{mode:"columntoggle",columnBtnTheme:null,columnPopupTheme:null,columnBtnText:"Columns...",classes:e.extend(e.mobile.table.prototype.options.classes,{popup:"ui-table-columntoggle-popup",columnBtn:"ui-table-columntoggle-btn",priorityPrefix:"ui-table-priority-",columnToggleTable:"ui-table-columntoggle"})},_create:function(){this._super(),"columntoggle"===this.options.mode&&(e.extend(this,{_menu:null}),this.options.enhanced?(this._menu=e(this.document[0].getElementById(this._id()+"-popup")).children().first(),this._addToggles(this._menu,!0)):(this._menu=this._enhanceColToggle(),this.element.addClass(this.options.classes.columnToggleTable)),this._setupEvents(),this._setToggleState())},_id:function(){return this.element.attr("id")||this.widgetName+this.uuid},_setupEvents:function(){this._on(this.window,{throttledresize:"_setToggleState"}),this._on(this._menu,{"change input":"_menuInputChange"})},_addToggles:function(t,n){var o,i=0,a=this.options,r=t.controlgroup("container");n?o=t.find("input"):r.empty(),this.headers.not("td").each(function(){var t=e(this),s=e.mobile.getAttribute(this,"priority"),l=t.add(t.jqmData("cells"));s&&(l.addClass(a.classes.priorityPrefix+s),(n?o.eq(i++):e("<label><input type='checkbox' checked />"+(t.children("abbr").first().attr("title")||t.text())+"</label>").appendTo(r).children(0).checkboxradio({theme:a.columnPopupTheme})).jqmData("cells",l))}),n||t.controlgroup("refresh")},_menuInputChange:function(t){var n=e(t.target),o=n[0].checked;n.jqmData("cells").toggleClass("ui-table-cell-hidden",!o).toggleClass("ui-table-cell-visible",o),n[0].getAttribute("locked")?(n.removeAttr("locked"),this._unlockCells(n.jqmData("cells"))):n.attr("locked",!0)},_unlockCells:function(e){e.removeClass("ui-table-cell-hidden ui-table-cell-visible")},_enhanceColToggle:function(){var t,n,o,i,a=this.element,r=this.options,s=e.mobile.ns,l=this.document[0].createDocumentFragment();return t=this._id()+"-popup",n=e("<a href='#"+t+"' class='"+r.classes.columnBtn+" ui-btn ui-btn-"+(r.columnBtnTheme||"a")+" ui-corner-all ui-shadow ui-mini' data-"+s+"rel='popup'>"+r.columnBtnText+"</a>"),
o=e("<div class='"+r.classes.popup+"' id='"+t+"'></div>"),i=e("<fieldset></fieldset>").controlgroup(),this._addToggles(i,!1),i.appendTo(o),l.appendChild(o[0]),l.appendChild(n[0]),a.before(l),o.popup(),i},rebuild:function(){this._super(),"columntoggle"===this.options.mode&&this._refresh(!1)},_refresh:function(e){this._super(e),e||"columntoggle"!==this.options.mode||(this._unlockCells(this.element.find(".ui-table-cell-hidden, .ui-table-cell-visible")),this._addToggles(this._menu,e),this._setToggleState())},_setToggleState:function(){this._menu.find("input").each(function(){var t=e(this);this.checked="table-cell"===t.jqmData("cells").eq(0).css("display"),t.checkboxradio("refresh")})},_destroy:function(){this._super()}})}(e),function(e){e.widget("mobile.table",e.mobile.table,{options:{mode:"reflow",classes:e.extend(e.mobile.table.prototype.options.classes,{reflowTable:"ui-table-reflow",cellLabels:"ui-table-cell-label"})},_create:function(){this._super(),"reflow"===this.options.mode&&(this.options.enhanced||(this.element.addClass(this.options.classes.reflowTable),this._updateReflow()))},rebuild:function(){this._super(),"reflow"===this.options.mode&&this._refresh(!1)},_refresh:function(e){this._super(e),e||"reflow"!==this.options.mode||this._updateReflow()},_updateReflow:function(){var t=this,n=this.options;e(t.allHeaders.get().reverse()).each(function(){var o,i,a=e(this).jqmData("cells"),r=e.mobile.getAttribute(this,"colstart"),s=a.not(this).filter("thead th").length&&" ui-table-cell-label-top",l=e(this).text();""!==l&&(s?(o=parseInt(this.getAttribute("colspan"),10),i="",o&&(i="td:nth-child("+o+"n + "+r+")"),t._addLabels(a.filter(i),n.classes.cellLabels+s,l)):t._addLabels(a,n.classes.cellLabels,l))})},_addLabels:function(e,t,n){e.not(":has(b."+t+")").prepend("<b class='"+t+"'>"+n+"</b>")}})}(e),function(e,n){var o=function(t,n){return-1===(""+(e.mobile.getAttribute(this,"filtertext")||e(this).text())).toLowerCase().indexOf(n)};e.widget("mobile.filterable",{initSelector:":jqmData(filter='true')",options:{filterReveal:!1,filterCallback:o,enhanced:!1,input:null,children:"> li, > option, > optgroup option, > tbody tr, > .ui-controlgroup-controls > .ui-btn, > .ui-controlgroup-controls > .ui-checkbox, > .ui-controlgroup-controls > .ui-radio"},_create:function(){var t=this.options;e.extend(this,{_search:null,_timer:0}),this._setInput(t.input),t.enhanced||this._filterItems((this._search&&this._search.val()||"").toLowerCase())},_onKeyUp:function(){var n,o,i=this._search;if(i){if(n=i.val().toLowerCase(),(o=e.mobile.getAttribute(i[0],"lastval")+"")&&o===n)return;this._timer&&(t.clearTimeout(this._timer),this._timer=0),this._timer=this._delay(function(){this._trigger("beforefilter",null,{input:i}),i[0].setAttribute("data-"+e.mobile.ns+"lastval",n),this._filterItems(n),this._timer=0},250)}},_getFilterableItems:function(){var t=this.element,n=this.options.children,o=n?e.isFunction(n)?n():n.nodeName?e(n):n.jquery?n:this.element.find(n):{length:0};return 0===o.length&&(o=t.children()),o},_filterItems:function(t){var n,i,a,r,s=[],l=[],p=this.options,c=this._getFilterableItems();if(null!=t)for(i=p.filterCallback||o,a=c.length,n=0;a>n;n++)r=i.call(c[n],n,t)?l:s,r.push(c[n]);0===l.length?c[p.filterReveal?"addClass":"removeClass"]("ui-screen-hidden"):(e(l).addClass("ui-screen-hidden"),e(s).removeClass("ui-screen-hidden")),this._refreshChildWidget(),this._trigger("filter",null,{items:c})},_refreshChildWidget:function(){var t,n,o=["collapsibleset","selectmenu","controlgroup","listview"];for(n=o.length-1;n>-1;n--)t=o[n],e.mobile[t]&&(t=this.element.data("mobile-"+t))&&e.isFunction(t.refresh)&&t.refresh()},_setInput:function(n){var o=this._search;this._timer&&(t.clearTimeout(this._timer),this._timer=0),o&&(this._off(o,"keyup change input"),o=null),n&&(o=n.jquery?n:n.nodeName?e(n):this.document.find(n),this._on(o,{keyup:"_onKeyUp",change:"_onKeyUp",input:"_onKeyUp"})),this._search=o},_setOptions:function(e){var t=!(e.filterReveal===n&&e.filterCallback===n&&e.children===n);this._super(e),e.input!==n&&(this._setInput(e.input),t=!0),t&&this.refresh()},_destroy:function(){var e=this.options,t=this._getFilterableItems();e.enhanced?t.toggleClass("ui-screen-hidden",e.filterReveal):t.removeClass("ui-screen-hidden")},refresh:function(){this._timer&&(t.clearTimeout(this._timer),this._timer=0),this._filterItems((this._search&&this._search.val()||"").toLowerCase())}})}(e),function(e,t){var n=function(e,t){return function(n){t.call(this,n),e._syncTextInputOptions(n)}},o=e.mobile.filterable.prototype.options.filterCallback;e.mobile.filterable.prototype.options.filterCallback=function(e,t){return!this.className.match(/(^|\s)ui-li-divider(\s|$)/)&&o.call(this,e,t)},e.widget("mobile.filterable",e.mobile.filterable,{options:{filterPlaceholder:"Filter items...",filterTheme:null},_create:function(){var t,n,o=this.element,i=["collapsibleset","selectmenu","controlgroup","listview"],a={};for(this._super(),e.extend(this,{_widget:null}),t=i.length-1;t>-1;t--)if(n=i[t],e.mobile[n]){if(this._setWidget(o.data("mobile-"+n)))break;a[n+"create"]="_handleCreate"}this._widget||this._on(o,a)},_handleCreate:function(e){this._setWidget(this.element.data("mobile-"+e.type.substring(0,e.type.length-6)))},_trigger:function(e,t,n){this._widget&&"mobile-listview"===this._widget.widgetFullName&&"beforefilter"===e&&this._widget._trigger("beforefilter",t,n),this._super(e,t,n)},_setWidget:function(e){return!this._widget&&e&&(this._widget=e,this._widget._setOptions=n(this,this._widget._setOptions)),this._widget&&(this._syncTextInputOptions(this._widget.options),"listview"===this._widget.widgetName&&(this._widget.options.hideDividers=!0,this._widget.element.listview("refresh"))),!!this._widget},_isSearchInternal:function(){return this._search&&this._search.jqmData("ui-filterable-"+this.uuid+"-internal")},_setInput:function(t){var n=this.options,o=!0,i={};if(!t){if(this._isSearchInternal())return;o=!1,t=e("<input data-"+e.mobile.ns+"type='search' placeholder='"+n.filterPlaceholder+"'></input>").jqmData("ui-filterable-"+this.uuid+"-internal",!0),e("<form class='ui-filterable'></form>").append(t).submit(function(e){e.preventDefault(),t.blur()}).insertBefore(this.element),e.mobile.textinput&&(null!=this.options.filterTheme&&(i.theme=n.filterTheme),t.textinput(i))}this._super(t),this._isSearchInternal()&&o&&this._search.attr("placeholder",this.options.filterPlaceholder)},_setOptions:function(n){var o=this._super(n);return n.filterPlaceholder!==t&&this._isSearchInternal()&&this._search.attr("placeholder",n.filterPlaceholder),n.filterTheme!==t&&this._search&&e.mobile.textinput&&this._search.textinput("option","theme",n.filterTheme),o},_destroy:function(){this._isSearchInternal()&&this._search.remove(),this._super()},_syncTextInputOptions:function(n){var o,i={};if(this._isSearchInternal()&&e.mobile.textinput){for(o in e.mobile.textinput.prototype.options)n[o]!==t&&(i[o]="theme"===o&&null!=this.options.filterTheme?this.options.filterTheme:n[o]);this._search.textinput("option",i)}}})}(e),function(e,t){function n(){return++i}function o(e){return e.hash.length>1&&decodeURIComponent(e.href.replace(a,""))===decodeURIComponent(location.href.replace(a,""))}var i=0,a=/#.*$/;e.widget("ui.tabs",{version:"fadf2b312a05040436451c64bbfaf4814bc62c56",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,n=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",n.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),n.active=this._initialActive(),e.isArray(n.disabled)&&(n.disabled=e.unique(n.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(n.active):e(),this._refresh(),this.active.length&&this.load(n.active)},_initialActive:function(){var t=this.options.active,n=this.options.collapsible,o=location.hash.substring(1);return null===t&&(o&&this.tabs.each(function(n,i){return e(i).attr("aria-controls")===o?(t=n,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!n&&0),!n&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var n=e(this.document[0].activeElement).closest("li"),o=this.tabs.index(n),i=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:o++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:i=!1,o--;break;case e.ui.keyCode.END:o=this.anchors.length-1;break;case e.ui.keyCode.HOME:o=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(o);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(o!==this.options.active&&o);default:return}t.preventDefault(),clearTimeout(this.activating),o=this._focusNextTab(o,i),t.ctrlKey||(n.attr("aria-selected","false"),this.tabs.eq(o).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",o)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,n){for(var o=this.tabs.length-1;-1!==e.inArray(function(){return t>o&&(t=0),0>t&&(t=o),t}(),this.options.disabled);)t=n?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?void this._activate(t):"disabled"===e?void this._setupDisabled(t):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),void("heightStyle"===e&&this._setupHeightStyle(t)))},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+n()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,n=this.tablist.children(":has(a[href])");t.disabled=e.map(n.filter(".ui-state-disabled"),function(e){return n.index(e)}),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(n,i){var a,r,s,l=e(i).uniqueId().attr("id"),p=e(i).closest("li"),c=p.attr("aria-controls");o(i)?(a=i.hash,r=t.element.find(t._sanitizeSelector(a))):(s=t._tabId(p),a="#"+s,r=t.element.find(a),r.length||(r=t._createPanel(s),r.insertAfter(t.panels[n-1]||t.tablist)),r.attr("aria-live","polite")),r.length&&(t.panels=t.panels.add(r)),c&&p.data("ui-tabs-aria-controls",c),p.attr({"aria-controls":a.substring(1),"aria-labelledby":l}),r.attr("aria-labelledby",l)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var n,o=0;n=this.tabs[o];o++)!0===t||-1!==e.inArray(o,t)?e(n).addClass("ui-state-disabled").attr("aria-disabled","true"):e(n).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var n={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,n),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var n,o=this.element.parent();"fill"===t?(n=o.height(),n-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),o=t.css("position");"absolute"!==o&&"fixed"!==o&&(n-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){n-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(n=0,this.panels.each(function(){n=Math.max(n,e(this).height("").height())}).height(n))},_eventHandler:function(t){var n=this.options,o=this.active,i=e(t.currentTarget),a=i.closest("li"),r=a[0]===o[0],s=r&&n.collapsible,l=s?e():this._getPanelForTab(a),p=o.length?this._getPanelForTab(o):e(),c={oldTab:o,oldPanel:p,newTab:s?e():a,newPanel:l};t.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||r&&!n.collapsible||!1===this._trigger("beforeActivate",t,c)||(n.active=!s&&this.tabs.index(a),this.active=r?e():a,this.xhr&&this.xhr.abort(),p.length||l.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(a),t),this._toggle(t,c))},_toggle:function(t,n){function o(){a.running=!1,a._trigger("activate",t,n)}function i(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),r.length&&a.options.show?a._show(r,a.options.show,o):(r.show(),o())}var a=this,r=n.newPanel,s=n.oldPanel;this.running=!0,s.length&&this.options.hide?this._hide(s,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),i()}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s.hide(),i()),s.attr({"aria-expanded":"false","aria-hidden":"true"}),n.oldTab.attr("aria-selected","false"),r.length&&s.length?n.oldTab.attr("tabIndex",-1):r.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),r.attr({"aria-expanded":"true","aria-hidden":"false"}),n.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var n,o=this._findActive(t);o[0]!==this.active[0]&&(o.length||(o=this.active),n=o.find(".ui-tabs-anchor")[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),n=t.data("ui-tabs-aria-controls");n?t.attr("aria-controls",n).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(n){var o=this.options.disabled;!1!==o&&(n===t?o=!1:(n=this._getIndex(n),o=e.isArray(o)?e.map(o,function(e){return e!==n?e:null}):e.map(this.tabs,function(e,t){return t!==n?t:null})),this._setupDisabled(o))},disable:function(n){var o=this.options.disabled;if(!0!==o){if(n===t)o=!0;else{if(n=this._getIndex(n),-1!==e.inArray(n,o))return;o=e.isArray(o)?e.merge([n],o).sort():[n]}this._setupDisabled(o)}},load:function(t,n){t=this._getIndex(t);var i=this,a=this.tabs.eq(t),r=a.find(".ui-tabs-anchor"),s=this._getPanelForTab(a),l={tab:a,panel:s};o(r[0])||(this.xhr=e.ajax(this._ajaxSettings(r,n,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(a.addClass("ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){s.html(e),i._trigger("load",n,l)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&i.panels.stop(!1,!0),a.removeClass("ui-tabs-loading"),s.removeAttr("aria-busy"),e===i.xhr&&delete i.xhr},1)})))},_ajaxSettings:function(t,n,o){var i=this;return{url:t.attr("href"),beforeSend:function(t,a){return i._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:a},o))}}},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}})}(e),function(e,t){function n(e){i=e.originalEvent,l=i.accelerationIncludingGravity,a=Math.abs(l.x),r=Math.abs(l.y),s=Math.abs(l.z),!t.orientation&&(a>7||(s>6&&8>r||8>s&&r>6)&&a>5)?o.enabled&&o.disable():o.enabled||o.enable()}e.mobile.iosorientationfixEnabled=!0;var o,i,a,r,s,l,p=navigator.userAgent;/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(p)&&p.indexOf("AppleWebKit")>-1?(o=e.mobile.zoom,e.mobile.document.on("mobileinit",function(){e.mobile.iosorientationfixEnabled&&e.mobile.window.bind("orientationchange.iosorientationfix",o.enable).bind("devicemotion.iosorientationfix",n)})):e.mobile.iosorientationfixEnabled=!1}(e,this),function(e,t){function o(){i.removeClass("ui-mobile-rendering")}var i=e("html"),a=e.mobile.window;e(t.document).trigger("mobileinit"),e.mobile.gradeA()&&(e.mobile.ajaxBlacklist&&(e.mobile.ajaxEnabled=!1),i.addClass("ui-mobile ui-mobile-rendering"),setTimeout(o,5e3),e.extend(e.mobile,{initializePage:function(){var t=e.mobile.path,i=e(":jqmData(role='page'), :jqmData(role='dialog')"),r=t.stripHash(t.stripQueryParams(t.parseLocation().hash));r&&r.length>0&&(h=n.getElementById(r)),i.length||(i=e("body").wrapInner("<div data-"+e.mobile.ns+"role='page'></div>").children(0)),i.each(function(){var t=e(this);t[0].getAttribute("data-"+e.mobile.ns+"url")||t.attr("data-"+e.mobile.ns+"url",t.attr("id")||location.pathname+location.search)}),e.mobile.firstPage=i.first(),e.mobile.pageContainer=e.mobile.firstPage.parent().addClass("ui-mobile-viewport").pagecontainer(),e.mobile.navreadyDeferred.resolve(),a.trigger("pagecontainercreate"),e.mobile.loading("show"),o(),e.mobile.hashListeningEnabled&&e.mobile.path.isHashValid(location.hash)&&(e(h).is(":jqmData(role='page')")||e.mobile.path.isPath(r)||r===e.mobile.dialogHashKey)?e.event.special.navigate.isPushStateEnabled()?(e.mobile.navigate.history.stack=[],e.mobile.navigate(e.mobile.path.isPath(location.hash)?location.hash:location.href)):a.trigger("hashchange",[!0]):(e.mobile.path.isHashValid(location.hash)&&(e.mobile.navigate.history.initialDst=r.replace("#","")),e.event.special.navigate.isPushStateEnabled()&&e.mobile.navigate.navigator.squash(t.parseLocation().href),e.mobile.changePage(e.mobile.firstPage,{transition:"none",reverse:!0,changeHash:!1,fromHashChange:!0}))}}),e(function(){e.support.inlineSVG(),e.mobile.hideUrlBar&&t.scrollTo(0,1),e.mobile.defaultHomeScroll=e.support.scrollTop&&1!==e.mobile.window.scrollTop()?1:0,e.mobile.autoInitializePage&&e.mobile.initializePage(),e.mobile.hideUrlBar&&a.load(e.mobile.silentScroll),e.support.cssPointerEvents||e.mobile.document.delegate(".ui-state-disabled,.ui-disabled","vclick",function(e){e.preventDefault(),e.stopImmediatePropagation()})}))}(e,this)}),webphone_api.webrtcapi=function(){function PutToDebugLogException(e,t,n){webphone_api&&webphone_api.common&&webphone_api.common.PutToDebugLogException&&"function"==typeof webphone_api.common.PutToDebugLogException?webphone_api.common.CanLog(e)&&webphone_api.common.PutToDebugLogException(e,t,n):console.error(t)}function PutToDebugLog(e,t,n){webphone_api&&webphone_api.common&&webphone_api.common.PutToDebugLog&&"function"==typeof webphone_api.common.PutToDebugLog?webphone_api.common.CanLog(e)&&webphone_api.common.PutToDebugLog(e,t,n):console.log(t)}function JsObjecSniffer(e,t,n){if(void 0===e)return void console.log("josniffer obj is undefine");if(null===e)return void console.log("josniffer obj is NULL");console.log("=========== JsObjecSniffer ============="),void 0!==t&&null!==t||(t=0),-1===t&&(t=100);var o=e;for(var i in o){0===n?"function"!=typeof o[i]&&console.log("[josniffer] "+i+": "+o[i]):1===n?"function"==typeof o[i]&&console.log("[josniffer] "+i+": "+o[i]):console.log("[josniffer] "+i+": "+o[i]);var a="",r="",s="",l="",p="",c="",u="",h="",g="",m="",d="",b="",_="",f="",w="",v=null,P=null,E=null,T=null,N=null,S=null,I=null,C=null,R=null,G=null,y=null,L=null,O=null,D=null,x=null;if(null!==o&&"undefined"!=typeof o[i]&&null!==o[i]&&(v=o[i],t>0&&null!==v&&"object"==typeof v))for(var a in v)if(0===n?"function"!=typeof v[a]&&console.log("[josniffer] "+i+" - "+a+": "+v[a]):1===n?"function"==typeof v[a]&&console.log("[josniffer] "+i+" - "+a+": "+v[a]):console.log("[josniffer] "+i+" - "+a+": "+v[a]),null!==v&&"undefined"!=typeof v[a]&&null!==v[a]&&(P=v[a],t>1&&null!==P&&"object"==typeof P))for(var r in P)if(0===n?"function"!=typeof P[r]&&console.log("[josniffer] "+i+" - "+a+" - "+r+": "+P[r]):1===n?"function"==typeof P[r]&&console.log("[josniffer] "+i+" - "+a+" - "+r+": "+P[r]):console.log("[josniffer] "+i+" - "+a+" - "+r+": "+P[r]),null!==P&&"undefined"!=typeof P[r]&&null!==P[r]&&(E=P[r],t>2&&null!==E&&"object"==typeof E))for(var s in E)if(0===n?"function"!=typeof E[s]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+": "+E[s]):1===n?"function"==typeof E[s]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+": "+E[s]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+": "+E[s]),null!==E&&"undefined"!=typeof E[s]&&null!==E[s]&&(T=E[s],t>3&&null!==T&&"object"==typeof T))for(var l in T)if(0===n?"function"!=typeof T[l]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+": "+T[l]):1===n?"function"==typeof T[l]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+": "+T[l]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+": "+T[l]),null!==T&&"undefined"!=typeof T[l]&&null!==T[l]&&(N=T[l],t>4&&null!==N&&"object"==typeof N))for(var p in N)if(0===n?"function"!=typeof N[p]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+": "+N[p]):1===n?"function"==typeof N[p]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+": "+N[p]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+": "+N[p]),null!==N&&"undefined"!=typeof N[p]&&null!==N[p]&&(S=N[p],t>5&&null!==S&&"object"==typeof S))for(var c in S)if(0===n?"function"!=typeof S[c]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+": "+S[c]):1===n?"function"==typeof S[c]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+": "+S[c]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+": "+S[c]),null!==S&&"undefined"!=typeof S[c]&&null!==S[c]&&(I=S[c],t>6&&null!==I&&"object"==typeof I))for(var u in I)if(0===n?"function"!=typeof I[u]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+": "+I[u]):1===n?"function"==typeof I[u]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+": "+I[u]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+": "+I[u]),null!==I&&"undefined"!=typeof I[u]&&null!==I[u]&&(C=I[u],t>7&&null!==C&&"object"==typeof C))for(var h in C)if(0===n?"function"!=typeof C[h]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+": "+C[h]):1===n?"function"==typeof C[h]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+": "+C[h]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+": "+C[h]),null!==C&&"undefined"!=typeof C[h]&&null!==C[h]&&(R=C[h],t>8&&null!==R&&"object"==typeof R))for(var g in R)if(0===n?"function"!=typeof R[g]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+": "+R[g]):1===n?"function"==typeof R[g]&&console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+": "+R[g]):console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+": "+R[g]),null!==R&&"undefined"!=typeof R[g]&&null!==R[g]&&(G=R[g],t>9&&null!==G&&"object"==typeof G))for(var m in G)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+" - "+m+": "+G[m]),null!==G&&"undefined"!=typeof G[m]&&null!==G[m]&&(y=G[m],t>10&&null!==y&&"object"==typeof y))for(var d in y)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+" - "+m+" - "+d+": "+y[d]),null!==y&&"undefined"!=typeof y[d]&&null!==y[d]&&(L=y[d],t>11&&null!==L&&"object"==typeof L))for(var b in L)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+" - "+m+" - "+d+" - "+b+": "+L[b]),null!==L&&"undefined"!=typeof L[b]&&null!==L[b]&&(O=L[b],t>12&&null!==O&&"object"==typeof O))for(var _ in O)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+a+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+" - "+m+" - "+d+" - "+b+" - "+_+": "+O[_]),null!==O&&"undefined"!=typeof O[_]&&null!==O[_]&&(D=O[_],t>13&&null!==D&&"object"==typeof D))for(var f in D)if(console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+" - "+m+" - "+d+" - "+b+" - "+_+" - "+f+": "+D[f]),null!==D&&"undefined"!=typeof D[f]&&null!==D[f]&&(x=D[f],t>14&&null!==x&&"object"==typeof x))for(var w in x)console.log("[josniffer] "+i+" - "+a+" - "+r+" - "+s+" - "+l+" - "+p+" - "+c+" - "+u+" - "+h+" - "+g+" - "+m+" - "+d+" - "+b+" - "+_+" - "+f+" - "+w+": "+x[w])}console.log("=========== End JsObjecSniffer =============")}function WebRtcIsSupported(e){try{var t=document.getElementById("dtmfTone"),n=document.getElementById("justbeep_1");webphone_api.common.isNull(t)&&webphone_api.$(document.body).append('<audio id="dtmfTone" src="'+webphone_api.getbasedir2()+'sound/rtc_dtmf.wav" ></audio>'),webphone_api.common.isNull(n)&&webphone_api.$(document.body).append('<audio id="justbeep_1" src="'+webphone_api.getbasedir2()+'sound/beep-01.wav" ></audio>');var o=!1;window.WebSocket&&(o=!0);var i=!1;(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&(i=!0);var a=!1;return window.RTCPeerConnection&&(a=!0),!0===o&&!0===i&&!0===a&&(navigator.mediaDevices===undefined&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===undefined&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(n,o){t.call(navigator,e,n,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})),!0===o&&!0===i&&!0===a?("function"==typeof e&&e(!0),!0):(PutToDebugLog(2,"EVENT, WebRtcIsSupported: WebRTC not supported: wssuport: "+o+"; gumSupport: "+i+"; peerconSupport: "+a),"function"==typeof e&&e(!1),!1)}catch(r){PutToDebugLogException(2,"webrtcapi: WebRtcIsSupported",r);try{"function"==typeof e&&e(!1)}catch(r){}}return!1}function LoadScript(e,t,n){try{if(!t||"function"!=typeof t)return void PutToDebugLog(2,"ERROR, webrtcapi: LoadScript success callback NOT set");if(!n||"function"!=typeof n)return void PutToDebugLog(2,"ERROR, webrtcapi: LoadScript error callback NOT set");"undefined"!=typeof webphone_api.jscodeversion&&null!==webphone_api.jscodeversion&&webphone_api.jscodeversion.length>0&&e.indexOf("jscodeversion=")<0&&(e=e.indexOf("?")>0?e+"&jscodeversion="+webphone_api.jscodeversion.toString():e+"?jscodeversion="+webphone_api.jscodeversion.toString()),webphone_api.$.ajax({url:e,dataType:"script",method:"GET",timeout:45e3,success:t,error:n,async:!0})}catch(o){PutToDebugLogException(2,"webrtcapi: LoadScript",o)}}function LoadWebrtc(e,t,n){try{if(initcallback=e,!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, webrtcapi: CheckIfSupported callback is NULL");if(wen_namespace=t,void 0!==n&&null!==n&&acc_arr.push(n),void 0!==t&&null!==t||"undefined"==typeof webphone_api.webrtcstack||null===webphone_api.webrtcstack||"undefined"==typeof webphone_api.webrtcstack.SIPml||null===webphone_api.webrtcstack.SIPml){var o=webphone_api.getbasedir2()+"js/lib/wen.js";void 0!==t&&null!==t&&t.length>1&&("undefined"!=typeof webphone_api.wen_namespace_arr&&null!=webphone_api.wen_namespace_arr||(webphone_api.wen_namespace_arr=[]),webphone_api.wen_namespace_arr.push(t)),0==o.indexOf("file")?(PutToDebugLog(2,"EVENT, Loading WebRTC engine by file script insert: "+o),webphone_api.LoadScriptFile(o,function(){var e=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(e=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(initcallback,wen_namespace,e)},function(){PutToDebugLog(2,"WARNING, LoadWebrtc: failed to load by file script. retry with ajax: "+o),LoadScript(o,function(){var e=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(e=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(initcallback,wen_namespace,e)},function(e,t,n){webphone_api.common.isNull(t)&&(t="");var o="";void 0!==n&&null!==n&&("undefined"!=typeof n.message&&null!==n.message&&n.message.length>0&&(o=o+" ("+n.message+") "),"undefined"!=typeof n.fileName&&null!==n.fileName&&n.fileName.length>0&&(o=o+" class: "+n.fileName),"undefined"!=typeof n.lineNumber&&null!==n.lineNumber&&n.fileName.lineNumber>0&&(o=o+": "+n.lineNumber)),PutToDebugLog(2,"WARNING, LoadWebrtc: failed to load script; status: "+t+"; trace: "+o+"; exception: "+n)})})):(PutToDebugLog(2,"EVENT, Loading WebRTC engine script by ajax: "+o),LoadScript(o,function(){var e=null
;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(e=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(initcallback,wen_namespace,e)},function(e,t,n){webphone_api.common.isNull(t)&&(t="");var i="";void 0!==n&&null!==n&&("undefined"!=typeof n.message&&null!==n.message&&n.message.length>0&&(i=i+" ("+n.message+") "),"undefined"!=typeof n.fileName&&null!==n.fileName&&n.fileName.length>0&&(i=i+" class: "+n.fileName),"undefined"!=typeof n.lineNumber&&null!==n.lineNumber&&n.fileName.lineNumber>0&&(i=i+": "+n.lineNumber)),PutToDebugLog(2,"WARNING, LoadWebrtc: failed to load script; status: "+t+"; trace: "+i+"; exception: "+n),PutToDebugLog(2,"EVENT, retry Loading WebRTC engine by file script insert: "+o),webphone_api.LoadScriptFile(o,function(){var e=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(e=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(initcallback,wen_namespace,e)})}))}else{var i=null;!webphone_api.common.isNull(acc_arr)&&acc_arr.length>0&&!webphone_api.common.isNull(acc_arr[0])&&(i=acc_arr.shift()),(webphone_api.common.isNull(acc_arr)||webphone_api.common.isNull(acc_arr).length<1)&&(acc_arr=[]),LoadWebrtcInner(e,wen_namespace,i)}}catch(a){PutToDebugLogException(2,"webrtcapi: LoadWebrtc",a),e(!1)}}function LoadWebrtcInner(e,t,n){try{void 0!==t&&null!==t||(t="webrtcstack"),"webrtcstack"===t&&(webphone_api.$(document.body).append('<audio id="audio_remote" autoplay="autoplay" ></audio>'),webphone_api.$(document.body).append('<audio id="ringtone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringtone.wav" onloadeddata="webphone_api.rt_loaded = true;" oncanplaythrough="webphone_api.rt_canplay = true;" ></audio>'),webphone_api.$(document.body).append('<audio id="ringbacktone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringbacktone.wav" onloadeddata="webphone_api.rbt_loaded = true;" oncanplaythrough="webphone_api.rbt_canplay = true;" ></audio>'),webphone_api.$(document.body).append('<audio id="dtmfTone" src="'+webphone_api.getbasedir2()+'sound/rtc_dtmf.wav" ></audio>'),webphone_api.$(document.body).append('<audio id="justbeep_1" src="'+webphone_api.getbasedir2()+'sound/beep-01.wav" ></audio>'),PutToDebugLog(2,"EVENT, LoadWebrtc audio files loaded form url: "+webphone_api.getbasedir2()+"sound/"),AddVideoElemnts(!1),setTimeout(function(){AddVideoElemnts(!0);var e=document.getElementById("ringtone"),t=document.getElementById("ringbacktone");!webphone_api.common.isNull(e)&&!webphone_api.common.isNull(t)&&!0===webphone_api.rt_loaded&&!0===webphone_api.rt_canplay&&!0===webphone_api.rbt_loaded&&!0===webphone_api.rbt_canplay&&e.play&&t.play||(webphone_api.$(document.body).append('<audio id="audio_remote" autoplay="autoplay" ></audio>'),webphone_api.$(document.body).append('<audio id="ringtone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringtone.wav" onloadeddata="webphone_api.rt_loaded = true;" oncanplaythrough="webphone_api.rt_canplay = true;" ></audio>'),webphone_api.$(document.body).append('<audio id="ringbacktone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringbacktone.wav" onloadeddata="webphone_api.rbt_loaded = true;" oncanplaythrough="webphone_api.rbt_canplay = true;" ></audio>'),webphone_api.$(document.body).append('<audio id="dtmfTone" src="'+webphone_api.getbasedir2()+'sound/rtc_dtmf.wav" ></audio>'),webphone_api.$(document.body).append('<audio id="justbeep_1" src="'+webphone_api.getbasedir2()+'sound/beep-01.wav" ></audio>'),PutToDebugLog(2,"EVENT, LoadWebrtc audio files loaded again after document ready form url: "+webphone_api.getbasedir2()+"sound/"))},5e3),document.onkeyup=onKeyUp,document.body.onkeyup=onKeyUp);var o="error";webphone_api.common.GetLogLevel()>1&&(o="info"),webphone_api[t].SIPml.setDebugLevel(o);var i=function(e){for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o++){var i=n[o].split("=");if(decodeURIComponent(i[0])===e)return decodeURIComponent(i[1])}return null},a=function(){var o=i("wt"),a=i("fps"),r=i("mvs"),s=i("mbwu"),l=i("mbwd"),p=i("za"),c=i("ndb");if(webphone_api[t].SIPml.isInitialized())return void e(!0,t,n);o&&webphone_api[t].SIPml.setWebRtcType(o),"webrtcstack"===t?webphone_api.webrtcstack.SIPml.init(CheckIfSupported,function(o){PutToDebugLogException(2,"webrtc: preinit SIPml.init",o),PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (10)"),e(!1,t,n)}):webphone_api[t].SIPml.init(CheckIfSupported,function(o){PutToDebugLogException(2,"webrtc: preinit SIPml.init",o),PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (10)"),e(!1,t,n)}),a&&webphone_api[t].SIPml.setFps(parseFloat(a)),r&&webphone_api[t].SIPml.setMaxVideoSize(r),s&&webphone_api[t].SIPml.setMaxBandwidthUp(parseFloat(s)),l&&webphone_api[t].SIPml.setMaxBandwidthDown(parseFloat(l)),p&&webphone_api[t].SIPml.setZeroArtifacts("true"===p),"true"==c&&webphone_api[t].SIPml.startNativeDebug()};webphone_api.common.isNull(oReadyStateTimer)||clearInterval(oReadyStateTimer);var r=(webphone_api.common.GetTickCount(),0);oReadyStateTimer=setInterval(function(){r++,webphone_api.common.GetTickCount()-webphone_api.loadwebrtc_timestamp>25e3&&"Edge"===webphone_api.common.GetBrowser()&&(PutToDebugLog(2,"ERROR, reload webphone because window.onload, document.readyState did not fire after 11 sec"),console.log("ERROR, reload webphone because window.onload, document.readyState did not fire after 11 sec"),window.location.reload()),"complete"!==document.readyState&&!0!==webphone_api.document_loaded||(clearInterval(oReadyStateTimer),a())},50)}catch(s){PutToDebugLogException(2,"webrtcapi: LoadWebrtc inner",s),e(!1,t,n)}}function CheckIfSupported(){function e(e){try{var t="";!webphone_api.common.isNull(lw_namespace_arr)&&lw_namespace_arr.length>0&&(t=lw_namespace_arr.shift());var n=null;!webphone_api.common.isNull(lw_account_arr)&&lw_account_arr.length>0&&(n=lw_account_arr.shift()),!webphone_api.common.isNull(t)&&t.indexOf("webrtcstack")>=0&&"webrtcstack"!==t?LoadWebrtcCb(e,t,n):webphone_api.common.isNull(initcallback)||initcallback(e)}catch(o){return PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported HandleCallback false (4)"),PutToDebugLogException(2,"webrtcapi: CheckIfSupported HandleCallback",o),webphone_api.common.isNull(initcallback)||initcallback(!1),!1}}try{return webphone_api.webrtcstack.SIPml.isWebRtcSupported()?(5,webphone_api.webrtcstack.SIPml.isWebSocketSupported()?(10,viewVideoLocal=videoLocal,viewVideoRemote=videoRemote,11,webphone_api.webrtcstack.SIPml.isWebRtcSupported()?(16,postInit(),17,e(!0),20,!0):(12,PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (3)"),e(!1),15,!1)):(6,PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (2)"),e(!1),9,!1)):(1,PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (1)"),e(!1),4,!1)}catch(t){return e(!1),!1}}function postInit(){try{isregistered=!1,webphone_api.common.isNull(audioRemote)&&PutToDebugLog(2,"ERROR, Cannot find audio_remote html element (incoming audio will not work without this element!!)"),callsipheaders=RemoveDuplicateHeader(callsipheaders),oConfigCall={audio_remote:audioRemote,video_local:viewVideoLocal,video_remote:viewVideoRemote,screencast_window_id:0,bandwidth:{audio:0,video:undefined},video_size:null,events_listener:{events:"*",listener:onSipEventSession},sip_caps:[{name:"+g.oma.sip-im"}],sip_headers:callsipheaders},oConfigMessage={events_listener:{events:"*",listener:onSipEventSession}},oConfigSms={events_listener:{events:"*",listener:onSipEventSession}}}catch(e){PutToDebugLogException(2,"webrtcapi: postInit",e)}}function SetSipHeader(e,t){try{var n=webphone_api.common.IsMizuServerOrGateway(),o=webphone_api.common.GetParameter("customsipheader");if(!webphone_api.common.isNull(o)&&o.length>0){var i=null;if(i=o.indexOf(";")>0?o.split(";"):o.indexOf("\r\n")>0?o.split("\r\n"):o.split("\n"),!webphone_api.common.isNull(i)&&i.length>0)for(var a=0;a<i.length;a++)if(!(webphone_api.common.isNull(i[a])||webphone_api.common.Trim(i[a]).length<1||i[a].indexOf(":")<1)){var r=webphone_api.common.Trim(i[a].substring(0,i[a].indexOf(":"))),s=webphone_api.common.Trim(i[a].substring(i[a].indexOf(":")+1,i[a].length));webphone_api.common.isNull(r)||r.length<1||(webphone_api.common.isNull(s)&&(s=""),!0===n&&0!==r.indexOf("X-")&&(r="X-R-"+r),AddSipHeader(sipheaders,r,s),AddSipHeader(callsipheaders,r,s))}}if(webphone_api.common.isNull(t))return;t=webphone_api.common.Trim(t);var l;if(l=t.indexOf(";")>0?t.split(";"):t.indexOf("\r\n")>0?t.split("\r\n"):t.split("\n"),webphone_api.common.isNull(l)||l.length<1)return;if(-1===e&&(e=webphone_api.common.GetBestLine()),t.length<1)if(-2===e||!1===webphone_api.global.checkIfInCall){for(var a=0;a<sipheaders.length;a++){var p=sipheaders[a].name;"User-Agent"!==p&&"Organization"!==p&&p.indexOf("Webdomain")<0&&"P-Sms"!==p&&"X-Sms"!==p&&"Sy.Uppersrv"!==p&&"X-Sy.Uppersrv"!==p&&"Sy.Upperproxy"!==p&&"X-Sy.Upperproxy"!==p&&"X-IMStatus"!==p&&"X-P2P"!==p&&"X-P2PM"!==p&&"X-AUSR"!==p&&"X-Sy.Uppersrvd"!==p&&(sipheaders.splice(a,1),a--)}oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}));for(var a=0;a<webphone_api.global.ep.length;a++)try{var c=webphone_api.global.ep[a][webphone_api.common.EP_SIPHEADERS];if(webphone_api.common.isNull(c)||c.length<1)continue;for(var u=0;u<c.length;u++){var p=c[u].name;"User-Agent"!==p&&"Organization"!==p&&p.indexOf("Webdomain")<0&&"P-Sms"!==p&&"X-Sms"!==p&&"Sy.Uppersrv"!==p&&"X-Sy.Uppersrv"!==p&&"Sy.Upperproxy"!==p&&"X-Sy.Upperproxy"!==p&&"X-IMStatus"!==p&&"X-P2P"!==p&&"X-P2PM"!==p&&"X-AUSR"!==p&&"X-Sy.Uppersrvd"!==p&&(c.splice(u,1),u--)}webphone_api.global.ep[a][webphone_api.common.EP_SIPHEADERS]=c;var h=webphone_api.global.ep[a][webphone_api.common.EP_SESSION];webphone_api.common.isNull(h)||(c=RemoveDuplicateHeader(c),h.setConfiguration({sip_headers:c}))}catch(_){PutToDebugLogException(2,"webrtcapi: SetSipHeader remove from callseesions",_)}}else if(e>0){for(var g=-1,a=0;a<webphone_api.global.ep.length;a++){var m=webphone_api.global.ep[webphone_api.common.EP_LINE];if(m===e){g=a;break}}if(g>-1){var c=webphone_api.global.ep[g][webphone_api.common.EP_SIPHEADERS];if(!webphone_api.common.isNull(c)&&c.length>0){for(var u=0;u<c.length;u++){var p=c[u].name;"User-Agent"!==p&&"Organization"!==p&&p.indexOf("Webdomain")<0&&"P-Sms"!==p&&"X-Sms"!==p&&"Sy.Uppersrv"!==p&&"X-Sy.Uppersrv"!==p&&"Sy.Upperproxy"!==p&&"X-Sy.Upperproxy"!==p&&"X-IMStatus"!==p&&"X-P2P"!==p&&"X-P2PM"!==p&&"X-AUSR"!==p&&"X-Sy.Uppersrvd"!==p&&(c.splice(u,1),u--)}webphone_api.global.ep[g][webphone_api.common.EP_SIPHEADERS]=c;var h=webphone_api.global.ep[g][webphone_api.common.EP_SESSION];webphone_api.common.isNull(h)||(c=RemoveDuplicateHeader(c),h.setConfiguration({sip_headers:c}))}}}for(var a=0;a<l.length;a++)if(!(webphone_api.common.isNull(l[a])||l[a].indexOf(":")<1)){var r=l[a].substring(0,l[a].indexOf(":")),d=l[a].substring(l[a].indexOf(":")+1);if(webphone_api.common.isNull(d)&&(d=""),!0===n&&0!==r.indexOf("X-")&&(r="X-R-"+r),-2===e||!1===webphone_api.global.checkIfInCall){AddSipHeader(sipheaders,r,d),oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}));for(var u=0;u<webphone_api.global.ep.length;u++)try{var c=webphone_api.global.ep[u][webphone_api.common.EP_SIPHEADERS];if(webphone_api.common.isNull(c)||c.length<1)continue;AddSipHeader(c,r,d),webphone_api.global.ep[u][webphone_api.common.EP_SIPHEADERS]=c;var h=webphone_api.global.ep[u][webphone_api.common.EP_SESSION];webphone_api.common.isNull(h)||(c=RemoveDuplicateHeader(c),h.setConfiguration({sip_headers:c}))}catch(_){PutToDebugLogException(2,"webrtcapi: SetSipHeader add OR remove from callseesions",_)}AddSipHeader(callsipheaders,r,d)}else if(e>0){for(var g=-1,b=0;b<webphone_api.global.ep.length;b++){var m=webphone_api.global.ep[webphone_api.common.EP_LINE];if(m===e){g=b;break}}if(g>-1){var c=webphone_api.global.ep[g][webphone_api.common.EP_SIPHEADERS];if(!webphone_api.common.isNull(c)&&c.length>0){AddSipHeader(c,r,d),webphone_api.global.ep[g][webphone_api.common.EP_SIPHEADERS]=c;var h=webphone_api.global.ep[g][webphone_api.common.EP_SESSION];webphone_api.common.isNull(h)||(c=RemoveDuplicateHeader(c),h.setConfiguration({sip_headers:c}))}}}}}catch(_){PutToDebugLogException(2,"webrtcapi: SetSipHeader",_)}}function AddSipHeader(e,t,n){try{if(webphone_api.common.isNull(e)&&(e=[]),webphone_api.common.isNull(t)||t.length<1)return;webphone_api.common.isNull(n)&&(n=""),PutToDebugLog(4,"EVENT, AddSipHeader: "+t+": "+n);for(var o=t.toLowerCase(),i=!1,a=0;a<e.length;a++){var r=e[a].name;if(!(webphone_api.common.isNull(r)||r.length<1)&&(r=r.toLowerCase(),o===r)){"User-Agent"!==t&&"Organization"!==t&&t.indexOf("Webdomain")<0&&"P-Sms"!==t&&"X-Sms"!==t&&"Sy.Uppersrv"!==t&&"X-Sy.Uppersrv"!==t&&"Sy.Upperproxy"!==t&&"X-Sy.Upperproxy"!==t&&"X-P2P"!==t&&"X-P2PM"!==t&&"X-AUSR"!==t&&"X-Sy.Uppersrvd"!==t&&(t.length<1?e[a].splice(a,1):e[a].value=n),i=!0;break}}!1===i&&t.length>0&&(e[e.length]={},e[e.length-1].name=t,e[e.length-1].value=n),e=RemoveDuplicateHeader(e)}catch(s){PutToDebugLogException(2,"webrtcapi: AddSipHeader",s)}}function RemoveDuplicateHeader(e){try{var t=[];if(webphone_api.common.isNull(e)||e.length<1)return e;for(var n=e.length-1;n>=0;n--)if(!webphone_api.common.isNull(e[n])){for(var o=!1,i=0;i<t.length;i++)if(t[i].name===e[n].name){o=!0;break}!1===o&&t.push(e[n])}if(!webphone_api.common.isNull(t))return t}catch(a){PutToDebugLogException(2,"webrtcapi: RemoveDuplicateHeader",a)}return e}function ReStart(e,t){try{if(webphone_api.common.isNull(te2)&&(te2=webphone_api.common.Te2()),te2)return;if(PutToDebugLog(2,"EVENT, webrtcapi restart flag: "+webphone_api.flagrestartwebrtc.toString()),!1===webphone_api.flagrestartwebrtc)return;if(webphone_api.global.checkIfInCall&&(webphone_api.global.checkIfInCall=!1,PutToDebugLog(1,"STATUS,-1,Call Finished")),!0===t)return PutToDebugLog(2,"EVENT, restarting webrtc sipstack: forced"),restartdelay=2e3,webphone_api.common.CallWsuserKeepAlive(!0),void Start();var n=webphone_api.common.GetTickCount();if(!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)&&(restartdelay=webphone_api.common.StrToInt(e)),n<=lastrestarttick+restartdelay)return;n-lastrestarttick>8e5&&restartdelay>2e3&&(restartdelay=2e3),n>lastrestarttick+restartdelay&&n-lastrestarttick<512e3&&(restartdelay*=2),lastrestarttick=n;var o=new Date(lastrestarttick),i=o.getHours(),a=o.getMinutes(),r=o.getSeconds();a<10&&(a="0"+a),r<10&&(r="0"+r),restarttimestr=i+":"+a+":"+r,setTimeout(function(){PutToDebugLog(2,"EVENT, restarting webrtc sipstack: "+restarttimestr),webphone_api.common.CallWsuserKeepAlive(!0),Start()},restartdelay)}catch(s){PutToDebugLogException(2,"webrtcapi: ReStart",s)}}function Start(){try{LoadWebrtc(function(e){PutToDebugLog(2,"EVENT, webrtcapi: LoadWebrtc returned: "+e),StartInner()})}catch(e){PutToDebugLogException(2,"webrtcapi: Start",e)}}function StartInner(){var lastopp=0;try{lastopp=1,PutToDebugLog(2,"EVENT, webrtcapi start"),webphone_api.flagrestartwebrtc=!0,lastopp=2,StartGetDevices();var ismizuserverorgw=webphone_api.common.IsMizuServerOrGateway();PutToDebugLog(2,"EVENT, mlogic API_Setvolume on WebRTC start "+ismizuserverorgw),webphone_api.setvolume(1,webphone_api.common.GetParameter("volumeout"));var chsptr=webphone_api.common.GetParameter2("changesptoring");(webphone_api.common.isNull(chsptr)||chsptr.length<1||!1===webphone_api.common.IsNumber(chsptr))&&(chsptr=2),changesptoring=webphone_api.common.StrToInt(chsptr);var remonco=webphone_api.common.GetParameter2("recheckmediaonconnect");(webphone_api.common.isNull(remonco)||remonco.length<1||!1===webphone_api.common.IsNumber(remonco))&&(remonco=2),recheckmediaonconnect=webphone_api.common.StrToInt(remonco),(recheckmediaonconnect<0||recheckmediaonconnect>3)&&(recheckmediaonconnect=2),webphone_api.global.autoacceptsipheader=webphone_api.common.GetParameter("autoacceptsipheader");var sipusername=webphone_api.common.GetSipusername(),password=webphone_api.common.GetParameter("password"),callerid=webphone_api.common.GetCallerid();(webphone_api.common.isNull(callerid)||webphone_api.common.Trim(callerid).length<1)&&(callerid=sipusername),lastopp=3;var udpaddr=webphone_api.common.GetUDPServerAddress(),wsaddr=webphone_api.common.GetWebrtcSrvAddr(),displayname=webphone_api.common.GetParameter("displayname");(webphone_api.common.isNull(displayname)||displayname.length<1)&&sipusername!==callerid&&(displayname=sipusername),!0===webphone_api.common.GetParameterBool("hidemyidentity",!1)&&(displayname=""),2===webphone_api.common.GetConfigInt("usemizuwebrtcgateway",1)&&(wsaddr=""),lastopp=4,webphone_api.common.isNull(wsaddr)||wsaddr.length<2?(wsaddr=webphone_api.common.GetWp(),!webphone_api.common.isNull(wsaddr)&&wsaddr.length>0&&(wsaddr.indexOf("//")>=0&&(wsaddr=wsaddr.substring(wsaddr.indexOf("//")+2)),wsaddr.indexOf(":")>0&&(wsaddr=wsaddr.substring(0,wsaddr.indexOf(":"))))):wsaddr=webphone_api.common.Trim(wsaddr.toLowerCase()),lastopp=5,wsaddr=wsaddr.replace("*",""),wsaddr=wsaddr.toLowerCase(),wsaddr=wsaddr.replace("udp://",""),wsaddr=wsaddr.replace("tcp://",""),wsaddr=wsaddr.replace("http://",""),wsaddr=wsaddr.replace("https://","");var sipaddress=udpaddr;sipaddress.indexOf("udp:")<0&&(sipaddress="udp://"+sipaddress);var proxyaddress=webphone_api.common.GetProxyaddress();if(webphone_api.common.isNull(proxyaddress)&&(proxyaddress=""),!0===ismizuserverorgw&&proxyaddress.length<1&&(proxyaddress=sipaddress),lastopp=6,proxyaddress=webphone_api.common.GetProxyaddress(proxyaddress),proxyaddress.length>0)if(ismizuserverorgw)proxyaddress="udp://"+proxyaddress;else{var transport=webphone_api.common.GetParameterInt("transport",0),transpStr="udp";1===transport?transpStr="tcp":2===transport&&(transpStr="tls"),transpStr.indexOf(":")<0&&(transpStr+="://"),proxyaddress=transpStr+proxyaddress}lastopp=7;var wsaddress=wsaddr;wsaddress.indexOf("ws:")<0&&wsaddress.indexOf("wss:")<0&&(wsaddress="ws://"+wsaddress);var hostmp=location.host.toLowerCase();if(!1!==webphone_api.common.IsIPAddrress(wsaddress)&&!0!==webphone_api.common.BrowserRequiresHttps(!0)||(wsaddress=wsaddress.replace("ws:","wss:")),!1===webphone_api.global.decideusuk_finished){var set=!1;if(!0===webphone_api.common.IsUKGateway(wsaddress)?(webphone_api.global.usuk="uk",set=!0):!0===webphone_api.common.IsUSGateway(wsaddress)&&(webphone_api.global.usuk="us",set=!0),set&&!webphone_api.global.decideusuk_finished){webphone_api.global.decideusuk_finished=!0;var selsrv=webphone_api.common.GetWsAddressCfg();!webphone_api.common.isNull(selsrv)&&selsrv.length>0&&webphone_api.common.SaveParameter("lastwebrtcserver",selsrv),PutToDebugLog(5,"EVENT, DecideUsUk select finished on start "+selsrv)}}lastopp=8;var publicsipaddress=webphone_api.common.GetConfig("publicsipaddress");webphone_api.common.isNull(publicsipaddress)&&(publicsipaddress=""),publicsipaddress.length>0&&PutToDebugLog(2,"EVENT, WebRTC publicsipaddress is set to: "+publicsipaddress);var realm=publicsipaddress;realm.length<2&&(realm=webphone_api.common.GetParameter("realm"),(webphone_api.common.isNull(realm)||realm.length<2)&&(realm=udpaddr)),realm=webphone_api.common.NormalizeInput(realm,0),realm.indexOf(":")>0&&(realm=realm.substring(0,realm.indexOf(":"))),realm=webphone_api.common.Trim(realm),webphone_api.global.mRealm=realm,lastopp=9;var sipuri=callerid;if(sipuri.indexOf("sip:")<0&&(sipuri="sip:"+callerid),sipuri.indexOf("@")<0)if(sipuri+="@",publicsipaddress.length>1)sipuri+=publicsipaddress;else if(realm.indexOf(".")>0)sipuri+=realm;else{var tmpsrv=sipaddress;tmpsrv=tmpsrv.toLowerCase(),tmpsrv=webphone_api.common.NormalizeInput(tmpsrv,0),tmpsrv.indexOf(":")>0&&(tmpsrv=tmpsrv.substring(0,tmpsrv.indexOf(":"))),tmpsrv.indexOf("/")>0&&(tmpsrv=tmpsrv.substring(0,tmpsrv.indexOf("/"))),sipuri+=tmpsrv}if(lastopp=10,!webphone_api.common.isNull(sipuri)&&sipuri.indexOf("@")>0){var addrtmp=sipuri.substr(sipuri.indexOf("@")+1);if(!webphone_api.common.isNull(addrtmp)&&(addrtmp.indexOf(":")>0&&(addrtmp=addrtmp.substring(0,addrtmp.indexOf(":"))),!webphone_api.common.isNull(addrtmp)&&addrtmp.length>0&&1==webphone_api.common.IsLanIPEx(addrtmp)&&webphone_api.common.GetWsAddressCfg(2).length<2))return PutToDebugLog(3,"ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+" (2) "+addrtmp),PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")),(!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))&&alert("ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+"\n\n"+webphone_api.stringres.get("all_demo_msg")+" (2)"),!1}lastopp=11;var enableRTCWebBreaker=!0;enableRTCWebBreaker=!(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker)&&0===webphone_api.parameters.rtcbreaker)&&(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker)&&1===webphone_api.parameters.rtcbreaker||!ismizuserverorgw),lastopp=12;var organization=webphone_api.common.GetConfig("companyname");(webphone_api.common.isNull(organization)||organization.length<1)&&(organization=webphone_api.common.GetConfig("brandname"),(webphone_api.common.isNull(organization)||organization.length<1)&&(organization="Mizutech"));var ua=webphone_api.common.GetUA();!webphone_api.common.isNull(webphone_api.common.GetParameter("useragent"))&&webphone_api.common.GetParameter("useragent").length>0&&!1===webphone_api.common.IsMizuPublicWebRTCGateway()&&(ua=webphone_api.common.GetParameter("useragent")),lastopp=13,sipheaders=[{name:"User-Agent",value:ua},{name:"Organization",value:organization},{name:"X-Webdomain",value:webphone_api.common.GetWebdomain()}];var xhval="1";!0===webphone_api.common.Hasesw()?xhval="2":!0===webphone_api.common.Us()&&(xhval="0"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-LS",sipheaders[sipheaders.length-1].value=xhval,SetSipHeader(0),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-UT",sipheaders[sipheaders.length-1].value="r";var company=webphone_api.common.GetParameter("companyname");!webphone_api.common.isNull(company)&&company.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Company",sipheaders[sipheaders.length-1].value=company);var brand=webphone_api.common.GetParameter("brandname");!webphone_api.common.isNull(brand)&&brand.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Brand",sipheaders[sipheaders.length-1].value=brand);var uppsrv=webphone_api.common.GetWebrtcSyUpperHeader("start");uppsrv.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Uppersrv",sipheaders[sipheaders.length-1].value=uppsrv);var uppsrvd=webphone_api.common.GetWebrtcSyUpperDomainHeader("start");uppsrvd.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Uppersrvd",sipheaders[sipheaders.length-1].value=uppsrvd);var dtmfmode=webphone_api.common.GetParameterInt("dtmfmode",2);4==dtmfmode&&ismizuserverorgw&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-MFlag",sipheaders[sipheaders.length-1].value="2"),webphone_api.global.addauser_header=!1,ismizuserverorgw&&!webphone_api.common.isNull(sipusername)&&sipusername.length>0&&!webphone_api.common.isNull(callerid)&&callerid.length>0&&sipusername!==callerid&&(webphone_api.global.addauser_header=!0,sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-AUSR",sipheaders[sipheaders.length-1].value=sipusername);var prxy=webphone_api.common.GetUpperProxyHeaderForSignaling();!webphone_api.common.isNull(prxy)&&prxy.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Upperproxy",sipheaders[sipheaders.length-1].value=prxy),ismizuserverorgw&&!0===webphone_api.common.UsePresence2()&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-IMStatus",sipheaders[sipheaders.length-1].value="Online");var p2psignaling=webphone_api.common.GetParameterInt("p2psignaling",1);if(ismizuserverorgw&&1!==p2psignaling){var valTmp="unknown";0===p2psignaling?valTmp="no":2===p2psignaling?valTmp="proxy":3===p2psignaling&&(valTmp="process"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-P2P",sipheaders[sipheaders.length-1].value=valTmp}var use_fast_ice=webphone_api.common.GetParameterInt("use_fast_ice",1);ismizuserverorgw&&-1===use_fast_ice&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-P2PM",sipheaders[sipheaders.length-1].value="1"),sipheaders=RemoveDuplicateHeader(sipheaders),lastopp=14;var loglevel="error";webphone_api.common.GetLogLevel()>1&&(loglevel="info"),webphone_api.webrtcstack.SIPml.setDebugLevel(loglevel),window.webkitNotifications&&0!=window.webkitNotifications.checkPermission()&&window.webkitNotifications.requestPermission(),(webphone_api.common.isNull(sipusername)||sipusername.length<1)&&(PutToDebugLog(2,"ERROR, WebRTC invalid username: "+sipusername),PutToDebugLog(1,"ERROR, Invalid username")),(webphone_api.common.isNull(password)||password.length<1)&&(PutToDebugLog(2,"ERROR, WebRTC invalid password: "+password),PutToDebugLog(1,"ERROR, Invalid password")),(webphone_api.common.isNull(sipuri)||sipuri.length<2||sipuri.indexOf("@")<1||sipuri.indexOf(".")<1)&&PutToDebugLog(2,"ERROR, WebRTC invalid sipuri: "+sipuri),lastopp=15;var stun_turn=[],stun=webphone_api.common.GetStunServersStr(),turn=webphone_api.common.GetTurnSrv();if(!webphone_api.common.isNull(stun)&&stun.length>2){var sarr=stun.split(","),useurls=!1;if(("Chrome"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>40||"Firefox"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>40)&&(useurls=!0),!webphone_api.common.isNull(sarr))for(var i=0;i<sarr.length;i++)if(!(webphone_api.common.isNull(sarr[i])||sarr[i].length<1))if(!0===useurls){var obj={urls:sarr[i]};stun_turn.push(obj)}else{var obj={url:sarr[i]};stun_turn.push(obj)}}lastopp=16,webphone_api.common.isNull(turn)||webphone_api.common.IsLocalServer()||stun_turn.push(turn),lastopp=17;var ldebug=!1;(webphone_api.common.GetLogLevel()>=7||!0===webphone_api.global.isdebugversion&&webphone_api.common.GetLogLevel()>=5)&&(ldebug=!0);var logparams={};if(!webphone_api.common.isNull(webphone_api.global.settmap2)){for(var key in webphone_api.global.settmap2)if(!(webphone_api.common.isNull(key)||key.length<1)){var value=webphone_api.global.settmap2[key];webphone_api.common.isNull(value)||value.length<1||(ldebug||"mclientid"!==key&&"wstestservers"!==key)&&(key.indexOf("server")<0&&key.indexOf("username")<0&&key.indexOf("password")<0&&"1"===value[webphone_api.common.SETT_ISDEFAULT]||"-1"===value[webphone_api.common.SETT_ISDEFAULT]&&(key.indexOf("transfer")>=0||key.indexOf("refer")>=0||key.indexOf("allowreplace")>=0)||(!ldebug&&(key.indexOf("password")>=0||"extraregisteraccounts"===key)?logparams[key]="*":logparams[key]=value[webphone_api.common.SETT_VALUE]))}lastopp=18;var extraoption=webphone_api.common.GetParameter("extraoption");if(!webphone_api.common.isNull(extraoption)&&extraoption.length>0){extraoption=webphone_api.common.Trim(extraoption);var optionlist=extraoption.split(";");if(!webphone_api.common.isNull(optionlist)&&optionlist.length>0)for(var i=0;i<optionlist.length;i++)if(!(webphone_api.common.isNull(optionlist[i])||optionlist[i].length<1||optionlist[i].indexOf("=")<1)){var key=webphone_api.common.Trim(optionlist[i].substring(0,optionlist[i].indexOf("="))),value=webphone_api.common.Trim(optionlist[i].substring(optionlist[i].indexOf("=")+1));!webphone_api.common.isNull(key)&&key.length>0&&!webphone_api.common.isNull(value)&&(logparams[key]=value)}}}if(lastopp=19,webphone_api.common.IsCExt()>0&&(webphone_api.global.add_recall_header=!0),webphone_api.common.LogAllParameters("WebRTC all parameters (just informative):",logparams),PutToDebugLog(3,"Webrtc connection details:"),PutToDebugLog(3,"sipusername: "+sipusername),ldebug?PutToDebugLog(3,"password: "+password):!webphone_api.common.isNull(password)&&password.length>0?PutToDebugLog(3,"password: *"):PutToDebugLog(3,"password: null"),PutToDebugLog(3,"sipuri: "+sipuri),PutToDebugLog(3,"displayname: "+displayname),PutToDebugLog(3,"wsaddress: "+wsaddress),PutToDebugLog(3,"proxyaddress: "+proxyaddress),PutToDebugLog(3,"realm: "+realm),lastopp=20,(webphone_api.common.isNull(webphone_api.global.usuk)||webphone_api.global.usuk.length<1)&&(webphone_api.common.IsUKGateway(wsaddress)?(PutToDebugLog(2,"WARNING, webrtcapi Start manually setting UK gateway, because DecideUsUk has not yet finished"),webphone_api.global.usuk="uk"):webphone_api.common.IsUSGateway(wsaddress)&&(PutToDebugLog(2,"WARNING, webrtcapi Start manually setting US gateway, because DecideUsUk has not yet finished"),webphone_api.global.usuk="us")),mSipuri=sipuri,mDisplayname=displayname,!webphone_api.common.isNull(stun_turn)&&stun_turn.length>0){for(var i=0;i<stun_turn.length;i++)if(!webphone_api.common.isNull(stun_turn[i])){var sobj=stun_turn[i];for(var key in sobj){var msgtmp="turn server";!webphone_api.common.isNull(sobj[key])&&sobj[key].toString().indexOf("stun")>=0&&(msgtmp="stun server"),PutToDebugLog(3,msgtmp+"["+i+"]: "+key+": "+sobj[key])}}}else PutToDebugLog(3,"stun server: NOT set");lastopp=21;var iceobj=null,icestr=webphone_api.common.GetParameter("ice");if(!webphone_api.common.isNull(icestr)&&icestr.length>0)try{iceobj=eval(icestr)}catch(eice){iceobj=null,PutToDebugLogException(2,"ERROR, webrtcapi parse ICE servers: "+icestr,eice)}if(!webphone_api.common.isNull(iceobj)){try{PutToDebugLog(2,"EVENT, webrtcapi found ICE (STUN/TURN) server: "+JSON.stringify(iceobj))}catch(eice2){}stun_turn=iceobj}var earlymediaint=webphone_api.common.GetParameterInt("earlymedia",2),earlymedia=!0;earlymediaint<1&&(earlymedia=!1),webphone_api.common.isNull(te2)&&(te2=webphone_api.common.Te2()),te2&&(stun_turn=null),webphone_api.webrtcMicVolume=GetVolume(0)/100,webphone_api.global.minten=!1,lastopp=22;try{sipheaders=RemoveDuplicateHeader(sipheaders),oSipStack=new webphone_api.webrtcstack.SIPml.Stack({realm:realm,impi:sipusername,impu:sipuri,password:password,display_name:displayname,websocket_proxy_url:wsaddress,outbound_proxy_url:proxyaddress,ice_servers:stun_turn,enable_rtcweb_breaker:enableRTCWebBreaker,events_listener:{events:"*",listener:onSipEventStack},enable_early_ims:earlymedia,enable_media_stream_cache:!0,bandwidth:null,video_size:null,sip_headers:sipheaders})}catch(err_reg){var reason="";webphone_api.common.isNull(err_reg)||(reason=err_reg.toString()),!webphone_api.common.isNull(reason)&&reason.indexOf("is not valid as SIP Uri")>=0&&(reason=webphone_api.common.NormalizeInput2(sipusername,1)!==sipusername?"invalid SIP Uri because username contains special characters: "+sipusername:"invalid serveraddress: "+realm),!webphone_api.common.isNull(reason)&&reason.length>0&&(lastregfailreason=reason,PutToDebugLog(1,"ERROR, Register failed: "+reason));try{webphone_api.onRegStateChangeCb("failed",reason)}catch(errin){PutToDebugLogException(2,"webrtcapi: Start: There is an error in onRegisterFailed(failed) callback",errin)}try{webphone_api.onRegisterFailedCb(reason)}catch(errin){PutToDebugLogException(2,"webrtcapi: Start: There is an error in onRegisterFailed() callback",errin)}PutToDebugLogException(2,"webrtcapi: Start failed to create SIPstack",err_reg)}return lastopp=23,webphone_api.common.GetParameterInt("forcereregister",1)>1&&StartReRegister(!0),webphone_api.global.webrtc_regstate=0,webphone_api.common.CallWsuserKeepAlive(!1),setTimeout(function(){if(lastopp=24,!webphone_api.common.isNull(webphone_api.global.sipaccounts)&&webphone_api.global.sipaccounts.length>1)for(var e=0;e<webphone_api.global.sipaccounts.length;e++)if("true"!==webphone_api.global.sipaccounts[e].ismain.toString()){
var t=webphone_api.global.sipaccounts[e],n=t.serveraddress+","+t.username+","+t.password+","+t.ival+","+t.callerid+","+t.displayname+","+t.proxyaddress+","+t.realm;RegisterEx(n)}var o=webphone_api.common.GetExtraRegAccFromAPIparam();if(!webphone_api.common.isNull(o)&&o.length>5){var i=[];if(i=o.indexOf("#")>=0?o.split("#"):o.split(";"),!webphone_api.common.isNull(i)&&i.length>0)for(var e=0;e<i.length;e++)webphone_api.common.isNull(i[e])||i[e].length<5||RegisterEx(i[e])}},2500),lastopp=25,0!=oSipStack.start()?(PutToDebugLog(2,"ERROR, webrtcapi: Start, Failed to start the SIP stack"),!1):(setTimeout(function(){webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2)},500),!0)}catch(err){PutToDebugLogException(2,"webrtcapi: StartInner "+lastopp,err)}return!1}function SipUnRegister(){try{if(oSipSessionRegister)return oSipSessionRegister.unregister(),setTimeout(function(){PutToDebugLog(1,"STATUS,-1,Unregistered")},100),!0}catch(e){PutToDebugLogException(2,"webrtcapi: SipUnRegister",e)}return!1}function SipStop(e){try{if(PutToDebugLog(2,"EVENT,SipStack Stopping from "+e),!0===webphone_api.isregistered()&&SipUnRegister(),oSipStack)return oSipStack.stop(),PutToDebugLog(2,"EVENT,SipStack Stopped from "+e),setTimeout(function(){try{"undefined"!=typeof webphone_api.webrtc_socket&&null!==webphone_api.webrtc_socket&&(webphone_api.webrtc_socket.close(),webphone_api.webrtc_socket=null,PutToDebugLog(2,"EVENT,SipStack Destroyed")),PutToDebugLog(2,"webrtcapi: SipStop websocket closed")}catch(e){PutToDebugLogException(2,"webrtcapi: SipStop inner",e)}},500),!0;if(!webphone_api.common.isNull(registerExSipstackArray)&&registerExSipstackArray.length>0)for(var t=0;t<registerExSipstackArray.length;t++)!webphone_api.common.isNull(registerExSipstackArray[t])&&registerExSipstackArray[t]&&registerExSipstackArray[t].stop&&registerExSipstackArray[t].stop()}catch(n){PutToDebugLogException(2,"webrtcapi: SipStop",n)}return registerExSipstackArray=[],!1}function HandleOconfigCall(e,t){try{var n=e;return!0===webphone_api.isincall()&&webphone_api.common.isNull(document.getElementById("audio_remote_"+t))&&webphone_api.$(document.body).append('<audio id="audio_remote_'+t+'" autoplay="autoplay" ></audio>'),webphone_api.common.isNull(document.getElementById("audio_remote_"+t))?oConfigCall.audio_remote=audioRemote:oConfigCall.audio_remote=document.getElementById("audio_remote_"+t),n}catch(o){PutToDebugLogException(2,"webrtcapi: HandleOconfigCall",o)}return e}function RemoveUnusedAudioElements(){try{for(var e=1;e<15;e++)webphone_api.$("#audio_remote_"+e).remove()}catch(t){PutToDebugLogException(2,"webrtcapi: RemoveUnusedAudioElements",t)}}function SipCall(e,t,n,o){try{if(!oSipStack&&!1===sipstackstarted)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipCall sipstack not started"),PutToDebugLog(1,"ERROR, Reconnecting, try to call again"),PutToDebugLog(1,"EVENT, POPUP, Reconnecting, try to call again"),ReStart(1500),sipstackstarted=!0,setTimeout(function(){SipCall(e,t,n)},2500),!1;if(webphone_api.common.isNull(n)||n.length<1)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipCall number is NULL"),!1;setTimeout(function(){!1===webphone_api.global.webrtcpermissionaccepted&&(PutToDebugLog(2,"ERROR, call accepted, but permission not yet accepted"),webphone_api.common.AlertDialog(webphone_api.stringres.get("request_permission2_title"),webphone_api.common.ReplaceAll(webphone_api.stringres.get("request_permission2"),"[BRANDNAME]",webphone_api.common.GetBrandName())))},7e3),oConfigCall.bandwidth=undefined,oConfigCall.video_size=undefined;var i=webphone_api.common.GetVideoBandwidth(),a=webphone_api.common.GetAudioBandwidth();if(oConfigCall.bandwidth={audio:a,video:i},"call-audiovideo"===e||"call-screenshare"===e){var r=document.getElementById("video_container");webphone_api.common.isNull(r)&&(PutToDebugLog(2,"ERROR, VideoCall cannot find video container"),(!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))&&webphone_api.common.ShowToast('ERROR, For the video to work, you must add a DIV html element to your page with id="video_container"',1e4)),PutToDebugLog(2,"EVENT, webrtcapi: video bandwidth: "+i),"call-audiovideo"===e&&(oConfigCall.video_size=GetVideoSizeObj()),PutToDebugLog(1,"STATUS,-1,Starting video call to "+n)}else PutToDebugLog(2,"EVENT, webrtcapi: audio bandwidth: "+a),PutToDebugLog(1,"STATUS,-1,Starting call to "+n);if(SetSipHeader(1),!1===webphone_api.global.wsuser_succeded?webphone_api.common.IsMizuServerOrGateway()&&(webphone_api.common.CallWsuserKeepAlive(!0),PutToDebugLog(3,"WARNING, wsuser NOT YET succeeded")):(webphone_api.common.CallWsuserKeepAlive(!1),PutToDebugLog(3,"EVENT, wsuser already succeeded")),webphone_api.common.isNull(o)||!0!==o)try{var s=webphone_api.common.GetEndpoint(1029,t,"","","",!1);if(!webphone_api.common.isNull(s)&&s.length>2&&"false"===s[webphone_api.common.EP_FLAGDEL]){var l=webphone_api.common.StrToInt(t)+1;PutToDebugLog(2,"WARNING, webrtc: call to: "+n+" line set to: "+l.toString()+" because we already have a call on line: "+t.toString()),t=l}}catch(u){PutToDebugLogException(2,"webrtcapi: detect multiple call on same line",u)}else;calltype=e,callline=t,destnumber=n,oSipSessionCall=oSipStack.newSession(e,HandleOconfigCall(oConfigCall,t)),sipstackstarted=!1;var p=webphone_api.common.GetTickCount();if(0!=oSipSessionCall.call(n,HandleOconfigCall(oConfigCall,t)))return oSipSessionCall=null,PutToDebugLog(2,"WRTC, ERROR, Failed to make call"),webphone_api.global.stacknotstarted_time>0&&p-webphone_api.global.stacknotstarted_time<300&&!0===webphone_api.global.stacknotstarted_retry&&(webphone_api.global.stacknotstarted_retry=!1,setTimeout(function(){PutToDebugLog(2,"WRTC, WARNING, Retry failed webrtc call (Stack not started)"),SipCall(e,t,n)},2500)),!1;webphone_api.global.checkIfInCall=!0,PutToDebugLog(1,"STATUS,-1,Call"),webphone_api.common.SaveCallSession(1,t,oSipSessionCall,n,"1",webphone_api.common.GetTickCount(),-1,-1,"","","","",oConfigCall.sip_headers,"","","",oSipSessionCall.getId()),setTimeout(function(){if(!1===webphone_api.common.Awb()){var e=[];e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push(" "),e.push("w"),e.push("e"),e.push("b"),e.push("s"),e.push("r"),e.push("v"),e.push("8");PutToDebugLog(2,"EVENT, "+e.join("")),webphone_api.common.GetCallSession(1,!0,t,n).hangup({events_listener:{events:"*",listener:onSipEventSession}}),setTimeout(function(){webphone_api.common.GetEndpoint(102,t,"","","",!0)},400)}},15e3),setTimeout(function(){if(!1===webphone_api.common.Loa()){var e=[];e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push(" "),e.push("a"),e.push("n"),e.push("d"),e.push("r"),e.push("o"),e.push("i"),e.push("d");var o=e.join("");setTimeout(function(){PutToDebugLog(2,"ERROR, "+o)},1200),setTimeout(function(){webphone_api.common.GetCallSession(2,!0,t,n).hangup({events_listener:{events:"*",listener:onSipEventSession}})},1300),setTimeout(function(){webphone_api.common.GetEndpoint(103,t,"","","",!0)},1700)}},6e3);var c=webphone_api.common.GetIceTimeout()+4500;return!webphone_api.common.isNull(e)&&e.indexOf("video")>0&&(c+=4e3),1===webphone_api.common.GetParameterInt("redialonfail",0)&&(red_line=t,red_sessioncall=oSipSessionCall,red_number=n,red_setuptime=webphone_api.common.GetTickCount(),red_callid=oSipSessionCall.getId(),red_headers=oConfigCall.sip_headers,red_delaytime=c,red_s_type=e),!0}catch(h){PutToDebugLogException(2,"webrtcapi: SipCall",h)}return!1}function RedialOnFail(){try{if(!1===webphone_api.global.redialof)return;redialonfailtimer=setTimeout(function(){try{if(!0===webphone_api.global.redialof){var e=!1;if("Firefox"===webphone_api.common.GetBrowser()){webphone_api.common.GetParameterInt("webrtc_successfulcalls",0)<3&&(e=!0)}!1===webphone_api.global.webrtcpermissionaccepted?(PutToDebugLog(2,"ERROR, initiate outgoing call, but permission not yet accepted"),webphone_api.common.ShowToast(webphone_api.stringres.get("request_permission"),12e3)):(PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: "+red_number+"; delay after first attempt: "+red_delaytime.toString()),webphone_api.global.redialof=!1,webphone_api.global.redialhideevt=!0,webphone_api.common.isNull(red_sessioncall)?(PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: create new session"),red_sessioncall=oSipStack.newSession(red_s_type,oConfigCall)):(PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: hangup previous call"),!0===e?webphone_api.hangup():red_sessioncall.hangup()),setTimeout(function(){PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: initiate call again (redial)"),!0===e?webphone_api.call(red_number):red_sessioncall.call(red_number),webphone_api.common.SaveCallSession(2,red_line,red_sessioncall,red_number,"1",red_setuptime,-1,-1,"","","","",red_headers,"","","",red_callid)},1e3))}}catch(t){PutToDebugLogException(2,"webrtcapi: RedialOnFail",t)}},red_delaytime),setTimeout(function(){webphone_api.global.redialhideevt=!1,webphone_api.common.isNull(redialonfailtimer)||clearTimeout(redialonfailtimer),redialonfailtimer=null,red_line=null,red_sessioncall=null,red_number=null,red_setuptime=0,red_callid=null,red_headers=null,red_delaytime=5e3,red_s_type="call-audio"},red_delaytime+2e3)}catch(e){PutToDebugLogException(2,"webrtcapi: RedialOnFail",e)}}function SipHangup(e,t){var n=0;try{webphone_api.global.redialof=!1,webphone_api.global.redialhideevt=!1,n=1,webphone_api.common.isNull(redialonfailtimer)||clearTimeout(redialonfailtimer),n=2,redialonfailtimer=null,n=3,PutToDebugLog(5,"EVENT, webrtc hangup line "+t+" "+webphone_api.global.aline+" "+e);var o=webphone_api.common.GetCallSession(3,!0,t,"");if(n=4,setTimeout(function(){webphone_api.common.GetEndpoint(104,t,"","","",!0)},400),n=5,o||!oSipStack){try{n=6,1===webphone_api.common.GetApibehaviour()&&PutToDebugLog(1,"STATUS,-1,Hangup"),n=7,e&&(n=8,PutToDebugLog(1,"EVENT,Rejected")),n=9,oSipStack&&t>0&&webphone_api.common.GetNrOfActiveCalls()>1&&(n=20,webphone_api.dont_remove_remote_stream=!0,n=21,PutToDebugLog(2,"EVENT, on hangup dont_remove_remote_stream set to true on multi-line"),n=22,setTimeout(function(){webphone_api.dont_remove_remote_stream=!1,PutToDebugLog(2,"EVENT, (warn) after hangup reset dont_remove_remote_stream")},300)),n=23}catch(i){PutToDebugLogException(2,"webrtcapi: SipHangup inner ("+n.toString()+")",i)}return n=24,o&&o.hangup({events_listener:{events:"*",listener:onSipEventSession}}),n=25,!0}PutToDebugLog(2,"EVENT, no session to hangup")}catch(i){PutToDebugLogException(2,"webrtcapi: SipHangup ("+n.toString()+")",i)}return!1}function SipAccept(e,t){try{var n=webphone_api.common.GetCallSession(4,!1,e,"","",null,"2");if(n){var o=webphone_api.common.GetEndpoint(105,e,"","","",!1);if(!webphone_api.common.isNull(o)&&o.length>5){var i=o[webphone_api.common.EP_CONNECTTIME];if(webphone_api.common.isNull(i)&&(i=-1),(i=webphone_api.common.StrToIntDef(i,-1))>0)for(var a=0;a<webphone_api.global.ep.length;a++){var r=webphone_api.global.ep[a];if(!webphone_api.common.isNull(r)){var s=r[webphone_api.common.EP_INCOMING];webphone_api.common.isNull(s)&&(s=1);var l=r[webphone_api.common.EP_SETUPTIME];webphone_api.common.isNull(l)&&(l=-1);var p=r[webphone_api.common.EP_CONNECTTIME];if(webphone_api.common.isNull(p)&&(p=-1),2===webphone_api.common.StrToIntDef(s,1)&&webphone_api.common.StrToIntDef(l,-1)>0&&webphone_api.common.StrToIntDef(p,1)<0&&!webphone_api.common.isNull(webphone_api.common.GetCallSession(5,!1,webphone_api.common.StrToInt(r[webphone_api.common.EP_LINE]),""))){PutToDebugLog(2,"EVENT, API_Accept: call is already connected on line: "+e+"; incoming call found to be accepted on line: "+r[webphone_api.common.EP_LINE]),e=webphone_api.common.StrToInt(r[webphone_api.common.EP_LINE]),n=webphone_api.common.GetCallSession(6,!1,e,"");break}}}}try{var c=webphone_api.common.GetTickCount()-webphone_api.global.ringstart_time,u=!1;if(1===recheckmediaonconnect&&c>14e3&&webphone_api.common.IsMizuServerOrGateway()?(PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_1: "+c),u=!0):2===recheckmediaonconnect&&c>14e3?(PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_2: "+c),u=!0):3===recheckmediaonconnect&&(PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_3"),u=!0),u){var h=null;void 0!==wen_namespace&&null!==wen_namespace||(wen_namespace="webrtcstack"),h=webphone_api[wen_namespace].SIPml.getsavethis(),webphone_api.common.isNull(h)?PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect no savethis"):webphone_api.common.isNull(tmedia_session_jsep01)?webphone_api.common.isNull(webphone_api[wen_namespace])||webphone_api.common.isNull(webphone_api[wen_namespace].tmedia_session_jsep01)?PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect no tmedia_session_jsep01"):webphone_api[wen_namespace].tmedia_session_jsep01.prototype.__get_lo.call(h,!0):tmedia_session_jsep01.prototype.__get_lo.call(h,!0)}}catch(m){PutToDebugLogException(2,"webrtcapi: SipAccept longring",m)}if(webphone_api.global.ice_callaccepted=!0,SetSipHeader(1),n.accept(HandleOconfigCall(oConfigCall,e)),PutToDebugLog(1,"EVENT,Accepted"),!1!==t){var g=webphone_api.common.GetParameterInt("beeponconnect",0);1!==g&&2!==g&&4!==g||webphone_api.common.Beep("1")}return!0}PutToDebugLog(2,"ERROR,webrtcapi session is NULL"),webphone_api.common.LogLines(),PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress2"))}catch(d){PutToDebugLogException(2,"webrtcapi: SipAccept",d)}return!1}function SipIgnore(){try{stopRingTone()}catch(e){PutToDebugLogException(2,"webrtcapi: SipIgnore",e)}return!1}function SipSendChat(e,t,n,o){try{if(!oSipStack)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat sipstack not started"),!1;if(webphone_api.common.isNull(t)||t.length<1)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat number is NULL"),!1;if(webphone_api.common.isNull(n)||n.length<1)return PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat message is NULL"),!1;if(!0===o){var i=sipheaders.slice();i[i.length]={},i[i.length-1].name="X-Sms",i[i.length-1].value="Yes",i=RemoveDuplicateHeader(i),oSipSessionMessage=oSipStack.newSession("message",oConfigSms),oSipSessionMessage.setConfiguration({sip_headers:i})}else{var a=sipheaders.slice();a=RemoveDuplicateHeader(a),oSipSessionMessage=oSipStack.newSession("message",oConfigMessage),oSipSessionMessage.setConfiguration({sip_headers:a})}return 0==oSipSessionMessage.send(t,n,"text/plain;charset=utf-8")||(oSipSessionMessage=null,PutToDebugLog(2,"WRTC, ERROR, Failed to send message chat"),!1)}catch(r){PutToDebugLogException(2,"webrtcapi: SipSendChat",r),oSipSessionMessage=null}return!1}function sipShareScreen(){if("w4a"===webphone_api.webrtcstack.SIPml.getWebRtcType()){if(!oSipSessionCall)return void(txtCallStatus.innerHTML="<i>No active session</i>");oSipSessionCall.bfcpSharing?(SetSipHeader(2),0!=oSipSessionCall.stopBfcpShare(oConfigCall)?txtCallStatus.value="Failed to stop BFCP share":oSipSessionCall.bfcpSharing=!1):(SetSipHeader(2),oConfigCall.screencast_window_id=0,0!=oSipSessionCall.startBfcpShare(oConfigCall)?txtCallStatus.value="Failed to start BFCP share":oSipSessionCall.bfcpSharing=!0)}else sipCall("call-screenshare")}function Forward(e){try{if(webphone_api.common.isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, webrtcapi Forward, invalid number: "+e),!1;if(0===webphone_api.common.GetParameterInt("allowcallredirect",1))return PutToDebugLog(2,"EVENT, webrtcapi Forward dropped, because allowcallredirect is 0 (disabled)"),!1;var t=webphone_api.common.GetRecentInviteIn();if(webphone_api.common.isNull(t)||t.toString().length<10)return PutToDebugLog(2,"ERROR, webrtcapi Forward, invalid INVITE msg: "+t),!1;webphone_api.common.GetParameterInt("fwd_msg_displayed",0)<1&&(webphone_api.common.SaveParameter("fwd_msg_displayed","1"),webphone_api.common.ShowToast(webphone_api.stringres.get("call_forward_warn")));var n="<sip:"+webphone_api.common.Trim(e)+"@"+webphone_api.common.GetUDPServerAddress()+">",o="SIP/2.0 302 Moved Temporarily\r\n";return o=o+"Via: "+webphone_api.common.GetSipHeaderFromMsg(t,"via")+"\r\n",o=o+"From: "+webphone_api.common.GetSipHeaderFromMsg(t,"from")+"\r\n",o=o+"To: "+webphone_api.common.GetSipHeaderFromMsg(t,"to")+";totag=227A1\r\n",o=o+"Call-ID: "+webphone_api.common.GetSipHeaderFromMsg(t,"call-id")+"\r\n",o=o+"CSeq: "+webphone_api.common.GetSipHeaderFromMsg(t,"cseq")+"\r\n",o=o+"Contact: "+n+"\r\n",o+="Content-Length: 0 \r\n",o+="\r\n",PutToDebugLog(3,"EVENT, send Forward SIP message:\r\n"+o),webphone_api.webrtc_socket.send(o),PutToDebugLog(2,"EVENT, Hangup because call Forward: "+e),SipHangup(!0,webphone_api.global.aline),!0}catch(i){PutToDebugLogException(2,"webrtcapi: Forward",i)}return!1}function SipTransferEx(e,t){var n=0;try{n=1;var o=webphone_api.common.StrToIntDef(t,-3);(webphone_api.common.isNull(o)||-3===o)&&(o=webphone_api.global.aline),(webphone_api.common.isNull(o)||-3===o)&&(o=2),n=2;var i=webphone_api.common.GetCallSession(7,!1,o);if(n=221,!i&&(webphone_api.common.isNull(t)||t<1)&&(n=222,o=webphone_api.common.GetBestLine(),i=webphone_api.common.GetCallSession(7,!1,o)),!i)return PutToDebugLog(1,"ERROR,transfer "+webphone_api.stringres.get("err_nocallinprogress")),webphone_api.common.LogLines(),!1;if(n=3,webphone_api.common.isNull(e)||e.length<1)return PutToDebugLog(1,"ERROR,transfer missing target number"),!1;n=4;var a=webphone_api.common.GetParameterInt("transfertype",-1);if(PutToDebugLog(2,"EVENT, WEBRTC: Transfer call to: "+e+"; type: "+a.toString()),n=5,1===a)return n=6,0!=i.transfer(e)?(PutToDebugLog(1,"ERROR, Transfer failed ("+a.toString()+")"),!1):(setTimeout(function(){PutToDebugLog(2,"EVENT, WEBRTC: exec Hangup on call Transfer"),SipHangup(!1,o)},1100),!0);if(a<0||6===a)return n=7,SipToggleHoldResume(!0,currline),n=12,setTimeout(function(){if(0!=i.transfer(e))return n=13,PutToDebugLog(1,"ERROR, Transfer failed ("+a.toString()+")"),PutToDebugLog(2,"EVENT, Transfer failed Unhold-Reload call"),SipToggleHoldResume(!1,o),!1},1100),!0;if(7===a)return n=8,0==i.transfer(e)||(PutToDebugLog(1,"ERROR, Transfer failed ("+a.toString()+")"),!1);if(8===a)return n=9,webphone_api.plhandler.MuteEx(!0),setTimeout(function(){n=11,webphone_api.conference(e,!0)},250),!0;n=10,SipToggleHoldResume(!0,o),n=14;var r=webphone_api.common.GetEndpoint(4287,o);n=15,webphone_api.common.isNull(r)||(webphone_api.common.isNull(r[EP_LINE])||r[EP_LINE]<1)&&(webphone_api.common.isNull(r[EP_CALLID])||r[EP_CALLID].length<1)?(n=16,PutToDebugLog(3,"WARNING,cannot find current ep-line for attended transfer"),setTimeout(function(){if(0!=i.transfer(e))return n=17,PutToDebugLog(1,"ERROR, Transfer failed ("+a.toString()+")"),PutToDebugLog(2,"EVENT, Transfer failed Unhold-Reload call"),SipToggleHoldResume(!1,currline),!1},1100)):(n=18,webphone_api.call(e),atransfer_line=r[EP_LINE],atransfer_callid=r[EP_CALLID],atransfer_number=e),n=19;var s=webphone_api.common.GetCallEpIdx(99,!1,o,destnr,callid);if(s>=0){n=20;var l=webphone_api.global.ep[s][17];if(!webphone_api.helper.isNull(l))return l}return n=21,setTimeout(function(){if(0!=i.transfer(e))return n=22,SipToggleHoldResume(!1,currline),PutToDebugLog(1,"ERROR, Transfer failed ("+a.toString()+")"),PutToDebugLog(2,"EVENT, Transfer failed Unhold-Reload call"),!1},1100),!0}catch(p){PutToDebugLogException(2,"webrtcapi: SipTransferEx oop: "+n,p)}return!1}function SipTransfer(e){try{var t=webphone_api.common.GetCallSession(8,!1,webphone_api.global.aline,e);if(!t)return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),webphone_api.common.LogLines(),!1;if(!webphone_api.common.isNull(e)&&e.length>0){var n=webphone_api.common.GetParameterInt("transfertype",-1);if(0!=t.transfer(e))return PutToDebugLog(1,"ERROR,Transfer failed."),!1;PutToDebugLog(2,"WRTC, EVENT, SipTransfer ("+n+"): "+e)}}catch(o){PutToDebugLogException(2,"webrtcapi: SipTransfer",o)}return!1}function SipToggleHoldResume(e,t){try{webphone_api.common.isNull(t)&&(t=webphone_api.global.aline);var n=webphone_api.common.GetCallSession(9,!1,t,"");if(n){"Firefox"===webphone_api.common.GetBrowser()&&webphone_api.global.firefoxholdcount++,e?PutToDebugLog(1,"EVENT,Hold"):PutToDebugLog(1,"EVENT,Reload");var o=-1;if(webphone_api.global.isholdresume=!0,webphone_api.global.holdresumecount++,PutToDebugLog(2,"EVENT, Webrtc hold exec: "+e+" "+SessionToString(n)),!0===e?(o=n.hold(),webphone_api.global.isresume=0):(webphone_api.global.isresume=webphone_api.common.GetTickCount(),o=n.resume()),0!=o){var i=webphone_api.common.GetCallSession(10,!1,t,"","",null,"0",n);i&&i!==n&&(PutToDebugLog(2,"EVENT, (warn) trying othersession "+SessionToString(i)),n=i,o=!0===e?n.hold():n.resume())}return!0!==e&&(webphone_api.common.isNull(lastmuste_mute)||!1!==lastmuste_mute||(PutToDebugLog(5,"webrtcapi: SipToggleHoldResume also unmute call, because user muted when was on hold"),SipToggleMute(lastmuste_mute,lastmuste_direction,lastmuste_line,lastmuste_log),lastmuste_mute=null,lastmuste_direction=null,lastmuste_line=null,lastmuste_log=null)),0!=o?(PutToDebugLog(1,"ERROR,Hold / Resume failed."),!1):(n.setHolded(e),!0)}return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),webphone_api.common.LogLines(),!1}catch(a){PutToDebugLogException(2,"webrtcapi: SipToggleHoldResume",a)}return!1}function SipMuteVideo(e,t){try{var n=!1,o=webphone_api.common.GetCallSession(11,!1,webphone_api.global.aline,"");if(!o)return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),webphone_api.common.LogLines(),!1;var i=!e;if((webphone_api.common.isNull(t)||!1===webphone_api.common.IsNumber(t))&&(t=0),t=webphone_api.common.StrToInt(t),(t<0||t>2)&&(t=0),0===t||1===t)if(null!=o.o_session)if(null!=o.o_session.o_stream_remote)if(o.o_session.o_stream_remote.getVideoTracks().length>0){for(var a=0;a<o.o_session.o_stream_remote.getVideoTracks().length;a++)PutToDebugLog(2,"EVENT, webrtcapi MuteVideo REMOTE Setting Video Tracks ["+a+"] to state = "+i.toString()+" "+SessionToString(o)),o.o_session.o_stream_remote.getVideoTracks()[a].enabled=i;o.o_session.o_stream_remote.getVideoTracks().length>0&&(n=!0)}else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session.o_stream_remote-> NO VIDEO TRACKS "+SessionToString(o));else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session.o_stream_remote is NULL "+SessionToString(o));else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session is NULL "+SessionToString(o));if(0===t||2===t)if(null!=o.o_session)if(null!=o.o_session.o_stream_local)if(o.o_session.o_stream_local.getVideoTracks().length>0){for(var a=0;a<o.o_session.o_stream_local.getVideoTracks().length;a++)PutToDebugLog(2,"EVENT, webrtcapi MuteVideo LOCAL Setting Video Tracks ["+a+"] to state = "+i.toString()+" "+SessionToString(o)),o.o_session.o_stream_local.getVideoTracks()[a].enabled=i;o.o_session.o_stream_local.getVideoTracks().length>0&&(n=!0)}else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session.o_stream_local-> NO VIDEO TRACKS "+SessionToString(o));else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session.o_stream_local is NULL "+SessionToString(o));else PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session is NULL "+SessionToString(o));return n}catch(r){PutToDebugLogException(2,"webrtcapi: SipMuteVideo",r)}return!1}function SessionToString(e){return webphone_api.common.isNull(e)?"NULL":"session line: "+e.getLine()+" id: "+e.getId()+" peer: "+e.getRemoteFriendlyName()}function MuteMic(e,t){try{if(t=!t,null===e)PutToDebugLog(2,"WARNING, webrtcapi MuteMic session is NULL");else if(null!=e.o_session)if(null!=e.o_session.o_stream_local)if(e.o_session.o_stream_local.getAudioTracks().length>0){for(var n=0;n<e.o_session.o_stream_local.getAudioTracks().length;n++)PutToDebugLog(2,"EVENT, webrtcapi MuteMic Setting Audio Tracks ["+n+"] to state = "+t.toString()+" "+SessionToString(e)),e.o_session.o_stream_local.getAudioTracks()[n].enabled=t;if(e.o_session.o_stream_local.getAudioTracks().length>0)return e.setMuted(2,!t),!0}else PutToDebugLog(2,"WARNING, webrtcapi MuteMic oSipSessionCall.o_session.o_stream_local-> NO AUDIO TRACKS "+SessionToString(e));else PutToDebugLog(2,"WARNING, webrtcapi MuteMic oSipSessionCall.o_session.o_stream_local is NULL "+SessionToString(e));else PutToDebugLog(2,"WARNING, webrtcapi MuteMic oSipSessionCall.o_session is NULL "+SessionToString(e))}catch(o){PutToDebugLogException(2,"webrtcapi: MuteMic",o)}return!1}function MuteSpeaker(e,t){try{if(t=!t,null===e)PutToDebugLog(2,"WARNING, webrtcapi MuteSpeaker session is NULL");else if(null!=e.o_session)if(null!=e.o_session.o_stream_remote)if(e.o_session.o_stream_remote.getAudioTracks().length>0){for(var n=0;n<e.o_session.o_stream_remote.getAudioTracks().length;n++)PutToDebugLog(2,"EVENT, webrtcapi MuteSpeaker Setting Audio Tracks ["+n+"] to state = "+t.toString()+" "+SessionToString(e)),e.o_session.o_stream_remote.getAudioTracks()[n].enabled=t;if(e.o_session.o_stream_remote.getAudioTracks().length>0)return e.setMuted(1,!t),!0}else PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session.o_stream_remote-> NO AUDIO TRACKS "+SessionToString(e));else PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session.o_stream_remote is NULL "+SessionToString(e));else PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session is NULL "+SessionToString(e))}catch(o){PutToDebugLogException(2,"webrtcapi: MuteSpeaker",o)}return!1}function SipToggleMute(e,t,n,o){try{webphone_api.common.isNull(n)&&(n=webphone_api.global.aline);var i=webphone_api.common.GetCallSession(12,!1,n,"");if(!i)return PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),webphone_api.common.LogLines(),!1;if(lastmuste_mute=e,lastmuste_direction=t,lastmuste_line=n,lastmuste_log=o,(webphone_api.common.isNull(t)||"0"!=t&&"1"!=t&&"2"!=t)&&(t="2"),"2"==t){var a=MuteMic(i,e);if(!1===a){var r=webphone_api.common.GetCallSession(13,!1,n,"","",null,"0",i);r&&r!==i&&(i=r,a=MuteMic(i,e))}return!1!==a||(!1!==o&&!1===webphone_api.isonhold()&&PutToDebugLog(1,"ERROR,Mute / Unmute failed."),!1)}if("1"==t){var a=MuteSpeaker(i,e);if(!1===a){var r=webphone_api.common.GetCallSession(14,!1,n,"","",null,"0",i);r&&r!==i&&(i=r,a=MuteSpeaker(i,e))}return!1!==a||(!1!==o&&!1===webphone_api.isonhold()&&PutToDebugLog(1,"ERROR,Mute / Unmute failed."),!1)}if("0"==t){var a=MuteMic(i,e),s=MuteSpeaker(i,e);if(!1===a||!1===s){var r=webphone_api.common.GetCallSession(15,!1,n,"","",null,"0",i);r&&r!==i&&(i=r,a=MuteMic(i,e),s=MuteSpeaker(i,e))}return!1!==a&&!1!==s||(!1!==o&&!1===webphone_api.isonhold()&&(PutToDebugLog(1,"ERROR,Mute / Unmute failed."),PutToDebugLog(2,"ERROR,Mute / Unmute failed state: "+e+"; ret: "+a+"; ret2: "+s)),!1)}return PutToDebugLog(1,"ERROR,Mute / Unmute failed."),PutToDebugLog(2,"ERROR,Mute / Unmute invalid direction: "+t),!1}catch(l){PutToDebugLogException(2,"webrtcapi: SipToggleMute",l)}return!1}function SipSendDTMF(e){try{var t=webphone_api.common.GetCallSession(16,!1,webphone_api.global.aline,"");if(webphone_api.common.isNull(e)||e.length<1)return;e=e.toString();var n=!1;if(0!==webphone_api.common.Trim(e).indexOf("*1*")&&0!==webphone_api.common.Trim(e).indexOf("*6*")||(n=!0),1===e.length)Dtmf(e,t,n);else{var o=e.substring(0,1);if(" "!==o&&Dtmf(o,t,n),e=e.substring(1),!webphone_api.common.isNull(e)&&e.length>0){var i=1;" "===e.substring(0,1)&&(i=1e3),setTimeout(function(){SipSendDTMF(e)},i)}}}catch(a){PutToDebugLogException(2,"webrtcapi: SipSendDTMF",a)}return!1}function Dtmf(e,t,n){try{return t&&e?(!0===n&&(webphone_api.global.isconfdtmf=!0),0==t.dtmf(e)?(PutToDebugLog(3,"EVENT, DTMFsent: "+e),!0):(PutToDebugLog(2,"WRTC, ERROR, webrtcapi Dtmf failed."),!1)):(PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_nocallinprogress")),webphone_api.common.LogLines(),!1)}catch(o){PutToDebugLogException(2,"webrtcapi: Dtmf",o)}}function PresenceSet(e){try{if(!1===isregistered)return void PutToDebugLog(2,"WARNING, webrtcapi cannot set presence, because not registered");if(webphone_api.common.isNull(mSipuri)||mSipuri.length<2)return void PutToDebugLog(2,"ERROR, webrtcapi PresenceSet invalid sipuri: "+mSipuri);if(webphone_api.common.isNull(e)||e.length<2)return void PutToDebugLog(2,"ERROR, webrtcapi PresenceSet invalid status: "+e);webphone_api.common.isNull(mDisplayname)&&(mDisplayname=""),publishSession=oSipStack.newSession("publish",{events_listener:{events:"*",listener:onSipEventSession}});PutToDebugLog(2,"EVENT, PresenceSet: "+e+"; for: "+mSipuri+"; displayname: "+mDisplayname);var t='<?xml version="1.0" encoding="UTF-8"?>\n<presence xmlns="urn:ietf:params:xml:ns:pidf"\n xmlns:im="urn:ietf:params:xml:ns:pidf:im" entity="'+mSipuri+'">\n<tuple id="s8794">\n<status>\n   <basic>'+e+"</basic>\n   <im:im>"+e+'</im:im>\n</status>\n<contact priority="0.8">tel:'+mDisplayname+'</contact>\n<note  xml:lang="en"></note>\n</tuple>\n</presence>';publishSession.publish(t,"application/pidf+xml",{sip_caps:[{name:"+g.oma.sip-im"},{name:"+sip.ice"}]})}catch(n){PutToDebugLogException(2,"webrtcapi: PresenceSet",n)}}function PresenceGet(e){try{if(webphone_api.common.isNull(e)||e.length<1)return;if(!1===isregistered&&pgmaxloop<15)return pgmaxloop++,void setTimeout(function(){PresenceGet(e)},1e3);pgmaxloop=0;var t=[];t.push({name:"Event",value:"presence"}),t.push({name:"Accept",value:"application/pidf+xml"});var n=e.split(",");if(n.length>60&&PutToDebugLog(2,"EVENT, PresenceGet skip for too lmany users"),PutToDebugLog(2,"EVENT, PresenceGet for: "+e),!webphone_api.common.isNull(n)&&n.length>0)for(var o=0;o<n.length&&!(o>maxnrofusers);o++)if(!(webphone_api.common.isNull(n[o])||n[o].length<1)){var i=n[o];PutToDebugLog(5,"EVENT, PresenceGet for user: "+i);var a=oSipStack.newSession("subscribe",{events_listener:{events:"*",listener:onSipEventSession},sip_headers:t,sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]});a.subscribe(i)}}catch(r){PutToDebugLogException(2,"webrtcapi: PresenceGet",r)}}function startRingTone(){try{if(webphone_api.common.isNull(ringtone)&&(ringtone=document.getElementById("ringtone")),webphone_api.common.isNull(ringtone))return void PutToDebugLog(2,"EVENT, webrtcapi: startRingTone is NULL");PutToDebugLog(5,"EVENT, webrtcapi: startRingTone play"),!0!==webphone_api.rt_loaded&&PutToDebugLog(2,"WARNING,webrtcapi: startRingTone cannot load media"),!0!==webphone_api.rt_canplay&&PutToDebugLog(2,"WARNING,webrtcapi: startRingTone cannot play through media"),ringtone.play?ringtone.play():(ringtone=document.getElementById("ringtone"),ringtone&&ringtone.play?ringtone.play():PutToDebugLog(2,"EVENT, webrtcapi: startRingTone play function is not available: "+ringtone.play))}catch(e){PutToDebugLogException(2,"webrtcapi: startRingTone",e)}}function stopRingTone(){try{if(webphone_api.common.isNull(ringtone)&&(ringtone=document.getElementById("ringtone")),webphone_api.common.isNull(ringtone))return void PutToDebugLog(2,"EVENT, webrtcapi: stopRingTone is NULL");!0!==webphone_api.rt_loaded&&PutToDebugLog(2,"ERROR,webrtcapi: stopRingTone cannot load media"),ringtone&&ringtone.pause?ringtone.pause():(ringtone=document.getElementById("ringtone"),ringtone&&ringtone.pause?ringtone.pause():PutToDebugLog(2,"EVENT, webrtcapi: stopRingTone pause function is not available: "+ringtone.pause))}catch(e){PutToDebugLogException(2,"webrtcapi: stopRingTone",e)}}function startRingbackTone(){try{if(webphone_api.common.isNull(ringbacktone)&&(ringbacktone=document.getElementById("ringbacktone")),webphone_api.common.isNull(ringbacktone))return void PutToDebugLog(2,"EVENT, webrtcapi: startRingbackTone is NULL");PutToDebugLog(4,"EVENT, webrtcapi: startRingbackTone play"),
!0!==webphone_api.rbt_loaded&&PutToDebugLog(2,"WARNING,webrtcapi: startRingbackTone cannot load media"),!0!==webphone_api.rbt_canplay&&PutToDebugLog(2,"WARNING,webrtcapi: startRingbackTone cannot play through media"),ringbacktone.play?ringbacktone.play():PutToDebugLog(2,"WARNING, webrtcapi: startRingbackTone play function is not available: "+ringbacktone.play)}catch(e){PutToDebugLogException(2,"webrtcapi: startRingbackTone",e)}}function stopRingbackTone(){try{if(webphone_api.common.isNull(ringbacktone)&&(ringbacktone=document.getElementById("ringbacktone")),webphone_api.common.isNull(ringbacktone))return void PutToDebugLog(2,"EVENT, webrtcapi: stopRingBackTone is NULL");!0!==webphone_api.rbt_loaded&&PutToDebugLog(2,"ERROR,webrtcapi: stopRingbackTone cannot load media"),ringbacktone&&ringbacktone.pause?ringbacktone.pause():PutToDebugLog(2,"EVENT, webrtcapi: stopRingbackTone pause function is not available: "+ringbacktone+" "+ringbacktone.pause)}catch(e){PutToDebugLogException(2,"webrtcapi: stopRingbackTone",e)}}function toggleFullScreen(){fullScreen(videoRemote.webkitSupportsFullscreen?!videoRemote.webkitDisplayingFullscreen:!0)}function fullScreen(e){function t(){try{document.exitFullscreen&&(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&document.exitFullscreen()}catch(e){PutToDebugLogException(2,"webrtcapi: ExitFullScreen",e)}}if(bFullScreen=e,void 0!==videoRemote&&null!==videoRemote)if(webphone_api.webrtcstack.tsk_utils_have_webrtc4native()&&bFullScreen&&videoRemote.webkitSupportsFullscreen){if(webphone_api.common.isNull(videoRemote))return!1;bFullScreen?videoRemote.webkitEnterFullScreen():videoRemote.webkitExitFullscreen()}else videoRemote.requestFullscreen?bFullScreen?videoRemote.requestFullscreen():t():videoRemote.mozRequestFullScreen?bFullScreen?videoRemote.mozRequestFullScreen():t():videoRemote.webkitRequestFullscreen&&(bFullScreen?videoRemote.webkitRequestFullscreen():t());else if(webphone_api.webrtcstack.tsk_utils_have_webrtc4npapi())try{window.__o_display_remote&&window.__o_display_remote.setFullScreen(e)}catch(n){webphone_api.common.isNull(divVideo)||divVideo.setAttribute("class",e?"full-screen":"normal-screen")}else webphone_api.common.isNull(divVideo)||divVideo.setAttribute("class",e?"full-screen":"normal-screen")}function showNotifICall(e){window.webkitNotifications&&0==window.webkitNotifications.checkPermission()&&(oNotifICall&&oNotifICall.cancel(),oNotifICall=window.webkitNotifications.createNotification(webphone_api.common.GetElementSource()+"images/sipml-34x39.png","Incaming call","Incoming call from "+e),oNotifICall.onclose=function(){oNotifICall=null},oNotifICall.show())}function onKeyUp(e){e=e||window.event,27==e.keyCode?fullScreen(!1):e.ctrlKey&&e.shiftKey&&(65!=e.keyCode&&86!=e.keyCode||(bDisableVideo=65==e.keyCode,txtCallStatus.innerHTML="<i>Video "+(bDisableVideo?"disabled":"enabled")+"</i>",window.localStorage.setItem("org.doubango.expert.disable_video",bDisableVideo)))}function onDivCallCtrlMouseMove(e){try{webphone_api.webrtcstack.tsk_utils_have_stream()&&(btnCall.disabled=!webphone_api.webrtcstack.tsk_utils_have_stream()||!oSipSessionRegister||!oSipSessionRegister.is_connected(),document.getElementById("divCallCtrl").onmousemove=null)}catch(t){}}function uiOnConnectionEvent(e,t){}function uiVideoDisplayEvent(e,t){if(!1===webphone_api.common.CanIUseVideo())return void PutToDebugLog(5,"EVENT, uiDisplayEvent ret");if(webphone_api.common.isNull(videoRemote))return void PutToDebugLog(2,"EVENT, webrtcapi uiVideoDisplayEvent videoRemote is NULL");var n=e?videoLocal:videoRemote;t?(n.style.opacity=1,uiVideoDisplayShowHide(!0)):(n.style.opacity=0,fullScreen(!1))}function uiVideoDisplayShowHide(e){webphone_api.common.isNull(divVideo)||(e?(divVideo.style.height="Microsoft Internet Explorer"==navigator.appName?"100%":"340px",webphone_api.$("#contact_details").hide(),webphone_api.$("#video_container").show(),1===webphone_api.common.GetParameterInt("softphonevideomode",0)&&webphone_api.$("#div_video_fullscreen_button").hide(),PutToDebugLog(2,"EVENT, webrtcapi uiVideoDisplayShowHide video container displayed")):(divVideo.style.height="0px",webphone_api.$("#contact_details").show(),webphone_api.$("#video_container").hide()))}function uiBtnCallSetText(e){switch(e){case"Call":var t=window.localStorage&&"true"==window.localStorage.getItem("org.doubango.expert.disable_callbtn_options");btnCall.value=btnCall.innerHTML=t?"Call":'Call <span id="spanCaret" class="caret">',btnCall.setAttribute("class",t?"btn btn-primary":"btn btn-primary dropdown-toggle"),btnCall.onclick=t?function(){sipCall(bDisableVideo?"call-audio":"call-audiovideo")}:null,ulCallOptions.style.visibility=t?"hidden":"visible",t||ulCallOptions.parentNode==divBtnCallGroup?t&&ulCallOptions.parentNode==divBtnCallGroup&&document.body.appendChild(ulCallOptions):divBtnCallGroup.appendChild(ulCallOptions);break;default:btnCall.value=btnCall.innerHTML=e,btnCall.setAttribute("class","btn btn-primary"),btnCall.onclick=function(){sipCall(bDisableVideo?"call-audio":"call-audiovideo")},ulCallOptions.style.visibility="hidden",ulCallOptions.parentNode==divBtnCallGroup&&document.body.appendChild(ulCallOptions)}}function uiCallTerminated(e,t){webphone_api.global.restartice_time=0,oSipSessionCall=null,stopRingbackTone(),stopRingTone(),uiVideoDisplayShowHide(!1),oNotifICall&&(oNotifICall.cancel(),oNotifICall=null),uiVideoDisplayEvent(!1,!1),uiVideoDisplayEvent(!0,!1);var n=webphone_api.global.aline;void 0!==t&&null!==t&&webphone_api.common.IsNumber(t)&&webphone_api.common.StrToIntDef(t,-5)>0&&(n=t),PutToDebugLog(1,"STATUS,-1,"+e),"Call Finished"===e&&PutToDebugLog(1,"STATUS,"+n.toString()+",Finished")}function GetRegisterivalWebRTC(){try{var e=webphone_api.common.GetParameter2("registerinterval");return(webphone_api.common.isNull(e)||e.length<1||!webphone_api.common.IsNumber(e))&&(e=0),e<5&&(e=webphone_api.common.GetConfigInt("registerinterval",0)),e<5&&(e=200),-1==webphone_api.global.recwsload&&(webphone_api.global.recwsload=webphone_api.common.GetParameter("lastrecwsload",-2)),webphone_api.global.recwsload>1&&e<400&&(e=600),e}catch(t){PutToDebugLogException(2,"webrtcapi: GetRegisterivalWebRTC",t)}return 200}function TerminateRegexTimer(){webphone_api.common.isNull(regextimer)||clearInterval(regextimer),regextimer=null,regex_idx=0}function RegisterEx(e){try{if(webphone_api.common.isNull(e)||e.length<5)return;var t=null;if(t=e.indexOf("#")>0?e.split("#"):e.split(";"),webphone_api.common.isNull(t)||t.length<1)return;TerminateRegexTimer();var n=0;regextimer=setInterval(function(){if(++n>25)return void TerminateRegexTimer();if(webphone_api.common.isNull(t)||t.length<1)return void TerminateRegexTimer();var e=t.shift();if(!webphone_api.common.isNull(e)){var o=e.split(",");webphone_api.common.isNull(o)||o.length<3||(webphone_api.common.isNull(lw_namespace_arr)&&(lw_namespace_arr=[]),webphone_api.common.isNull(lw_account_arr)&&(lw_account_arr=[]),lw_namespace_arr.push("webrtcstack"+regex_idx),lw_account_arr.push(o),LoadWebrtc(function(e,t,n){},"webrtcstack"+regex_idx,o),regex_idx++)}},1500)}catch(o){PutToDebugLogException(2,"webrtcapi: RegisterEx sipuri: "+sipuri+"; password: "+password,o)}}function LoadWebrtcCb(avail,namespc,oneacc){function onSEventStack(e){function t(t){PutToDebugLog(5,"EVENT, ExSessionEvent_"+username+": "+e.type+", "+e.description)}try{if(PutToDebugLog(5,"EVENT, ExStackEvent_"+username+": "+e.type+", "+e.description),"started"===e.type){if(!0===webphone_api.common.NeedRegister()){var n=200;!webphone_api.common.isNull(aival)&&webphone_api.common.IsNumber(aival)&&(n=aival);var o=this.newSession("register",{expires:n,events_listener:{events:"*",listener:t},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]});o.register()}}else"starting"===e.type&&"terminating"===e.type&&"terminated"===e.type||onSipEventStack(e)}catch(i){PutToDebugLogException(2,"webrtcapi: ExEventStack_"+username,i)}}try{if(PutToDebugLog(2,"EVENT, webrtcapi: LoadWebrtc extrareg returned: "+avail+"; namespace: "+namespc),webphone_api.common.isNull(namespc))return void PutToDebugLog(2,"ERROR, webrtcapi: LoadWebrtc extrareg namespace is NULL");if(webphone_api.common.isNull(oneacc)||oneacc.length<3)return void PutToDebugLog(2,"ERROR, webrtcapi: LoadWebrtc extrareg account is NULL");PutToDebugLog(2,"EVENT, RegisterEx ("+i+"): "+oneacc.toString());var asrv=oneacc[0],ausr=oneacc[1],apwd=oneacc[2],aival=webphone_api.common.GetParameterInt("registerinterval",180);oneacc.length>3&&!webphone_api.common.isNull(oneacc[3])&&oneacc[3].length>0&&webphone_api.common.IsNumber(oneacc[3])&&(aival=webphone_api.common.StrToInt(oneacc[3]));var callerid="",displayname="",proxy="",realm="";if(oneacc.length>4&&!webphone_api.common.isNull(oneacc[4])&&oneacc[4].length>0&&(callerid=oneacc[4]),oneacc.length>5&&!webphone_api.common.isNull(oneacc[5])&&oneacc[5].length>0&&(displayname=oneacc[5]),oneacc.length>6&&!webphone_api.common.isNull(oneacc[6])&&oneacc[6].length>0&&(proxy=oneacc[6]),oneacc.length>7&&!webphone_api.common.isNull(oneacc[7])&&oneacc[7].length>0&&(realm=oneacc[7]),webphone_api.common.isNull(ausr)||ausr.length<1||webphone_api.common.isNull(apwd)||apwd.length<1||webphone_api.common.isNull(aival)||aival.length<1)return void PutToDebugLog(2,"ERROR, RegisterEx invalid account");var username=ausr,password=apwd;(webphone_api.common.isNull(callerid)||callerid.length<0)&&(callerid=ausr),(webphone_api.common.isNull(displayname)||displayname.length<0)&&(displayname=ausr);var udpaddr=asrv;(webphone_api.common.isNull(udpaddr)||udpaddr.length<1)&&(udpaddr=webphone_api.common.GetUDPServerAddress());var wsaddr=webphone_api.common.GetWebrtcSrvAddr();if(2===webphone_api.common.GetConfigInt("usemizuwebrtcgateway",1)&&(wsaddr=""),webphone_api.common.isNull(wsaddr)||wsaddr.length<2){wsaddr=webphone_api.common.GetWp();var wstmp=wsaddr;wstmp.indexOf("//")>=0&&(wstmp=wstmp.substring(wstmp.indexOf("//")+2,wstmp.length)),wstmp.indexOf(":")>0&&(wstmp=wstmp.substring(0,wstmp.indexOf(":")))}else wsaddr=webphone_api.common.Trim(wsaddr.toLowerCase());wsaddr=wsaddr.replace("*",""),wsaddr=wsaddr.toLowerCase(),wsaddr=wsaddr.replace("udp://",""),wsaddr=wsaddr.replace("tcp://",""),wsaddr=wsaddr.replace("http://",""),wsaddr=wsaddr.replace("https://","");var sipaddress=udpaddr;sipaddress.indexOf("udp:")<0&&(sipaddress="udp://"+sipaddress);var proxyaddress=sipaddress,wsaddress=wsaddr;wsaddress.indexOf("ws:")<0&&wsaddress.indexOf("wss:")<0&&(wsaddress="ws://"+wsaddress);var hostmp=location.host.toLowerCase();!1!==webphone_api.common.IsIPAddrress(wsaddress)&&!0!==webphone_api.common.BrowserRequiresHttps(!0)||(wsaddress=wsaddress.replace("ws:","wss:"));var publicsipaddress=webphone_api.common.GetConfig("publicsipaddress");webphone_api.common.isNull(publicsipaddress)&&(publicsipaddress=""),(webphone_api.common.isNull(realm)||realm.length<1)&&(realm=udpaddr,realm=webphone_api.common.NormalizeInput(realm,0),realm.indexOf(":")>0&&(realm=realm.substring(0,realm.indexOf(":"))),realm=webphone_api.common.Trim(realm));var sipuri=username;sipuri.indexOf("sip:")<0&&(sipuri="sip:"+username),sipuri.indexOf("@")<0&&(sipuri=sipuri+"@"+realm);var enableRTCWebBreaker=!0;enableRTCWebBreaker=!(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker)&&0===webphone_api.parameters.rtcbreaker)&&(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker)&&1===webphone_api.parameters.rtcbreaker||!webphone_api.common.IsMizuServerOrGateway());var organization=webphone_api.common.GetConfig("companyname");(webphone_api.common.isNull(organization)||organization.length<1)&&(organization=webphone_api.common.GetConfig("brandname"),(webphone_api.common.isNull(organization)||organization.length<1)&&(organization="Mizutech"));var ua=webphone_api.common.GetUA();webphone_api.common.GetParameter("useragent").length>0&&!1===webphone_api.common.IsMizuPublicWebRTCGateway()&&(ua=webphone_api.common.GetParameter("useragent"));var sheaders=[{name:"User-Agent",value:ua},{name:"Organization",value:organization},{name:"X-Webdomain",value:webphone_api.common.GetWebdomain()}],xhval="1";!0===webphone_api.common.Hasesw()?xhval="2":!0===webphone_api.common.Us()&&(xhval="0"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-LS",sipheaders[sipheaders.length-1].value=xhval;var company=webphone_api.common.GetParameter("companyname");!webphone_api.common.isNull(company)&&company.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Company",sheaders[sheaders.length-1].value=company);var brand=webphone_api.common.GetParameter("brandname");!webphone_api.common.isNull(brand)&&brand.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Brand",sheaders[sheaders.length-1].value=brand);var uppsrv=webphone_api.common.GetWebrtcSyUpperHeader("RegisterEx");uppsrv.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Sy.Uppersrv",sheaders[sheaders.length-1].value=uppsrv);var uppsrvd=webphone_api.common.GetWebrtcSyUpperDomainHeader("RegisterEx");uppsrvd.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Sy.Uppersrvd",sheaders[sheaders.length-1].value=uppsrvd);var dtmfmode=webphone_api.common.GetParameterInt("dtmfmode",2);4==dtmfmode&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-MFlag",sheaders[sheaders.length-1].value="2");var p2psignaling=webphone_api.common.GetParameterInt("p2psignaling",1);if(1!==p2psignaling){var valTmp="no";2===p2psignaling?valTmp="proxy":2===p2psignaling&&(valTmp="process"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-P2P",sipheaders[sipheaders.length-1].value=valTmp}sheaders=RemoveDuplicateHeader(sheaders),(webphone_api.common.isNull(username)||username.length<1)&&PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid username: "+username),(webphone_api.common.isNull(password)||password.length<1)&&PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid password: "+password),(webphone_api.common.isNull(sipuri)||sipuri.length<2||sipuri.indexOf("@")<1||sipuri.indexOf(".")<1)&&PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid sipuri: "+sipuri);var stun_turn=[],stun=webphone_api.common.GetStunServersStr(),turn=webphone_api.common.GetTurnSrv();if(!webphone_api.common.isNull(stun)&&stun.length>2){var sarr=stun.split(","),useurls=!1;if(("Chrome"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>40||"Firefox"===webphone_api.common.GetBrowser()&&webphone_api.common.GetBrowserVersion()>40)&&(useurls=!0),!webphone_api.common.isNull(sarr))for(var i=0;i<sarr.length;i++)if(!(webphone_api.common.isNull(sarr[i])||sarr[i].length<1))if(!0===useurls){var obj={urls:sarr[i]};stun_turn.push(obj)}else{var obj={url:sarr[i]};stun_turn.push(obj)}}if(webphone_api.common.isNull(turn)||webphone_api.common.IsLocalServer()||stun_turn.push(turn),PutToDebugLog(3,"Webrtc RegisterEx connection details:"),PutToDebugLog(3,"RegisterEx username: "+username),ldebug?PutToDebugLog(3,"RegisterEx password: "+password):!webphone_api.common.isNull(password)&&password.length>0?PutToDebugLog(3,"RegisterEx password: *"):PutToDebugLog(3,"RegisterEx password: null"),PutToDebugLog(3,"RegisterEx sipuri: "+sipuri),PutToDebugLog(3,"RegisterEx displayname: "+displayname),PutToDebugLog(3,"RegisterEx wsaddress: "+wsaddress),PutToDebugLog(3,"RegisterEx proxyaddress: "+proxyaddress),PutToDebugLog(3,"RegisterEx realm: "+realm),(webphone_api.common.isNull(webphone_api.global.usuk)||webphone_api.global.usuk.length<1)&&(webphone_api.common.IsUKGateway(wsaddress)?(PutToDebugLog(2,"WARNING, RegisterEx webrtcapi Start manually setting UK gateway, because DecideUsUk has not yet finished"),webphone_api.global.usuk="uk"):webphone_api.common.IsUSGateway(wsaddress)&&(PutToDebugLog(2,"WARNING, RegisterEx webrtcapi Start manually setting US gateway, because DecideUsUk has not yet finished"),webphone_api.global.usuk="us")),!webphone_api.common.isNull(stun_turn)&&stun_turn.length>0){for(var i=0;i<stun_turn.length;i++)if(!webphone_api.common.isNull(stun_turn[i])){var sobj=stun_turn[i];for(var key in sobj){var msgtmp="RegisterEx turn server";!webphone_api.common.isNull(sobj[key])&&sobj[key].toString().indexOf("stun")>=0&&(msgtmp="RegisterEx stun server"),PutToDebugLog(3,msgtmp+"["+i+"]: "+key+": "+sobj[key])}}}else PutToDebugLog(3,"RegisterEx stun server: NOT set");var iceobj=null,icestr=webphone_api.common.GetParameter("ice");if(!webphone_api.common.isNull(icestr)&&icestr.length>0)try{iceobj=eval(icestr)}catch(eice){iceobj=null,PutToDebugLogException(2,"ERROR, RegisterEx webrtcapi parse ICE servers",eice)}if(!webphone_api.common.isNull(iceobj)){try{PutToDebugLog(2,"EVENT, RegisterEx webrtcapi found ICE (STUN/TURN) server: "+JSON.stringify(iceobj))}catch(eice2){}stun_turn=iceobj}var earlymediaint=webphone_api.common.GetParameterInt("earlymedia",2),earlymedia=!0;earlymediaint<1&&(earlymedia=!1);var sStack=new webphone_api[namespc].SIPml.Stack({realm:realm,impi:username,impu:sipuri,password:password,display_name:displayname,websocket_proxy_url:wsaddress,outbound_proxy_url:proxyaddress,ice_servers:stun_turn,enable_rtcweb_breaker:enableRTCWebBreaker,events_listener:{events:"*",listener:onSEventStack},enable_early_ims:earlymedia,enable_media_stream_cache:!0,bandwidth:null,video_size:null,sip_headers:sheaders});webphone_api.common.isNull(registerExSipstackArray)&&(registerExSipstackArray=[]),0!=sStack.start()?PutToDebugLog(2,"ERROR, webrtcapi: RegisterEx, Failed to start SIP stack sipuri: "+sipuri+"; password: "+password):registerExSipstackArray.push(sStack)}catch(err){PutToDebugLogException(2,"webrtcapi: LoadWebrtcCb",err)}}function ResendRegister(){try{oSipSessionRegister&&oSipSessionRegister.register?(PutToDebugLog(2,"EVENT, ResendRegister resending..."),sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}),oSipSessionRegister.register()):PutToDebugLog(2,"ERROR, ResendRegister failed, invalid register session"),webphone_api.common.isNull(check_reg_timer)||clearTimeout(check_reg_timer),check_reg_timer=null,check_reg_timer=setTimeout(function(){try{if(webphone_api.common.GetTickCount()-webphone_api.global.webrtclastregsent>3e3){if(PutToDebugLog(2,"WARNING, ResendRegister: restart SipStack, because REGISTER was not resent"),!0===webphone_api.isincall())return void PutToDebugLog(2,"WARNING, ResendRegister: skip SipStack restart, because a call is in progress");ReStart(1,!0)}}catch(e){PutToDebugLogException(2,"webrtcapi: ResendRegister inner timer",e)}},2900)}catch(e){PutToDebugLogException(2,"webrtcapi: ResendRegister",e)}}function GetSIPCallIDFromEvent(e){var t="";try{if(webphone_api.common.isNull(e))return t;var n="recv=\n"+e.o_event.o_message;if(webphone_api.common.isNull(n)||n.length<8)return t;t=webphone_api.common.StrGetBetween(n,"\nCall-ID:","\r").trim(),t.length<3&&(t=webphone_api.common.StrGetBetween(n,"\nXCall-ID:","\r").trim(),t.length<4&&(t=webphone_api.common.StrGetBetween(n,"\nX-Call-ID:","\r").trim()),t.length<4&&(t=webphone_api.common.StrGetBetween(n,"\nX-C-Call-ID:","\r").trim()),t.length<4&&(t=webphone_api.common.StrGetBetween(n,"\ni:","\r").trim()),t.length<4&&(t=webphone_api.common.StrGetBetween(n,"Call-ID:","\r").trim()),t.length<1&&(t=webphone_api.common.StrGetBetween(n,"\nCall-ID:","\r").trim()),t.length<1&&(t=webphone_api.common.StrGetBetween(n,"\nXCall-ID:","\r").trim()),t.length<1&&(t=webphone_api.common.StrGetBetween(n,"\nX-Call-ID:","\r").trim()),t.length<1&&(t=webphone_api.common.StrGetBetween(n,"\nX-C-Call-ID:","\r").trim()),t.length<1&&(t=webphone_api.common.StrGetBetween(n,"\ni:","\r").trim()),t.length<1&&(t=webphone_api.common.StrGetBetween(n,"Call-ID:","\r").trim()))}catch(o){}return t}function StartReRegister(e){try{if(webphone_api.common.GetParameterInt("forcereregister",1)<1)return;if(!0===e&&!0===reregstarted)return;if(webphone_api.global.phonestarted<1)return void(reregstarted=!1);reregstarted=!0,webphone_api.common.isNull(rereg_timer)||clearTimeout(rereg_timer),rereg_timer=null,rereg_timer=setTimeout(function(){if(webphone_api.global.phonestarted<1)return webphone_api.common.isNull(rereg_timer)||clearTimeout(rereg_timer),rereg_timer=null,reregstarted=!1,rereg_ival=1e4,void(webphone_api.global.webrtc_regstate=-1);if(1===webphone_api.global.webrtc_regstate)return void StartReRegister(!1);if(0===webphone_api.global.webrtc_regstate){rereg_ival<12e4?rereg_ival*=2:rereg_ival=1e4;var e=webphone_api.common.GetParameterInt("forcereregister",1);0===rereg_action&&oSipSessionRegister&&oSipSessionRegister.register?(PutToDebugLog(2,"ERROR, ReRegister new session (forcereregister: "+e.toString()+")"),rereg_action=1,ResendRegister()):(PutToDebugLog(2,"ERROR, ReRegister restart SipStack (forcereregister: "+e.toString()+")"),rereg_action=0,ReStart(1,!0)),StartReRegister(!1)}},rereg_ival)}catch(t){PutToDebugLogException(2,"webrtcapi: StartReRegister",t)}}function onSipEventStack(e){switch(webphone_api.global.isdebugversionwebrtc&&console.log("WRTCEVENT_STACK: "+e.type+", "+e.description),PutToDebugLog(2,"==stack event = "+e.type),e.type){case"started":webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),webphone_api.common.SaveParameter("lastsessionsuccess","2");try{!0===webphone_api.common.NeedRegister()?(oSipSessionRegister=this.newSession("register",{expires:GetRegisterivalWebRTC(),events_listener:{events:"*",listener:onSipEventSession},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]}),oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders})),oSipSessionRegister.register()):PutToDebugLog(1,"STATUS,-1,Ready.")}catch(e){PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack register")}break;case"stopping":case"stopped":case"failed_to_start":case"failed_to_stop":"failed_to_start"==e.type||e.type;oSipStack=null,oSipSessionRegister=null,oSipSessionCall=null,uiOnConnectionEvent(!1,!1),stopRingbackTone(),stopRingTone(),uiVideoDisplayShowHide(!1),"failed_to_start"==e.type?(PutToDebugLog(1,"ERROR,-1,Register failed"),PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack failed_to_start"),webphone_api.common.CheckInternetConnection(),webphone_api.common.CheckInternetConnectionWS(),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!1),webphone_api.onRegStateChangeCb("failed","WebRTC failed to start"),ReStart()):"failed_to_stop"==e.type?(PutToDebugLog(1,"ERROR,-1,UnRegister failed"),PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack failed_to_stop")):"stopping"==e.type?PutToDebugLog(2,"EVENT, WebRTC sipstack stopping"):"stopped"==e.type&&(PutToDebugLog(2,"EVENT, WebRTC sipstack stopped"),webphone_api.common.CheckInternetConnection(),webphone_api.common.CheckInternetConnectionWS(),webphone_api.global.webrtcsipsignalingreceived=0,ReStart()),webphone_api.global.webrtc_regstate=0;break;case"i_new_call":if(webphone_api.common.RemoveSipHeadreFromCache("X-reason"),webphone_api.common.RemoveSipHeadreFromCache("Reason"),webphone_api.common.RemoveSipHeadreFromCache("Warning"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),!0===webphone_api.global.dontSendSignaling&&webphone_api.global.dontSendSignalingTimer>0&&webphone_api.common.GetTickCount()-webphone_api.global.dontSendSignalingTimer<200)return e.newSession.hangup(),void PutToDebugLog(2,"WARNING, webrtcapi, API_Hangup call because retring with optimized SDP");if(!webphone_api.common.onc()){var t=[];t.push("h"),t.push("a"),t.push("n"),t.push("g"),t.push("u"),t.push("p"),t.push(" "),t.push("5"),t.push(" ");return PutToDebugLog(2,"EVENT, "+t.join("")),SipHangup(!0,-2),void e.newSession.hangup()}if(webphone_api.common.SaveParameter("lastsessionsuccess","2"),!0===webphone_api.common.UsePresence2()&&"dnd"===webphone_api.common.GetParameter("presencestatus").toLowerCase())return PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, because presence is DND"),e.newSession.hangup(),setTimeout(function(){SendRegisteredStatus()},500),setTimeout(function(){SendRegisteredStatus()},1e3),void(webphone_api.global.webrtc_regstate=1);if(webphone_api.common.GetNrOfActiveCalls()>0){var n="";if(oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),webphone_api.common.isNull(n)&&(n=""),n=webphone_api.common.Trim(n),n.length>0&&n===webphone_api.global.currcallnumber){var o=webphone_api.common.GetParameterInt("dropsameoldcall",0);if(1===o){var i=webphone_api.common.GetSipHeaderInternal("X-Autorecall");webphone_api.common.isNull(i)&&(i=""),i=webphone_api.common.Trim(i),i=i.toLowerCase(),"yes"===i&&(PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(1) from: "+n),e.newSession.hangup())}else if(2===o){var i=webphone_api.common.GetSipHeaderInternal("X-Autorecall");webphone_api.common.isNull(i)&&(i=""),i=webphone_api.common.Trim(i),i=i.toLowerCase(),!0===webphone_api.global.isvideocall&&"yes"===i&&(PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(2) from: "+n),e.newSession.hangup())}else 3===o&&(PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(3) from: "+n),e.newSession.hangup())}}var a=webphone_api.common.GetNrOfActiveCalls(),r=webphone_api.common.GetParameter2("rejectonbusy");if(webphone_api.common.CanLog(5)&&PutToDebugLog(5,"EVENT, handle webrtc incoming call. cc: "+a.toString()+", rb: "+r+", ml: "+webphone_api.common.IsMultiline().toString()+" "+webphone_api.common.GetParameter2("multilinegui")+", ln: "+webphone_api.global.aline.toString()),a>0&&("true"===r||"1"===r)){PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, because rejectonbusy is: "+r),e.newSession.hangup();var n="";oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),webphone_api.common.isNull(n)&&(n=""),"undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications?webphone_api.notifications.AddToCallLog(n,"2","recfile",0,webphone_api.global.aline,"Rejected busy"):console&&console.log&&console.log("ERROR, webrtcapi onSipEventStack webphone_api.notifications is not defined")}else if(a>0&&1!==webphone_api.common.IsMultiline())webphone_api.common.CanLog(5)&&PutToDebugLog(5,"EVENT, not multiline and call already in progress");else{if(a>0){var s=webphone_api.common.GetFreeLine();webphone_api.common.SetALineInternal(s,20),webphone_api.common.CanLog(5)&&PutToDebugLog(5,"EVENT, there are previous calls in progress. using line: "+s.toString()+"/"+webphone_api.global.aline.toString())}else webphone_api.common.CanLog(5)&&PutToDebugLog(5,"EVENT, no previous calls. using line: "+webphone_api.global.aline.toString());var l=webphone_api.global.aline;webphone_api.global.restartice_time=webphone_api.common.GetTickCount(),oSipSessionCall=e.newSession,SetSipHeader(1),oSipSessionCall.setConfiguration(HandleOconfigCall(oConfigCall,l)),startRingTone();var n="";oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),showNotifICall(n);var p=l.toString(),c=webphone_api.common.StrToInt(p);c<1&&(l=webphone_api.common.GetFreeLine(),webphone_api.common.SetALineInternal(l,21));var u=null;oSipSessionCall.o_session&&oSipSessionCall.o_session&&oSipSessionCall.o_session.o_stack&&oSipSessionCall.o_session.o_stack.ao_headers&&oSipSessionCall.o_session.o_stack.ao_headers.length>0&&(u=oSipSessionCall.o_session.o_stack.ao_headers);var h="";try{h="recv=\n"+e.o_event.o_message}catch(N){PutToDebugLogException(2,"webrtcapi: onSipEventStack i_new_call getmsg",N)}var g=GetSIPCallIDFromEvent(e);webphone_api.common.SaveCallSession(3,l,oSipSessionCall,n,"2",webphone_api.common.GetTickCount(),-1,-1,"",g,"true","",u,"","","",oSipSessionCall.getId());try{webphone_api.common.CatchWebrtcSignaling(h,webphone_api.common.SIP_REGISTER)}catch(N){PutToDebugLogException(2,"webrtcapi: onSipEventStack i_new_call CatchWebrtcSignaling",N)}var m=webphone_api.common.GetEndpoint(106,-1,n,g,oSipSessionCall.getId(),!1);!webphone_api.common.isNull(m)&&!webphone_api.common.isNull(m[webphone_api.common.EP_CALLID])&&m[webphone_api.common.EP_CALLID].length>0&&(g=m[webphone_api.common.EP_CALLID]),PutToDebugLog(1,"STATUS,"+l.toString()+",CallSetup,"+n+","+webphone_api.common.GetSipusername()+",2,"+n+",["+g+"],,,,,"),1===webphone_api.common.GetApibehaviour()&&PutToDebugLog(1,"STATUS,-1,Ringing..."),webphone_api.common.SetALineInternal(l,22),PutToDebugLog(1,"STATUS,"+l.toString()+",Ringing,"+n+","+webphone_api.common.GetSipusername()+",2,"+n+",["+g+"],,,,,"),PutToDebugLog(1,"STATUS,-1,Incoming..."),webphone_api.common.SetALineInternal(l,23),istypeincoming=!0;var d=webphone_api.common.GetParameter2("autoignore");(webphone_api.common.isNull(d)||1!==d.length)&&(d="0");var b=webphone_api.common.StrToInt(d);if(b>1?(PutToDebugLog(3,"EVENT, autoignore WebRTC hangup(reject)"),SipHangup(!0,l)):1===b&&(PutToDebugLog(3,"EVENT, autoignore WebRTC silent ignore"),stopRingTone()),!0===webphone_api.common.GetParameterBool("autoaccept",!1)||3===webphone_api.common.GetParameterInt("enableautoaccept",1)){var _=webphone_api.common.GetParameterInt("beeponconnect",0);1!==_&&2!==_&&4!==_||webphone_api.common.Beep("1"),PutToDebugLog(3,"EVENT, autoaccept WebRTC accept"),SipAccept(l,!1)}var f=webphone_api.common.GetParameter2("calltransferalways");!webphone_api.common.isNull(f)&&f.length>1&&(PutToDebugLog(3,"EVENT, call transfer WebRTC calltransferalways: "+f),SipTransferEx(f));var w=webphone_api.common.GetParameter2("callforwardonbusy");!webphone_api.common.isNull(w)&&w.length>1&&Forward(w);var v=webphone_api.common.GetParameter2("callforwardalways");!webphone_api.common.isNull(v)&&v.length>1&&Forward(v)}break;case"i_new_message":webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),webphone_api.common.SaveParameter("lastsessionsuccess","2"),e.newSession.accept();var P=e.newSession.getRemoteFriendlyName(),t=e.getContentString();if(webphone_api.common.isNull(P)||P.length<1)return void PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack chat received, from is NULL");if(webphone_api.common.isNull(t)||t.length<1)return void PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack chat received, from: "+P+"; message is NULL");PutToDebugLog(1,"CHAT,-1,"+P+","+t);break;case"m_permission_requested":PutToDebugLog(5,"EVENT, webrtcapi: permission requested"),webphone_api.global.lastpermreq=webphone_api.common.GetTickCount(),last_event=webphone_api.global.last_event,webphone_api.common.GetNrOfActiveCalls()<1&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Waiting for permission"),setTimeout(function(){!1===webphone_api.global.webrtcpermissionaccepted&&(PutToDebugLog(5,"EVENT, webrtcapi: no permission yet on request"),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Waiting for permission"))},3500);break;case"m_permission_accepted":if(PutToDebugLog(5,"EVENT, webrtcapi: MediaStream permission granted"),!webphone_api.common.isNull(last_event)&&last_event.length>0&&PutToDebugLog(1,"EVENT,"+last_event),webphone_api.global.webrtcpermissionaccepted=!0,RedialOnFail(),!0===webphone_api.global.incommingCall){var E=webphone_api.common.GetTickCount(),T=webphone_api.common.GetParameterInt("acceptcall_onsharedevice",1);2===T?(PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_1"),SipAccept(webphone_api.global.aline)):1===T&&("Firefox"===webphone_api.common.GetBrowser()&&!1===webphone_api.common.IsHttps()&&webphone_api.common.GetBrowserVersion()<75?(PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_2"),SipAccept(webphone_api.global.aline)):"Chrome"===webphone_api.common.GetBrowser()&&!0===webphone_api.common.IsLocalFileSystem()?(PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_3"),
SipAccept(webphone_api.global.aline)):webphone_api.global.lastpermreq>0&&E-webphone_api.global.lastpermreq>8e3&&(PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_4"),SipAccept(webphone_api.global.aline)))}break;case"m_permission_refused":if("m_permission_refused"==e.type){if(webphone_api.global.webrtcpermissionaccepted=!1,PutToDebugLog(5,"EVENT, webrtcapi: MediaStream permission denied"),uiCallTerminated("Media stream permission denied"),!webphone_api.common.isNull(destnumber)&&destnumber.length>0&&"call-audiovideo"===calltype)return PutToDebugLog(2,"WARNING, MediaStream permission denied, retry audio call with no video: "+destnumber),webphone_api.$("#div_video_fullscreen_button").hide(),void SipCall("call-audio",callline,destnumber,!0);PutToDebugLog(2,"EVENT, Hangup incoming call, because MediaStream permission denied: "+destnumber),SipHangup(!0,webphone_api.global.aline),setTimeout(function(){webphone_api.common.MediaStreamPermissionDenied()},150)}}}function onSipEventSession(e){switch(webphone_api.global.isdebugversionwebrtc&&console.log("WRTCEVENT_SESSION: "+e.type+", "+e.description),webphone_api.common.isNull(e.session.o_session)||webphone_api.common.isNull(e.session.o_session.s_type),webphone_api.common.SaveParameter("lastsessionsuccess","2"),PutToDebugLog(2,"==session event == "+e.type+" "+SessionToString(e.session)),e.type){case"connecting":case"connected":var t="connected"==e.type;if(e.session==oSipSessionRegister)"connecting"==e.type&&PutToDebugLog(1,"STATUS,-1,Registering..."),"connected"==e.type&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.global.iscurrengineworking=!0),isregistered=!0,SendRegisteredStatus(),webphone_api.global.webrtc_regstate=1);else if(e.session==oSipSessionMessage);else if(e.session==oSipSessionTransferCall);else if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){var n=!1;if(e.session==oSipSessionCall&&(n=!0),!1===n&&!webphone_api.common.isNull(webphone_api.global.ep))for(var o=0;o<webphone_api.global.ep.length;o++){var i=webphone_api.global.ep[o][webphone_api.common.EP_SESSION];if(!webphone_api.common.isNull(i)&&e.session==i){n=!0;break}}if(!0===n){var a="unknown";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var r="1";istypeincoming&&(r="2");try{if("undefined"!=typeof e.session.o_session&&null!==e.session.o_session&&"undefined"!=typeof e.session.o_session.o_uri_from&&null!==e.session.o_session.o_uri_from&&"undefined"!=typeof e.session.o_session.o_uri_from.s_user_name&&null!==e.session.o_session.o_uri_from.s_user_name&&e.session.o_session.o_uri_from.s_user_name.length>0){var s=e.session.o_session.o_uri_from.s_user_name;!webphone_api.common.isNull(s)&&s.length>0&&(r=webphone_api.common.GetSipusername().toLowerCase()===s.toLowerCase()?"1":"2")}}catch(G){PutToDebugLogException(2,"webrtcapi: onSipEventSession: connecting or connected",G)}if(t){stopRingbackTone(),stopRingTone(),oNotifICall&&(oNotifICall.cancel(),oNotifICall=null);var l=GetSIPCallIDFromEvent(e),p=webphone_api.common.GetEndpoint(107,-1,a,l,e.session.getId(),!1);!webphone_api.common.isNull(p)&&!webphone_api.common.isNull(p[webphone_api.common.EP_CALLID])&&p[webphone_api.common.EP_CALLID].length>0&&(l=p[webphone_api.common.EP_CALLID]),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",CallConnect,"+a+","+webphone_api.common.GetSipusername()+","+r+","+a+",["+l+"],,,,,"),webphone_api.common.SaveCallSession(4,webphone_api.global.aline,e.session,a,r,-1,webphone_api.common.GetTickCount(),-1,"",l,"","","","","","",e.session.getId()),setTimeout(function(){PutToDebugLog(1,"STATUS,-1,In Call"),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Speaking,"+a+","+webphone_api.common.GetSipusername()+","+r+","+a)},1100),PutToDebugLog(1,"STATUS,-1,Speaking"),"2"===r&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",InCall,"+a+","+webphone_api.common.GetSipusername()+","+r+","+a)}else PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+","+e.description),webphone_api.common.SaveCallSession(5,webphone_api.global.aline,e.session,a,r,webphone_api.common.GetTickCount(),-1,-1,"",l,"","",null,"","","",e.session.getId());webphone_api.webrtcstack.SIPml.isWebRtc4AllSupported()&&(PutToDebugLog(2,"EVENT, webrtc4all supported connect uiVideoDisplayEvent"),uiVideoDisplayEvent(!1,!0),uiVideoDisplayEvent(!0,!0))}}break;case"terminating":case"terminated":if(e.session==oSipSessionRegister)if(uiOnConnectionEvent(!1,!1),oSipSessionCall=null,oSipSessionRegister=null,isregistered=!1,webphone_api.global.webrtc_regstate=0,!0===webphone_api.global.onunregistered_flag||!1===webphone_api.flagrestartwebrtc);else{PutToDebugLog(2,"ERROR,register failed with reason: "+e.description),PutToDebugLog(1,"STATUS,-1,Register failed: "+e.description),!webphone_api.common.isNull(e.description)&&e.description.length>0&&(lastregfailreason=e.description);try{webphone_api.onRegStateChangeCb("failed",e.description)}catch(G){PutToDebugLogException(2,"webrtcapi: There is an error in onRegStateChangeCb(failed) callback",G)}try{webphone_api.onRegisterFailedCb(e.description)}catch(G){PutToDebugLogException(2,"webrtcapi: There is an error in onRegisterFailed() callback",G)}webphone_api.common.CheckInternetConnection(),webphone_api.common.CheckInternetConnectionWS()}else if(e.session==oSipSessionMessage)PutToDebugLog(2,"EVENT,EventSession message: "+e.type);else if(e.session==oSipSessionTransferCall)PutToDebugLog(2,"EVENT,EventSession call transfer: "+e.type);else if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){if(PutToDebugLog(2,"EVENT,EventSession call: "+e.type),e.session===lastsession)return void PutToDebugLog(2,"EVENT, webrtcap: skip because duplicate session received");lastsession=e.session;var a="unknown";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var r="1";istypeincoming&&(r="2"),setTimeout(function(){calltype="",callline=1,destnumber=""},200);var l=GetSIPCallIDFromEvent(e),c=webphone_api.global.aline,p=webphone_api.common.GetEndpoint(108,webphone_api.global.aline,a,l,e.session.getId(),!1,!0);if(!webphone_api.common.isNull(p)&&!webphone_api.common.isNull(p[webphone_api.common.EP_LINE])&&webphone_api.common.IsNumber(p[webphone_api.common.EP_LINE])&&webphone_api.common.StrToInt(p[webphone_api.common.EP_LINE])>0&&(c=webphone_api.common.StrToInt(p[webphone_api.common.EP_LINE])),!webphone_api.common.isNull(p)&&!webphone_api.common.isNull(p[webphone_api.common.EP_CALLID])&&p[webphone_api.common.EP_CALLID].length>0&&(l=p[webphone_api.common.EP_CALLID]),!webphone_api.common.isNull(p)&&"true"===p[webphone_api.common.EP_FINISHEDSENT]||lastsessionid===e.session.getId())PutToDebugLog(3,"EVENT, webrtc finished status already sent for this session");else if(lastsessionid=e.session.getId(),setTimeout(function(){lastsessionid=-1e3},150),!1===webphone_api.global.calltransf_completed&&(c=webphone_api.common.SaveCallSession(6,null,e.session,a,r,-1,-1,webphone_api.common.GetTickCount(),"",l,"","true",null,"","","",e.session.getId())),c<-4&&(c=webphone_api.global.aline),PutToDebugLog(1,"STATUS,"+c.toString()+",CallDisconnect,"+a+","+webphone_api.common.GetSipusername()+","+r+","+a+",["+l+"],,,,,"),uiCallTerminated("Call Finished",c),BuildCDR(c,a,l,e.session.getId(),e.description),atransfer_number.length>0&&(-1!=atransfer_line||atransfer_callid.length>0)){PutToDebugLog(3,"EVENT, completing attended transfer on line "+atransfer_line+" callid: "+atransfer_callid);var u=webphone_api.common.GetEndpoint(5474,atransfer_line,"",atransfer_callid,null,!1,!1,null,e.session),h=u[EP_SESSION];if(webphone_api.common.isNull(u))PutToDebugLog(3,"WANING, orig ep not found for transfer"),m>0&&SipToggleHoldResume(!1,m),PutToDebugLog(1,"EVENT, call transfer gone (0x11)");else if(webphone_api.common.isNull(h))PutToDebugLog(3,"WANING, orig ep session not found for transfer"),m>0&&SipToggleHoldResume(!1,m),PutToDebugLog(1,"EVENT, call transfer gone (0x12)");else if(u===p)PutToDebugLog(3,"WANING, orig ep mismatch for transfer"),PutToDebugLog(1,"EVENT, call transfer gone (0x14)");else if(h===e.session)PutToDebugLog(3,"WANING, orig ep session mismatch for transfer"),PutToDebugLog(1,"EVENT, call transfer gone (0x15)");else{var g=atransfer_number,m=atransfer_line;setTimeout(function(){0!=h.transfer(g)?(m>0&&(PutToDebugLog(2,"EVENT, Unhold-Reload call on attended transfer fail"),SipToggleHoldResume(!1,m)),PutToDebugLog(1,"EVENT, call transfer failed (0x15)")):PutToDebugLog(1,"EVENT, call transferred")},60)}atransfer_number="",atransfer_line=-1,atransfer_callid=""}}break;case"i_notify":if(PutToDebugLog(4,"EVENT, NOTIFY content-type: "+e.getContentType()),PutToDebugLog(4,"EVENT, NOTIFY content: "+e.getContentString()),"application/pidf+xml"==e.getContentType()&&window.DOMParser){var d=new DOMParser,b=d?d.parseFromString(e.getContentString(),"text/xml"):null,_=b?b.getElementsByTagName("presence")[0]:null;if(_){var f=_.getAttribute("entity"),w=_.getElementsByTagName("tuple")[0];if(f&&w){var v=w.getElementsByTagName("status")[0];if(v){var P=v.getElementsByTagName("basic")[0];if(P){var E=f,T=P.textContent;E=E.toLowerCase(),E=E.replace("sip:","");var N=E.indexOf("@");N>0&&(E=E.substring(0,N));var S=webphone_api.common.SaveReceivedPresence2(E,T);PutToDebugLog(4,"EVENT, Presence notification: number: "+E+" status: "+T),!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._dialpad)||webphone_api._dialpad.PopulateListRecents(),!0!==webphone_api.global.isContactdetailsStarted||!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._contactdetails)||webphone_api._contactdetails.PopulateData(),!0!==webphone_api.global.isMessageStarted||webphone_api.common.isNull(webphone_api._message)||webphone_api._message.DisplayPresence(S)}}}}}break;case"m_stream_video_local_added":PutToDebugLog(2,"EVENT, local video stream added"),e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&uiVideoDisplayEvent(!0,!0);break;case"m_stream_video_local_removed":PutToDebugLog(2,"EVENT, local video stream removed"),e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&uiVideoDisplayEvent(!0,!1);break;case"m_stream_video_remote_added":PutToDebugLog(2,"EVENT, remote video stream added"),e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&uiVideoDisplayEvent(!1,!0);break;case"m_stream_video_remote_removed":PutToDebugLog(2,"EVENT, remote video stream removed"),e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&uiVideoDisplayEvent(!1,!1);break;case"m_stream_audio_local_added":PutToDebugLog(2,"EVENT, local audio stream added");break;case"m_stream_audio_local_removed":PutToDebugLog(2,"EVENT, local audio stream removed");break;case"m_stream_audio_remote_added":PutToDebugLog(2,"EVENT, remote audio stream added");break;case"m_stream_audio_remote_removed":PutToDebugLog(2,"EVENT, remote audio stream removed");break;case"i_ect_new_call":oSipSessionTransferCall=e.session;break;case"i_ao_request":if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){var I=webphone_api.global.aline.toString(),C=webphone_api.common.StrToInt(I);C<1&&webphone_api.common.SetALineInternal(webphone_api.common.GetFreeLine(),24);var a="unknown";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var l=GetSIPCallIDFromEvent(e),p=webphone_api.common.GetEndpoint(109,-1,a,l,e.session.getId(),!1);!webphone_api.common.isNull(p)&&!webphone_api.common.isNull(p[webphone_api.common.EP_CALLID])&&p[webphone_api.common.EP_CALLID].length>0&&(l=p[webphone_api.common.EP_CALLID]),!webphone_api.common.isNull(p)&&p.length>webphone_api.common.EP_SETUPSENT&&"true"===p[webphone_api.common.EP_SETUPSENT]||(1===webphone_api.common.GetApibehaviour()&&(PutToDebugLog(1,"STATUS,-1,Call Initiated"),PutToDebugLog(1,"STATUS,-1,Calling...")),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",CallSetup,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+l+"],,,,,"),webphone_api.common.SaveCallSession(7,webphone_api.global.aline,e.session,a,"1",webphone_api.common.GetTickCount(),-1,-1,"",l,"true","",null,"","","",e.session.getId()));var R=e.getSipResponseCode();180==R||183==R?(istypeincoming=!1,PutToDebugLog(1,"STATUS,-1,Ringing..."),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Ringing,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+l+"]"),0===changesptoring?180==R&&(!webphone_api.common.isNull(e.session.ringdone)&&e.session.ringdone||(startRingbackTone(),e.session.ringdone=!0)):2!==changesptoring&&5!==changesptoring||!webphone_api.common.isNull(e.session.ringdone)&&e.session.ringdone||(startRingbackTone(),e.session.ringdone=!0)):100==R&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",InProgress,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+l+"]")}break;case"m_early_media":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(5!==changesptoring&&setTimeout(function(){stopRingbackTone(),stopRingTone()},100),PutToDebugLog(1,"STATUS,-1,Early media started"));break;case"m_local_hold_ok":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(e.session.bTransfering&&(e.session.bTransfering=!1),e.session.bHeld=!0);break;case"m_local_hold_nok":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(e.session.bTransfering=!1);break;case"m_local_resume_ok":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(e.session.bTransfering=!1,e.session.bHeld=!1,webphone_api.webrtcstack.SIPml.isWebRtc4AllSupported()&&(uiVideoDisplayEvent(!1,!0),uiVideoDisplayEvent(!0,!0)));break;case"m_local_resume_nok":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(e.session.bTransfering=!1,PutToDebugLog(1,"STATUS,-1,Failed to unhold call"));break;case"m_remote_hold":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,-1,Placed on hold by remote party");break;case"m_remote_resume":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,-1,Taken off hold by remote party");break;case"m_bfcp_info":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,-1,BFCP Info: "+e.description);break;case"o_ect_trying":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(PutToDebugLog(1,"EVENT,transfer initiated successfully"),1===webphone_api.common.GetApibehaviour()&&PutToDebugLog(1,"STATUS,-1,Transfer"),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer in progress..._"));break;case"o_ect_accepted":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer accepted");break;case"o_ect_completed":if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){var a="";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var l=GetSIPCallIDFromEvent(e),p=webphone_api.common.GetEndpoint(1010,-1,a,l,e.session.getId(),!1);!webphone_api.common.isNull(p)&&!webphone_api.common.isNull(p[webphone_api.common.EP_CALLID])&&p[webphone_api.common.EP_CALLID].length>0&&(l=p[webphone_api.common.EP_CALLID]),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Midcall,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+l+"],,,,,")}break;case"i_ect_completed":if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){webphone_api.global.calltransf_completed=!0,setTimeout(function(){webphone_api.global.calltransf_completed=!1,webphone_api.common.RefreshInfo()},3e3),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer completed"),oSipSessionTransferCall&&(oSipSessionCall=oSipSessionTransferCall),oSipSessionTransferCall=null;var a="";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var l=GetSIPCallIDFromEvent(e),p=webphone_api.common.GetEndpoint(1011,-1,a,l,e.session.getId(),!1);!webphone_api.common.isNull(p)&&!webphone_api.common.isNull(p[webphone_api.common.EP_CALLID])&&p[webphone_api.common.EP_CALLID].length>0&&(l=p[webphone_api.common.EP_CALLID]),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",Midcall,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+l+"],,,,,")}break;case"o_ect_failed":PutToDebugLog(1,"ERROR,"+webphone_api.global.aline+",Call transfer failed");break;case"i_ect_failed":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer failed");break;case"o_ect_notify":PutToDebugLog(1,"EVENT,transfer initiated"),PutToDebugLog(2,"STATUS,"+webphone_api.global.aline+",Call Transfer: "+e.getSipResponseCode()+" "+e.description+"_o");break;case"i_ect_notify":e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call&&(PutToDebugLog(1,"EVENT,transfer initiated"),PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call Transfer: "+e.getSipResponseCode()+" "+e.description),e.getSipResponseCode()>=300&&e.session.bHeld&&e.session.resume(),1===webphone_api.common.GetApibehaviour()&&PutToDebugLog(1,"STATUS,-1,Transfer"));break;case"i_ect_requested":if(e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call){if(0===webphone_api.common.GetParameterInt("transfertype",-1))PutToDebugLog(2,"EVENT, incoming SIP REFER transfer rejected."),e.session.rejectTransfer();else{PutToDebugLog(1,"STATUS,"+webphone_api.global.aline+",Call transfer in progress...");var I=webphone_api.global.aline.toString(),C=webphone_api.common.StrToInt(I);C<1&&webphone_api.common.SetALineInternal(webphone_api.common.GetFreeLine(),25);var a="unknown";e&&null!==e&&e.session&&null!==e.session&&(a=e.session.getRemoteFriendlyName());var l=GetSIPCallIDFromEvent(e),p=webphone_api.common.GetEndpoint(1012,-1,a,l,e.session.getId(),!1);!webphone_api.common.isNull(p)&&!webphone_api.common.isNull(p[webphone_api.common.EP_CALLID])&&p[webphone_api.common.EP_CALLID].length>0&&(l=p[webphone_api.common.EP_CALLID]),!webphone_api.common.isNull(p)&&p.length>webphone_api.common.EP_SETUPSENT&&"true"===p[webphone_api.common.EP_SETUPSENT]||(PutToDebugLog(1,"STATUS,"+webphone_api.global.aline.toString()+",CallSetup,"+a+","+webphone_api.common.GetSipusername()+",1,"+a+",["+l+"],,,,,"),webphone_api.common.SaveCallSession(8,webphone_api.global.aline,e.session,a,"1",webphone_api.common.GetTickCount(),-5,-5,"",l,"true","",null,"","","",e.session.getId()));var R=e.getSipResponseCode();e.session.acceptTransfer()}}}}function BuildCDR(e,t,n,o,i){try{2===webphone_api.common.GetParameterInt("androidspeaker",1)&&!1===adev_hack_called&&"Android"===webphone_api.common.GetOs()&&(webphone_api.common.isNull(audioinput_id)||audioinput_id.length<1||audioinput_name[0].toLowerCase().indexOf("microphone")>=0&&audioinput_name[0].indexOf("1")>=0)&&(adev_hack_called=!0,StartGetDevices(),setTimeout(function(){webphone_api.plhandler.GetAudioDevicesForMenu(0,!0)},200));var a=!0;!0===webphone_api.global.calltransf_completed&&(a=!1);var r=webphone_api.common.GetEndpoint(1014,e,t,n,o,a);if(webphone_api.common.isNull(r)||r.length<5)return void PutToDebugLog(2,"ERROR, webrtcapi: BuildCDR invalid endpoint");var s=0,l=0,p=0,c="",u=!1;!webphone_api.common.isNull(r[webphone_api.common.EP_SETUPTIME])&&webphone_api.common.IsNumber(r[webphone_api.common.EP_SETUPTIME])&&(s=webphone_api.common.StrToInt(r[webphone_api.common.EP_SETUPTIME])),!webphone_api.common.isNull(r[webphone_api.common.EP_CONNECTTIME])&&webphone_api.common.IsNumber(r[webphone_api.common.EP_CONNECTTIME])&&(l=webphone_api.common.StrToInt(r[webphone_api.common.EP_CONNECTTIME])),!webphone_api.common.isNull(r[webphone_api.common.EP_DESTNR])&&r[webphone_api.common.EP_DESTNR].length>0&&(c=r[webphone_api.common.EP_DESTNR]),webphone_api.common.IsNumber(r[webphone_api.common.EP_INCOMING])&&2==r[webphone_api.common.EP_INCOMING]&&(u=!0),p=webphone_api.common.GetTickCount();var h=0;!webphone_api.common.isNull(l)&&l>0&&!webphone_api.common.isNull(p)&&p>0&&(h=p-l),c=webphone_api.common.isNull(c)?"":webphone_api.common.Trim(c),webphone_api.common.isNull(l)&&(l=0);var g="",m="",d="NA";!webphone_api.common.isNull(l)&&webphone_api.common.IsNumber(l)&&!webphone_api.common.isNull(s)&&webphone_api.common.IsNumber(s)&&(d=(l-s).toString());u?(g=c,m=webphone_api.common.GetSipusername()):(g=webphone_api.common.GetSipusername(),m=c),webphone_api.common.isNull(i)&&(i="");var b=r[webphone_api.common.EP_CALLID];(webphone_api.common.isNull(n)||n.length<1)&&(b=n),webphone_api.common.GetDiscReasonFromSignaling(function(t){!webphone_api.common.isNull(t)&&t.length>0&&(i=t);var n="CDR,"+e+","+c+","+g+","+m+",NA,"+d+","+h.toString()+",NA,"+i+","+b;webphone_api.global.lastcallcdr=n,webphone_api.common.RemoveSessionHeadersFromCache(webphone_api.common.StrToIntDef(e,-1)),setTimeout(function(){PutToDebugLog(1,n)},500),setTimeout(function(){SendRegisteredStatus()},1500)})}catch(_){PutToDebugLogException(2,"webrtcapi: BuildCDR",_)}}function SendRegisteredStatus(){isregistered&&PutToDebugLog(1,"STATUS,-1,Registered.")}function GetWebrtcStats(){try{return}catch(e){PutToDebugLogException(2,"webrtcapi: GetWebrtcStats",e)}}function DumpStats(e){try{var t="";return Object.keys(e).forEach(function(n,o){var i=e[n];t+="<h3>Report ",t+=o,t+="</h3>\n",t+="time "+i.timestamp+"<br>\n",t+="type "+i.type+"<br>\n",Object.keys(i).forEach(function(e){"timestamp"!==e&&"type"!==e&&(t+=e+": "+i[e]+"<br>\n")})}),t}catch(n){PutToDebugLogException(2,"webrtcapi: DumpStats",n)}return""}function SetVolume(e,t){try{if(webphone_api.common.isNull(t)||!webphone_api.common.IsNumber(t))return void PutToDebugLog(2,"ERROR, webrtcapi: SetVolume is NULL: "+t);var n=webphone_api.common.StrToInt(t);if(n<0||n>100)return void PutToDebugLog(2,"ERROR, webrtcapi: SetVolume invalid value. Accepted varulue range is from 0 - 100: "+n);var o=document.getElementById("audio_remote");if(webphone_api.common.isNull(o))return PutToDebugLog(2,"ERROR, webrtcapi: SetVolume cannot find audio element"),!1;0==e||"0"==e?(n>100&&(n=100),n<0&&(n=0),n/=100,webphone_api.webrtcMicVolume=n):2==e&&"2"==e?(n>100&&(n=100),webphone_api.$("#ringtone").prop("volvalueforgetvolume",n),webphone_api.$("#ringbacktone").prop("volvalueforgetvolume",n),n=n/100*2,n>1&&(n=1),webphone_api.$("#ringtone").prop("volume",n),webphone_api.$("#ringbacktone").prop("volume",n)):0!=e&&"0"!=e&&(n>100&&(n=100),webphone_api.$("#audio_remote").prop("volvalueforgetvolume",n),n=n/100*2,n>1&&(n=1),webphone_api.$("#audio_remote").prop("volume",n),webphone_api.$("#video_remote").prop("volume",n))}catch(i){PutToDebugLogException(2,"webrtcapi: SetVolume",i)}}function GetVolume(e){try{if(0==e||"0"==e){return webphone_api.common.GetParameterInt("volumein",50)}if(0!=e){var t=webphone_api.$("#audio_remote").prop("volume");t=100*t/2;var n=webphone_api.$("#audio_remote").prop("volvalueforgetvolume");return!webphone_api.common.isNull(n)&&webphone_api.common.IsNumber(n)&&(t=webphone_api.common.StrToInt(n)),PutToDebugLog(2,"webrtcapi: GetVolume returned: "+t.toString()),t}}catch(o){PutToDebugLogException(2,"webrtcapi: GetVolume",o)}}function GetAudioDeviceList(e){try{var t=[];t=0==e?audioinput_name:1===e||2===e?audiooutput_name:videoinput_name;var n="";if(!webphone_api.common.isNull(t)&&t.length>0)for(var o=0;o<t.length;o++)n.length>0&&(n+="\r\n"),n+=t[o];return n}catch(i){PutToDebugLogException(2,"webrtcapi: GetAudioDeviceList",i)}return""}function GetAudioDevice(e){try{var t="";if(0==e){t=audioinput_name[0];var n=webphone_api.common.GetParameter("sel_rtc_audio_in");if(!webphone_api.common.isNull(n)&&n.length>0)for(var o=0;o<audioinput_name.length;o++)if(n===audioinput_name[o]){t=n;break}(webphone_api.common.isNull(t)||t.length<1)&&(t=n),webphone_api.common.SaveParameter("sel_rtc_audio_in",t)}else if(1==e||2==e){t=audiooutput_name[0];var n=webphone_api.common.GetParameter("sel_rtc_audio_out");if(!webphone_api.common.isNull(n)&&n.length>0)for(var o=0;o<audiooutput_name.length;o++)if(n===audiooutput_name[o]){t=n;break}(webphone_api.common.isNull(t)||t.length<1)&&(t=n),webphone_api.common.SaveParameter("sel_rtc_audio_out",t)}if(3==e){t=videoinput_name[0];var n=webphone_api.common.GetParameter("sel_rtc_video_in");if(!webphone_api.common.isNull(n)&&n.length>0)for(var o=0;o<videoinput_name.length;o++)if(n===videoinput_name[o]){t=n;break}(webphone_api.common.isNull(t)||t.length<1)&&(t=n),webphone_api.common.SaveParameter("sel_rtc_video_in",t)}return t}catch(i){PutToDebugLogException(2,"webrtcapi: GetAudioDevice",i)}return""}function SetAudioDevice(e,t,n){try{var o=!1;if(webphone_api.common.isNull(t)||t.length<0)return void PutToDebugLog(2,"ERROR, webrtcapi SetAudioDevice: invalid devicename: "+t);PutToDebugLog(3,"EVENT, webrtcapi SetAudioDevice: device: "+e+", devicename: "+t),t=t.toLowerCase();var i="";if(0===e){for(var a=0;a<audioinput_name.length;a++)if(!webphone_api.common.isNull(audioinput_name[a])){if(audioinput_name[a].toLowerCase()===t){webphone_api.common.SaveParameter("sel_rtc_audio_in",audioinput_name[a]),GetSetDevices(audioinput_id[a],"",n),o=!0;break}i=i+audioinput_name[a]+","}}else if(1===e||2===e){for(var a=0;a<audiooutput_name.length;a++)if(!webphone_api.common.isNull(audiooutput_name[a])){if(audiooutput_name[a].toLowerCase()===t){var r=audiooutput_name[a];webphone_api.common.SaveParameter("sel_rtc_audio_out",r.toString()),webphone_api.common.isNull(videoElement)?PutToDebugLog(2,"WARNING, webrtcapi SetAudioDevice videoElement is NULL"):attachSinkId(videoElement,audiooutput_id[a],"audio output_v"),attachSinkId(audioRemoteElement,audiooutput_id[a],"audio output"),o=!0;break}i=i+audiooutput_name[a]+","}}else for(var a=0;a<videoinput_name.length;a++)if(!webphone_api.common.isNull(videoinput_name[a])){if(videoinput_name[a].toLowerCase()===t){webphone_api.common.SaveParameter("sel_rtc_video_in",videoinput_name[a]),!0===n&&(webphone_api.common.isNull(videoElement)?PutToDebugLog(2,"WARNING, webrtcapi SetAudioDevice for video videoElement is NULL"):attachSinkId(videoElement,videoinput_id[a],"video")),o=!0;break}i=i+videoinput_name[a]+","}if(!1===o)if(0===e){for(var a=0;a<audioinput_name.length;a++)if(!webphone_api.common.isNull(audioinput_name[a])){if(0==audioinput_name[a].toLowerCase().indexOf(t)||0==t.indexOf(audioinput_name[a].toLowerCase())){webphone_api.common.SaveParameter("sel_rtc_audio_in",audioinput_name[a]),GetSetDevices(audioinput_id[a],"",n),o=!0;break}i=i+audioinput_name[a]+","}}else if(1===e||2===e){for(var a=0;a<audiooutput_name.length;a++)if(!webphone_api.common.isNull(audiooutput_name[a])&&(0==audiooutput_name[a].toLowerCase().indexOf(t)||0==t.indexOf(audiooutput_name[a].toLowerCase()))){var r=audiooutput_name[a];webphone_api.common.SaveParameter("sel_rtc_audio_out",r.toString()),webphone_api.common.isNull(videoElement)?PutToDebugLog(2,"WARNING, webrtcapi SetAudioDevice videoElement is NULL"):attachSinkId(videoElement,audiooutput_id[a],"audio output_v"),attachSinkId(audioRemoteElement,audiooutput_id[a],"audio output"),o=!0;break}}else for(var a=0;a<videoinput_name.length;a++)if(!webphone_api.common.isNull(videoinput_name[a])){if(0==videoinput_name[a].toLowerCase().indexOf(t)||0==t.indexOf(videoinput_name[a].toLowerCase())){webphone_api.common.SaveParameter("sel_rtc_video_in",videoinput_name[a]),!0===n&&(webphone_api.common.isNull(videoElement)?PutToDebugLog(2,"WARNING, webrtcapi SetAudioDevice for video videoElement is NULL"):attachSinkId(videoElement,videoinput_id[a],"video")),o=!0;break}i=i+videoinput_name[a]+","}!1===o&&PutToDebugLog(2,"ERROR, webrtcapi SetAudioDevice device not found. device: "+e+", devicename: "+t+", in: "+i)}catch(s){PutToDebugLogException(2,"webrtcapi: SetAudioDevice",s)}}function StartGetDevices(){try{videoElement=document.getElementById("video_remote"),audioRemoteElement=document.getElementById("audio_remote"),webphone_api.common.isNull(navigator.mediaDevices)||webphone_api.common.isNull(navigator.mediaDevices.enumerateDevices)||("MSIE"===webphone_api.common.GetBrowser()?eval("navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(errorCallback);"):navigator.mediaDevices.enumerateDevices().then(gotDevices)["catch"](errorCallback))}catch(err){PutToDebugLogException(2,"webrtcapi: StartGetDevices",err)}}function GetSetDevices(audioSource,videoSource,setalsovideo,vid_prev_elem){try{window.stream&&window.stream.getTracks().forEach(function(e){e.stop()});var constraints=null;constraints=!0===setalsovideo?{audio:{deviceId:audioSource?{exact:audioSource}:undefined},video:{deviceId:videoSource?{exact:videoSource}:undefined}}:{audio:{deviceId:audioSource?{exact:audioSource}:undefined}},webphone_api.common.isNull(navigator.mediaDevices)||webphone_api.common.isNull(navigator.mediaDevices.getUserMedia)||("MSIE"===webphone_api.common.GetBrowser()?eval("navigator.mediaDevices.getUserMedia(constraints).then(function(stream){window.stream = stream;if(typeof(vid_prev_elem) !== 'undefined' && vid_prev_elem !== null) { attachMediaStream(vid_prev_elem, stream); }}).then(gotDevices).catch(errorCallback);"):navigator.mediaDevices.getUserMedia(constraints).then(function(e){return void 0!==vid_prev_elem&&null!==vid_prev_elem&&attachMediaStream(vid_prev_elem,e),window.stream=e,navigator.mediaDevices.enumerateDevices()}).then(gotDevices)["catch"](errorCallback))}catch(err){PutToDebugLogException(2,"webrtcapi: GetSetDevices",err)}}function SwitchOffAndroidSpeaker(callback){function GUMHandleSuccess(stream){function ENUMgotdevices(e){try{if(!webphone_api.common.isNull(e)&&e.length>0){audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[];for(var t=0;t!==e.length;++t){var n=e[t],o=n.deviceId;if("audioinput"===n.kind){var i=n.label||"microphone "+(audioinput_name.length+1);audioinput_name.push(i),audioinput_id.push(o)}else if("audiooutput"===n.kind){var i=n.label||"speaker "+(audiooutput_name.length+1);audiooutput_name.push(i),audiooutput_id.push(o)}else if("videoinput"===n.kind){var i=n.label||"camera "+(videoinput_name.length+1);videoinput_name.push(i),videoinput_id.push(o)}else PutToDebugLog(3,"EVENT, webrtcapi GUMgotdevices: Some other kind of source/device: ",n)}PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 0"),webphone_api.getdevicelist(0,function(){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 1"),webphone_api.getdevicelist(1,function(){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 3"),webphone_api.getdevicelist(3,function(){}),PutToDebugLog(3,"EVENT, webrtcapi SwitchOffAndroidSpeaker GUMgotdevices executed successfully"),callback()}else PutToDebugLog(2,"WARNING, webrtrcapi GUMgotdevices: no devices found"),callback()}catch(a){PutToDebugLogException(2,"webrtcapi: ENUMgotdevices",a),callback()}}function ENUMerrorCallback(e){PutToDebugLog(2,"ERROR, GUMerrorCallback webrtcapi navigator.getUserMedia: "+e),callback()}try{eval("navigator.mediaDevices.enumerateDevices().then(ENUMgotdevices).catch(ENUMerrorCallback);")}catch(err){PutToDebugLogException(2,"webrtcapi: GUMHandleSuccess",err),callback()}}function GUMHandleError(e){try{PutToDebugLog(2,"ERROR, GUMHandleError webrtcapi navigator.getUserMedia: "+e),callback()}catch(t){PutToDebugLogException(2,"webrtcapi: GUMHandleError",t),callback()}}try{if(callback&&"function"==typeof callback||(callback=function(){}),"MSIE"===webphone_api.common.GetBrowser())return void callback();if(!0===switchas_called||"Android"!==webphone_api.common.GetOs())return void callback();var as=webphone_api.common.GetParameterInt("androidspeaker",1);if(as<1)return void callback();switchas_called=!0;var constraints={audio:!0,video:!1};eval("navigator.mediaDevices.getUserMedia(constraints).then(GUMHandleSuccess).catch(GUMHandleError);")}catch(err){PutToDebugLogException(2,"webrtcapi: SwitchOffAndroidSpeaker",err),callback()}}function MyCameraPreview(e){try{if(webphone_api.common.GetParameterInt("displayvideodevice",0)<1)return;PutToDebugLog(2,"EVENT, webrtcapi MyCameraPreview: "+e)
;var t='<div id="preview_div_video_local" class="previewvideo"><video class="video" width="100%" height="100%" id="preview_video_local" autoplay="autoplay" muted="true"></video><button id="preview_btn_close">'+webphone_api.stringres.get("btn_close")+"</button></div>";if(!1===webphone_api.common.IsSDK()){var n=webphone_api.$.mobile.activePage.attr("id");webphone_api.$("#"+n).append(t)}else webphone_api.$("body").append(t);var o=document.getElementById("preview_video_local");if(webphone_api.common.isNull(o))return void PutToDebugLog(2,"EVENT, MyCameraPreview video element is NULL");webphone_api.$("#preview_btn_close").on("click",function(){HideVideoPriview()});GetSetDevices(GetAudioVideoInputId(webphone_api.common.GetParameter("sel_rtc_audio_in"),!1),GetAudioVideoInputId(webphone_api.common.GetParameter("sel_rtc_video_in"),!0),!0,o),setTimeout(function(){HideVideoPriview()},1e4)}catch(i){PutToDebugLogException(2,"webrtcapi: MyCameraPreview",i)}}function HideVideoPriview(){try{var e=document.getElementById("preview_video_local");if(webphone_api.common.isNull(e))return;"undefined"!=typeof URL.revokeObjectURL&&URL.revokeObjectURL(e.src),e.src&&(e.src=null),webphone_api.$("#preview_div_video_local").remove()}catch(t){PutToDebugLogException(2,"webrtcapi: HideVideoPriview",t)}}function PrintWebRTCAudioDevices(){try{if(!0===webphone_api.global.printwad_called)return;webphone_api.global.printwad_called=!0,webphone_api.common.isNull(audioinput_name)||webphone_api.common.isNull(audioinput_id)||PutToDebugLog(2,"EVENT, webrtcdevices: audio input devices name: "+audioinput_name.toString()+"; ids: "+audioinput_id.toString()),webphone_api.common.isNull(audiooutput_name)||webphone_api.common.isNull(audiooutput_id)||PutToDebugLog(2,"EVENT, webrtcdevices: audio output devices name: "+audiooutput_name.toString()+"; ids: "+audiooutput_id.toString()),webphone_api.common.isNull(videoinput_name)||webphone_api.common.isNull(videoinput_id)||PutToDebugLog(2,"EVENT, webrtcdevices: video input devices name: "+videoinput_name.toString()+"; ids: "+videoinput_id.toString())}catch(e){PutToDebugLogException(2,"webrtcapi: PrintWebRTCAudioDevices",e)}}function GetAudioVideoInputId(e,t){try{if(webphone_api.common.isNull(e)||e.length<1)return e;if(!0===t){if(webphone_api.common.isNull(videoinput_name)||videoinput_name.length<1||webphone_api.common.isNull(videoinput_id)||videoinput_id.length<1)return e;for(var n=0;n<videoinput_name.length;n++)if(e===videoinput_name[n])return videoinput_id[n]}else{if(webphone_api.common.isNull(audioinput_name)||audioinput_name.length<1||webphone_api.common.isNull(audioinput_id)||audioinput_id.length<1)return e;for(var n=0;n<audioinput_name.length;n++)if(e===audioinput_name[n])return audioinput_id[n]}}catch(o){PutToDebugLogException(2,"webrtcapi: GetAudioInputId",o)}return e}function gotDevices(e){try{if(!webphone_api.common.isNull(e)&&e.length>0){audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[];for(var t=0;t!==e.length;++t){var n=e[t],o=n.deviceId;if("audioinput"===n.kind){var i=n.label||"microphone "+(audioinput_name.length+1);PutToDebugLog(2,"EVENT, gotDevices audioinput: "+i+" id: "+o),audioinput_name.push(i),audioinput_id.push(o)}else if("audiooutput"===n.kind){var i=n.label||"speaker "+(audiooutput_name.length+1);PutToDebugLog(2,"EVENT, gotDevices audiooutput: "+i+" id: "+o),audiooutput_name.push(i),audiooutput_id.push(o)}else if("videoinput"===n.kind){var i=n.label||"camera "+(videoinput_name.length+1);PutToDebugLog(2,"EVENT, gotDevices videoinput: "+i+" id: "+o),videoinput_name.push(i),videoinput_id.push(o)}else PutToDebugLog(3,"EVENT, webrtcapi gotDevices: Some other kind of source/device: ",n)}PrintWebRTCAudioDevices()}else webphone_api.common.isNull(e)?PutToDebugLog(2,"WARNING, webrtrcapi gotDevices: no devices found (null)"):PutToDebugLog(2,"WARNING, webrtrcapi gotDevices: no devices found (0)")}catch(a){PutToDebugLogException(2,"webrtcapi: gotDevices",a)}}function attachSinkId(element,sinkId,msg){try{"undefined"!=typeof element.sinkId?eval("element.setSinkId(sinkId).then(function(){PutToDebugLog(3, 'EVENT, webrtcapi attachSinkId: Success, ' + msg + ' device: ' + element.toString() + '; attached: ' + sinkId);}).catch(function(error){var errorMessage = error;if (error.name === 'SecurityError'){errorMessage = 'You need to use HTTPS for selecting audio output device: ' + error;}PutToDebugLog(2, 'ERROR, webrtcapi attachSinkId to: ' + element.toString() + '; sinkId: ' + sinkId + ' error: ' + errorMessage);});"):PutToDebugLog(2,"WARNING, webrtcapi attachSinkId: Browser does not support output device selection.")}catch(err){PutToDebugLogException(2,"webrtcapi: attachSinkId",err)}}function errorCallback(e){PutToDebugLog(2,"ERROR, webrtcapi navigator.getUserMedia: "+e)}function AddVideoElemnts(e){try{var t='<div id="div_video"><div id="div_video_remote"><video class="video" width="100%" height="100%" id="video_remote" autoplay="autoplay"></video></div><div id="div_video_local_wrapper"><iframe allow="microphone; camera" class="previewvideo"> </iframe><div id="div_video_local" class="previewvideo"><video class="video" width="100%" height="100%" id="video_local" autoplay="autoplay" muted="true"></video></div></div><div id="div_video_fullscreen_button"><button id="btn_video_fullscreen" class="ui-btn ui-btn-corner-all ui-btn-b noshadow">'+webphone_api.stringres.get("btn_video_fullscreen")+"</button></div></div>";videocontainer=document.getElementById("video_container"),webphone_api.common.isNull(videocontainer)?!0===e?PutToDebugLog(2,"EVENT, (warn) AddVideoElemnts cannot find video_container DIV"):PutToDebugLog(2,"EVENT, AddVideoElemnts cannot find video_container DIV"):webphone_api.common.isNull(divVideo)&&(PutToDebugLog(2,"EVENT, AddVideoElemnts video elements added"),videocontainer.innerHTML=t),divVideo=document.getElementById("div_video"),videoLocal=document.getElementById("video_local"),videoRemote=document.getElementById("video_remote"),audioRemote=document.getElementById("audio_remote"),webphone_api.$("#btn_video_fullscreen").off("click"),webphone_api.$("#btn_video_fullscreen").on("click",function(){toggleFullScreen()})}catch(n){PutToDebugLogException(2,"webrtcapi: AddVideoElemnts",n)}}function GetVideoSizeObj(){var e=undefined;try{var t=webphone_api.common.GetParameter2("video_min_width"),n=webphone_api.common.GetParameter2("video_min_height"),o=webphone_api.common.GetParameter2("video_max_width"),i=webphone_api.common.GetParameter2("video_max_height"),a=webphone_api.common.GetParameter2("video_width"),r=webphone_api.common.GetParameter2("video_height"),s=0,l=0,p=0,c=0,u=0,h=0;s=!webphone_api.common.isNull(t)&&t.length>0&&webphone_api.common.IsNumber(t)?webphone_api.common.StrToInt(t):100,l=!webphone_api.common.isNull(n)&&n.length>0&&webphone_api.common.IsNumber(n)?webphone_api.common.StrToInt(n):80,p=!webphone_api.common.isNull(o)&&o.length>0&&webphone_api.common.IsNumber(o)?webphone_api.common.StrToInt(o):1920,c=!webphone_api.common.isNull(i)&&i.length>0&&webphone_api.common.IsNumber(i)?webphone_api.common.StrToInt(i):1080,u=!webphone_api.common.isNull(a)&&a.length>0&&webphone_api.common.IsNumber(a)?webphone_api.common.StrToInt(a):960,h=!webphone_api.common.isNull(r)&&r.length>0&&webphone_api.common.IsNumber(r)?webphone_api.common.StrToInt(r):540,71===webphone_api.common.GetConfigInt("brandid",-1)&&(u>0&&(s=u),h>0&&(l=h)),s>0&&l>0&&p>0&&c>0&&(PutToDebugLog(2,"EVENT, webrtcapi: video minw: "+s+"; minh: "+l+"; maxw: "+p+"; maxh: "+c),e={minWidth:s,minHeight:l,maxWidth:p,maxHeight:c,width:u,height:h})}catch(g){PutToDebugLogException(2,"webrtcapi: GetVideoSizeObj",g)}return e}function GetRegFailReason(){return webphone_api.common.isNull(lastregfailreason)&&(lastregfailreason=""),lastregfailreason}function SetPushNotifications(e,t,n,o){try{if(webphone_api.common.isNull(t)||t.length<3)return void PutToDebugLog(2,"ERROR, webrtcapi SetPushNotifications invalid TOKEN: "+t);webphone_api.common.isNull(n)&&(n=""),webphone_api.common.isNull(o)&&(o="");var i="X-MPUSH: w:"+webphone_api.common.GetFCMPackageName()+":"+t,a=webphone_api.common.GetSipusername()+":"+webphone_api.global.mRealm+":"+webphone_api.common.GetParameter("password"),r="X-PIID: "+webphone_api.common.Md5Hash(a);SetSipHeader(0,i),SetSipHeader(0,r),webphone_api.global.phonestarted>2&&ResendRegister()}catch(s){PutToDebugLogException(2,"webrtcapi: SetPushNotifications",s)}}function PlaySound(e,t,n,o){try{return!webphone_api.common.isNull(ps_audio)&&ps_audio.pause&&ps_audio.pause(),ps_audio=null,1==e&&!webphone_api.common.isNull(t)&&t.length>0&&(ps_audio=new Audio(t),!0===n&&ps_audio.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),ps_audio.play()),!0}catch(i){PutToDebugLogException(2,"webrtcapi: PlaySound",i)}return!1}function LineToCallID(e){try{var t=webphone_api.common.StrToIntDef(e,-1);if(t<1&&(t=webphone_api.common.GetBestLine()),webphone_api.common.isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return"";for(var n=0;n<webphone_api.global.ep.length;n++){var o=webphone_api.global.ep[n];if(!(webphone_api.common.isNull(o)||o.length<9)&&o[webphone_api.common.EP_LINE]==t)return o[webphone_api.common.EP_CALLID]}}catch(i){PutToDebugLogException(2,"webrtcapi: LineToCallID",i)}return""}function CallIDToLine(e){try{if(e=e.toString(),e.length<1)return-10;if(webphone_api.common.isNull(webphone_api.global.ep)||webphone_api.global.ep.length<1)return"";for(var t=0;t<webphone_api.global.ep.length;t++){var n=webphone_api.global.ep[t];if(!(webphone_api.common.isNull(n)||n.length<9)&&n[webphone_api.common.EP_CALLID]==e)return n[webphone_api.common.EP_LINE]}}catch(o){PutToDebugLogException(2,"webrtcapi: CallIDToLine",o)}return-10}var sTransferNumber,oRingTone,oRingbackTone,oSipStack,oSipSessionRegister,oSipSessionCall,oSipSessionMessage,oSipSessionTransferCall,registerExSipstackArray=[],videoRemote,videoLocal,audioRemote,divVideo,bFullScreen=!1,oNotifICall,bDisableVideo=!1,viewVideoLocal,viewVideoRemote,viewLocalScreencast,oConfigCall,oConfigMessage,oConfigSms,oReadyStateTimer,isregistered=!1,sipheaders=[],callsipheaders=[],mSipuri="",mDisplayname="",changesptoring=2,recheckmediaonconnect=2,lastregfailreason="",atransfer_line=-1,atransfer_callid="",atransfer_number="",C={divKeyPadWidth:220},initcallback=null,wen_namespace="",acc_arr=[],lastrestarttick=0,restartdelay=2e3,restarttimestr="",te2=null,sipstackstarted=!1,redialonfailtimer=null,calltype="",callline=1,destnumber="",last_vid_device="",red_line=null,red_sessioncall=null,red_number=null,red_setuptime=0,red_callid=null,red_headers=null,red_delaytime=6e3,red_s_type="call-audio",lastmuste_mute=null,lastmuste_direction=null,lastmuste_line=null,lastmuste_log=null,publishSession,maxnrofusers=25,pgmaxloop=0,regextimer=null,regex_idx=0,lw_namespace_arr=[],lw_account_arr=[],check_reg_timer=null,reregstarted=!1,rereg_timer=null,rereg_ival=1e4,rereg_action=0,last_event="",lastsession=null,lastsessionid=-1e3,istypeincoming=!1,adev_hack_called=!1,videoElement=null,audioRemoteElement=null,switchas_called=!1,audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[],videocontainer=null,ps_audio=null;return{WebRtcIsSupported:WebRtcIsSupported,Start:Start,RegisterEx:RegisterEx,SipUnRegister:SipUnRegister,SipStop:SipStop,SipCall:SipCall,SipHangup:SipHangup,SipAccept:SipAccept,SipIgnore:SipIgnore,SipSendChat:SipSendChat,Forward:Forward,SipTransfer:SipTransfer,SipTransferEx:SipTransferEx,SipMuteVideo:SipMuteVideo,SipToggleHoldResume:SipToggleHoldResume,SipToggleMute:SipToggleMute,SipSendDTMF:SipSendDTMF,PresenceSet:PresenceSet,PresenceGet:PresenceGet,SetSipHeader:SetSipHeader,GetRegFailReason:GetRegFailReason,SetVolume:SetVolume,GetVolume:GetVolume,GetAudioDeviceList:GetAudioDeviceList,GetAudioDevice:GetAudioDevice,SetAudioDevice:SetAudioDevice,SwitchOffAndroidSpeaker:SwitchOffAndroidSpeaker,PlaySound:PlaySound,LineToCallID:LineToCallID,CallIDToLine:CallIDToLine,ReStart:ReStart,GetWebrtcStats:GetWebrtcStats,GetAudioVideoInputId:GetAudioVideoInputId,MyCameraPreview:MyCameraPreview,HideVideoPriview:HideVideoPriview,RemoveUnusedAudioElements:RemoveUnusedAudioElements,JsObjecSniffer:JsObjecSniffer,ResendRegister:ResendRegister,StartReRegister:StartReRegister,GetVideoSizeObj:GetVideoSizeObj,SessionToString:SessionToString,SetPushNotifications:SetPushNotifications}}(),webphone_api.plhandler=function(){function e(){if(webphone_api.common.EngineSelect(0,27),webphone_api.common.SetLanguage(),Kt(),!1===webphone_api.global.onloaded_called){webphone_api.global.wploaded=!0,webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler webphone onLoaded",!1,"");try{webphone_api.onAppStateChangeCb("loaded")}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(loaded) callback",e)}try{webphone_api.onLoadedCb()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onLoaded() callback",e)}try{!0===webphone_api.common.IsWebphoneInIframe()&&webphone_api.WebphoneSendMessageToParent("wploadedandready_IFRAME")}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: send loaded state message to iframe parent page",e)}webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onload,"onLoad","","","",""),webphone_api.global.onloaded_called=!0,setTimeout(function(){webphone_api.global.onloaded_called=!1},5e3),webphone_api.webphone_loaded=!0,webphone_api.common.WebphoneIsLoaded()}}function t(e,n){try{Mt("Start");var a=webphone_api.common.GetTickCount(),r=a-webphone_api.global.laststarttick;if(webphone_api.global.laststarttick>0&&r<250)return webphone_api.common.PutToDebugLog(3,"EVENT, plhandler start already called"),!1;webphone_api.common.HandleCallerID(),webphone_api.global.laststarttick=a,webphone_api.global.pres_set_at_start=!1,webphone_api.global.pingpong=0,webphone_api.global.ever_received_pong=!1,webphone_api.common.GetCustomMenus(),webphone_api.global.nuiswebpage=null,webphone_api.global.phonestarttick<0&&(webphone_api.global.phonestarttick=webphone_api.common.GetTickCount());var s=webphone_api.common.GetAutostart();if(!1===n&&0===s)return webphone_api.common.PutToDebugLog(3,"EVENT, plhandler autologin disabled because autostart is FALSE"),!1;webphone_api.global.colorizelog=webphone_api.common.GetParameterInt("colorizelog",0),webphone_api.global.authenticated_displayed=!1,webphone_api.global.applet_started=!1,nn=e,webphone_api.global.lastengine_working_ok="",webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, plhandler onstart"),webphone_api.common.PutToDebugLog(1,"STATUS,-1,"+webphone_api.stringres.get("initializing"));var l=webphone_api.common.GetParameter("serveraddress_user");(webphone_api.common.isNull(l)||l.length<2)&&(l=webphone_api.common.GetParameter("serveraddress")),(webphone_api.common.isNull(l)||l.length<2)&&webphone_api.common.PutToDebugLog(2,"EVENT, plhandler start serveraddress not set");var p=!0;if(!1===webphone_api.global.usestorage&&!webphone_api.common.CheckDID(l,!1))if(!webphone_api.common.IsIPAddrress(l)&&l.indexOf(".")>0){var c=webphone_api.common.DomainToIp(l,function(){});if(!(!webphone_api.common.isNull(c)&&c.length>0&&!0===webphone_api.common.IsIPAddrress(c)||""===c))return rn=e,sn=n,void webphone_api.common.DomainToIp(l,function(e){if(!webphone_api.common.isNull(e)&&e.length>0&&!0===webphone_api.common.IsIPAddrress(e)&&!webphone_api.common.CheckDID(e,!1)){p=!1;var n=[];n.push("E"),n.push("R"),n.push("R"),n.push("O"),n.push("R"),n.push(","),n.push("S"),n.push("e"),n.push("r"),n.push("v"),n.push("e"),n.push("r"),n.push(" "),n.push("n"),n.push("o"),n.push("t"),n.push(" "),n.push("a"),n.push("l"),n.push("l"),n.push("o"),n.push("w"),n.push("e"),n.push("d"),n.push("_");var o=n.join("");setTimeout(function(){webphone_api.common.PutToDebugLog(1,o+" "+l)},853)}t(rn,sn)});webphone_api.common.CheckDID(c,!0)||(p=!1)}else p=!1;if(!1===p){var u=[];u.push("E"),u.push("R"),u.push("R"),u.push("O"),u.push("R"),u.push(","),u.push("S"),u.push("e"),u.push("r"),u.push("v"),u.push("e"),u.push("r"),u.push(" "),u.push("n"),u.push("o"),u.push("t"),u.push(" "),u.push("a"),u.push("l"),u.push("l"),u.push("o"),u.push("w"),u.push("e"),u.push("d"),u.push("_");var h=u.join("");return setTimeout(function(){webphone_api.common.PutToDebugLog(1,h+" "+l),webphone_api.common.ShowToast(h+" "+l)},851),!1}Zt=!0,webphone_api.common.isNull(Qt)||clearTimeout(Qt),Qt=setTimeout(function(){Zt=!1},2e3),webphone_api.common.PutToDebugLog(2,"EVENT, plhandler onstart reset useengine"),webphone_api.global.useengine="",webphone_api.global.readcallhistoryforrecents=!0,webphone_api.common.IsWindowsSoftphone()?webphone_api.common.SaveParameter("devicetype",webphone_api.common.DEVICE_WIN_SOFTPHONE()):webphone_api.common.SaveParameter("devicetype",webphone_api.common.DEVICE_WEBPHONE());var g=window.location.href;webphone_api.common.isNull(g)&&(g="");var m=g.indexOf("#");if(m>0&&(g=g.substring(0,m)),m=g.indexOf("?"),m>0&&(g=g.substring(0,m)),webphone_api.common.SaveParameter("wphoneappurl",g),!webphone_api.common.Glsp()){on--;var u=[];u.push("E"),u.push("R"),u.push("R"),u.push("O"),u.push("R"),u.push(","),u.push(" "),u.push("U"),u.push("s"),u.push("a"),u.push("g"),u.push("e"),u.push(" "),u.push("o"),u.push("n"),u.push(" "),u.push("t"),u.push("h"),u.push("i"),u.push("s"),u.push(" "),u.push("o"),u.push("p"),u.push("e"),u.push("r"),u.push("a"),u.push("t"),u.push("i"),u.push("n"),u.push("g"),u.push(" "),u.push("s"),u.push("y"),u.push("s"),u.push("t"),u.push("e"),u.push("m"),u.push(" "),u.push("i"),u.push("s"),u.push(" "),u.push("n"),u.push("o"),u.push("t"),u.push(" "),u.push("p"),u.push("e"),u.push("r"),u.push("m"),u.push("i"),u.push("t"),u.push("t"),u.push("e"),u.push("d"),u.push(" "),u.push("b"),u.push("y"),u.push(" "),u.push("t"),u.push("h"),u.push("i"),u.push("s"),u.push(" "),u.push("l"),u.push("i"),u.push("c"),u.push("e"),u.push("n"),u.push("s"),u.push("e"),u.push("."),u.push(" "),u.push("U"),u.push("p"),u.push("g"),u.push("r"),u.push("a"),u.push("d"),u.push("e"),u.push(" "),u.push("t"),u.push("o"),u.push(" "),u.push("t"),u.push("h"),u.push("e"),u.push(" "),u.push("A"),u.push("d"),u.push("v"),u.push("a"),u.push("n"),u.push("c"),u.push("e"),u.push("d"),u.push(" "),u.push("v"),u.push("e"),u.push("r"),u.push("s"),u.push("i"),u.push("o"),u.push("n"),u.push(" "),u.push("t"),u.push("o"),u.push(" "),u.push("e"),u.push("n"),u.push("a"),u.push("b"),u.push("l"),u.push("e"),u.push(" "),u.push("t"),u.push("h"),u.push("e"),u.push(" "),u.push("w"),u.push("e"),u.push("b"),u.push("p"),u.push("h"),u.push("o"),u.push("n"),u.push("e"),u.push(" "),u.push("o"),u.push("n"),u.push(" "),u.push("s"),u.push("m"),u.push("a"),u.push("r"),u.push("t"),u.push("p"),u.push("h"),u.push("o"),u.push("n"),u.push("e"),u.push("s"),u.push(" "),u.push("a"),u.push("n"),u.push("d"),u.push(" "),u.push("t"),u.push("a"),u.push("b"),u.push("l"),u.push("e"),u.push("t"),u.push("s"),u.push(".");var d=[];d.push("E"),d.push("R"),d.push("R"),d.push("O"),d.push("R");var b=d.join(""),h=u.join("");webphone_api.global.dontclosecurrpopup=!0,setTimeout(function(){webphone_api.global.dontclosecurrpopup=!1},3e4),setTimeout(function(){webphone_api.common.PutToDebugLog(1,h)},2e3),setTimeout(function(){webphone_api.common.AlertDialog(b,h,function(){webphone_api.global.dontclosecurrpopup=!1})},759),an+=10}if(on<10)return;return webphone_api.common.IsWindowsSoftphone()?(webphone_api.common.PutToDebugLog(3,"EVENT, plhandler start softphone"),i()):(!0===webphone_api.common.IsSDK()?webphone_api.common.PutToDebugLog(3,"EVENT, plhandler start webphone sdk"):webphone_api.common.PutToDebugLog(3,"EVENT, plhandler start webphone app"),o()),!0}catch(_){webphone_api.common.PutToDebugLogException(2,"plhandler: Start",_)}return!1}function n(){try{if(!webphone_api.common.IsMizuServerOrGateway())return void(webphone_api.global.isfirstwsu=!1);if(webphone_api.common.IsLocalServer()){var e=webphone_api.common.GetWebrtcSrvAddr();webphone_api.common.isNull(e)&&(e=""),e=e.toLowerCase(),e=e.replace("ws://",""),e=e.replace("wss://","");var t=e.indexOf("/");if(t>0&&(e=e.substring(0,t)),e.length>0&&0==webphone_api.common.IsLanIPEx(e))return webphone_api.common.PutToDebugLog(2,"ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+" (4) "+e),void((!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))&&console.log("ERROR, "+webphone_api.stringres.get("webrtc_local_sipserver")+"\n\n"+webphone_api.stringres.get("all_demo_msg")+" (5)"))}var o=webphone_api.common.GetSipusername(),i=webphone_api.common.GetParameter("password");if(webphone_api.common.IsMizuServerOrGateway()){var a=webphone_api.common.GetParameter("serveraddress_user");(webphone_api.common.isNull(a)||a.length<2)&&(a=webphone_api.common.GetParameter("serveraddress"));var r=webphone_api.common.GetParameter("mainconfigs"),s=o+":"+i+":"+a+":"+webphone_api.common.GetWebrtcSrvAddr();if((webphone_api.common.isNull(r)||r.length<1||r!==s)&&(ln=!0),o.length<1&&i.length<1&&pn<25)return pn++,void setTimeout(function(){n()},80);if((webphone_api.common.isNull(o)||o.length<1)&&webphone_api.common.PutToDebugLog(2,"ERROR, will NOT send wsuser, because username is not set: "+o),(webphone_api.common.isNull(i)||i.length<1)&&webphone_api.common.PutToDebugLog(2,"EVENT, CallWsuser password is not set: "+i),cn=webphone_api.common.GetWsuserUrl(o,i),cn.length<3)return webphone_api.common.PutToDebugLog(3,"EVENT, plhandler CallWsuser wsuser not needed"),webphone_api.global.isfirstwsu=!1,ln=!1,void(webphone_api.global.wsuser_succeded=!0);if(webphone_api.global.isfirstwsu)if(webphone_api.common.isNull(r)||r.length<1||r!==s)un=!0;else{var l=webphone_api.common.GetParameter("wsusers"),p=l.split(",");if(!webphone_api.common.isNull(p)&&p.length>0&&o.length>0)for(var c=0;c<p.length;c++)if(!webphone_api.common.isNull(p[c])&&p[c]===o){webphone_api.global.isfirstwsu=!1;break}}pn=0,webphone_api.common.isNull(o)||o.length<2||webphone_api.common.isNull(i)||i.length<2?webphone_api.common.PutToDebugLog(2,"WARNING, common CallWsuserKeepAlive invalid username ("+o+") or invalid password ("+i+")"):webphone_api.common.UriParser(cn,"","","","","webrtccreateuser"),setTimeout(function(){webphone_api.global.webrtcavailable>0&&!1===webphone_api.global.wsuser_succeded&&(o=webphone_api.common.GetSipusername(),i=webphone_api.common.GetParameter("password"),cn=webphone_api.common.GetWsuserUrl(o,i),webphone_api.common.UriParser(cn,"","","","","webrtccreateuser"))},4500)}}catch(u){webphone_api.common.PutToDebugLogException(2,"plhandler: CallWsuser",u)}}function o(){try{webphone_api.common.isNull(hn)||clearInterval(hn),hn=null,hn=setInterval(function(){++gn>80&&(webphone_api.common.PutToDebugLog(2,"WARNING, EngineSelect timeout"),clearInterval(hn),webphone_api.common.PutToDebugLog(2,"WARNING, WaitForEngineSelect not ready, but start anyway"),webphone_api.common.ChooseEngineLogic(function(){i()},!0));var e=webphone_api.common.GetSipusername(),t=!1,n=webphone_api.common.CanIUseWebRTC();if(webphone_api.global.isfirstwsu&&webphone_api.common.CanIUseWebRTC()&&ln){if(mn<10){var o=webphone_api.common.GetParameter("wsusers"),a=o.split(",");if(!webphone_api.common.isNull(a)&&a.length>0)for(var r=0;r<a.length;r++)if(!webphone_api.common.isNull(a[r])&&e.length>0&&a[r]===e){mn=webphone_api.common.GetTickCount();break}}mn>10&&webphone_api.common.GetTickCount()-mn>2500&&(webphone_api.common.PutToDebugLog(4,"EVENT, wsuser can be sent (first time)"),t=!0)}else n?webphone_api.common.PutToDebugLog(4,"EVENT, wsuser can be sent"):webphone_api.common.PutToDebugLog(4,"EVENT, wsuser not neded"),t=!0;if(!1!==t||!webphone_api.common.CanIUseWebRTC()){webphone_api.common.EngineSelect(1,28)<1?webphone_api.common.PutToDebugLog(2,"EVENT, waiting for EngineSelect ("+gn+")"):webphone_api.global.webrtcavailable<0&&(webphone_api.common.isNull(webphone_api.common.GetSelectedEngine())||webphone_api.common.GetSelectedEngine()==webphone_api.common.GetEngine(webphone_api.global.ENGINE_WEBRTC))?webphone_api.common.PutToDebugLog(2,"EVENT, waiting for WebRTC to load ("+gn+")"):(clearInterval(hn),webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(2,"EVENT, selected engine("+webphone_api.global.engineselectstage+"): "+webphone_api.common.TestEngineToString(webphone_api.common.GetSelectedEngine(),!1)),webphone_api.common.PutToDebugLog(2,"EVENT, recommended engine("+webphone_api.global.engineselectstage+"): "+webphone_api.common.TestEngineToString(webphone_api.common.GetRecommendedEngine(),!1))),setTimeout(function(){webphone_api.common.ChooseEngineLogic(function(){i()},!0)},1e3))}},200)}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: WaitForEngineSelect",e)}}function i(){try{webphone_api.common.IsCurrentEngineWorking(nn),webphone_api.common.CheckEngineFirstStart(nn),webphone_api.common.GatewayFailower(-1,"startUp"),1==webphone_api.common.IsSDK()?(webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler StartUp call HandleSettingsSDK",!1,""),a(function(e){webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler StartUp HandleSettingsSDK FINISHED: "+e,!1,"")})):(webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, plhandler StartUp call StartEngine"),r())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: StartUp",e)}return!1}function a(e){try{if(Jt)return webphone_api.common.PutToDebugLog(3,"EVENT, HandleSettingsSDK call StartEngine"),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, HandleSettingsSDK call StartEngine",!1,""),r(),void e("Already called");if(!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLogSpecial(1,"ERROR, HandleSettingsSDK call StartEngine",!0,"");webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler HandleSettingsSDK called",!1,""),webphone_api.common.PutToDebugLog(3,"EVENT, HandleSettingsSDK called");var t=webphone_api.parameters.serveraddress;!webphone_api.common.isNull(t)&&t.length>1&&(webphone_api.common.SaveParameter("serveraddress",t,!0),webphone_api.common.SaveParameter("serveraddress_user",t,!0),webphone_api.common.SaveParameter("serveraddress_orig",t,!0),webphone_api.common.SaveParameter("iswebrtcuppersrvfromuser","true")),Xt.length<1&&(Xt=webphone_api.common.GetSettFilenameSDK()),webphone_api.common.PutToDebugLogSpecial(1,"EVENT, HandleSettingsSDK settfilename: "+Xt,!1,""),webphone_api.common.PutToDebugLog(3,"EVENT, HandleSettingsSDK settfilename: "+Xt),webphone_api.common.ReadSettingsFile(Xt,function(t){webphone_api.common.PutToDebugLog(5,"EVENT, plhandler GetSettings callback"),t||webphone_api.common.PutToDebugLog(5,"EVENT, plhandler GetSettings ReadSettings no content");var n=webphone_api.parameters.serveraddress;!webphone_api.common.isNull(n)&&n.length>1&&(webphone_api.common.SaveParameter("serveraddress",n,!0),webphone_api.common.SaveParameter("serveraddress_user",n,!0),webphone_api.common.SaveParameter("serveraddress_orig",n,!0)),webphone_api.common.isNull(Yt)||(clearTimeout(Yt),Yt=null),webphone_api.common.SaveSettingsFile(3,Xt,function(t){if(webphone_api.common.PutToDebugLog(3,"EVENT, plhandler: HandleSettingsSDK settings SAVED"),!Jt){Jt=!0;var n=webphone_api.common.GetParameter2("register");(webphone_api.common.isNull(n)||n.length<1)&&(n="0");var i=webphone_api.common.StrToInt(n);if(0===webphone_api.common.GetAutostart())return webphone_api.common.PutToDebugLog(2,"EVENT, autostart is disabled, Start must be called manually"),void e("autostart is disabled");i<1?o():webphone_api.common.GetSipusername().length>0&&webphone_api.common.GetParameter("password").length>0&&o(),webphone_api.common.HandleScurlSetparameters(),webphone_api.common.ParseSipAccounts(),e("finished normally")}Jt=!0})})}catch(n){webphone_api.common.PutToDebugLogSpecial(1,"ERROR, plhandler HandleSettingsSDK",!0,n),webphone_api.common.PutToDebugLogException(2,"plhandler: HandleSettingsSDK",n),e("ERROR,exception")}}function r(){try{if(dn)return;if(setTimeout(function(){webphone_api.common.IsLastUsedEngineSaved()||(webphone_api.common.PutToDebugLog(4,"EVENT, reset last used engine"),webphone_api.common.SaveParameter("lastusedengine",""),webphone_api.global.last_used_engine_cache="")},4e3),!1===bn&&!0===webphone_api.common.IsSDK()&&webphone_api.common.ReadCallhistoryFile(function(e){e||webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: Load call history failed")}),an>190)return;!1===webphone_api.common.IsWindowsSoftphone()&&webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(4,"EVENT, plhandler StartEngine called"),webphone_api.common.PutToDebugLog(2,"EVENT, starting engine...")),webphone_api.common.HideSettings("voicemail","","voicemail",!0)&&webphone_api.common.SaveParameter("voicemail","0"),(webphone_api.common.HideSettings("chat","","chat",!0)||3==webphone_api.common.GetParameterInt("chatsms",0)||0==webphone_api.common.GetParameterInt("textmessaging",-1))&&(webphone_api.global.textmessaging=0);var e=webphone_api.common.GetParameter("serveraddress_user"),t=webphone_api.common.GetSipusername();(webphone_api.common.isNull(t)||t.length<1)&&(t=webphone_api.common.GetSipusername());var n=webphone_api.common.GetParameter("password"),i=webphone_api.common.GetParameter("registerinterval");if(!webphone_api.common.isNull(t)&&t.length>0&&!webphone_api.common.isNull(n)&&n.length>0){webphone_api.common.isNull(e)&&(e=""),(webphone_api.common.isNull(i)||0==webphone_api.common.IsNumber(i))&&(i="3600");var a=webphone_api.common.StrToInt(i),r=!1;if(webphone_api.global.sipaccounts.length<1)r=!0;else for(var s=0;s<webphone_api.global.sipaccounts.length;s++){var p=webphone_api.global.sipaccounts[s];if(!webphone_api.common.isNull(p)&&(p.username===t&&p.password===n&&p.serveraddress===e)){r=p.ismain;break}}var c=webphone_api.common.GetParameter("username"),u=webphone_api.common.GetParameter("displayname"),h=webphone_api.common.GetParameter("proxyaddress"),g=webphone_api.common.GetParameter("realm");webphone_api.common.AddOneAcc(e,t,n,a,!0,r,!0,c,u,h,g)}dn=!0,setTimeout(function(){dn=!1},2e3),nn=null,webphone_api.common.IsWindowsSoftphone()?we("platform","desktop"):webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()&&we("platform","web");var m=webphone_api.common.GetParameter("messagepopup");if(!webphone_api.common.isNull(m)&&m.length>1&&setTimeout(function(){(!0===webphone_api.common.IsSDK()||webphone_api.$(".ui-page-active .ui-popup-active").length<1)&&(webphone_api.common.ShowToast(m),webphone_api.common.SaveParameter("messagepopup",""))},4500),webphone_api.common.IsWindowsSoftphone())return webphone_api.common.PutToDebugLog(2,"EVENT, start engine: windows softphone - NS engine"),webphone_api.webphone.StartWin(),!0;var d=webphone_api.common.GetSelectedEngineName(),b=webphone_api.common.GetRecommendedEngineName();if(webphone_api.common.isNull(d)||d.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler StartUp no selected engine available"),!1;if(!0===webphone_api.global.isfirststart||webphone_api.common.isNull(webphone_api.global.useengine)||webphone_api.global.useengine.length<2)webphone_api.common.PutToDebugLog(2,"EVENT, StartEngine set useengine: "+d),webphone_api.global.useengine=d,webphone_api.global.isfirststart=!1;else{if(webphone_api.common.isNull(b)||b.length<1){var _=webphone_api.common.GetEngine(d);return _.failed=1,webphone_api.common.SetEngine(d,_),webphone_api.common.PutToDebugLog(4,"EVENT, WaitForEngineSelect called_3"),webphone_api.common.EngineSelect(1,29),o(),!1}webphone_api.common.PutToDebugLog(2,"EVENT, StartEngine recommended set useengine: "+b),webphone_api.global.useengine=b}if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()&&"flash"===webphone_api.common.getuseengine()){var f=window.location.protocol
;!webphone_api.common.isNull(f)&&f.length>0&&f.toLowerCase().indexOf("file")>=0&&("0"===webphone_api.common.GetParameter2("enginepriority_java")&&"0"===webphone_api.common.GetParameter2("enginepriority_webrtc")&&"0"===webphone_api.common.GetParameter2("enginepriority_ns")||"flash"===webphone_api.common.getuseengine())&&(webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_flash_local")),console.log(webphone_api.stringres.get("err_flash_local")))}try{webphone_api.onAppStateChangeCb("started")}catch(P){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(started) callback",P)}try{webphone_api.onStartCb()}catch(P){webphone_api.common.PutToDebugLogException(2,"There is an error in onStart() callback",P)}if(webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onstart,"onStart","","","",""),!0===webphone_api.common.UseCustomAutoprov(!1)&&webphone_api.common.GetCustomAutoprov(function(e){webphone_api.common.RecAutoprovCustom(e)}),!1===webphone_api.common.Loa()){var w=[];w.push("E"),w.push("R"),w.push("R"),w.push("O"),w.push("R"),w.push(","),w.push(" "),w.push("o"),w.push("n"),w.push("l"),w.push("y"),w.push(" "),w.push("a"),w.push("n"),w.push("d"),w.push("r"),w.push("o"),w.push("i"),w.push("d");var v=w.join("");setTimeout(function(){webphone_api.common.PutToDebugLog(2,v)},1214),setTimeout(function(){l(!1,"a")},6e4)}else l(!1,"b");Et()}catch(P){webphone_api.common.PutToDebugLogException(2,"plhandler: StartEngine",P)}}function s(e){try{(webphone_api.common.isNull(e)||e.length<1)&&(webphone_api.common.PutToDebugLog(2,"ERROR, ParseReceivedParameters invalid parameters: "+e),l(!0,"c")),e=webphone_api.common.Trim(e),e.indexOf("error")>=0&&(webphone_api.common.PutToDebugLog(2,"ERROR, ParseReceivedParameters error received: "+e),l(!0,"d"));var t=e.split(",");if(!webphone_api.common.isNull(t)&&t.length>0)for(var n=0;n<t.length;n++)if(!(webphone_api.common.isNull(t[n])||t[n].length<3||t[n].indexOf("=")<1)){var o=webphone_api.common.Trim(t[n].substring(0,t[n].indexOf("="))),i=webphone_api.common.Trim(t[n].substring(t[n].indexOf("=")+1,t[n].length));!webphone_api.common.isNull(o)&&o.length>0&&!webphone_api.common.isNull(i)&&(o=o.toLowerCase(),webphone_api.common.SaveParameter(o,i))}}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: ParseReceivedParameters",a)}webphone_api.common.PutToDebugLog(2,"EVENT, scurl_setparameters STOP"),Ue(!1,1),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Start scurl_setparameters START"),webphone_api.start()},1500)}function l(e,t){p(e,t)}function p(e,t){try{if(webphone_api.common.PutToDebugLog(4,"EVENT, start engine delayed "+t+" "+webphone_api.global.useengine),webphone_api.global.startendelayed_wascalled=!0,e&&(webphone_api.global.flagnsreconnect=!0),webphone_api.global.phonestarted>1&&!1===webphone_api.global.enstarteddisplayed){webphone_api.global.enstarteddisplayed=!0;var n="",o=webphone_api.common.getuseengine();n=o===webphone_api.global.ENGINE_JAVA?"jv":o===webphone_api.global.ENGINE_SERVICE?"ns":o===webphone_api.global.ENGINE_WEBRTC?"rtc":o,!1===webphone_api.common.IsWindowsSoftphone()&&webphone_api.common.PutToDebugLog(1,"EVENT,"+webphone_api.stringres.get("status_enginestarted")+" ("+n+")")}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE||(webphone_api.common.getuseengine(),webphone_api.global.ENGINE_JAVA),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){var i=1e3;1!==webphone_api.common.GetParameterInt("autoaction",0)&&3!==webphone_api.common.GetParameterInt("autoaction",0)||(i=1e4),g(i)}webphone_api.common.CanLog(5)&&(webphone_api.common.PutToDebugLog(5,"EVENT, enginepriority_java: "+webphone_api.common.GetCfgPriority("java")+" "+webphone_api.common.GetParameter2("enginepriority_java")),webphone_api.common.PutToDebugLog(5,"EVENT, enginepriority_webrtc: "+webphone_api.common.GetCfgPriority("webrtc")+" "+webphone_api.common.GetParameter2("enginepriority_webrtc")),webphone_api.common.PutToDebugLog(5,"EVENT, enginepriority_ns: "+webphone_api.common.GetCfgPriority("ns")+" "+webphone_api.common.GetParameter2("enginepriority_ns")),webphone_api.common.PutToDebugLog(5,"EVENT, enginepriority_flash: "+webphone_api.common.GetCfgPriority("flash")+" "+webphone_api.common.GetParameter2("enginepriority_flash")),webphone_api.common.PutToDebugLog(5,"EVENT, enginepriority_app: "+webphone_api.common.GetCfgPriority("app")+" "+webphone_api.common.GetParameter2("enginepriority_app")),webphone_api.common.PutToDebugLog(5,"EVENT, enginepriority_p2p: "+webphone_api.common.GetCfgPriority("p2p")+" "+webphone_api.common.GetParameter2("enginepriority_p2p")),webphone_api.common.PutToDebugLog(5,"EVENT, enginepriority_accessnum: "+webphone_api.common.GetCfgPriority("accessnum")+" "+webphone_api.common.GetParameter2("enginepriority_accessnum")),webphone_api.common.PutToDebugLog(5,"EVENT, enginepriority_nativedial: "+webphone_api.common.GetCfgPriority("nativedial")+" "+webphone_api.common.GetParameter2("enginepriority_nativedial"))),webphone_api.common.SaveParameter("lastsessionsuccess","1");var n="",o=webphone_api.common.getuseengine();n=o===webphone_api.global.ENGINE_JAVA?"jv":o===webphone_api.global.ENGINE_SERVICE?"ns":o===webphone_api.global.ENGINE_WEBRTC?"rtc":o,!1===webphone_api.common.IsWindowsSoftphone()&&(webphone_api.common.PutToDebugLog(1,"STATUS,-1,"+webphone_api.stringres.get("status_startingengine")+" ("+n+")"),webphone_api.common.PutToDebugLog(3,"EVENT, starting useengine: "+webphone_api.common.getuseengine()));var a=[];if(a.push("E"),a.push("R"),a.push("R"),a.push("O"),a.push("R"),a.push(","),a.push(" "),a.push("T"),a.push("h"),a.push("e"),a.push(" "),a.push("B"),a.push("a"),a.push("s"),a.push("i"),a.push("c"),a.push(" "),a.push("v"),a.push("e"),a.push("r"),a.push("s"),a.push("i"),a.push("o"),a.push("n"),a.push(" "),a.push("o"),a.push("f"),a.push(" "),a.push("W"),a.push("e"),a.push("b"),a.push("p"),a.push("h"),a.push("o"),a.push("n"),a.push("e"),a.push(" "),a.push("d"),a.push("o"),a.push("e"),a.push("s"),a.push(" "),a.push("n"),a.push("o"),a.push("t"),a.push(" "),a.push("s"),a.push("u"),a.push("p"),a.push("p"),a.push("o"),a.push("r"),a.push("t"),a.push(" "),a.push("["),a.push("B"),a.push("R"),a.push("S"),a.push("]"),a.push(" "),a.push("b"),a.push("r"),a.push("o"),a.push("w"),a.push("s"),a.push("e"),a.push("r"),webphone_api.common.Glv()<=0&&"Chrome"===webphone_api.common.GetBrowser()){var r=a.join("");return r=r.replace("[BRS]",webphone_api.common.GetBrowser()),setTimeout(function(){webphone_api.common.PutToDebugLog(1,r)},1500),setTimeout(function(){webphone_api.common.PutToDebugLog(1,r.replace("ERROR","STATUS"))},2500),void setTimeout(function(){webphone_api.common.AlertDialog("",r)},2500)}if(webphone_api.common.Glv()<=0&&!1===webphone_api.common.CanIUseApplet()){var r=a.join("");return r=r.replace("[BRS]",webphone_api.common.GetBrowser()),setTimeout(function(){webphone_api.common.PutToDebugLog(1,r)},1450),setTimeout(function(){webphone_api.common.PutToDebugLog(1,r.replace("ERROR","STATUS"))},2450),void setTimeout(function(){webphone_api.common.AlertDialog("",r)},2450)}var s=webphone_api.common.GetEngine(webphone_api.global.useengine);webphone_api.global.useengineclicked_cache=s.clicked,s.clicked=1,webphone_api.common.SetEngine(webphone_api.global.useengine,s),webphone_api.common.AutodetectDirectWebrtc(),webphone_api.global.lastconfroom="";var l=webphone_api.common.GetParameter("username"),p=webphone_api.common.GetParameter("sipusername"),m="";if(l.indexOf("@")>0?m=l:p.indexOf("@")>0&&(m=p),m.length>0&&webphone_api.common.GetParameterInt("allowsipuriasusername",0)>0){m=m.substring(p.indexOf("@")+1);var d=webphone_api.common.GetParameter2("serveraddress");(webphone_api.common.isNull(d)||d.length<1)&&(d=webphone_api.common.GetParameter2("serveraddress_user")),!webphone_api.common.isNull(d)&&d.length<2&&"YOURSIPDOMAIN.COM"!==d&&"YOURSIPSERVER.COM"!==d&&"SIPSERVER"!==d&&"VOIPSERVER"!==d&&"SERVERADDRESS"!==d&&(webphone_api.common.SaveParameter("serveraddress",m),webphone_api.common.SaveParameter("serveraddress_user",m))}var b=webphone_api.common.GetParameter2("serveraddress");if((webphone_api.common.isNull(b)||b.length<2||"YOURSIPDOMAIN.COM"===b||"YOURSIPSERVER.COM"===b||"SIPSERVER"===b||"VOIPSERVER"===b||"SERVERADDRESS"===b)&&(webphone_api.common.SaveParameter("serveraddress",""),b=webphone_api.common.GetParameter2("serveraddress_user"),webphone_api.common.isNull(b)||b.length<2||"YOURSIPDOMAIN.COM"===b||"YOURSIPSERVER.COM"===b||"SIPSERVER"===b||"VOIPSERVER"===b||"SERVERADDRESS"===b))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("error_noserver")),webphone_api.common.PutToDebugLog(2,"ERROR,"+webphone_api.stringres.get("error_noserver")+"; srv: "+webphone_api.common.GetParameter("serveraddress")+"; srv_user: "+webphone_api.common.GetParameter("serveraddress_user")),webphone_api.common.AlertDialog("ERROR","ERROR,"+webphone_api.stringres.get("error_noserver")),"undefined"!=typeof webphone_api.global.worktimer&&null!==webphone_api.global.worktimer&&clearTimeout(webphone_api.global.worktimer),void(webphone_api.global.worktimer=null);var _=webphone_api.common.GetSipusername(),f=webphone_api.common.GetParameter2("password");if("USERNAME"===_&&"PASSWORD"===f&&("USERNAME"===webphone_api.common.GetParameter("username")&&webphone_api.common.SaveParameter("username",""),"USERNAME"===webphone_api.common.GetParameter("sipusername")&&webphone_api.common.SaveParameter("sipusername",""),webphone_api.common.SaveParameter("password","")),webphone_api.common.StartFCM(webphone_api.common.getuseengine()),"java"===webphone_api.common.getuseengine()){webphone_api.common.ResetWsapisocket("plhandler start java");var w=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_java")),v=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_webrtc")),P=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_ns")),E=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_flash")),T=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_app")),N=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_p2p")),S=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_accessnum")),I=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_nativedial"));return(5===w||w>0&&v<1&&P<1&&E<1&&T<1&&N<1&&S<1&&I<1)&&0===webphone_api.common.IsJavaInstalled()&&webphone_api.common.EngineForcedInstall("java"),webphone_api.common.IsCurrentEngineWorking(nn),webphone_api.common.PutToDebugLog(2,"EVENT, start engine: java"),webphone_api.global.dispregfailed<1&&(webphone_api.global.dispregfailed=1),h(),webphone_api.webphone.Start()}if("ns"===webphone_api.common.getuseengine())return 5===webphone_api.common.GetParameterInt("enginepriority_ns",2)&&webphone_api.common.IsServiceInstalled(function(e){!1===e&&(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: StartEngineDelayed, service upgrade: "+webphone_api.common.GetMinServiceVersion().toString()),webphone_api.common.EngineForcedInstall("ns"))},!0),void webphone_api.common.IsServiceInstalled(function(e){if(!0===e){webphone_api.common.PutToDebugLog(2,"EVENT, start engine: service");var t=!1,n=webphone_api.common.GetParameterInt("lnsengine",-1);!1===webphone_api.global.usestorage&&!1===webphone_api.common.Strl(60)&&0===n&&(t=!0,webphone_api.common.SaveParameter("lnsengine","1"));var o=6e3;t&&(webphone_api.common.PutToDebugLog(2,"EVENT, Force NS engine upgrade because release version changed"),webphone_api.common.EngineForcedInstall("ns",webphone_api.stringres.get("service_update")),webphone_api.global.nsupdatepending=!0,o=18e4),setTimeout(function(){webphone_api.common.IsServiceUpToDate()},o),webphone_api.global.dispregfailed<1&&(webphone_api.global.dispregfailed=1),h(),webphone_api.webphone.StartService()}else webphone_api.common.isNull(webphone_api.global.worktimer)||clearTimeout(webphone_api.global.worktimer),webphone_api.common.PutToDebugLog(2,"EVENT, start engine: service; NOT starting because it is not installed")},!0);if("webrtc"===webphone_api.common.getuseengine()){var C=0;C=webphone_api.common.GetParameterInt("autoprovisioning",1);var R=ve("serveraddress_user");if(webphone_api.common.isNull(R)&&(R=""),0===C||R.length<1||1===C&&R.indexOf(".")>0)c();else{var G=webphone_api.common.GetParameterInt("lastautoprov",0);G<1?webphone_api.common.GetAutoprovisioning("",function(e){webphone_api.common.ParseAutoprovisioning(e),c()}):(c(),webphone_api.common.GetAutoprovisioning("",function(e){webphone_api.common.ParseAutoprovisioning(e)}))}return}if("flash"===webphone_api.common.getuseengine()){var C=0;C=webphone_api.common.GetParameterInt("autoprovisioning",1);var R=ve("serveraddress_user");if(webphone_api.common.isNull(R)&&(R=""),0===C||R.length<1||1===C&&R.indexOf(".")>0)u();else{var G=webphone_api.common.GetParameterInt("lastautoprov",0);G<1?webphone_api.common.GetAutoprovisioning("",function(e){webphone_api.common.ParseAutoprovisioning(e),u()}):(u(),webphone_api.common.GetAutoprovisioning("",function(e){webphone_api.common.ParseAutoprovisioning(e)}))}return}if("app"===webphone_api.common.getuseengine()){var y=webphone_api.common.GetParameterInt("appengine_startat",2);1===y||2===y&&!1===webphone_api.common.IsSDK()?webphone_api.common.StartAppEngine(!0,"EVENT, start engine: app HandleProtocol, open native app"):(webphone_api.common.PutToDebugLog(2,"EVENT, start engine: skip APP engine start, appengine_startat: "+y+"; isSDK: "+webphone_api.common.IsSDK()),webphone_api.common.PutToDebugLog(1,"EVENT, Ready."))}else webphone_api.common.PutToDebugLog(2,"ERROR, start engine: invalid engine: "+webphone_api.common.getuseengine());setTimeout(function(){webphone_api.global.startendelayed_wascalled=!1},12e3)}catch(L){webphone_api.common.PutToDebugLogException(2,"plhandler: StartEngineDelayedEx",L)}}function c(){try{if(fn<0&&(fn=webphone_api.common.GetTickCount()),!1===webphone_api.global.decideusuk_finished&&(webphone_api.common.isNull(_n)||clearTimeout(_n),_n=null,_n=setTimeout(function(){c()},150)),webphone_api.common.isNull(_n)||clearTimeout(_n),_n=null,fn>0&&webphone_api.common.GetTickCount()-fn>6500&&!0===webphone_api.common.GetParameterBool("firststart_webrtc",!0)&&!0===webphone_api.common.CanIUseService()){webphone_api.common.PutToDebugLog(2,"WARNING, StartEngineWebRTC Failover to NS engine, because no response received from Websocket wsload"),webphone_api.common.SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,webphone_api.common.ResetEngineClicked();var e=webphone_api.common.GetEngine("ns");e.clicked=2,webphone_api.common.SetEngine("ns",e),webphone_api.common.EngineSelect(1,30),webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: offer ns engine because webrtc not received"),webphone_api.common.IsServiceInstalled(function(e){!1===e?webphone_api.common.EngineForcedInstall("ns",webphone_api.stringres.get("serviceengine_msg"),null,function(){webphone_api.startInner()}):webphone_api.startInner()},!0)}fn=-1,webphone_api.common.ResetWsapisocket("plhandler start webrtc");var t=webphone_api.common.GetParameter("password");(webphone_api.common.isNull(t)||t.length<1)&&!1===webphone_api.common.NeedRegister()||n(),!0===webphone_api.common.UseTLSReload()&&webphone_api.common.TLSReload(),webphone_api.common.Ch(),webphone_api.common.PutToDebugLog(2,"EVENT, start engine: webrtc"),webphone_api.common.CheckEngineFirstStart(nn),webphone_api.common.GatewayFailower(-1,"starten");var o=webphone_api.common.GetWebrtcSrvAddr();if(2===webphone_api.common.GetConfigInt("usemizuwebrtcgateway",1)&&(o=""),(webphone_api.common.isNull(o)||o.length<2)&&(o=webphone_api.common.GetWp()),o.indexOf("mfstwebsock")<0){var i=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_java")),a=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_webrtc")),r=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_ns")),s=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_flash")),l=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_app")),p=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_p2p")),u=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_accessnum")),g=webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_nativedial"));i<3&&a<3&&r<3&&s<3&&l<3&&p<3&&u<3&&g<3&&(a=3,webphone_api.common.SaveParameter("enginepriority_webrtc",a),webphone_api.common.PutToDebugLog(2,"EVENT,WebRtc engine priority set to higher, because not Mgateway: "+a))}return"Android"===webphone_api.common.GetOs()&&3===webphone_api.common.GetParameterInt("androidspeaker",1)&&setTimeout(function(){webphone_api.webrtcapi.SwitchOffAndroidSpeaker()},500),webphone_api.global.dispregfailed<1&&(webphone_api.global.dispregfailed=1),h(),webphone_api.webrtcapi.Start()}catch(m){webphone_api.common.PutToDebugLogException(2,"plhandler: StartEngineWebRTC",m)}}function u(){try{return webphone_api.common.PutToDebugLog(2,"EVENT, start engine: flash"),webphone_api.global.dispregfailed<1&&(webphone_api.global.dispregfailed=1),h(),webphone_api.flashapi.Start()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: StartEngineFlash",e)}}function h(){try{var e=webphone_api.common.GetAutostart();if(!0===webphone_api.common.IsSDK()||0!==e)return!1;setTimeout(function(){if("page_settings"===webphone_api.$.mobile.activePage.attr("id")){webphone_api.common.PutToDebugLog(2,"EVENT, plhandler LoginSkin exec");var e=webphone_api.common.GetSipusername(),t=webphone_api.common.GetParameter("password");return!webphone_api.common.isNull(e)&&e.length>0&&!webphone_api.common.isNull(t)&&t.length>0?(webphone_api.global.laststarttick=webphone_api.common.GetTickCount()+100,void(webphone_api.common.isNull(webphone_api._settings)||webphone_api._settings.SaveSettings())):void 0}},600)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: LoginSkin",t)}}function g(e,t){try{if(wn>0&&webphone_api.common.GetTickCount()-wn<3e3)return;wn=webphone_api.common.GetTickCount(),(webphone_api.common.isNull(e)||!1===webphone_api.common.IsNumber(e)||e<0)&&(e=2e3);var n=200;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(n=150),webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu called delay: "+e+"; delayaddition: "+n),!0===t)return setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 0"),webphone_api.getdevicelist(0,function(e){}),webphone_api.getdevice(0,function(e){})},e),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 1"),webphone_api.getdevicelist(1,function(e){}),webphone_api.getdevice(1,function(e){})},e+150),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 2"),webphone_api.getdevicelist(2,function(e){}),webphone_api.getdevice(2,function(e){})},e+300),void webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu return forced");(webphone_api.common.isNull(webphone_api.global.audio_rec_device_list)||webphone_api.global.audio_rec_device_list.length<1)&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist mic"),webphone_api.getdevicelist(0,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec mic 1")}),webphone_api.getdevice(0,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec mic 2")})},e+n),(webphone_api.common.isNull(webphone_api.global.audio_play_device_list)||webphone_api.global.audio_play_device_list.length<1)&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist play"),webphone_api.getdevicelist(1,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec play 1")}),webphone_api.getdevice(1,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec play 2")})},e+2*n),(webphone_api.common.isNull(webphone_api.global.audio_ring_device_list)||webphone_api.global.audio_ring_device_list.length<1)&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist ring"),webphone_api.getdevicelist(2,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec ring 1")}),webphone_api.getdevice(2,function(e){webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec ring 2")})},e+3*n),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.common.isNull(webphone_api.global.video_rec_device_list)||webphone_api.global.video_rec_device_list.length<1)&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist video"),webphone_api.getdevicelist(3,function(e){}),webphone_api.getdevice(3,function(e){})},e+4*n),setTimeout(function(){if(webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu START checking audio_rec_device_list: "+webphone_api.global.audio_rec_device_list+"; audio_play_device_list: "+webphone_api.global.audio_play_device_list),!webphone_api.common.isNull(webphone_api.global.audio_rec_device_list)&&webphone_api.global.audio_rec_device_list.length>0&&!webphone_api.common.isNull(webphone_api.global.audio_play_device_list)&&webphone_api.global.audio_play_device_list.length>0){var t=webphone_api.common.GetTickCount()-wn;webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu READY on first try after delay: "+t),webphone_api.global.audio_devices_loaded=!0}else setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 0"),webphone_api.getdevicelist(0,function(e){}),webphone_api.getdevice(0,function(e){})},e+2e4+n),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 1"),webphone_api.getdevicelist(1,function(e){}),webphone_api.getdevice(1,function(e){})},e+2e4+2*n),setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 2"),webphone_api.getdevicelist(2,function(e){}),webphone_api.getdevice(2,function(e){})},e+2e4+3*n),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 3"),webphone_api.getdevicelist(3,function(e){}),webphone_api.getdevice(3,function(e){})},e+2e4+4*n),setTimeout(function(){if(!webphone_api.common.isNull(webphone_api.global.audio_rec_device_list)&&webphone_api.global.audio_rec_device_list.length>0&&!webphone_api.common.isNull(webphone_api.global.audio_play_device_list)&&webphone_api.global.audio_play_device_list.length>0){var e=webphone_api.common.GetTickCount()-wn;webphone_api.common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu READY on second try after delay: "+e),webphone_api.global.audio_devices_loaded=!0}},e+4*n)},e+3*n+500)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetAudioDevicesForMenu",o)}}function m(e){try{Mt("Register");var n=webphone_api.common.GetParameterInt("register",1);if(webphone_api.parameters.register=2,webphone_api.common.SaveParameter("register","2"),webphone_api.common.PutToDebugLog(2,"EVENT, user, register (API_Register) called"),Zt)return void webphone_api.common.PutToDebugLog(3,"EVENT, plhandler register, Start already called");tn=!0,webphone_api.common.isNull(en)||clearTimeout(en),en=setTimeout(function(){tn=!1},6e3);var o=webphone_api.common.IsConfigChanged();!0===o&&!0===webphone_api.isregistered()||!0===webphone_api.global.pres_unreg_called||0===n||0!=vn&&webphone_api.common.GetTickCount()-vn>12e3&&!webphone_api.isregistered()?(!0===o&&!0===webphone_api.isregistered()?webphone_api.common.PutToDebugLog(5,"EVENT, rst on config changhe"):!0===webphone_api.global.pres_unreg_called?webphone_api.common.PutToDebugLog(5,"EVENT, rst on after unreg"):0===n?webphone_api.common.PutToDebugLog(5,"EVENT, rst on no orig reg"):0!=vn&&webphone_api.common.GetTickCount()-vn>12e3&&!webphone_api.isregistered()?webphone_api.common.PutToDebugLog(5,"EVENT, rst on not registered"):webphone_api.common.PutToDebugLog(5,"EVENT, rst on unknown"),vn=webphone_api.common.GetTickCount(),t(e)):0==vn||tn||d()}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: Register",i)}}function d(){try{if(webphone_api.common.PutToDebugLog(3,"EVENT, Reregister ..."),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void(webphone_api.webrtcapi&&webphone_api.webrtcapi.ResendRegister());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_RegisterNoParam",null,-1);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()&&webphone_api.webphone&&webphone_api.webphone.applethandle)return webphone_api.webphone.ReRegister()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: ReRegister",e)}}function b(e){try{Mt("RegisterEx");var t=25;if(webphone_api.common.Glv()<2&&(t=13),webphone_api.common.isNull(e)||e.length<4)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler RegisterEx no acocunts passed: "+e);if(e=e.toString(),e=webphone_api.common.ReplaceAll(e," ",""),webphone_api.common.isNull(e)||e.length<4)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler RegisterEx no acocunts passed: "+e);if(t<21){var n=[];n.push("E"),n.push("R"),n.push("R"),n.push("O"),n.push("R"),n.push(","),n.push("R"),n.push("e"),n.push("g"),n.push("i"),n.push("s"),n.push("t"),n.push("e"),n.push("r"),n.push("E"),n.push("x"),n.push(" "),n.push("n"),n.push("o"),n.push("t"),n.push(" "),n.push("a"),n.push("l"),n.push("l"),n.push("o"),n.push("w"),n.push("e"),n.push("d"),n.push(" "),n.push("b"),n.push("y"),n.push(" "),n.push("l"),n.push("i"),n.push("c"),n.push("e"),n.push("n"),n.push("s"),n.push("e");var o=n.join("");return void setTimeout(function(){webphone_api.common.PutToDebugLog(1,o)},851)}webphone_api.common.SaveParameter("extraregisteraccounts",e),webphone_api.common.PutToDebugLog(2,"EVENT, plhandler RegisterEx: "+e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.webrtcapi.RegisterEx(e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH&&webphone_api.common.PutToDebugLog(2,"ERROR, RegisterEx is not supported by flash engine"),webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_RegisterEx",null,e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.RegisterEx(e)}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: RegisterEx",i)}}function _(e,t){try{if(Mt("CheckPresence"),webphone_api.common.isNull(e)||e.length<1)return"";if(webphone_api.global.phonestarted<2)return void Ht("CheckPresence",[e,t]);if(webphone_api.common.PutToDebugLog(2,"EVENT, user, checkpresence (API_CheckPresence), userlist: "+e),t&&"function"==typeof t&&(webphone_api.common.isNull(webphone_api.global.checkpres_callback)&&(webphone_api.global.checkpres_callback=[]),webphone_api.global.checkpres_callback.push(t)),webphone_api.common.PresenceGet2(e),!webphone_api.common.isNull(webphone_api.global.presenceHM)){var n={5:"online",4:"DND",3:"pending",2:"idle",1:"invisible",0:"offline","-1":"not exists"},o="";for(var i in webphone_api.global.presenceHM)webphone_api.common.isNull(i)||i.length<1||webphone_api.common.isNull(webphone_api.global.presenceHM.num)||(o.length>1&&(o+=";"),o=o+i+","+n[o.num[webphone_api.common.PRES_STATUS]]);return webphone_api.common.isNull(o)&&(o=""),o}}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: CheckPresence",a)}return""}function f(e){if(Mt("SetPresenceStatus"),webphone_api.global.phonestarted<2)return void Ht("SetPresenceStatus",[e]);webphone_api.common.PutToDebugLog(2,"EVENT, user, setpresencestatus (API_SetPresenceStatus), status: "+e),webphone_api.common.PresenceSet2(e)}function w(e){Mt("CheckBLF");try{if(webphone_api.common.isNull(e)||e.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler checkblf empty userkist"),!1;if(webphone_api.global.phonestarted<2)return void Ht("CheckBLF",[e]);if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler API_CheckBLF: "+e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.common.PutToDebugLog(2,"WARNING, BLF is not yet supported on WebRTC"),!1;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"WARNING, BLF is not yet supported on flash"),!1;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_CheckBLF",null,e),!0;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.CheckBLF(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: CheckBLF",t)}return!1}function v(e){Mt("GetVersionNS");try{if(!e||"function"!=typeof e)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetVersionNS: no callback function specified"),"ERROR, no callback function specified";if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler getversionns"),webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetExeVersion",function(t){webphone_api.common.isNull(t)&&(t=""),t=t.toString(),t=t.replace("OK:",""),t=webphone_api.common.Trim(t),e(t)}),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var t=webphone_api.webphone.GetVersionNS();t=t.toString(),t=t.replace("OK:",""),t=webphone_api.common.Trim(t),e(t)}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetVersionNS",n)}}function P(e){Mt("GetVersionNSNum");try{if(!e||"function"!=typeof e)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetVersionNSNum: no callback function specified"),"ERROR, no callback function specified";if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler getversionnsnum"),webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetExeVersionNumber",function(t){webphone_api.common.isNull(t)&&(t=""),t=t.toString(),t=t.replace("OK:",""),t=webphone_api.common.Trim(t),e(t)}),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var t=webphone_api.webphone.GetVersionNSNum();webphone_api.common.isNull(t)&&(t=""),t=t.toString(),t=t.replace("OK:",""),t=webphone_api.common.Trim(t),e(t)}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetVersionNS",n)}}function E(e){Mt("GetVersionJava");try{if(!e||"function"!=typeof e)return webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetVersionJava: no callback function specified"),"ERROR, no callback function specified";if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler getversionjava"),webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetExeVersion",function(t){
webphone_api.common.isNull(t)&&(t=""),e(t)}),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return void e(webphone_api.webphone.GetVersionJava())}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetVersionJava",t)}}function T(){try{if(Mt("IsEncrypted"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return 3;if(webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.global.useengine!==webphone_api.global.ENGINE_SERVICE&&webphone_api.global.useengine!==webphone_api.global.ENGINE_JAVA)return 0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_IsEncrypted",function(e){!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)&&(webphone_api.global.isencrypted=e)}),0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.IsEncrypted()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: IsEncrypted",e)}return 0}function N(e,t){try{if(Mt("SetSipHeader"),webphone_api.common.isNull(e))return void webphone_api.common.PutToDebugLog(2,"ERROR, SetSipHeader invalid header. A valid SIP header consists of a name/value pair separated by a colon, ex. Headername: Value");if(webphone_api.global.phonestarted<2)return void Ht("SetSipHeader",[e]);webphone_api.common.PutToDebugLog(2,"EVENT, setsipheader: "+e);var n=webphone_api.global.aline;if(!webphone_api.common.isNull(t)&&webphone_api.common.IsNumber(t)&&(n=t),(webphone_api.common.isNull(n)||-3===n)&&(n=-1),e=webphone_api.common.Trim(e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SetSipHeader(n,e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void webphone_api.common.PutToDebugLog(2,"ERROR, setsipheader is not supported by flash engine");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SetSIPHeader",null,webphone_api.common.GetLineForJavaAPI(t),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.SetSipHeader(webphone_api.common.GetLineForJavaAPI(t),e)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: SetSipHeader",o)}}function S(e,t){try{if(Mt("GetSipHeaderInternal"),!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetSipHeaderInternal callback is not defined");var n=webphone_api.global.aline;if((webphone_api.common.isNull(n)||-3===n)&&(n=-1),webphone_api.common.isNull(e)||e.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, Invalid header: "+e),void t("ERROR, Invalid header: "+e);if(e=e.toString(),e=e.replace(":",""),webphone_api.global.phonestarted<2)return void Ht("GetSipHeaderInternal",[e,t]);if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: GetSipHeaderInternal: "+e+"; ("+webphone_api.common.getuseengine()+")"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void t(webphone_api.common.GetSipHeaderInternal(e));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, GetSipHeaderInternal is not supported by flash engine"),void t("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetSipHeaderInternal",function(e){t(e)},webphone_api.common.GetLineForJavaAPI(n,1),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void t(webphone_api.webphone.GetSipHeaderInternal(webphone_api.common.GetLineForJavaAPI(n,1),e,t))}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetSipHeaderInternal",o)}}function I(e,t){try{if(Mt("GetSipHeader"),!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetSipHeader callback is not defined");var n=webphone_api.global.aline;if((webphone_api.common.isNull(n)||-3===n)&&(n=-1),webphone_api.common.isNull(e)||e.length<1)return webphone_api.common.PutToDebugLog(2,"ERROR, Invalid header: "+e),void t("ERROR, Invalid header: "+e);if(e=e.toString(),e=e.replace(":",""),webphone_api.global.phonestarted<2)return void Ht("GetSipHeader",[e,t]);if(webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: getsipheader: "+e+"; ("+webphone_api.common.getuseengine()+")"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void t(webphone_api.common.GetSipHeader(e));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getsipheader is not supported by flash engine"),void t("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetSIPHeader",function(e){t(e)},webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void t(webphone_api.webphone.GetSipHeader(webphone_api.common.GetLineForJavaAPI(),e,t))}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetSipHeader",o)}}function C(e,t,n){try{if(Mt("GetSipMessage"),!n||"function"!=typeof n)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetSipMessage callback is not defined");var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.global.phonestarted<2)return void Ht("GetSipMessage",[e,t,n]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void n(webphone_api.common.GetSipMessage(o,e,t));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, GetSipMessage is not supported by flash engine"),void n("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetSIPMessage",function(e){n(e)},webphone_api.common.GetLineForJavaAPI(),e,t);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void n(webphone_api.webphone.GetSipMessage(webphone_api.common.GetLineForJavaAPI(),e,t))}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: GetSipMessage",i)}}function R(e){try{if(Mt("GetSipMessage"),webphone_api.common.isNull(e)||!webphone_api.common.IsNumber(e))return!1;var t=webphone_api.common.StrToInt(e);if(t<0||t>45)return!1;if(webphone_api.common.PutToDebugLog(2,"EVENT, plhandler changetheme to: "+t.toString()),webphone_api.common.SaveParameter("theme",t.toString()),webphone_api.common.SetCurrTheme(),webphone_api.common.IsWindowsSoftphone()){var n=webphone_api.common.AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL)+"?extcmd_theme="+mSettValue;webphone_api.common.WinSoftphoneHttpReq(n,"GET","","",function(e){webphone_api.common.PutToDebugLog(2,"EVENT, plhandler, send theme to softphone response: "+e)})}}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: ChangeTheme",o)}return!1}function G(e){try{if(Mt("GetWorkDir"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetWorkDir callback is not definaed");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.common.PutToDebugLog(2,"ERROR, getworkdir: only for ns and java"),void e("ERROR, etworkdir: only for ns and java");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getworkdir: only for ns and java"),void e("ERROR, etworkdir: only for ns and java");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetWorkdir",function(t){e(t)});if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void e(webphone_api.webphone.GetWorkDir())}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetWorkDir",t)}}function y(e){Mt("VideoCall"),!1!==webphone_api.common.Glvd()&&x(e,1)}function L(e,t){try{return Mt("MuteVideo"),!1===webphone_api.global.checkIfCallActive?(webphone_api.common.PutToDebugLog(2,"ERROR, MuteVideo there is no active call at the moment."),!1):!1===webphone_api.global.isvideocall?(webphone_api.common.PutToDebugLog(2,"ERROR, MuteVideo this is not a video call."),!1):webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC?(webphone_api.common.PutToDebugLog(2,"ERROR, MuteVideo this is not WebRTC engine."),!1):(e?webphone_api.common.PutToDebugLog(1,"STATUS, "+webphone_api.stringres.get("muted_video")):webphone_api.common.PutToDebugLog(1,"STATUS, "+webphone_api.stringres.get("unmuted_video")),webphone_api.common.PutToDebugLog(2,"EVENT, USER, mutevideo (API_MuteVideo), "+e+", "+t),webphone_api.webrtcapi.SipMuteVideo(e,t))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: MuteVideo",n)}return!1}function O(e,t){function n(){x(e,2)}try{if(Mt("ScreenShare"),!1===webphone_api.common.Glss())return;webphone_api.common.IsWindowsSoftphone(),n()}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: ScreenShare",o)}}function D(){try{if(!webphone_api.global.usestorage)return;webphone_api.common.isNull(Pn)||(clearTimeout(Pn),Pn=null)}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: Cfin",e)}}function x(e,t){try{Mt("Call"),webphone_api.global.ringstart_time=0,webphone_api.global.callstart_time=0,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_APP&&!1===webphone_api.global.isappenginestarted&&webphone_api.common.StartAppEngine(!0,"EVENT, start engine: because initiating call",!0,e),Tn=!1;var n=115e3;if((webphone_api.common.isNull(t)||!1===webphone_api.common.IsNumber(t))&&(t=0),webphone_api.common.SvCont()&&(n=23e4),webphone_api.global.usestorage&&(Pn=setTimeout(function(){clearTimeout(Pn),Pn=null;var e=[];e.push("L"),e.push("i"),e.push("c"),e.push("e"),e.push("n"),e.push("s"),e.push("e"),e.push(" "),e.push("o"),e.push("r"),e.push(" "),e.push("d"),e.push("e"),e.push("m"),e.push("o "),e.push("l"),e.push("i"),e.push("m"),e.push("i"),e.push("t"),e.push(". "),e.push("R"),e.push("e"),e.push("s"),e.push("t"),e.push("a"),e.push("r"),e.push("t "),e.push("r"),e.push("e"),e.push("q"),e.push("u"),e.push("i"),e.push("r"),e.push("e"),e.push("d"),e.push(" "),e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("9");var t=e.join("");V(),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR,"+t)},100),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR,"+t),webphone_api.common.ShowToast("ERROR,"+t,15e3)},250)},n)),!webphone_api.common.onc())return!1;var o=webphone_api.global.aline;if((webphone_api.common.isNull(o)||-3===o)&&(o=-1),webphone_api.common.IsLineFree(o)||(o=webphone_api.common.GetFreeLine(),Pe(o)),webphone_api.common.isNull(e)||webphone_api.common.Trim(e).lengh<1)return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")+": "+e),!1;if(e=webphone_api.common.Trim(e),webphone_api.common.PutToDebugLog(2,"EVENT, plhandler initiate Call with engine: "+webphone_api.global.useengine+", to number: "+e),webphone_api.common.RemoveSipHeadreFromCache("X-reason"),webphone_api.common.RemoveSipHeadreFromCache("Reason"),webphone_api.common.RemoveSipHeadreFromCache("Warning"),"p2p"===webphone_api.common.getuseengine())return void webphone_api.common.Phone2Phone("",e);if("accessnum"===webphone_api.common.getuseengine())var i=webphone_api.common.GetParameter("accessnumber"),a="tel://"+i;else if("nativedial"===webphone_api.common.getuseengine()||"app"===webphone_api.common.getuseengine()){var a="tel://"+encodeURIComponent(e),r='<a href="'+a+'" id="make_native_call" style="display: none;">call</a>';return webphone_api.$("body").append(r),webphone_api.$("#make_native_call").on("click",function(){var e=webphone_api.$("#make_native_call").attr("href");webphone_api.$("#make_native_call").remove(),window.location=e}),webphone_api.$("#make_native_call").click(),void webphone_api.common.ShowToast(webphone_api.stringres.get("native_call"))}var s=!1;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.common.GetNrOfActiveCalls()>0&&"Firefox"===webphone_api.common.GetBrowser()&&!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0)for(var l=0;l<webphone_api.global.ep.length;l++)if(!webphone_api.common.isNull(webphone_api.global.ep[l])&&"true"==webphone_api.global.ep[l][webphone_api.common.EP_HOLDSTATE]){var p=webphone_api.global.ep[l][webphone_api.common.EP_LINE];webphone_api.mysetline(p),webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold mainlogic resume call from pl and mute because webrtc multiline call; peer: "+webphone_api.global.ep[l][webphone_api.common.EP_DESTNR]+" on line: "+p),webphone_api.hold(!1),webphone_api.mute(!0),s=!0}s?setTimeout(function(){webphone_api.mysetline(o),A(o,e,t)},150):A(o,e,t)}catch(c){webphone_api.common.PutToDebugLogException(2,"plhandler: Call",c)}return!1}function A(e,n,o){try{webphone_api.common.isNull(En)||clearTimeout(En),En=null,webphone_api.global.phonestarted<1&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_APP&&(webphone_api.global.phonestarted=1,t(webphone_api.parameters));var i=webphone_api.common.NeedRegister(),a=webphone_api.common.GetTickCount();if(Nn<1&&(Nn=a),!0===webphone_api.common.GetParameterBool("mustconnect",!1)&&webphone_api.global.phonestarted<3)return webphone_api.common.PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("warning_notreg")),void webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notreg"));if(i&&webphone_api.global.phonestarted<3&&a-Nn<4e3||webphone_api.global.phonestarted<2){var r=webphone_api.common.GetParameterInt("register",1);return r>1&&!1===Tn&&a-Nn>3500&&(Tn=!0,!1===i?(webphone_api.common.PutToDebugLog(2,"WARNING, Cannot initiate call because SipStack is not started: "),webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notstarted"))):(webphone_api.common.PutToDebugLog(2,"WARNING, "+webphone_api.stringres.get("warning_notreg")),2===r&&webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notreg")))),void(En=setTimeout(function(){A(e,n,o)},250))}var s="audio";1===o&&(s="video"),2===o&&(s="screenshare"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_Call ("+webphone_api.global.useengine+"), to: "+n+", on line: "+e.toString()+", type: "+s),Tn=!1,Nn=0,0==webphone_api.common.IsSDK()&&(webphone_api.global.intentcall[0]="number="+n,webphone_api.global.intentcall[1]="calltype=outgoing",webphone_api.global.intentcall[2]="name=",webphone_api.global.intentcall[3]="callmode="+o,setTimeout(function(){webphone_api.$.mobile.changePage("#page_call",{transition:"pop",role:"page"})},10)),!0===webphone_api.global.isfirstcall&&"Android"===webphone_api.common.GetOs()&&1===webphone_api.common.GetParameterInt("androidspeaker",1)&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?(webphone_api.common.PutToDebugLog(2,"EVENT, call handle SwitchOffAndroidSpeaker"),webphone_api.webrtcapi.SwitchOffAndroidSpeaker(function(){webphone_api.common.PutToDebugLog(2,"EVENT, call SwitchOffAndroidSpeaker handled"),k(e,n,o)})):k(e,n,o)}catch(l){webphone_api.common.PutToDebugLogException(2,"plhandler: CallDelayed",l)}}function k(e,t,n){try{if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.global.stacknotstarted_retry=!0,setTimeout(function(){return 0===n?webphone_api.webrtcapi.SipCall("call-audio",e,t):1===n?(webphone_api.global.isvideocall=!0,webphone_api.webrtcapi.SipCall("call-audiovideo",e,t)):2===n?(webphone_api.isscreensharecall=!0,webphone_api.webrtcapi.SipCall("call-screenshare",e,t)):webphone_api.webrtcapi.SipCall("call-audio",e,t)},100),!0;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Call(t);if(!0===webphone_api.common.IsWindowsSoftphone())return 0===n?void webphone_api.common.WinAPI("API_Call",null,webphone_api.common.GetLineForJavaAPI(e),t):1===n?(webphone_api.global.isvideocall=!0,void webphone_api.common.WinAPI("API_SoftphoneVideoCall",null,t)):2===n?(webphone_api.isscreensharecall=!0,void webphone_api.common.WinAPI("API_SoftphoneScreenshare",null,t)):void webphone_api.common.WinAPI("API_Call",null,webphone_api.common.GetLineForJavaAPI(e),t);if(n>0&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE&&!0===webphone_api.common.CanIUseWebRTC())return webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_WEBRTC),void setTimeout(function(){A(e,t,n)},3e3);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Call",null,webphone_api.common.GetLineForJavaAPI(e),t);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Call(webphone_api.common.GetLineForJavaAPI(e),t)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: CallDelayedSecond",o)}}function U(){try{Mt("StopScreenShare");var e=webphone_api.global.aline;(webphone_api.common.isNull(e)||-3===e)&&(e=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, stopscreenshare (API_StopScreenShare) ("+webphone_api.global.useengine+") on line: "+e.toString());var t=webphone_api.common.GetCallSession(21,!0,e,"");if(webphone_api.common.isNull(t)&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.checkIfCallActive=!1),setTimeout(function(){webphone_api.common.GetEndpoint(1017,e,"","","",!0)},400),setTimeout(function(){if(webphone_api.common.GetNrOfActiveCalls()>0){Pe(webphone_api.common.GetBestLine()),!1!==webphone_api.common.IsSDK()||!0!==webphone_api.global.isCallStarted||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons()}},350),-2===e&&!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0){for(var n=0;n<webphone_api.global.ep.length;n++){var o=webphone_api.global.ep[n][webphone_api.common.EP_LINE];webphone_api.common.isNull(o)||!0!==webphone_api.common.IsNumber(o)||W(webphone_api.common.StrToInt(o))}return!0}return W(e)}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: StopScreenShare",i)}return!1}function V(e){try{Mt("Hangup");var t=-10;t=!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)?webphone_api.common.StrToInt(e):webphone_api.global.aline,(webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, hangup (API_Hangup) ("+webphone_api.global.useengine+") on line: "+t.toString()),webphone_api.common.GetNrOfActiveCalls()<2&&(webphone_api.global.CLOSE_CALL_TIMER=webphone_api.common.GetParameterInt("closecall_timeout",3e3));var n=webphone_api.common.GetCallSession(22,!0,t,"");if(webphone_api.common.isNull(n)&&webphone_api.common.GetNrOfActiveCalls()<2&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.checkIfCallActive=!1),setTimeout(function(){webphone_api.common.GetEndpoint(1018,t,"","","",!0)},400),setTimeout(function(){if(webphone_api.common.GetNrOfActiveCalls()>0){Pe(webphone_api.common.GetBestLine()),!1!==webphone_api.common.IsSDK()||!0!==webphone_api.global.isCallStarted||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.UpdateLineButtons()}},350),-2===t&&!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0){if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE||webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())W(-2,-2);else for(var o=0;o<webphone_api.global.ep.length;o++){var i=webphone_api.global.ep[o][webphone_api.common.EP_LINE];webphone_api.common.isNull(i)||!0!==webphone_api.common.IsNumber(i)||(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?function(){var e=350*o+1,t=i;setTimeout(function(){W(webphone_api.common.StrToInt(t))},e)}():W(webphone_api.common.StrToInt(i)))}return!0}return W(t,e)}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: Hangup",a)}return!1}function W(e,t){try{Mt("HangupLine"),webphone_api.common.PutToDebugLog(3,"EVENT, hangupline: "+e.toString());try{"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents("[HANGUP]_BUTTON")}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: HangupLine inner AndroidWebphoneJsInterface",n)}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipHangup(!1,e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Hangup();if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Hangup",null,webphone_api.common.GetLineForJavaAPI(t));if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Hangup(webphone_api.common.GetLineForJavaAPI(t))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: HangupLine",n)}return!1}function F(e){try{Mt("Accept");var t=-10;if(t=!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)?webphone_api.common.StrToInt(e):webphone_api.global.aline,(webphone_api.common.isNull(t)||-3===t)&&(t=-2),webphone_api.common.PutToDebugLog(2,"EVENT, USER, accept (API_Accept) ("+webphone_api.global.useengine+") on line: "+t.toString()),webphone_api.global.active_incoming_call=!1,!0===webphone_api.common.CanUseIncomingCallNot()&&webphone_api.common.RequestBrowserNotificationPermission(function(){},"","",""),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return!1===webphone_api.global.webrtcpermissionaccepted&&(webphone_api.common.PutToDebugLog(2,"ERROR, call accepted, but permission not yet accepted"),webphone_api.common.AlertDialog(webphone_api.stringres.get("request_permission2_title"),webphone_api.common.ReplaceAll(webphone_api.stringres.get("request_permission2"),"[BRANDNAME]",webphone_api.common.GetBrandName()))),webphone_api.webrtcapi.SipAccept(t);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Accept();if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_Accept",null,webphone_api.common.GetLineForJavaAPI(e)),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Accept(webphone_api.common.GetLineForJavaAPI(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Accept",n)}return!1}function M(e){try{Mt("Reject");var t=-10;if(t=!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)?webphone_api.common.StrToInt(e):webphone_api.global.aline,(webphone_api.common.isNull(t)||-3===t)&&(t=-2),webphone_api.common.PutToDebugLog(2,"EVENT, USER, reject (API_Reject) ("+webphone_api.global.useengine+") on line: "+t.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipHangup(!0,t);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Hangup();if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Reject",null,webphone_api.common.GetLineForJavaAPI(e));if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Reject(webphone_api.common.GetLineForJavaAPI(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Reject",n)}return!1}function H(){try{Mt("Ignore");var e=webphone_api.global.aline;(webphone_api.common.isNull(e)||-3===e)&&(e=-2),webphone_api.common.PutToDebugLog(2,"EVENT, USER, ignore (API_Ignore) ("+webphone_api.global.useengine+") on line: "+e.toString());try{!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||"page_call"!==webphone_api.$.mobile.activePage.attr("id")||webphone_api._call.CloseCall()}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: Ignore inner",t)}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipIgnore();if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Ignore",null,webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Ignore(webphone_api.common.GetLineForJavaAPI())}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Ignore",n)}return!1}function B(e,t,n){var o=0;try{!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)&&(o=webphone_api.common.StrToInt(e));var i=0,a=0;!webphone_api.common.isNull(t)&&webphone_api.common.IsNumber(t)&&(i=webphone_api.common.StrToInt(t)),!webphone_api.common.isNull(n)&&webphone_api.common.IsNumber(n)&&(a=webphone_api.common.StrToInt(n)),i>0&&(1===o?(webphone_api.common.PutToDebugLog(5,"EVENT, USER SetVideoSize remote width: "+t+"; height: "+n),webphone_api.$("#div_video_remote").width(i),a>0&&webphone_api.$("#div_video_remote").height(a)):2===o&&(webphone_api.common.PutToDebugLog(5,"EVENT, USER SetVideoSize local width: "+t+"; height: "+n),webphone_api.$("#div_video_remote").width(i),a>0&&webphone_api.$(".previewvideo").height(a)))}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: SetVideoSize",r)}}function j(){try{Mt("GetAvailableCallfunc");var e="conference,transfer,mute,hold,chat";return webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?e="transfer,chat":webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH&&(e="transfer,chat"),e}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetAvailableCallfunc",t)}return""}function $(e){try{if(Mt("Forward"),!1===webphone_api.common.Glt())return;var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, forward (API_Forward), "+e+" on line: "+t.toString()),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")),!1;if(e=webphone_api.common.Trim(e),!0===webphone_api.common.GetParameterBool("isfirstcallfwd",!0)&&(webphone_api.common.SaveParameter("isfirstcallfwd","false"),(!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))&&webphone_api.common.ShowToast("Call forward will work only if the remote peer has support for it.",6e3)),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.Forward(e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Forward",null,webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Forward(webphone_api.common.GetLineForJavaAPI(),e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Forward",n)}return!1}function q(){webphone_api.common.isNull(Sn)||clearInterval(Sn),Sn=null,In=0}function z(e,t){try{if(Mt("Conference"),!1===webphone_api.common.Glcf())return!1;if(webphone_api.common.isNull(e)&&(e=""),e.length>0&&(webphone_api.global.lastcontarget=e),!webphone_api.global.checkIfInCall&&e.length>0)return x(e);var n=webphone_api.common.GetParameterInt("conferencetype",1);if(0===n)return webphone_api.common.PutToDebugLog(1,"ERROR, conference is disabled"),!1;if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, conference (API_Conf) ("+webphone_api.global.useengine+"), "+e),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")),!1;if(webphone_api.common.isNull(t)&&(t=!0,webphone_api.common.PutToDebugLog(2,"WARNING, plhandler Conference add is NULL, used as true")),e=webphone_api.common.Trim(e),!0===webphone_api.global.active_incoming_call&&(webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Accept Conf"),webphone_api.accept()),!0===t&&webphone_api.common.GetParameterInt("multilinegui",0)<1){if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.global.isconfcall=!0,webphone_api.common.WinAPI("API_Conf",null,e),!1;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.global.isconfcall=!0,webphone_api.webphone.Conference(e)}else{if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.global.isconfcall=!0,webphone_api.common.WinAPI("API_ConfEx",null,webphone_api.common.GetLineForJavaAPI(),e,t);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.global.isconfcall=!0,webphone_api.webphone.ConferenceEx(webphone_api.common.GetLineForJavaAPI(),e,t)}var o=webphone_api.common.GetSipHeaderInternal("X-UT");if(webphone_api.common.isNull(o)&&(o=""),o=webphone_api.common.Trim(o),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&e.length>0){var i=!1,a=!1;if(2!=n&&4!=n&&("g"===o||"s"===o||webphone_api.common.IsMizuServerOrGateway())){for(var r=!0,s=0;s<e.length;s++)if(!(e.charAt(s)>="0"&&e.charAt(s)<="9"||e.charAt(s)>="A"&&e.charAt(s)<="D"||"*"==e.charAt(s)||"#"==e.charAt(s))){r=!1;break}if(t&&(1===n||n>=5)){a=!0,r&&"g"===o&&(webphone_api.global.confcanfailover=!0);var l=webphone_api.common.CreateConferenceRoom(!1,e);webphone_api.common.isNull(l)||l.length<3?webphone_api.common.PutToDebugLog(2,"WARNING, plhandler Conference webrtc invalid URL: "+l):(webphone_api.common.UriParser(l,"","","","","getconferenceroom"),webphone_api.common.PutToDebugLog(1,"EVENT,conference created"),webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers)&&(webphone_api.global.waiting_conf_numbers=""),webphone_api.global.waiting_conf_numbers.length>0&&(webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+","),webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+e,i=!0)}if(!i&&n<5&&("g"===o||"s"===o)&&r&&(!0===t?!1===webphone_api.global.checkIfInCall||(webphone_api.common.PutToDebugLog(2,"EVENT, Add to DTMF conference: "+e),webphone_api.dtmf("*1*"+e+"#")):webphone_api.dtmf("*6*"+e+"#"),i=!0),
!i&&!a&&t){r&&"g"===o&&(webphone_api.global.confcanfailover=!0);var l=webphone_api.common.CreateConferenceRoom(!1,e);webphone_api.common.isNull(l)||l.length<3?webphone_api.common.PutToDebugLog(2,"WARNING, plhandler Conference webrtc invalid URL: "+l):(webphone_api.common.UriParser(l,"","","","","getconferenceroom"),webphone_api.common.PutToDebugLog(1,"EVENT,conference created"),webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers)&&(webphone_api.global.waiting_conf_numbers=""),webphone_api.global.waiting_conf_numbers.length>0&&(webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+","),webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+e,i=!0)}}if(!i&&t&&e.length>0&&!0===webphone_api.common.CanIUseApplet()&&(r&&(webphone_api.global.confcanfailover=!1),webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_JAVA),i=!0),!i&&t&&!0===webphone_api.common.CanIUseService()&&(r&&(webphone_api.global.confcanfailover=!1),webphone_api.common.IsServiceInstalled(function(t){try{i=!0,!0===t?(webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because Conference engine switch to NS(1)"),webphone_api.hangup(),!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api.common.PutToDebugLog(4,"EVENT, Close call page because Conference engine switch to NS(1)"),webphone_api._call.CloseCall()),webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_SERVICE),webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("switch_conf")),webphone_api.common.ShowToast(webphone_api.stringres.get("switch_conf")),setTimeout(function(){if(!webphone_api.common.isNull(Sn))return q(),!0;var t=!1,n=0;Sn=setInterval(function(){return++In>50?(q(),!0):(n<1&&!1===t&&!0===webphone_api.isregistered()&&(n=webphone_api.common.GetTickCount()),n>0&&webphone_api.common.GetTickCount()-n>1e3&&!1===t&&(t=!0,webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Call Conf switch: "+currcallnumber),webphone_api.call(webphone_api.global.currcallnumber)),!0===webphone_api.global.checkIfInCall?(webphone_api.global.isconfcall=!0,webphone_api.common.WinAPI("API_Conf",null,e),q(),!0):void 0)},500)},4e3)):(webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because Conference engine switch to NS(2)"),webphone_api.hangup(),!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api.common.PutToDebugLog(4,"EVENT, Close call page because Conference engine switch to NS(2)"),webphone_api._call.CloseCall()),setTimeout(function(){webphone_api.common.AlertDialog(webphone_api.stringres.get("switch_conf_title"),webphone_api.stringres.get("switch_confmessage"),function(e){if(!0===e){var t=webphone_api.common.GetNPLocation();!webphone_api.common.isNull(t)&&t.length>0&&window.open(t),setTimeout(function(){return webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_SERVICE),!0},1e3)}},webphone_api.stringres.get("btn_ok"))},500))}catch(n){i=!1,webphone_api.common.PutToDebugLogException(2,"plhandler: Conference InnerService",n)}},!0)),!i&&!a&&t&&("g"===o||"s"===o||webphone_api.common.IsMizuServerOrGateway())){r&&(webphone_api.global.confcanfailover=!1);var l=webphone_api.common.CreateConferenceRoom(!1,e);webphone_api.common.isNull(l)||l.length<3?webphone_api.common.PutToDebugLog(2,"WARNING, plhandler Conference webrtc invalid URL: "+l):(webphone_api.common.UriParser(l,"","","","","getconferenceroom"),webphone_api.common.PutToDebugLog(1,"EVENT,conference created"),webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers)&&(webphone_api.global.waiting_conf_numbers=""),webphone_api.global.waiting_conf_numbers.length>0&&(webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+","),webphone_api.global.waiting_conf_numbers=webphone_api.global.waiting_conf_numbers+e,i=!0)}return i||(r&&(webphone_api.global.confcanfailover=!1),t?e.length>0?webphone_api.common.PutToDebugLog(1,"ERROR, Conference not available in this environment"):webphone_api.common.PutToDebugLog(1,"ERROR, No target number for conference"):webphone_api.common.PutToDebugLog(1,"EVENT, conference stop skipped")),i}}catch(p){webphone_api.common.PutToDebugLogException(2,"plhandler: Conference",p)}return!1}function K(e){try{if(Mt("Transfer"),!1===webphone_api.common.Glt())return;var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=2),webphone_api.common.PutToDebugLog(2,"EVENT, USER, transfer (API_Transfer), "+e+" on line: "+t.toString()),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")),!1;if(e=webphone_api.common.Trim(e),webphone_api.global.last_transfer_tick=webphone_api.common.GetTickCount(),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipTransferEx(e,t);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Transfer(e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Transfer",null,webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Transfer(webphone_api.common.GetLineForJavaAPI(),e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Transfer",n)}return!1}function X(e){try{Mt("Dtmf");var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, dtmf (API_Dtmf), "+e+" on line: "+t.toString()),webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(1,"ERROR,"+webphone_api.stringres.get("err_msg_4")),!1;if(e=webphone_api.common.Trim(e),webphone_api.common.PlayDtmfSound(e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.common.PutToDebugLog(1,"EVENT,Send DTMF "+e),webphone_api.webrtcapi.SipSendDTMF(e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(1,"EVENT,Send DTMF "+e),webphone_api.flashapi.SendDTMF(e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_Dtmf",null,webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Dtmf(t,e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Dtmf",n)}return!1}function J(e,t){try{Mt("MuteEx");var n=[];n.push("h"),n.push("a"),n.push("s"),n.push("m"),n.push("u"),n.push("t"),n.push("e");var o=n.join("");if(!1===webphone_api.common.GetParameterBool(o,!0)){var i="N";return i+="o",i+=" ",webphone_api.common.PutToDebugLog(2,"WARNING, "+i+o),!1}var a=webphone_api.global.aline;(webphone_api.common.isNull(a)||-3===a)&&(a=-1);var r=webphone_api.common.ParamAsBool(e),s=webphone_api.common.GetParameterInt("muteholdalllines",0);if(!0===webphone_api.global.isconfcall&&s>1&&(a=-2,webphone_api.common.SetALineInternal(-2,10),webphone_api.global.lastalineset=-2,webphone_api.global.lastalinesettick=webphone_api.common.GetTickCount()),(webphone_api.common.isNull(t)||t.length<1)&&(t=webphone_api.common.GetParameterInt("defmute",2)),5===(t=webphone_api.common.StrToIntDef(t,0)))return webphone_api.common.PutToDebugLog(2,"WARNING, USER, mute (API_MutEx), "+r+", "+t+" on line: "+a.toString()+" Mute is disabled!"),!1;if(3!==t&&4!==t||(t=0),r?webphone_api.common.PutToDebugLog(1,"STATUS,"+a.toString()+","+webphone_api.stringres.get("muted")):webphone_api.common.PutToDebugLog(1,"STATUS,"+a.toString()+","+webphone_api.stringres.get("unmuted")),webphone_api.common.SetMuteState(a,r),webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_MutEx, "+r+", "+t+" on line: "+a.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipToggleMute(r,t);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_MuteEx",null,webphone_api.common.GetLineForJavaAPI(),r,t),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.MuteEx(webphone_api.common.GetLineForJavaAPI(),r,t)}catch(l){webphone_api.common.PutToDebugLogException(2,"plhandler: MuteEx",l)}return!1}function Y(){try{Mt("IsMuted");var e=webphone_api.global.aline;return(webphone_api.common.isNull(e)||-3===e)&&(e=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, ismuted (API_IsMuted) on line: "+e.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.webphone.IsMuted(e):webphone_api.common.GetMuteState(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: IsMuted",t)}return!1}function Q(e,t){try{Mt("Hold");var n=[];n.push("h"),n.push("a"),n.push("s"),n.push("h"),n.push("o"),n.push("l"),n.push("d");var o=n.join("");if(!1===webphone_api.common.GetParameterBool(o,!0)){var i="N";return i+="o",i+=" ",webphone_api.common.PutToDebugLog(2,"WARNING, "+i+o),!1}var a=-10;a=!webphone_api.common.isNull(t)&&webphone_api.common.IsNumber(t)?webphone_api.common.StrToInt(t):webphone_api.global.aline,(webphone_api.common.isNull(a)||-3===a)&&(a=-1);var r=webphone_api.common.ParamAsBool(e),s=webphone_api.common.GetParameterInt("muteholdalllines",0);!0===webphone_api.global.isconfcall&&s>1&&(a=-2,webphone_api.common.SetALineInternal(-2,11),webphone_api.global.lastalineset=-2,webphone_api.global.lastalinesettick=webphone_api.common.GetTickCount());var l=webphone_api.common.GetHoldState(a);webphone_api.common.SetHoldState(a,r);var p=webphone_api.common.ParamAsInt(webphone_api.common.GetParameter2("fasthold"),-1);if(1===p)return webphone_api.common.PutToDebugLog(2,"EVENT, fasthold: "+r),J(r,0);if(-1===p&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&"Firefox"===webphone_api.common.GetBrowser())return webphone_api.common.PutToDebugLog(2,"EVENT, fasthold firefox: "+r),J(r,0);if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, hold (API_Hold), "+r+" on line: "+a.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){if(r===l&&webphone_api.common.GetParameterInt("ignoreprevholdstate",0)<1)return!0===r?webphone_api.common.PutToDebugLog(2,"WARNING, USER, hold (API_Hold), skip putting call on hold, because it is already on hold"):webphone_api.common.PutToDebugLog(2,"WARNING, USER, hold (API_Hold), skip reloading call , because it is not on hold"),!1;var c=webphone_api.common.GetParameterInt("holdtype",-1);if(-2===c||0===c)return webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold ignored because holdtype is: "+c.toString()),!1;r&&webphone_api.common.GetNrOfActiveCalls()>1&&"Firefox"===webphone_api.common.GetBrowser()&&webphone_api.common.GetParameterInt("multilineoop",0)<2&&(webphone_api.global.usemutemutiline=!0);var u=!1;if(webphone_api.common.GetNrOfActiveCalls()>1&&webphone_api.common.GetParameterInt("multilineoop",0)<1&&(u=!0),!r&&u&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){var h=webphone_api.common.GetCallSession(51,!1,a,"");!webphone_api.common.isNull(h)&&h.getHolded()>0&&(u=!1)}if(u){webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold mute instead because multiline call ("+webphone_api.common.GetNrOfActiveCalls()+")");var g=webphone_api.common.GetParameterInt("defmute",0);return webphone_api.mute(r,g,-1)}return Z(r,a),!0}if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_Hold",null,webphone_api.common.GetLineForJavaAPI(),r),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.Hold(webphone_api.common.GetLineForJavaAPI(),r)}catch(m){webphone_api.common.PutToDebugLogException(2,"plhandler: Hold",m)}return!1}function Z(e,t){function n(){webphone_api.common.isNull(Rn)||clearInterval(Rn),Rn=null}try{var o=webphone_api.common.GetTickCount();Cn>0&&o-Cn<1e3?(webphone_api.common.isNull(Gn)&&(Gn=[]),webphone_api.common.isNull(yn)&&(yn=[]),Gn.push(e),yn.push(t),n(),Rn=setInterval(function(){if(webphone_api.common.isNull(Gn)&&(Gn=[]),webphone_api.common.isNull(yn)&&(yn=[]),Gn.length<1&&n(),webphone_api.common.GetTickCount()-Cn>950){Cn=webphone_api.common.GetTickCount();var e=Gn.shift(),t=yn.shift();webphone_api.common.PutToDebugLog(2,"EVENT, execute API_Hold delayed on line: "+t.toString()+"; state: "+e),webphone_api.webrtcapi.SipToggleHoldResume(e,t)}},100)):webphone_api.webrtcapi.SipToggleHoldResume(e,t),Cn=o}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: HoldDelayedWebrtc",i)}}function ee(){try{Mt("IsOnHold");var e=webphone_api.global.aline;return(webphone_api.common.isNull(e)||-3===e)&&(e=-1),webphone_api.common.PutToDebugLog(2,"EVENT, USER, isonhold (API_IsOnHold) on line: "+e.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA?webphone_api.webphone.IsOnHold(e):webphone_api.common.GetHoldState(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: IsOnHold",t)}return!1}function te(e,t,n,o){try{if(Mt("SendChat"),!webphone_api.common.isNull(e)&&e.indexOf(",")>0){webphone_api.common.isNull(n)&&(n="");var i=e.split(","),a=n.split("|");if(webphone_api.common.isNull(n)||n.length<1||webphone_api.common.isNull(a)||a.length<i.length){n="";for(var r=0;r<i.length;r++)webphone_api.common.isNull(i[r])||webphone_api.common.Trim(i[r]).length<1||(n.length>0&&(n+="|"),n+=webphone_api.common.Trim(i[r]))}for(var r=0;r<i.length;r++)webphone_api.common.isNull(i[r])||webphone_api.common.Trim(i[r]).length<1||ne(i[r],t,n,o)}else ne(e,t,o)}catch(s){webphone_api.common.PutToDebugLogException(2,"SendChatProcesser: IsOnHold",s)}}function ne(e,n,o,i){try{Mt("SendChatAction");var a=webphone_api.global.aline;if((webphone_api.common.isNull(a)||-3===a)&&(a=1),webphone_api.global.phonestarted<2)return void Ht("SendChatAction",[e,n,o,i]);if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, sendchat (API_Chat), "+e+", "+n),webphone_api.common.isNull(e)||webphone_api.common.Trim(e).length<1)return webphone_api.common.PutToDebugLog(1,"ERROR, "+webphone_api.stringres.get("err_msg_6")),!1;webphone_api.common.isNull(o)&&(o=""),o=webphone_api.common.Trim(o),webphone_api.common.isNull(Ln)||clearTimeout(Ln),Ln=null,webphone_api.global.phonestarted<1&&(webphone_api.global.phonestarted=1,t(webphone_api.parameters));if(webphone_api.common.NeedRegister()&&webphone_api.global.phonestarted<3||webphone_api.global.phonestarted<2)return void(Ln=setTimeout(function(){te(e,n,i)},250));if(!webphone_api.common.LcAc(!1,!1))return!1;if(webphone_api.common.Te()){var r=[];r.push("T"),r.push("r"),r.push("i"),r.push("a"),r.push("l"),r.push(" "),r.push("e"),r.push("x"),r.push("p"),r.push("i"),r.push("r"),r.push("e"),r.push("d");var s=r.join("");return setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR, "+s)},1150),setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR, "+s)},2150),!1}webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_Chat, "+e);var l=!1;if(0===webphone_api.common.Trim(n).indexOf("[DONT_START_CHAT_WINDOW]")&&(n=n.replace("[DONT_START_CHAT_WINDOW]",""),l=!0),webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutchat,"outChat","",e,e,n),!1!==webphone_api.common.IsSDK()||webphone_api.global.isMessageStarted||!1!==l||(webphone_api.global.intentmsg[0]="action=chat",webphone_api.global.intentmsg[1]="to="+e,webphone_api.global.intentmsg[2]="message="+n,webphone_api.$.mobile.changePage("#page_message",{transition:"slide",role:"page"})),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SipSendChat(a,e,n,i);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SendChat",null,webphone_api.common.GetLineForJavaAPI(),e,o,n);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(1,"EVENT, Chat not supported by flash engine"),!1;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.SendChat(webphone_api.common.GetLineForJavaAPI(),e,o,n)}catch(p){webphone_api.common.PutToDebugLogException(2,"plhandler: SendChat",p)}return!1}function oe(e,t,n){try{if(Mt("SendSms"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, sendsms (API_Sms), "+e+", "+t+", "+n),webphone_api.common.isNull(e)||webphone_api.common.Trim(e).length<1)return webphone_api.common.PutToDebugLog(1,"ERROR, Sms "+webphone_api.stringres.get("err_msg_6")),!1;if(webphone_api.global.phonestarted<2)return void Ht("SendSms",[e,t,n]);var o=webphone_api.common.GetParameter2("sms");(webphone_api.common.isNull(o)||o.length<2)&&(o=webphone_api.common.GetConfig("sms")),!webphone_api.common.isNull(o)&&o.length>2?((webphone_api.common.isNull(n)||n.length<1)&&(n=webphone_api.common.GetSipusername()),UriParser(o,"",n,e,t,"sendsms")):te(e,t,"",!0)}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: SendSms",i)}return!1}function ie(e,t){try{if(Mt("Voicerecord"),!1===webphone_api.common.Glcr())return;if(webphone_api.global.phonestarted<2)return void Ht("Voicerecord",[e,t]);if(webphone_api.common.isNull(t)&&(t=""),!1===e&&(t="null"),!0===e&&(t.length<1||"null"===t||"NULL"===t))return void webphone_api.common.PutToDebugLog(2,"WARNING, voicerecord (API_Voicerecord) skipped start with no url, "+e+", "+t);webphone_api.common.PutToDebugLog(2,"EVENT, voicerecord (API_Voicerecord), "+e+", "+t);var n=!1;if((!1===e||webphone_api.common.isNull(t)||t.length<1||"null"===t||"NULL"===t)&&(t="null",n=!0),webphone_api.common.SaveParameter("voicerecupload",t),webphone_api.common.isNull(webphone_api.parameters.voicerecupload)||(webphone_api.parameters.voicerecupload=t),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void webphone_api.common.CallWsuserKeepAlive(!0);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void(!1===n?webphone_api.common.WinAPI("API_VoiceRecord",null,4,2,t,webphone_api.common.GetLineForJavaAPI()):webphone_api.common.WinAPI("API_VoiceRecord",null,0,2,t,webphone_api.common.GetLineForJavaAPI()));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return void(!1===n?webphone_api.webphone.VoiceRecord(4,2,t,webphone_api.common.GetLineForJavaAPI()):webphone_api.webphone.VoiceRecord(0,2,t,webphone_api.common.GetLineForJavaAPI()))}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: Voicerecord",o)}}function ae(){try{if("undefined"!=typeof webphone_api.notifications&&null!==webphone_api.notifications)return webphone_api.notifications.GetStatus();console&&console.log&&console.log("ERROR, plhandler GetStatus webphone_api.notifications is not defined")}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: GetStatus",e)}return""}function re(e,t){try{if(Mt("GetRegFailReason"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetRegFailReason callback is not definaed");var n=!0;if((webphone_api.common.isNull(t)||"true"!=t&&"false"!=t||"false"==t||0==t)&&(n=!1),webphone_api.global.phonestarted<2)return void Ht("GetRegFailReason",[e,t]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void e(webphone_api.webrtcapi.GetRegFailReason());if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, GetRegFailReason is not supported by flash engine"),void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetRegFailReason",function(t){e(t)},n);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.GetRegFailReason(e,n)}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetRegFailReason",o)}return""}function se(){try{if(Mt("DevicePopup"),webphone_api.common.isNull(On)||clearTimeout(On),On=null,webphone_api.global.phonestarted<1&&(webphone_api.global.phonestarted=1,t(webphone_api.parameters)),webphone_api.global.phonestarted<2)return void(On=setTimeout(function(){se()},250));if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, devicepopup (API_DevicePopup)"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.AudioDevice();webphone_api.common.AudioDevicePopup()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: DevicePopup",e)}return!1}function le(e,t){try{if(Mt("SetVolume"),webphone_api.common.isNull(e)||e.length<1||webphone_api.common.isNull(t)||t.length<1||!webphone_api.common.IsNumber(e)||!webphone_api.common.IsNumber(t))return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: setvolume device or volume is NULL"),!1;if(webphone_api.global.phonestarted<2)return void Ht("SetVolume",[e,t]);webphone_api.common.PutToDebugLog(2,"EVENT, plhandler setvolume engine: "+webphone_api.common.getuseengine()+"; dev: "+e+"; volume: "+t);var n=webphone_api.common.StrToInt(e),o=webphone_api.common.StrToInt(t);if(n<0||n>2)return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: setvolume invalid device"),!1;if(o<0||o>100)return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: setvolume invalid valume value"),!1;if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_SetVolume, "+e+", "+t),0==e?webphone_api.common.SaveParameter("volumein",t):webphone_api.common.SaveParameter("volumeout",t),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void webphone_api.common.PutToDebugLog(2,"EVENT, setvolume is not supported by flash engine");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void webphone_api.webrtcapi.SetVolume(e,t);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SetVolume",null,e,t);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.SetVolume(e,t)}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: SetVolume",i)}return!1}function pe(e,t){try{if(Mt("GetVolume"),!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetVolume callback is not defined");if(webphone_api.common.isNull(e)||e.length<1||!webphone_api.common.IsNumber(e))return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: getvolume device is NULL"),t(-1),!1;var n=webphone_api.common.StrToInt(e);if(n<0||n>2)return webphone_api.common.PutToDebugLog(3,"ERROR, wphone: getvolume invalid device"),!1;if(webphone_api.global.phonestarted<2)return void Ht("GetVolume",[e,t]);if(webphone_api.common.PutToDebugLog(2,"EVENT, USER, getvolume (API_GetVolume), "+e),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void webphone_api.common.PutToDebugLog(2,"EVENT, getvolume is not supported by flash engine");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void t(webphone_api.webrtcapi.GetVolume(e));if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetVolume",function(e){var n=50;webphone_api.common.isNull(e)||e.length<1||!1===webphone_api.common.IsNumber(e)?webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetVolume invalid return value: "+e):n=webphone_api.common.StrToInt(e),webphone_api.common.PutToDebugLog(2,"plhandler: GetVolume NS returned: "+n.toString()),t(n)},e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void t(webphone_api.webphone.GetVolume(e))}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetVolume",o)}return!1}function ce(e){try{if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void(!0===e||"true"===e?webphone_api.common.SaveParameter("androidspeaker","0"):webphone_api.common.SaveParameter("androidspeaker","1"));webphone_api.common.PutToDebugLog(2,"WARNING, setloudspeaker not iplemented for this engine: "+webphone_api.common.getuseengine())}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: SetLoudspeaker",t)}return!1}function ue(e,t,n,o){try{if(Mt("PlaySound"),webphone_api.global.phonestarted<2)return void Ht("PlaySound",[e,t,n,o]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.PlaySound(e,t,n,o);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_PlaySound",null,e,t,n,!1,!1,o,webphone_api.common.GetLineForJavaAPI()),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.PlaySound(e,t,n,!1,!1,o,webphone_api.common.GetLineForJavaAPI());webphone_api.common.PutToDebugLog(2,"ERROR, plhandler API_PlaySuond is not supported by "+webphone_api.common.getuseengine()+" engine")}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: PlaySound",i)}return!1}function he(e,t,n,o,i,a){try{if(Mt("AddContact"),webphone_api.common.isNull(t)||webphone_api.common.Trim(t).length<1)return webphone_api.common.PutToDebugLog(3,"ERROR, plhandler AddContact invalid number: "+t),!1;t=webphone_api.common.Trim(t),webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),t=webphone_api.common.NormalizeInput2(t,3);var r=webphone_api.common.GetParameterInt("normalize_contact",1);r>0&&(e=webphone_api.common.NormalizeInput2(e,2)),webphone_api.common.isNull(n)&&(n=""),r>0&&(n=webphone_api.common.NormalizeInput2(n,3),n=webphone_api.common.Trim(n)),webphone_api.common.isNull(o)&&(o=""),r>0&&(o=webphone_api.common.NormalizeInput2(o,3),o=webphone_api.common.Trim(o)),webphone_api.common.isNull(i)&&(i=""),r>0&&(i=webphone_api.common.NormalizeInput2(i,3),i=webphone_api.common.Trim(i)),webphone_api.common.isNull(a)&&(a=""),r>0&&(a=webphone_api.common.NormalizeInput2(a,2),a=webphone_api.common.Trim(a));var s="sip";webphone_api.common.IsNumber(t)&&(s="phone");return webphone_api.common.PutToDebugLog(2,"EVENT, AddContact name: "+e+"; number: "+t+"; email: "+n+"; address: "+o+"; notes: "+i+"; website: "+a+"; isfromsync: 0"),ge(e,t,"0",s,webphone_api.common.GetTickCount(),n,o,i,a,"0"),!0}catch(l){webphone_api.common.PutToDebugLogException(2,"plhandler: AddContact",l)}return!1}function ge(e,t,n,o,i,a,r,s,l,p){try{webphone_api.common.isNull(webphone_api.global.ctlist)&&(webphone_api.global.ctlist=[]);var c=[];c[webphone_api.common.CT_NAME]=e,c[webphone_api.common.CT_NUMBER]=[t],c[webphone_api.common.CT_PTYPE]=[o],c[webphone_api.common.CT_USAGE]="0",c[webphone_api.common.CT_LASTMODIF]=i,c[webphone_api.common.CT_DELFLAG]="0",c[webphone_api.common.CT_FAV]=n,c[webphone_api.common.CT_EMAIL]=a,c[webphone_api.common.CT_ADDRESS]=r,c[webphone_api.common.CT_NOTES]=s,c[webphone_api.common.CT_WEBSITE]=l,c[webphone_api.common.CT_LASTACTIVE]=webphone_api.common.GetTickCount().toString(),c[webphone_api.common.CT_ISFROMSYNC]=p;for(var u=0;u<webphone_api.global.ctlist.length;u++){if(webphone_api.global.ctlist[u][webphone_api.common.CT_NUMBER]===t){webphone_api.global.ctlist.splice(u,1);break}}webphone_api.global.ctlist.push(c),webphone_api.global.wasCtModified=!0,webphone_api.common.SortContacts()}catch(h){webphone_api.common.PutToDebugLogException(2,"plhandler: SaveTheContact",h)}}function me(e,t){try{return Mt("DeleteContact"),(webphone_api.common.isNull(e)&&(e=""),e=e.toString(),webphone_api.common.isNull(t)&&(t=""),t=t.toString(),e.length<0&&t.length<0)?(webphone_api.common.PutToDebugLog(2,"ERROR, plhandler DeleteContact invalid name and number"),!1):(webphone_api.common.isNull(webphone_api.global.ctlist)&&(webphone_api.global.ctlist=[]),de(e,t),!0)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: DeleteContact",n)}return!1}function de(e,t){try{if(webphone_api.common.isNull(webphone_api.global.ctlist)||webphone_api.global.ctlist.length<1)return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler RemoveTheContact no contacts in list");if(e.length>0&&t.length>0)for(var n=0;n<webphone_api.global.ctlist.length;n++){var o=webphone_api.global.ctlist[n];if(o[webphone_api.common.CT_NAME]===e||o[webphone_api.common.CT_NAME]===t){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}for(var i=0;i<o[webphone_api.common.CT_NUMBER].length;i++)if(o[webphone_api.common.CT_NUMBER][i]===e||o[webphone_api.common.CT_NUMBER][i]===t){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}}else if(e.length>0)for(var n=0;n<webphone_api.global.ctlist.length;n++){var o=webphone_api.global.ctlist[n];if(o[webphone_api.common.CT_NAME]===e){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}for(var i=0;i<o[webphone_api.common.CT_NUMBER].length;i++)if(o[webphone_api.common.CT_NUMBER][i]===e){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}}else if(t.length>0)for(var n=0;n<webphone_api.global.ctlist.length;n++){var o=webphone_api.global.ctlist[n];if(o[webphone_api.common.CT_NAME]===t){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}for(var i=0;i<o[webphone_api.common.CT_NUMBER].length;i++)if(o[webphone_api.common.CT_NUMBER][i]===t){webphone_api.global.ctlist.splice(n,1),webphone_api.global.wasCtModified=!0;break}}}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: RemoveTheContact",a)}}function be(e,t){try{return Mt("GetContact"),(webphone_api.common.isNull(e)&&(e=""),e=e.toString(),webphone_api.common.isNull(t)&&(t=""),t=t.toString(),e.length<0&&t.length<0)?(webphone_api.common.PutToDebugLog(2,"ERROR, plhandler GetContact invalid name and number"),null):(webphone_api.common.PutToDebugLog(4,"EVENT, plhandler getcontact with name: "+e+" and number: "+t),webphone_api.common.isNull(webphone_api.global.ctlist)&&(webphone_api.global.ctlist=[]),function(e,t){try{var n="";if(e.length>0)for(var o=0;o<webphone_api.global.ctlist.length;o++){var i=webphone_api.global.ctlist[o];i[webphone_api.common.CT_NAME]===e&&(n=i[webphone_api.common.CT_NAME]+"\t"+i[webphone_api.common.CT_NUMBER].join("|")+"\t"+i[webphone_api.common.CT_FAV]+"\t"+i[webphone_api.common.CT_EMAIL]+"\t"+i[webphone_api.common.CT_ADDRESS]+"\t"+i[webphone_api.common.CT_NOTES]+"\t"+i[webphone_api.common.CT_WEBSITE])}else if(t.length>0)for(var o=0;o<webphone_api.global.ctlist.length;o++){var i=webphone_api.global.ctlist[o];i[webphone_api.common.CT_NAME]===t&&(n=i[webphone_api.common.CT_NAME]+"\t"+i[webphone_api.common.CT_NUMBER].join("|")+"\t"+i[webphone_api.common.CT_FAV]+"\t"+i[webphone_api.common.CT_EMAIL]+"\t"+i[webphone_api.common.CT_ADDRESS]+"\t"+i[webphone_api.common.CT_NOTES]+"\t"+i[webphone_api.common.CT_WEBSITE])
;for(var a=0;a<i[webphone_api.common.CT_NUMBER].length;a++)i[webphone_api.common.CT_NUMBER][a]===t&&(n=i[webphone_api.common.CT_NAME]+"\t"+i[webphone_api.common.CT_NUMBER].join("|")+"\t"+i[webphone_api.common.CT_FAV]+"\t"+i[webphone_api.common.CT_EMAIL]+"\t"+i[webphone_api.common.CT_ADDRESS]+"\t"+i[webphone_api.common.CT_NOTES]+"\t"+i[webphone_api.common.CT_WEBSITE])}if(!webphone_api.common.isNull(n))return n}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: FindContactInList",r)}return null}(e,t))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetContact",n)}return null}function _e(e){try{return Mt("ListContacts"),webphone_api.common.isNull(webphone_api.global.ctlist)&&(webphone_api.global.ctlist=[]),webphone_api.common.PutToDebugLog(4,"EVENT, plhandler listcontacts called"),function(e){try{for(var t="",n=0;n<webphone_api.global.ctlist.length;n++){var o=webphone_api.global.ctlist[n];if(!1!==e||"Echo delayed"!==o[webphone_api.common.CT_NAME]&&"Echo"!==o[webphone_api.common.CT_NAME]&&"Funny"!==o[webphone_api.common.CT_NAME]&&"Music"!==o[webphone_api.common.CT_NAME]&&"Playback"!==o[webphone_api.common.CT_NAME]&&"Record"!==o[webphone_api.common.CT_NAME]&&"Redial"!==o[webphone_api.common.CT_NAME]&&"Voicemail"!==o[webphone_api.common.CT_NAME]){!webphone_api.common.isNull(t)&&t.length>0&&(t+="\r\n");for(var i="",a=0;a<o[webphone_api.common.CT_NUMBER].length;a++)webphone_api.common.isNull(o[webphone_api.common.CT_NUMBER][a])||o[webphone_api.common.CT_NUMBER][a].length<1||(i.length>0&&(i+="|"),i+=o[webphone_api.common.CT_NUMBER][a]);t+=o[webphone_api.common.CT_NAME]+"\t"+i+"\t"+o[webphone_api.common.CT_FAV]+"\t"+o[webphone_api.common.CT_EMAIL]+"\t"+o[webphone_api.common.CT_ADDRESS]+"\t"+o[webphone_api.common.CT_NOTES]+"\t"+o[webphone_api.common.CT_WEBSITE]}}if(!webphone_api.common.isNull(t)&&t.length>0)return t}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: BuildCtList",r)}return null}(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: ListContacts",t)}return null}function fe(){try{Mt("ListCallhistory"),webphone_api.common.isNull(webphone_api.global.chlist)&&(webphone_api.global.chlist=[]),webphone_api.common.PutToDebugLog(4,"EVENT, plhandler listcallhistory called");for(var e="",t=0;t<webphone_api.global.chlist.length;t++){var n=webphone_api.global.chlist[t];!webphone_api.common.isNull(e)&&e.length>0&&(e+="\r\n");e+=n[webphone_api.common.CH_TYPE]+"\t"+n[webphone_api.common.CH_NAME]+"\t"+n[webphone_api.common.CH_NUMBER]+"\t"+n[webphone_api.common.CH_DATE]+"\t"+n[webphone_api.common.CH_DURATION]+"\t"+n[webphone_api.common.CH_REASON]}if(!webphone_api.common.isNull(e)&&e.length>0)return e}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: ListCallhistory",o)}return null}function we(e,t){try{if(webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLogSpecial(2,"EVENT, SetParameter user, "+e+": "+t,!1,""),Mt("SetParameter: "+e+": "+t),webphone_api.common.isNull(e)||e.length<1)return!1;if(e=e.toLowerCase(),webphone_api.common.isNull(t)&&(t="null"),t=webphone_api.common.Trim(t),0===t.indexOf("encrypted__3__")&&(t=webphone_api.common.StrDc(t,webphone_api.common.GetPassphrase())),e.indexOf("server")>=0){if("YOURSIPDOMAIN.COM"===t||"YOURSIPSERVER.COM"===t||"SIPSERVER"===t||"VOIPSERVER"===t||"SERVERADDRESS"===t||"yoursipdomain.com"===t||"SERVER_ADDRESS"===t||"serveraddress"===t||"YOURSIPDOMAIN"===t)return!1}else if(e.indexOf("username")>=0){if("USERNAME"===t||"SIPUSERNAME"===t)return!1}else if(e.indexOf("password")>=0){if("PASSWORD"===t||"SIPPASSWORD"===t||"SIPASSWORD"===t)return!1}else if(e.indexOf("callto")>=0&&("DESTINATION"===t||"CALLTO"===t))return!1;"webrtcserver"!==e&&"webrtcaddress"!==e&&"rtcserver"!==e&&"rtcaddress"!==e||(e="webrtcserveraddress");try{window.location.href.indexOf("isdemopage=true")>0&&!webphone_api.common.isNull(t)&&t.toString().length>0&&("sipusername"===e||"username"===e||"password"===e||"sippassword"===e||"serveraddress_user"===e||"serveraddress_orig"===e||"serveraddress"===e||"upperserver"===e||"callto"===e||"destination"===e)&&webphone_api.SetCookie("wpdemosett_"+e,t,365)}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: SetParameter inner",a)}var n=t;("password"===e||"sippassword"===e||webphone_api.common.GetParameterInt("loglevel",1)<5)&&(n="*****"),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLogSpecial(2,"EVENT, SetParameter "+e+": "+n,!1,""),"serveraddress"===e&&t.length>0?webphone_api.common.SaveParameter("serveraddress_user",t):"theme"===e&&t.length>0?webphone_api.common.SaveParameter("colortheme",t):"colortheme"===e&&t.length>0&&webphone_api.common.SaveParameter("theme",t),webphone_api.common.SaveParameter(e,t),webphone_api.common.isNull(webphone_api.parameters)||webphone_api.common.isNull(webphone_api.parameters[e])||(webphone_api.parameters[e]=t);var o=webphone_api.common.GetParameter("devicetype");if(o===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SetParameter",null,e,t);if(o===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.SetParameter(e,t)}catch(r){var i=e;i=webphone_api.common.isNull(i)?"":": "+i,webphone_api.common.PutToDebugLogException(2,"plhandler: SetParameter"+i,r)}return!1}function ve(e){try{if(webphone_api.common.isNull(e)||e.length<1)return null;e=e.toLowerCase();var t=webphone_api.common.GetParameter(e);try{if(window.location.href.indexOf("isdemopage=true")>0&&("sipusername"===e||"username"===e||"password"===e||"sippassword"===e||"serveraddress_user"===e||"serveraddress_orig"===e||"serveraddress"===e||"upperserver"===e||"callto"===e||"destination"===e)){var n=webphone_api.GetCookie("wpdemosett_"+e);if(!webphone_api.common.isNull(n)&&n.length>0&&(webphone_api.common.isNull(t)||t.length<1))return n}}catch(o){webphone_api.common.PutToDebugLogException(2,"plhandler: GetParameter inner",o)}return t}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: GetParameter",i)}return null}function Pe(e,t){try{if(Mt("SetLine"),webphone_api.common.isNull(e)||e.toString().length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: SetLine invalid line (1): "+e);webphone_api.common.PutToDebugLog(2,"EVENT, USER, setline (API_SetLine), "+e.toString());var n=!1,o=-10;if(webphone_api.common.IsNumber(e)&&e.toString().length<3){if((o=webphone_api.common.StrToInt(webphone_api.common.Trim(e)))<-2||o>50)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: SetLine invalid line (2): "+e);var i=o;-1===o&&(o=webphone_api.common.GetBestLine()),webphone_api.global.lastalineset=i,webphone_api.global.lastalinesettick=webphone_api.common.GetTickCount(),!0!==t&&(webphone_api.global.lastalinesetreal=i,webphone_api.global.lastalinesetrealtick=webphone_api.common.GetTickCount())}if(e=e.toString(),o<-5){n=!0;for(var a=0;a<webphone_api.global.ep.length;a++)if(!webphone_api.common.isNull(webphone_api.global.ep[a])){var r=webphone_api.global.ep[a][webphone_api.common.EP_DESTNR];!webphone_api.common.isNull(r)&&r.length>1&&e===r&&(o=webphone_api.common.StrToInt(webphone_api.global.ep[a][webphone_api.common.EP_LINE]))}}if(o<-5)for(var a=0;a<webphone_api.global.ep.length;a++)if(!webphone_api.common.isNull(webphone_api.global.ep[a])){var s=webphone_api.global.ep[a][webphone_api.common.EP_CALLID];!webphone_api.common.isNull(r)&&r.length>1&&e===s&&(o=webphone_api.common.StrToInt(webphone_api.global.ep[a][webphone_api.common.EP_LINE]))}if(0===webphone_api.common.IsMultiline())return void setTimeout(function(){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("M"),e.push("u"),e.push("l"),e.push("t"),e.push("i"),e.push("l"),e.push("i"),e.push("n"),e.push("e"),e.push(" "),e.push("f"),e.push("e"),e.push("a"),e.push("t"),e.push("u"),e.push("r"),e.push("e"),e.push(" "),e.push("i"),e.push("s"),e.push("d"),e.push("i"),e.push("s"),e.push("a"),e.push("b"),e.push("l"),e.push("e"),e.push("d");var t=e.join("");webphone_api.common.PutToDebugLog(1,t)},550);if(webphone_api.common.SetALineInternal(o,14),!1===Dn&&webphone_api.common.IsNumber(e)&&e>0&&(webphone_api.common.SaveParameter("multilinegui","1"),Dn=!0),webphone_api.common.RefreshInfo(),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void webphone_api.common.PutToDebugLog(2,"WARNING, SetLine method not available for engine: "+webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine));if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return!0===n?webphone_api.common.WinAPI("API_SetLine",null,e):webphone_api.common.WinAPI("API_SetLine",null,o),void webphone_api.common.SaveParameter("line",o.toString());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return!0===n?webphone_api.webphone.SetLineEx(e):webphone_api.webphone.SetLine(o),void webphone_api.common.SaveParameter("line",o.toString())}catch(l){webphone_api.common.PutToDebugLogException(2,"plhandler: SetLine",l)}return null}function Ee(){var e=webphone_api.global.aline;try{if(Mt("GetLine"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.common.PutToDebugLog(2,"EVENT, USER, getline (API_getLine) a "+e),e;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"WARNING, GetLine method not available for engine: "+webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)),webphone_api.common.PutToDebugLog(2,"EVENT, USER, getline (API_getLine) b "+e),e;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.PutToDebugLog(2,"EVENT, USER, getline (API_getLine) c "+e),e;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.common.SetALineInternal(webphone_api.webphone.GetLine(),15),webphone_api.common.PutToDebugLog(2,"EVENT, USER, getline (API_getLine) d "+webphone_api.global.aline),webphone_api.global.aline;webphone_api.common.PutToDebugLog(2,"EVENT, USER, getline (API_getLine) e "+e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLine",t)}return e}function Te(e,t){try{if(Mt("LineToCallID"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, linetocallid (API_LineToCallID)"),webphone_api.common.isNull(e)||!webphone_api.common.IsNumber(e))return void t("ERROR, linetocallid: Invalid line");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void t(webphone_api.webrtcapi.LineToCallID(e));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"WARNING, LineToCallID method not available for engine: "+webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)),"";if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_LineToCallID",function(e){t(e)},e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void t(webphone_api.webphone.LineToCallID(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: LineToCallID",n)}}function Ne(e,t){try{if(Mt("CallIDToLine"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, callidtoline (API_CallIDToLine)"),webphone_api.common.isNull(e)||e.length<1)return void t("ERROR, CallIDToLine: Invalid callid");if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void t(webphone_api.webrtcapi.CallIDToLine(e));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"WARNING, CallIDToLine method not available for engine: "+webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)),"";if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_CallIDToLine",function(e){t(e)},e);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void t(webphone_api.webphone.CallIDToLine(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: CallIDToLine",n)}}function Se(e){try{var t=-5;if(!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)&&(t=webphone_api.common.StrToInt(e)),t<1&&(t=webphone_api.common.GetBestLine()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var n=webphone_api.webphone.GetLineDetails(t);if(!webphone_api.common.isNull(n)&&n.length>0){var o=n.split(",");if(!webphone_api.common.isNull(o)&&o.length>0){n="";for(var i=0;i<o.length;i++)webphone_api.common.isNull(o[i])&&(o[i]=""),o[i]=webphone_api.common.Trim(o[i]),0===o[i].indexOf("_BASE64_")&&(o[i]=webphone_api.common.B64Dec(o[i]),webphone_api.common.isNull(o[i])&&(o[i]=""),o[i]=webphone_api.common.Trim(o[i])),n.length>0&&(n+=","),n+=o[i]}}return n}var a=t.toString(),r="Unused line",s="",l="",p="",c="-1",u=webphone_api.common.GetParameter("serveraddress_user"),h="",g="false",m="false",d="",b=webphone_api.common.GetTickCount(),_=webphone_api.global.lnstat[t];if(!webphone_api.common.isNull(_)&&_.length>1){var f=webphone_api.common.GetConfigInt("registerinterval",0);f<1&&(f=90),f*=6e4,!webphone_api.common.isNull(_[0])&&webphone_api.common.IsNumber(_[0])&&b-_[0]<=f&&!webphone_api.common.isNull(_[1]&&_[1].length)&&(r=_[1])}var w=webphone_api.common.GetEndpoint(1019,t,"","","",!1);!webphone_api.common.isNull(w)&&w.length>2&&(s=w[webphone_api.common.EP_CALLID],l=w[webphone_api.common.EP_DESTNR],p=webphone_api.common.GetSipusername(),c=w[webphone_api.common.EP_INCOMING],u=webphone_api.common.GetParameter("serveraddress_user"),h="",g=w[webphone_api.common.EP_MUTESTATE],m=w[webphone_api.common.EP_HOLDSTATE],d="");var v="LINEDETAILS,"+a+","+r+","+s+","+l+","+p+","+c+","+u+","+h+","+g+","+m+","+d;return webphone_api.common.PutToDebugLog(4,"EVENT, GetLineDetails user: "+v),v}catch(P){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLineDetails",P)}return""}function Ie(){try{Mt("GetLastCallDetails");var e=webphone_api.global.lastcalldetails;if(webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),webphone_api.global.phonestarted<2)return void Ht("GetLastCallDetails",[]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return e;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return e;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return e;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.GetLastCallDetails()}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLastCallDetails",t)}return""}function Ce(e){try{if(Mt("GetIcomingDisplay"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetIncomingDisplay callback is not definaed");if(webphone_api.global.phonestarted<2)return void Ht("GetIncomingDisplay",[e]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void e(webphone_api.common.GetWebrtcDisplayName());if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetIncomingDisplay",function(t){webphone_api.common.isNull(t)&&(t=""),t=webphone_api.common.Trim(t),0===t.indexOf("_BASE64_")&&(t=webphone_api.common.B64Dec(t),webphone_api.common.isNull(t)&&(t=""),t=webphone_api.common.Trim(t)),e(t)},webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()){var t=webphone_api.webphone.GetIncomingDisplay();return webphone_api.common.isNull(t)&&(t=""),t=webphone_api.common.Trim(t),0===t.indexOf("_BASE64_")&&(t=webphone_api.common.B64Dec(t),webphone_api.common.isNull(t)&&(t=""),t=webphone_api.common.Trim(t)),void e(t)}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetIncomingDisplay",n)}return""}function Re(){try{webphone_api.global.printwad_called=!1,webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_Unregister"),webphone_api.global.authenticated_displayed=!1,webphone_api.global.dispSaveSettMsg=0,webphone_api.global.pres_unreg_called=!0,webphone_api.global.last_presence_enabled=webphone_api.common.UsePresence2(),webphone_api.global.onregisteredcalled=!1;var e=webphone_api.global.dispregfailed;if(webphone_api.global.dispregfailed=2,setTimeout(function(){webphone_api.global.dispregfailed=e},500),!1===webphone_api.global.onunregistered_flag){webphone_api.global.onunregistered_flag=!0,setTimeout(function(){webphone_api.global.onunregistered_flag=!1},2e3);try{webphone_api.onRegStateChangeCb("unregistered",null)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onUnRegistered(unregistered) callback",n)}try{webphone_api.onUnRegisteredCb()}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onUnRegistered() callback",n)}}var t=webphone_api.common.getuseengine();if((webphone_api.common.isNull(t)||t.length<1)&&(t=webphone_api.global.last_useengine),t===webphone_api.global.ENGINE_WEBRTC)return webphone_api.flagrestartwebrtc=!1,webphone_api.webrtcapi.SipUnRegister(),webphone_api.common.Wsunreg(),webphone_api.global.phonestarted=2,void(webphone_api.global.webrtcsipsignalingreceived=0);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||t===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_Unregister",null),void(webphone_api.global.phonestarted=2);if(t===webphone_api.global.ENGINE_FLASH)return webphone_api.flashapi.Logout(null),void(webphone_api.global.phonestarted=2);if(t===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.Unregister(),void(webphone_api.global.phonestarted=2)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Unregister",n)}}function Ge(e){try{return webphone_api.global.onregisteredcalled=!1,(webphone_api.common.isNull(e)&&(e=webphone_api.common.getuseengine()),webphone_api.common.isNull(e)&&(e=webphone_api.common.GetSelectedEngineName()),e===webphone_api.global.ENGINE_WEBRTC)?(!0===webphone_api.global.checkIfInCall&&(webphone_api.common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_1: "+e),webphone_api.webrtcapi.SipHangup(!1,-2)),webphone_api.flagrestartwebrtc=!1,webphone_api.webrtcapi.SipStop(1),webphone_api.common.Wsunreg(),void(webphone_api.global.phonestarted=2)):e===webphone_api.global.ENGINE_FLASH?(!0===webphone_api.global.checkIfInCall&&(webphone_api.common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_2: "+e),webphone_api.flashapi.Hangup()),webphone_api.flashapi.Logout(null),void(webphone_api.global.phonestarted=2)):e===webphone_api.global.ENGINE_JAVA?(!0===webphone_api.global.checkIfInCall&&(webphone_api.common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_3: "+e),webphone_api.webphone.Hangup(-2)),webphone_api.webphone.Unregister(),void(webphone_api.global.phonestarted=2)):(!0===webphone_api.global.checkIfInCall||webphone_api.common.WinAPI("API_Unregister",null),void(webphone_api.global.phonestarted=2))}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: UnregisterEngine",t)}}function ye(){try{if(Mt("HTTPKeepAlive"),webphone_api.common.PutToDebugLog(5,"EVENT, httpkeepalive (API_HTTPKeepAlive)"),webphone_api.global.useengine!==webphone_api.global.ENGINE_JAVA)return;return webphone_api.webphone.HTTPKeepAlive()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: HTTPKeepAlive",e)}}function Le(){Mt("IsRegistered");try{if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var e=webphone_api.webphone.IsRegistered();return webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_IsRegistered: wp "+e.toString()),e}if(webphone_api.global.phonestarted>2)return webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_IsRegistered: true"),!0;webphone_api.common.PutToDebugLog(2,"EVENT, USER, isregistered (API_IsRegistered)")}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: IsRegistered",t)}return!1}function Oe(){Mt("IsInCall");try{webphone_api.common.PutToDebugLog(4,"EVENT, isincall: "+webphone_api.global.checkIfInCall.toString())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: IsInCall",e)}return webphone_api.global.checkIfInCall}function De(e,t,n){var o=0;try{if(webphone_api.common.isNull(e)||e<-2)return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: GetDeviceList dev is null "+e);if(!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetDeviceList callback is not defined");if(!0!==n){Mt("GetDeviceList");for(var i=!1,a=xn.length-1;a>=0;a--)if(xn[a]===e&&An[a]===t){i=!0;break}i||(xn.push(e),An.push(t))}if(xn.length<1&&(xn.push(e),An.push(t)),xn.length<1)return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: GetDeviceList no request is waiting a");if(An.length<1)return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: GetDeviceList no request is waiting b");if(!An[0]||"function"!=typeof An[0])return void webphone_api.common.PutToDebugLog(2,"WARNING, plhandler: GetDeviceList no request is waiting c");if(webphone_api.common.getuseengine().length<1&&webphone_api.global.phonestarted<2){webphone_api.common.isNull(kn)||clearTimeout(kn),kn=null;var r=xn[0],s=An[0];return void(kn=setTimeout(function(){webphone_api.common.isNull(r)&&(r="-41"),De(r,s,!0)},300))}if(webphone_api.common.isNull(kn)||clearTimeout(kn),kn=null,webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetAudioDeviceList",function(e){try{if(o=1,webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"PROCESSING_AUDIOLIST ("+e.length.toString()+") : "+e),xn.length<1)null!=e&&e.length>0&&webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist unexpected answer: "+e);else{o=2;var t=An.shift();o=3;var n=xn.shift();if(o=4,0===e.indexOf("_BASE64_")&&(e=webphone_api.common.B64Dec(e),webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e)),o=5,0==e.indexOf("ERROR")||0==e.indexOf("APIREQUEST")?webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist invaid answer: "+e+" (for "+n+")"):0==n?(o=6,webphone_api.global.audio_rec_device_list=e,webphone_api.common.SaveParameter("cache_audio_rec_device_list",e),o=7,t(e)):1==n?(o=8,webphone_api.global.audio_play_device_list=e,webphone_api.common.SaveParameter("cache_audio_play_device_list",e),o=9,t(e)):2==n?(o=10,!webphone_api.common.isNull(e)&&e.length>0&&e.indexOf("\r\nAll")<1&&(e+="\r\nAll"),webphone_api.global.audio_ring_device_list=e,webphone_api.common.SaveParameter("cache_audio_ring_device_list",e),o=11,t(e)):3==n?(o=12,webphone_api.global.video_rec_device_list=e,webphone_api.common.SaveParameter("cache_video_rec_device_list",e),t(e)):webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist answer with unknow dev: "+e),o=13,!webphone_api.common.isNull(An)&&An.length>0){o=14;var i=xn[0];o=15;var a=An[0];o=16,setTimeout(function(){o=17,webphone_api.common.isNull(i)&&(i="-42"),De(i,a,!0)},8)}}}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: GetDeviceListInner "+o,r)}},xn[0]);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){var l="",p=xn.shift(),c=An.shift();if(l=webphone_api.webphone.GetAudioDeviceList(p),webphone_api.common.isNull(l)&&(l=""),l=webphone_api.common.Trim(l),0===l.indexOf("_BASE64_")&&(l=webphone_api.common.B64Dec(l),webphone_api.common.isNull(l)&&(l=""),l=webphone_api.common.Trim(l)),0==l.indexOf("ERROR")||0==l.indexOf("APIREQUEST")?webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist invaid answer: "+l+" (for "+p+")"):0==p?(webphone_api.global.audio_rec_device_list=l,webphone_api.common.SaveParameter("cache_audio_rec_device_list",l)):1==p?(webphone_api.global.audio_play_device_list=l,webphone_api.common.SaveParameter("cache_audio_play_device_list",l)):2==p?(!webphone_api.common.isNull(l)&&l.length>0&&l.indexOf("\r\nAll")<1&&(l+="\r\nAll"),webphone_api.global.audio_ring_device_list=l,webphone_api.common.SaveParameter("cache_audio_ring_device_list",l)):(webphone_api.global.video_rec_device_list=l,webphone_api.common.SaveParameter("cache_video_rec_device_list",l)),c(l),!webphone_api.common.isNull(An)&&An.length>0){var r=xn[0],s=An[0];setTimeout(function(){webphone_api.common.isNull(r)&&(r="-43"),De(r,s,!0)},8)}return}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){var l="",p=xn.shift(),c=An.shift();if(0==p?(l=webphone_api.webrtcapi.GetAudioDeviceList(p),webphone_api.global.audio_rec_device_list=l,webphone_api.common.SaveParameter("cache_audio_rec_device_list",l)):1==p?(l=webphone_api.webrtcapi.GetAudioDeviceList(p),webphone_api.global.audio_play_device_list=l,webphone_api.common.SaveParameter("cache_audio_play_device_list",l)):2==p?(l=webphone_api.webrtcapi.GetAudioDeviceList(p),webphone_api.global.audio_ring_device_list=l,webphone_api.common.SaveParameter("cache_audio_ring_device_list",l)):(l=webphone_api.webrtcapi.GetAudioDeviceList(p),webphone_api.global.video_rec_device_list=l,webphone_api.common.SaveParameter("cache_video_rec_device_list",l)),c(l),!webphone_api.common.isNull(An)&&An.length>0){var r=xn[0],s=An[0];setTimeout(function(){webphone_api.common.isNull(r)&&(r="-44"),De(r,s,!0)},8)}return}var c=An.shift();xn.shift(),c("ERROR, Cannot get device list because no engine is started at the moment")}catch(u){webphone_api.common.PutToDebugLogException(2,"plhandler: GetDeviceList",u)}}function xe(e,t,n){var o=0;try{if(o=1,!0!==n||Vn.length<1){if(o=2,Mt("GetDevice"),!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetDevice callback is not defined");o=3,Un.push(e),o=3001,Vn.push(t)}if(o=4,webphone_api.common.getuseengine().length<1||webphone_api.global.phonestarted<2){o=5,webphone_api.common.isNull(Wn)||clearTimeout(Wn),Wn=null;var i=Un[0];return o=6,void(Wn=setTimeout(function(){o=7,xe(i,null,!0)},250))}if(o=8,webphone_api.common.isNull(Wn)||clearTimeout(Wn),Wn=null,o=9,webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return o=10,void webphone_api.common.WinAPI("API_GetAudioDevice",function(e){if(o=11,webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e),webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"PROCESSING_AUDIODEV ("+e.length.toString()+") : "+e),o=12,Un.length<1)o=13,null!=e&&e.length>0&&webphone_api.common.PutToDebugLog(3,"WARNING, audidevice unexpected answer: "+e);else{o=14;var t=Un.shift();0===e.indexOf("_BASE64_")&&(o=15,e=webphone_api.common.B64Dec(e),webphone_api.common.isNull(e)&&(e=""),e=webphone_api.common.Trim(e)),o=16,0==e.indexOf("ERROR")||0==e.indexOf("APIREQUEST")?webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist invaid answer: "+e+" (for "+t+")"):0==t?(webphone_api.global.audio_rec_curr_device=e,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",e)):1==t?(webphone_api.global.audio_play_curr_device=e,webphone_api.common.SaveParameter("cache_audio_play_curr_device",e)):2==t?(webphone_api.global.audio_ring_curr_device=e,webphone_api.common.SaveParameter("cache_audio_ring_curr_device",e)):3==t?(webphone_api.global.video_rec_curr_device=e,webphone_api.common.SaveParameter("cache_video_rec_curr_device",e)):webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist answer with unknow dev: "+e),o=17;var n=Vn.shift();if(o=18,webphone_api.common.PutToDebugLog(4,"EVENT, GetDevice (1), res: "+e),n(e),o=19,!webphone_api.common.isNull(Vn)&&Vn.length>0){o=20;var i=Un[0];o=21,setTimeout(function(){o=22,xe(i,null,!0)},8)}}},e);if(o=23,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){o=24;var a="",r=Un.shift();o=25,a=webphone_api.webphone.GetAudioDevice(e),o=26,webphone_api.common.isNull(a)&&(a=""),a=webphone_api.common.Trim(a),0===a.indexOf("_BASE64_")&&(o=27,a=webphone_api.common.B64Dec(a),webphone_api.common.isNull(a)&&(a=""),a=webphone_api.common.Trim(a)),o=28,0==a.indexOf("ERROR")||0==a.indexOf("APIREQUEST")?webphone_api.common.PutToDebugLog(3,"WARNING, audidevicelist invaid answer: "+a+" (for "+r+")"):0==r?(webphone_api.global.audio_rec_curr_device=a,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",a)):1==r?(webphone_api.global.audio_play_curr_device=a,webphone_api.common.SaveParameter("cache_audio_play_curr_device",a)):2==r?(webphone_api.global.audio_ring_curr_device=a,webphone_api.common.SaveParameter("cache_audio_ring_curr_device",a)):(webphone_api.global.video_rec_curr_device=a,webphone_api.common.SaveParameter("cache_video_rec_curr_device",a)),o=29;var s=Vn.shift();if(o=30,webphone_api.common.PutToDebugLog(4,"EVENT, GetDevice (2), dev: "+r+"; res: "+a),s(a),o=31,!webphone_api.common.isNull(Vn)&&Vn.length>0){o=32;var i=Un[0];setTimeout(function(){o=33,xe(i,null,!0)},8)}return}if(o=34,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){o=35;var a="",r=Un.shift();o=36,0==r?(o=37,a=webphone_api.webrtcapi.GetAudioDevice(e),webphone_api.global.audio_rec_curr_device=a,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",a)):1==r?(o=38,a=webphone_api.webrtcapi.GetAudioDevice(e),webphone_api.global.audio_play_curr_device=a,webphone_api.common.SaveParameter("cache_audio_play_curr_device",a)):2==r?(a=webphone_api.webrtcapi.GetAudioDevice(e),webphone_api.global.audio_ring_curr_device=a,webphone_api.common.SaveParameter("cache_audio_ring_curr_device",a)):(a=webphone_api.webrtcapi.GetAudioDevice(e),webphone_api.global.video_rec_curr_device=a,webphone_api.common.SaveParameter("cache_video_rec_curr_device",a)),o=40;var s=Vn.shift();if(o=41,webphone_api.common.PutToDebugLog(4,"EVENT, GetDevice (3), dev: "+r+"; res: "+a),o=42,s(a),o=43,!webphone_api.common.isNull(Vn)&&Vn.length>0){o=44;var i=Un[0];o=45,setTimeout(function(){o=46,xe(i,null,!0)},100)}return}}catch(l){webphone_api.common.PutToDebugLogException(2,"plhandler: GetDevice "+o,l)}}function Ae(e,t,n,o,i){try{if(!0!==i&&(Mt("SetDevice"),Fn.push(e),Mn.push(t),Hn.push(n),Bn.push(o)),webphone_api.common.getuseengine().length<1||webphone_api.global.phonestarted<2)return webphone_api.common.isNull(jn)||clearTimeout(jn),jn=null,void(jn=setTimeout(function(){Ae(null,null,null,null,!0)},250));if(webphone_api.common.isNull(jn)||clearTimeout(jn),jn=null,null===e&&!webphone_api.common.isNull(Fn)&&Fn.length>0&&(e=Fn.shift(),t=Mn.shift(),n=Hn.shift(),o=Bn.shift()),null===e&&null===t)return;if(webphone_api.common.PutToDebugLog(4,"EVENT, setdevice, dev: "+e+"; devicename: "+t+"; immediate: "+n),
webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_SetAudioDevice",null,e,t,n),void(!webphone_api.common.isNull(Fn)&&Fn.length>0&&setTimeout(function(){Ae(null,null,null,null)},100));if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.SetAudioDevice(e,t,n),!webphone_api.common.isNull(Fn)&&Fn.length>0&&setTimeout(function(){Ae(null,null,null,null)},100),!0;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return webphone_api.webrtcapi.SetAudioDevice(e,t,o),!webphone_api.common.isNull(Fn)&&Fn.length>0&&setTimeout(function(){Ae(null,null,null,null)},100),!0}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: SetDevice",a)}}function ke(e,t){try{if(webphone_api.global.isappenginestarted=!1,(webphone_api.common.isNull(e)||e.length<1)&&(e=webphone_api.common.getuseengine()),(webphone_api.common.isNull(e)||e.length<1)&&(e=webphone_api.global.last_useengine),webphone_api.common.isNull(e)||e.length<1)return void webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: StopEngine engine is not defined");webphone_api.global.webrtc_regstate=0,webphone_api.common.PutToDebugLog(2,"EVENT, USER, stopengine (API_StopEngine)");if(!1===webphone_api.common.GetParameterBool("needunregister",!0)&&!0!==t)return void webphone_api.common.PutToDebugLog(2,"EVENT, API_StopEngine needunregister is FALSE");if(webphone_api.common.Glsp()){if(e===webphone_api.global.ENGINE_SERVICE)return webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.wnotstartedsession=!1,void(!1===webphone_api.common.NSMacLinEnabled()&&webphone_api.common.WinAPI("API_Exit",null,"1"));if(e===webphone_api.global.ENGINE_JAVA)return webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.wnotstartedsession=!1,webphone_api.webphone.Exit()}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: StopEngine",n)}}function Ue(e,t){try{webphone_api.common.PutToDebugLog(2,"EVENT, USER, API_Stop (force: "+e+" from: "+t+")"),webphone_api.flagrestartwebrtc=!1,webphone_api.global.laststarttick=0,webphone_api.global.webrtc_regstate=0,webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.webrtcsipsignalingreceived=0,webphone_api.global.wnotstartedsession=!1,webphone_api.global.isappenginestarted=!1,webphone_api.global.onunload_flag&&(e=!0),Ge(),setTimeout(function(){ke(webphone_api.common.getuseengine(),e)},900),setTimeout(function(){webphone_api.common.isNull(webphone_api.global.maintimerid)||(clearInterval(webphone_api.global.maintimerid),webphone_api.global.maintimerid=null,webphone_api.common.isNull(webphone_api.global.initcalled)||(webphone_api.global.initcalled=!1)),webphone_api.global.apistartstate=0,webphone_api.global.apistarttick=0,webphone_api.global.webrtcsipsignalingreceived=0,webphone_api.global.wnotstartedsession=!1},1100),setTimeout(function(){try{webphone_api.onAppStateChangeCb("stopped")}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(stopped) callback",e)}try{webphone_api.onStopCb()}catch(e){webphone_api.common.PutToDebugLogException(2,"There is an error in onStop() callback",e)}},1250),webphone_api.common.isNull(webphone_api.global.serviceStatusPollTimer)||clearInterval(webphone_api.global.serviceStatusPollTimer),webphone_api.common.isNull(webphone_api.global.polltimerid)||clearInterval(webphone_api.global.polltimerid),webphone_api.common.isNull(webphone_api.global.worktimer)||clearTimeout(webphone_api.global.worktimer),webphone_api.global.worktimer=null;if(!1===webphone_api.common.GetParameterBool("needunregister",!0)&&!0!==e)return void webphone_api.common.PutToDebugLog(2,"EVENT, API_Stop needunregister is FALSE");webphone_api.common.Glsp()&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?webphone_api.global.phonestarted>2&&(webphone_api.webrtcapi.SipStop(2),webphone_api.common.Wsunreg()):webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?!1===webphone_api.common.NSMacLinEnabled()&&webphone_api.common.WinAPI("API_Exit",null,"2"):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.Exit()),webphone_api.global.onunload_flag&&ke(webphone_api.common.getuseengine(),e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: Stop",n)}webphone_api.global.phonestarted=0}function Ve(e){try{if(Mt("SendChatIsComposing"),webphone_api.common.isNull(e)||e.lebgth<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, SendChatIsComposing invalid destination");var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_SendChatIsComposing",null,webphone_api.common.GetLineForJavaAPI(),e);if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA)return webphone_api.webphone.SendChatIsComposing(t,e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: SendChatIsComposing",n)}}function We(){return webphone_api.common.BrowserWindowIsActive()}function Fe(){try{return Mt("HelpWindow"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, helpwindow (API_HelpWindow)"),webphone_api.common.HelpWindow()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: HelpWindow",e)}return!1}function Me(){try{return Mt("SettingsPage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, settingspage (API_SettingsPage)"),webphone_api.common.OpenSettings(!0,9),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: SettingsPage",e)}return!1}function He(){try{return Mt("DialPage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, dialpage (API_DialPage)"),webphone_api.$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"}),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: DialPage",e)}return!1}function Be(){try{return Mt("MessageInboxPage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, messageinboxpage (API_MessageInboxPage)"),webphone_api.$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"}),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: MessageInboxPage",e)}return!1}function je(){try{return Mt("MessagePage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, messagepage (API_MessagePage)"),webphone_api.global.intentmsg[0]="action=",webphone_api.global.intentmsg[1]="to=",webphone_api.global.intentmsg[2]="message=",webphone_api.$.mobile.changePage("#page_message",{transition:"none",role:"page"}),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: MessagePage",e)}return!1}function $e(){try{return Mt("AddContactPage"),webphone_api.common.PutToDebugLog(2,"EVENT, USER, addcontactpage (API_AddContactPage)"),webphone_api.global.intentaddeditct[0]="action=add",webphone_api.$.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"}),!0}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: AddContactPage",e)}return!1}function qe(e){try{webphone_api.webphone.InsertApplet(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: InsertApplet",t)}}function ze(){try{return webphone_api.common.EnterKeyPress()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: EnterKeyPress",e)}return!1}function Ke(e){te(e,"FILETRANSFER_DELIVERED:"+e)}function Xe(e,t){try{if(Mt("GetTelSearchName"),!t||"function"!=typeof t)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetTelsearchName callback is not definaed");if(webphone_api.common.isNull(e)||e.length<2)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: GetTelsearchName invalid number: "+e);webphone_api.common.GetTelsearchName(e,t)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: EnterKeyPress",n)}}function Je(e){try{webphone_api.common.bwanswer(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: bwanswer",t)}}function Ye(){try{if(webphone_api.global.wasSettModified){var e=webphone_api.common.GetActiveAccSettingsFilename();!isNull(e)&&e.length>0&&webphone_api.common.SaveSettingsFile(5,e,function(e){webphone_api.common.CanLog(2)&&(e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveSettingsFile from onappexit Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveSettingsFile from onappexit Failed"))})}}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: onappexit",t)}}function Qe(){Mt("getlogs"),webphone_api.common.PutToDebugLog(2,"EVENT, getlogs called");var e=webphone_api.global.logs;return webphone_api.global.logs="",e}function Ze(){try{Mt("getlogsex"),webphone_api.common.PutToDebugLog(2,"EVENT, getlogsex called"),webphone_api.common.WinAPI("API_SetLogs",null,webphone_api.global.logs)}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: getlogsex",e)}}function et(e){try{webphone_api.common.isNull(e)&&(e=""),webphone_api.common.PutToDebugLog(2,"APILOGS: "+e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: putlogs",t)}}function tt(){try{Mt("ImportContacts"),webphone_api.common.PutToDebugLog(2,"EVENT, importcontacts called"),webphone_api.common.DownloadContacts()}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: ImportContacts",e)}}function nt(e,t){try{Mt("delsettings"),webphone_api.global.phonestarted<2&&(webphone_api.common.PutToDebugLog(2,"EVENT, resetsettings set to TRUE"),webphone_api.common.SaveParameter("resetsettings","true")),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.common.WinAPI("API_DelSettings",null,e):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.DelSettings(e),!0!==t&&webphone_api.common.delsettings(e)}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: delsettings",n)}}function ot(e){try{if(Mt("needratingrequest"),!e||"function"!=typeof e)return!1;if(webphone_api.global.phonestarted<2)return void Ht("needratingrequest",[e]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_IsEncrypted",function(t){e(webphone_api.common.isNull(t)?"true"===t||!0===t?!0:!1:!1)});webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.NeedRatingRequest(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: needratingrequest",t),e(!1)}}function it(){try{if(!webphone_api.common.isNull(platform)&&!webphone_api.common.isNull(platform.name)){var e=webphone_api.platform.name.toString();if(e=e.toLowerCase(),e.indexOf("mobile")>=0)return!0}var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: IsMobileBrowser",n)}return!1}function at(){try{return webphone_api.common.isNull(webphone_api.global.useengine)?"":webphone_api.global.useengine}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: Getenginename",e)}}function rt(e){try{if(Mt("GetLastInvite"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: getlastinvite callback is not defined");if(webphone_api.global.phonestarted<2)return void Ht("GetLastInvite",[e]);var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){t<1&&(t=webphone_api.common.GetBestLine());var n=webphone_api.common.GetEndpoint(1020,t,"","","",!1),o="";return isNull(n)||(o=n[webphone_api.common.EP_SIPINVITE]),void e(o)}if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getlastinvite is not supported by flash engine"),void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetLastInvite",function(t){e(t)},webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void e(webphone_api.webphone.GetGetLastInvite(webphone_api.common.GetLineForJavaAPI(),e))}catch(i){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLastInvite",i)}}function st(e){try{if(Mt("GetLastRecInvite"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: getlastrecinvite callback is not defined");if(webphone_api.global.phonestarted<2)return void Ht("GetLastRecInvite",[e]);var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void e(webphone_api.common.GetLastRecInvite());if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getlastrecinvite is not supported by flash engine"),void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetLastRecInvite",function(t){e(t)},webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void e(webphone_api.webphone.GetGetLastRecInvite(webphone_api.common.GetLineForJavaAPI(),e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLastRecInvite",n)}}function lt(e){try{if(Mt("GetLastSentInvite"),!e||"function"!=typeof e)return void webphone_api.common.PutToDebugLog(2,"ERROR, plhandler: getlastsentinvite callback is not defined");if(webphone_api.global.phonestarted<2)return void Ht("GetLastSentInvite",[e]);var t=webphone_api.global.aline;if((webphone_api.common.isNull(t)||-3===t)&&(t=-1),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC)return void e(webphone_api.common.GetLastSentInvite());if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_FLASH)return webphone_api.common.PutToDebugLog(2,"ERROR, getlastsentinvite is not supported by flash engine"),void e("");if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.WinAPI("API_GetLastSentInvite",function(t){e(t)},webphone_api.common.GetLineForJavaAPI());if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return void e(webphone_api.webphone.GetLastSentInvite(webphone_api.common.GetLineForJavaAPI(),e))}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetLastSentInvite",n)}}function pt(){try{if(Mt("API_RecFiles_Upload"),webphone_api.global.phonestarted<2)return void Ht("API_RecFiles_Upload",[]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_RecFiles_Upload",null),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.API_RecFiles_Upload();webphone_api.common.PutToDebugLog(2,"WARNING, API_RecFiles_Upload not supported by engine: "+webphone_api.common.getuseengine())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: API_RecFiles_Upload",e)}return!1}function ct(e,t){try{if(Mt("API_RecFiles_UploadEx"),webphone_api.global.phonestarted<2)return void Ht("API_RecFiles_UploadEx",[e,t]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_RecFiles_UploadEx",null,e,t),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.API_RecFiles_UploadEx(e,t);webphone_api.common.PutToDebugLog(2,"WARNING, API_RecFiles_UploadEx not supported by engine: "+webphone_api.common.getuseengine())}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: API_RecFiles_UploadEx",n)}return!1}function ut(){try{if(Mt("API_RecFiles_Clear"),webphone_api.global.phonestarted<2)return void Ht("API_RecFiles_Clear",[]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_RecFiles_Clear",null),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.API_RecFiles_Clear();webphone_api.common.PutToDebugLog(2,"WARNING, API_RecFiles_Clear not supported by engine: "+webphone_api.common.getuseengine())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: API_RecFiles_Clear",e)}return!1}function ht(){try{if(Mt("API_RecFiles_Del"),webphone_api.global.phonestarted<2)return void Ht("API_RecFiles_Del",[]);if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)return webphone_api.common.WinAPI("API_RecFiles_Del",null),!0;if(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE())return webphone_api.webphone.API_RecFiles_Del();webphone_api.common.PutToDebugLog(2,"WARNING, API_RecFiles_Del not supported by engine: "+webphone_api.common.getuseengine())}catch(e){webphone_api.common.PutToDebugLogException(2,"plhandler: API_RecFiles_Del",e)}return!1}function gt(e){try{return webphone_api.stringres.get(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"plhandler: getstringresource",t)}return""}function mt(e,t){try{Mt("Jvoip-"+e);var n=at();if(webphone_api.common.isNull(n)||n.length<2)return void webphone_api.common.PutToDebugLog(2,"ERROR, Jvoip no engine available at the moment");if(n!==webphone_api.global.ENGINE_JAVA&&n!==webphone_api.global.ENGINE_SERVICE)return void webphone_api.common.PutToDebugLog(2,"ERROR, Jvoip not applicable for engine: "+webphone_api.common.GetEngineDisplayName(n));if(webphone_api.common.isNull(e)||e.length<3)return void webphone_api.common.PutToDebugLog(2,"ERROR, Jvoip invalid api function name: "+e);var o=e.indexOf("(");o>0&&(e=e.substring(0,o)),e=webphone_api.common.Trim(e),webphone_api.common.isNull(t)&&(t=[]);for(var i="",a=0;a<t.length;a++)a>0&&(i+=","),i+=t[a];webphone_api.common.PutToDebugLog(2,"EVENT, USER, jvoip (API_Jvoip): "+e+"; arguments: ["+i+"]"),webphone_api.webphone.Jvoip(e,t)}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: Jvoip",r)}}function dt(){return webphone_api.common.GetOneStunSrv()}function bt(e,t){try{Mt("RemoveCodecMaudio");var n=e;if(webphone_api.common.isNull(t)||!1===webphone_api.common.IsNumber(t))return webphone_api.common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio invalid codec: "+t),e;if(webphone_api.common.isNull(n)||e.indexOf("m=audio")<0)return webphone_api.common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio invalid m=audio: "+n),e;var o=n.indexOf("/");if(o<0)return webphone_api.common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio cannot parse m=audio: "+n),e;var i=n.substring(0,o);return n=n.substring(o),n.indexOf(" "+t+" ")>=0?n=n.replace(" "+t+" "," "):n.indexOf(" "+t+"\r")>=0&&(n=n.replace(" "+t+"\r","\r")),i+n}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: RemoveCodecMaudio",a)}return e}function _t(e,t){try{Mt("SetPrefCodecMaudio");var n=e;if(webphone_api.common.isNull(t)||!1===webphone_api.common.IsNumber(t))return webphone_api.common.PutToDebugLog(2,"ERROR, SetPrefCodecMaudio invalid codec: "+t),e;if(webphone_api.common.isNull(n)||e.indexOf("m=audio")<0)return webphone_api.common.PutToDebugLog(2,"ERROR, SetPrefCodecMaudio invalid m=audio: "+n),e;var o=n.indexOf("/");if(o<0)return webphone_api.common.PutToDebugLog(2,"ERROR, SetPrefCodecMaudio cannot parse m=audio: "+n),e;var i=n.substring(0,o);if(n=n.substring(o),(o=n.indexOf(" "))>0)return i+=n.substring(0,o),n=n.substring(o),n.indexOf(" "+t+" ")>=0?(n=n.replace(" "+t+" "," "),n=" "+t+n):n.indexOf(" "+t+"\r")>=0&&(n=n.replace(" "+t+"\r","\r"),n=" "+t+n),i+n}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: RemoveCodecMaudio",a)}return e}function ft(e){try{var t=e,n=webphone_api.common.GetParameter("codec");if(webphone_api.common.isNull(n)||n.length<1||"-1"===n||","===n)return e;var o=n.split(",");if(webphone_api.common.isNull(o)||o.length<1)return e;for(var i=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_pcmu")),a=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_pcma")),r=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_speexwb")),s=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_opuswb")),l=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_isac")),p=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_g722")),c=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_h264")),u=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_h265")),h=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_vp8")),g=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_vp9")),m=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_vp10")),d=webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_av1")),b=0;b<o.length;b++)if(!webphone_api.common.isNull(o[b])){var _=o[b].toLowerCase().trim();"1"===_?i=!0:"2"===_?a=!0:"5"===_||"6"===_?r=!0:"10"===_||"11"===_||"12"===_||"13"===_?s=!0:"14"===_?p=!0:"15"===_?l=!0:"50"===_?c=!0:"51"===_?u=!0:"52"===_?h=!0:"53"===_?g=!0:"54"===_?m=!0:"55"===_?d=!0:"pcmu"===_?i=!0:"pcma"===_?a=!0:"g.711"===_||"g711"===_?(i=!0,a=!0):"speex"===_||"speexwb"===_?r=!0:"opus"===_||"opuswb"===_?s=!0:"isac"===_?l=!0:"g.722"===_||"g722"===_?p=!0:"h.264"===_||"h264"===_?c=!0:"h.265"===_||"h265"===_?u=!0:"vp8"===_?h=!0:"vp9"===_?g=!0:"vp10"===_?m=!0:"av1"===_&&(d=!0)}!1===webphone_api.common.Glop()&&(s=!1);var f=!1;(i||a||r||s||l||p)&&(f=!0);var w=!1;if((c||u||h||g||m||d)&&(w=!0),!f&&!w)return webphone_api.common.PutToDebugLog(2,"EVENT, HandleWebrtcCodecs skip setting disabling all audio codec"),e;var v=t.split("\n");if(webphone_api.common.isNull(v)&&v.length<10)return e;for(var P=-1,b=0;b<v.length;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("m=audio")>=0){P=b;break}if(P<0)return webphone_api.common.PutToDebugLog(2,"ERROR, HandleWebrtcCodecs m=audio not found"),e;if(!1===i&&f){var E="0";v[P]=bt(v[P],E);for(var T=v.length,b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}if(!1===a&&f){var E="8";v[P]=bt(v[P],E);for(var T=v.length,b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}if(!1===r&&f){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("speex")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===s&&f){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("opus")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===l&&f){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("isac/16000")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===l&&f){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("isac/32000")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===l&&f){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("isac")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===p&&f){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("g722")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===c&&w){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("h264")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===u&&w){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("h265")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===h&&w){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("vp8")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===g&&w){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("vp9")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===m&&w){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("vp10")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}if(!1===d&&w){for(var E="",T=v.length,b=0;b<T;b++)if(!webphone_api.common.isNull(v[b])&&v[b].indexOf("a=rtpmap:")>=0&&v[b].toLowerCase().indexOf("av1")>0){E=v[b].replace("a=rtpmap:",""),E=webphone_api.common.Trim(E);var N=E.indexOf(" ");N>0&&(E=webphone_api.common.Trim(E.substring(0,N)))}if(!webphone_api.common.isNull(E)&&E.length>0){v[P]=bt(v[P],E);for(var b=0;b<T;b++)!webphone_api.common.isNull(v[b])&&(v[b].indexOf("a=rtpmap:"+E)>=0||v[b].indexOf("a=rtcp-fb:"+E)>=0||v[b].indexOf("a=fmtp:"+E)>=0)&&(v.splice(b,1),b--,T--)}}t=""
;for(var b=0;b<v.length;b++)t.length>0&&(t+="\n"),t+=v[b];return t}catch(S){webphone_api.common.PutToDebugLogException(2,"plhandler: HandleWebrtcCodecs",S)}return e}function wt(e){try{var t=e,n=webphone_api.common.GetParameter("prefcodec");if(webphone_api.common.isNull(n)||n.length<1||"-1"===n||","===n)return e;var o=!1,i=!1,a=!1,r=!1,s=!1,l=!1,p=!1,c=!1,u=!1,h=!1,g=!1,m=!1,d=n.toLowerCase().trim();if("1"===d?o=!0:"2"===d?i=!0:"5"===d||"6"===d?a=!0:"10"===d||"11"===d||"12"===d||"13"===d?r=!0:"14"===d?l=!0:"15"===d?s=!0:"50"===d?p=!0:"51"===d?c=!0:"52"===d?u=!0:"53"===d?h=!0:"54"===d?g=!0:"55"===d?m=!0:"pcmu"===d?o=!0:"pcma"===d?i=!0:"g.711"===d||"g711"===d?o=!0:"speex"===d||"speexwb"===d?a=!0:"opus"===d||"opuswb"===d?r=!0:"isac"===d?s=!0:"g.722"===d||"g722"===d?l=!0:"h.264"===d||"h264"===d?p=!0:"h.265"===d||"h265"===d?c=!0:"vp8"===d?u=!0:"vp9"===d?h=!0:"vp10"===d?g=!0:"av1"===d&&(m=!0),!1===webphone_api.common.Glop()&&(r=!1),!(o||i||a||r||s||l||p||c||u||h||g||m))return e;var b=t.split("\n");if(webphone_api.common.isNull(b)&&b.length<10)return e;for(var _=-1,f=0;f<b.length;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("m=audio")>=0){_=f;break}if(_<0)return webphone_api.common.PutToDebugLog(2,"ERROR, HandleWebrtcPrefCodec m=audio not found"),e;if(!0===o){var w="0";b[_]=_t(b[_],w);for(var v=b.length,f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}if(!0===i){var w="8";b[_]=_t(b[_],w);for(var v=b.length,f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}if(!0===a){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("speex")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===r){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("opus")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===s){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("isac")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===l){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("g722")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===p){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("h264")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===c){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("h265")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===u){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("vp8")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===h){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("vp9")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===g){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("vp10")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}if(!0===m){for(var w="",v=b.length,f=0;f<v;f++)if(!webphone_api.common.isNull(b[f])&&b[f].indexOf("a=rtpmap:")>=0&&b[f].toLowerCase().indexOf("av1")>0){w=b[f].replace("a=rtpmap:",""),w=webphone_api.common.Trim(w);var P=w.indexOf(" ");P>0&&(w=webphone_api.common.Trim(w.substring(0,P)))}if(!webphone_api.common.isNull(w)&&w.length>0){b[_]=_t(b[_],w);for(var f=0;f<v;f++)!webphone_api.common.isNull(b[f])&&(b[f].indexOf("a=rtpmap:"+w)>=0||b[f].indexOf("a=rtcp-fb:"+w)>=0||b[f].indexOf("a=fmtp:"+w)>=0)&&(b.splice(f,1),f--,v--)}}t="";for(var f=0;f<b.length;f++)t.length>0&&(t+="\n"),t+=b[f];return t}catch(E){webphone_api.common.PutToDebugLogException(2,"plhandler: HandleWebrtcPrefCodec",E)}return e}function vt(e){try{if("Firefox"!==webphone_api.common.GetBrowser()||webphone_api.common.GetBrowserVersion()<75)return e;if(void 0===e||null===e||e.indexOf("\r\n\r\n")<0)return e;var t=e.toLowerCase();if(t.indexOf("invite sip:")<0&&t.indexOf("invite sips:")<0)return e;var n=e,o=n.split("\n");if(webphone_api.common.isNull(o)&&o.length<10)return e;n="";for(var i=0,a=-1,r=-1,s=0;s<o.length;s++)o[s].indexOf("a=sendrecv")>=0&&(i++,a=s),o[s].indexOf("a=sendonly")>=0&&(i++,r=s);if(i>1&&a>0){r>0&&(o[a]=o[a].replace("a=sendrecv","a=sendonly")),o.splice(a,1),webphone_api.common.PutToDebugLog(2,"EVENT, HandleWebrtcFirefoxHold sendrecv removed_2");for(var s=0;s<o.length;s++)n.length>0&&(n+="\n"),n+=o[s];return n}}catch(l){webphone_api.common.PutToDebugLogException(2,"plhandler: HandleWebrtcFirefoxHold",l)}return e}function Pt(e){try{if(void 0===e||null===e)return e;if("Firefox"!==webphone_api.common.GetBrowser())return e;var t=e,n=t.split("\n");if(webphone_api.common.isNull(n)&&n.length<10)return e;t="";for(var o=0,i=-1,a=0;a<n.length;a++)n[a].indexOf("a=msid:")>=0&&(o++,i=a);if(o>1&&i>0){n.splice(i,1),webphone_api.common.PutToDebugLog(2,"EVENT, HandleWebrtcFirefoxHold_RemoveDuplicateHeader removed");for(var a=0;a<n.length;a++)t.length>0&&(t+="\n"),t+=n[a];return t}}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: HandleWebrtcFirefoxHold_RemoveDuplicateHeader",r)}return e}function Et(){try{var e=!1,t=webphone_api.common.GetParameter("serveraddressbook_url");if(!webphone_api.common.isNull(t)&&t.length>0){var n=webphone_api.common.GetParameterInt("serveraddressbook_sync",0),o=webphone_api.common.GetParameterInt("serveraddressbook_status",2);o<1?e=!0:1===o&&n>0&&(e=!0),n>1&&(e=!0)}if(!0===e){webphone_api.common.IsHttps()&&(t=t.replace("http:","https:")),webphone_api.common.PutToDebugLog(3,"EVENT, DownloadServerAddressbook url: "+t);var i=new XMLHttpRequest;if("withCredentials"in i)i.open("GET",t,!0);else{if("undefined"==typeof XDomainRequest)return void webphone_api.common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook, CORS not supported");i=new XDomainRequest,i.open("GET",t)}var a=0;i.onload=function(){try{webphone_api.common.PutToDebugLog(4,"EVENT, DownloadServerAddressbook.onload"),a=19;var e=i.responseText;return a=20,webphone_api.common.PutToDebugLog(2,"EVENT, DownloadServerAddressbook response: "+e),a=21,webphone_api.common.isNull(e)||e.length<1?(a=23,void webphone_api.common.PutToDebugLog(2,"ERROR, DownloadServerAddressbook response is NULL")):void Tt(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"DownloadServerAddressbook.onload inner ("+a+")",t)}},i.onerror=function(e){var t="";webphone_api.common.isNull(e)||(t=e.toString(),webphone_api.common.isNull(e.target)||(t=webphone_api.common.isNull(e.target.status)?t+" "+e.target.toString():t+" "+e.target.status.toString())),webphone_api.common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook: onerror: "+t)},i.timeout=9e3,i.ontimeout=function(e){webphone_api.common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook: Timeout")},i.send()}}catch(r){webphone_api.common.PutToDebugLogException(2,"plhandler: DownloadServerAddressbook",r)}}function Tt(e){try{if(webphone_api.common.isNull(e)||e.length<1)return;var t=e.split("\r\n"),n=0;if(webphone_api.common.isNull(t))return void webphone_api.common.PutToDebugLog(2,"ERROR, ParserServerAddressbook list is NULL: "+e);for(var o=0;o<t.length;o++)if(!(webphone_api.common.isNull(t[o])||t[o].length<3||t[o].indexOf("\t")<1)){var i=t[o].split("\t");if(!(webphone_api.common.isNull(i)||i.length<2)){var a=i[0],r=i[1],s=0,l="",p="",c="",u="";if(!(webphone_api.common.isNull(a)||a.length<1||webphone_api.common.isNull(r)||r.length<1)){i.length>2&&(webphone_api.common.isNull(i[2])||"1"!==webphone_api.common.Trim(i[2])||(s=1)),i.length>3&&!webphone_api.common.isNull(i[3])&&webphone_api.common.Trim(i[3]).length>3&&(l=webphone_api.common.Trim(i[3])),i.length>4&&!webphone_api.common.isNull(i[4])&&webphone_api.common.Trim(i[4]).length>3&&(p=webphone_api.common.Trim(i[4])),i.length>5&&!webphone_api.common.isNull(i[5])&&webphone_api.common.Trim(i[5]).length>0&&(c=webphone_api.common.Trim(i[5])),i.length>6&&!webphone_api.common.isNull(i[6])&&webphone_api.common.Trim(i[6]).length>3&&(u=webphone_api.common.Trim(i[6]));var h="sip",g=r.replace("+","");webphone_api.common.IsNumber(g)&&(h="phone"),n++;ge(a,r,s,h,webphone_api.common.GetTickCount(),l,p,c,u,"1")}}}webphone_api.common.PutToDebugLog(4,"EVENT, ParserServerAddressbook: "+n.toString()+" contacts added sucessfully")}catch(m){webphone_api.common.PutToDebugLogException(2,"plhandler: ParserServerAddressbook",m)}}function Nt(e,t){Mt("IsServiceInstalled"),webphone_api.common.IsServiceInstalled(e,t)}function St(){return Mt("CanIUseWebrtc"),webphone_api.common.CanIUseWebRTC()}function It(e,t,n){Mt("ShowToast-"+e),webphone_api.common.ShowToast(e,t,n)}function Ct(e,t,n){Mt("AlertDialog-"+t),webphone_api.common.AlertDialog(e,t,n)}function Rt(e,t,n,o,i){webphone_api.webphone.API_SetCredentials(e,t,n,o,i)}function Gt(e,t,n,o){webphone_api.webphone.API_SetCredentialsMD5(e,t,n,o)}function yt(e){webphone_api.webphone.API_CheckVoicemail(e)}function Lt(e){webphone_api.webphone.API_SetLine(e)}function Ot(e){webphone_api.webphone.API_GetLine(e)}function Dt(e){webphone_api.webphone.API_GetLineStatus(e)}function xt(e,t){webphone_api.webphone.API_Forward(e,t)}function At(e){webphone_api.webphone.API_IsMuted(e)}function kt(e){webphone_api.webphone.API_IsOnHold(e)}function Ut(e){webphone_api.webphone.API_GetAudioDeviceList(e)}function Vt(e){webphone_api.webphone.API_GetAudioDevice(e)}function Wt(e){webphone_api.webphone.API_SetAudioDevice(e)}function Ft(e){webphone_api.webphone.API_GetVolume(e)}function Mt(e){try{if(!0===webphone_api.common.IsWindowsSoftphone())return;if(!1===webphone_api.global.wploaded){var t="WARNING,WapiTouced API called before webphone loaded: "+e;if(webphone_api.common.PutToDebugLog(2,t),"undefined"!=typeof console&&null!==console)if("delsettings"===e&&"undefined"!=typeof console.log&&null!==console.log)try{console.log(t)}catch(n){}else if("undefined"!=typeof console.error&&null!==console.error)try{console.error(t)}catch(n){}else if("undefined"!=typeof console.log&&null!==console.log)try{console.log(t)}catch(n){}}}catch(o){webphone_api.common.PutToDebugLogSpecial(2,"EVENT, plhandler WapiTouced",!0,o)}}function Ht(e,arguments){webphone_api.common.isNull(e)||e.length<1||(Bt(),webphone_api.common.isNull($n)&&($n=[]),webphone_api.common.isNull(arguments)&&(arguments=[]),webphone_api.common.PutToDebugLog(2,"EVENT,AddToQueueEn cached for execution after engine start: "+e.toLowerCase()+"("+arguments.toString()+")"),arguments.unshift(e),arguments.unshift(webphone_api.common.GetTickCount().toString()),$n.push(arguments))}function Bt(){webphone_api.common.isNull(qn)&&(qn=setInterval(function(){if(++zn>1e5||zn>1e5&&(webphone_api.common.isNull($n)||$n.length<1||webphone_api.global.phonestarted>=2))return void 0!==qn&&null!==qn&&clearInterval(qn),qn=null,$n=[],void(zn=0);if(!(webphone_api.common.isNull($n)||$n.length<1)&&webphone_api.global.phonestarted>=2){var e=$n.shift();if(webphone_api.common.isNull(e)||e.length<2)return;var t=0;try{t=webphone_api.common.StrToInt(e[0])}catch(i){}e.shift();var n=e[0];if(webphone_api.common.isNull(n)||n.length<1)return void webphone_api.common.PutToDebugLog(2,"ERROR, handle API function queue invalid name(engine: "+webphone_api.common.getuseengine()+"): "+n);if(webphone_api.common.GetTickCount()-t>6e5)return void webphone_api.common.PutToDebugLog(2,"ERROR, handle API function queue(engine: "+webphone_api.common.getuseengine()+"): "+n+" (too late)");e.shift();var o="";webphone_api.common.isNull(e)||(o=e.toString()),webphone_api.common.PutToDebugLog(2,"EVENT, handle API function queue(engine: "+webphone_api.common.getuseengine()+"): "+n+" ("+o+");"),jt(n,e)}},15))}function jt(e,arguments){var t=window.webphone_api.plhandler[e];"function"==typeof t&&t.apply(window,arguments)}function $t(e){try{if(webphone_api.common.isNull(e)||e.length<1||webphone_api.common.isNull(webphone_api.origparameters))return"";if("undefined"!=typeof webphone_api.origparameters[e]&&null!=webphone_api.origparameters[e]&&webphone_api.origparameters[e].toString().length>0){var t=webphone_api.origparameters[e];return!webphone_api.common.isNull(t)&&t.toString().length>0&&t.toString().indexOf("dcid_")>=0&&(t=webphone_api.common.StrDc(t.toString(),"X9hAm21TaGzqeR45Bj")),webphone_api.common.isNull(t)?"":t}}catch(n){webphone_api.common.PutToDebugLogException(2,"plhandler: GetOrigConfigParam ("+e+")",n)}return""}function qt(e){var t=0;try{if(t=1,webphone_api.common.isNull(e)||e.length<1)return"";t=2;var n=webphone_api.common.GetConfig(e);t=3;var o=webphone_api.common.GetConfigAll(!0);if(t=4,!webphone_api.common.isNull(o)){t=5;var i="overwrite_"+e;t=21,"undefined"!=typeof o[i]&&null!==o[i]&&o[i].toString().length>0&&(t=22,n=o[i].toString())}t=6,"undefined"!=typeof webphone_api.parameters[e]&&null!=webphone_api.parameters[e]&&webphone_api.parameters[e].toString().length>0&&(t=23,n=webphone_api.parameters[e]),t=7;var a=window.location.href;if(!webphone_api.common.isNull(a)){t=8;var r=webphone_api.common.GetUrlParamVal(a,e);t=24,!webphone_api.common.isNull(r)&&r.toString().length>0&&(t=25,n=r)}return t=9,(!webphone_api.common.isNull(n)&&n.toString().length>0&&n.toString().indexOf("dcid_")>=0&&(t=10,n=webphone_api.common.StrDc(n.toString(),"X9hAm21TaGzqeR45Bj")),t=11,webphone_api.common.isNull(n))?"":(t=12,n)}catch(s){webphone_api.common.PutToDebugLogException(2,"plhandler GetCCParam "+t+" ("+e+")",s)}return""}function zt(){try{var e=qt("serveraddress"),t=qt("webrtcserveraddress"),n=qt("proxyaddress"),o=qt("transport"),i=qt("realm"),a=$t("serveraddress"),r=$t("webrtcserveraddress"),s=$t("proxyaddress"),l=$t("transport"),p=$t("realm");webphone_api.common.isNull(e)&&(e=""),webphone_api.common.isNull(t)&&(t=""),webphone_api.common.isNull(n)&&(n=""),webphone_api.common.isNull(o)&&(o=""),webphone_api.common.isNull(i)&&(i=""),webphone_api.common.isNull(a)&&(a=""),webphone_api.common.isNull(r)&&(r=""),webphone_api.common.isNull(s)&&(s=""),webphone_api.common.isNull(l)&&(l=""),webphone_api.common.isNull(p)&&(p=""),e=e.toString().toLowerCase(),t=t.toString().toLowerCase(),n=n.toString().toLowerCase(),o=o.toString().toLowerCase(),i=i.toString().toLowerCase(),a=a.toString().toLowerCase(),r=r.toString().toLowerCase(),s=s.toString().toLowerCase(),l=l.toString().toLowerCase(),p=p.toString().toLowerCase();return e+t+i+n+o+a+r+p+s+l}catch(c){webphone_api.common.PutToDebugLogException(2,"plhandler: GetMainConfigsAsString",c)}return""}function Kt(){try{if(Kn)return;var e=webphone_api.common.GetParameter("lastwpapixxx"),t=ve("configversion"),n=ve("prevconfigversion");if(webphone_api.common.isNull(n)||!webphone_api.common.IsNumber(n)){var o=t;!webphone_api.common.isNull(o)&&webphone_api.common.IsNumber(o)||(o=0),webphone_api.common.SaveParameter("prevconfigversion",o)}var i=zt();!webphone_api.common.isNull(t)&&webphone_api.common.IsNumber(t)&&t>0&&!webphone_api.common.isNull(n)&&webphone_api.common.IsNumber(n)&&t!==n?(Kn=!0,webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"WARNING, DelSettings on start because configversion new: "+t+", old: "+n),nt(1,!1)):!webphone_api.common.isNull(e)&&e.length>0&&!webphone_api.common.isNull(i)&&i.length>0?(Kn=!0,e!==i?(webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(2,"WARNING, DelSettings on start because main configs changed x"),webphone_api.common.PutToDebugLog(4,"EVENT, DelSettings old config: "+e),webphone_api.common.PutToDebugLog(4,"EVENT, DelSettings new config: "+i)),nt(1,!1),webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(4,"EVENT, DelSettings new2 config: "+zt()),webphone_api.common.PutToDebugLog(4,"EVENT, DelSettings new3 config: "+ve("serveraddress")+ve("webrtcserveraddress")+ve("realm")+ve("proxyaddress")+ve("transport")))):webphone_api.common.CanLog(5)&&webphone_api.common.PutToDebugLog(5,"EVENT, check config change old: "+e+", new: "+i)):webphone_api.common.CanLog(5)&&(!webphone_api.common.isNull(i)&&i.length>0?webphone_api.common.PutToDebugLog(5,"EVENT, check config change old: null, new: "+i):!webphone_api.common.isNull(e)&&e.length>0&&webphone_api.common.PutToDebugLog(5,"EVENT, check config change old: "+e+", new: null")),!webphone_api.common.isNull(i)&&i.length>0&&webphone_api.common.SaveParameter("lastwpapixxx",i)}catch(a){webphone_api.common.PutToDebugLogException(2,"plhandler: ConfigChanged",a)}}var Xt="",Jt=!1,Yt=null;webphone_api.global.isfirststart=!0,1==webphone_api.common.IsSDK()&&(webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler call HandleSettingsSDK",!1,""),webphone_api.global.domloaded_tick=webphone_api.common.GetTickCount(),a(function(t){if(webphone_api.common.PutToDebugLogSpecial(1,"EVENT, plhandler onload HandleSettingsSDK FINISHED: "+t,!1,""),webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: initialize start"),webphone_api.common.Glv()<1)return void(webphone_api.global.webrtcavailable=0);webphone_api.$(document).ready(function(){webphone_api.loadwebrtc_timestamp=webphone_api.common.GetTickCount();var t=webphone_api.common.GetForcedEngine();if(t&&"webrtc"!=t.name)return webphone_api.global.webrtcavailable=0,webphone_api.common.PutToDebugLog(2,"webrtc engine not needed"),void(!0===webphone_api.common.UseCustomAutoprov(!0)?webphone_api.common.GetCustomAutoprov(function(t){webphone_api.common.RecAutoprovCustom(t),e()}):e());webphone_api.webrtcapi.WebRtcIsSupported(function(t){if("Windows"===webphone_api.common.GetOs()&&("MSIE"===webphone_api.common.GetBrowser()?t=!1:"Edge"===webphone_api.common.GetBrowser()&&(webphone_api.common.GetBrowserVersion()<14?t=!1:!1===t&&webphone_api.common.PutToDebugLog(2,"ERROR,plhandler Edge webrtc is not supported, getusermedia: "+typeof navigator.getUserMedia+"; RTCPeerConnection: "+typeof window.RTCPeerConnection))),"iOS"===webphone_api.common.GetOs()?(("Safari"===webphone_api.common.GetBrowser()||"iPhone"===webphone_api.common.GetBrowser())&&webphone_api.common.GetBrowserVersion()<11&&(t=!1),"Firefox"!==webphone_api.common.GetBrowser()||navigator.mozGetUserMedia||navigator.GetUserMedia||(t=!1),"Chrome"!==webphone_api.common.GetBrowser()||navigator.webkitGetUserMedia||navigator.GetUserMedia||(t=!1)):"Windows"===webphone_api.common.GetOs()&&"Safari"===webphone_api.common.GetBrowser()&&(t=!1),webphone_api.common.isNull(t)&&(t=""),webphone_api.common.PutToDebugLog(2,"EVENT, plhandler: Webrtc engine available at plh: "+t),!0===t){webphone_api.global.webrtcavailable=1;var n=webphone_api.common.GetEngine("webrtc"),o=webphone_api.common.GetParameter2("serveraddress_user");(webphone_api.common.isNull(o)||o.length<2)&&(o=webphone_api.common.GetParameter2("serveraddress")),(webphone_api.common.isNull(o)||o.length<2)&&(o=webphone_api.common.GetConfig("serveraddress")),webphone_api.common.isNull(o)&&(o="");var i=!1;webphone_api.common.CanUseAnyAddrForWebRTC()||(1==webphone_api.common.IsLanIPEx(webphone_api.common.GetWebrtcUpperServer())?i=!0:0==webphone_api.common.IsLanIPEx(webphone_api.common.GetWebrtcUpperServer())||1==webphone_api.common.IsLanIPEx(o)&&(i=!0)),i?webphone_api.common.isNull(n)||(n.issupported_cache=0,n.available=0):!0===webphone_api.common.BrowserRequiresHttps(!0)?webphone_api.common.isNull(n)||(n.issupported_cache=1,n.available=2):webphone_api.common.isNull(n)||(n.issupported_cache=2,n.available=3)}else!1===t&&(webphone_api.global.webrtcavailable=0,webphone_api.common.PutToDebugLog(2,"webrtc engine NOT available"));!0===webphone_api.common.UseCustomAutoprov(!0)?webphone_api.common.GetCustomAutoprov(function(t){webphone_api.common.RecAutoprovCustom(t),e()}):e()})})}));var Qt=null,Zt=!1,en=null,tn=!1,nn=null,on=10,an=185,rn=null,sn=null,ln=!1,pn=0,cn="",un=!1,hn=null,gn=0,mn=0,dn=!1,bn=!1,_n=null,fn=-1,wn=0,vn=0,Pn=null,En=null,Tn=!1,Nn=0,Sn=null,In=0,Cn=0,Rn=null,Gn=[],yn=[],Ln=null,On=null,Dn=!1,xn=[],An=[],kn=null,Un=[],Vn=[],Wn=null,Fn=[],Mn=[],Hn=[],Bn=[],jn=null,$n=[],qn=null,zn=0,Kn=!1;return{Start:t,StartUp:i,Register:m,RegisterEx:b,CheckPresence:_,SetPresenceStatus:f,CheckBLF:w,GetVersionNS:v,GetVersionNSNum:P,GetVersionJava:E,IsEncrypted:T,SetSipHeader:N,GetSipHeader:I,GetSipHeaderInternal:S,GetSipMessage:C,ChangeTheme:R,GetWorkDir:G,Call:x,VideoCall:y,MuteVideo:L,ScreenShare:O,StopScreenShare:U,Hangup:V,Accept:F,Reject:M,Ignore:H,SetVideoSize:B,GetAvailableCallfunc:j,Forward:$,Conference:z,Transfer:K,Dtmf:X,MuteEx:J,IsMuted:Y,Hold:Q,IsOnHold:ee,SendChat:te,SendSms:oe,Voicerecord:ie,DevicePopup:se,SetVolume:le,GetVolume:pe,SetLoudspeaker:ce,PlaySound:ue,AddContact:he,SaveTheContact:ge,DeleteContact:me,GetContact:be,ListContacts:_e,ListCallhistory:fe,SetParameter:we,GetParameter:ve,SetLine:Pe,GetLine:Ee,LineToCallID:Te,CallIDToLine:Ne,IsRegistered:Le,IsInCall:Oe,GetDeviceList:De,GetDevice:xe,SetDevice:Ae,StopEngine:ke,Stop:Ue,HelpWindow:Fe,BrowserWindowIsActive:We,SettingsPage:Me,DialPage:He,MessageInboxPage:Be,MessagePage:je,AddContactPage:$e,InsertApplet:qe,EnterKeyPress:ze,FileTransferCallback:Ke,GetTelsearchName:Xe,Cfin:D,bwanswer:Je,onappexit:Ye,getlogs:Qe,getlogsex:Ze,putlogs:et,ImportContacts:tt,delsettings:nt,needratingrequest:ot,IsMobileBrowser:it,Getenginename:at,GetLastInvite:rt,GetLastRecInvite:st,GetLastSentInvite:lt,getstringresource:gt,Jvoip:mt,GetStatus:ae,GetRegFailReason:re,Unregister:Re,UnregisterEngine:Ge,HTTPKeepAlive:ye,GetLineDetails:Se,GetLastCallDetails:Ie,GetIncomingDisplay:Ce,ParseReceivedParameters:s,GetOneStunSrv:dt,HandleWebrtcCodecs:ft,HandleWebrtcPrefCodec:wt,HandleWebrtcFirefoxHold:vt,HandleWebrtcFirefoxHold_RemoveDuplicateHeader:Pt,IsServiceInstalled:Nt,CanIUseWebrtc:St,API_SetCredentials:Rt,API_SetCredentialsMD5:Gt,API_CheckVoicemail:yt,API_SetLine:Lt,API_GetLine:Ot,API_GetLineStatus:Dt,API_Forward:xt,API_IsMuted:At,API_IsOnHold:kt,API_GetAudioDeviceList:Ut,API_GetAudioDevice:Vt,API_SetAudioDevice:Wt,API_GetVolume:Ft,API_RecFiles_Upload:pt,API_RecFiles_UploadEx:ct,API_RecFiles_Clear:ut,API_RecFiles_Del:ht,SendChatIsComposing:Ve,ShowToast:It,AlertDialog:Ct,LoginSkin:h,GetAudioDevicesForMenu:g,ConfigChanged:Kt}}(),webphone_api.webphone=function(){function e(){try{webphone_api.common.PutToDebugLog(2,"EVENT, webphone Init called"),Fe=!1,Me=null,He=0,Be=!1,je=!0,$e=!1,qe=!1,Ye=!1,Qe=0,webphone_api.webphone_pollstatus=!0,webphone_api.global.apppletloaded=!1}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: Init",e)}}function t(){try{webphone_api.common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs called"),void 0!==Je&&null!==Je&&clearTimeout(Je),Je=setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs starting timer"),!0===webphone_api.webphone_pollstatus&&(webphone_api.common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs starting status polling"),$e=!0,webphone_api.global.polltimerid=setInterval(function(){webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WEBPHONE()&&Me&&Me.API_Poll&&webphonetojs(Me.API_Poll())},Ke))},Xe),setTimeout(function(){!0===$e&&webphone_api.common.WinAPI("API_RegisterNoParam",function(){webphone_api.common.PutToDebugLog(2,"ERROR, webphone API_RegisterNoParam called")})},Xe+1e3)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: CheckWebphonetojs",e)}}function n(){try{webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("initializing")),e();try{if(!webphone_api.common.isNull(webphone_api.global.settmap2)){for(var t in webphone_api.global.settmap2){var n=webphone_api.global.settmap2[t];if(!webphone_api.common.isNull(n)&&!(t.indexOf("server")<0&&t.indexOf("username")<0&&t.indexOf("password")<0&&"1"===n[webphone_api.common.SETT_ISDEFAULT])){if("username"===t||"sipusername"===t||"password"===t){var i=n[webphone_api.common.SETT_VALUE];if(!webphone_api.common.isNull(i)&&i.length>0){i=o(i),ze[t]=i;continue}}if("serveraddress"===t){var i=n[webphone_api.common.SETT_VALUE],a=ze.serveraddress;if((webphone_api.common.isNull(i)||i.length<1)&&a.length>1)continue;if((webphone_api.common.isNull(a)||a.length<1)&&(webphone_api.common.isNull(i)||i.length<1)){ze.serveraddress=webphone_api.common.GetParameter("serveraddress_user");continue}}else if("serveraddress_orig"===t)t="serveraddress";else if("upperserver"===t){var i=n[webphone_api.common.SETT_VALUE],a=webphone_api.common.GetParameter("serveraddress_orig");i===a||i.length<1?ze[t]="":ze[t]=webphone_api.common.GetParameter("serveraddress_orig")}else"aec"===t?t="aec_orig":"agc"===t?t="agc_orig":"denoise"===t?t="denoise_orig":"plc"===t?t="plc_orig":"has_video"===t?"0"===webphone_api.common.GetParameter2("video")?ze[t]="false":ze[t]="true":ze[t]=n[webphone_api.common.SETT_VALUE]}}var r=webphone_api.common.GetParameter("extraoption");if(!webphone_api.common.isNull(r)&&r.length>0){r=webphone_api.common.Trim(r);var s=r.split(";");if(!webphone_api.common.isNull(s)&&s.length>0)for(var l=0;l<s.length;l++)if(!(webphone_api.common.isNull(s[l])||s[l].length<1||s[l].indexOf("=")<1)){var t=webphone_api.common.Trim(s[l].substring(0,s[l].indexOf("="))),n=webphone_api.common.Trim(s[l].substring(s[l].indexOf("=")+1));!webphone_api.common.isNull(t)&&t.length>0&&!webphone_api.common.isNull(n)&&(ze[t]=n)}}}webphone_api.common.GetConfig("upperserverip").length>0&&(ze.upperserverip=webphone_api.common.GetConfig("upperserverip")),webphone_api.common.GetConfig("upperserverdomain").length>0&&(ze.upperserverdomain=webphone_api.common.GetConfig("upperserverdomain")),ze.jsscriptevent=3,(webphone_api.common.isNull(ze.serveraddress_orig)||ze.serveraddress_orig.length<1)&&(ze.serveraddress_orig=ze.serveraddress);var p=webphone_api.parameters.customsipheader;if(!webphone_api.common.isNull(p)&&p.length>0&&(p=webphone_api.common.Trim(p),!webphone_api.common.isNull(ze.customsipheader)&&ze.customsipheader.toString().length>0?ze.customsipheader.lastIndexOf(";")<ze.customsipheader.length-1&&(ze.customsipheader=ze.customsipheader+";"):ze.customsipheader="",ze.customsipheader=ze.customsipheader+p),ze.extraregisteraccounts="",!webphone_api.common.isNull(webphone_api.global.sipaccounts)&&webphone_api.global.sipaccounts.length>0){for(var l=0;l<webphone_api.global.sipaccounts.length;l++){var c=webphone_api.global.sipaccounts[l];if(!(webphone_api.common.isNull(c)||c.length<4)&&(!0!==c.ismain&&!1!==c.enabled)){var u=c.serveraddress,h=c.username,g=c.password,m=c.callerid,d=c.displayname,b=c.proxyaddress,_=c.realm;void 0!==u&&null!==u||(u=""),void 0!==h&&null!==h||(h=""),void 0!==g&&null!==g||(g=""),void 0!==m&&null!==m||(m=""),void 0!==d&&null!==d||(d=""),void 0!==b&&null!==b||(b=""),void 0!==_&&null!==_||(_=""),webphone_api.common.Trim(m).length<1&&(m=h),ze.extraregisteraccounts.length>0&&(ze.extraregisteraccounts=ze.extraregisteraccounts+";"),ze.extraregisteraccounts=ze.extraregisteraccounts+u+","+m+","+g+","+c.ival+","+b+","+_+","+h}}var f=webphone_api.common.GetExtraRegAccFromAPIparam();!webphone_api.common.isNull(f)&&f.length>5&&(ze.extraregisteraccounts.length>0&&(ze.extraregisteraccounts=ze.extraregisteraccounts+";"),ze.extraregisteraccounts=ze.extraregisteraccounts+f)}ze.autohold="0",ze.automute="0",webphone_api.common.CanLog(4)&&webphone_api.common.LogAllParameters("Webphone all parameters:",ze)}catch(w){webphone_api.common.PutToDebugLogException(2,"webphone: Start Setting parameters",w)}me(),setTimeout(function(){nt=webphone_api.common.GetTickCount(),be()},1e3)}catch(w){webphone_api.common.PutToDebugLogException(2,"webphone: Start",w)}}function o(e){try{if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(2,"ERROR, wp B4 invalid extracted value"),"";if(e.length<1)return"";var t=e;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){if(t.indexOf("=")>=0)return t="Bb7Sb2VVVVV_"+webphone_api.common.B64Enc(t)}else if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE||!0===webphone_api.common.IsWindowsSoftphone()){var n=webphone_api.common.GetParameterInt("srvupgrade_currversion",0);if(n>18&&(t.indexOf("%")>=0||t.indexOf("^")>=0||t.indexOf("&")>=0||t.indexOf("<")>=0||t.indexOf(">")>=0||t.indexOf("|")>=0||t.indexOf("'")>=0||t.indexOf("`")>=0||t.indexOf(",")>=0||t.indexOf(";")>=0||t.indexOf("=")>=0||t.indexOf("(")>=0||t.indexOf(")")>=0||t.indexOf("!")>=0||t.indexOf('"')>=0||t.indexOf("\\")>=0||t.indexOf("[")>=0||t.indexOf("]")>=0||t.indexOf('"')>=0||t.indexOf(".")>=0||t.indexOf("*")>=0||t.indexOf("?")>=0))return t="Bb7Sb2VVVVV_"+webphone_api.common.B64Enc(t)}}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: B64EncUserPwd",o)}return e}function i(){function n(e){webphone_api.common.CanLog(2)&&(webphone_api.common.PutToDebugLog(2,"EVENT, webphone: StartWin: API_SetParameters called"),
webphone_api.common.PutToDebugLog(4,"EVENT, webphone: StartWin: API_SetParameters paramlist: "+a)),i=37,webphone_api.common.WinAPI("API_SetParameters",function(e){Ye=!0,Qe=0,i=41,webphone_api.common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),e.indexOf("ok:")<0&&e.indexOf("true")<0&&webphone_api.common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_SetParameters callback: failed to save settings"),i=42,webphone_api.global.apistartstate=1,webphone_api.global.apistarttick=webphone_api.common.GetTickCount(),webphone_api.common.WinAPI("API_Start",function(e){i=43,webphone_api.common.SetDID(),qe=!0,i=44,webphone_api.common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),e.indexOf("ok:")<0&&e.indexOf("true")<0?(i=45,webphone_api.common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_Start callback: failed to start webphone (1), answ: "+e)):(i=46,r(),setTimeout(function(){webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2)},1e3))}),i=47,t()},e),setTimeout(function(){webphone_api.common.GetSrvVersions()},1e3)}var i=0;webphone_api.common.PutToDebugLog(2,"EVENT, webphone: StartWin called"),webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("initializing"));try{e(),i=1;var a="",s=[];if(!webphone_api.common.isNull(webphone_api.global.settmap2)){i=2;for(var l in webphone_api.global.settmap2)if(!(webphone_api.common.isNull(l)||l.length<1)){var p=webphone_api.global.settmap2[l];"has_video"===l&&("0"===webphone_api.common.GetParameter2("video")?p[0]="false":p[0]="true"),l.indexOf("server")<0&&l.indexOf("username")<0&&l.indexOf("password")<0&&"1"===p[webphone_api.common.SETT_ISDEFAULT]||(s[l]=p[0])}i=3}i=4;for(var l in ze)if(!(webphone_api.common.isNull(l)||l.length<1||"username"===l&&!webphone_api.common.isNull(s[l])&&s[l].length>0&&(webphone_api.common.isNull(ze[l])||ze[l].length<1))){if("loglevel"===l)try{webphone_api.common.GetLogLevel()>1?s.jsscriptevent="3":s.jsscriptevent="2"}catch(S){}s[l]=ze[l]}i=5,!webphone_api.common.isNull(webphone_api.common.GetConfig("upperserverip"))&&webphone_api.common.GetConfig("upperserverip").length>0&&(s.upperserverip=webphone_api.common.GetConfig("upperserverip")),i=11,!webphone_api.common.isNull(webphone_api.common.GetConfig("upperserverdomain"))&&webphone_api.common.GetConfig("upperserverdomain").length>0&&(s.upperserverdomain=webphone_api.common.GetConfig("upperserverdomain")),i=12,webphone_api.common.isNull(s.serveraddress_orig||s.serveraddress_orig.length<1)&&(s.serveraddress_orig=s.serveraddress),i=13;var c=webphone_api.parameters.customsipheader;if(!webphone_api.common.isNull(c)&&c.length>0&&(i=14,c=webphone_api.common.Trim(c),!webphone_api.common.isNull(s.customsipheader)&&s.customsipheader.toString().length>0?(i=15,s.customsipheader.lastIndexOf(";")<s.customsipheader.length-1&&(s.customsipheader=s.customsipheader+";",i=16)):(i=17,s.customsipheader=""),s.customsipheader=s.customsipheader+c),i=21,s.extraregisteraccounts="",!webphone_api.common.isNull(webphone_api.global.sipaccounts)&&webphone_api.global.sipaccounts.length>0){for(var u=0;u<webphone_api.global.sipaccounts.length;u++){var h=webphone_api.global.sipaccounts[u];if(!(webphone_api.common.isNull(h)||h.length<4)&&(!0!==h.ismain&&!1!==h.enabled)){var g=h.serveraddress,m=h.username,d=h.password,b=h.callerid,_=h.displayname,f=h.proxyaddress,w=h.realm;void 0!==g&&null!==g||(g=""),void 0!==m&&null!==m||(m=""),void 0!==d&&null!==d||(d=""),void 0!==b&&null!==b||(b=""),void 0!==_&&null!==_||(_=""),void 0!==f&&null!==f||(f=""),void 0!==w&&null!==w||(w=""),webphone_api.common.Trim(b).length<1&&(b=m),s.extraregisteraccounts.length>0&&(s.extraregisteraccounts=s.extraregisteraccounts+";"),s.extraregisteraccounts=s.extraregisteraccounts+g+","+b+","+d+","+h.ival+","+f+","+w+","+m}}var v=webphone_api.common.GetExtraRegAccFromAPIparam();!webphone_api.common.isNull(v)&&v.length>5&&(ze.extraregisteraccounts.length>0&&(s.extraregisteraccounts=s.extraregisteraccounts+";"),s.extraregisteraccounts=s.extraregisteraccounts+v)}(webphone_api.common.isNull(s.loglevel)||s.loglevel.toString().length<1)&&(s.loglevel=webphone_api.common.GetLogLevel().toString()),webphone_api.common.isNull(a)&&(a="");for(var l in s)if(!(webphone_api.common.isNull(l)||l.length<1||"callto"===l||"platform"===l)){if(l.length>9){if(0==l.indexOf("transfertype")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("transfwithreplace")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("allowreplace")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("discontransfer")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("disconincomingrefer")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("inversetransfer")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("transferdelay")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("newdialogforrefer")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("useserverdomainforrefer")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue;if(0==l.indexOf("holdontransfer")&&l.charAt(l.length-1)>="0"&&l.charAt(l.length-1)<="9")continue}"autohold"!==l&&"automute"!==l||(s[l]="0"),"sippassword"===l&&(l="password");var P=s[l];"password"===l&&!webphone_api.common.isNull(P)&&P.length>0&&(P=o(P)),!webphone_api.common.isNull(P)&&P.toString().length>0&&(a.length>0&&(a+="\r\n"),a=a+l+"="+P)}i=22;var E=webphone_api.common.GetMinServiceVersion();a=a+"\r\nminserviceversion="+E,i=27,"rigitel"===webphone_api.common.GetConfig("brandname").toLowerCase()&&(a+="\r\nhasincomingcall=false");var T=webphone_api.common.GetNPLocation();i=31,webphone_api.common.isNull(T)&&(T=""),i=32;var N=T.indexOf("native/");N>0&&(T=T.substr(0,N)),i=33,a=a+"\r\nwebphoneurl="+T,i=34,a+="\r\ndummy=3",i=35,a="akarmidw=true\r\n"+a,i=36,n(a),Ze=setInterval(function(){return!0===Ye?(webphone_api.common.isNull(Ze)||clearInterval(Ze),Ze=null,void(Qe=0)):++Qe>15?(webphone_api.common.PutToDebugLog(2,"ERROR, API_Setparameters timer reached maxloop"),webphone_api.common.isNull(Ze)||clearInterval(Ze),void(Ze=null)):(webphone_api.common.PutToDebugLog(2,"ERROR, API_Setparameters try to send parameters again, because earlier send failed"),void n(a))},1e3),i=51,setTimeout(function(){i=52,qe||!0!==Ye||(i=53,webphone_api.global.apistartstate=1,webphone_api.global.apistarttick=webphone_api.common.GetTickCount(),webphone_api.common.WinAPI("API_Start",function(e){i=54,webphone_api.common.SetDID(),webphone_api.common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),e.indexOf("ok:")<0&&e.indexOf("true")<0?(i=55,webphone_api.common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_Start callback: failed to start webphone (2) answ: "+e)):(i=56,r())})),i=57,qe=!1},2500),webphone_api.common.GetCustomMenus(),i=58}catch(I){webphone_api.common.PutToDebugLogException(2,"webphone: StartWin ("+i.toString()+")",I)}}function a(){try{webphone_api.common.PutToDebugLog(3,"EVENT, StartService"),i()}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: StartService",e)}}function r(){}function s(){try{return _e()?Me.API_Restart():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Restart(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: Restart",e)}}function l(e){try{return _e()?Me.API_PushContactlist(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: PushContactlist(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: PushContactlist",t)}}function p(e){try{return _e()?Me.API_CheckPresence(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: CheckPresence(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: CheckPresence",t)}}function c(e){try{return _e()?Me.API_SetPresenceStatus(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetPresenceStatus(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: SetPresenceStatus",t)}}function u(e){try{return _e()?Me.API_CheckBLF(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: CheckBLF(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: CheckBLF",t)}}function h(){try{return _e()?Me.API_GetExeVersion():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetVersionNS(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetVersionNS",e)}return 0}function g(){try{return _e()?Me.API_GetExeVersionNumber():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetVersionNSNum(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetVersionNSNum",e)}return 0}function m(){try{return _e()?Me.API_GetVersion():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetVersionJava(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetVersionJava",e)}return 0}function d(){try{return _e()?Me.API_IsEncrypted():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: IsEncrypted(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: IsEncrypted",e)}return 0}function b(e){try{return _e()?Me.RegisterEx(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: RegisterEx(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: RegisterEx",t)}}function _(e,t){try{return _e()?Me.API_SetSIPHeader(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetSipHeader(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: SetSipHeader",n)}}function f(e,t){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetSipHeader(), no applethandle "),"ERROR, webphone: GetSipHeader(), no applethandle";return Me.API_GetSIPHeader(e,t)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetSipHeader",n)}return""}function w(e,t){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetSipHeaderInternal(), no applethandle "),"ERROR, webphone: GetSipHeader(), no applethandle";return Me.API_GetSipHeaderInternal(e,t)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetSipHeaderInternal",n)}return""}function v(e,t,n){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetSipMessage(), no applethandle "),"ERROR, webphone: GetSipMessage(), no applethandle";return Me.API_GetSIPMessage(e,t,n)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: GetSipMessage",o)}return""}function P(e,t){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetGetLastInvite(), no applethandle "),"";t(Me.API_GetLastInvite(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetGetLastInvite",n)}t("")}function E(e,t){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetGetLastRecInvite(), no applethandle "),"";t(Me.API_GetGetLastRecInvite(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetGetLastRecInvite",n)}t("")}function T(e,t){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetGetLastSentInvite(), no applethandle "),"";t(Me.API_GetGetLastSentInvite(e))}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: GetGetLastSentInvite",n)}t("")}function N(){try{return _e()?Me.API_GetWorkdir():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetWorkDir(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetWorkDir",e)}return""}function S(){try{return _e()?Me.API_Unregister():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Unregister(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: Unregister",e)}}function I(){try{return _e()?Me.API_ReRegister():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: ReRegister(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: ReRegister",e)}}function C(){try{return _e()?Me.API_HTTPKeepAlive():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: HTTPKeepAlive(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: HTTPKeepAlive",e)}}function R(e,t){try{return _e()?Me.API_Call(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Call(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Call",n)}}function G(e){try{return _e()?Me.API_Hangup(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Hangup(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: Hangup",t)}}function y(e){try{return _e()?Me.API_Accept(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Accept(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: Accept",t)}}function L(e){try{return _e()?Me.API_Reject(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Reject(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: Reject",t)}}function O(e){try{return _e()?Me.API_Ignore(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Ignore(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: Ignore",t)}}function D(e,t){try{return _e()?Me.API_Forward(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Forward(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Forward",n)}}function x(e){try{return _e()?Me.API_Conf(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Conference(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: Conference",t)}}function A(e,t,n){try{return _e()?Me.API_ConfEx(e,t,n):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: ConferenceEx(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: ConferenceEx",o)}}function k(e,t){try{return _e()?Me.API_Transfer(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Transfer(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Transfer",n)}}function U(e,t){try{return _e()?Me.API_Dtmf(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Dtmf(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Dtmf",n)}}function V(e,t,n){try{return _e()?Me.API_MuteEx(e,t,n):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: MuteEx(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: MuteEx",o)}}function W(e){try{return _e()?Me.API_IsMuted(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: IsMuted(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: IsMuted",t)}}function F(e,t){try{return _e()?Me.API_Hold(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Hold(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: Hold",n)}}function M(e){try{return _e()?Me.API_IsOnHold(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: IsOnHold(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: IsOnHold",t)}}function H(e,t,n,o){try{return _e()?Me.API_SendChat(e,t,n,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SendChat(), no applethandle "),!1)}catch(i){webphone_api.common.PutToDebugLogException(2,"webphone: SendChat",i)}}function B(e,t,n){try{return _e()?Me.API_VoiceRecord(e,t,n):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: VoiceRecord(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: VoiceRecord",o)}}function j(){try{return _e()?Me.API_AudioDevice():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: AudioDevice(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: AudioDevice",e)}}function $(e,t){try{return _e()?Me.API_SetVolume(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetVolume(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: SetVolume",n)}}function q(e){try{return _e()?Me.API_GetVolume(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetVolume(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: GetVolume",t)}}function z(e,t,n,o,i,a,r){try{return _e()?Me.API_PlaySound(e,t,n,o,i,a,r):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: PlaySound(), no applethandle "),!1)}catch(s){webphone_api.common.PutToDebugLogException(2,"webphone: PlaySound",s)}return!1}function K(e,t){var n="";try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetRegFailReason(), no applethandle "),!1;n=Me.API_GetRegFailReason(t)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: GetVolume",o)}e(n)}function X(e,t){try{if(!Be)return;return webphone_api.common.isNull(webphone_api.global.maintimerid)?(webphone_api.common.PutToDebugLog(3,"EVENT, webphone: SetParameter: cannot set parameter, because webphone is not running"),!1):"callto"!==e&&(_e()?Me.API_SetParameter(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetParameter(), no applethandle "),!1))}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: SetParameter",n)}}function J(e){try{if(webphone_api.common.isNull(e)||e<-4||e>35)return webphone_api.common.PutToDebugLog(3,"EVENT, webphone: SetLine: invalid line"),!1;if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetLine(), no applethandle "),!1;Me.API_SetLine(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: SetLine",t)}}function Y(e){try{if(webphone_api.common.isNull(e))return webphone_api.common.PutToDebugLog(3,"EVENT, webphone: SetLineEx: invalid line"),!1;if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetLineEx(), no applethandle "),!1;Me.API_SetLineEx(e)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: SetLine",t)}}function Q(){try{return _e()?Me.API_GetLine():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetLine(), no applethandle "),-1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: GetLine",e)}return-1}function Z(e){try{return _e()?Me.API_LineToCallID(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: LineToCallID(), no applethandle "),-1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: LineToCallID",t)}return""}function ee(e){try{return _e()?Me.API_CallIDToLine(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: CallIDToLine(), no applethandle "),-1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: CallIDToLine",t)}return-10}function te(e){try{return _e()?Me.API_GetLineDetails(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetLineDetails(), no applethandle "),"")}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: GetLineDetails",t)}return""}function ne(){try{return _e()?Me.API_IsRegistered():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: IsRegistered(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: IsRegistered",e)}}function oe(e){try{return _e()?Me.API_GetAudioDeviceList(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetAudioDeviceList(), no applethandle "),"")}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: GetAudioDeviceList",t)}}function ie(e){try{return _e()?Me.API_GetAudioDevice(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetAudioDevice(), no applethandle "),"")}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: GetAudioDevice",t)}}function ae(e,t,n){try{return _e()?Me.API_SetAudioDevice(e,t,n):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetAudioDevice(), no applethandle "),!1)}catch(o){webphone_api.common.PutToDebugLogException(2,"webphone: SetAudioDevice",o)}}function re(e,t,n,o){try{return _e()?Me.API_SetPushNotifications(e,t,n,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SetPushNotifications(), no applethandle "),!1)}catch(i){webphone_api.common.PutToDebugLogException(2,"webphone: SetPushNotifications",i)}}function se(){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Exit(), no applethandle "),!1;var e=Me.API_Exit();return webphone_api.common.isNull(e)&&(e=!1),webphone_api.common.PutToDebugLog(3,"EVENT, webphone: Exit result: "+e.toString()),e}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: Exit",t)}}function le(e,t){try{return _e()?Me.API_SendChatIsComposing(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: SendChatIsComposing(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: SendChatIsComposing",n)}}function pe(e){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: NeedRatingRequest(), no applethandle "),e(!1),!1;e(Me.API_NeedRatingRequest())}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: NeedRatingRequest",t)}}function ce(){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetLastCallDetails(), no applethandle "),webphone_api.global.lastcalldetails;var e=Me.API_GetLastCallDetails();if(!webphone_api.common.isNull(e)&&e.length>0){var t=e.split(",");webphone_api.common.isNull(t)&&(t="");for(var n="",o=0;o<t.length;o++)webphone_api.common.isNull(t[o])||t[o].length<1||(n.length>0&&(n+="<br>"),n+=webphone_api.common.Trim(t[o]));if(n.length>0)return n}}catch(i){webphone_api.common.PutToDebugLogException(2,"webphone: GetLastCallDetails",i)}return webphone_api.global.lastcalldetails}function ue(){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: GetIncomingDisplay(), no applethandle "),"";var e=Me.API_GetIncomingDisplay();return webphone_api.common.PutToDebugLog(5,"EVENT, webphone: API_GetIncomingDisplay: "+e),e}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: GetIncomingDisplay",t)}return""}function he(e){try{return _e()?Me.API_DelSettings(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: DelSettings(), no applethandle "),"")}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: DelSettings",t)}return""}function ge(e,t){try{if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA){if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: Jvoip(), no applethandle "),!1;Me[e].apply(Me,t)}else if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE){var n=null,o=null,i=null,a=null,r=null,s=null,l=null,p=null,c=null;if(!webphone_api.common.isNull(t)&&t.length>0)for(var u=0;u<t.length;u++)0===u&&(n=t[0]),1===u&&(o=t[1]),2===u&&(i=t[2]),3===u&&(a=t[3]),4===u&&(r=t[4]),5===u&&(s=t[5]),6===u&&(l=t[6]),7===u&&(p=t[7]),8===u&&(c=t[8]);webphone_api.common.WinAPI(e,null,n,o,i,a,r,s,l,p,c)}}catch(h){webphone_api.common.PutToDebugLogException(2,"webphone: Jvoip",h)}}function me(){try{if(webphone_api.global.apppletloaded)return;return webphone_api.global.apppletloaded=!0,webphone_api.common.PutToDebugLog(2,"EVENT, webphone LoadApplet called"),window.attributes=ke,window.parameters=ze,mwpdeploy.runApplet(ke,ze,"1.5"),je=webphone_api.common.GetParameterBool("isfirststart",!0),Fe=!0,!0}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: LoadApplet",e)}}function de(e){try{webphone_api.common.PutToDebugLog(2,"EVENT, webphone LoadApplet InsertApplet called"),webphone_api.$("#wpappletconatiner").remove();var t='<div id="wpappletconatiner" style="z-index:10000; position:absolute; float:left; top:0; left:0; line-height: 1px; font-size: 1px;">'+e+"</div>";webphone_api.$("body").append(t),webphone_api.common.PutToDebugLog(2,"EVENT, webphone LoadApplet InsertApplet inserted")}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: InsertApplet",n)}}function be(){if(He>20)return void webphone_api.common.PutToDebugLog(2,"ERROR, waitForWebphone maxloop elapsed");if(webphone_api.global.useengine.length>0&&"java"!==webphone_api.global.useengine)return void webphone_api.common.PutToDebugLog(2,"ERROR, waitForWebphone useengine not set or incorrect: "+webphone_api.global.useengine);if(webphone_api.common.GetTickCount()-nt>45e3&&webphone_api.global.phonestarted<3){var e=100;if(!1===webphone_api.common.IsSDK()){var n=webphone_api.$.mobile.activePage.attr("id");if(!webphone_api.common.isNull(n)&&n.indexOf("_settings")>0)return void setTimeout(function(){be()},1e3);e=webphone_api.common.GetDeviceWidth(),!webphone_api.common.isNull(e)&&webphone_api.common.IsNumber(e)||(e=200)}webphone_api.common.PutToDebugLog(2,"WARNING, waitForWebphone display Applet, because no handle found_1");var o=webphone_api.common.GetDeviceHeight();webphone_api.common.isNull(o)&&(o=200),webphone_api.$("#webphone").css("position","absolute"),webphone_api.$("#webphone").css("top","100px"),webphone_api.$("#webphone").width(e),webphone_api.$("#webphone").height(o-100)}if(!1===webphone_api.global.applet_started&&webphone_api.global.phonestarted<3)return void setTimeout(function(){be()},250);if((webphone_api.common.isNull(et)||webphone_api.common.isNull(tt)||et<10||tt<10)&&(et=webphone_api.common.GetDeviceWidth(),(webphone_api.common.isNull(et)||webphone_api.common.isNull(tt)||et<50||tt<50)&&(et=150,tt=100)),He++,Be=_e())setTimeout(function(){webphone_api.$("#webphone").width(1),webphone_api.$("#webphone").height(1)},10),webphone_api.global.phonestarted<2&&(webphone_api.global.phonestarted=2),webphone_api.common.isNull(document.getElementById("javaerrormsg"))||(document.getElementById("javaerrormsg").style.display="none"),He=0,webphone_api.common.SaveParameter("isfirststart","false"),t(),webphone_api.common.PutToDebugLog(2,"EVENT, appletAvailable: "+Be),r();else{var i=0;if(i=!0===je?25:50,He>=i&&webphone_api.global.phonestarted<3){webphone_api.common.PutToDebugLog(2,"WARNING, waitForWebphone display Applet, because no handle found_2");var o=webphone_api.common.GetDeviceHeight();webphone_api.common.isNull(o)&&(o=200),webphone_api.$("#webphone").css("position","absolute"),webphone_api.$("#webphone").css("top","100px"),webphone_api.$("#webphone").width(et-1),webphone_api.$("#webphone").height(o-100),webphone_api.common.isNull(document.getElementById("javaerrormsg"))||(document.getElementById("javaerrormsg").style.display="block")}setTimeout(function(){be()},450)}}function _e(){if(!1===webphone_api.global.applet_started)return!1;if(null===Me||void 0===Me){try{Me=document.getElementById("webphone")}catch(r){}if(null==Me){var e=null;try{e=document.applets,0==e.length&&(e=document.getElementsByTagName("object")),0==e.length&&(e=document.getElementsByTagName("applet"));for(var t=0;t<e.length;++t)try{if("undefined"!=typeof e[t].API_Call){Me=e[t];break}}catch(r){}}catch(r){}if(null==Me)try{Me=document.applets[0]}catch(r){}null==Me&&webphone_api.common.PutToDebugLog(3,"ERROR, webphone: initcheck(), cannot find applet handle")}if(null!=Me)try{var n=Me.getSubApplet();null!=n&&(Me=n)}catch(r){}}var o="",i=navigator.userAgent.toLowerCase();try{if(null==Me)return!1;if(void 0!==Me&&(o=Me.toString()),i.indexOf("msie")>0||i.indexOf("trident")>0)for(var a in Me)if("contentDocument"===a){if(null==Me)return!1;o=Me[a].toString();break}}catch(r){webphone_api.common.PutToDebugLogException(2,"ERROR, webphone: initcheck",r)}return null==o||""==o||o.toLowerCase().indexOf("[object")>=0&&o.toLowerCase().indexOf("[object")<5?(Me=null,!1):(webphone_api.webphone_handle=Me,!0)}function fe(e,t,n,o,i){try{return _e()?Me.API_SetCredentials(e,t,n,o,i):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_SetCredentials(), no applethandle "),!1)}catch(a){webphone_api.common.PutToDebugLogException(2,"webphone: API_SetCredentials",a)}}function we(e,t,n,o){try{return _e()?Me.API_SetCredentials(e,t,n,o):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_SetCredentialsMD5(), no applethandle "),!1)}catch(i){webphone_api.common.PutToDebugLogException(2,"webphone: API_SetCredentialsMD5",i)}}function ve(e){try{return _e()?Me.API_CheckVoicemail(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_CheckVoicemail(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_CheckVoicemail",t)}}function Pe(e){try{return _e()?Me.API_SetLine(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_SetLine(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_SetLine",t)}}function Ee(e){try{return _e()?Me.API_GetLine(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetLine(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetLine",t)}}function Te(e){try{return _e()?Me.API_GetLineStatus(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetLineStatus(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetLineStatus",t)}}function Ne(e,t){try{return _e()?Me.API_Forward(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_Forward(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: API_Forward",n)}}function Se(e){try{return _e()?Me.API_IsMuted(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_IsMuted(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_IsMuted",t)}}function Ie(e){try{return _e()?Me.API_IsOnHold(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_IsOnHold(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_IsOnHold",t)}}function Ce(e){try{return _e()?Me.API_GetAudioDeviceList(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetAudioDeviceList(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetAudioDeviceList",t)}}function Re(e){try{return _e()?Me.API_GetAudioDevice(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetAudioDevice(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetAudioDevice",t)}}function Ge(e){try{return _e()?Me.API_SetAudioDevice(e):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_SetAudioDevice(), no applethandle "),!1)}catch(t){webphone_api.common.PutToDebugLogException(2,"webphone: API_SetAudioDevice",t)}}function ye(e){try{if(!_e())return webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_GetVolume(), no applethandle "),!1;var t=Me.API_GetVolume(e);return webphone_api.common.PutToDebugLog(2,"webphone: GetVolume java returned: "+t.toString()),t}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: API_GetVolume",n)}}function Le(){try{return _e()?Me.API_RecFiles_Upload():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Upload(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: API_RecFiles_Upload",e)}return!1}function Oe(e,t){try{return _e()?Me.API_RecFiles_UploadEx(e,t):(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_UploadEx(), no applethandle "),!1)}catch(n){webphone_api.common.PutToDebugLogException(2,"webphone: API_RecFiles_UploadEx",n)}return!1}function De(){try{return _e()?Me.API_RecFiles_Clear():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Clear(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: API_RecFiles_Clear",e)}return!1}function xe(){try{return _e()?Me.API_RecFiles_Del():(webphone_api.common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Del(), no applethandle "),!1)}catch(e){webphone_api.common.PutToDebugLogException(2,"webphone: API_RecFiles_Del",e)}return!1}var Ae=webphone_api.getbasedir2()+"native",ke={id:"webphone",code:"webphone.webphone.class",name:"webphone",
archive:"webphone.jar",codebase:Ae,width:1,height:1,MAYSCRIPT:!0},Ue="X-Webdomain: "+webphone_api.common.GetWebdomain(),Ve=webphone_api.common.GetParameter("companyname");!webphone_api.common.isNull(Ve)&&Ve.length>0&&(Ue=Ue+"\r\nX-Company: "+Ve);var We=webphone_api.common.GetParameter("brandname");!webphone_api.common.isNull(We)&&We.length>0&&(Ue=Ue+"\r\nX-Brand: "+We);var Fe,Me,He,Be,je,$e,qe,ze={serveraddress:"",username:"",MAYSCRIPT:!0,mayscript:"yes",scriptable:!0,jsscriptevent:3,autocfgsave:3,align:"middle",customsipheader:Ue,loglevel:5,canopenlogview:!1,hasincomingcall:!1,textmessaging:-1,pluginspage:"https://java.com/download/",permissions:"all-permissions",alt:"Enable or install java: https://www.java.com/en/download/index.jsp",java_arguments:"-Djava.net.preferIPv4Stack=true -Dsun.net.maxDatagramSockets=60"},Ke=300,Xe=8e3,Je=null,Ye=!1,Qe=0,Ze=null,et=0,tt=0,nt=0;return webphone_api.webphone_handle=Me,webphone_api.webphone_pollstatus=!0,{InsertApplet:de,Start:n,StartWin:i,StartService:a,LoadApplet:me,Restart:s,PushContactlist:l,StartPresence:r,CheckPresence:p,SetPresenceStatus:c,CheckBLF:u,GetVersionNS:h,GetVersionNSNum:g,GetVersionJava:m,IsEncrypted:d,RegisterEx:b,SetSipHeader:_,GetSipHeader:f,GetSipHeaderInternal:w,GetSipMessage:v,GetGetLastInvite:P,GetGetLastRecInvite:E,GetGetLastSentInvite:T,GetWorkDir:N,Unregister:S,ReRegister:I,HTTPKeepAlive:C,Call:R,Hangup:G,Accept:y,Reject:L,Ignore:O,Forward:D,Conference:x,ConferenceEx:A,Transfer:k,Dtmf:U,MuteEx:V,IsMuted:W,Hold:F,IsOnHold:M,SendChat:H,VoiceRecord:B,AudioDevice:j,SetVolume:$,GetVolume:q,PlaySound:z,GetRegFailReason:K,SetParameter:X,SetLine:J,SetLineEx:Y,GetLine:Q,LineToCallID:Z,CallIDToLine:ee,GetLineDetails:te,IsRegistered:ne,GetAudioDeviceList:oe,GetAudioDevice:ie,SetAudioDevice:ae,SetPushNotifications:re,Exit:se,NeedRatingRequest:pe,Jvoip:ge,GetLastCallDetails:ce,GetIncomingDisplay:ue,DelSettings:he,API_SetCredentials:fe,API_SetCredentialsMD5:we,API_CheckVoicemail:ve,API_SetLine:Pe,API_GetLine:Ee,API_GetLineStatus:Te,API_Forward:Ne,API_IsMuted:Se,API_IsOnHold:Ie,API_GetAudioDeviceList:Ce,API_GetAudioDevice:Re,API_SetAudioDevice:Ge,API_GetVolume:ye,API_RecFiles_Upload:Le,API_RecFiles_UploadEx:Oe,API_RecFiles_Clear:De,API_RecFiles_Del:xe,SendChatIsComposing:le}}(),webphone_api.notifications=function(){function e(){var e=0;try{e=1,webphone_api.global.creditRequestIval=100,webphone_api.global.closeCallAtivity=!1,_=!1,h=0,e=2;var t=webphone_api.common.GetTickCount();N=t,S=t,I=t,g=0,m=!1,d=!1,Ee="",b="",webphone_api.global.last_event="",G=t,webphone_api.global.httpkatimer=t,webphone_api.global.audio_devices_loaded=!1,e=3;var n=webphone_api.common.GetAudioRecList();!webphone_api.common.isNull(n)&&n.length>5&&(webphone_api.global.audio_devices_loaded=!0),e=4,webphone_api.global.lastcallduration=0,L=-1,O=t,x=t,j=null,$="",q="";var o=webphone_api.common.GetParameter2("ringtimeout"),i=webphone_api.common.GetParameter2("ringtimeoutin"),a=webphone_api.common.GetParameter2("ringtimeoutout"),r=webphone_api.common.GetParameter2("calltimeout");if(e=5,(webphone_api.common.isNull(o)||o.length<2||!1===webphone_api.common.IsNumber(o))&&(o=9e4),(webphone_api.common.isNull(i)||i.length<2||!1===webphone_api.common.IsNumber(i))&&(i=0),(webphone_api.common.isNull(a)||a.length<2||!1===webphone_api.common.IsNumber(a))&&(a=0),(webphone_api.common.isNull(r)||r.length<2||!1===webphone_api.common.IsNumber(r))&&(o=108e5),e=6,k=webphone_api.common.StrToInt(o),U=webphone_api.common.StrToInt(i),V=webphone_api.common.StrToInt(a),W=webphone_api.common.StrToInt(r),e=7,webphone_api.global.ringstart_time=0,webphone_api.global.callstart_time=0,webphone_api.global.useajax_forservice=!1,webphone_api.global.wsuser_succeded=!1,F=!1,webphone_api.global.acallcount=0,webphone_api.global.enstarteddisplayed=!1,M=!1,Pe=0,webphone_api.global.httpheaderslogged=!1,webphone_api.global.onregisteredcalled=!1,webphone_api.global.wsc_contimeout=0,webphone_api.global.wsc_reqtimeout=0,webphone_api.global.firstregister_sessiontick=0,e=8,webphone_api.common.isNull(document.getElementById("loader")))if(e=9,webphone_api.common.PutToDebugLog(2,"EVENT, init adding loader iframe, because not found in page"),webphone_api.common.isNull(document.body))webphone_api.common.PutToDebugLog(2,"ERROR, init adding loader iframe, document.body is NULL");else{e=10;var s=document.createElement("iframe");s.style.display="none",s.style.height="0",s.style.width="0",s.id="loader",s.setAttribute("allow","microphone; camera"),e=11,document.body.appendChild(s)}}catch(l){webphone_api.common.PutToDebugLogException(2,"notifications: Init "+e,l)}}function t(n){var l=0;try{if(webphone_api.common.CanLog(7)&&webphone_api.common.PutToDebugLog(7,"PROCESSING_NOTIFICATIONS: "+n),webphone_api.global.initcalled||(webphone_api.global.initcalled=!0,e()),!webphone_api.common.isNull(n)&&n.length>0)try{var h=n.split(",");if(!webphone_api.common.isNull(h)&&h.length>0){for(var g="",N=0;N<h.length;N++)webphone_api.common.isNull(h[N])&&(h[N]=""),h[N]=webphone_api.common.Trim(h[N]),0===h[N].indexOf("_BASE64_")&&(h[N]=webphone_api.common.B64Dec(h[N]),webphone_api.common.isNull(h[N])&&(h[N]=""),h[N]=webphone_api.common.Trim(h[N])),g.length>0&&(g+=","),g+=h[N];!webphone_api.common.isNull(g)&&g.length>0&&(n=g)}}catch(en){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications base64 decode",en)}if(ie<0&&(ie=webphone_api.common.IsCExt()),webphone_api.common.isNull(Z)&&webphone_api.common.getuseengine().length>0&&(Z=webphone_api.common.Te2(),webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&(Z=!1),Z)){var S=[];S.push("L"),S.push("i"),S.push("m"),S.push("i"),S.push("t"),S.push(" "),S.push("f"),S.push("u"),S.push("n"),S.push("c");var I=S.join("");setTimeout(function(){webphone_api.common.PutToDebugLog(3,"EVENT, "+I)},920),S=[],S.push("S"),S.push("T"),S.push("A"),S.push("T"),S.push("U"),S.push("S"),oe=S.join("")}if(Z&&!webphone_api.common.isNull(oe)&&oe.length>0){var G="";if(!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0)for(var N=0;N<webphone_api.global.ep.length;N++)if(!webphone_api.common.isNull(webphone_api.global.ep[N][webphone_api.common.EP_CALLID])&&webphone_api.global.ep[N][webphone_api.common.EP_CALLID].length>3){G=webphone_api.global.ep[N][webphone_api.common.EP_CALLID];break}!webphone_api.common.isNull(G)&&G.length>3&&!1===p(G)&&n.indexOf(oe)>=0&&(n=n.replace(oe,""),n=webphone_api.common.Trim(n),n=n.substring(1),n=webphone_api.common.Trim(n))}if(l=10,!_){webphone_api.global.presence_started=!1,_=!0,webphone_api.common.isNull(webphone_api.global.maintimerid)||clearInterval(webphone_api.global.maintimerid),webphone_api.global.maintimerid=null,webphone_api.global.maintimerid=setInterval(function(){o()},C),webphone_api.common.LcAc(!0,!1),l=14;try{if(0==webphone_api.common.IsSDK()){var O=webphone_api.common.GetColortheme(),D=webphone_api.themes.gettheme("theme_"+O);if(webphone_api.common.isNull(D))y="#ffffff";else{var x=D.fontcstatus;y=webphone_api.common.isNull(x.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))?"#ffffff":x}}}catch(tn){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications at init 1",tn)}}if(l=20,webphone_api.common.isNull(n)||n.length<1)return;if(n=n.replace("NORETRY",""),n=webphone_api.common.Trim(n),X=n,0===X.indexOf("START")&&(X.indexOf("api")>0||X.indexOf("sip")>0)&&(webphone_api.global.apistartstate=2,webphone_api.plhandler.GetAudioDevicesForMenu(100)),!1===webphone_api.global.applet_started&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&"START,api"===X){webphone_api.global.applet_started=!0,l=24;var A=webphone_api.common.GetParameter2("serveraddress_user");if((webphone_api.common.isNull(A)||A.length<2)&&(A=webphone_api.common.GetParameter2("serveraddress")),(webphone_api.common.isNull(A)||A.length<2)&&webphone_api.common.PutToDebugLog(2,"EVENT, notifications ProcessNotifications serveraddress not set"),!1===webphone_api.global.usestorage&&!webphone_api.common.CheckDID(A,!1)){var S=[];S.push("E"),S.push("R"),S.push("R"),S.push("O"),S.push("R"),S.push(","),S.push("S"),S.push("e"),S.push("r"),S.push("v"),S.push("e"),S.push("r"),S.push(" "),S.push("n"),S.push("o"),S.push("t"),S.push(" "),S.push("a"),S.push("l"),S.push("l"),S.push("o"),S.push("w"),S.push("e"),S.push("d"),S.push("_"),S.push("3");var I=S.join("");return l=26,void setTimeout(function(){webphone_api.common.PutToDebugLog(1,I+" "+A)},1251)}}if(l=30,X.indexOf("CHATCOMPOSING")>=0){var k=0,U="",V=X.indexOf(",");if(V>0&&(l=32,X=X.substring(V+1),(V=X.indexOf(","))>0&&(l=34,k=webphone_api.common.Trim(X.substring(0,V)),X=X.substring(V+1),(V=X.indexOf(","))>0))){l=36,U=webphone_api.common.Trim(X.substring(0,V));var W=webphone_api.common.Trim(X.substring(V+1));!webphone_api.common.isNull(W)&&webphone_api.common.IsNumber(W)&&1===webphone_api.common.StrToInt(W)&&(l=39,s(U+" "+webphone_api.stringres.get("composing")+"...","EVENT",1,-1))}return}if(l=40,X.indexOf("SERVERCONTACTS")>=0){if(webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, notifications: "+X),X.toLowerCase().indexOf("error")>=0)return void webphone_api.common.PutToDebugLog(2,"ERROR, notifications: "+X);l=44;var M="",V=0;V=X.indexOf(","),V>0&&(M=webphone_api.common.Trim(X.substring(V+1,X.length))),l=48,webphone_api.common.SaveParameter("servercontacts",M),!webphone_api.common.isNull(M)&&M.length>0&&webphone_api.common.PutToDebugLog(2,"EVENT, servercontacts list: "+M)}if(l=50,X.indexOf("PRESENCE")>=0&&!0===webphone_api.common.UsePresence2()){if(webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, notifications: "+X),X.toLowerCase().indexOf("error")>=0)return void webphone_api.common.PutToDebugLog(2,"ERROR, notifications: "+X);var H="",V=0;if(V=X.indexOf(","),l=54,V>0){H=webphone_api.common.Trim(X.substring(V+1,X.length));var B="",ae="",re="",se="",ce="",ue=H.split(",");if(!webphone_api.common.isNull(ue)&&ue.length>1){B=webphone_api.common.Trim(ue[0]),ae=webphone_api.common.Trim(ue[1]),ue.length>2&&(re=webphone_api.common.Trim(ue[2])),ue.length>3&&(se=webphone_api.common.Trim(ue[3])),ue.length>4&&(ce=webphone_api.common.Trim(ue[4]));var he="-1";(webphone_api.common.isNull(re)||re.length<1)&&(re=ae),he=webphone_api.common.SaveReceivedPresence2(B,re),"-2"===he&&ae.length>1&&re!==ae&&(he=webphone_api.common.SaveReceivedPresence2(B,ae));try{webphone_api.onPresenceCb(B,ae,se,ce)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onPresenceStateChange() callback",nn)}l=58,!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._dialpad)||webphone_api._dialpad.PopulateListRecents(),l=59,!0!==webphone_api.global.isContactdetailsStarted||!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._contactdetails)||webphone_api._contactdetails.PopulateData(),!0===webphone_api.global.isMessageStarted&&webphone_api._message.DisplayPresence(he)}}}if(X.indexOf("BLF")>=0&&webphone_api.common.GetParameterInt("enableblf",1)>0){if(webphone_api.common.CanLog(3)&&webphone_api.common.PutToDebugLog(3,"EVENT, notifications: "+X),X.toLowerCase().indexOf("error")>=0)return void webphone_api.common.PutToDebugLog(2,"ERROR, notifications: "+X);var ge="",V=0;if(V=X.indexOf(","),l=54,V>0){ge=webphone_api.common.Trim(X.substring(V+1,X.length));var B="",me="",ae="",de="",be=ge.split(",");if(!webphone_api.common.isNull(be)&&be.length>1){B=webphone_api.common.Trim(be[0]),me=webphone_api.common.Trim(be[1]),be.length>2&&(ae=webphone_api.common.Trim(be[2])),be.length>3&&(de=webphone_api.common.Trim(be[3]));try{webphone_api.onBLFCb(B,me,ae,de)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onBLFStateChange() callback",nn)}}}}l=60,z="",K="";var V=0;if("["===X.charAt(0)&&(V=X.indexOf("]"))>0&&(X=webphone_api.common.Trim(X.substring(V+1,X.length))),l=63,V=X.indexOf(","),V>0?(z=webphone_api.common.Trim(X.substring(0,V)),X=webphone_api.common.Trim(X.substring(V+1,X.length))):z="EVENT",l=65,"ANSWER"===z)return l=69,void webphone_api.common.HttpAsyncHandler(X);if(l=70,"DTMF"===z){var _e=-1,fe=n,we=fe.indexOf(",");we>0&&(fe=fe.substring(we+1),(we=fe.indexOf(","))>0&&(fe=webphone_api.common.Trim(fe.substring(0,we)),!webphone_api.common.isNull(fe)&&webphone_api.common.IsNumber(fe)&&(_e=webphone_api.common.StrToInt(fe))));try{webphone_api.onDTMFCb(X,_e)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onDTMF() callback",nn)}}if("STATUS"===z||"CDR"===z||"CHAT"===z||"SUBSCRIBE"===z||"NOTIFY"===z||"EVENT"===z||"ERROR"===z||"WARNING"===z||"POPUP"===z||"CREDIT"===z||"RATING"===z||"MWI"===z||"START"===z||"VREC"===z||"DTMF"===z||"PRESENCE"===z||"CHATREPORT"===z||"CHATCOMPOSING"===z||"BLF"===z||"LINE"===z||"STOP"===z||"LINEDETAILS"===z||"QRCODE"===z||"NOTIFICATION"===z||"GROUP"===z||"RTPSTAT"===z||"INFO"===z||"SHOULDRESET"===z||"PLAYREADY"===z||"VAD"===z||"SERVERCONTACTS"===z||"NEWUSER"===z||"ANSWER"===z){l=71;try{webphone_api.onEventCb("event",n,null)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an ERROR in onEvent() callback at notification: "+n,nn)}try{webphone_api.RecEvt(n)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an ERROR in onEvents() callback at notification: "+n,nn)}try{ie>0&&"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents(n)}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications AndroidWebphoneJsInterface send",nn)}}else if("LOG"!==z)return l=74,void(!1===Z&&webphone_api.common.PutToDebugLog(5,"EVENT, unknown notification a: "+n));if(n.indexOf("-1,Stop")>=0&&webphone_api.global.phonestarted>0&&webphone_api.common.OpenSettings(!0,8),"GROUP"===z&&X.toLowerCase().indexOf("error")<0&&!1===webphone_api.common.IsSDK())try{var ve=X.split(",");if(!webphone_api.common.isNull(ve)&&ve.length>2){var Pe=ve[2];!webphone_api.common.isNull(Pe)&&Pe.length>0&&isCallStarted&&null!=Call.instance&&(CommonGUI.GetObj().PutToDebugLog(2,"EVENT, Group conference update peers to: "+Pe),webphone_api.$("#page_call_additional_info").html(Pe),webphone_api.$("#page_call_peer_details").html(""),webphone_api.$("#page_call_peer_details").hide(),webphone_api.$("#display_notmain_account").html(""),webphone_api.$("#display_notmain_account").hide(),webphone_api.$("#contact_image_img").attr("src",webphone_api.common.GetElementSource()+"images/default_contact_conf.png"))}}catch(on){webphone_api.common.PutToDebugLogException(2,"notifications ProcessNotifications handle group conference",on)}if("QRCODE"===z)webphone_api.common.ParseQRcode(X);else if("LOG"===z)X.indexOf("mzserver detected")>=0&&(X.indexOf("gw")>=0?2==webphone_api.common.ismizuserverdetected?webphone_api.common.ismizuserverdetected=3:webphone_api.common.ismizuserverdetected=1:X.indexOf("both")>=0?webphone_api.common.ismizuserverdetected=3:1==webphone_api.common.ismizuserverdetected?webphone_api.common.ismizuserverdetected=3:webphone_api.common.ismizuserverdetected=2);else if("CHATREPORT"===z){var Ee=X.split(",");if(!webphone_api.common.isNull(Ee)&&Ee.length>5){var Te=Ee[1],Ne=Ee[2],Se=Ee[5];if(webphone_api.common.isNull(Te)&&(Te=""),Te=webphone_api.common.Trim(Te),Te=Te.toLowerCase(),webphone_api.common.isNull(Ne)&&(Ne=""),Ne=webphone_api.common.Trim(Ne),webphone_api.common.isNull(Se)&&(Se=""),Se=webphone_api.common.Trim(Se),"2"==Ne||"4"==Ne){var Ie="chat_"+webphone_api.common.GetSipusername()+"_"+Te;Te.length>0&&Ne.length>0&&Se.length>0&&(Se=Se.toLowerCase(),webphone_api.common.IsWindowsSoftphone()?webphone_api.common.ApiWinLoadFile(Ie,function(e){webphone_api.common.isNull(e)&&(e=""),r(Ie,Ne,Se,e,Te)}):webphone_api.File.ReadFile(Ie,webphone_api.global.STORAGE_LOCAL,function(e){webphone_api.common.isNull(e)&&(e=""),r(Ie,Ne,Se,e,Te)}))}}}else if("LINEDETAILS"===z){var Ce=X.split(",");if(!webphone_api.common.isNull(Ce)&&Ce.length>10){webphone_api.common.PutToDebugLog(2,"EVENT, update ep from received LINEDETAILS notification");var Re=Ce[0],Ge=Ce[3],ye=Ce[2],Le=Ce[5],Oe=Ce[8],De=Ce[9];webphone_api.common.SaveCallSession(11,Re,null,Ge,Le,-1,-1,-1,null,ye,"","","",Oe,De,"")}}else if("LINE"===z){var xe=-20,Ae=X,V=Ae.indexOf(",");if(V>0&&(Ae=Ae.substring(0,V)),Ae=webphone_api.common.Trim(Ae),webphone_api.common.IsNumber(Ae)&&(xe=webphone_api.common.StrToInt(Ae)),xe>-5)return void webphone_api.common.SetALineInternal(xe,1)}else if("STATUS"===z){webphone_api.global.apistartstate=2,b=X;var ke=c(n,-1);webphone_api.global.lnstat[ke]=[webphone_api.common.GetTickCount(),X]}else("STATUS"===z||"EVENT"===z)&&X.toLowerCase().indexOf("permission")<0&&(webphone_api.global.last_event=X);if(!0===webphone_api.common.Glbr()&&"CREDIT"===z)T=!0,webphone_api.global.credit=" "+X;else if(!0===webphone_api.common.Glbr()&&"RATING"===z)l=82,webphone_api.global.rating=" ("+webphone_api.common.Trim(X)+")";else if("MWI"===z&&(l=83,!webphone_api.common.isNull(X)&&X.length>0&&X.indexOf(",")>=0)){var Ue=X.split(",");if(!webphone_api.common.isNull(Ue)&&Ue.length>=2)if("no"===Ue[0])l=85,60===webphone_api.common.GetConfigInt("brandid",-1)?webphone_api.common.SetNotCounter("dialpad_message_counter","0"):webphone_api.common.SetNotCounter("dialpad_voicemail_counter","0");else{l=87;var Ve=Ue[2];webphone_api.common.isNull(Ve)&&(Ve=""),Ve=webphone_api.common.Trim(Ve),Ve.length>0&&webphone_api.common.IsNumber(Ve)&&(l=88,webphone_api.common.PutToDebugLog(3,"EVENT, New voicemail messages found: "+Ve),60===webphone_api.common.GetConfigInt("brandid",-1)?webphone_api.common.SetNotCounter("dialpad_message_counter",Ve):webphone_api.common.SetNotCounter("dialpad_voicemail_counter",Ve))}}l=90;var We=X.indexOf("POPUP");if(We>=0){var Fe=X.substring(We+5);Fe=webphone_api.common.Trim(Fe),We=Fe.indexOf(","),We>=0&&(Fe=Fe.substring(We+1)),l=94,!webphone_api.common.isNull(Fe)&&Fe.length>0&&webphone_api.common.ShowToast(Fe,5e3)}if(V=X.indexOf(","),X=webphone_api.common.Trim(X),V>0&&(X=webphone_api.common.Trim(X.substring(V+1,X.length))),l=96,V=X.indexOf(","),V>0?(K=webphone_api.common.Trim(X.substring(0,V)),X=webphone_api.common.Trim(X.substring(V+1,X.length))):K=X,l=100,V=K.indexOf("("),V>0&&K.indexOf(te)<0&&K.indexOf(ne)<0&&(K=webphone_api.common.Trim(K.substring(0,V))),K.length<1&&!1===Z)return void webphone_api.common.PutToDebugLog(5,"WARNING, unknown notification b: "+n);if(X.length<1&&!1===Z)return void webphone_api.common.PutToDebugLog(5,"WARNING, unknown notification c: "+n);if(l=110,"CDR"===z&&(webphone_api.common.CanLog(5)&&webphone_api.common.PutToDebugLog("EVENT, notifications: ProcessNotifications CDR received: "+n,5),webphone_api.global.lastcallcdr=n,(V=n.indexOf(","))>0))try{var Me="";l=115;var He=n.split(","),Be=He[1],B=He[2],je=He[3],$e=He[4],qe=(He[5],He[6]),ze=He[7],Ke=He[8],Xe=He[9],de="";He.length>10&&(de=He[10]);var Je=2;B===$e&&(Je=1),webphone_api.common.isNull(Xe)&&(Xe=""),Xe.indexOf("[")>0&&(Xe=Xe.substring(0,Xe.indexOf("["))),l=120,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.common.GetDiscReasonFromSignaling(function(e){(webphone_api.common.isNull(e)||e.length<2)&&(e=Xe),!0===webphone_api.global.dontshowdiscreason?webphone_api.common.PutToDebugLog(2,"EVENT, "+webphone_api.stringres.get("disc_reason")+": "+e):(webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("disc_reason")+": "+e),s(webphone_api.stringres.get("disc_reason")+": "+e,"EVENT",0,webphone_api.common.StrToIntDef(Be,-1))),webphone_api.common.RemoveSessionHeadersFromCache(webphone_api.common.StrToIntDef(Be,-1))}),webphone_api.common.RemoveSessionHeadersFromCache(webphone_api.common.StrToInt(Be)),webphone_api.global.lastcalldetails="",webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetLastCallDetails",null),l=124;var Ye="<br>",me="outgoing";if(2===Je&&(me="incoming"),webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Line: "+Be+", Direction: "+me+Ye,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Auth Username: "+webphone_api.common.GetSipusername()+Ye,2===Je?(webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Caller: "+je+Ye,je!==B&&(webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Caller Name: "+B+Ye)):webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Caller ID: "+webphone_api.common.GetCallerid()+Ye,l=128,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Connecttime: "+qe+" msec"+Ye,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Duration: "+ze+" msec"+Ye,webphone_api.global.lastcalldetails="1"===Ke?webphone_api.global.lastcalldetails+"Disconnect By: Local"+Ye:webphone_api.global.lastcalldetails+"Disconnect By: Remote"+Ye,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"Reason: "+Xe+Ye,webphone_api.global.lastcalldetails=webphone_api.global.lastcalldetails+"CDR: "+webphone_api.global.lastcallcdr+Ye,webphone_api.common.getuseengine===webphone_api.global.ENGINE_WEBRTC){var Qe=webphone_api.common.ReplaceAll(webphone_api.global.lastcalldetails,Ye,"\n");setTimeout(function(){webphone_api.common.PutToDebugLog(2,"EVENT, Call details:\n"+Qe)},1)}webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC&&(!0===webphone_api.global.dontshowdiscreason?webphone_api.common.PutToDebugLog(2,"EVENT, "+webphone_api.stringres.get("disc_reason")+": "+Xe):(webphone_api.common.PutToDebugLog(1,"EVENT, "+webphone_api.stringres.get("disc_reason")+": "+Xe),s(webphone_api.stringres.get("disc_reason")+": "+Xe,"EVENT",0,webphone_api.common.StrToIntDef(Be,-1)))),l=122;try{webphone_api.onCdrCb(je,$e,qe,ze,Je,B,Xe,webphone_api.common.StrToInt(Be),de)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCdr() callback",nn)}if(!0===webphone_api.common.UsePresence2()&&!webphone_api.common.isNull(ze)&&webphone_api.common.IsNumber(ze)){if(webphone_api.common.StrToInt(ze)<=0)webphone_api.common.PutToDebugLog(4,"EVENT,notifications CDR 0 duration get presence status for: "+B),!1===webphone_api.common.IsSDK()&&webphone_api.common.PresenceGet2(B);else{if(!webphone_api.common.isNull(webphone_api.global.presenceHM))var Ze=webphone_api.global.presenceHM[B];if(!webphone_api.common.isNull(Ze)){var et=Ze[webphone_api.common.PRES_STATUS];webphone_api.common.isNull(et)||"0"!==et||(webphone_api.common.PutToDebugLog(4,"EVENT,notifications CDR connected call but presence was offline, so set it to online for: "+B),webphone_api.common.SaveReceivedPresence2(B,"online"))}}}l=130,!webphone_api.common.isNull(He[9])&&He[9].length>0&&webphone_api.common.PutToDebugLog(1,"EVENT, "+He[9]),Me=webphone_api.common.Trim(He[2]);var tt=0;try{tt=webphone_api.common.StrToInt(He[7])/1e3}catch(an){}webphone_api.global.lastcallduration=tt,l=132;var nt="recfile";if(2===Je?(f=!1,!1===webphone_api.global.acceptReject?(l=136,i(Me,"2",nt,tt,Be,Xe)):(l=137,i(Me,"1",nt,tt,Be,Xe)),webphone_api.global.acceptReject=!1):(l=138,i(Me,"0",nt,tt,Be,Xe)),w="",nt="",tt>60){var ot=webphone_api.common.GetParameterInt("successfulcalls",0),it=webphone_api.common.GetParameterInt("webrtc_successfulcalls",0);ot<0&&(ot=0),it<0&&(it=0),ot++,webphone_api.common.SaveParameter("successfulcalls",ot.toString()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(it++,webphone_api.common.SaveParameter("webrtc_successfulcalls",it.toString()));var at=4;ot===at&&"Android"===webphone_api.common.GetOs()&&(!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api.common.PutToDebugLog(4,"EVENT, Close call page because trying to display Add to Home Screen popup"),webphone_api._call.CloseCall()),setTimeout(function(){var e=webphone_api.$(".ui-page-active .ui-popup-active").length;!0===webphone_api.common.IsSDK()||e<1?(webphone_api.common.PutToDebugLog(2,"EVENT, Offer pin to desktop Home Screen Android"),webphone_api.common.AlertDialog(webphone_api.stringres.get("add_to_home_title"),webphone_api.stringres.get("add_to_home_msg"))):(at-=1,webphone_api.common.SaveParameter("successfulcalls",at.toString()))},500))}}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications CDR and save to call history",nn)}if(l=140,"STATUS"===z){if("Registered."===K||"Registered"===K){webphone_api.global.phonestarted=3,webphone_api.common.SaveParameter("firststart_webrtc","false"),webphone_api.common.SaveParameter("last_login_failed","false");var rt=webphone_api.common.GetParameter("profilepicture");if(!webphone_api.common.isNull(rt)&&rt.length>10&&SetSipHeader("X-Profile: "+rt,-1),webphone_api.global.firstregister_sessiontick<1&&(webphone_api.global.firstregister_sessiontick=webphone_api.common.GetTickCount()),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&2===webphone_api.global.usuk.length&&webphone_api.common.SaveParameter("last_good_webrtc_gw",webphone_api.global.usuk),!1===webphone_api.common.IsSDK()&&("undefined"!=typeof webphone_api._dialpad&&null!==webphone_api._dialpad?webphone_api._dialpad.HandleAutoaction():console&&console.log&&console.log("ERROR, notifications ProcessNotifications webphone_api._dialpad is not defined")),l=141,!0===webphone_api.common.UsePresence2()&&!1===webphone_api.global.pres_set_at_start&&(l=142,setTimeout(function(){webphone_api.global.pres_set_at_start=!0,webphone_api.common.PutToDebugLog(2,"EVENT,SetSelectedPresence to Online on notification reg"),webphone_api.common.SetSelectedPresence("Online"),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.common.IsMizuServerOrGateway()&&webphone_api.webrtcapi.SetSipHeader(-2,"X-IMStatus:"+webphone_api.common.GetParameter("presencestatus"))},200)),l=143,!1===webphone_api.global.onregisteredcalled){webphone_api.global.onregisteredcalled=!0;try{webphone_api.onRegStateChangeCb("registered",null)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onRegStateChangeCb(registered) callback",nn)}try{webphone_api.onRegisteredCb()}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onRegistered() callback",nn)}}if(webphone_api.$("#webphone").width(1),webphone_api.$("#webphone").height(1),l=145,l=147,!0===webphone_api.common.Glbr()&&!T){var st=webphone_api.common.GetParameter("creditrequest");!webphone_api.common.isNull(st)&&st.length>0&&(l=148,webphone_api.common.UriParser(st,"","","","","creditrequest"))}}if(l=150,K.toLowerCase().indexOf("unregistered")>=0&&(webphone_api.global.authenticated_displayed=!1,!1===webphone_api.global.onunregistered_flag)){webphone_api.global.onunregistered_flag=!0,webphone_api.global.onregisteredcalled=!1,setTimeout(function(){webphone_api.global.onunregistered_flag=!1},2e3),l=152;try{webphone_api.onRegStateChangeCb("unregistered",null)}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(unregistered) callback",nn)}try{webphone_api.onUnRegisteredCb()}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onUnRegistered() callback",nn)}}if(l=160,"InProgress"===K){var lt=X.split(",");if(webphone_api.common.isNull(lt)||lt.length<3)return void webphone_api.common.PutToDebugLog(3,"EVENT, ProcessNotifications, skip InProgress event, because not enough parameters: "+X);var pt="",B="",me="",ct=n.replace(" ",""),ut="";!webphone_api.common.isNull(lt)&&lt.length>4&&(ut=lt[4]),!webphone_api.common.isNull(lt)&&lt.length>2&&(!webphone_api.common.isNull(lt[0])&&lt[0].length>1?pt=webphone_api.common.Trim(lt[0]):!webphone_api.common.isNull(lt[1])&&lt[1].length>1&&(pt=webphone_api.common.Trim(lt[1])),!webphone_api.common.isNull(lt[2])&&lt[2].length>0&&(me=webphone_api.common.Trim(lt[2])),lt.length>3&&(B=lt[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=pt))),webphone_api.common.isNull(pt)&&(pt="");var xe=webphone_api.global.aline;if(webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC){var ht=webphone_api.common.Trim(n),gt=ht.indexOf(",");gt>0&&(ht=ht.substring(gt+1),ht=webphone_api.common.Trim(ht),(gt=ht.indexOf(","))>0&&(ht=ht.substring(0,gt),ht=webphone_api.common.Trim(ht),!webphone_api.common.isNull(ht)&&webphone_api.common.IsNumber(ht)&&(xe=webphone_api.common.StrToInt(ht),webphone_api.common.SetALineInternal(xe,2),webphone_api.global.lastalinesettick=0)))}if(1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callTrying",webphone_api.common.StrToInt(me),pt,B,xe,ut)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callTrying",nn)}try{webphone_api.onCallStateChangeCb("trying",webphone_api.common.StrToInt(me),pt,B,xe,ut)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback trying",nn)}}if("Midcall"===K){var lt=X.split(",");if(webphone_api.common.isNull(lt)||lt.length<3)return void webphone_api.common.PutToDebugLog(3,"EVENT, ProcessNotifications, skip Midcall event, because not enough parameters: "+X);var pt="",B="",me="",ct=n.replace(" ",""),ut="";!webphone_api.common.isNull(lt)&&lt.length>4&&(ut=lt[4]),!webphone_api.common.isNull(lt)&&lt.length>2&&(!webphone_api.common.isNull(lt[0])&&lt[0].length>1?pt=webphone_api.common.Trim(lt[0]):!webphone_api.common.isNull(lt[1])&&lt[1].length>1&&(pt=webphone_api.common.Trim(lt[1])),!webphone_api.common.isNull(lt[2])&&lt[2].length>0&&(me=webphone_api.common.Trim(lt[2])),lt.length>3&&(B=lt[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=pt))),webphone_api.common.isNull(pt)&&(pt="");var xe=webphone_api.global.aline;if(webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC){var ht=webphone_api.common.Trim(n),gt=ht.indexOf(",");gt>0&&(ht=ht.substring(gt+1),ht=webphone_api.common.Trim(ht),(gt=ht.indexOf(","))>0&&(ht=ht.substring(0,gt),ht=webphone_api.common.Trim(ht),!webphone_api.common.isNull(ht)&&webphone_api.common.IsNumber(ht)&&(xe=webphone_api.common.StrToInt(ht))))}if(1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("midcall",webphone_api.common.StrToInt(me),pt,B,xe,ut)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback midcall",nn)}}if(K===webphone_api.stringres.get("muted")||K===webphone_api.stringres.get("unmuted")){var ct=n.replace(" ",""),lt=ct.split(","),xe=webphone_api.global.aline;if(!webphone_api.common.isNull(lt)&&lt.length>1&&webphone_api.common.IsNumber(lt[1])&&(xe=webphone_api.common.StrToInt(lt[1])),1===webphone_api.common.GetApibehaviour())if(K===webphone_api.stringres.get("muted"))try{webphone_api.onCallStateChangeCb("muted","","","",xe,"")}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback muted",nn)}else try{webphone_api.onCallStateChangeCb("unmuted","","","",xe,"")}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback unmuted",nn)}}if("Transfer"===K&&1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("transfer","","","",-1,"")}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback transfer",nn)}if(n.indexOf("EVENT,Hold")>=0){if(1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("hold","","","","","")}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback hold",nn)}}else if(n.indexOf("EVENT,Reload")>=0&&1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("reload","","","","","")}catch(nn){
webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback reload",nn)}if(n.indexOf("EVENT,conference created")>=0&&1===webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("conference","","","","","")}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback conference",nn)}if("CallSetup"===K||"Ringing"===K){!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200));var lt=X.split(",");if(webphone_api.common.isNull(lt)||lt.length<3)return void webphone_api.common.PutToDebugLog(3,"EVENT, ProcessNotifications, skip ringing event, because not enough parameters: "+X);var pt="",B="",me="",ct=n.replace(" ","");!webphone_api.common.isNull(lt)&&lt.length>1&&lt[1];var ut="";!webphone_api.common.isNull(lt)&&lt.length>4&&(ut=lt[4]),!webphone_api.common.isNull(lt)&&lt.length>2&&(!webphone_api.common.isNull(lt[0])&&lt[0].length>1?pt=webphone_api.common.Trim(lt[0]):!webphone_api.common.isNull(lt[1])&&lt[1].length>1&&(pt=webphone_api.common.Trim(lt[1])),l=163,!webphone_api.common.isNull(lt[2])&&lt[2].length>0&&(me=webphone_api.common.Trim(lt[2])),l=164,lt.length>3&&(B=lt[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=pt))),l=167,webphone_api.common.isNull(pt)&&(pt="");var xe=webphone_api.global.aline;if(webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_WEBRTC){var ht=webphone_api.common.Trim(n),gt=ht.indexOf(",");l=169,gt>0&&(ht=ht.substring(gt+1),ht=webphone_api.common.Trim(ht),(gt=ht.indexOf(","))>0&&(l=172,ht=ht.substring(0,gt),ht=webphone_api.common.Trim(ht),!webphone_api.common.isNull(ht)&&webphone_api.common.IsNumber(ht)&&(l=175,xe=webphone_api.common.StrToInt(ht),webphone_api.common.SetALineInternal(xe,3),webphone_api.global.lastalinesettick=0)))}if("CallSetup"==q&&"Ringing"===K){if(1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callRinging",webphone_api.common.StrToInt(me),pt,B,xe,ut)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callRinging",nn)}try{webphone_api.onCallStateChangeCb("ringing",webphone_api.common.StrToInt(me),pt,B,xe,ut)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback ringing",nn)}"1"==me?(l=271,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallringing,"callRinging",me,pt,pt,"")):(l=272,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallringing,"callRinging",me,pt,pt,""))}if(q=K,!webphone_api.common.isNull($)&&$.length>0&&$===ut)return void webphone_api.common.PutToDebugLog(5,"EVENT, Skip "+K+" handling, because already handled for this call: "+ut+" ("+$+")");var mt=!1,dt=webphone_api.global.aline;if(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&webphone_api.common.GetNrOfActiveCalls()>0&&"Firefox"===webphone_api.common.GetBrowser()&&!webphone_api.common.isNull(webphone_api.global.ep)&&webphone_api.global.ep.length>0)for(var N=0;N<webphone_api.global.ep.length;N++)if(!webphone_api.common.isNull(webphone_api.global.ep[N])&&"true"==webphone_api.global.ep[N][webphone_api.common.EP_HOLDSTATE]){var bt=webphone_api.global.ep[N][webphone_api.common.EP_LINE];webphone_api.mysetline(bt),webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold mainlogic resume call from nt; peer: "+webphone_api.global.ep[N][webphone_api.common.EP_DESTNR]+" on line: "+bt),webphone_api.hold(!1),webphone_api.mute(!0),mt=!0}mt&&webphone_api.mysetline(dt),$=ut,webphone_api.common.isNull(j)||clearTimeout(j),j=null,webphone_api.global.acallcount++,F=!1,l=161,webphone_api.common.RemoveSipHeadreFromCache("X-reason"),webphone_api.common.RemoveSipHeadreFromCache("Reason"),webphone_api.common.RemoveSipHeadreFromCache("Warning"),webphone_api.global.ringstart_time=webphone_api.common.GetTickCount(),l=176;var _e=webphone_api.common.StrToInt(xe);if(_e>0&&webphone_api.common.GetOtherPartyName(_e,pt),P=webphone_api.common.GetTickCount(),w=pt,webphone_api.global.currcallnumber=w,webphone_api.global.checkIfInCall=!0,webphone_api.global.checkIfCallActive=!1,webphone_api.common.SaveCallSession(12,xe,null,pt,me,webphone_api.common.GetTickCount(),-1,-1,"",ut,"","",null),!0!==webphone_api.common.GetParameterBool("voicerecording",!1)||webphone_api.common.isNull(webphone_api._call)||!1===webphone_api._call.IsRecStarted(pt)&&webphone_api._call.StartRecording(pt),l=177,1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callSetup",webphone_api.common.StrToInt(me),pt,B,xe,ut)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callSetup",nn)}try{webphone_api.onCallStateChangeCb("setup",webphone_api.common.StrToInt(me),pt,B,xe,ut)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback setup",nn)}if(1==me?(l=178,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallsetup,"callSetup",me,pt,pt,"","additional_info")):(l=179,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallsetup,"callSetup",me,pt,pt,"","additional_info"),1===webphone_api.common.GetParameterInt("beeponincoming",0)&&webphone_api.common.Beep("1")),webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_displaypeerdetails,"callSetup",me,pt,pt,"","scurl_displaypeerdetails"),webphone_api.common.PutToDebugLog(5,"EVENT, currevent: "+ct+"; isIcomingCall: "+me+"; line: "+Q+", lastRingEvent: "+webphone_api.global.lastRingEvenet),webphone_api.common.UpdateContactLastActive(pt),"2"==me){if(!1===webphone_api.common.IsSDK()&&!webphone_api.common.isNull(document.getElementById("display_notmain_account"))&&webphone_api.common.GetNrOfAcc()>1){var _t="",ft=lt[1];if(!webphone_api.common.isNull(webphone_api.global.sipaccounts)&&webphone_api.global.sipaccounts.length>0){for(var N=0;N<webphone_api.global.sipaccounts.length;N++){var wt=webphone_api.global.sipaccounts[N];if(!0===wt.ismain){if(!webphone_api.common.isNull(ft)&&ft.length>0&&ft!=wt.username)for(var vt=0;vt<webphone_api.global.sipaccounts.length;vt++)if(webphone_api.global.sipaccounts[vt].username===ft){_t=webphone_api.global.sipaccounts[vt].username,!webphone_api.common.isNull(webphone_api.global.sipaccounts[vt].serveraddress)&&webphone_api.global.sipaccounts[vt].serveraddress.length>0&&(_t=_t+"@"+webphone_api.global.sipaccounts[vt].serveraddress);break}break}}!webphone_api.common.isNull(_t)&&_t.length>0&&(webphone_api.$("#display_notmain_account").html(_t),webphone_api.$("#display_notmain_account").show())}}var Pt=webphone_api.common.GetParameter("callnot_title"),Et=webphone_api.common.GetParameter("callnot_body"),Tt=webphone_api.common.GetParameter("callnot_icon"),Nt=webphone_api.common.GetParameter("callnot_image");(webphone_api.common.isNull(Pt)||Pt.length<1)&&(Pt=webphone_api.common.GetBrandName()),(webphone_api.common.isNull(Et)||Et.length<1)&&(Et=webphone_api.stringres.get("notification_message")),Et+=": ",B.length>0&&B!==pt?Et=Et+B+" ("+pt+")":Et+=pt,(webphone_api.common.isNull(Tt)||Tt.length<1)&&(Tt=webphone_api.common.GetElementSource()+"images/notification_icon.png"),webphone_api.common.isNull(Nt)&&(Nt=""),webphone_api.common.ShowIncomingCallNotification(Pt,Et,Tt,!1,Nt)}if(!webphone_api.common.isNull(me)&&"2"==me&&ct!==webphone_api.global.lastRingEvenet){if(l=280,webphone_api.common.IsContactBlocked(w,null))return l=281,webphone_api.common.PutToDebugLog(4,"EVENT, call dropped (hangup) because blocked contact: "+w),webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup blocked contact: "+w),void webphone_api.hangup();if(webphone_api.common.IsNumberBlacklisted(w,null))return l=282,webphone_api.common.PutToDebugLog(4,"EVENT, call dropped (hangup) because blacklisted number: "+w),webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup blacklisted number: "+w),void webphone_api.hangup();if(webphone_api.global.active_incoming_call=!0,webphone_api.global.incommingCall=!0,f=!0,webphone_api.global.checkIfInCall=!0,webphone_api.global.checkIfCallActive=!1,l=285,webphone_api.common.SaveParameter("redial",w),webphone_api.common.SaveParameter("lastincalltime",webphone_api.common.GetTickCount()),webphone_api.global.intentcall[0]="number="+w,webphone_api.global.intentcall[1]="calltype=incoming",webphone_api.global.intentcall[2]="name=",l=286,!0===webphone_api.common.UsePresence2()&&!0===webphone_api.global.incommingCall&&"dnd"===webphone_api.common.GetParameter("presencestatus").toLowerCase())return webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup incoming call from: "+pt+", because presence is DND"),void webphone_api.hangup();0==webphone_api.common.IsSDK()&&setTimeout(function(){l=290,!1===webphone_api.global.isCallStarted?webphone_api.$.mobile.changePage("#page_call",{transition:"pop",role:"page"}):(l=292,webphone_api.common.isNull(webphone_api._call)||webphone_api._call.OnNewIncomingCall())},500)}l=297,(webphone_api.common.isNull(webphone_api.global.lastRingEvenet)||webphone_api.global.lastRingEvenet.length<1)&&(webphone_api.global.lastRingEvenet=ct)}if(l=180,"CallConnect"===K){!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200));var pt="",B="",me="",lt=X.split(",");!webphone_api.common.isNull(lt)&&lt.length>1&&lt[1],ie>0&&u(),webphone_api.common.PutToDebugLog(5,"EVENT, callConnected event received"),"Android"===webphone_api.common.GetOs()&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&(webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_GetDevice Callconnect"),webphone_api.getdevice(0,function(e){try{if(webphone_api.common.GetParameterInt("androidspeaker",1)>0){if("Default"===e){var t=webphone_api.common.GetAudioRecList();if(!webphone_api.common.isNull(t)&&t.length>0)for(var n=t.split("\r\n"),o=0;o<n.length;o++)!webphone_api.common.isNull(n[o])&&(n[o].toLowerCase().indexOf("earpiece")>=0||n[o].toLowerCase().indexOf("headset")>=0)&&(e=n[o],webphone_api.common.SaveParameter("sel_rtc_audio_in",e),webphone_api.global.audio_rec_curr_device=e,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",e))}!webphone_api.common.isNull(e)&&e.length>0&&(webphone_api.common.PutToDebugLog(4,"EVENT, Set input device id for Android loudspeaker: "+e),webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_SetDevice Callconnect"),webphone_api.setdevice(0,e,2))}else{if(e.toLowerCase().indexOf("earpiece")>=0||e.toLowerCase().indexOf("headset")>=0){var t=webphone_api.common.GetAudioRecList();if(!webphone_api.common.isNull(t)&&t.length>0)for(var n=t.split("\r\n"),o=0;o<n.length;o++)!webphone_api.common.isNull(n[o])&&n[o].toLowerCase().indexOf("default")>=0&&(e=n[o],webphone_api.common.SaveParameter("sel_rtc_audio_in",e),webphone_api.global.audio_rec_curr_device=e,webphone_api.common.SaveParameter("cache_audio_rec_curr_device",e))}!webphone_api.common.isNull(e)&&e.length>0&&(webphone_api.common.PutToDebugLog(4,"EVENT, Set input device id for Android loudspeaker: "+e),webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_SetDevice Callconnect"),webphone_api.setdevice(0,e,2))}}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: getdevice loudspeaker 2",nn)}})),webphone_api.common.ShowIncomingCallNotification("","","",!0,""),webphone_api.global.checkIfInCall=!0,webphone_api.global.callstart_time=webphone_api.common.GetTickCount(),l=182,!webphone_api.common.isNull(lt)&&lt.length>2&&(!webphone_api.common.isNull(lt[0])&&lt[0].length>1?pt=webphone_api.common.Trim(lt[0]):!webphone_api.common.isNull(lt[1])&&lt[1].length>1&&(pt=webphone_api.common.Trim(lt[1])),l=184,!webphone_api.common.isNull(lt[2])&&lt[2].length>0&&(me=webphone_api.common.Trim(lt[2])),lt.length>3&&(B=lt[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=pt)),l=188);var St="";if(lt.length>4&&!webphone_api.common.isNull(lt[4])&&(St=lt[4]),webphone_api.common.isNull(pt)&&(pt=""),l=190,1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callConnected",webphone_api.common.StrToInt(me),pt,B,webphone_api.common.StrToInt(webphone_api.global.aline),St)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callConnected",nn)}try{webphone_api.common.PutToDebugLog(5,"EVENT, call connected event sent"),webphone_api.onCallStateChangeCb("connected",webphone_api.common.StrToInt(me),pt,B,webphone_api.common.StrToInt(webphone_api.global.aline),St)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback connected",nn)}if(1===webphone_api.common.StrToInt(me)){if(l=205,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallconnected,"callConnected",me,pt,pt,""),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){var It=webphone_api.common.GetParameterInt("beeponconnect",0);3!==It&&4!==It||webphone_api.common.Beep("1")}}else l=206,webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallconnected,"callConnected",me,pt,pt,"");l=207,webphone_api.common.SaveCallSession(13,webphone_api.global.aline,null,pt,me,-1,webphone_api.common.GetTickCount(),-1,"",St,"","",null),setTimeout(function(){webphone_api.common.RefreshInfo()},400)}if(l=200,"CallDisconnect"===K){webphone_api.common.PutToDebugLog(2,"EVENT, ProcessNotifications call disc received");var Ct=0;try{var Rt=webphone_api.common.Trim(n).split(",");!webphone_api.common.isNull(Rt)&&Rt.length>3&&Rt[4],Ct=2,webphone_api.common.ShowIncomingCallNotification("","","",!0,"");var k=webphone_api.global.aline,Gt="";Ct=3,!webphone_api.common.isNull(Rt)&&Rt.length>3&&(!webphone_api.common.isNull(Rt[1])&&webphone_api.common.IsNumber(Rt[1])&&(k=webphone_api.common.StrToInt(Rt[1])),webphone_api.common.isNull(Rt[3])||(Gt=webphone_api.common.Trim(Rt[3]))),Ct=4,webphone_api.common.RemoveSessionHeadersFromCache(k);var lt=X.split(","),pt="",B="",me="",St="";if(lt.length>4&&!webphone_api.common.isNull(lt[4])&&(St=lt[4]),setTimeout(function(){webphone_api.common.CanLog(2)&&webphone_api.common.PutToDebugLog(2,"EVENT, notifications delete/remove endpoint on call disconnected for number: "+Gt+"; line: "+k.toString());var e=!0;!0===webphone_api.global.calltransf_completed&&(e=!1),(!0!==webphone_api.global.checkIfInCall||webphone_api.common.isNull(webphone_api.global.ep)||1!==webphone_api.global.ep.length)&&webphone_api.common.GetEndpoint(1021,k,Gt,St,"",e)},350),Ct=5,Ct=7,l=202,!webphone_api.common.isNull(lt)&&lt.length>2&&(!webphone_api.common.isNull(lt[0])&&lt[0].length>1?pt=webphone_api.common.Trim(lt[0]):!webphone_api.common.isNull(lt[1])&&lt[1].length>1&&(pt=webphone_api.common.Trim(lt[1])),l=204,!webphone_api.common.isNull(lt[2])&&lt[2].length>0&&(me=webphone_api.common.Trim(lt[2])),l=206,lt.length>3&&(B=lt[3],(webphone_api.common.isNull(B)||B.length<1)&&(B=pt))),webphone_api.global.CLOSE_CALL_TIMER<0){var yt=0,Lt=webphone_api.common.GetEndpoint(1022,k,Gt,St,"",!1);if(!webphone_api.common.isNull(Lt)&&Lt.length>5){var Ot=Lt[webphone_api.common.EP_CONNECTTIME];!webphone_api.common.isNull(Ot)&&webphone_api.common.IsNumber(Ot)&&(Ot=webphone_api.common.StrToIntDef(Ot,0))>0&&(yt=webphone_api.common.GetTickCount()-Ot)}webphone_api.global.CLOSE_CALL_TIMER=webphone_api.common.GetParameterInt("closecall_timeout",3e3),(1==me||"1"==me)&&yt<4e3&&(webphone_api.global.CLOSE_CALL_TIMER=webphone_api.common.GetParameterInt("closecall_timeout_err",7e3))}webphone_api.common.GetNrOfActiveCalls()<2&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.isconfcall=!1),Ct=6,l=201,webphone_api.common.ResetIce(),Ct=8;var St="";if(lt.length>4&&!webphone_api.common.isNull(lt[4])&&(St=lt[4]),l=213,webphone_api.common.isNull(pt)&&(pt=""),!1===webphone_api.common.IsSDK()&&(l=215),Ct=9,!0!==webphone_api.common.GetParameterBool("voicerecording",!1)||webphone_api.common.isNull(webphone_api._call)||!0===webphone_api._call.IsRecStarted(pt)&&webphone_api._call.StopRecording(pt),Ct=10,l=218,1!==webphone_api.common.GetApibehaviour())try{webphone_api.onCallStateChangeCb("callDisconnected",webphone_api.common.StrToInt(me),pt,B,k,St)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callDisconnected",nn)}try{webphone_api.onCallStateChangeCb("disconnected",webphone_api.common.StrToInt(me),pt,B,k,St)}catch(nn){webphone_api.common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback disconnected",nn)}!1===webphone_api.global.calltransf_completed&&webphone_api.common.SaveCallSession(14,null,null,pt,webphone_api.common.StrToInt(me),-1,-1,webphone_api.common.GetTickCount(),"",St,"","",null),Ct=11,webphone_api.global.acallcount--,webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.global.usemutemutiline=!1),Ct=12}catch(nn){webphone_api.common.PutToDebugLogException(2,"ProcessNotifications CallDisconnect error: "+Ct.toString(),nn)}}if(l=220,"Call Finished"===K){if(ee=!1,webphone_api.global.bothpartyhold=!1,webphone_api.global.authenticated_displayed=!1,webphone_api.global.ringstart_time=0,webphone_api.global.callstart_time=0,webphone_api.isscreensharecall=!1,webphone_api.global.rating="",webphone_api.global.isholdresume=!1,webphone_api.global.isresume=0,webphone_api.global.holdresumecount=0,webphone_api.global.add_recall_header=!1,ie>0)try{"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents("[HANGUP]_NOTIFICATION")}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications inner AndroidWebphoneJsInterface",nn)}l=222,webphone_api.common.ResetIce(),v=webphone_api.common.GetTickCount(),webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.global.closeCallAtivity=!0),webphone_api.global.isCallStarted&&webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers)||webphone_api.global.waiting_conf_numbers.length<1)&&!1===webphone_api.global.dontshow_closecall&&(webphone_api.$("#btn_hangup_img").attr("src",webphone_api.common.GetElementSource()+"images/btn_close_txt.png"),webphone_api.$("#btn_hangup").attr("title",webphone_api.stringres.get("hint_closecall")),webphone_api.$("#acceptreject_layout").hide(),webphone_api.$("#callfunctions_layout").hide(),webphone_api.$("#hangup_layout").show()),webphone_api.common.IsMultiline()||(webphone_api.global.hangupPressedCount=1),l=232,webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.checkIfCallActive=!1,webphone_api.global.isconfcall=!1,F=!1),webphone_api.global.callTypeInOut="",webphone_api.global.creditRequestTimer=webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL-50,webphone_api.global.lastRingEvenet="",webphone_api.global.isfirstcall=!1,d=!1}if(l=240,"Finished"===K){!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200)),ee=!1,webphone_api.global.bothpartyhold=!1,webphone_api.global.ringstart_time=0,webphone_api.global.callstart_time=0,webphone_api.global.rating="",webphone_api.global.firefoxholdcount=0,webphone_api.global.isholdresume=!1,webphone_api.global.isresume=0,webphone_api.global.holdresumecount=0,webphone_api.global.add_recall_header=!1,l=242,webphone_api.common.ResetIce(),!0===webphone_api.global.incommingCall&&!1===webphone_api.global.acceptReject&&webphone_api.global.isCallStarted&&(l=245,!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.OnCallerHangup()),webphone_api.common.GetNrOfActiveCalls()<1&&(webphone_api.global.checkIfInCall=!1,webphone_api.global.checkIfCallActive=!1,webphone_api.global.isconfcall=!1,F=!1,webphone_api.global.incommingCall=!1,webphone_api.global.speakerState=!0,webphone_api.global.bluetoothState=!0,webphone_api.global.lastBTclicktick=0,webphone_api.global.callTypeInOut="",webphone_api.global.lastRingEvenet="",webphone_api.global.isfirstcall=!1),d=!1;var Dt=webphone_api.common.GetParameterInt("vdnr",0);if(webphone_api.global.isvideocall||webphone_api.isscreensharecall){Dt+=1,webphone_api.common.SaveParameter("vdnr",Dt);4===webphone_api.common.GetParameterInt("videomode",0)&&webphone_api.common.ExitVideoMode("Auto, on call finished")}if(webphone_api.global.isvideocall=!1,webphone_api.isscreensharecall=!1,l=247,!1===webphone_api.global.usestorage&&!1===webphone_api.common.Strl(60)&&Dt<2&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC&&!0===webphone_api.common.CanIUseService()){if(!0===(!0===webphone_api.common.IsMacLin()&&!0===webphone_api.common.IsMizuPublicWebRTCGateway())){l=248;var xt=webphone_api.common.GetParameterInt("lccnr",0);if(xt>0&&xt<46){var At=webphone_api.common.GetParameterInt("closecall_timeout_err",7e3);At<webphone_api.common.GetParameterInt("closecall_timeout",4e3)&&(At=webphone_api.common.GetParameterInt("closecall_timeout",4e3)),At+=1500,setTimeout(function(){function e(){webphone_api.common.SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,l=253,webphone_api.common.ResetEngineClicked();var e=webphone_api.common.GetEngine("ns");e.clicked=2,webphone_api.common.SetEngine("ns",e),webphone_api.common.EngineSelect(1,1),l=257,webphone_api.common.PutToDebugLog(2,"EVENT, notifications: offer ns engine instead of WebRTC: "+webphone_api.common.GetMinServiceVersion().toString()),l=259,webphone_api.common.EngineForcedInstall("ns",webphone_api.stringres.get("serviceengine_msg"),null,function(){webphone_api.startInner()})}var t=webphone_api.$.mobile.activePage.find(".messagePopup");!webphone_api.common.isNull(t)&&t.length>0&&!0!==webphone_api.global.dontclosecurrpopup?webphone_api.$.mobile.activePage.find(".messagePopup").popup("close").bind({popupafterclose:function(){webphone_api.$(this).unbind("popupafterclose").remove(),e()}}):e()},At)}}}}if(l=260,l=300,"Starting call"===K&&(!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200)),webphone_api.global.checkIfInCall=!0,webphone_api.global.checkIfCallActive=!1),l=304,"InCall"!==K&&"In Call"!==K||(webphone_api.global.checkIfInCall=!0,f&&(l=307,!1===webphone_api.common.IsSDK()&&webphone_api.common.GetNrOfActiveCalls()<2&&!webphone_api.common.isNull(webphone_api._call)&&webphone_api._call.AcceptCall(!1))),l=310,"Speaking"===K){!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||(webphone_api._call.MeasureCall(),setTimeout(function(){webphone_api._call.MeasureCall()},200));var lt=X.split(",");if(!webphone_api.common.isNull(lt)&&lt.length>1&&lt[1],webphone_api.global.apistartstate=2,!1===ee&&(l=312,ee=!0,!1===webphone_api.common.IsSDK()&&webphone_api.common.GetNrOfActiveCalls()<2&&!webphone_api.common.isNull(webphone_api._call)&&webphone_api._call.AcceptCall(!1)),!1===webphone_api.common.IsSDK()&&!1===webphone_api.global.isCallStarted&&webphone_api.common.isNull(j)&&(j=setTimeout(function(){!1===webphone_api.global.isCallStarted&&(webphone_api.global.intentcall[0]="number=",webphone_api.global.intentcall[1]="calltype=outgoing",webphone_api.global.intentcall[2]="name=",webphone_api.global.intentcall[3]="callmode=0",webphone_api.$.mobile.changePage("#page_call",{transition:"pop",role:"page"}))},1e3)),R=!0,webphone_api.global.incommingCall&&(webphone_api.global.incommingCall=!1),webphone_api.global.checkIfCallActive=!0,webphone_api.global.checkIfInCall=!0,webphone_api.global.lastRingEvenet="",l=314,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC){l=315;var kt=location.hostname;webphone_api.common.isNull(kt)&&(kt=""),kt+=" / ",kt+=window.location.href,kt+=" / ",kt+=webphone_api.getbasedir2();var Ut=1;if(!1===webphone_api.common.Awb2()){var S=[];S.push("L"),S.push("i"),S.push("c"),S.push("e"),S.push("n"),S.push("s"),S.push("e "),S.push("e"),S.push("r"),S.push("r"),S.push("o"),S.push("r"),S.push(", "),S.push("w"),S.push("e"),S.push("b"),S.push("s"),S.push("e"),S.push("r"),S.push("v"),S.push("e"),S.push("r"),S.push(" "),S.push("n"),S.push("o"),S.push("t"),S.push(" "),S.push("a"),S.push("l"),S.push("l"),S.push("o"),S.push("w"),S.push("e"),S.push("d"),S.push(" "),S.push("(");var Vt=[];Vt.push(")"),Vt.push(" "),Vt.push("h"),Vt.push("a"),Vt.push("n"),Vt.push("g"),Vt.push("u"),Vt.push("p");var I=S.join(""),Wt=Vt.join("");l=320,setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR,"+I+kt+Wt)},3576),setTimeout(function(){webphone_api.common.ShowToast(I+kt+Wt)},4235),Ut=10}if(Ut>5&&setTimeout(function(){webphone_api.hangup()},1180),L<0){if(!0===webphone_api.common.Ch())L=1;else{L=0;var S=[];S.push("L"),S.push("i"),S.push("c"),S.push("e"),S.push("n"),S.push("s"),S.push("e "),S.push("e"),S.push("r"),S.push("r"),S.push("o"),S.push("r"),S.push(", "),S.push("i"),S.push("n"),S.push("v"),S.push("a"),S.push("l"),S.push("i"),S.push("d "),S.push("s"),S.push("e"),S.push("r"),S.push("v"),S.push("e"),S.push("r"),S.push("a"),S.push("d"),S.push("d"),S.push("r"),S.push("e"),S.push("s"),S.push("s"),S.push(" "),S.push("h"),S.push("a"),S.push("n"),S.push("g"),S.push("u"),S.push("p");var I=S.join("");l=320,setTimeout(function(){webphone_api.common.PutToDebugLog(1,"ERROR,"+I)},351),setTimeout(function(){webphone_api.common.ShowToast(I)},391)}}0===L&&setTimeout(function(){webphone_api.hangup()},123)}if(l=322,webphone_api.common.GetNrOfActiveCalls()>1&&!1===F){F=!0;var Ft=webphone_api.common.StrToInt(webphone_api.common.GetParameter("automute")),Mt=webphone_api.common.StrToInt(webphone_api.common.GetParameter("autohold")),Ht=webphone_api.common.GetParameterInt("defmute",0);if(3!==Ht&&4!==Ht||(Ht=0),(webphone_api.common.isNull(Ft)||Ft<1)&&(webphone_api.common.isNull(Mt)||Mt<1));else for(var N=0;N<webphone_api.global.ep.length;N++){var Bt=webphone_api.global.ep[N];if(!(webphone_api.common.isNull(Bt)||Bt.length<1)){if(!webphone_api.common.isNull(Bt[webphone_api.common.EP_DISCONNECTTIME])&&webphone_api.common.IsNumber(Bt[webphone_api.common.EP_DISCONNECTTIME])){var jt=webphone_api.common.StrToInt(Bt[webphone_api.common.EP_DISCONNECTTIME]);if(jt>10)continue}var $t=Bt[webphone_api.common.EP_LINE];if(!(webphone_api.common.isNull($t)||$t.length<1||!1===webphone_api.common.IsNumber($t))){var qt=webphone_api.common.StrToInt($t);if(webphone_api.global.aline!=qt){var zt=Bt[webphone_api.common.EP_MUTESTATE],Kt=Bt[webphone_api.common.EP_HOLDSTATE];"false"==zt&&(3===Ft||6===Ft||(2===Ft||5===Ft)&&!1===f||1===Ft&&!0===f)&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?webphone_api.webrtcapi.SipToggleMute(!0,Ht,qt):webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.common.WinAPI("API_MuteEx",null,qt,!0,Ht):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.MuteEx(qt,!0,Ht),webphone_api.global.ep[N][webphone_api.common.EP_MUTESTATE]="true"),"false"==Kt&&(3===Mt||6===Mt||(2===Mt||5===Mt)&&!1===f||1===Mt&&!0===f)&&(webphone_api.common.getuseengine()===webphone_api.global.ENGINE_WEBRTC?webphone_api.webrtcapi.SipToggleHoldResume(!0,qt):webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE?webphone_api.common.WinAPI("API_Hold",null,qt,!0):webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&(webphone_api.common.PutToDebugLog(2,"EVENT, API_Hold mainlogic hold call because autohold; peer: "+webphone_api.global.ep[N][webphone_api.common.EP_DESTNR]+" on line: "+webphone_api.global.ep[N][webphone_api.common.EP_LINE]),webphone_api.webphone.Hold(qt,!0)),webphone_api.global.ep[N][webphone_api.common.EP_HOLDSTATE]="true")}}}}}d||(d=!0,l=338,webphone_api.global.isencrypted=webphone_api.isencrypted(),setTimeout(function(){webphone_api.global.isencrypted>0?webphone_api.$(".img_encrypt").show():webphone_api.$(".img_encrypt").hide()},1e3))}l=340,K.toLowerCase().indexOf("registered")>=0&&K.toLowerCase().indexOf("unregistered")<0&&(E<4&&(E=4),l=342,webphone_api.global.phonestarted=3,webphone_api.common.SaveParameter("lastsucc","1"),m||(m=!0),l=344,setTimeout(function(){webphone_api.global.isencrypted>0?webphone_api.$(".img_encrypt").show():webphone_api.$(".img_encrypt").hide()},1e3)),l=360}else if("CHAT"===z){var _e=-1,fe=webphone_api.common.Trim(n),we=fe.indexOf(",");if(we>0&&(fe=fe.substring(we+1),(we=fe.indexOf(","))>0&&(fe=webphone_api.common.Trim(fe.substring(0,we)),!webphone_api.common.isNull(fe)&&webphone_api.common.IsNumber(fe)&&(_e=webphone_api.common.StrToInt(fe)))),X.indexOf("[PRESENCE")>=0)return X=X.replace("[",""),X=X.replace("]",""),void t(X);l=361,a(K,X,_e)}"Rejected"===K&&f&&(l=364,!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.RejectCall(!1)),V=X.indexOf(","),V>0&&(X=K),l=366,V=K.indexOf("[ep"),V>0&&(K=webphone_api.common.Trim(K.substring(0,V)),X=K),l=370;var Xt="";if(("EVENT"===z||"ERROR"===z||"WARNING"===z||"STATUS"===z)&&(l=371,V=X.indexOf("("),Xt=V>0&&K.indexOf(te)<0&&K.indexOf(ne)<0?webphone_api.common.Trim(X.substring(0,V)):X,l=374,!webphone_api.common.IsNumber(Xt.charAt(0)))){if(Xt=Xt.substring(0,1).toUpperCase()+Xt.substring(1),"STATUS"===z){if("Deletable"!==Xt&&Xt.indexOf("Chat")<0){le=Xt,pe=-1;var Jt=n.split(",");if(!webphone_api.common.isNull(Jt)&&Jt.length>1&&!webphone_api.common.isNull(Jt[1])&&webphone_api.common.IsNumber(Jt[1])&&(pe=webphone_api.common.StrToIntDef(Jt[1],-1)),webphone_api.common.isNull(webphone_api.global.callPageStatusCachePerLine)&&(webphone_api.global.callPageStatusCachePerLine={}),!1===webphone_api.common.IsSDK()&&("page_call"===webphone_api.$.mobile.activePage.attr("id")||n.indexOf("CallSetup")>0)){var Yt=webphone_api.common.StrToIntDef(Jt[1],-1);if(Yt>0){var Qt=y;n.indexOf("ERROR")>=0?Qt="#FF0000":n.indexOf("WARNING")>=0&&(Qt="#D28F00"),"undefined"!=typeof webphone_api.global.callPageStatusCachePerLine[Yt]&&null!==webphone_api.global.callPageStatusCachePerLine[Yt]&&"undefined"!=typeof webphone_api.global.callPageStatusCachePerLine[Yt][0]&&null!==webphone_api.global.callPageStatusCachePerLine[Yt][0]&&"Muted"===webphone_api.global.callPageStatusCachePerLine[Yt][0]&&"Speaking"===Xt||(webphone_api.global.callPageStatusCachePerLine[Yt]=[Xt,Qt])}}}}else{J=Xt,Y=z,Q=-1;var Jt=n.split(",");!webphone_api.common.isNull(Jt)&&Jt.length>1&&!webphone_api.common.isNull(Jt[1])&&webphone_api.common.IsNumber(Jt[1])&&(Q=webphone_api.common.StrToIntDef(Jt[1],-1))}if(l=377,"Register failed"===Xt){le=Xt,pe=-1;var Jt=n.split(",");!webphone_api.common.isNull(Jt)&&Jt.length>1&&!webphone_api.common.isNull(Jt[1])&&webphone_api.common.IsNumber(Jt[1])&&(pe=webphone_api.common.StrToIntDef(Jt[1],-1))}if(l=379,(Xt.indexOf("Register failed")>=0||Xt.indexOf("Connection lost")>=0||Xt.indexOf("No network")>=0||Xt.indexOf("Network is down")>=0||Xt.indexOf("No response from server")>=0||Xt.indexOf("Server lost")>=0||Xt.indexOf("Authentication failed")>=0||Xt.indexOf("Rejected by server")>=0||Xt.indexOf("Register rejected")>=0||Xt.indexOf("Register expired")>=0||Xt.indexOf("Register failed")>=0)&&(webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE||webphone_api.common.WinAPI("API_GetRegFailReason",function(e){try{webphone_api.onRegStateChangeCb("failed",e)}catch(nn){
webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(failed) callback service",nn)}try{webphone_api.onRegisterFailedCb(e)}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegisterFailed() callback service",nn)}},!0),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&webphone_api.webphone.GetRegFailReason(function(e){try{webphone_api.onRegStateChangeCb("failed",e)}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(failed) callback webphone",nn)}try{webphone_api.onRegisterFailedCb(e)}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: There is an error in onRegisterFailed() callback webphone",nn)}},!0),!0===webphone_api.global.onunregistered_flag||!1===webphone_api.flagrestartwebrtc||webphone_api.common.SaveParameter("lastsucc","0"),webphone_api.global.dispregfailed<2&&(webphone_api.global.laststarttick<1||webphone_api.common.GetTickCount()-webphone_api.global.laststarttick>2500))){l=382,webphone_api.global.dispregfailed=2;var Zt=Xt;Zt=Zt.indexOf("Register failed")<0?"Register failed_: "+Zt:Zt.replace("Register failed","Register failed_"),webphone_api.common.PutToDebugLog(2,"EVENT, notification ProcessNotifications display: Register failed_: "+Zt),webphone_api.common.ShowToast(Zt,6e3)}}l=400}catch(nn){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications ("+l.toString()+"), not: "+n,nn)}}function n(e){fe=e}function o(){function e(e){try{webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup EarlyHangup: "+e),webphone_api.hangup()}catch(t){webphone_api.common.PutToDebugLogException(2,"notifications: EarlyHangup",t)}}var t=0;try{t=444101;var n=webphone_api.common.GetTickCount();if(t=444102,webphone_api.global.ever_received_pong&&webphone_api.global.pingpong>2){t=444103;!0===webphone_api.common.WSReConnect()?webphone_api.common.PutToDebugLog(2,"EVENT, WSReConnect from timer succeded"):webphone_api.common.PutToDebugLog(2,"ERROR, WSReConnect from timer failed")}t=444104,webphone_api.global.wsc_contimeout>10&&n-webphone_api.global.wsc_contimeout>5e3&&(webphone_api.global.wsc_contimeout=0,webphone_api.common.PutToDebugLog(2,"ERROR, WSReConnect websocketAPI connection timed out (from timer)"),webphone_api.common.WSReConnect()),webphone_api.global.wsc_reqtimeout>10&&n-webphone_api.global.wsc_reqtimeout>5e3&&(webphone_api.global.wsc_reqtimeout=0,webphone_api.common.PutToDebugLog(2,"ERROR, WSReConnect websocketAPI request timed out (from timer)"),webphone_api.common.WSReConnect()),!0===webphone_api.global.dontshowdiscreason&&H>25&&(H=0,webphone_api.global.dontshowdiscreason=!1),1===webphone_api.global.dispregfailed&&++Pe>330&&(Pe=0,t=444105,webphone_api.global.dispregfailed=2,webphone_api.global.phonestarted<2&&!0===webphone_api.common.NeedRegister()&&(webphone_api.common.PutToDebugLog(2,"EVENT, notification OnTimerCycle display: Register failed"),webphone_api.common.ShowToast("Register failed"))),t=444106,re<5e3&&re++,J.length>0?(t=444107,J.toLowerCase().indexOf("authenticated successfully")>=0&&(le="Registered.",pe=-1),ce=J,ue=Y,he=Q,re=0,J="",Y="",Q=-1):re>se?(ce=le,ue="STATUS",he=pe):le.indexOf("Registered.")>=0&&"ERROR"!==ue&&"WARNING"!==ue&&(t=444108,(webphone_api.global.firstregister_sessiontick<1||webphone_api.global.firstregister_sessiontick>0&&n-webphone_api.global.firstregister_sessiontick<5e3)&&(ce=le,ue="STATUS",he=pe));try{var o=ce.indexOf("[");o>0&&(ce=ce.substring(0,o)),ce=webphone_api.common.Trim(ce),o=ce.indexOf("]"),o>0&&(ce=ce.substring(o+1)),ce=webphone_api.common.Trim(ce)}catch(w){webphone_api.common.PutToDebugLogException(3,"notifications OnTimerCycle parse displayed status",w)}if("Registered."!==ce&&"Registered"!==ce||(ce+=webphone_api.global.credit),(ce.indexOf("Registered")>=0||"Not Found"===ce||ce.indexOf("Ringing")>=0||ce.indexOf("Incoming")>=0||ce.indexOf("In Call")>=0||ce.indexOf("Ringing")>=0||"Ringing"===ce||"CallConnect"===ce||"InCall"===ce||"Speaking"===ce)&&Ee!==webphone_api.global.useengine&&(Ee=webphone_api.global.useengine,webphone_api.common.SaveLastUsedEngine()),0!==ce.indexOf("Credit:")&&1!==ce.indexOf("Credit:")&&ce.indexOf("Outband")<0&&ce.indexOf("Deletable")<0&&ce.indexOf("Outbound")<0&&ce.toLowerCase().indexOf("subscribe")<0&&(ce.toLowerCase().indexOf("hide")>=0&&(ce=" "),s(ce,ue,0,he)),t=40,webphone_api.global.ringstart_time>0&&webphone_api.global.callstart_time<1&&webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE){t=41,(webphone_api.common.isNull(k)||!1===webphone_api.common.IsNumber(k))&&(k=90001),(webphone_api.common.isNull(U)||!1===webphone_api.common.IsNumber(U))&&(U=0),(webphone_api.common.isNull(V)||!1===webphone_api.common.IsNumber(V))&&(V=0);var i=k;!0===webphone_api.global.incommingCall?U>0&&(i=U):V>0&&(i=V);var a=webphone_api.common.GetParameter2("cutincoming"),r=0;"-1"===a?r=-1:"0"===a?r=0:"1"===a&&(r=1),t=51,n-webphone_api.global.ringstart_time>i&&(0==webphone_api.global.lastringtimeouttick||n-webphone_api.global.ringstart_time>3e3)&&(webphone_api.global.lastringtimeouttick=n,e("Hangup because ringtimeout limit reached: "+i)),-1===r?!0===webphone_api.global.incommingCall&&n-webphone_api.global.ringstart_time>14e3&&"Chrome"===webphone_api.common.GetBrowser()&&e("Hangup because ringtimeout in Chrome browser limit reached: 14000"):1===r&&!0===webphone_api.global.incommingCall&&n-webphone_api.global.ringstart_time>14e3&&e("Hangup because ringtimeout in ALL browsers limit reached: 14000")}if(t=55,webphone_api.global.callstart_time>0&&webphone_api.common.GetParameter("devicetype")!==webphone_api.common.DEVICE_WIN_SOFTPHONE()&&webphone_api.common.getuseengine()!==webphone_api.global.ENGINE_SERVICE&&(t=56,(webphone_api.common.isNull(W)||!1===webphone_api.common.IsNumber(W))&&(t=57,W=108e5),t=58,n-webphone_api.global.callstart_time>W&&(t=67,webphone_api.common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because calltimeout limit reached: "+W),t=68,webphone_api.hangup(),t=69)),t=70,!0===webphone_api.common.Glbr()&&!T&&0===webphone_api.global.creditRequestTimer&&E>2){var l=webphone_api.common.GetParameter("creditrequest");!webphone_api.common.isNull(l)&&l.length>0&&webphone_api.common.UriParser(l,"","","","","creditrequest")}if(webphone_api.global.creditRequestTimer++,webphone_api.global.creditRequestTimer>webphone_api.global.creditRequestIval&&(webphone_api.global.creditRequestTimer=0),n-G>webphone_api.global.presenceinterval&&(G=n,!1===webphone_api.common.IsSDK()&&!0===(M=webphone_api.common.UsePresence2())&&webphone_api.common.PresenceGet2(webphone_api.common.GetParameter("srvcontacts"))),!0===M&&!0===webphone_api.global.isMessageStarted&&++webphone_api.global.msg_presence_timer>200&&(webphone_api.global.msg_presence_timer=0,!1===webphone_api.common.IsSDK()&&webphone_api._message.RefreshPresence()),t=444110,n-O>D&&(O=n,webphone_api.common.CallWsuserKeepAlive(!1)),n-x>A&&(x=n,webphone_api.common.CallWsuserKeepAlive(!0),webphone_api.common.PutToDebugLog(2,"EVENT, wsuser keepalive hourly called")),webphone_api.global.closeCallAtivity&&(webphone_api.global.CLOSE_CALL_TIMER<0&&(webphone_api.global.CLOSE_CALL_TIMER=webphone_api.common.GetParameterInt("closecall_timeout",3e3)),n-v>webphone_api.global.CLOSE_CALL_TIMER&&(t=444111,webphone_api.global.CLOSE_CALL_TIMER=-100,webphone_api.global.closeCallAtivity=!1,v=0,!1===webphone_api.global.incommingCall&&!1===webphone_api.global.checkIfInCall&&webphone_api.global.isCallStarted&&(!1!==webphone_api.common.IsSDK()||webphone_api.common.isNull(webphone_api._call)||webphone_api._call.CloseCall()))),n-N>5e3&&!0===webphone_api.global.wasSettModified){t=444112,N=n,webphone_api.global.wasSettModified=!1;var p="";p=1==webphone_api.common.IsSDK()?webphone_api.common.GetSettFilenameSDK():webphone_api.common.GetActiveAccSettingsFilename(),webphone_api.common.SaveSettingsFile(1,p,function(e){webphone_api.common.CanLog(2)&&(e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveSettingsFile from timer Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveSettingsFile from timer Failed"))})}if(n-S>200&&(S=n,!0===webphone_api.global.wasCtModified&&(t=444113,webphone_api.global.wasCtModified=!1,webphone_api.common.SaveContactsFile(function(e){e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveContactsFile from timer Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveContactsFile from timer Failed")}))),n-I>400&&(I=n,webphone_api.global.wasChModified&&(t=444114,webphone_api.global.wasChModified=!1,webphone_api.common.SaveCallhistoryFile(function(e){e?webphone_api.common.PutToDebugLog(2,"EVENT, SaveCallhistoryFile from timer Successfull"):webphone_api.common.PutToDebugLog(2,"ERROR, SaveCallhistoryFile from timer Failed")}))),t=444115,"Ringing"===K&&!0===de&&(fe=webphone_api.common.GetTickCount(),de=!1,_e=!0),"Speaking"===K&&!0===be&&(fe=webphone_api.common.GetTickCount(),be=!1,_e=!0),!1===webphone_api.common.IsSDK()&&webphone_api.global.isCallStarted&&!0===_e&&++we>=3){t=444116,ve=!0===webphone_api.common.GetHoldState(-1)?webphone_api.stringres.get("in_hold")+" ":"";var n=webphone_api.common.GetTickCount(),c=webphone_api.common.GetTickCount()-fe,u=Math.floor(c/1e3),h=Math.floor(u/60);u%=60,u<10&&(u="0"+u),webphone_api.global.isCallStarted&&webphone_api.$("#call_duration").html(ve+h+":"+u+"&nbsp;"),we=0}if("Call Finished"!==K&&"Finished"!==K||webphone_api.common.GetNrOfActiveCalls()<1&&(_e=!1,de=!0,be=!0,webphone_api.webrtcapi.RemoveUnusedAudioElements()),X.indexOf(":")>0){t=444117;if("Call duration"===webphone_api.common.Trim(X.substring(0,X.indexOf(":")))){_e=!1,ve=webphone_api.stringres.get("duration")+" ";var g=webphone_api.common.Trim(X.substring(X.indexOf(":")+1,X.length)),m=0,h=0,u=0;if(g.indexOf(":")<0?u=webphone_api.common.Trim(g.substring(0,g.indexOf(" "))):(m=webphone_api.common.Trim(g.substring(0,g.indexOf(":"))),g=webphone_api.common.Trim(g.substring(g.indexOf(":")+1,g.length)),h=webphone_api.common.Trim(g.substring(0,g.indexOf(":"))),g=webphone_api.common.Trim(g.substring(g.indexOf(":")+1,g.length)),u=webphone_api.common.Trim(g.substring(0,g.length))),!webphone_api.common.isNull(m)&&m.length>0&&webphone_api.common.IsNumber(m)){var d=webphone_api.common.StrToInt(m);d*=60,h=webphone_api.common.StrToInt(h)+d}if(webphone_api.global.isCallStarted&&webphone_api.$("#call_duration").html(ve+h+":"+u+"&nbsp;"),R&&!1===webphone_api.common.GetParameterBool("customizedversion",!0)){var b=webphone_api.common.StrToInt(h),_=webphone_api.common.StrToInt(u);if(b>0||_>30){var f=0;try{f=webphone_api.common.StrToInt(webphone_api.common.GetParameter("proversioncallcount"))}catch(P){webphone_api.common.SaveParameter("proversioncallcount","0")}f<25&&f++,webphone_api.common.SaveParameter("proversioncallcount",f.toString()),R=!1}}}}n-webphone_api.global.httpkatimer>ge&&webphone_api.global.phonestarted>1&&(webphone_api.common.GetParameter("devicetype")===webphone_api.common.DEVICE_WIN_SOFTPHONE()||webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE)&&(t=444118,webphone_api.global.httpkatimer=n,webphone_api.common.WinAPI("API_HTTPKeepAlive",function(e){webphone_api.common.PutToDebugLog(2,"EVENT, notifications OnTimerCycle API_HTTPKeepAlive response: "+e)}),webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE&&webphone_api.global.service_last_life_signal>10&&n-webphone_api.global.service_last_life_signal>8e3&&(webphone_api.common.WinAPI("API_HTTPKeepAlive",function(e){webphone_api.common.PutToDebugLog(2,"EVENT, notifications OnTimerCycle API_HTTPKeepAlive response: "+e)}),webphone_api.common.isNull(B)||clearTimeout(B),B=null,B=setTimeout(function(){webphone_api.common.GetTickCount()-webphone_api.global.service_last_life_signal>8e3&&(webphone_api.global.service_last_life_signal=webphone_api.common.GetTickCount(),webphone_api.common.PutToDebugLog(2,"WARNING, call Handle WSAPIReConnect from timer"),webphone_api.common.WSAPIHandleReConnect()),webphone_api.common.isNull(B)||clearTimeout(B),B=null},2e3))),n-webphone_api.global.httpkatimer>me&&webphone_api.common.getuseengine()===webphone_api.global.ENGINE_JAVA&&(webphone_api.global.httpkatimer=n,webphone_api.HTTPKeepAlive())}catch(C){webphone_api.common.PutToDebugLogException(2,"notifications: OnTimerCycle ("+t.toString()+")",C)}}function i(e,t,n,o,i,a){try{if(webphone_api.common.CanLog(4)&&webphone_api.common.PutToDebugLog(4,"EVENT, notifications CDR added; AddToCallLog(); number: "+e+"; type: "+t+"; recorded: "+n+"; duration: "+o+"; callDateTime = "+P+"; line: "+i),webphone_api.common.isNull(e)&&e.length<1)return;webphone_api.common.isNull(a)&&(a=""),a=webphone_api.common.ReplaceAll(a,","," "),a=webphone_api.common.Trim(a),webphone_api.global.refreshrecents=!0;var r=0;r=P>0?P:webphone_api.common.GetTickCount(),P=0,webphone_api.common.getuseengine()===webphone_api.global.ENGINE_SERVICE&&!webphone_api.common.isNull(o)&&webphone_api.common.IsNumber(o)&&o>0&&(webphone_api.common.SaveParameter("nsupdate","-1"),o>30&&(!0===webphone_api.global.usestorage||webphone_api.common.Strl(60))?webphone_api.common.SaveParameter("lnsengine","0"):webphone_api.common.SaveParameter("lnsengine","1"));var s=0,l=0,p="";try{o=Math.floor(o),s=Math.floor(o/60),l=o%60,s<10&&(p+="0"),p+=0===s?"0:":s+":",l<10&&(p+="0"),p+=l}catch(w){webphone_api.common.PutToDebugLogException(3,"notifications AddToCallLog calc duration",w)}webphone_api.common.isNull(webphone_api.global.callName)&&(webphone_api.global.callName=""),webphone_api.common.isNull(t)&&(t=""),webphone_api.common.isNull(n)&&(n="");var c="";(1===webphone_api.common.IsMultiline()||!webphone_api.common.isNull(i)&&webphone_api.common.StrToInt(i)>1)&&(c=webphone_api.common.GetContactNameFromNumber(e));var u=webphone_api.common.GetContactIdFromNumber(e);if(u>=0){var h=webphone_api.global.ctlist[u];if(webphone_api.common.IsNumber(h[webphone_api.common.CT_USAGE])){var g=webphone_api.common.StrToInt(h[webphone_api.common.CT_USAGE]);g++,h[webphone_api.common.CT_USAGE]=g.toString(),webphone_api.global.ctlist[u]=h}}c===e&&(c=!webphone_api.common.isNull(webphone_api.global.telsearchname)&&webphone_api.global.telsearchname.length>0?webphone_api.common.Trim(webphone_api.global.telsearchname):webphone_api.global.callName),webphone_api.global.telsearchname="",(webphone_api.common.isNull(c)||c.length<1)&&(c=e);var m=1;"0"!==t&&(m=2),1==m?webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcalldisconnected,"callDisconnected",m,e,c,"",r,o,webphone_api.global.lastcallcdr):webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincalldisconnected,"callDisconnected",m,e,c,"","","",webphone_api.global.lastcallcdr);var d=[t,c,e,""+r,""+o,n,a];if(webphone_api.global.chlist.unshift(d),webphone_api.global.wasChModified=!0,"2"===t&&webphone_api.common.PutNotifications2("0","",c+" - "+e,0),webphone_api.common.isNull(c)||c.length<1||!1===webphone_api.common.ContactExists(c,"")){var b=null,_=!1;if(!webphone_api.common.isNull(webphone_api.global.alreadyCalledNrs)&&webphone_api.global.alreadyCalledNrs.length>0&&(b=webphone_api.global.alreadyCalledNrs.split(",")),!webphone_api.common.isNull(b))for(var f=0;f<b.length;f++)if(b[f]===e){_=!0;break}!1===_&&(webphone_api.global.alreadyCalledNrs.length<=0?webphone_api.global.alreadyCalledNrs=e:webphone_api.global.alreadyCalledNrs=webphone_api.global.alreadyCalledNrs+","+e,webphone_api.global.contactExists=!1,webphone_api.global.contactExistsNr=e)}!1===webphone_api.isincall()&&(webphone_api.global.sipunicoderewritefrom="",webphone_api.global.sipunicoderewriteto="")}catch(v){webphone_api.common.PutToDebugLogException(2,"notifications: AddToCallLog",v)}}function a(e,t,n){try{if(webphone_api.common.CanLog(4)&&webphone_api.common.PutToDebugLog(4,"EVENT, notifications: OnMessageReceived from: "+e+"; message: "+t),webphone_api.common.IsContactBlocked(e,null))return void webphone_api.common.PutToDebugLog(4,"EVENT, chat message dropped because blocked contact: "+e);if(webphone_api.common.IsNumberBlacklisted(e,null))return void webphone_api.common.PutToDebugLog(4,"EVENT, chat message dropped because blacklisted number: "+e);t.indexOf("MULTIPART:")>=0&&(t=t.substring(t.indexOf("MULTIPART:")+6),t=webphone_api.common.Trim(t.substring(t.indexOf(":")+1)));var o="";if(t.indexOf("GROUP:")>=0&&(o=t.substring(t.indexOf("GROUP:")+6),o=webphone_api.common.Trim(o.substring(0,o.indexOf(":"))),webphone_api.common.isNull(o)&&(o=""),t=t.substring(t.indexOf("GROUP:")+6),t=webphone_api.common.Trim(t.substring(t.indexOf(":")+1))),webphone_api.common.isNull(t)&&(t=""),t=webphone_api.common.Trim(t),0===t.indexOf("_BASE64_")&&(t=webphone_api.common.B64Dec(t),webphone_api.common.isNull(t)&&(t=""),t=webphone_api.common.Trim(t)),t===webphone_api.stringres.get("composing")||t===webphone_api.stringres.get("composing")+"...")return void webphone_api.common.PutToDebugLog("CHATCOMPOSING,"+n+","+e+",1");if(t.indexOf("FILETRANSFER_DELIVERED:")>=0)return void(!0===webphone_api.global.isFiletransferStarted&&webphone_api.$("#ftranf_status").html(webphone_api.stringres.get("ftrnasf_status_delivered")));if(t.indexOf("[CONFERENCE]")>=0)return void webphone_api.common.ReceivedConferenceInvite(e,t);if(t.indexOf("[CONFERENCE_ANSWER]")>=0)return void(webphone_api.global.confanswer_received=!0);var i=t.indexOf("[PRESENCE,");if(i>=0){if(t=t.substring(i+10),(i=t.indexOf(","))>0){var a=webphone_api.common.Trim(t.substring(0,i)),r=webphone_api.common.Trim(t.substring(i));i=r.indexOf(","),i>0&&(r=r.substring(0,i)),r=webphone_api.common.Trim(r),webphone_api.common.SaveReceivedPresence2(a,r)}return}try{webphone_api.onChatCb(e,t,n,o)}catch(l){webphone_api.common.PutToDebugLogException(2,"There is an error in onChat() callback",l)}if(webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_oninchat,"inChat","",e,e,t),0==webphone_api.common.IsSDK()){if(!0===webphone_api.common.UsePresence2()&&"dnd"===webphone_api.common.GetParameter("presencestatus").toLowerCase()){webphone_api.common.PutToDebugLog(2,"EVENT, dont show incoming chat from: "+e+", because presence is DND");var s=webphone_api.common.GetContactNameFromNumber(e);webphone_api.common.PutNotifications2("1","",s+" - "+e,0),!1===webphone_api.common.IsSDK()&&webphone_api._message.SaveMissedIncomingMessage("chat",e,s,t)}if(3==webphone_api.common.GetParameterInt("chatsms",0)||0==webphone_api.common.GetParameterInt("textmessaging",-1)||1==webphone_api.common.GetParameterInt("textmessaging",-1))return void webphone_api.common.PutToDebugLog(4,"ERROR, OnMessageReceived message dropped because chat is disabled by user");if(webphone_api.global.isMessageStarted)!1===webphone_api.common.IsSDK()&&webphone_api._message.ShowIncomingMessage("chat",e,t);else if(webphone_api.global.checkIfInCall){var s=webphone_api.common.GetContactNameFromNumber(e);webphone_api.common.PutNotifications2("1","",s+" - "+e,0),!1===webphone_api.common.IsSDK()&&webphone_api._message.SaveMissedIncomingMessage("chat",e,s,t)}else webphone_api.global.intentmsg[0]="action=chat",webphone_api.global.intentmsg[1]="to="+e,webphone_api.global.intentmsg[2]="message="+t,webphone_api.$.mobile.changePage("#page_message",{transition:"slide",role:"page"})}}catch(l){webphone_api.common.PutToDebugLogException(2,"notifications: OnMessageReceived",l)}}function r(e,t,n,o,i){var a='border="0"/>';try{if(e.length<1||t.length<1||n.length<1||o<1)return;if("2"!=t&&"4"!=t)return;var r=!1,s=o.split(a);if(webphone_api.common.isNull(s)||s.length<1)return;for(var l=s.length-1;l>=0;l--)if(!(webphone_api.common.isNull(s[l])||s[l].length<1)){var p=s[l].indexOf("<p>"),c=s[l].indexOf("</p>");if(!(p<0||c<p)){var u=s[l].substring(p+3,c);if(!(webphone_api.common.isNull(u)||u.length<1)&&webphone_api.common.Md5Hash(u)===n){if((p=s[l].indexOf('<img class="sent_status"'))>0){s[l]=s[l].substring(0,p);var h="spacer.png";"2"==t?h="icon_chat_status_green.png":"4"==t&&(h="icon_chat_status_black.png");var g='<img class="sent_status" src="'+webphone_api.common.GetElementSource()+"images/"+h+'" ';s[l]=s[l]+g,r=!0}break}}}if(!0===r){for(var m="",l=0;l<s.length;l++)if(!(webphone_api.common.isNull(s[l])||s[l].length<1)){var p=s[l].indexOf("<p>"),c=s[l].indexOf("</p>");p<0||c<p||(m=m+s[l]+a)}webphone_api.common.IsWindowsSoftphone()?webphone_api.common.ApiWinSaveFile(e,m,function(e){e&&webphone_api.common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (1) WinApi"),!0===webphone_api.global.isMessageStarted&&webphone_api.global.mto===i&&webphone_api._message.LoadMessage()}):webphone_api.File.SaveFile(e,m,webphone_api.global.STORAGE_LOCAL,function(e){e||webphone_api.common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (1)"),!0===webphone_api.global.isMessageStarted&&webphone_api.global.mto===i&&webphone_api._message.LoadMessage()})}}catch(d){webphone_api.common.PutToDebugLogException(2,"notifications: SaveChatReport",d)}}function s(e,t,n,o){try{if(!webphone_api.common.isNull(e)&&e.toLowerCase().indexOf("subscribe")>=0)return;if("Authenticated successfully"===e){if(!0===webphone_api.global.authenticated_displayed)return;webphone_api.global.authenticated_displayed=!0}if(webphone_api.global.flagWaitforautoprov)return;if(webphone_api.common.isNull(e))return;webphone_api.common.Trim(e).length<1&&(e="&nbsp"),e.indexOf(De)<0&&"ERROR"!==t&&"WARNING"!==t&&(webphone_api.global.last_good_status=e);var i=webphone_api.common.GetTickCount();if(i-Le<5e3)return;!webphone_api.common.isNull(Oe)&&Oe.length>0&&e.indexOf(Oe)>=0&&(Le=i),e=e.replace("DISPLAY",""),e.toLowerCase().indexOf("demo")>=0&&(Re=i,ye=e,Ge=t),i-Re<15e3?(e=ye,t=Ge):(ye="",Ge="");var a=y;if((webphone_api.common.isNull(t)||t.length<1)&&(t="EVENT"),"ERROR"===t&&(a="#FF0000"),"WARNING"===t&&(a="#D28F00"),e.toLowerCase().indexOf("success")>=0&&(a="#4EC200"),1===n?webphone_api.common.isNull(Ce)&&(Ce=document.getElementById("status_message")):(webphone_api.common.isNull(Te)&&(Te=document.getElementById("status_dialpad")),webphone_api.common.isNull(Ne)&&(Ne=document.getElementById("status_contactslist")),webphone_api.common.isNull(Se)&&(Se=document.getElementById("status_callhistorylist")),webphone_api.common.isNull(Ie)&&(Ie=document.getElementById("status_call")),webphone_api.common.isNull(Ce)&&(Ce=document.getElementById("status_message"))),!0===webphone_api.global.last_presence_enabled&&!0===webphone_api.global.pres_unreg_called){var r=e.toLowerCase();(r.indexOf("unregister")>=0||r.indexOf("register failed")>=0||r.indexOf("disconnected")>=0)&&(e="Offline")}var s=webphone_api.common.Translate(e);if(webphone_api.common.isNull(Te)||-1!==o||(Te.innerHTML=s,Te.style.color=a),webphone_api.common.isNull(Ne)||-1!==o||(Ne.innerHTML=s,Ne.style.color=a),webphone_api.common.isNull(Se)||-1!==o||(Se.innerHTML=s,Se.style.color=a),!webphone_api.common.isNull(Ie)&&s.indexOf("uthenticated successfully")<1){var l=webphone_api.common.StrToIntDef(webphone_api.global.aline,-1),p="";if("undefined"!=typeof webphone_api.global.callPageStatusCachePerLine[l]&&null!==webphone_api.global.callPageStatusCachePerLine[l]&&webphone_api.global.callPageStatusCachePerLine[l].length>=2&&(p=webphone_api.global.callPageStatusCachePerLine[l][0],webphone_api.common.isNull(p)&&(p="")),o>0||p.length>0&&l>0){webphone_api.common.isNull(webphone_api.global.rating)||!webphone_api.global.rating.length||"STATUS"!==t&&"EVENT"!==t||(s+=webphone_api.global.rating);try{var l=webphone_api.common.StrToIntDef(webphone_api.global.aline,-1);if(p.length>0){var c=webphone_api.global.callPageStatusCachePerLine[l][1];p=webphone_api.common.Translate(p),Ie.innerHTML=p,Ie.style.color=c}else Ie.innerHTML=s,Ie.style.color=a}catch(h){webphone_api.common.PutToDebugLog(2,"ERROR, DisplayStatus per line on call page"),Ie.innerHTML=s,Ie.style.color=a}}}!webphone_api.common.isNull(Ce)&&o>0&&(Ce.innerHTML=s,Ce.style.color=a);var u='<span style="color: '+a+';">'+s+"</span>";try{webphone_api.RecDisplayableNotifications(u)}catch(g){webphone_api.common.PutToDebugLogException(2,"notifications: DisplayStatus RecDisplayableNotifications",g)}}catch(g){webphone_api.common.PutToDebugLogException(2,"notifications: DisplayStatus",g)}}function l(){try{return webphone_api.common.isNull(b)&&(b="STATUS,-1,Ready."),b}catch(e){webphone_api.common.PutToDebugLogException(2,"notifications: GetStatus",e)}return""}function p(e){try{if(webphone_api.common.isNull(e)||e.lenght<1)return!0;var t=[];t.push("C"),t.push("a"),t.push("l"),t.push("l"),t.push("-"),t.push("I"),t.push("D"),t.push(":");var n=t.join(""),o=e.indexOf(n);if(o>0){var e=webphone_api.common.Trim(e.substring(o+8));e.indexOf("\r\n")>0&&(e=webphone_api.common.Trim(e.substring(0,e.indexOf("\r\n"))))}var i=0;e=e.toString();for(var a=0;a<e.length;a++)i+=e.charCodeAt(a);return i%webphone_api.global.testmessagevalidity!=0}catch(r){webphone_api.common.PutToDebugLogException(2,"notifications: IsGoodCRC",r)}return!0}function c(e,t){try{if(webphone_api.common.isNull(e)||e.length<4||e.indexOf(",")<0)return t;var n=e.split(",");if(webphone_api.common.isNull(n)||n.length<2)return t;if(!webphone_api.common.isNull(n[1])||webphone_api.common.IsNumber(n[1])){var o=webphone_api.common.StrToInt(n[1]);if(o>-3&&o<100)return o}}catch(i){webphone_api.common.PutToDebugLogException(2,"notifications: GetLineFromNot",i)}return t}function u(){try{ie>0&&(webphone_api.$(document).mousemove(function(e){xe=webphone_api.common.GetTickCount()}),webphone_api.$(document).keypress(function(e){xe=webphone_api.common.GetTickCount()}),webphone_api.$(document).scroll(function(e){xe=webphone_api.common.GetTickCount()}),webphone_api.common.isNull(ae)||clearInterval(ae),ae=setInterval(function(){try{webphone_api.common.GetTickCount()-xe<2e3&&"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents("[USERINTERACTION]_NOTIFICATION")}catch(e){webphone_api.common.PutToDebugLogException(2,"notifications: ProcessNotifications inner AndroidWebphoneJsInterface userinteraction",e)}},500))}catch(e){webphone_api.common.PutToDebugLogException(2,"notifications: HandleAndroidUserInteraction",e)}}var h,g,m,d,b,_=!1,f=!1,w="",v=0,P=0,E=0,T=!1,N=0,S=0,I=0,C=100,R=!1,G=0,y="#ffffff",L=-1,O=0,D=18e4,x=0,A=36e5,k=0,U=0,V=0,W=0,F=!1,M=!1,H=0,B=null,j=null,$="",q="",z="",K="",X="",J="",Y="",Q=-1,Z=null,ee=!1,te=webphone_api.stringres.get("status_startingengine"),ne=webphone_api.stringres.get("status_enginestarted"),oe="",ie=-1,ae=null,re=0,se=35,le="",pe=-1,ce="",ue="",he=-1,ge=6e3,me=24e3,de=!0,be=!0,_e=!1,fe=0,we=0,ve="",Pe=0,Ee="",Te=null,Ne=null,Se=null,Ie=null,Ce=null,Re=0,Ge="",ye="",Le=0,Oe=webphone_api.stringres.get("disc_reason"),De=webphone_api.stringres.get("ns_engine_unreachable"),xe=0;return{ProcessNotifications:t,GetStatus:l,AddToCallLog:i,SetCallStartTime:n,IsGoodCRC:p,OnMessageReceived:a}}();